(self.webpackChunkpfe_new=self.webpackChunkpfe_new||[]).push([[792],{117:(yg,Lc,wn)=>{"use strict";function Qi(t){return"function"==typeof t}function co(t){const e=t(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const nu=co(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class En{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Qi(i))try{i()}catch(s){n=s instanceof nu?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{cc(s)}catch(c){n=n??[],c instanceof nu?n=[...n,...c.errors]:n.push(c)}}if(n)throw new nu(n)}}add(n){var e;if(n&&n!==this)if(this.closed)cc(n);else{if(n instanceof En){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&p(e,n)}remove(n){const{_finalizers:e}=this;e&&p(e,n),n instanceof En&&n._removeParent(this)}}En.EMPTY=(()=>{const t=new En;return t.closed=!0,t})();const oi=En.EMPTY;function Xl(t){return t instanceof En||t&&"closed"in t&&Qi(t.remove)&&Qi(t.add)&&Qi(t.unsubscribe)}function cc(t){Qi(t)?t():t.unsubscribe()}const Qr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},zt={setTimeout(t,n,...e){const{delegate:i}=zt;return i?.setTimeout?i.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=zt;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Fc(t){zt.setTimeout(()=>{const{onUnhandledError:n}=Qr;if(!n)throw t;n(t)})}function Gn(){}const mr=No("C",void 0,void 0);function No(t,n,e){return{kind:t,value:n,error:e}}let Uo=null;function Ya(t){if(Qr.useDeprecatedSynchronousErrorHandling){const n=!Uo;if(n&&(Uo={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:i}=Uo;if(Uo=null,e)throw i}}else t()}class xa extends En{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Xl(n)&&n.add(this)):this.destination=Cr}static create(n,e,i){return new Ji(n,e,i)}next(n){this.isStopped?Qn(function ho(t){return No("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Qn(function Rr(t){return No("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Qn(mr,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Il=Function.prototype.bind;function Xa(t,n){return Il.call(t,n)}class zc{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(i){Co(i)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(i){Co(i)}else Co(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Co(e)}}}class Ji extends xa{constructor(n,e,i){let r;if(super(),Qi(n)||!n)r={next:n??void 0,error:e??void 0,complete:i??void 0};else{let s;this&&Qr.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=()=>this.unsubscribe(),r={next:n.next&&Xa(n.next,s),error:n.error&&Xa(n.error,s),complete:n.complete&&Xa(n.complete,s)}):r=n}this.destination=new zc(r)}}function Co(t){Qr.useDeprecatedSynchronousErrorHandling?function Pl(t){Qr.useDeprecatedSynchronousErrorHandling&&Uo&&(Uo.errorThrown=!0,Uo.error=t)}(t):Fc(t)}function Qn(t,n){const{onStoppedNotification:e}=Qr;e&&zt.setTimeout(()=>e(t,n))}const Cr={closed:!0,next:Gn,error:function gr(t){throw t},complete:Gn},gs="function"==typeof Symbol&&Symbol.observable||"@@observable";function no(t){return t}function Pi(t){return 0===t.length?no:1===t.length?t[0]:function(e){return t.reduce((i,r)=>r(i),e)}}let Jn=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new t;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function Yo(t){return t&&t instanceof xa||function Sr(t){return t&&Qi(t.next)&&Qi(t.error)&&Qi(t.complete)}(t)&&Xl(t)}(e)?e:new Ji(e,i,r);return Ya(()=>{const{operator:c,source:f}=this;s.add(c?c.call(s,f):f?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=yi(i))((r,s)=>{const c=new Ji({next:f=>{try{e(f)}catch(y){s(y),c.unsubscribe()}},error:s,complete:r});this.subscribe(c)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[gs](){return this}pipe(...e){return Pi(e)(this)}toPromise(e){return new(e=yi(e))((i,r)=>{let s;this.subscribe(c=>s=c,c=>r(c),()=>i(s))})}}return t.create=n=>new t(n),t})();function yi(t){var n;return null!==(n=t??Qr.Promise)&&void 0!==n?n:Promise}const Bo=co(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Sn=(()=>{class t extends Jn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new ei(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Bo}next(e){Ya(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Ya(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Ya(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?oi:(this.currentObservers=null,s.push(e),new En(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Jn;return e.source=this,e}}return t.create=(n,e)=>new ei(n,e),t})();class ei extends Sn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,n)}error(n){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==i?i:oi}}function si(t){return Qi(t?.lift)}function Lr(t){return n=>{if(si(n))return n.lift(function(e){try{return t(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function ui(t,n,e,i,r){return new Nc(t,n,e,i,r)}class Nc extends xa{constructor(n,e,i,r,s,c){super(n),this.onFinalize=s,this.shouldUnsubscribe=c,this._next=e?function(f){try{e(f)}catch(y){n.error(y)}}:super._next,this._error=r?function(f){try{r(f)}catch(y){n.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(f){n.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function zi(t,n){return Lr((e,i)=>{let r=0;e.subscribe(ui(i,s=>{i.next(t.call(n,s,r++))}))})}function Eo(t){return this instanceof Eo?(this.v=t,this):new Eo(t)}function fc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function So(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=t[s]&&function(c){return new Promise(function(f,y){!function r(s,c,f,y){Promise.resolve(y).then(function(k){s({value:k,done:f})},c)}(f,y,(c=t[s](c)).done,c.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ae=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function ge(t){return Qi(t?.then)}function Ae(t){return Qi(t[gs])}function je(t){return Symbol.asyncIterator&&Qi(t?.[Symbol.asyncIterator])}function Fe(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ge=function We(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ne(t){return Qi(t?.[Ge])}function at(t){return function Bc(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(t,n||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",function c(W){return function(re){return Promise.resolve(re).then(W,F)}}),r[Symbol.asyncIterator]=function(){return this},r;function f(W,re){i[W]&&(r[W]=function(he){return new Promise(function(me,Pe){s.push([W,he,me,Pe])>1||y(W,he)})},re&&(r[W]=re(r[W])))}function y(W,re){try{!function k(W){W.value instanceof Eo?Promise.resolve(W.value.v).then(E,F):$(s[0][2],W)}(i[W](re))}catch(he){$(s[0][3],he)}}function E(W){y("next",W)}function F(W){y("throw",W)}function $(W,re){W(re),s.shift(),s.length&&y(s[0][0],s[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:i,done:r}=yield Eo(e.read());if(r)return yield Eo(void 0);yield yield Eo(i)}}finally{e.releaseLock()}})}function bt(t){return Qi(t?.getReader)}function tt(t){if(t instanceof Jn)return t;if(null!=t){if(Ae(t))return function Zt(t){return new Jn(n=>{const e=t[gs]();if(Qi(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(ae(t))return function jt(t){return new Jn(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(ge(t))return function pn(t){return new Jn(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Fc)})}(t);if(je(t))return Wn(t);if(Ne(t))return function Nn(t){return new Jn(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(bt(t))return function ii(t){return Wn(at(t))}(t)}throw Fe(t)}function Wn(t){return new Jn(n=>{(function pi(t,n){var e,i,r,s;return function _r(t,n,e,i){return new(e||(e=Promise))(function(s,c){function f(E){try{k(i.next(E))}catch(F){c(F)}}function y(E){try{k(i.throw(E))}catch(F){c(F)}}function k(E){E.done?s(E.value):function r(s){return s instanceof e?s:new e(function(c){c(s)})}(E.value).then(f,y)}k((i=i.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=fc(t);!(i=yield e.next()).done;)if(n.next(i.value),n.closed)return}catch(c){r={error:c}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function cr(t,n,e,i=0,r=!1){const s=n.schedule(function(){e(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function fi(t,n,e=1/0){return Qi(n)?fi((i,r)=>zi((s,c)=>n(i,s,r,c))(tt(t(i,r))),e):("number"==typeof n&&(e=n),Lr((i,r)=>function ci(t,n,e,i,r,s,c,f){const y=[];let k=0,E=0,F=!1;const $=()=>{F&&!y.length&&!k&&n.complete()},W=he=>k<i?re(he):y.push(he),re=he=>{s&&n.next(he),k++;let me=!1;tt(e(he,E++)).subscribe(ui(n,Pe=>{r?.(Pe),s?W(Pe):n.next(Pe)},()=>{me=!0},void 0,()=>{if(me)try{for(k--;y.length&&k<i;){const Pe=y.shift();c?cr(n,c,()=>re(Pe)):re(Pe)}$()}catch(Pe){n.error(Pe)}}))};return t.subscribe(ui(n,W,()=>{F=!0,$()})),()=>{f?.()}}(i,r,t,e)))}function ki(t=1/0){return fi(no,t)}const Si=new Jn(t=>t.complete());function qo(t){return t&&Qi(t.schedule)}function Qo(t){return t[t.length-1]}function _s(t){return Qi(Qo(t))?t.pop():void 0}function ka(t){return qo(Qo(t))?t.pop():void 0}function Ps(t,n=0){return Lr((e,i)=>{e.subscribe(ui(i,r=>cr(i,t,()=>i.next(r),n),()=>cr(i,t,()=>i.complete(),n),r=>cr(i,t,()=>i.error(r),n)))})}function Jo(t,n=0){return Lr((e,i)=>{i.add(t.schedule(()=>e.subscribe(i),n))})}function _l(t,n){if(!t)throw new Error("Iterable cannot be null");return new Jn(e=>{cr(e,n,()=>{const i=t[Symbol.asyncIterator]();cr(e,n,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function ti(t,n){return n?function sd(t,n){if(null!=t){if(Ae(t))return function cs(t,n){return tt(t).pipe(Jo(n),Ps(n))}(t,n);if(ae(t))return function yo(t,n){return new Jn(e=>{let i=0;return n.schedule(function(){i===t.length?e.complete():(e.next(t[i++]),e.closed||this.schedule())})})}(t,n);if(ge(t))return function rr(t,n){return tt(t).pipe(Jo(n),Ps(n))}(t,n);if(je(t))return _l(t,n);if(Ne(t))return function gc(t,n){return new Jn(e=>{let i;return cr(e,n,()=>{i=t[Ge](),cr(e,n,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(c){return void e.error(c)}s?e.complete():e.next(r)},0,!0)}),()=>Qi(i?.return)&&i.return()})}(t,n);if(bt(t))return function _c(t,n){return _l(at(t),n)}(t,n)}throw Fe(t)}(t,n):tt(t)}function Oo(...t){const n=ka(t),e=function ys(t,n){return"number"==typeof Qo(t)?t.pop():n}(t,1/0),i=t;return i.length?1===i.length?tt(i[0]):ki(e)(ti(i,n)):Si}class Is extends Sn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:i}=this;if(n)throw e;return this._throwIfClosed(),i}next(n){super.next(this._value=n)}}function Un(...t){return ti(t,ka(t))}function Os(t={}){const{connector:n=(()=>new Sn),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=t;return s=>{let c,f,y,k=0,E=!1,F=!1;const $=()=>{f?.unsubscribe(),f=void 0},W=()=>{$(),c=y=void 0,E=F=!1},re=()=>{const he=c;W(),he?.unsubscribe()};return Lr((he,me)=>{k++,!F&&!E&&$();const Pe=y=y??n();me.add(()=>{k--,0===k&&!F&&!E&&(f=Rs(re,r))}),Pe.subscribe(me),!c&&k>0&&(c=new Ji({next:Re=>Pe.next(Re),error:Re=>{F=!0,$(),f=Rs(W,e,Re),Pe.error(Re)},complete:()=>{E=!0,$(),f=Rs(W,i),Pe.complete()}}),tt(he).subscribe(c))})(s)}}function Rs(t,n,...e){if(!0===n)return void t();if(!1===n)return;const i=new Ji({next:()=>{i.unsubscribe(),t()}});return tt(n(...e)).subscribe(i)}function $o(t,n){return Lr((e,i)=>{let r=null,s=0,c=!1;const f=()=>c&&!r&&i.complete();e.subscribe(ui(i,y=>{r?.unsubscribe();let k=0;const E=s++;tt(t(y,E)).subscribe(r=ui(i,F=>i.next(n?n(y,F,E,k++):F),()=>{r=null,f()}))},()=>{c=!0,f()}))})}function na(t,n=no){return t=t??uo,Lr((e,i)=>{let r,s=!0;e.subscribe(ui(i,c=>{const f=n(c);(s||!t(r,f))&&(s=!1,r=f,i.next(c))}))})}function uo(t,n){return t===n}function tr(t){for(let n in t)if(t[n]===tr)return n;throw Error("Could not find renamed property on target object.")}function Ls(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Ro(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Ro).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function Rd(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Qa=tr({__forward_ref__:tr});function Tr(t){return t.__forward_ref__=Tr,t.toString=function(){return Ro(this())},t}function Ri(t){return yc(t)?t():t}function yc(t){return"function"==typeof t&&t.hasOwnProperty(Qa)&&t.__forward_ref__===Tr}function Es(t){return t&&!!t.\u0275providers}const Hc="https://g.co/ng/security#xss";class Ht extends Error{constructor(n,e){super(function Uc(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,e)),this.code=n}}function Ui(t){return"string"==typeof t?t:null==t?"":String(t)}function Ah(t,n){throw new Ht(-201,!1)}function Va(t,n){null==t&&function On(t,n,e,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${e} ${i} ${n} <=Actual]`))}(n,t,null,"!=")}function vn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ii(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ni(t){return Cn(t,Fd)||Cn(t,bl)}function Cn(t,n){return t.hasOwnProperty(n)?t[n]:null}function el(t){return t&&(t.hasOwnProperty(Ea)||t.hasOwnProperty(ld))?t[Ea]:null}const Fd=tr({\u0275prov:tr}),Ea=tr({\u0275inj:tr}),bl=tr({ngInjectableDef:tr}),ld=tr({ngInjectorDef:tr});var Fi=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Fi||{});let yn;function bi(t){const n=yn;return yn=t,n}function Da(t,n,e){const i=Ni(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Fi.Optional?null:void 0!==n?n:void Ah(Ro(t))}const Hn=globalThis;class tn{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=vn({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const $c={},Ql="__NG_DI_FLAG__",Vo="ngTempTokenPath",Yn=/\n/gm,oa="__source";let kn;function vs(t){const n=kn;return kn=t,n}function Ln(t,n=Fi.Default){if(void 0===kn)throw new Ht(-203,!1);return null===kn?Da(t,void 0,n):kn.get(t,n&Fi.Optional?null:void 0,n)}function Dt(t,n=Fi.Default){return(function nr(){return yn}()||Ln)(Ri(t),n)}function Rn(t,n=Fi.Default){return Dt(t,dd(n))}function dd(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function ds(t){const n=[];for(let e=0;e<t.length;e++){const i=Ri(t[e]);if(Array.isArray(i)){if(0===i.length)throw new Ht(900,!1);let r,s=Fi.Default;for(let c=0;c<i.length;c++){const f=i[c],y=tl(f);"number"==typeof y?-1===y?r=f.token:s|=y:r=f}n.push(Dt(r,s))}else n.push(Dt(i))}return n}function Ds(t,n){return t[Ql]=n,t.prototype[Ql]=n,t}function tl(t){return t[Ql]}function Ys(t){return{toString:t}.toString()}var Fs=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Fs||{}),Go=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Go||{});const Aa={},Er=[],Vl=tr({\u0275cmp:tr}),kl=tr({\u0275dir:tr}),Ha=tr({\u0275pipe:tr}),hd=tr({\u0275mod:tr}),Xs=tr({\u0275fac:tr}),ud=tr({__NG_ELEMENT_ID__:tr}),lu=tr({__NG_ENV_ID__:tr});function rh(t,n,e){let i=t.length;for(;;){const r=t.indexOf(n,e);if(-1===r)return r;if(0===r||t.charCodeAt(r-1)<=32){const s=n.length;if(r+s===i||t.charCodeAt(r+s)<=32)return r}e=r+1}}function xc(t,n,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],c=e[i++],f=e[i++];t.setAttribute(n,c,f,s)}else{const s=r,c=e[++i];Vd(s)?t.setProperty(n,s,c):t.setAttribute(n,s,c),i++}}return i}function Ih(t){return 3===t||4===t||6===t}function Vd(t){return 64===t.charCodeAt(0)}function jd(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let i=0;i<n.length;i++){const r=n[i];"number"==typeof r?e=r:0===e||Gc(t,e,r,null,-1===e||2===e?n[++i]:null)}}return t}function Gc(t,n,e,i,r){let s=0,c=t.length;if(-1===n)c=-1;else for(;s<t.length;){const f=t[s++];if("number"==typeof f){if(f===n){c=-1;break}if(f>n){c=s-1;break}}}for(;s<t.length;){const f=t[s];if("number"==typeof f)break;if(f===e){if(null===i)return void(null!==r&&(t[s+1]=r));if(i===t[s+1])return void(t[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==c&&(t.splice(c,0,n),s=c+1),t.splice(s++,0,e),null!==i&&t.splice(s++,0,i),null!==r&&t.splice(s++,0,r)}const Hd="ng-template";function Gu(t,n,e){let i=0,r=!0;for(;i<t.length;){let s=t[i++];if("string"==typeof s&&r){const c=t[i++];if(e&&"class"===s&&-1!==rh(c.toLowerCase(),n,0))return!0}else{if(1===s){for(;i<t.length&&"string"==typeof(s=t[i++]);)if(s.toLowerCase()===n)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function Jl(t){return 4===t.type&&t.value!==Hd}function Oh(t,n,e){return n===(4!==t.type||e?t.value:Hd)}function cu(t,n,e){let i=4;const r=t.attrs||[],s=function Ud(t){for(let n=0;n<t.length;n++)if(Ih(t[n]))return n;return t.length}(r);let c=!1;for(let f=0;f<n.length;f++){const y=n[f];if("number"!=typeof y){if(!c)if(4&i){if(i=2|1&i,""!==y&&!Oh(t,y,e)||""===y&&1===n.length){if(es(i))return!1;c=!0}}else{const k=8&i?y:n[++f];if(8&i&&null!==t.attrs){if(!Gu(t.attrs,k,e)){if(es(i))return!1;c=!0}continue}const F=sa(8&i?"class":y,r,Jl(t),e);if(-1===F){if(es(i))return!1;c=!0;continue}if(""!==k){let $;$=F>s?"":r[F+1].toLowerCase();const W=8&i?$:null;if(W&&-1!==rh(W,k,0)||2&i&&k!==$){if(es(i))return!1;c=!0}}}}else{if(!c&&!es(i)&&!es(y))return!1;if(c&&es(y))continue;c=!1,i=y|1&i}}return es(i)||c}function es(t){return 0==(1&t)}function sa(t,n,e,i){if(null===n)return-1;let r=0;if(i||!e){let s=!1;for(;r<n.length;){const c=n[r];if(c===t)return r;if(3===c||6===c)s=!0;else{if(1===c||2===c){let f=n[++r];for(;"string"==typeof f;)f=n[++r];continue}if(4===c)break;if(0===c){r+=4;continue}}r+=s?1:2}return-1}return function jl(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const i=t[e];if("number"==typeof i)return-1;if(i===n)return e;e++}return-1}(n,t)}function wc(t,n,e=!1){for(let i=0;i<n.length;i++)if(cu(t,n[i],e))return!0;return!1}function du(t,n){e:for(let e=0;e<n.length;e++){const i=n[e];if(t.length===i.length){for(let r=0;r<t.length;r++)if(t[r]!==i[r])continue e;return!0}}return!1}function Xt(t,n){return t?":not("+n.trim()+")":n}function qd(t){let n=t[0],e=1,i=2,r="",s=!1;for(;e<t.length;){let c=t[e];if("string"==typeof c)if(2&i){const f=t[++e];r+="["+c+(f.length>0?'="'+f+'"':"")+"]"}else 8&i?r+="."+c:4&i&&(r+=" "+c);else""!==r&&!es(c)&&(n+=Xt(s,r),r=""),i=c,s=s||!es(i);e++}return""!==r&&(n+=Xt(s,r)),n}function Xn(t){return Ys(()=>{const n=jr(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Fs.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Go.Emulated,styles:t.styles||Er,_:null,schemas:t.schemas||null,tView:null,id:""};Zu(e);const i=t.dependencies;return e.directiveDefs=sh(i,!1),e.pipeDefs=sh(i,!0),e.id=function Op(t){let n=0;const e=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const r of e)n=Math.imul(31,n)+r.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(e),e})}function Hl(t){return Wi(t)||zs(t)}function nl(t){return null!==t}function Bi(t){return Ys(()=>({type:t.type,bootstrap:t.bootstrap||Er,declarations:t.declarations||Er,imports:t.imports||Er,exports:t.exports||Er,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Ul(t,n){if(null==t)return Aa;const e={};for(const i in t)if(t.hasOwnProperty(i)){let r=t[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,n&&(n[r]=s)}return e}function gi(t){return Ys(()=>{const n=jr(t);return Zu(n),n})}function $n(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function Wi(t){return t[Vl]||null}function zs(t){return t[kl]||null}function aa(t){return t[Ha]||null}function Pa(t,n){const e=t[hd]||null;if(!e&&!0===n)throw new Error(`Type ${Ro(t)} does not have '\u0275mod' property.`);return e}function jr(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||Aa,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||Er,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Ul(t.inputs,n),outputs:Ul(t.outputs)}}function Zu(t){t.features?.forEach(n=>n(t))}function sh(t,n){if(!t)return null;const e=n?aa:Hl;return()=>("function"==typeof t?t():t).map(i=>e(i)).filter(nl)}const ts=0,Tn=1,Zi=2,x=3,T=4,H=5,ee=6,pe=7,Ee=8,nt=9,St=10,yt=11,on=12,Y=13,J=14,fe=15,Ue=16,At=17,xn=18,Mi=19,yr=20,io=21,Ua=22,fd=23,Wc=24,Ar=25,hs=1,Yu=2,tc=7,ah=9,Ks=11;function qa(t){return Array.isArray(t)&&"object"==typeof t[hs]}function Ia(t){return Array.isArray(t)&&!0===t[hs]}function pu(t){return 0!=(4&t.flags)}function fu(t){return t.componentOffset>-1}function il(t){return 1==(1&t.flags)}function nc(t){return!!t.template}function Rp(t){return 0!=(512&t[Zi])}function mu(t,n){return t.hasOwnProperty(Xs)?t[Xs]:null}let rl=null,ql=!1;function Mc(t){const n=rl;return rl=t,n}const Gf={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Sg(t){if(!Ku(t)||t.dirty){if(!t.producerMustRecompute(t)&&!p0(t))return void(t.dirty=!1);t.producerRecomputeValue(t),t.dirty=!1}}function u0(t){t.dirty=!0,function Wf(t){if(void 0===t.liveConsumerNode)return;const n=ql;ql=!0;try{for(const e of t.liveConsumerNode)e.dirty||u0(e)}finally{ql=n}}(t),t.consumerMarkedDirty?.(t)}function Bp(t){return t&&(t.nextProducerIndex=0),Mc(t)}function Rh(t,n){if(Mc(n),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(Ku(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Dg(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function p0(t){Lh(t);for(let n=0;n<t.producerNode.length;n++){const e=t.producerNode[n],i=t.producerLastReadVersion[n];if(i!==e.version||(Sg(e),i!==e.version))return!0}return!1}function Dy(t){if(Lh(t),Ku(t))for(let n=0;n<t.producerNode.length;n++)Dg(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Dg(t,n){if(function Qu(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),Lh(t),1===t.liveConsumerNode.length)for(let i=0;i<t.producerNode.length;i++)Dg(t.producerNode[i],t.producerIndexOfThis[i]);const e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){const i=t.liveConsumerIndexOfThis[n],r=t.liveConsumerNode[n];Lh(r),r.producerIndexOfThis[i]=n}}function Ku(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Lh(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let Xf=null;const g0=()=>{},Cb=(()=>({...Gf,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule(t.ref)},hasRun:!1,cleanupFn:g0}))();class Eb{constructor(n,e,i){this.previousValue=n,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function ol(){return Ig}function Ig(t){return t.type.prototype.ngOnChanges&&(t.setInput=y0),_0}function _0(){const t=ic(this),n=t?.current;if(n){const e=t.previous;if(e===Aa)t.previous=n;else for(let i in n)e[i]=n[i];t.current=null,this.ngOnChanges(n)}}function y0(t,n,e,i){const r=this.declaredInputs[e],s=ic(t)||function gu(t,n){return t[Og]=n}(t,{previous:Aa,current:null}),c=s.current||(s.current={}),f=s.previous,y=f[r];c[r]=new Eb(y&&y.currentValue,n,f===Aa),t[i]=n}ol.ngInherit=!0;const Og="__ngSimpleChanges__";function ic(t){return t[Og]||null}const Zc=function(t,n,e){},tp="svg";function Yr(t){for(;Array.isArray(t);)t=t[ts];return t}function _u(t,n){return Yr(n[t])}function la(t,n){return Yr(n[t.index])}function b0(t,n){return t.data[n]}function np(t,n){return t[n]}function Yc(t,n){const e=n[t];return qa(e)?e:e[ts]}function nn(t,n){return null==n?null:t[n]}function yu(t){t[At]=0}function jo(t){1024&t[Zi]||(t[Zi]|=1024,md(t,1))}function it(t){1024&t[Zi]&&(t[Zi]&=-1025,md(t,-1))}function md(t,n){let e=t[x];if(null===e)return;e[H]+=n;let i=e;for(e=e[x];null!==e&&(1===n&&1===i[H]||-1===n&&0===i[H]);)e[H]+=n,i=e,e=e[x]}const Yi={lFrame:Qs(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function w0(){return Yi.bindingsEnabled}function Bh(){return null!==Yi.skipHydrationRootTNode}function cn(){return Yi.lFrame.lView}function Jr(){return Yi.lFrame.tView}function An(t){return Yi.lFrame.contextLView=t,t[Ee]}function Mn(t){return Yi.lFrame.contextLView=null,t}function Ml(){let t=qp();for(;null!==t&&64===t.type;)t=t.parent;return t}function qp(){return Yi.lFrame.currentTNode}function Ei(t,n){const e=Yi.lFrame;e.currentTNode=t,e.isParent=n}function tm(){return Yi.lFrame.isParent}function Gd(){Yi.lFrame.isParent=!1}function sl(){const t=Yi.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function Cc(){return Yi.lFrame.bindingIndex}function vu(){return Yi.lFrame.bindingIndex++}function al(t){const n=Yi.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function op(t,n){const e=Yi.lFrame;e.bindingIndex=e.bindingRootIndex=t,Cl(n)}function Cl(t){Yi.lFrame.currentDirectiveIndex=t}function Bg(){return Yi.lFrame.currentQueryIndex}function ch(t){Yi.lFrame.currentQueryIndex=t}function C0(t){const n=t[Tn];return 2===n.type?n.declTNode:1===n.type?t[ee]:null}function im(t,n,e){if(e&Fi.SkipSelf){let r=n,s=t;for(;!(r=r.parent,null!==r||e&Fi.Host||(r=C0(s),null===r||(s=s[J],10&r.type))););if(null===r)return!1;n=r,t=s}const i=Yi.lFrame=Vg();return i.currentTNode=n,i.lView=t,!0}function sp(t){const n=Vg(),e=t[Tn];Yi.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function Vg(){const t=Yi.lFrame,n=null===t?null:t.child;return null===n?Qs(t):n}function Qs(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function jg(){const t=Yi.lFrame;return Yi.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Hg=jg;function dh(){const t=jg();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function ll(){return Yi.lFrame.selectedIndex}function Xc(t){Yi.lFrame.selectedIndex=t}function bs(){const t=Yi.lFrame;return b0(t.tView,t.selectedIndex)}function Ao(){Yi.lFrame.currentNamespace=tp}function Ns(){!function E0(){Yi.lFrame.currentNamespace=null}()}let D0=!0;function ap(){return D0}function jh(t){D0=t}function sm(t,n){for(let e=n.directiveStart,i=n.directiveEnd;e<i;e++){const s=t.data[e].type.prototype,{ngAfterContentInit:c,ngAfterContentChecked:f,ngAfterViewInit:y,ngAfterViewChecked:k,ngOnDestroy:E}=s;c&&(t.contentHooks??=[]).push(-e,c),f&&((t.contentHooks??=[]).push(e,f),(t.contentCheckHooks??=[]).push(e,f)),y&&(t.viewHooks??=[]).push(-e,y),k&&((t.viewHooks??=[]).push(e,k),(t.viewCheckHooks??=[]).push(e,k)),null!=E&&(t.destroyHooks??=[]).push(e,E)}}function am(t,n,e){T0(t,n,3,e)}function Zp(t,n,e,i){(3&t[Zi])===e&&T0(t,n,e,i)}function Ug(t,n){let e=t[Zi];(3&e)===n&&(e&=8191,e+=1,t[Zi]=e)}function T0(t,n,e,i){const s=i??-1,c=n.length-1;let f=0;for(let y=void 0!==i?65535&t[At]:0;y<c;y++)if("number"==typeof n[y+1]){if(f=n[y],null!=i&&f>=i)break}else n[y]<0&&(t[At]+=65536),(f<s||-1==s)&&(Oy(t,e,n,y),t[At]=(4294901760&t[At])+y+2),y++}function A0(t,n){Zc(4,t,n);const e=Mc(null);try{n.call(t)}finally{Mc(e),Zc(5,t,n)}}function Oy(t,n,e,i){const r=e[i]<0,s=e[i+1],f=t[r?-e[i]:e[i]];r?t[Zi]>>13<t[At]>>16&&(3&t[Zi])===n&&(t[Zi]+=8192,A0(f,s)):A0(f,s)}const lp=-1;class Yp{constructor(n,e,i){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function qg(t){return t!==lp}function bu(t){return 32767&t}function Sc(t,n){let e=function cm(t){return t>>16}(t),i=n;for(;e>0;)i=i[J],e--;return i}let Kp=!0;function Wo(t){const n=Kp;return Kp=t,n}const Qp=255,dm=5;let Ry=0;const uh={};function um(t,n){const e=Kc(t,n);if(-1!==e)return e;const i=n[Tn];i.firstCreatePass&&(t.injectorIndex=n.length,pm(i.data,t),pm(n,null),pm(i.blueprint,null));const r=xu(t,n),s=t.injectorIndex;if(qg(r)){const c=bu(r),f=Sc(r,n),y=f[Tn].data;for(let k=0;k<8;k++)n[s+k]=f[c+k]|y[c+k]}return n[s+8]=r,s}function pm(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Kc(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function xu(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,i=null,r=n;for(;null!==r;){if(i=G(r),null===i)return lp;if(e++,r=r[J],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return lp}function cp(t,n,e){!function hm(t,n,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(ud)&&(i=e[ud]),null==i&&(i=e[ud]=Ry++);const r=i&Qp;n.data[t+(r>>dm)]|=1<<r}(t,n,e)}function ph(t,n,e){if(e&Fi.Optional||void 0!==t)return t;Ah()}function _d(t,n,e,i){if(e&Fi.Optional&&void 0===i&&(i=null),!(e&(Fi.Self|Fi.Host))){const r=t[nt],s=bi(void 0);try{return r?r.get(n,i,e&Fi.Optional):Da(n,i,e&Fi.Optional)}finally{bi(s)}}return ph(i,0,e)}function yd(t,n,e,i=Fi.Default,r){if(null!==t){if(2048&n[Zi]&&!(i&Fi.Self)){const c=function X(t,n,e,i,r){let s=t,c=n;for(;null!==s&&null!==c&&2048&c[Zi]&&!(512&c[Zi]);){const f=Hh(s,c,e,i|Fi.Self,uh);if(f!==uh)return f;let y=s.parent;if(!y){const k=c[yr];if(k){const E=k.get(e,uh,i);if(E!==uh)return E}y=G(c),c=c[J]}s=y}return r}(t,n,e,i,uh);if(c!==uh)return c}const s=Hh(t,n,e,i,uh);if(s!==uh)return s}return _d(n,e,i,r)}function Hh(t,n,e,i,r){const s=function h(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(ud)?t[ud]:void 0;return"number"==typeof n?n>=0?n&Qp:O:n}(e);if("function"==typeof s){if(!im(n,t,i))return i&Fi.Host?ph(r,0,i):_d(n,e,i,r);try{let c;if(c=s(i),null!=c||i&Fi.Optional)return c;Ah()}finally{Hg()}}else if("number"==typeof s){let c=null,f=Kc(t,n),y=lp,k=i&Fi.Host?n[fe][ee]:null;for((-1===f||i&Fi.SkipSelf)&&(y=-1===f?xu(t,n):n[f+8],y!==lp&&w(i,!1)?(c=n[Tn],f=bu(y),n=Sc(y,n)):f=-1);-1!==f;){const E=n[Tn];if(_(s,f,E.data)){const F=dp(f,n,e,c,i,k);if(F!==uh)return F}y=n[f+8],y!==lp&&w(i,n[Tn].data[f+8]===k)&&_(s,f,n)?(c=E,f=bu(y),n=Sc(y,n)):f=-1}}return r}function dp(t,n,e,i,r,s){const c=n[Tn],f=c.data[t+8],E=g(f,c,e,null==i?fu(f)&&Kp:i!=c&&0!=(3&f.type),r&Fi.Host&&s===f);return null!==E?a(n,c,E,f):uh}function g(t,n,e,i,r){const s=t.providerIndexes,c=n.data,f=1048575&s,y=t.directiveStart,E=s>>20,$=r?f+E:t.directiveEnd;for(let W=i?f:f+E;W<$;W++){const re=c[W];if(W<y&&e===re||W>=y&&re.type===e)return W}if(r){const W=c[y];if(W&&nc(W)&&W.type===e)return y}return null}function a(t,n,e,i){let r=t[e];const s=n.data;if(function Pb(t){return t instanceof Yp}(r)){const c=r;c.resolving&&function vi(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Ht(-200,`Circular dependency in DI detected for ${t}${e}`)}(function jn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Ui(t)}(s[e]));const f=Wo(c.canSeeViewProviders);c.resolving=!0;const k=c.injectImpl?bi(c.injectImpl):null;im(t,i,Fi.Default);try{r=t[e]=c.factory(void 0,s,t,i),n.firstCreatePass&&e>=i.directiveStart&&function Iy(t,n,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=n.type.prototype;if(i){const c=Ig(n);(e.preOrderHooks??=[]).push(t,c),(e.preOrderCheckHooks??=[]).push(t,c)}r&&(e.preOrderHooks??=[]).push(0-t,r),s&&((e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s))}(e,s[e],n)}finally{null!==k&&bi(k),Wo(f),c.resolving=!1,Hg()}}return r}function _(t,n,e){return!!(e[n+(t>>dm)]&1<<t)}function w(t,n){return!(t&Fi.Self||t&Fi.Host&&n)}class P{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,i){return yd(this._tNode,this._lView,n,dd(i),e)}}function O(){return new P(Ml(),cn())}function V(t){return Ys(()=>{const n=t.prototype.constructor,e=n[Xs]||U(n),i=Object.prototype;let r=Object.getPrototypeOf(t.prototype).constructor;for(;r&&r!==i;){const s=r[Xs]||U(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function U(t){return yc(t)?()=>{const n=U(Ri(t));return n&&n()}:mu(t)}function G(t){const n=t[Tn],e=n.type;return 2===e?n.declTNode:1===e?t[ee]:null}const oe="__parameters__";function Me(t,n,e){return Ys(()=>{const i=function be(t){return function(...e){if(t){const i=t(...e);for(const r in i)this[r]=i[r]}}}(n);function r(...s){if(this instanceof r)return i.apply(this,s),this;const c=new r(...s);return f.annotation=c,f;function f(y,k,E){const F=y.hasOwnProperty(oe)?y[oe]:Object.defineProperty(y,oe,{value:[]})[oe];for(;F.length<=E;)F.push(null);return(F[E]=F[E]||[]).push(c),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r})}function dt(t,n){t.forEach(e=>Array.isArray(e)?dt(e,n):n(e))}function Ot(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function wt(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function It(t,n){const e=[];for(let i=0;i<t;i++)e.push(n);return e}function an(t,n,e){let i=Dn(t,n);return i>=0?t[1|i]=e:(i=~i,function bn(t,n,e,i){let r=t.length;if(r==n)t.push(e,i);else if(1===r)t.push(i,t[0]),t[0]=e;else{for(r--,t.push(t[r-1],t[r]);r>n;)t[r]=t[r-2],r--;t[n]=e,t[n+1]=i}}(t,i,n,e)),i}function mn(t,n){const e=Dn(t,n);if(e>=0)return t[1|e]}function Dn(t,n){return function xi(t,n,e){let i=0,r=t.length>>e;for(;r!==i;){const s=i+(r-i>>1),c=t[s<<e];if(n===c)return s<<e;c>n?r=s:i=s+1}return~(r<<e)}(t,n,1)}const oo=Ds(Me("Optional"),8),vo=Ds(Me("SkipSelf"),4);function L0(t){return 128==(128&t.flags)}var up=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(up||{});const zb=/^>|^->|<!--|-->|--!>|<!-$/g,SM=/(<|>)/g,KS="\u200b$1\u200b";const Nb=new Map;let DM=0;const By="__ngContext__";function rc(t,n){qa(n)?(t[By]=n[Mi],function QS(t){Nb.set(t[Mi],t)}(n)):t[By]=n}let gm;function jy(t,n){return gm(t,n)}function pp(t){const n=t[x];return Ia(n)?n[x]:n}function IM(t){return RM(t[on])}function OM(t){return RM(t[T])}function RM(t){for(;null!==t&&!Ia(t);)t=t[T];return t}function Zg(t,n,e,i,r){if(null!=i){let s,c=!1;Ia(i)?s=i:qa(i)&&(c=!0,i=i[ts]);const f=Yr(i);0===t&&null!==e?null==r?Wy(n,e,f):lf(n,e,f,r||null,!0):1===t&&null!==e?lf(n,e,f,r||null,!0):2===t?function j0(t,n,e){const i=Kg(t,n);i&&function qb(t,n,e,i){t.removeChild(n,e,i)}(t,i,n,e)}(n,f,c):3===t&&n.destroyNode(f),null!=s&&function BM(t,n,e,i,r){const s=e[tc];s!==Yr(e)&&Zg(n,t,i,s,r);for(let f=Ks;f<e.length;f++){const y=e[f];H0(y[Tn],y,t,n,i,s)}}(n,t,s,e,r)}}function Hb(t,n){return t.createComment(function EM(t){return t.replace(zb,n=>n.replace(SM,KS))}(n))}function F0(t,n,e){return t.createElement(n,e)}function N0(t,n){const e=t[ah],i=e.indexOf(n);it(n),e.splice(i,1)}function af(t,n){if(t.length<=Ks)return;const e=Ks+n,i=t[e];if(i){const r=i[Ue];null!==r&&r!==t&&N0(r,i),n>0&&(t[e-1][T]=i[T]);const s=wt(t,Ks+n);!function z0(t,n){H0(t,n,n[yt],2,null,null),n[ts]=null,n[ee]=null}(i[Tn],i);const c=s[xn];null!==c&&c.detachView(s[Tn]),i[x]=null,i[T]=null,i[Zi]&=-129}return i}function $y(t,n){if(!(256&n[Zi])){const e=n[yt];n[fd]&&Dy(n[fd]),n[Wc]&&Dy(n[Wc]),e.destroyNode&&H0(t,n,e,3,null,null),function Yg(t){let n=t[on];if(!n)return Gy(t[Tn],t);for(;n;){let e=null;if(qa(n))e=n[on];else{const i=n[Ks];i&&(e=i)}if(!e){for(;n&&!n[T]&&n!==t;)qa(n)&&Gy(n[Tn],n),n=n[x];null===n&&(n=t),qa(n)&&Gy(n[Tn],n),e=n&&n[T]}n=e}}(n)}}function Gy(t,n){if(!(256&n[Zi])){n[Zi]&=-129,n[Zi]|=256,function Ub(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let i=0;i<e.length;i+=2){const r=n[e[i]];if(!(r instanceof Yp)){const s=e[i+1];if(Array.isArray(s))for(let c=0;c<s.length;c+=2){const f=r[s[c]],y=s[c+1];Zc(4,f,y);try{y.call(f)}finally{Zc(5,f,y)}}else{Zc(4,r,s);try{s.call(r)}finally{Zc(5,r,s)}}}}}(t,n),function B0(t,n){const e=t.cleanup,i=n[pe];if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const c=e[s+3];c>=0?i[c]():i[-c].unsubscribe(),s+=2}else e[s].call(i[e[s+1]]);null!==i&&(n[pe]=null);const r=n[io];if(null!==r){n[io]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(t,n),1===n[Tn].type&&n[yt].destroy();const e=n[Ue];if(null!==e&&Ia(n[x])){e!==n[x]&&N0(e,n);const i=n[xn];null!==i&&i.detachView(t)}!function JS(t){Nb.delete(t[Mi])}(n)}}function Xg(t,n,e){return function FM(t,n,e){let i=n;for(;null!==i&&40&i.type;)i=(n=i).parent;if(null===i)return e[ts];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=t.data[i.directiveStart+r];if(s===Go.None||s===Go.Emulated)return null}return la(i,e)}}(t,n.parent,e)}function lf(t,n,e,i,r){t.insertBefore(n,e,i,r)}function Wy(t,n,e){t.appendChild(n,e)}function Zy(t,n,e,i,r){null!==i?lf(t,n,e,i,r):Wy(t,n,e)}function Kg(t,n){return t.parentNode(n)}function Yy(t,n,e){return Gb(t,n,e)}let Qg,Jb,U0,Gb=function $b(t,n,e){return 40&t.type?la(t,e):null};function V0(t,n,e,i){const r=Xg(t,i,n),s=n[yt],f=Yy(i.parent||n[ee],i,n);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)Zy(s,r,e[y],f,!1);else Zy(s,r,e,f,!1);void 0!==Qg&&Qg(s,i,n,e,r)}function Jg(t,n){if(null!==n){const e=n.type;if(3&e)return la(n,t);if(4&e)return mp(-1,t[n.index]);if(8&e){const i=n.child;if(null!==i)return Jg(t,i);{const r=t[n.index];return Ia(r)?mp(-1,r):Yr(r)}}if(32&e)return jy(n,t)()||Yr(t[n.index]);{const i=fp(t,n);return null!==i?Array.isArray(i)?i[0]:Jg(pp(t[fe]),i):Jg(t,n.next)}}return null}function fp(t,n){return null!==n?t[fe][ee].projection[n.projection]:null}function mp(t,n){const e=Ks+t+1;if(e<n.length){const i=n[e],r=i[Tn].firstChild;if(null!==r)return Jg(i,r)}return n[tc]}function Xy(t,n,e,i,r,s,c){for(;null!=e;){const f=i[e.index],y=e.type;if(c&&0===n&&(f&&rc(Yr(f),i),e.flags|=2),32!=(32&e.flags))if(8&y)Xy(t,n,e.child,i,r,s,!1),Zg(n,t,r,f,s);else if(32&y){const k=jy(e,i);let E;for(;E=k();)Zg(n,t,r,E,s);Zg(n,t,r,f,s)}else 16&y?cf(t,n,i,e,r,s):Zg(n,t,r,f,s);e=c?e.projectionNext:e.next}}function H0(t,n,e,i,r,s){Xy(e,i,t.firstChild,n,r,s,!1)}function cf(t,n,e,i,r,s){const c=e[fe],y=c[ee].projection[i.projection];if(Array.isArray(y))for(let k=0;k<y.length;k++)Zg(n,t,r,y[k],s);else{let k=y;const E=c[x];L0(i)&&(k.flags|=128),Xy(t,n,k,E,r,s,!0)}}function Xb(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function Kb(t,n,e){const{mergedAttrs:i,classes:r,styles:s}=e;null!==i&&xc(t,n,i),null!==r&&Xb(t,n,r),null!==s&&function Yb(t,n,e){t.setAttribute(n,"style",e)}(t,n,s)}function tx(t){return function q0(){if(void 0===U0&&(U0=null,Hn.trustedTypes))try{U0=Hn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return U0}()?.createScriptURL(t)||t}class hf{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Hc})`}}function Zd(t){return t instanceof hf?t.changingThisBreaksApplicationSecurity:t}function Eu(t,n){const e=function uE(t){return t instanceof hf&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${Hc})`)}return e===n}const GM=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var oc=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(oc||{});function fs(t){const n=X0();return n?n.sanitize(oc.URL,t)||"":Eu(t,"URL")?Zd(t):function ev(t){return(t=String(t)).match(GM)?t:"unsafe:"+t}(Ui(t))}function YM(t){const n=X0();if(n)return tx(n.sanitize(oc.RESOURCE_URL,t)||"");if(Eu(t,"ResourceURL"))return tx(Zd(t));throw new Ht(904,!1)}function X0(){const t=cn();return t&&t[St].sanitizer}const t1=new tn("ENVIRONMENT_INITIALIZER"),px=new tn("INJECTOR",-1),uf=new tn("INJECTOR_DEF_TYPES");class ov{get(n,e=$c){if(e===$c){const i=new Error(`NullInjectorError: No provider for ${Ro(n)}!`);throw i.name="NullInjectorError",i}return e}}function JM(...t){return{\u0275providers:K0(0,t),\u0275fromNgModule:!0}}function K0(t,...n){const e=[],i=new Set;let r;const s=c=>{e.push(c)};return dt(n,c=>{const f=c;Q0(f,s,[],i)&&(r||=[],r.push(f))}),void 0!==r&&eC(r,s),e}function eC(t,n){for(let e=0;e<t.length;e++){const{ngModule:i,providers:r}=t[e];lv(r,s=>{n(s,i)})}}function Q0(t,n,e,i){if(!(t=Ri(t)))return!1;let r=null,s=el(t);const c=!s&&Wi(t);if(s||c){if(c&&!c.standalone)return!1;r=t}else{const y=t.ngModule;if(s=el(y),!s)return!1;r=y}const f=i.has(r);if(c){if(f)return!1;if(i.add(r),c.dependencies){const y="function"==typeof c.dependencies?c.dependencies():c.dependencies;for(const k of y)Q0(k,n,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!f){let k;i.add(r);try{dt(s.imports,E=>{Q0(E,n,e,i)&&(k||=[],k.push(E))})}finally{}void 0!==k&&eC(k,n)}if(!f){const k=mu(r)||(()=>new r);n({provide:r,useFactory:k,deps:Er},r),n({provide:uf,useValue:r,multi:!0},r),n({provide:t1,useValue:()=>Dt(r),multi:!0},r)}const y=s.providers;if(null!=y&&!f){const k=t;lv(y,E=>{n(E,k)})}}}return r!==t&&void 0!==t.providers}function lv(t,n){for(let e of t)Es(e)&&(e=e.\u0275providers),Array.isArray(e)?lv(e,n):n(e)}const tC=tr({provide:String,useValue:tr});function fx(t){return null!==t&&"object"==typeof t&&tC in t}function ym(t){return"function"==typeof t}const mx=new tn("Set Injector scope."),cv={},rC={};let gx;function dv(){return void 0===gx&&(gx=new ov),gx}class Yd{}class pf extends Yd{get destroyed(){return this._destroyed}constructor(n,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hv(n,c=>this.processProvider(c)),this.records.set(px,vm(void 0,this)),r.has("environment")&&this.records.set(Yd,vm(void 0,this));const s=this.records.get(mx);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(uf.multi,Er,Fi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const e of n)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const e=vs(this),i=bi(void 0);try{return n()}finally{vs(e),bi(i)}}get(n,e=$c,i=Fi.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(lu))return n[lu](this);i=dd(i);const s=vs(this),c=bi(void 0);try{if(!(i&Fi.SkipSelf)){let y=this.records.get(n);if(void 0===y){const k=function cC(t){return"function"==typeof t||"object"==typeof t&&t instanceof tn}(n)&&Ni(n);y=k&&this.injectableDefInScope(k)?vm(J0(n),cv):null,this.records.set(n,y)}if(null!=y)return this.hydrate(n,y)}return(i&Fi.Self?dv():this.parent).get(n,e=i&Fi.Optional&&e===$c?null:e)}catch(f){if("NullInjectorError"===f.name){if((f[Vo]=f[Vo]||[]).unshift(Ro(n)),s)throw f;return function Bl(t,n,e,i){const r=t[Vo];throw n[oa]&&r.unshift(n[oa]),t.message=function Bd(t,n,e,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let r=Ro(n);if(Array.isArray(n))r=n.map(Ro).join(" -> ");else if("object"==typeof n){let s=[];for(let c in n)if(n.hasOwnProperty(c)){let f=n[c];s.push(c+":"+("string"==typeof f?JSON.stringify(f):Ro(f)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${t.replace(Yn,"\n  ")}`}("\n"+t.message,r,e,i),t.ngTokenPath=r,t[Vo]=null,t}(f,n,"R3InjectorError",this.source)}throw f}finally{bi(c),vs(s)}}resolveInjectorInitializers(){const n=vs(this),e=bi(void 0);try{const r=this.get(t1.multi,Er,Fi.Self);for(const s of r)s()}finally{vs(n),bi(e)}}toString(){const n=[],e=this.records;for(const i of e.keys())n.push(Ro(i));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ht(205,!1)}processProvider(n){let e=ym(n=Ri(n))?n:Ri(n&&n.provide);const i=function sC(t){return fx(t)?vm(void 0,t.useValue):vm(_x(t),cv)}(n);if(ym(n)||!0!==n.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=vm(void 0,cv,!0),r.factory=()=>ds(r.multi),this.records.set(e,r)),e=n,r.multi.push(n)}this.records.set(e,i)}hydrate(n,e){return e.value===cv&&(e.value=rC,e.value=e.factory()),"object"==typeof e.value&&e.value&&function lC(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=Ri(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){const e=this._onDestroyHooks.indexOf(n);-1!==e&&this._onDestroyHooks.splice(e,1)}}function J0(t){const n=Ni(t),e=null!==n?n.factory:mu(t);if(null!==e)return e;if(t instanceof tn)throw new Ht(204,!1);if(t instanceof Function)return function oC(t){const n=t.length;if(n>0)throw It(n,"?"),new Ht(204,!1);const e=function qu(t){return t&&(t[Fd]||t[bl])||null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new Ht(204,!1)}function _x(t,n,e){let i;if(ym(t)){const r=Ri(t);return mu(r)||J0(r)}if(fx(t))i=()=>Ri(t.useValue);else if(function iC(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...ds(t.deps||[]));else if(function nC(t){return!(!t||!t.useExisting)}(t))i=()=>Dt(Ri(t.useExisting));else{const r=Ri(t&&(t.useClass||t.provide));if(!function aC(t){return!!t.deps}(t))return mu(r)||J0(r);i=()=>new r(...ds(t.deps))}return i}function vm(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function hv(t,n){for(const e of t)Array.isArray(e)?hv(e,n):e&&Es(e)?hv(e.\u0275providers,n):n(e)}const n1=new tn("AppId",{providedIn:"root",factory:()=>dC}),dC="ng",hC=new tn("Platform Initializer"),mh=new tn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),r1=new tn("AnimationModuleType"),yx=new tn("CSP nonce",{providedIn:"root",factory:()=>function df(){if(void 0!==Jb)return Jb;if(typeof document<"u")return document;throw new Ht(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let uC=(t,n,e)=>null;function _v(t,n,e=!1){return uC(t,n,e)}class wx{}class kx{}class yC{resolveComponentFactory(n){throw function gC(t){const n=Error(`No component factory found for ${Ro(t)}.`);return n.ngComponent=t,n}(n)}}let wm=(()=>{class t{static{this.NULL=new yC}}return t})();function vC(){return ed(Ml(),cn())}function ed(t,n){return new ns(la(t,n))}let ns=(()=>{class t{constructor(e){this.nativeElement=e}static{this.__NG_ELEMENT_ID__=vC}}return t})();function Mx(t){return t instanceof ns?t.nativeElement:t}class _p{}let sc=(()=>{class t{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function bC(){const t=cn(),e=Yc(Ml().index,t);return(qa(e)?e:t)[yt]}()}}return t})(),xC=(()=>{class t{static{this.\u0275prov=vn({token:t,providedIn:"root",factory:()=>null})}}return t})();class mf{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const wC=new mf("16.2.12"),Cx={};function Mv(t,n=null,e=null,i){const r=Mm(t,n,e,i);return r.resolveInjectorInitializers(),r}function Mm(t,n=null,e=null,i,r=new Set){const s=[e||Er,JM(t)];return i=i||("object"==typeof t?void 0:Ro(t)),new pf(s,n||dv(),i||null,r)}let ws=(()=>{class t{static{this.THROW_IF_NOT_FOUND=$c}static{this.NULL=new ov}static create(e,i){if(Array.isArray(e))return Mv({name:""},i,e,"");{const r=e.name??"";return Mv({name:r},e.parent,e.providers,r)}}static{this.\u0275prov=vn({token:t,providedIn:"any",factory:()=>Dt(px)})}static{this.__NG_ELEMENT_ID__=-1}}return t})();function l1(t){return t.ngOriginalError}class gh{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&l1(n);for(;e&&l1(e);)e=l1(e);return e||null}}function Dx(t){return n=>{setTimeout(t,void 0,n)}}const Xi=class AE extends Sn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,i){let r=n,s=e||(()=>null),c=i;if(n&&"object"==typeof n){const y=n;r=y.next?.bind(y),s=y.error?.bind(y),c=y.complete?.bind(y)}this.__isAsync&&(s=Dx(s),r&&(r=Dx(r)),c&&(c=Dx(c)));const f=super.subscribe({next:r,error:s,complete:c});return n instanceof En&&n.add(f),f}};function SC(...t){}class Mr{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xi(!1),this.onMicrotaskEmpty=new Xi(!1),this.onStable=new Xi(!1),this.onError=new Xi(!1),typeof Zone>"u")throw new Ht(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Tx(){const t="function"==typeof Hn.requestAnimationFrame;let n=Hn[t?"requestAnimationFrame":"setTimeout"],e=Hn[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&e){const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function DC(t){const n=()=>{!function EC(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Hn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Ax(t),t.isCheckStableRunning=!0,Ev(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Ax(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,c,f)=>{if(function gf(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(f))return e.invokeTask(r,s,c,f);try{return Px(t),e.invokeTask(r,s,c,f)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&n(),Dv(t)}},onInvoke:(e,i,r,s,c,f,y)=>{try{return Px(t),e.invoke(r,s,c,f,y)}finally{t.shouldCoalesceRunChangeDetection&&n(),Dv(t)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(t._hasPendingMicrotasks=s.microTask,Ax(t),Ev(t)):"macroTask"==s.change&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Mr.isInAngularZone())throw new Ht(909,!1)}static assertNotInAngularZone(){if(Mr.isInAngularZone())throw new Ht(909,!1)}run(n,e,i){return this._inner.run(n,e,i)}runTask(n,e,i,r){const s=this._inner,c=s.scheduleEventTask("NgZoneEvent: "+r,n,Sv,SC,SC);try{return s.runTask(c,e,i)}finally{s.cancelTask(c)}}runGuarded(n,e,i){return this._inner.runGuarded(n,e,i)}runOutsideAngular(n){return this._outer.run(n)}}const Sv={};function Ev(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Ax(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Px(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Dv(t){t._nesting--,Ev(t)}class PE{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xi,this.onMicrotaskEmpty=new Xi,this.onStable=new Xi,this.onError=new Xi}run(n,e,i){return n.apply(e,i)}runGuarded(n,e,i){return n.apply(e,i)}runOutsideAngular(n){return n()}runTask(n,e,i,r){return n.apply(e,i)}}const TC=new tn("",{providedIn:"root",factory:c1});function c1(){const t=Rn(Mr);let n=!0;return Oo(new Jn(r=>{n=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{r.next(n),r.complete()})}),new Jn(r=>{let s;t.runOutsideAngular(()=>{s=t.onStable.subscribe(()=>{Mr.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(n=!0,r.next(!0))})})});const c=t.onUnstable.subscribe(()=>{Mr.assertInAngularZone(),n&&(n=!1,t.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),c.unsubscribe()}}).pipe(Os()))}function Tv(t){return t.ownerDocument.defaultView}function o_(t){return t.ownerDocument}function yp(t){return t instanceof Function?t():t}let Ix=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static{this.\u0275prov=vn({token:t,providedIn:"root",factory:()=>new t})}}return t})();function bp(t){for(;t;){t[Zi]|=64;const n=pp(t);if(Rp(t)&&!n)return t;t=n}return null}const h1=new tn("",{providedIn:"root",factory:()=>!1});let Pv=null;function Rx(t,n){return t[n]??d_()}function RC(t,n){const e=d_();e.producerNode?.length&&(t[n]=Pv,e.lView=t,Pv=c_())}const FE={...Gf,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{bp(t.lView)},lView:null};function c_(){return Object.create(FE)}function d_(){return Pv??=c_(),Pv}const ar={};function ne(t){LC(Jr(),cn(),ll()+t,!1)}function LC(t,n,e,i){if(!i)if(3==(3&n[Zi])){const s=t.preOrderCheckHooks;null!==s&&am(n,s,e)}else{const s=t.preOrderHooks;null!==s&&Zp(n,s,0,e)}Xc(e)}function st(t,n=Fi.Default){const e=cn();return null===e?Dt(t,n):yd(Ml(),e,Ri(t),n)}function p1(){throw new Error("invalid")}function h_(t,n,e,i,r,s,c,f,y,k,E){const F=n.blueprint.slice();return F[ts]=r,F[Zi]=140|i,(null!==k||t&&2048&t[Zi])&&(F[Zi]|=2048),yu(F),F[x]=F[J]=t,F[Ee]=e,F[St]=c||t&&t[St],F[yt]=f||t&&t[yt],F[nt]=y||t&&t[nt]||null,F[ee]=s,F[Mi]=function TM(){return DM++}(),F[Ua]=E,F[yr]=k,F[fe]=2==n.type?t[fe]:F,F}function Em(t,n,e,i,r){let s=t.data[n];if(null===s)s=function u_(t,n,e,i,r){const s=qp(),c=tm(),y=t.data[n]=function Vv(t,n,e,i,r,s){let c=n?n.injectorIndex:-1,f=0;return Bh()&&(f|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:c,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:f,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,c?s:s&&s.parent,e,n,i,r);return null===t.firstChild&&(t.firstChild=y),null!==s&&(c?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y,y.prev=s)),y}(t,n,e,i,r),function Vh(){return Yi.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const c=function Fr(){const t=Yi.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();s.injectorIndex=null===c?-1:c.injectorIndex}return Ei(s,!0),s}function f1(t,n,e,i){if(0===e)return-1;const r=n.length;for(let s=0;s<e;s++)n.push(i),t.blueprint.push(i),t.data.push(null);return r}function Ov(t,n,e,i,r){const s=Rx(n,fd),c=ll(),f=2&i;try{Xc(-1),f&&n.length>Ar&&LC(t,n,Ar,!1),Zc(f?2:0,r);const k=f?s:null,E=Bp(k);try{null!==k&&(k.dirty=!1),e(i,r)}finally{Rh(k,E)}}finally{f&&null===n[fd]&&RC(n,fd),Xc(c),Zc(f?3:1,r)}}function m1(t,n,e){if(pu(n)){const i=Mc(null);try{const s=n.directiveEnd;for(let c=n.directiveStart;c<s;c++){const f=t.data[c];f.contentQueries&&f.contentQueries(1,e[c],c)}}finally{Mc(i)}}}function Rv(t,n,e){w0()&&(function qC(t,n,e,i){const r=e.directiveStart,s=e.directiveEnd;fu(e)&&function NE(t,n,e){const i=la(n,t),r=Lx(e);let c=16;e.signals?c=4096:e.onPush&&(c=64);const f=Dm(t,h_(t,r,null,c,i,n,null,t[St].rendererFactory.createRenderer(i,e),null,null,null));t[n.index]=f}(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||um(e,n),rc(i,n);const c=e.initialInputs;for(let f=r;f<s;f++){const y=t.data[f],k=a(n,t,f,e);rc(k,n),null!==c&&BE(0,f-r,k,y,0,c),nc(y)&&(Yc(e.index,n)[Ee]=a(n,t,f,e))}}(t,n,e,la(e,n)),64==(64&e.flags)&&p_(t,n,e))}function Lv(t,n,e=la){const i=n.localNames;if(null!==i){let r=n.index+1;for(let s=0;s<i.length;s+=2){const c=i[s+1],f=-1===c?e(n,t):t[c];t[r++]=f}}}function Lx(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Fv(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function Fv(t,n,e,i,r,s,c,f,y,k,E){const F=Ar+i,$=F+r,W=function Fx(t,n){const e=[];for(let i=0;i<n;i++)e.push(i<t?null:ar);return e}(F,$),re="function"==typeof k?k():k;return W[Tn]={type:t,blueprint:W,template:e,queries:null,viewQuery:f,declTNode:n,data:W.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof c?c():c,firstChild:null,schemas:y,consts:re,incompleteFirstPass:!1,ssrId:E}}let zv=t=>null;function Bx(t,n,e,i){for(let r in t)if(t.hasOwnProperty(r)){e=null===e?{}:e;const s=t[r];null===i?zC(e,n,r,s):i.hasOwnProperty(r)&&zC(e,n,i[r],s)}return e}function zC(t,n,e,i){t.hasOwnProperty(e)?t[e].push(n,i):t[e]=[n,i]}function xd(t,n,e,i,r,s,c,f){const y=la(n,e);let E,k=n.inputs;!f&&null!=k&&(E=k[i])?(xp(t,e,E,i,r),fu(n)&&function VC(t,n){const e=Yc(n,t);16&e[Zi]||(e[Zi]|=64)}(e,n.index)):3&n.type&&(i=function BC(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),r=null!=c?c(r,n.value||"",i):r,s.setProperty(y,i,r))}function jv(t,n,e,i){if(w0()){const r=null===i?null:{"":-1},s=function jx(t,n){const e=t.directiveRegistry;let i=null,r=null;if(e)for(let s=0;s<e.length;s++){const c=e[s];if(wc(n,c.selectors,!1))if(i||(i=[]),nc(c))if(null!==c.findHostDirectiveDefs){const f=[];r=r||new Map,c.findHostDirectiveDefs(c,f,r),i.unshift(...f,c),Hv(t,n,f.length)}else i.unshift(c),Hv(t,n,0);else r=r||new Map,c.findHostDirectiveDefs?.(c,i,r),i.push(c)}return null===i?null:[i,r]}(t,e);let c,f;null===s?c=f=null:[c,f]=s,null!==c&&HC(t,n,e,c,r,f),r&&function $C(t,n,e){if(n){const i=t.localNames=[];for(let r=0;r<n.length;r+=2){const s=e[n[r+1]];if(null==s)throw new Ht(-301,!1);i.push(n[r],s)}}}(e,i,r)}e.mergedAttrs=jd(e.mergedAttrs,e.attrs)}function HC(t,n,e,i,r,s){for(let k=0;k<i.length;k++)cp(um(e,n),t,i[k].type);!function Hx(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,i.length);for(let k=0;k<i.length;k++){const E=i[k];E.providersResolver&&E.providersResolver(E)}let c=!1,f=!1,y=f1(t,n,i.length,null);for(let k=0;k<i.length;k++){const E=i[k];e.mergedAttrs=jd(e.mergedAttrs,E.hostAttrs),GC(t,e,n,y,E),Uv(y,E,r),null!==E.contentQueries&&(e.flags|=4),(null!==E.hostBindings||null!==E.hostAttrs||0!==E.hostVars)&&(e.flags|=64);const F=E.type.prototype;!c&&(F.ngOnChanges||F.ngOnInit||F.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),c=!0),!f&&(F.ngOnChanges||F.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),f=!0),y++}!function NC(t,n,e){const r=n.directiveEnd,s=t.data,c=n.attrs,f=[];let y=null,k=null;for(let E=n.directiveStart;E<r;E++){const F=s[E],$=e?e.get(F):null,re=$?$.outputs:null;y=Bx(F.inputs,E,y,$?$.inputs:null),k=Bx(F.outputs,E,k,re);const he=null===y||null===c||Jl(n)?null:VE(y,E,c);f.push(he)}null!==y&&(y.hasOwnProperty("class")&&(n.flags|=8),y.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=f,n.inputs=y,n.outputs=k}(t,e,s)}function p_(t,n,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,c=function Gp(){return Yi.lFrame.currentDirectiveIndex}();try{Xc(s);for(let f=i;f<r;f++){const y=t.data[f],k=n[f];Cl(f),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&vf(y,k)}}finally{Xc(-1),Cl(c)}}function vf(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Hv(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function Uv(t,n,e){if(e){if(n.exportAs)for(let i=0;i<n.exportAs.length;i++)e[n.exportAs[i]]=t;nc(n)&&(e[""]=t)}}function GC(t,n,e,i,r){t.data[i]=r;const s=r.factory||(r.factory=mu(r.type)),c=new Yp(s,nc(r),st);t.blueprint[i]=c,e[i]=c,function Vx(t,n,e,i,r){const s=r.hostBindings;if(s){let c=t.hostBindingOpCodes;null===c&&(c=t.hostBindingOpCodes=[]);const f=~n.index;(function UC(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(c)!=f&&c.push(f),c.push(e,i,s)}}(t,n,i,f1(t,e,r.hostVars,ar),r)}function Au(t,n,e,i,r,s){const c=la(t,n);!function Ux(t,n,e,i,r,s,c){if(null==s)t.removeAttribute(n,r,e);else{const f=null==c?Ui(s):c(s,i||"",r);t.setAttribute(n,r,f,e)}}(n[yt],c,s,t.value,e,i,r)}function BE(t,n,e,i,r,s){const c=s[n];if(null!==c)for(let f=0;f<c.length;)WC(i,e,c[f++],c[f++],c[f++])}function WC(t,n,e,i,r){const s=Mc(null);try{const c=t.inputTransforms;null!==c&&c.hasOwnProperty(i)&&(r=c[i].call(n,r)),null!==t.setInput?t.setInput(n,r,e,i):n[i]=r}finally{Mc(s)}}function VE(t,n,e){let i=null,r=0;for(;r<e.length;){const s=e[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(t.hasOwnProperty(s)){null===i&&(i=[]);const c=t[s];for(let f=0;f<c.length;f+=2)if(c[f]===n){i.push(s,c[f+1],e[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function ZC(t,n,e,i){return[t,!0,!1,n,null,0,i,e,null,null,null]}function qx(t,n){const e=t.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const s=e[i+1];if(-1!==s){const c=t.data[s];ch(e[i]),c.contentQueries(2,n[s],s)}}}function Dm(t,n){return t[on]?t[Y][T]=n:t[on]=n,t[Y]=n,n}function f_(t,n,e){ch(0);const i=Mc(null);try{n(t,e)}finally{Mc(i)}}function $x(t){return t[pe]||(t[pe]=[])}function qv(t){return t.cleanup||(t.cleanup=[])}function Wx(t,n){const e=t[nt],i=e?e.get(gh,null):null;i&&i.handleError(n)}function xp(t,n,e,i,r){for(let s=0;s<e.length;){const c=e[s++],f=e[s++];WC(t.data[c],n[c],i,f,r)}}function wd(t,n,e){const i=_u(n,t);!function Uy(t,n,e){t.setValue(n,e)}(t[yt],i,e)}function YC(t,n){const e=Yc(n,t),i=e[Tn];!function m_(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}(i,e);const r=e[ts];null!==r&&null===e[Ua]&&(e[Ua]=_v(r,e[nt])),Zx(i,e,e[Ee])}function Zx(t,n,e){sp(n);try{const i=t.viewQuery;null!==i&&f_(1,i,e);const r=t.template;null!==r&&Ov(t,n,r,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&qx(t,n),t.staticViewQueries&&f_(2,t.viewQuery,e);const s=t.components;null!==s&&function Yx(t,n){for(let e=0;e<n.length;e++)YC(t,n[e])}(n,s)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{n[Zi]&=-5,dh()}}let g_=(()=>{class t{constructor(){this.all=new Set,this.queue=new Map}create(e,i,r){const s=typeof Zone>"u"?null:Zone.current,c=function Qf(t,n,e){const i=Object.create(Cb);e&&(i.consumerAllowSignalWrites=!0),i.fn=t,i.schedule=n;const r=c=>{i.cleanupFn=c};return i.ref={notify:()=>u0(i),run:()=>{if(i.dirty=!1,i.hasRun&&!p0(i))return;i.hasRun=!0;const c=Bp(i);try{i.cleanupFn(),i.cleanupFn=g0,i.fn(r)}finally{Rh(i,c)}},cleanup:()=>i.cleanupFn()},i.ref}(e,k=>{this.all.has(k)&&this.queue.set(k,s)},r);let f;this.all.add(c),c.notify();const y=()=>{c.cleanup(),f?.(),this.all.delete(c),this.queue.delete(c)};return f=i?.onDestroy(y),{destroy:y}}flush(){if(0!==this.queue.size)for(const[e,i]of this.queue)this.queue.delete(e),i?i.run(()=>e.run()):e.run()}get isQueueEmpty(){return 0===this.queue.size}static{this.\u0275prov=vn({token:t,providedIn:"root",factory:()=>new t})}}return t})();function wp(t,n,e){let i=e?t.styles:null,r=e?t.classes:null,s=0;if(null!==n)for(let c=0;c<n.length;c++){const f=n[c];"number"==typeof f?s=f:1==s?r=Rd(r,f):2==s&&(i=Rd(i,f+": "+n[++c]+";"))}e?t.styles=i:t.stylesWithoutHost=i,e?t.classes=r:t.classesWithoutHost=r}function Tm(t,n,e,i,r=!1){for(;null!==e;){const s=n[e.index];null!==s&&i.push(Yr(s)),Ia(s)&&bf(s,i);const c=e.type;if(8&c)Tm(t,n,e.child,i);else if(32&c){const f=jy(e,n);let y;for(;y=f();)i.push(y)}else if(16&c){const f=fp(n,e);if(Array.isArray(f))i.push(...f);else{const y=pp(n[fe]);Tm(y[Tn],y,f,i,!0)}}e=r?e.projectionNext:e.next}return i}function bf(t,n){for(let e=Ks;e<t.length;e++){const i=t[e],r=i[Tn].firstChild;null!==r&&Tm(i[Tn],i,r,n)}t[tc]!==t[ts]&&n.push(t[tc])}function __(t,n,e,i=!0){const r=n[St],s=r.rendererFactory,c=r.afterRenderEventManager;s.begin?.(),c?.begin();try{Kx(t,n,t.template,e)}catch(y){throw i&&Wx(n,y),y}finally{s.end?.(),r.effectManager?.flush(),c?.end()}}function Kx(t,n,e,i){const r=n[Zi];if(256!=(256&r)){n[St].effectManager?.flush(),sp(n);try{yu(n),function Ng(t){return Yi.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&Ov(t,n,e,2,i);const c=3==(3&r);if(c){const k=t.preOrderCheckHooks;null!==k&&am(n,k,null)}else{const k=t.preOrderHooks;null!==k&&Zp(n,k,0,null),Ug(n,0)}if(function v_(t){for(let n=IM(t);null!==n;n=OM(n)){if(!n[Yu])continue;const e=n[ah];for(let i=0;i<e.length;i++){jo(e[i])}}}(n),y_(n,2),null!==t.contentQueries&&qx(t,n),c){const k=t.contentCheckHooks;null!==k&&am(n,k)}else{const k=t.contentHooks;null!==k&&Zp(n,k,1),Ug(n,1)}!function Iv(t,n){const e=t.hostBindingOpCodes;if(null===e)return;const i=Rx(n,Wc);try{for(let r=0;r<e.length;r++){const s=e[r];if(s<0)Xc(~s);else{const c=s,f=e[++r],y=e[++r];op(f,c),i.dirty=!1;const k=Bp(i);try{y(2,n[c])}finally{Rh(i,k)}}}}finally{null===n[Wc]&&RC(n,Wc),Xc(-1)}}(t,n);const f=t.components;null!==f&&Qx(n,f,0);const y=t.viewQuery;if(null!==y&&f_(2,y,i),c){const k=t.viewCheckHooks;null!==k&&am(n,k)}else{const k=t.viewHooks;null!==k&&Zp(n,k,2),Ug(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[Zi]&=-73,it(n)}finally{dh()}}}function y_(t,n){for(let e=IM(t);null!==e;e=OM(e))for(let i=Ks;i<e.length;i++)KC(e[i],n)}function UE(t,n,e){KC(Yc(n,t),e)}function KC(t,n){if(!function ip(t){return 128==(128&t[Zi])}(t))return;const e=t[Tn],i=t[Zi];if(80&i&&0===n||1024&i||2===n)Kx(e,t,e.template,t[Ee]);else if(t[H]>0){y_(t,1);const r=e.components;null!==r&&Qx(t,r,1)}}function Qx(t,n,e){for(let i=0;i<n.length;i++)UE(t,n[i],e)}class b_{get rootNodes(){const n=this._lView,e=n[Tn];return Tm(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ee]}set context(n){this._lView[Ee]=n}get destroyed(){return 256==(256&this._lView[Zi])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[x];if(Ia(n)){const e=n[8],i=e?e.indexOf(this):-1;i>-1&&(af(n,i),wt(e,i))}this._attachedToViewContainer=!1}$y(this._lView[Tn],this._lView)}onDestroy(n){!function Jf(t,n){if(256==(256&t[Zi]))throw new Ht(911,!1);null===t[io]&&(t[io]=[]),t[io].push(n)}(this._lView,n)}markForCheck(){bp(this._cdRefInjectingView||this._lView)}detach(){this._lView[Zi]&=-129}reattach(){this._lView[Zi]|=128}detectChanges(){__(this._lView[Tn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ht(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ca(t,n){H0(t,n,n[yt],2,null,null)}(this._lView[Tn],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ht(902,!1);this._appRef=n}}class qE extends b_{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;__(n[Tn],n,n[Ee],!1)}checkNoChanges(){}get context(){return null}}class QC extends wm{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Wi(n);return new xf(e,this.ngModule)}}function Jx(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class ew{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,i){i=dd(i);const r=this.injector.get(n,Cx,i);return r!==Cx||e===Cx?r:this.parentInjector.get(n,e,i)}}class xf extends kx{get inputs(){const n=this.componentDef,e=n.inputTransforms,i=Jx(n.inputs);if(null!==e)for(const r of i)e.hasOwnProperty(r.propName)&&(r.transform=e[r.propName]);return i}get outputs(){return Jx(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function hu(t){return t.map(qd).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,i,r){let s=(r=r||this.ngModule)instanceof Yd?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const c=s?new ew(n,s):n,f=c.get(_p,null);if(null===f)throw new Ht(407,!1);const F={rendererFactory:f,sanitizer:c.get(xC,null),effectManager:c.get(g_,null),afterRenderEventManager:c.get(Ix,null)},$=f.createRenderer(null,this.componentDef),W=this.componentDef.selectors[0][0]||"div",re=i?function zx(t,n,e,i){const s=i.get(h1,!1)||e===Go.ShadowDom,c=t.selectRootElement(n,s);return function Nx(t){zv(t)}(c),c}($,i,this.componentDef.encapsulation,c):F0($,W,function x_(t){const n=t.toLowerCase();return"svg"===n?tp:"math"===n?"math":null}(W)),Pe=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Re=null;null!==re&&(Re=_v(re,c,!0));const rt=Fv(0,null,null,1,0,null,null,null,null,null,null),ft=h_(null,rt,null,Pe,null,null,F,$,c,null,Re);let Ct,Vt;sp(ft);try{const sn=this.componentDef;let Qt,Vn=null;sn.findHostDirectiveDefs?(Qt=[],Vn=new Map,sn.findHostDirectiveDefs(sn,Qt,Vn),Qt.push(sn)):Qt=[sn];const Hi=function w_(t,n){const e=t[Tn],i=Ar;return t[i]=n,Em(e,i,2,"#host",null)}(ft,re),fr=function tw(t,n,e,i,r,s,c){const f=r[Tn];!function $v(t,n,e,i){for(const r of t)n.mergedAttrs=jd(n.mergedAttrs,r.hostAttrs);null!==n.mergedAttrs&&(wp(n,n.mergedAttrs,!0),null!==e&&Kb(i,e,n))}(i,t,n,c);let y=null;null!==n&&(y=_v(n,r[nt]));const k=s.rendererFactory.createRenderer(n,e);let E=16;e.signals?E=4096:e.onPush&&(E=64);const F=h_(r,Lx(e),null,E,r[t.index],t,s,k,null,null,y);return f.firstCreatePass&&Hv(f,t,i.length-1),Dm(r,F),r[t.index]=F}(Hi,re,sn,Qt,ft,F,$);Vt=b0(rt,Ar),re&&function iw(t,n,e,i){if(i)xc(t,e,["ng-version",wC.full]);else{const{attrs:r,classes:s}=function kc(t){const n=[],e=[];let i=1,r=2;for(;i<t.length;){let s=t[i];if("string"==typeof s)2===r?""!==s&&n.push(s,t[++i]):8===r&&e.push(s);else{if(!es(r))break;r=s}i++}return{attrs:n,classes:e}}(n.selectors[0]);r&&xc(t,e,r),s&&s.length>0&&Xb(t,e,s.join(" "))}}($,sn,re,i),void 0!==e&&function rw(t,n,e){const i=t.projection=[];for(let r=0;r<n.length;r++){const s=e[r];i.push(null!=s?Array.from(s):null)}}(Vt,this.ngContentSelectors,e),Ct=function nw(t,n,e,i,r,s){const c=Ml(),f=r[Tn],y=la(c,r);HC(f,r,c,e,null,i);for(let E=0;E<e.length;E++)rc(a(r,f,c.directiveStart+E,c),r);p_(f,r,c),y&&rc(y,r);const k=a(r,f,c.directiveStart+c.componentOffset,c);if(t[Ee]=r[Ee]=k,null!==s)for(const E of s)E(k,n);return m1(f,c,t),k}(fr,sn,Qt,Vn,ft,[Gv]),Zx(rt,ft,null)}finally{dh()}return new g1(this.componentType,Ct,ed(Vt,ft),ft,Vt)}}class g1 extends wx{constructor(n,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new qE(r),this.componentType=n}setInput(n,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;const s=this._rootLView;xp(s[Tn],s,r,n,e),this.previousInputValues.set(n,e),bp(Yc(this._tNode.index,s))}}get injector(){return new P(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function Gv(){const t=Ml();sm(cn()[Tn],t)}function Kr(t){let n=function JC(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const i=[t];for(;n;){let r;if(nc(t))r=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Ht(903,!1);r=n.\u0275dir}if(r){if(e){i.push(r);const c=t;c.inputs=Wv(t.inputs),c.inputTransforms=Wv(t.inputTransforms),c.declaredInputs=Wv(t.declaredInputs),c.outputs=Wv(t.outputs);const f=r.hostBindings;f&&GE(t,f);const y=r.viewQuery,k=r.contentQueries;if(y&&t3(t,y),k&&$E(t,k),Ls(t.inputs,r.inputs),Ls(t.declaredInputs,r.declaredInputs),Ls(t.outputs,r.outputs),null!==r.inputTransforms&&(null===c.inputTransforms&&(c.inputTransforms={}),Ls(c.inputTransforms,r.inputTransforms)),nc(r)&&r.data.animation){const E=t.data;E.animation=(E.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let c=0;c<s.length;c++){const f=s[c];f&&f.ngInherit&&f(t),f===Kr&&(e=!1)}}n=Object.getPrototypeOf(n)}!function e3(t){let n=0,e=null;for(let i=t.length-1;i>=0;i--){const r=t[i];r.hostVars=n+=r.hostVars,r.hostAttrs=jd(r.hostAttrs,e=jd(e,r.hostAttrs))}}(i)}function Wv(t){return t===Aa?{}:t===Er?[]:t}function t3(t,n){const e=t.viewQuery;t.viewQuery=e?(i,r)=>{n(i,r),e(i,r)}:n}function $E(t,n){const e=t.contentQueries;t.contentQueries=e?(i,r,s)=>{n(i,r,s),e(i,r,s)}:n}function GE(t,n){const e=t.hostBindings;t.hostBindings=e?(i,r)=>{n(i,r),e(i,r)}:n}function s3(t){const n=t.inputConfig,e={};for(const i in n)if(n.hasOwnProperty(i)){const r=n[i];Array.isArray(r)&&r[2]&&(e[i]=r[2])}t.inputTransforms=e}function Xv(t){return!!sw(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function sw(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Pu(t,n,e){return t[n]=e}function Tc(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function _h(t,n,e,i){const r=Tc(t,n,e);return Tc(t,n+1,i)||r}function wf(t,n,e,i,r){const s=_h(t,n,e,i);return Tc(t,n+2,r)||s}function La(t,n,e,i){const r=cn();return Tc(r,vu(),n)&&(Jr(),Au(bs(),r,t,n,e,i)),La}function Pm(t,n,e,i){return Tc(t,vu(),e)?n+Ui(e)+i:ar}function He(t,n,e,i,r,s,c,f){const y=cn(),k=Jr(),E=t+Ar,F=k.firstCreatePass?function oD(t,n,e,i,r,s,c,f,y){const k=n.consts,E=Em(n,t,4,c||null,nn(k,f));jv(n,e,E,nn(k,y)),sm(n,E);const F=E.tView=Fv(2,E,i,r,s,n.directiveRegistry,n.pipeRegistry,null,n.schemas,k,null);return null!==n.queries&&(n.queries.template(n,E),F.queries=n.queries.embeddedTView(E)),E}(E,k,y,n,e,i,r,s,c):k.data[E];Ei(F,!1);const $=n2(k,y,F,t);ap()&&V0(k,y,$,F),rc($,y),Dm(y,y[E]=ZC($,y,$,F)),il(F)&&Rv(k,y,F),null!=c&&Lv(y,F,f)}let n2=function vh(t,n,e,i){return jh(!0),n[yt].createComment("")};function Fa(t){return np(function zg(){return Yi.lFrame.contextLView}(),Ar+t)}function ye(t,n,e){const i=cn();return Tc(i,vu(),n)&&xd(Jr(),bs(),i,t,n,i[yt],e,!1),ye}function _w(t,n,e,i,r){const c=r?"class":"style";xp(t,e,n.inputs[c],c,i)}function z(t,n,e,i){const r=cn(),s=Jr(),c=Ar+t,f=r[yt],y=s.firstCreatePass?function bh(t,n,e,i,r,s){const c=n.consts,y=Em(n,t,2,i,nn(c,r));return jv(n,e,y,nn(c,s)),null!==y.attrs&&wp(y,y.attrs,!1),null!==y.mergedAttrs&&wp(y,y.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,y),y}(c,s,r,n,e,i):s.data[c],k=r2(s,r,y,f,n,t);r[c]=k;const E=il(y);return Ei(y,!0),Kb(f,k,y),32!=(32&y.flags)&&ap()&&V0(s,r,k,y),0===function Up(){return Yi.lFrame.elementDepthCount}()&&rc(k,r),function Tb(){Yi.lFrame.elementDepthCount++}(),E&&(Rv(s,r,y),m1(s,y,r)),null!==i&&Lv(r,y),z}function B(){let t=Ml();tm()?Gd():(t=t.parent,Ei(t,!1));const n=t;(function k0(t){return Yi.skipHydrationRootTNode===t})(n)&&function em(){Yi.skipHydrationRootTNode=null}(),function Ab(){Yi.lFrame.elementDepthCount--}();const e=Jr();return e.firstCreatePass&&(sm(e,t),pu(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function Ob(t){return 0!=(8&t.flags)}(n)&&_w(e,n,cn(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Xp(t){return 0!=(16&t.flags)}(n)&&_w(e,n,cn(),n.stylesWithoutHost,!1),B}function $e(t,n,e,i){return z(t,n,e,i),B(),$e}let r2=(t,n,e,i,r,s)=>(jh(!0),F0(i,r,function om(){return Yi.lFrame.currentNamespace}()));function kp(t,n,e){const i=cn(),r=Jr(),s=t+Ar,c=r.firstCreatePass?function g3(t,n,e,i,r){const s=n.consts,c=nn(s,i),f=Em(n,t,8,"ng-container",c);return null!==c&&wp(f,c,!0),jv(n,e,f,nn(s,r)),null!==n.queries&&n.queries.elementStart(n,f),f}(s,r,i,n,e):r.data[s];Ei(c,!0);const f=jm(r,i,c,t);return i[s]=f,ap()&&V0(r,i,f,c),rc(f,i),il(c)&&(Rv(r,i,c),m1(r,c,i)),null!=e&&Lv(i,c),kp}function Vm(){let t=Ml();const n=Jr();return tm()?Gd():(t=t.parent,Ei(t,!1)),n.firstCreatePass&&(sm(n,t),pu(t)&&n.queries.elementEnd(t)),Vm}function $l(t,n,e){return kp(t,n,e),Vm(),$l}let jm=(t,n,e,i)=>(jh(!0),Hb(n[yt],""));function Ki(){return cn()}function v1(t){return!!t&&"function"==typeof t.then}function I_(t){return!!t&&"function"==typeof t.subscribe}function qt(t,n,e,i){const r=cn(),s=Jr(),c=Ml();return function s2(t,n,e,i,r,s,c){const f=il(i),k=t.firstCreatePass&&qv(t),E=n[Ee],F=$x(n);let $=!0;if(3&i.type||c){const he=la(i,n),me=c?c(he):he,Pe=F.length,Re=c?ft=>c(Yr(ft[i.index])):i.index;let rt=null;if(!c&&f&&(rt=function _3(t,n,e,i){const r=t.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const c=r[s];if(c===e&&r[s+1]===i){const f=n[pe],y=r[s+2];return f.length>y?f[y]:null}"string"==typeof c&&(s+=2)}return null}(t,n,r,i.index)),null!==rt)(rt.__ngLastListenerFn__||rt).__ngNextListenerFn__=s,rt.__ngLastListenerFn__=s,$=!1;else{s=O_(i,n,E,s,!1);const ft=e.listen(me,r,s);F.push(s,ft),k&&k.push(r,Re,Pe,Pe+1)}}else s=O_(i,n,E,s,!1);const W=i.outputs;let re;if($&&null!==W&&(re=W[r])){const he=re.length;if(he)for(let me=0;me<he;me+=2){const Ct=n[re[me]][re[me+1]].subscribe(s),Vt=F.length;F.push(s,Ct),k&&k.push(r,i.index,Vt,-(Vt+1))}}}(s,r,r[yt],c,t,n,i),qt}function y3(t,n,e,i){try{return Zc(6,n,e),!1!==e(i)}catch(r){return Wx(t,r),!1}finally{Zc(7,n,e)}}function O_(t,n,e,i,r){return function s(c){if(c===Function)return i;bp(t.componentOffset>-1?Yc(t.index,n):n);let y=y3(n,e,i,c),k=s.__ngNextListenerFn__;for(;k;)y=y3(n,e,k,c)&&y,k=k.__ngNextListenerFn__;return r&&!1===y&&c.preventDefault(),y}}function ht(t=1){return function rm(t){return(Yi.lFrame.contextLView=function S0(t,n){for(;t>0;)n=n[J],t--;return n}(t,Yi.lFrame.contextLView))[Ee]}(t)}function v3(t,n){let e=null;const i=function Wu(t){const n=t.attrs;if(null!=n){const e=n.indexOf(5);if(!(1&e))return n[e+1]}return null}(t);for(let r=0;r<n.length;r++){const s=n[r];if("*"!==s){if(null===i?wc(t,s,!0):du(i,s))return r}else e=r}return e}function R_(t,n,e){return c2(t,"",n,"",e),R_}function c2(t,n,e,i,r){const s=cn(),c=Pm(s,n,e,i);return c!==ar&&xd(Jr(),bs(),s,t,c,s[yt],r,!1),c2}function h2(t,n){return t<<17|n<<2}function Mp(t){return t>>17&32767}function u2(t){return 2|t}function Hm(t){return(131068&t)>>2}function Cf(t,n){return-131069&t|n<<2}function p2(t){return 1|t}function kw(t,n,e,i,r){const s=t[e+1],c=null===n;let f=i?Mp(s):Hm(s),y=!1;for(;0!==f&&(!1===y||c);){const E=t[f+1];L_(t[f],n)&&(y=!0,t[f+1]=i?p2(E):u2(E)),f=i?Mp(E):Hm(E)}y&&(t[e+1]=i?u2(s):p2(s))}function L_(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Dn(t,n)>=0}function Z(t,n){return function ve(t,n,e,i){const r=cn(),s=Jr(),c=al(2);s.firstUpdatePass&&function we(t,n,e,i){const r=t.data;if(null===r[e+1]){const s=r[ll()],c=function _e(t,n){return n>=t.expandoStartIndex}(t,e);(function Bt(t,n){return 0!=(t.flags&(n?8:16))})(s,i)&&null===n&&!c&&(n=!1),n=function Ce(t,n,e,i){const r=function gd(t){const n=Yi.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let s=i?n.residualClasses:n.residualStyles;if(null===r)0===(i?n.classBindings:n.styleBindings)&&(e=pt(e=Xe(null,t,n,e,i),n.attrs,i),s=null);else{const c=n.directiveStylingLast;if(-1===c||t[c]!==r)if(e=Xe(r,t,n,e,i),null===s){let y=function ze(t,n,e){const i=e?n.classBindings:n.styleBindings;if(0!==Hm(i))return t[Mp(i)]}(t,n,i);void 0!==y&&Array.isArray(y)&&(y=Xe(null,t,n,y[1],i),y=pt(y,n.attrs,i),function qe(t,n,e,i){t[Mp(e?n.classBindings:n.styleBindings)]=i}(t,n,i,y))}else s=function Ze(t,n,e){let i;const r=n.directiveEnd;for(let s=1+n.directiveStylingLast;s<r;s++)i=pt(i,t[s].hostAttrs,e);return pt(i,n.attrs,e)}(t,n,i)}return void 0!==s&&(i?n.residualClasses=s:n.residualStyles=s),e}(r,s,n,i),function xw(t,n,e,i,r,s){let c=s?n.classBindings:n.styleBindings,f=Mp(c),y=Hm(c);t[i]=e;let E,k=!1;if(Array.isArray(e)?(E=e[1],(null===E||Dn(e,E)>0)&&(k=!0)):E=e,r)if(0!==y){const $=Mp(t[f+1]);t[i+1]=h2($,f),0!==$&&(t[$+1]=Cf(t[$+1],i)),t[f+1]=function lD(t,n){return 131071&t|n<<17}(t[f+1],i)}else t[i+1]=h2(f,0),0!==f&&(t[f+1]=Cf(t[f+1],i)),f=i;else t[i+1]=h2(y,0),0===f?f=i:t[y+1]=Cf(t[y+1],i),y=i;k&&(t[i+1]=u2(t[i+1])),kw(t,E,i,!0),kw(t,E,i,!1),function ww(t,n,e,i,r){const s=r?t.residualClasses:t.residualStyles;null!=s&&"string"==typeof n&&Dn(s,n)>=0&&(e[i+1]=p2(e[i+1]))}(n,E,t,i,s),c=h2(f,y),s?n.classBindings=c:n.styleBindings=c}(r,s,n,e,c,i)}}(s,t,c,i),n!==ar&&Tc(r,c,n)&&function ut(t,n,e,i,r,s,c,f){if(!(3&n.type))return;const y=t.data,k=y[f+1],E=function M3(t){return 1==(1&t)}(k)?Et(y,n,e,r,Hm(k),c):void 0;lt(E)||(lt(s)||function aD(t){return 2==(2&t)}(k)&&(s=Et(y,null,e,r,f,c)),function Zb(t,n,e,i,r){if(n)r?t.addClass(e,i):t.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:up.DashCase;null==r?t.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=up.Important),t.setStyle(e,i,r,s))}}(i,c,_u(ll(),e),r,s))}(s,s.data[ll()],r,r[yt],t,r[c+1]=function gt(t,n){return null==t||""===t||("string"==typeof n?t+=n:"object"==typeof t&&(t=Ro(Zd(t)))),t}(n,e),i,c)}(t,n,null,!0),Z}function Xe(t,n,e,i,r){let s=null;const c=e.directiveEnd;let f=e.directiveStylingLast;for(-1===f?f=e.directiveStart:f++;f<c&&(s=n[f],i=pt(i,s.hostAttrs,r),s!==t);)f++;return null!==t&&(e.directiveStylingLast=f),i}function pt(t,n,e){const i=e?1:2;let r=-1;if(null!==n)for(let s=0;s<n.length;s++){const c=n[s];"number"==typeof c?r=c:r===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),an(t,c,!!e||n[++s]))}return void 0===t?null:t}function Et(t,n,e,i,r,s){const c=null===n;let f;for(;r>0;){const y=t[r],k=Array.isArray(y),E=k?y[1]:y,F=null===E;let $=e[r+1];$===ar&&($=F?Er:void 0);let W=F?mn($,i):E===i?$:void 0;if(k&&!lt(W)&&(W=mn(y,i)),lt(W)&&(f=W,c))return f;const re=t[r+1];r=c?Mp(re):Hm(re)}if(null!==n){let y=s?n.residualClasses:n.residualStyles;null!=y&&(f=mn(y,i))}return f}function lt(t){return void 0!==t}function q(t,n=""){const e=cn(),i=Jr(),r=t+Ar,s=i.firstCreatePass?Em(i,r,1,n,null):i.data[r],c=gn(i,e,s,n,t);e[r]=c,ap()&&V0(i,e,c,s),Ei(s,!1)}let gn=(t,n,e,i,r)=>(jh(!0),function Hy(t,n){return t.createText(n)}(n[yt],i));function Qe(t){return Ft("",t,""),Qe}function Ft(t,n,e){const i=cn(),r=Pm(i,t,n,e);return r!==ar&&wd(i,ll(),r),Ft}function Yt(t,n,e,i,r){const s=cn(),c=function Im(t,n,e,i,r,s){const f=_h(t,Cc(),e,r);return al(2),f?n+Ui(e)+i+Ui(r)+s:ar}(s,t,n,e,i,r);return c!==ar&&wd(s,ll(),c),Yt}function un(t,n,e,i,r,s,c){const f=cn(),y=function Om(t,n,e,i,r,s,c,f){const k=wf(t,Cc(),e,r,c);return al(3),k?n+Ui(e)+i+Ui(r)+s+Ui(c)+f:ar}(f,t,n,e,i,r,s,c);return y!==ar&&wd(f,ll(),y),un}function In(t,n,e){const i=cn();return Tc(i,vu(),n)&&xd(Jr(),bs(),i,t,n,i[yt],e,!0),In}const br=void 0;var to=["en",[["a","p"],["AM","PM"],br],[["AM","PM"],br,br],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],br,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],br,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",br,"{1} 'at' {0}",br],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function zo(t){const e=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let Zo={};function Br(t){const n=function Ts(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=za(n);if(e)return e;const i=n.split("-")[0];if(e=za(i),e)return e;if("en"===i)return to;throw new Ht(701,!1)}function za(t){return t in Zo||(Zo[t]=Hn.ng&&Hn.ng.common&&Hn.ng.common.locales&&Hn.ng.common.locales[t]),Zo[t]}var xo=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(xo||{});const da="en-US";let C3=da;function pD(t,n,e,i,r){if(t=Ri(t),Array.isArray(t))for(let s=0;s<t.length;s++)pD(t[s],n,e,i,r);else{const s=Jr(),c=cn(),f=Ml();let y=ym(t)?t:Ri(t.provide);const k=_x(t),E=1048575&f.providerIndexes,F=f.directiveStart,$=f.providerIndexes>>20;if(ym(t)||!t.multi){const W=new Yp(k,r,st),re=mD(y,n,r?E:E+$,F);-1===re?(cp(um(f,c),s,y),fD(s,t,n.length),n.push(y),f.directiveStart++,f.directiveEnd++,r&&(f.providerIndexes+=1048576),e.push(W),c.push(W)):(e[re]=W,c[re]=W)}else{const W=mD(y,n,E+$,F),re=mD(y,n,E,E+$),me=re>=0&&e[re];if(r&&!me||!r&&!(W>=0&&e[W])){cp(um(f,c),s,y);const Pe=function Iq(t,n,e,i,r){const s=new Yp(t,e,st);return s.multi=[],s.index=n,s.componentProviders=0,vO(s,r,i&&!e),s}(r?Pq:Aq,e.length,r,i,k);!r&&me&&(e[re].providerFactory=Pe),fD(s,t,n.length,0),n.push(y),f.directiveStart++,f.directiveEnd++,r&&(f.providerIndexes+=1048576),e.push(Pe),c.push(Pe)}else fD(s,t,W>-1?W:re,vO(e[r?re:W],k,!r&&i));!r&&i&&me&&e[re].componentProviders++}}}function fD(t,n,e,i){const r=ym(n),s=function xE(t){return!!t.useClass}(n);if(r||s){const y=(s?Ri(n.useClass):n).prototype.ngOnDestroy;if(y){const k=t.destroyHooks||(t.destroyHooks=[]);if(!r&&n.multi){const E=k.indexOf(e);-1===E?k.push(e,[i,y]):k[E+1].push(i,y)}else k.push(e,y)}}}function vO(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function mD(t,n,e,i){for(let r=e;r<i;r++)if(n[r]===t)return r;return-1}function Aq(t,n,e,i){return gD(this.multi,[])}function Pq(t,n,e,i){const r=this.multi;let s;if(this.providerFactory){const c=this.providerFactory.componentProviders,f=a(e,e[Tn],this.providerFactory.index,i);s=f.slice(0,c),gD(r,s);for(let y=c;y<f.length;y++)s.push(f[y])}else s=[],gD(r,s);return s}function gD(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function Vs(t,n=[]){return e=>{e.providersResolver=(i,r)=>function Tq(t,n,e){const i=Jr();if(i.firstCreatePass){const r=nc(t);pD(e,i.data,i.blueprint,r,!0),pD(n,i.data,i.blueprint,r,!1)}}(i,r?r(t):t,n)}}class F_{}class bO{}class _D extends F_{constructor(n,e,i){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new QC(this);const r=Pa(n);this._bootstrapComponents=yp(r.bootstrap),this._r3Injector=Mm(n,e,[{provide:F_,useValue:this},{provide:wm,useValue:this.componentFactoryResolver},...i],Ro(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class yD extends bO{constructor(n){super(),this.moduleType=n}create(n){return new _D(this.moduleType,n,[])}}class xO extends F_{constructor(n){super(),this.componentFactoryResolver=new QC(this),this.instance=null;const e=new pf([...n.providers,{provide:F_,useValue:this},{provide:wm,useValue:this.componentFactoryResolver}],n.parent||dv(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function vD(t,n,e=null){return new xO({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}let Lq=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const i=K0(0,e.type),r=i.length>0?vD([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=vn({token:t,providedIn:"environment",factory:()=>new t(Dt(Yd))})}}return t})();function wO(t){t.getStandaloneInjector=n=>n.get(Lq).getOrCreateStandaloneInjector(t)}function x1(t,n,e){const i=sl()+t,r=cn();return r[i]===ar?Pu(r,i,e?n.call(e):n()):function k_(t,n){return t[n]}(r,i)}function Gr(t,n,e,i){return TO(cn(),sl(),t,n,e,i)}function z_(t,n,e,i,r){return AO(cn(),sl(),t,n,e,i,r)}function Pw(t,n,e,i,r,s){return PO(cn(),sl(),t,n,e,i,r,s)}function Iw(t,n){const e=t[n];return e===ar?void 0:e}function TO(t,n,e,i,r,s){const c=n+e;return Tc(t,c,r)?Pu(t,c+1,s?i.call(s,r):i(r)):Iw(t,c+1)}function AO(t,n,e,i,r,s,c){const f=n+e;return _h(t,f,r,s)?Pu(t,f+2,c?i.call(c,r,s):i(r,s)):Iw(t,f+2)}function PO(t,n,e,i,r,s,c,f){const y=n+e;return wf(t,y,r,s,c)?Pu(t,y+3,f?i.call(f,r,s,c):i(r,s,c)):Iw(t,y+3)}function IO(t,n,e,i,r,s,c,f,y){const k=n+e;return function yh(t,n,e,i,r,s){const c=_h(t,n,e,i);return _h(t,n+2,r,s)||c}(t,k,r,s,c,f)?Pu(t,k+4,y?i.call(y,r,s,c,f):i(r,s,c,f)):Iw(t,k+4)}function ks(t,n){const e=Jr();let i;const r=t+Ar;e.firstCreatePass?(i=function Xq(t,n){if(n)for(let e=n.length-1;e>=0;e--){const i=n[e];if(t===i.name)return i}}(n,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=mu(i.type)),f=bi(st);try{const y=Wo(!1),k=s();return Wo(y),function qh(t,n,e,i){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=i}(e,cn(),r,k),k}finally{bi(f)}}function Iu(t,n,e){const i=t+Ar,r=cn(),s=np(r,i);return Ow(r,i)?TO(r,sl(),n,s.transform,e,s):s.transform(e)}function Xd(t,n,e,i){const r=t+Ar,s=cn(),c=np(s,r);return Ow(s,r)?AO(s,sl(),n,c.transform,e,i,c):c.transform(e,i)}function xD(t,n,e,i,r){const s=t+Ar,c=cn(),f=np(c,s);return Ow(c,s)?PO(c,sl(),n,f.transform,e,i,r,f):f.transform(e,i,r)}function Ow(t,n){return t[Tn].data[n].pure}function Qq(){return this._results[Symbol.iterator]()}class Rw{get changes(){return this._changes||(this._changes=new Xi)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Rw.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=Qq)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const i=this;i.dirty=!1;const r=function xt(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Ke(t,n,e){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++){let r=t[i],s=n[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function e$(t,n,e,i=!0){const r=n[Tn];if(function LM(t,n,e,i){const r=Ks+i,s=e.length;i>0&&(e[r-1][T]=n),i<s-Ks?(n[T]=e[r],Ot(e,Ks+i,n)):(e.push(n),n[T]=null),n[x]=e;const c=n[Ue];null!==c&&e!==c&&function qy(t,n){const e=t[ah];n[fe]!==n[x][x][fe]&&(t[Yu]=!0),null===e?t[ah]=[n]:e.push(n)}(c,n);const f=n[xn];null!==f&&f.insertView(t),n[Zi]|=128}(r,n,t,e),i){const s=mp(e,t),c=n[yt],f=Kg(c,t[tc]);null!==f&&function sE(t,n,e,i,r,s){i[ts]=r,i[ee]=n,H0(t,i,e,1,r,s)}(r,t[ee],c,n,f,s)}}let Ef=(()=>{class t{static{this.__NG_ELEMENT_ID__=i$}}return t})();const t$=Ef,n$=class extends t${constructor(n,e,i){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,i){const r=function Jq(t,n,e,i){const r=n.tView,f=h_(t,r,e,4096&t[Zi]?4096:16,null,n,null,null,null,i?.injector??null,i?.hydrationInfo??null);f[Ue]=t[n.index];const k=t[xn];return null!==k&&(f[xn]=k.createEmbeddedView(r)),Zx(r,f,e),f}(this._declarationLView,this._declarationTContainer,n,{injector:e,hydrationInfo:i});return new b_(r)}};function i$(){return T3(Ml(),cn())}function T3(t,n){return 4&t.type?new n$(n,t,ed(t,n)):null}let Ou=(()=>{class t{static{this.__NG_ELEMENT_ID__=c$}}return t})();function c$(){return jO(Ml(),cn())}const d$=Ou,BO=class extends d${constructor(n,e,i){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=i}get element(){return ed(this._hostTNode,this._hostLView)}get injector(){return new P(this._hostTNode,this._hostLView)}get parentInjector(){const n=xu(this._hostTNode,this._hostLView);if(qg(n)){const e=Sc(n,this._hostLView),i=bu(n);return new P(e[Tn].data[i+8],e)}return new P(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=VO(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-Ks}createEmbeddedView(n,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const f=n.createEmbeddedViewImpl(e||{},s,null);return this.insertImpl(f,r,false),f}createComponent(n,e,i,r,s){const c=n&&!function ot(t){return"function"==typeof t}(n);let f;if(c)f=e;else{const he=e||{};f=he.index,i=he.injector,r=he.projectableNodes,s=he.environmentInjector||he.ngModuleRef}const y=c?n:new xf(Wi(n)),k=i||this.parentInjector;if(!s&&null==y.ngModule){const me=(c?k:this.parentInjector).get(Yd,null);me&&(s=me)}Wi(y.componentType??{});const W=y.create(k,r,null,s);return this.insertImpl(W.hostView,f,false),W}insert(n,e){return this.insertImpl(n,e,!1)}insertImpl(n,e,i){const r=n._lView;if(function Ut(t){return Ia(t[x])}(r)){const y=this.indexOf(n);if(-1!==y)this.detach(y);else{const k=r[x],E=new BO(k,k[ee],k[x]);E.detach(E.indexOf(n))}}const c=this._adjustIndex(e),f=this._lContainer;return e$(f,r,c,!i),n.attachToViewContainerRef(),Ot(wD(f),c,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=VO(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),i=af(this._lContainer,e);i&&(wt(wD(this._lContainer),e),$y(i[Tn],i))}detach(n){const e=this._adjustIndex(n,-1),i=af(this._lContainer,e);return i&&null!=wt(wD(this._lContainer),e)?new b_(i):null}_adjustIndex(n,e=0){return n??this.length+e}};function VO(t){return t[8]}function wD(t){return t[8]||(t[8]=[])}function jO(t,n){let e;const i=n[t.index];return Ia(i)?e=i:(e=ZC(i,n,null,t),n[t.index]=e,Dm(n,e)),HO(e,n,t,i),new BO(e,t,n)}let HO=function UO(t,n,e,i){if(t[tc])return;let r;r=8&e.type?Yr(i):function h$(t,n){const e=t[yt],i=e.createComment(""),r=la(n,t);return lf(e,Kg(e,r),i,function zM(t,n){return t.nextSibling(n)}(e,r),!1),i}(n,e),t[tc]=r};class kD{constructor(n){this.queryList=n,this.matches=null}clone(){return new kD(this.queryList)}setDirty(){this.queryList.setDirty()}}class MD{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const i=null!==n.contentQueries?n.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const c=e.getByIndex(s);r.push(this.queries[c.indexInDeclarationView].clone())}return new MD(r)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==ZO(n,e).matches&&this.queries[e].setDirty()}}class qO{constructor(n,e,i=null){this.predicate=n,this.flags=e,this.read=i}}class CD{constructor(n=[]){this.queries=n}elementStart(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(n,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new CD(e):null}template(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class SD{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new SD(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=n.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(n,e,f$(e,s)),this.matchTNodeWithReadOption(n,e,g(e,n,s,!1,!1))}else i===Ef?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,g(e,n,i,!1,!1))}matchTNodeWithReadOption(n,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===ns||r===Ou||r===Ef&&4&e.type)this.addMatch(e.index,-2);else{const s=g(e,n,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function f$(t,n){const e=t.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===n)return e[i+1];return null}function g$(t,n,e,i){return-1===e?function m$(t,n){return 11&t.type?ed(t,n):4&t.type?T3(t,n):null}(n,t):-2===e?function _$(t,n,e){return e===ns?ed(n,t):e===Ef?T3(n,t):e===Ou?jO(n,t):void 0}(t,n,i):a(t,t[Tn],e,n)}function $O(t,n,e,i){const r=n[xn].queries[i];if(null===r.matches){const s=t.data,c=e.matches,f=[];for(let y=0;y<c.length;y+=2){const k=c[y];f.push(k<0?null:g$(n,s[k],c[y+1],e.metadata.read))}r.matches=f}return r.matches}function ED(t,n,e,i){const r=t.queries.getByIndex(e),s=r.matches;if(null!==s){const c=$O(t,n,r,e);for(let f=0;f<s.length;f+=2){const y=s[f];if(y>0)i.push(c[f/2]);else{const k=s[f+1],E=n[-y];for(let F=Ks;F<E.length;F++){const $=E[F];$[Ue]===$[x]&&ED($[Tn],$,k,i)}if(null!==E[ah]){const F=E[ah];for(let $=0;$<F.length;$++){const W=F[$];ED(W[Tn],W,k,i)}}}}}return i}function js(t){const n=cn(),e=Jr(),i=Bg();ch(i+1);const r=ZO(e,i);if(t.dirty&&function Hp(t){return 4==(4&t[Zi])}(n)===(2==(2&r.metadata.flags))){if(null===r.matches)t.reset([]);else{const s=r.crossesNgTemplate?ED(e,n,i,[]):$O(e,n,r,i);t.reset(s,Mx),t.notifyOnChanges()}return!0}return!1}function Df(t,n,e){const i=Jr();i.firstCreatePass&&(WO(i,new qO(t,n,e),-1),2==(2&n)&&(i.staticViewQueries=!0)),GO(i,cn(),n)}function Ac(t,n,e,i){const r=Jr();if(r.firstCreatePass){const s=Ml();WO(r,new qO(n,e,i),s.index),function v$(t,n){const e=t.contentQueries||(t.contentQueries=[]);n!==(e.length?e[e.length-1]:-1)&&e.push(t.queries.length-1,n)}(r,t),2==(2&e)&&(r.staticContentQueries=!0)}GO(r,cn(),e)}function Hs(){return function y$(t,n){return t[xn].queries[n].queryList}(cn(),Bg())}function GO(t,n,e){const i=new Rw(4==(4&e));(function FC(t,n,e,i){const r=$x(n);r.push(e),t.firstCreatePass&&qv(t).push(i,r.length-1)})(t,n,i,i.destroy),null===n[xn]&&(n[xn]=new MD),n[xn].queries.push(new kD(i))}function WO(t,n,e){null===t.queries&&(t.queries=new CD),t.queries.track(new SD(n,e))}function ZO(t,n){return t.queries.getByIndex(n)}function Tf(t,n){return T3(t,n)}const OD=new tn("Application Initializer");let RD=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i}),this.appInits=Rn(OD,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const e=[];for(const r of this.appInits){const s=r();if(v1(s))e.push(s);else if(I_(s)){const c=new Promise((f,y)=>{s.subscribe({complete:f,error:y})});e.push(c)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),u8=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();const Af=new tn("LocaleId",{providedIn:"root",factory:()=>Rn(Af,Fi.Optional|Fi.SkipSelf)||function V$(){return typeof $localize<"u"&&$localize.locale||da}()}),j$=new tn("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let I3=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Is(!1)}add(){this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class U${constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let p8=(()=>{class t{compileModuleSync(e){return new yD(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=yp(Pa(e).declarations).reduce((c,f)=>{const y=Wi(f);return y&&c.push(new xf(y)),c},[]);return new U$(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const _8=new tn(""),R3=new tn("");let BD,zD=(()=>{class t{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,BD||(function hG(t){BD=t}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Mr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(c=>c.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}static{this.\u0275fac=function(i){return new(i||t)(Dt(Mr),Dt(ND),Dt(R3))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})(),ND=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){return BD?.findTestabilityInTree(this,e,i)??null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})(),w1=null;const y8=new tn("AllowMultipleToken"),VD=new tn("PlatformDestroyListeners"),jD=new tn("appBootstrapListener");class b8{constructor(n,e){this.name=n,this.token=e}}function w8(t,n,e=[]){const i=`Platform: ${n}`,r=new tn(i);return(s=[])=>{let c=HD();if(!c||c.injector.get(y8,!1)){const f=[...e,...s,{provide:r,useValue:!0}];t?t(f):function fG(t){if(w1&&!w1.get(y8,!1))throw new Ht(400,!1);(function v8(){!function jp(t){Xf=t}(()=>{throw new Ht(600,!1)})})(),w1=t;const n=t.get(M8);(function x8(t){t.get(hC,null)?.forEach(e=>e())})(t)}(function k8(t=[],n){return ws.create({name:n,providers:[{provide:mx,useValue:"platform"},{provide:VD,useValue:new Set([()=>w1=null])},...t]})}(f,i))}return function gG(t){const n=HD();if(!n)throw new Ht(401,!1);return n}()}}function HD(){return w1?.get(M8)??null}let M8=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function _G(t="zone.js",n){return"noop"===t?new PE:"zone.js"===t?new Mr(n):t}(i?.ngZone,function C8(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const s=function Rq(t,n,e){return new _D(t,n,e)}(e.moduleType,this.injector,function A8(t){return[{provide:Mr,useFactory:t},{provide:t1,multi:!0,useFactory:()=>{const n=Rn(vG,{optional:!0});return()=>n.initialize()}},{provide:T8,useFactory:yG},{provide:TC,useFactory:c1}]}(()=>r)),c=s.injector.get(gh,null);return r.runOutsideAngular(()=>{const f=r.onError.subscribe({next:y=>{c.handleError(y)}});s.onDestroy(()=>{L3(this._modules,s),f.unsubscribe()})}),function S8(t,n,e){try{const i=e();return v1(i)?i.catch(r=>{throw n.runOutsideAngular(()=>t.handleError(r)),r}):i}catch(i){throw n.runOutsideAngular(()=>t.handleError(i)),i}}(c,r,()=>{const f=s.injector.get(RD);return f.runInitializers(),f.donePromise.then(()=>(function dD(t){Va(t,"Expected localeId to be defined"),"string"==typeof t&&(C3=t.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Af,da)||da),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,i=[]){const r=E8({},i);return function uG(t,n,e){const i=new yD(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(k1);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Ht(-403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ht(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(VD,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static{this.\u0275fac=function(i){return new(i||t)(Dt(ws))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();function E8(t,n){return Array.isArray(n)?n.reduce(E8,t):{...t,...n}}let k1=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Rn(T8),this.zoneIsStable=Rn(TC),this.componentTypes=[],this.components=[],this.isStable=Rn(I3).hasPendingTasks.pipe($o(e=>e?Un(!1):this.zoneIsStable),na(),Os()),this._injector=Rn(Yd)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof kx;if(!this._injector.get(RD).done)throw!r&&function ec(t){const n=Wi(t)||zs(t)||aa(t);return null!==n&&n.standalone}(e),new Ht(405,!1);let c;c=r?e:this._injector.get(wm).resolveComponentFactory(e),this.componentTypes.push(c.componentType);const f=function pG(t){return t.isBoundToModule}(c)?void 0:this._injector.get(F_),k=c.create(ws.NULL,[],i||c.selector,f),E=k.location.nativeElement,F=k.injector.get(_8,null);return F?.registerApplication(E),k.onDestroy(()=>{this.detachView(k.hostView),L3(this.components,k),F?.unregisterApplication(E)}),this._loadComponent(k),k}tick(){if(this._runningTick)throw new Ht(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this.internalErrorHandler(e)}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;L3(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const i=this._injector.get(jD,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>L3(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ht(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function L3(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}const T8=new tn("",{providedIn:"root",factory:()=>Rn(gh).handleError.bind(void 0)});function yG(){const t=Rn(Mr),n=Rn(gh);return e=>t.runOutsideAngular(()=>n.handleError(e))}let vG=(()=>{class t{constructor(){this.zone=Rn(Mr),this.applicationRef=Rn(k1)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();let Pf=(()=>{class t{static{this.__NG_ELEMENT_ID__=xG}}return t})();function xG(t){return function wG(t,n,e){if(fu(t)&&!e){const i=Yc(t.index,n);return new b_(i,i)}return 47&t.type?new b_(n[fe],n):null}(Ml(),cn(),16==(16&t))}class L8{constructor(){}supports(n){return Xv(n)}create(n){return new EG(n)}}const SG=(t,n)=>n;class EG{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||SG}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const c=!i||e&&e.currentIndex<z8(i,r,s)?e:i,f=z8(c,r,s),y=c.currentIndex;if(c===i)r--,i=i._nextRemoved;else if(e=e._next,null==c.previousIndex)r++;else{s||(s=[]);const k=f-r,E=y-r;if(k!=E){for(let $=0;$<k;$++){const W=$<s.length?s[$]:s[$]=0,re=W+$;E<=re&&re<k&&(s[$]=W+1)}s[c.previousIndex]=E-k}}f!==y&&n(c,f,y)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!Xv(n))throw new Ht(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let r,s,c,e=this._itHead,i=!1;if(Array.isArray(n)){this.length=n.length;for(let f=0;f<this.length;f++)s=n[f],c=this._trackByFn(f,s),null!==e&&Object.is(e.trackById,c)?(i&&(e=this._verifyReinsertion(e,s,c,f)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,c,f),i=!0),e=e._next}else r=0,function a3(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let i;for(;!(i=e.next()).done;)n(i.value)}}(n,f=>{c=this._trackByFn(r,f),null!==e&&Object.is(e.trackById,c)?(i&&(e=this._verifyReinsertion(e,f,c,r)),Object.is(e.item,f)||this._addIdentityChange(e,f)):(e=this._mismatch(e,f,c,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,i,r){let s;return null===n?s=this._itTail:(s=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,s,r)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,s,r)):n=this._addAfter(new DG(e,i),s,r),n}_verifyReinsertion(n,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?n=this._reinsertAfter(s,n._prev,r):n.currentIndex!=r&&(n.currentIndex=r,this._addToMoves(n,r)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const r=n._prevRemoved,s=n._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(n,e,i),this._addToMoves(n,i),n}_moveAfter(n,e,i){return this._unlink(n),this._insertAfter(n,e,i),this._addToMoves(n,i),n}_addAfter(n,e,i){return this._insertAfter(n,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,i){const r=null===e?this._itHead:e._next;return n._next=r,n._prev=e,null===r?this._itTail=n:r._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new F8),this._linkedRecords.put(n),n.currentIndex=i,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,i=n._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new F8),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class DG{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class TG{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,n))return i;return null}remove(n){const e=n._prevDup,i=n._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class F8{constructor(){this.map=new Map}put(n){const e=n.trackById;let i=this.map.get(e);i||(i=new TG,this.map.set(e,i)),i.add(n)}get(n,e){const r=this.map.get(n);return r?r.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function z8(t,n,e){const i=t.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+n+r}class N8{constructor(){}supports(n){return n instanceof Map||sw(n)}create(){return new AG}}class AG{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||sw(n)))throw new Ht(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const i=n._prev;return e._next=n,e._prev=i,n._prev=e,i&&(i._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const r=this._records.get(n);this._maybeAddToChanges(r,e);const s=r._prev,c=r._next;return s&&(s._next=c),c&&(c._prev=s),r._next=null,r._prev=null,r}const i=new PG(n);return this._records.set(n,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(i=>e(n[i],i))}}class PG{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function B8(){return new N3([new L8])}let N3=(()=>{class t{static{this.\u0275prov=vn({token:t,providedIn:"root",factory:B8})}constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||B8()),deps:[[t,new vo,new oo]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Ht(901,!1)}}return t})();function V8(){return new zw([new N8])}let zw=(()=>{class t{static{this.\u0275prov=vn({token:t,providedIn:"root",factory:V8})}constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||V8()),deps:[[t,new vo,new oo]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Ht(901,!1)}}return t})();const RG=w8(null,"core",[]);let LG=(()=>{class t{constructor(e){}static{this.\u0275fac=function(i){return new(i||t)(Dt(k1))}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})();function _2(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}let ZD=null;function M1(){return ZD}class YG{}const lo=new tn("DocumentToken");let YD=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return Rn(KG)},providedIn:"platform"})}}return t})();const XG=new tn("Location Initialized");let KG=(()=>{class t extends YD{constructor(){super(),this._doc=Rn(lo),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return M1().getBaseHref(this._doc)}onPopState(e){const i=M1().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=M1().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return new t},providedIn:"platform"})}}return t})();function XD(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function Y8(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function Um(t){return t&&"?"!==t[0]?"?"+t:t}let B_=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return Rn(K8)},providedIn:"root"})}}return t})();const X8=new tn("appBaseHref");let K8=(()=>{class t extends B_{constructor(e,i){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Rn(lo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return XD(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+Um(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const c=this.prepareExternalUrl(r+Um(s));this._platformLocation.pushState(e,i,c)}replaceState(e,i,r,s){const c=this.prepareExternalUrl(r+Um(s));this._platformLocation.replaceState(e,i,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(i){return new(i||t)(Dt(YD),Dt(X8,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),QG=(()=>{class t extends B_{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=XD(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let c=this.prepareExternalUrl(r+Um(s));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.pushState(e,i,c)}replaceState(e,i,r,s){let c=this.prepareExternalUrl(r+Um(s));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(i){return new(i||t)(Dt(YD),Dt(X8,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})(),Nw=(()=>{class t{constructor(e){this._subject=new Xi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._basePath=function tW(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(Y8(Q8(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+Um(i))}normalize(e){return t.stripTrailingSlash(function eW(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,Q8(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Um(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Um(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}static{this.normalizeQueryParams=Um}static{this.joinWithSlash=XD}static{this.stripTrailingSlash=Y8}static{this.\u0275fac=function(i){return new(i||t)(Dt(B_))}}static{this.\u0275prov=vn({token:t,factory:function(){return function JG(){return new Nw(Dt(B_))}()},providedIn:"root"})}}return t})();function Q8(t){return t.replace(/\/index.html$/,"")}const J8={ADP:[void 0,void 0,0],AFN:[void 0,"\u060b",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058f",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20bc"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GHS:[void 0,"GH\u20b5"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202fCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var V3=function(t){return t[t.Decimal=0]="Decimal",t[t.Percent=1]="Percent",t[t.Currency=2]="Currency",t[t.Scientific=3]="Scientific",t}(V3||{}),Qd=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Qd||{}),Us=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Us||{}),Gh=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(Gh||{}),Dl=function(t){return t[t.Decimal=0]="Decimal",t[t.Group=1]="Group",t[t.List=2]="List",t[t.PercentSign=3]="PercentSign",t[t.PlusSign=4]="PlusSign",t[t.MinusSign=5]="MinusSign",t[t.Exponential=6]="Exponential",t[t.SuperscriptingExponent=7]="SuperscriptingExponent",t[t.PerMille=8]="PerMille",t[t.Infinity=9]="Infinity",t[t.NaN=10]="NaN",t[t.TimeSeparator=11]="TimeSeparator",t[t.CurrencyDecimal=12]="CurrencyDecimal",t[t.CurrencyGroup=13]="CurrencyGroup",t}(Dl||{});function j3(t,n){return Lu(Br(t)[xo.DateFormat],n)}function H3(t,n){return Lu(Br(t)[xo.TimeFormat],n)}function U3(t,n){return Lu(Br(t)[xo.DateTimeFormat],n)}function Ru(t,n){const e=Br(t),i=e[xo.NumberSymbols][n];if(typeof i>"u"){if(n===Dl.CurrencyDecimal)return e[xo.NumberSymbols][Dl.Decimal];if(n===Dl.CurrencyGroup)return e[xo.NumberSymbols][Dl.Group]}return i}function KD(t,n){return Br(t)[xo.NumberFormats][n]}function eR(t){if(!t[xo.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[xo.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Lu(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function QD(t){const[n,e]=t.split(":");return{hours:+n,minutes:+e}}const mW=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Bw={},gW=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var qm=function(t){return t[t.Short=0]="Short",t[t.ShortGMT=1]="ShortGMT",t[t.Long=2]="Long",t[t.Extended=3]="Extended",t}(qm||{}),is=function(t){return t[t.FullYear=0]="FullYear",t[t.Month=1]="Month",t[t.Date=2]="Date",t[t.Hours=3]="Hours",t[t.Minutes=4]="Minutes",t[t.Seconds=5]="Seconds",t[t.FractionalSeconds=6]="FractionalSeconds",t[t.Day=7]="Day",t}(is||{}),rs=function(t){return t[t.DayPeriods=0]="DayPeriods",t[t.Days=1]="Days",t[t.Months=2]="Months",t[t.Eras=3]="Eras",t}(rs||{});function V_(t,n,e,i){let r=function CW(t){if(iR(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[r,s=1,c=1]=t.split("-").map(f=>+f);return q3(r,s-1,c)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let i;if(i=t.match(mW))return function SW(t){const n=new Date(0);let e=0,i=0;const r=t[8]?n.setUTCFullYear:n.setFullYear,s=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),i=Number(t[9]+t[11])),r.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));const c=Number(t[4]||0)-e,f=Number(t[5]||0)-i,y=Number(t[6]||0),k=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return s.call(n,c,f,y,k),n}(i)}const n=new Date(t);if(!iR(n))throw new Error(`Unable to convert "${t}" into a date`);return n}(t);n=$m(e,n)||n;let f,c=[];for(;n;){if(f=gW.exec(n),!f){c.push(n);break}{c=c.concat(f.slice(1));const E=c.pop();if(!E)break;n=E}}let y=r.getTimezoneOffset();i&&(y=nR(i,y),r=function MW(t,n,e){const i=e?-1:1,r=t.getTimezoneOffset();return function kW(t,n){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+n),t}(t,i*(nR(n,r)-r))}(r,i,!0));let k="";return c.forEach(E=>{const F=function wW(t){if(eT[t])return eT[t];let n;switch(t){case"G":case"GG":case"GGG":n=ea(rs.Eras,Us.Abbreviated);break;case"GGGG":n=ea(rs.Eras,Us.Wide);break;case"GGGGG":n=ea(rs.Eras,Us.Narrow);break;case"y":n=Gl(is.FullYear,1,0,!1,!0);break;case"yy":n=Gl(is.FullYear,2,0,!0,!0);break;case"yyy":n=Gl(is.FullYear,3,0,!1,!0);break;case"yyyy":n=Gl(is.FullYear,4,0,!1,!0);break;case"Y":n=Z3(1);break;case"YY":n=Z3(2,!0);break;case"YYY":n=Z3(3);break;case"YYYY":n=Z3(4);break;case"M":case"L":n=Gl(is.Month,1,1);break;case"MM":case"LL":n=Gl(is.Month,2,1);break;case"MMM":n=ea(rs.Months,Us.Abbreviated);break;case"MMMM":n=ea(rs.Months,Us.Wide);break;case"MMMMM":n=ea(rs.Months,Us.Narrow);break;case"LLL":n=ea(rs.Months,Us.Abbreviated,Qd.Standalone);break;case"LLLL":n=ea(rs.Months,Us.Wide,Qd.Standalone);break;case"LLLLL":n=ea(rs.Months,Us.Narrow,Qd.Standalone);break;case"w":n=JD(1);break;case"ww":n=JD(2);break;case"W":n=JD(1,!0);break;case"d":n=Gl(is.Date,1);break;case"dd":n=Gl(is.Date,2);break;case"c":case"cc":n=Gl(is.Day,1);break;case"ccc":n=ea(rs.Days,Us.Abbreviated,Qd.Standalone);break;case"cccc":n=ea(rs.Days,Us.Wide,Qd.Standalone);break;case"ccccc":n=ea(rs.Days,Us.Narrow,Qd.Standalone);break;case"cccccc":n=ea(rs.Days,Us.Short,Qd.Standalone);break;case"E":case"EE":case"EEE":n=ea(rs.Days,Us.Abbreviated);break;case"EEEE":n=ea(rs.Days,Us.Wide);break;case"EEEEE":n=ea(rs.Days,Us.Narrow);break;case"EEEEEE":n=ea(rs.Days,Us.Short);break;case"a":case"aa":case"aaa":n=ea(rs.DayPeriods,Us.Abbreviated);break;case"aaaa":n=ea(rs.DayPeriods,Us.Wide);break;case"aaaaa":n=ea(rs.DayPeriods,Us.Narrow);break;case"b":case"bb":case"bbb":n=ea(rs.DayPeriods,Us.Abbreviated,Qd.Standalone,!0);break;case"bbbb":n=ea(rs.DayPeriods,Us.Wide,Qd.Standalone,!0);break;case"bbbbb":n=ea(rs.DayPeriods,Us.Narrow,Qd.Standalone,!0);break;case"B":case"BB":case"BBB":n=ea(rs.DayPeriods,Us.Abbreviated,Qd.Format,!0);break;case"BBBB":n=ea(rs.DayPeriods,Us.Wide,Qd.Format,!0);break;case"BBBBB":n=ea(rs.DayPeriods,Us.Narrow,Qd.Format,!0);break;case"h":n=Gl(is.Hours,1,-12);break;case"hh":n=Gl(is.Hours,2,-12);break;case"H":n=Gl(is.Hours,1);break;case"HH":n=Gl(is.Hours,2);break;case"m":n=Gl(is.Minutes,1);break;case"mm":n=Gl(is.Minutes,2);break;case"s":n=Gl(is.Seconds,1);break;case"ss":n=Gl(is.Seconds,2);break;case"S":n=Gl(is.FractionalSeconds,1);break;case"SS":n=Gl(is.FractionalSeconds,2);break;case"SSS":n=Gl(is.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=G3(qm.Short);break;case"ZZZZZ":n=G3(qm.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=G3(qm.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=G3(qm.Long);break;default:return null}return eT[t]=n,n}(E);k+=F?F(r,e,y):"''"===E?"'":E.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),k}function q3(t,n,e){const i=new Date(0);return i.setFullYear(t,n,e),i.setHours(0,0,0),i}function $m(t,n){const e=function iW(t){return Br(t)[xo.LocaleId]}(t);if(Bw[e]=Bw[e]||{},Bw[e][n])return Bw[e][n];let i="";switch(n){case"shortDate":i=j3(t,Gh.Short);break;case"mediumDate":i=j3(t,Gh.Medium);break;case"longDate":i=j3(t,Gh.Long);break;case"fullDate":i=j3(t,Gh.Full);break;case"shortTime":i=H3(t,Gh.Short);break;case"mediumTime":i=H3(t,Gh.Medium);break;case"longTime":i=H3(t,Gh.Long);break;case"fullTime":i=H3(t,Gh.Full);break;case"short":const r=$m(t,"shortTime"),s=$m(t,"shortDate");i=$3(U3(t,Gh.Short),[r,s]);break;case"medium":const c=$m(t,"mediumTime"),f=$m(t,"mediumDate");i=$3(U3(t,Gh.Medium),[c,f]);break;case"long":const y=$m(t,"longTime"),k=$m(t,"longDate");i=$3(U3(t,Gh.Long),[y,k]);break;case"full":const E=$m(t,"fullTime"),F=$m(t,"fullDate");i=$3(U3(t,Gh.Full),[E,F])}return i&&(Bw[e][n]=i),i}function $3(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,i){return null!=n&&i in n?n[i]:e})),t}function Cp(t,n,e="-",i,r){let s="";(t<0||r&&t<=0)&&(r?t=1-t:(t=-t,s=e));let c=String(t);for(;c.length<n;)c="0"+c;return i&&(c=c.slice(c.length-n)),s+c}function Gl(t,n,e=0,i=!1,r=!1){return function(s,c){let f=function yW(t,n){switch(t){case is.FullYear:return n.getFullYear();case is.Month:return n.getMonth();case is.Date:return n.getDate();case is.Hours:return n.getHours();case is.Minutes:return n.getMinutes();case is.Seconds:return n.getSeconds();case is.FractionalSeconds:return n.getMilliseconds();case is.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,s);if((e>0||f>-e)&&(f+=e),t===is.Hours)0===f&&-12===e&&(f=12);else if(t===is.FractionalSeconds)return function _W(t,n){return Cp(t,3).substring(0,n)}(f,n);const y=Ru(c,Dl.MinusSign);return Cp(f,n,y,i,r)}}function ea(t,n,e=Qd.Format,i=!1){return function(r,s){return function vW(t,n,e,i,r,s){switch(e){case rs.Months:return function sW(t,n,e){const i=Br(t),s=Lu([i[xo.MonthsFormat],i[xo.MonthsStandalone]],n);return Lu(s,e)}(n,r,i)[t.getMonth()];case rs.Days:return function oW(t,n,e){const i=Br(t),s=Lu([i[xo.DaysFormat],i[xo.DaysStandalone]],n);return Lu(s,e)}(n,r,i)[t.getDay()];case rs.DayPeriods:const c=t.getHours(),f=t.getMinutes();if(s){const k=function dW(t){const n=Br(t);return eR(n),(n[xo.ExtraData][2]||[]).map(i=>"string"==typeof i?QD(i):[QD(i[0]),QD(i[1])])}(n),E=function hW(t,n,e){const i=Br(t);eR(i);const s=Lu([i[xo.ExtraData][0],i[xo.ExtraData][1]],n)||[];return Lu(s,e)||[]}(n,r,i),F=k.findIndex($=>{if(Array.isArray($)){const[W,re]=$,he=c>=W.hours&&f>=W.minutes,me=c<re.hours||c===re.hours&&f<re.minutes;if(W.hours<re.hours){if(he&&me)return!0}else if(he||me)return!0}else if($.hours===c&&$.minutes===f)return!0;return!1});if(-1!==F)return E[F]}return function rW(t,n,e){const i=Br(t),s=Lu([i[xo.DayPeriodsFormat],i[xo.DayPeriodsStandalone]],n);return Lu(s,e)}(n,r,i)[c<12?0:1];case rs.Eras:return function aW(t,n){return Lu(Br(t)[xo.Eras],n)}(n,i)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,t,n,e,i)}}function G3(t){return function(n,e,i){const r=-1*i,s=Ru(e,Dl.MinusSign),c=r>0?Math.floor(r/60):Math.ceil(r/60);switch(t){case qm.Short:return(r>=0?"+":"")+Cp(c,2,s)+Cp(Math.abs(r%60),2,s);case qm.ShortGMT:return"GMT"+(r>=0?"+":"")+Cp(c,1,s);case qm.Long:return"GMT"+(r>=0?"+":"")+Cp(c,2,s)+":"+Cp(Math.abs(r%60),2,s);case qm.Extended:return 0===i?"Z":(r>=0?"+":"")+Cp(c,2,s)+":"+Cp(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${t}"`)}}}const bW=0,W3=4;function tR(t){return q3(t.getFullYear(),t.getMonth(),t.getDate()+(W3-t.getDay()))}function JD(t,n=!1){return function(e,i){let r;if(n){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,c=e.getDate();r=1+Math.floor((c+s)/7)}else{const s=tR(e),c=function xW(t){const n=q3(t,bW,1).getDay();return q3(t,0,1+(n<=W3?W3:W3+7)-n)}(s.getFullYear()),f=s.getTime()-c.getTime();r=1+Math.round(f/6048e5)}return Cp(r,t,Ru(i,Dl.MinusSign))}}function Z3(t,n=!1){return function(e,i){return Cp(tR(e).getFullYear(),t,Ru(i,Dl.MinusSign),n)}}const eT={};function nR(t,n){t=t.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function iR(t){return t instanceof Date&&!isNaN(t.valueOf())}const EW=/^(\d+)?\.((\d+)(-(\d+))?)?$/,rR=22,Y3=".",Vw="0",DW=";",TW=",",tT="#";function nT(t,n,e,i,r,s,c=!1){let f="",y=!1;if(isFinite(t)){let k=function LW(t){let i,r,s,c,f,n=Math.abs(t)+"",e=0;for((r=n.indexOf(Y3))>-1&&(n=n.replace(Y3,"")),(s=n.search(/e/i))>0?(r<0&&(r=s),r+=+n.slice(s+1),n=n.substring(0,s)):r<0&&(r=n.length),s=0;n.charAt(s)===Vw;s++);if(s===(f=n.length))i=[0],r=1;else{for(f--;n.charAt(f)===Vw;)f--;for(r-=s,i=[],c=0;s<=f;s++,c++)i[c]=Number(n.charAt(s))}return r>rR&&(i=i.splice(0,rR-1),e=r-1,r=1),{digits:i,exponent:e,integerLen:r}}(t);c&&(k=function RW(t){if(0===t.digits[0])return t;const n=t.digits.length-t.integerLen;return t.exponent?t.exponent+=2:(0===n?t.digits.push(0,0):1===n&&t.digits.push(0),t.integerLen+=2),t}(k));let E=n.minInt,F=n.minFrac,$=n.maxFrac;if(s){const Re=s.match(EW);if(null===Re)throw new Error(`${s} is not a valid digit info`);const rt=Re[1],ft=Re[3],Ct=Re[5];null!=rt&&(E=rT(rt)),null!=ft&&(F=rT(ft)),null!=Ct?$=rT(Ct):null!=ft&&F>$&&($=F)}!function FW(t,n,e){if(n>e)throw new Error(`The minimum number of digits after fraction (${n}) is higher than the maximum (${e}).`);let i=t.digits,r=i.length-t.integerLen;const s=Math.min(Math.max(n,r),e);let c=s+t.integerLen,f=i[c];if(c>0){i.splice(Math.max(t.integerLen,c));for(let F=c;F<i.length;F++)i[F]=0}else{r=Math.max(0,r),t.integerLen=1,i.length=Math.max(1,c=s+1),i[0]=0;for(let F=1;F<c;F++)i[F]=0}if(f>=5)if(c-1<0){for(let F=0;F>c;F--)i.unshift(0),t.integerLen++;i.unshift(1),t.integerLen++}else i[c-1]++;for(;r<Math.max(0,s);r++)i.push(0);let y=0!==s;const k=n+t.integerLen,E=i.reduceRight(function(F,$,W,re){return re[W]=($+=F)<10?$:$-10,y&&(0===re[W]&&W>=k?re.pop():y=!1),$>=10?1:0},0);E&&(i.unshift(E),t.integerLen++)}(k,F,$);let W=k.digits,re=k.integerLen;const he=k.exponent;let me=[];for(y=W.every(Re=>!Re);re<E;re++)W.unshift(0);for(;re<0;re++)W.unshift(0);re>0?me=W.splice(re,W.length):(me=W,W=[0]);const Pe=[];for(W.length>=n.lgSize&&Pe.unshift(W.splice(-n.lgSize,W.length).join(""));W.length>n.gSize;)Pe.unshift(W.splice(-n.gSize,W.length).join(""));W.length&&Pe.unshift(W.join("")),f=Pe.join(Ru(e,i)),me.length&&(f+=Ru(e,r)+me.join("")),he&&(f+=Ru(e,Dl.Exponential)+"+"+he)}else f=Ru(e,Dl.Infinity);return f=t<0&&!y?n.negPre+f+n.negSuf:n.posPre+f+n.posSuf,f}function iT(t,n="-"){const e={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=t.split(DW),r=i[0],s=i[1],c=-1!==r.indexOf(Y3)?r.split(Y3):[r.substring(0,r.lastIndexOf(Vw)+1),r.substring(r.lastIndexOf(Vw)+1)],f=c[0],y=c[1]||"";e.posPre=f.substring(0,f.indexOf(tT));for(let E=0;E<y.length;E++){const F=y.charAt(E);F===Vw?e.minFrac=e.maxFrac=E+1:F===tT?e.maxFrac=E+1:e.posSuf+=F}const k=f.split(TW);if(e.gSize=k[1]?k[1].length:0,e.lgSize=k[2]||k[1]?(k[2]||k[1]).length:0,s){const E=r.length-e.posPre.length-e.posSuf.length,F=s.indexOf(tT);e.negPre=s.substring(0,F).replace(/'/g,""),e.negSuf=s.slice(F+E).replace(/'/g,"")}else e.negPre=n+e.posPre,e.negSuf=e.posSuf;return e}function rT(t){const n=parseInt(t);if(isNaN(n))throw new Error("Invalid integer literal when parsing "+t);return n}function aR(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===n)return decodeURIComponent(s)}return null}const sT=/\s+/,lR=[];let ha=(()=>{class t{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this.initialClasses=lR,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(sT):lR}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(sT):e}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const i of e)this._updateState(i,!0);else if(null!=e)for(const i of Object.keys(e))this._updateState(i,!!e[i]);this._applyStateDiff()}_updateState(e,i){const r=this.stateMap.get(e);void 0!==r?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(e,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const i=e[0],r=e[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(e,i){(e=e.trim()).length>0&&e.split(sT).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static{this.\u0275fac=function(i){return new(i||t)(st(N3),st(zw),st(ns),st(sc))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}}return t})();class BW{constructor(n,e,i,r){this.$implicit=n,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let qs=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,c)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new BW(r.item,this._ngForOf,-1,-1),null===c?void 0:c);else if(null==c)i.remove(null===s?void 0:s);else if(null!==s){const f=i.get(s);i.move(f,c),dR(f,r)}});for(let r=0,s=i.length;r<s;r++){const f=i.get(r).context;f.index=r,f.count=s,f.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{dR(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)(st(Ou),st(Ef),st(N3))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return t})();function dR(t,n){t.context.$implicit=n.item}let wo=(()=>{class t{constructor(e,i){this._viewContainer=e,this._context=new VW,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){hR("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){hR("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}static{this.\u0275fac=function(i){return new(i||t)(st(Ou),st(Ef))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return t})();class VW{constructor(){this.$implicit=null,this.ngIf=null}}function hR(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Ro(n)}'.`)}let pR=(()=>{class t{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),c=-1===r.indexOf("-")?void 0:up.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,c):this._renderer.removeStyle(this._ngEl.nativeElement,r,c)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st(zw),st(sc))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}}return t})(),fR=(()=>{class t{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:c}=this;this._viewRef=i.createEmbeddedView(r,s,c?{injector:c}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static{this.\u0275fac=function(i){return new(i||t)(st(Ou))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[ol]})}}return t})();function Sp(t,n){return new Ht(2100,!1)}const XW=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let jw=(()=>{class t{transform(e){if(null==e)return null;if("string"!=typeof e)throw Sp();return e.replace(XW,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=$n({name:"titlecase",type:t,pure:!0,standalone:!0})}}return t})();const JW=new tn("DATE_PIPE_DEFAULT_TIMEZONE"),eZ=new tn("DATE_PIPE_DEFAULT_OPTIONS");let v2=(()=>{class t{constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,s){if(null==e||""===e||e!=e)return null;try{return V_(e,i??this.defaultOptions?.dateFormat??"mediumDate",s||this.locale,r??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(c){throw Sp()}}static{this.\u0275fac=function(i){return new(i||t)(st(Af,16),st(JW,24),st(eZ,24))}}static{this.\u0275pipe=$n({name:"date",type:t,pure:!0,standalone:!0})}}return t})(),X3=(()=>{class t{constructor(e){this._locale=e}transform(e,i,r){if(!cT(e))return null;r=r||this._locale;try{return function OW(t,n,e){return nT(t,iT(KD(n,V3.Decimal),Ru(n,Dl.MinusSign)),n,Dl.Group,Dl.Decimal,e)}(dT(e),r,i)}catch(s){throw Sp()}}static{this.\u0275fac=function(i){return new(i||t)(st(Af,16))}}static{this.\u0275pipe=$n({name:"number",type:t,pure:!0,standalone:!0})}}return t})(),Hw=(()=>{class t{constructor(e,i="USD"){this._locale=e,this._defaultCurrencyCode=i}transform(e,i=this._defaultCurrencyCode,r="symbol",s,c){if(!cT(e))return null;c=c||this._locale,"boolean"==typeof r&&(r=r?"symbol":"code");let f=i||this._defaultCurrencyCode;"code"!==r&&(f="symbol"===r||"symbol-narrow"===r?function uW(t,n,e="en"){const i=function lW(t){return Br(t)[xo.Currencies]}(e)[t]||J8[t]||[],r=i[1];return"narrow"===n&&"string"==typeof r?r:i[0]||t}(f,"symbol"===r?"wide":"narrow",c):r);try{return function PW(t,n,e,i,r){const c=iT(KD(n,V3.Currency),Ru(n,Dl.MinusSign));return c.minFrac=function fW(t){let n;const e=J8[t];return e&&(n=e[2]),"number"==typeof n?n:2}(i),c.maxFrac=c.minFrac,nT(t,c,n,Dl.CurrencyGroup,Dl.CurrencyDecimal,r).replace("\xa4",e).replace("\xa4","").trim()}(dT(e),c,f,i,s)}catch(y){throw Sp()}}static{this.\u0275fac=function(i){return new(i||t)(st(Af,16),st(j$,16))}}static{this.\u0275pipe=$n({name:"currency",type:t,pure:!0,standalone:!0})}}return t})();function cT(t){return!(null==t||""===t||t!=t)}function dT(t){if("string"==typeof t&&!isNaN(Number(t)-parseFloat(t)))return Number(t);if("number"!=typeof t)throw new Error(`${t} is not a number`);return t}let hT=(()=>{class t{transform(e,i,r){if(null==e)return null;if(!this.supports(e))throw Sp();return e.slice(i,r)}supports(e){return"string"==typeof e||Array.isArray(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=$n({name:"slice",type:t,pure:!1,standalone:!0})}}return t})(),Gm=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})();const gR="browser";function _R(t){return"server"===t}let uZ=(()=>{class t{static{this.\u0275prov=vn({token:t,providedIn:"root",factory:()=>new pZ(Dt(lo),window)})}}return t})();class pZ{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function fZ(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const c=s.getElementById(n)||s.querySelector(`[name="${n}"]`);if(c)return c}r=i.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const e=n.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class yR{}class zZ extends YG{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class fT extends zZ{static makeCurrent(){!function ZG(t){ZD||(ZD=t)}(new fT)}onAndCancel(n,e,i){return n.addEventListener(e,i),()=>{n.removeEventListener(e,i)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function NZ(){return qw=qw||document.querySelector("base"),qw?qw.getAttribute("href"):null}();return null==e?null:function BZ(t){J3=J3||document.createElement("a"),J3.setAttribute("href",t);const n=J3.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){qw=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return aR(document.cookie,n)}}let J3,qw=null,jZ=(()=>{class t{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const mT=new tn("EventManagerPlugins");let kR=(()=>{class t{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>{r.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(s=>s.supports(e)),!i)throw new Ht(5101,!1);return this._eventNameToPlugin.set(e,i),i}static{this.\u0275fac=function(i){return new(i||t)(Dt(mT),Dt(Mr))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();class MR{constructor(n){this._doc=n}}const gT="ng-app-id";let CR=(()=>{class t{constructor(e,i,r,s={}){this.doc=e,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=_R(s),this.resetHostNodes()}addStyles(e){for(const i of e)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(e){for(const i of e)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const e=this.styleNodesInDOM;e&&(e.forEach(i=>i.remove()),e.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const i of this.getAllStyles())this.addStyleToHost(e,i)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(const i of this.hostNodes)this.addStyleToHost(i,e)}onStyleRemoved(e){const i=this.styleRef;i.get(e)?.elements?.forEach(r=>r.remove()),i.delete(e)}collectServerRenderedStyles(){const e=this.doc.head?.querySelectorAll(`style[${gT}="${this.appId}"]`);if(e?.length){const i=new Map;return e.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(e,i){const r=this.styleRef;if(r.has(e)){const s=r.get(e);return s.usage+=i,s.usage}return r.set(e,{usage:i,elements:[]}),i}getStyleElement(e,i){const r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===e)return r.delete(i),s.removeAttribute(gT),s;{const c=this.doc.createElement("style");return this.nonce&&c.setAttribute("nonce",this.nonce),c.textContent=i,this.platformIsServer&&c.setAttribute(gT,this.appId),c}}addStyleToHost(e,i){const r=this.getStyleElement(e,i);e.appendChild(r);const s=this.styleRef,c=s.get(i)?.elements;c?c.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(n1),Dt(yx,8),Dt(mh))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const _T={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},yT=/%COMP%/g,$Z=new tn("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function ER(t,n){return n.map(e=>e.replace(yT,t))}let vT=(()=>{class t{constructor(e,i,r,s,c,f,y,k=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=c,this.platformId=f,this.ngZone=y,this.nonce=k,this.rendererByCompId=new Map,this.platformIsServer=_R(f),this.defaultRenderer=new bT(e,c,y,this.platformIsServer)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Go.ShadowDom&&(i={...i,encapsulation:Go.Emulated});const r=this.getOrCreateRenderer(e,i);return r instanceof TR?r.applyToHost(e):r instanceof xT&&r.applyStyles(),r}getOrCreateRenderer(e,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const c=this.doc,f=this.ngZone,y=this.eventManager,k=this.sharedStylesHost,E=this.removeStylesOnCompDestroy,F=this.platformIsServer;switch(i.encapsulation){case Go.Emulated:s=new TR(y,k,i,this.appId,E,c,f,F);break;case Go.ShadowDom:return new YZ(y,k,e,i,c,f,this.nonce,F);default:s=new xT(y,k,i,E,c,f,F)}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||t)(Dt(kR),Dt(CR),Dt(n1),Dt($Z),Dt(lo),Dt(mh),Dt(Mr),Dt(yx))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();class bT{constructor(n,e,i,r){this.eventManager=n,this.doc=e,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?this.doc.createElementNS(_T[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(DR(n)?n.content:n).appendChild(e)}insertBefore(n,e,i){n&&(DR(n)?n.content:n).insertBefore(e,i)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let i="string"==typeof n?this.doc.querySelector(n):n;if(!i)throw new Ht(-5104,!1);return e||(i.textContent=""),i}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,i,r){if(r){e=r+":"+e;const s=_T[r];s?n.setAttributeNS(s,e,i):n.setAttribute(e,i)}else n.setAttribute(e,i)}removeAttribute(n,e,i){if(i){const r=_T[i];r?n.removeAttributeNS(r,e):n.removeAttribute(`${i}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,i,r){r&(up.DashCase|up.Important)?n.style.setProperty(e,i,r&up.Important?"important":""):n.style[e]=i}removeStyle(n,e,i){i&up.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,i){n[e]=i}setValue(n,e){n.nodeValue=e}listen(n,e,i){if("string"==typeof n&&!(n=M1().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${e}`);return this.eventManager.addEventListener(n,e,this.decoratePreventDefault(i))}decoratePreventDefault(n){return e=>{if("__ngUnwrap__"===e)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))&&e.preventDefault()}}}function DR(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class YZ extends bT{constructor(n,e,i,r,s,c,f,y){super(n,s,c,y),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const k=ER(r.id,r.styles);for(const E of k){const F=document.createElement("style");f&&F.setAttribute("nonce",f),F.textContent=E,this.shadowRoot.appendChild(F)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,i){return super.insertBefore(this.nodeOrShadowRoot(n),e,i)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class xT extends bT{constructor(n,e,i,r,s,c,f,y){super(n,s,c,f),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r,this.styles=y?ER(y,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class TR extends xT{constructor(n,e,i,r,s,c,f,y){const k=r+"-"+i.id;super(n,e,i,s,c,f,y,k),this.contentAttr=function GZ(t){return"_ngcontent-%COMP%".replace(yT,t)}(k),this.hostAttr=function WZ(t){return"_nghost-%COMP%".replace(yT,t)}(k)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const i=super.createElement(n,e);return super.setAttribute(i,this.contentAttr,""),i}}let XZ=(()=>{class t extends MR{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const AR=["alt","control","meta","shift"],KZ={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},QZ={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let JZ=(()=>{class t extends MR{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,i,r){const s=t.parseEventName(i),c=t.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>M1().onAndCancel(e,s.domEventName,c))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=t._normalizeKey(i.pop());let c="",f=i.indexOf("code");if(f>-1&&(i.splice(f,1),c="code."),AR.forEach(k=>{const E=i.indexOf(k);E>-1&&(i.splice(E,1),c+=k+".")}),c+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=c,y}static matchEventFullKeyCode(e,i){let r=KZ[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),AR.forEach(c=>{c!==r&&(0,QZ[c])(e)&&(s+=c+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{t.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const IR=[{provide:mh,useValue:gR},{provide:hC,useValue:function eY(){fT.makeCurrent()},multi:!0},{provide:lo,useFactory:function nY(){return function dE(t){Jb=t}(document),document},deps:[]}],iY=w8(RG,"browser",IR),rY=new tn(""),OR=[{provide:R3,useClass:class VZ{addToWindow(n){Hn.getAngularTestability=(i,r=!0)=>{const s=n.findTestabilityInTree(i,r);if(null==s)throw new Ht(5103,!1);return s},Hn.getAllAngularTestabilities=()=>n.getAllTestabilities(),Hn.getAllAngularRootElements=()=>n.getAllRootElements(),Hn.frameworkStabilizers||(Hn.frameworkStabilizers=[]),Hn.frameworkStabilizers.push(i=>{const r=Hn.getAllAngularTestabilities();let s=r.length,c=!1;const f=function(y){c=c||y,s--,0==s&&i(c)};r.forEach(y=>{y.whenStable(f)})})}findTestabilityInTree(n,e,i){return null==e?null:n.getTestability(e)??(i?M1().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:_8,useClass:zD,deps:[Mr,ND,R3]},{provide:zD,useClass:zD,deps:[Mr,ND,R3]}],RR=[{provide:mx,useValue:"root"},{provide:gh,useFactory:function tY(){return new gh},deps:[]},{provide:mT,useClass:XZ,multi:!0,deps:[lo,Mr,mh]},{provide:mT,useClass:JZ,multi:!0,deps:[lo]},vT,CR,kR,{provide:_p,useExisting:vT},{provide:yR,useClass:jZ,deps:[]},[]];let LR=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:n1,useValue:e.appId}]}}static{this.\u0275fac=function(i){return new(i||t)(Dt(rY,12))}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[...RR,...OR],imports:[Gm,LG]})}}return t})(),FR=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:function(i){let r=null;return r=i?new i:function sY(){return new FR(Dt(lo))}(),r},providedIn:"root"})}}return t})();typeof window<"u"&&window;const{isArray:hY}=Array,{getPrototypeOf:uY,prototype:pY,keys:fY}=Object;function jR(t){if(1===t.length){const n=t[0];if(hY(n))return{args:n,keys:null};if(function mY(t){return t&&"object"==typeof t&&uY(t)===pY}(n)){const e=fY(n);return{args:e.map(i=>n[i]),keys:e}}}return{args:t,keys:null}}const{isArray:gY}=Array;function MT(t){return zi(n=>function _Y(t,n){return gY(n)?t(...n):t(n)}(t,n))}function HR(t,n){return t.reduce((e,i,r)=>(e[i]=n[r],e),{})}let qR=(()=>{class t{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static{this.\u0275fac=function(i){return new(i||t)(st(sc),st(ns))}}static{this.\u0275dir=gi({type:t})}}return t})(),j_=(()=>{class t extends qR{static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,features:[Kr]})}}return t})();const Wh=new tn("NgValueAccessor"),yY={provide:Wh,useExisting:Tr(()=>CT),multi:!0};let CT=(()=>{class t extends j_{writeValue(e){this.setProperty("checked",e)}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,r){1&i&&qt("change",function(c){return r.onChange(c.target.checked)})("blur",function(){return r.onTouched()})},features:[Vs([yY]),Kr]})}}return t})();const vY={provide:Wh,useExisting:Tr(()=>hl),multi:!0},xY=new tn("CompositionEventMode");let hl=(()=>{class t extends qR{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function bY(){const t=M1()?M1().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static{this.\u0275fac=function(i){return new(i||t)(st(sc),st(ns),st(xY,8))}}static{this.\u0275dir=gi({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){1&i&&qt("input",function(c){return r._handleInput(c.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(c){return r._compositionEnd(c.target.value)})},features:[Vs([vY]),Kr]})}}return t})();function S1(t){return null==t||("string"==typeof t||Array.isArray(t))&&0===t.length}function $R(t){return null!=t&&"number"==typeof t.length}const id=new tn("NgValidators"),E1=new tn("NgAsyncValidators"),wY=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Gi{static min(n){return function GR(t){return n=>{if(S1(n.value)||S1(t))return null;const e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}(n)}static max(n){return function WR(t){return n=>{if(S1(n.value)||S1(t))return null;const e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}(n)}static required(n){return ZR(n)}static requiredTrue(n){return function YR(t){return!0===t.value?null:{required:!0}}(n)}static email(n){return function XR(t){return S1(t.value)||wY.test(t.value)?null:{email:!0}}(n)}static minLength(n){return function KR(t){return n=>S1(n.value)||!$R(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}(n)}static maxLength(n){return QR(n)}static pattern(n){return function JR(t){if(!t)return e4;let n,e;return"string"==typeof t?(e="","^"!==t.charAt(0)&&(e+="^"),e+=t,"$"!==t.charAt(t.length-1)&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),i=>{if(S1(i.value))return null;const r=i.value;return n.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(n)}static nullValidator(n){return null}static compose(n){return s7(n)}static composeAsync(n){return a7(n)}}function ZR(t){return S1(t.value)?{required:!0}:null}function QR(t){return n=>$R(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function e4(t){return null}function e7(t){return null!=t}function t7(t){return v1(t)?ti(t):t}function n7(t){let n={};return t.forEach(e=>{n=null!=e?{...n,...e}:n}),0===Object.keys(n).length?null:n}function r7(t,n){return n.map(e=>e(t))}function o7(t){return t.map(n=>function kY(t){return!t.validate}(n)?n:e=>n.validate(e))}function s7(t){if(!t)return null;const n=t.filter(e7);return 0==n.length?null:function(e){return n7(r7(e,n))}}function ST(t){return null!=t?s7(o7(t)):null}function a7(t){if(!t)return null;const n=t.filter(e7);return 0==n.length?null:function(e){return function UR(...t){const n=_s(t),{args:e,keys:i}=jR(t),r=new Jn(s=>{const{length:c}=e;if(!c)return void s.complete();const f=new Array(c);let y=c,k=c;for(let E=0;E<c;E++){let F=!1;tt(e[E]).subscribe(ui(s,$=>{F||(F=!0,k--),f[E]=$},()=>y--,void 0,()=>{(!y||!F)&&(k||s.next(i?HR(i,f):f),s.complete())}))}});return n?r.pipe(MT(n)):r}(r7(e,n).map(t7)).pipe(zi(n7))}}function ET(t){return null!=t?a7(o7(t)):null}function l7(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function c7(t){return t._rawValidators}function d7(t){return t._rawAsyncValidators}function DT(t){return t?Array.isArray(t)?t:[t]:[]}function t4(t,n){return Array.isArray(t)?t.includes(n):t===n}function h7(t,n){const e=DT(n);return DT(t).forEach(r=>{t4(e,r)||e.push(r)}),e}function u7(t,n){return DT(n).filter(e=>!t4(t,e))}class p7{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=ST(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=ET(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return!!this.control&&this.control.hasError(n,e)}getError(n,e){return this.control?this.control.getError(n,e):null}}class Jd extends p7{get formDirective(){return null}get path(){return null}}class D1 extends p7{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class f7{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Wl=(()=>{class t extends f7{constructor(e){super(e)}static{this.\u0275fac=function(i){return new(i||t)(st(D1,2))}}static{this.\u0275dir=gi({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){2&i&&Z("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Kr]})}}return t})(),Pc=(()=>{class t extends f7{constructor(e){super(e)}static{this.\u0275fac=function(i){return new(i||t)(st(Jd,10))}}static{this.\u0275dir=gi({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){2&i&&Z("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Kr]})}}return t})();const $w="VALID",r4="INVALID",b2="PENDING",Gw="DISABLED";function PT(t){return(o4(t)?t.validators:t)||null}function IT(t,n){return(o4(n)?n.asyncValidators:t)||null}function o4(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}function g7(t,n,e){const i=t.controls;if(!(n?Object.keys(i):i).length)throw new Ht(1e3,"");if(!i[e])throw new Ht(1001,"")}function _7(t,n,e){t._forEachChild((i,r)=>{if(void 0===e[r])throw new Ht(1002,"")})}class s4{constructor(n,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===$w}get invalid(){return this.status===r4}get pending(){return this.status==b2}get disabled(){return this.status===Gw}get enabled(){return this.status!==Gw}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(h7(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(h7(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(u7(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(u7(n,this._rawAsyncValidators))}hasValidator(n){return t4(this._rawValidators,n)}hasAsyncValidator(n){return t4(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=b2,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=Gw,this.errors=null,this._forEachChild(i=>{i.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(i=>i(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=$w,this._forEachChild(i=>{i.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===$w||this.status===b2)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Gw:$w}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=b2,this._hasOwnPendingAsyncValidator=!0;const e=t7(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent)}get(n){let e=n;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(n,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new Xi,this.statusChanges=new Xi}_calculateStatus(){return this._allControlsDisabled()?Gw:this.errors?r4:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(b2)?b2:this._anyControlsHaveStatus(r4)?r4:$w}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){o4(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function EY(t){return Array.isArray(t)?ST(t):t||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function DY(t){return Array.isArray(t)?ET(t):t||null}(this._rawAsyncValidators)}}class x2 extends s4{constructor(n,e,i){super(PT(e),IT(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,i={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){_7(this,0,n),Object.keys(n).forEach(i=>{g7(this,!0,i),this.controls[i].setValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(i=>{const r=this.controls[i];r&&r.patchValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((i,r)=>{i.reset(n?n[r]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,i)=>(n[i]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&n(i,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&n(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(n,e){let i=n;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class y7 extends x2{}const H_=new tn("CallSetDisabledState",{providedIn:"root",factory:()=>Ww}),Ww="always";function a4(t,n){return[...n.path,t]}function Zw(t,n,e=Ww){OT(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&n.valueAccessor.setDisabledState?.(t.disabled),function AY(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&v7(t,n)})}(t,n),function IY(t,n){const e=(i,r)=>{n.valueAccessor.writeValue(i),r&&n.viewToModelUpdate(i)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function PY(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&v7(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function TY(t,n){if(n.valueAccessor.setDisabledState){const e=i=>{n.valueAccessor.setDisabledState(i)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function l4(t,n,e=!0){const i=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(i),n.valueAccessor.registerOnTouched(i)),d4(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function c4(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function OT(t,n){const e=c7(t);null!==n.validator?t.setValidators(l7(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const i=d7(t);null!==n.asyncValidator?t.setAsyncValidators(l7(i,n.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const r=()=>t.updateValueAndValidity();c4(n._rawValidators,r),c4(n._rawAsyncValidators,r)}function d4(t,n){let e=!1;if(null!==t){if(null!==n.validator){const r=c7(t);if(Array.isArray(r)&&r.length>0){const s=r.filter(c=>c!==n.validator);s.length!==r.length&&(e=!0,t.setValidators(s))}}if(null!==n.asyncValidator){const r=d7(t);if(Array.isArray(r)&&r.length>0){const s=r.filter(c=>c!==n.asyncValidator);s.length!==r.length&&(e=!0,t.setAsyncValidators(s))}}}const i=()=>{};return c4(n._rawValidators,i),c4(n._rawAsyncValidators,i),e}function v7(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function b7(t,n){OT(t,n)}function LT(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}function x7(t,n){t._syncPendingControls(),n.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function FT(t,n){if(!n)return null;let e,i,r;return Array.isArray(n),n.forEach(s=>{s.constructor===hl?e=s:function LY(t){return Object.getPrototypeOf(t.constructor)===j_}(s)?i=s:r=s}),r||i||e||null}const zY={provide:Jd,useExisting:Tr(()=>Xw)},Yw=(()=>Promise.resolve())();let Xw=(()=>{class t extends Jd{constructor(e,i,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Xi,this.form=new x2({},ST(e),ET(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Yw.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),Zw(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Yw.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Yw.then(()=>{const i=this._findContainer(e.path),r=new x2({});b7(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Yw.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Yw.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,x7(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static{this.\u0275fac=function(i){return new(i||t)(st(id,10),st(E1,10),st(H_,8))}}static{this.\u0275dir=gi({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){1&i&&qt("submit",function(c){return r.onSubmit(c)})("reset",function(){return r.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Vs([zY]),Kr]})}}return t})();function w7(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function k7(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const Kw=class extends s4{constructor(n=null,e,i){super(PT(e),IT(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),o4(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=k7(n)?n.value:n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){w7(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){w7(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){k7(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},VY={provide:D1,useExisting:Tr(()=>Wm)},S7=(()=>Promise.resolve())();let Wm=(()=>{class t extends D1{constructor(e,i,r,s,c,f){super(),this._changeDetectorRef=c,this.callSetDisabledState=f,this.control=new Kw,this._registered=!1,this.name="",this.update=new Xi,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=FT(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),LT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Zw(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){S7.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&_2(i);S7.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?a4(e,this._parent):[e]}static{this.\u0275fac=function(i){return new(i||t)(st(Jd,9),st(id,10),st(E1,10),st(Wh,10),st(Pf,8),st(H_,8))}}static{this.\u0275dir=gi({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Vs([VY]),Kr,ol]})}}return t})(),Zh=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=gi({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return t})();const jY={provide:Wh,useExisting:Tr(()=>Qw),multi:!0};let Qw=(()=>{class t extends j_{writeValue(e){this.setProperty("value",e??"")}registerOnChange(e){this.onChange=i=>{e(""==i?null:parseFloat(i))}}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){1&i&&qt("input",function(c){return r.onChange(c.target.value)})("blur",function(){return r.onTouched()})},features:[Vs([jY]),Kr]})}}return t})();const HY={provide:Wh,useExisting:Tr(()=>Jw),multi:!0};let E7=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})(),UY=(()=>{class t{constructor(){this._accessors=[]}add(e,i){this._accessors.push([e,i])}remove(e){for(let i=this._accessors.length-1;i>=0;--i)if(this._accessors[i][1]===e)return void this._accessors.splice(i,1)}select(e){this._accessors.forEach(i=>{this._isSameGroup(i,e)&&i[1]!==e&&i[1].fireUncheck(e.value)})}_isSameGroup(e,i){return!!e[0].control&&e[0]._parent===i._control._parent&&e[1].name===i.name}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:E7})}}return t})(),Jw=(()=>{class t extends j_{constructor(e,i,r,s){super(e,i),this._registry=r,this._injector=s,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=Rn(H_,{optional:!0})??Ww}ngOnInit(){this._control=this._injector.get(D1),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}static{this.\u0275fac=function(i){return new(i||t)(st(sc),st(ns),st(UY),st(ws))}}static{this.\u0275dir=gi({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(i,r){1&i&&qt("change",function(){return r.onChange()})("blur",function(){return r.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[Vs([HY]),Kr]})}}return t})();const zT=new tn("NgModelWithFormControlWarning"),GY={provide:Jd,useExisting:Tr(()=>Ic)};let Ic=(()=>{class t extends Jd{constructor(e,i,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Xi,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(d4(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return Zw(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){l4(e.control||null,e,!1),function FY(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this.submitted=!0,x7(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(l4(i||null,e),(t=>t instanceof Kw)(r)&&(Zw(r,e,this.callSetDisabledState),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);b7(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function OY(t,n){return d4(t,n)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){OT(this.form,this),this._oldForm&&d4(this._oldForm,this)}_checkFormPresent(){}static{this.\u0275fac=function(i){return new(i||t)(st(id,10),st(E1,10),st(H_,8))}}static{this.\u0275dir=gi({type:t,selectors:[["","formGroup",""]],hostBindings:function(i,r){1&i&&qt("submit",function(c){return r.onSubmit(c)})("reset",function(){return r.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Vs([GY]),Kr,ol]})}}return t})();const YY={provide:D1,useExisting:Tr(()=>wh)};let wh=(()=>{class t extends D1{set isDisabled(e){}static{this._ngModelWarningSentOnce=!1}constructor(e,i,r,s,c){super(),this._ngModelWarningConfig=c,this._added=!1,this.name=null,this.update=new Xi,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=FT(0,s)}ngOnChanges(e){this._added||this._setUpControl(),LT(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return a4(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(i){return new(i||t)(st(Jd,13),st(id,10),st(E1,10),st(Wh,10),st(zT,8))}}static{this.\u0275dir=gi({type:t,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Vs([YY]),Kr,ol]})}}return t})();const XY={provide:Wh,useExisting:Tr(()=>w2),multi:!0};function P7(t,n){return null==t?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${t}: ${n}`.slice(0,50))}let w2=(()=>{class t extends j_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const r=P7(this._getOptionId(e),e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){const i=function KY(t){return t.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){1&i&&qt("change",function(c){return r.onChange(c.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[Vs([XY]),Kr]})}}return t})(),h4=(()=>{class t{constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(P7(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st(sc),st(w2,9))}}static{this.\u0275dir=gi({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return t})();const QY={provide:Wh,useExisting:Tr(()=>VT),multi:!0};function I7(t,n){return null==t?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${t}: ${n}`.slice(0,50))}let VT=(()=>{class t extends j_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let i;if(this.value=e,Array.isArray(e)){const r=e.map(s=>this._getOptionId(s));i=(s,c)=>{s._setSelected(r.indexOf(c.toString())>-1)}}else i=(r,s)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{const r=[],s=i.selectedOptions;if(void 0!==s){const c=s;for(let f=0;f<c.length;f++){const k=this._getOptionValue(c[f].value);r.push(k)}}else{const c=i.options;for(let f=0;f<c.length;f++){const y=c[f];if(y.selected){const k=this._getOptionValue(y.value);r.push(k)}}}this.value=r,e(r)}}_registerOption(e){const i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){const i=function JY(t){return t.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){1&i&&qt("change",function(c){return r.onChange(c.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[Vs([QY]),Kr]})}}return t})(),u4=(()=>{class t{constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(I7(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(I7(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st(sc),st(VT,9))}}static{this.\u0275dir=gi({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return t})();let U_=(()=>{class t{constructor(){this._validator=e4}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):e4,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=gi({type:t,features:[ol]})}}return t})();const nX={provide:id,useExisting:Tr(()=>p4),multi:!0};let p4=(()=>{class t extends U_{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=_2,this.createValidator=e=>ZR}enabled(e){return e}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){2&i&&La("required",r._enabled?"":null)},inputs:{required:"required"},features:[Vs([nX]),Kr]})}}return t})();const sX={provide:id,useExisting:Tr(()=>jT),multi:!0};let jT=(()=>{class t extends U_{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=e=>function O7(t){return"number"==typeof t?t:parseInt(t,10)}(e),this.createValidator=e=>QR(e)}static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275dir=gi({type:t,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){2&i&&La("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Vs([sX]),Kr]})}}return t})(),j7=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[E7]})}}return t})();class H7 extends s4{constructor(n,e,i){super(PT(e),IT(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,i={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(n,e={}){let i=this._adjustIndex(n);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,i={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){_7(this,0,n),n.forEach((i,r)=>{g7(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(n.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((i,r)=>{i.reset(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,i)=>!!i._syncPendingControls()||e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,i)=>{n(e,i)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function U7(t){return!!t&&(void 0!==t.asyncValidators||void 0!==t.validators||void 0!==t.updateOn)}let Ep=(()=>{class t{constructor(){this.useNonNullable=!1}get nonNullable(){const e=new t;return e.useNonNullable=!0,e}group(e,i=null){const r=this._reduceControls(e);let s={};return U7(i)?s=i:null!==i&&(s.validators=i.validator,s.asyncValidators=i.asyncValidator),new x2(r,s)}record(e,i=null){const r=this._reduceControls(e);return new y7(r,i)}control(e,i,r){let s={};return this.useNonNullable?(U7(i)?s=i:(s.validators=i,s.asyncValidators=r),new Kw(e,{...s,nonNullable:!0})):new Kw(e,i,r)}array(e,i,r){const s=e.map(c=>this._createControl(c));return new H7(s,i,r)}_reduceControls(e){const i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){return e instanceof Kw||e instanceof s4?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),q7=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:H_,useValue:e.callSetDisabledState??Ww}]}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[j7]})}}return t})(),$7=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:zT,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:H_,useValue:e.callSetDisabledState??Ww}]}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[j7]})}}return t})();function f4(...t){const n=ka(t),e=_s(t),{args:i,keys:r}=jR(t);if(0===i.length)return ti([],n);const s=new Jn(function lX(t,n,e=no){return i=>{W7(n,()=>{const{length:r}=t,s=new Array(r);let c=r,f=r;for(let y=0;y<r;y++)W7(n,()=>{const k=ti(t[y],n);let E=!1;k.subscribe(ui(i,F=>{s[y]=F,E||(E=!0,f--),f||i.next(e(s.slice()))},()=>{--c||i.complete()}))},i)},i)}}(i,n,r?c=>HR(r,c):no));return e?s.pipe(MT(e)):s}function W7(t,n,e){t?cr(e,t,n):n()}const m4=co(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function g4(...t){return function cX(){return ki(1)}()(ti(t,ka(t)))}function _4(t){return new Jn(n=>{tt(t()).subscribe(n)})}function q_(t,n){const e=Qi(t)?t:()=>t,i=r=>r.error(e());return new Jn(n?r=>n.schedule(i,0,r):i)}function HT(){return Lr((t,n)=>{let e=null;t._refCount++;const i=ui(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const r=t._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),n.unsubscribe()});t.subscribe(i),i.closed||(e=t.connect())})}class Z7 extends Jn{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,si(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new En;const e=this.getSubject();n.add(this.source.subscribe(ui(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),n.closed&&(this._connection=null,n=En.EMPTY)}return n}refCount(){return HT()(this)}}function Fu(t){return t<=0?()=>Si:Lr((n,e)=>{let i=0;n.subscribe(ui(e,r=>{++i<=t&&(e.next(r),t<=i&&e.complete())}))})}function y4(...t){const n=ka(t);return Lr((e,i)=>{(n?g4(t,e,n):g4(t,e)).subscribe(i)})}function rd(t,n){return Lr((e,i)=>{let r=0;e.subscribe(ui(i,s=>t.call(n,s,r++)&&i.next(s)))})}function v4(t){return Lr((n,e)=>{let i=!1;n.subscribe(ui(e,r=>{i=!0,e.next(r)},()=>{i||e.next(t),e.complete()}))})}function Y7(t=dX){return Lr((n,e)=>{let i=!1;n.subscribe(ui(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(t())))})}function dX(){return new m4}function $_(t,n){const e=arguments.length>=2;return i=>i.pipe(t?rd((r,s)=>t(r,s,i)):no,Fu(1),e?v4(n):Y7(()=>new m4))}function k2(t,n){return Qi(n)?fi(t,n,1):fi(t,1)}function Tl(t,n,e){const i=Qi(t)||n||e?{next:t,error:n,complete:e}:t;return i?Lr((r,s)=>{var c;null===(c=i.subscribe)||void 0===c||c.call(i);let f=!0;r.subscribe(ui(s,y=>{var k;null===(k=i.next)||void 0===k||k.call(i,y),s.next(y)},()=>{var y;f=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var k;f=!1,null===(k=i.error)||void 0===k||k.call(i,y),s.error(y)},()=>{var y,k;f&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(k=i.finalize)||void 0===k||k.call(i)}))}):no}function Zm(t){return Lr((n,e)=>{let s,i=null,r=!1;i=n.subscribe(ui(e,void 0,void 0,c=>{s=tt(t(c,Zm(t)(n))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function UT(t){return t<=0?()=>Si:Lr((n,e)=>{let i=[];n.subscribe(ui(e,r=>{i.push(r),t<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function M2(t){return Lr((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function b4(t){return Lr((n,e)=>{tt(t).subscribe(ui(e,()=>e.complete(),Gn)),!e.closed&&n.subscribe(e)})}const Wr="primary",ek=Symbol("RouteTitle");class mX{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function C2(t){return new mX(t)}function gX(t,n,e){const i=e.path.split("/");if(i.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||i.length<t.length))return null;const r={};for(let s=0;s<i.length;s++){const c=i[s],f=t[s];if(c.startsWith(":"))r[c.substring(1)]=f;else if(c!==f.path)return null}return{consumed:t.slice(0,i.length),posParams:r}}function If(t,n){const e=t?Object.keys(t):void 0,i=n?Object.keys(n):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!X7(t[r],n[r]))return!1;return!0}function X7(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),i=[...n].sort();return e.every((r,s)=>i[s]===r)}return t===n}function K7(t){return t.length>0?t[t.length-1]:null}function T1(t){return function G7(t){return!!t&&(t instanceof Jn||Qi(t.lift)&&Qi(t.subscribe))}(t)?t:v1(t)?ti(Promise.resolve(t)):Un(t)}const yX={exact:function eL(t,n,e){if(!G_(t.segments,n.segments)||!x4(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!eL(t.children[i],n.children[i],e))return!1;return!0},subset:tL},Q7={exact:function vX(t,n){return If(t,n)},subset:function bX(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>X7(t[e],n[e]))},ignored:()=>!0};function J7(t,n,e){return yX[e.paths](t.root,n.root,e.matrixParams)&&Q7[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function tL(t,n,e){return nL(t,n,n.segments,e)}function nL(t,n,e,i){if(t.segments.length>e.length){const r=t.segments.slice(0,e.length);return!(!G_(r,e)||n.hasChildren()||!x4(r,e,i))}if(t.segments.length===e.length){if(!G_(t.segments,e)||!x4(t.segments,e,i))return!1;for(const r in n.children)if(!t.children[r]||!tL(t.children[r],n.children[r],i))return!1;return!0}{const r=e.slice(0,t.segments.length),s=e.slice(t.segments.length);return!!(G_(t.segments,r)&&x4(t.segments,r,i)&&t.children[Wr])&&nL(t.children[Wr],n,s,i)}}function x4(t,n,e){return n.every((i,r)=>Q7[e](t[r].parameters,i.parameters))}class S2{constructor(n=new Ms([],{}),e={},i=null){this.root=n,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=C2(this.queryParams)),this._queryParamMap}toString(){return kX.serialize(this)}}class Ms{constructor(n,e){this.segments=n,this.children=e,this.parent=null,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return w4(this)}}class tk{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=C2(this.parameters)),this._parameterMap}toString(){return oL(this)}}function G_(t,n){return t.length===n.length&&t.every((e,i)=>e.path===n[i].path)}let nk=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return new qT},providedIn:"root"})}}return t})();class qT{parse(n){const e=new RX(n);return new S2(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${ik(n.root,!0)}`,i=function SX(t){const n=Object.keys(t).map(e=>{const i=t[e];return Array.isArray(i)?i.map(r=>`${k4(e)}=${k4(r)}`).join("&"):`${k4(e)}=${k4(i)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${i}${"string"==typeof n.fragment?`#${function MX(t){return encodeURI(t)}(n.fragment)}`:""}`}}const kX=new qT;function w4(t){return t.segments.map(n=>oL(n)).join("/")}function ik(t,n){if(!t.hasChildren())return w4(t);if(n){const e=t.children[Wr]?ik(t.children[Wr],!1):"",i=[];return Object.entries(t.children).forEach(([r,s])=>{r!==Wr&&i.push(`${r}:${ik(s,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function wX(t,n){let e=[];return Object.entries(t.children).forEach(([i,r])=>{i===Wr&&(e=e.concat(n(r,i)))}),Object.entries(t.children).forEach(([i,r])=>{i!==Wr&&(e=e.concat(n(r,i)))}),e}(t,(i,r)=>r===Wr?[ik(t.children[Wr],!1)]:[`${r}:${ik(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Wr]?`${w4(t)}/${e[0]}`:`${w4(t)}/(${e.join("//")})`}}function iL(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function k4(t){return iL(t).replace(/%3B/gi,";")}function $T(t){return iL(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function M4(t){return decodeURIComponent(t)}function rL(t){return M4(t.replace(/\+/g,"%20"))}function oL(t){return`${$T(t.path)}${function CX(t){return Object.keys(t).map(n=>`;${$T(n)}=${$T(t[n])}`).join("")}(t.parameters)}`}const EX=/^[^\/()?;#]+/;function GT(t){const n=t.match(EX);return n?n[0]:""}const DX=/^[^\/()?;=#]+/,AX=/^[^=?&#]+/,IX=/^[^&#]+/;class RX{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ms([],{}):new Ms([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(i[Wr]=new Ms(n,e)),i}parseSegment(){const n=GT(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Ht(4009,!1);return this.capture(n),new tk(M4(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=function TX(t){const n=t.match(DX);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=GT(this.remaining);r&&(i=r,this.capture(i))}n[M4(e)]=M4(i)}parseQueryParam(n){const e=function PX(t){const n=t.match(AX);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const c=function OX(t){const n=t.match(IX);return n?n[0]:""}(this.remaining);c&&(i=c,this.capture(i))}const r=rL(e),s=rL(i);if(n.hasOwnProperty(r)){let c=n[r];Array.isArray(c)||(c=[c],n[r]=c),c.push(s)}else n[r]=s}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=GT(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Ht(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):n&&(s=Wr);const c=this.parseChildren();e[s]=1===Object.keys(c).length?c[Wr]:new Ms([],c),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Ht(4011,!1)}}function sL(t){return t.segments.length>0?new Ms([],{[Wr]:t}):t}function aL(t){const n={};for(const i of Object.keys(t.children)){const s=aL(t.children[i]);if(i===Wr&&0===s.segments.length&&s.hasChildren())for(const[c,f]of Object.entries(s.children))n[c]=f;else(s.segments.length>0||s.hasChildren())&&(n[i]=s)}return function LX(t){if(1===t.numberOfChildren&&t.children[Wr]){const n=t.children[Wr];return new Ms(t.segments.concat(n.segments),n.children)}return t}(new Ms(t.segments,n))}function W_(t){return t instanceof S2}function lL(t){let n;const r=sL(function e(s){const c={};for(const y of s.children){const k=e(y);c[y.outlet]=k}const f=new Ms(s.url,c);return s===t&&(n=f),f}(t.root));return n??r}function cL(t,n,e,i){let r=t;for(;r.parent;)r=r.parent;if(0===n.length)return WT(r,r,r,e,i);const s=function zX(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new hL(!0,0,t);let n=0,e=!1;const i=t.reduce((r,s,c)=>{if("object"==typeof s&&null!=s){if(s.outlets){const f={};return Object.entries(s.outlets).forEach(([y,k])=>{f[y]="string"==typeof k?k.split("/"):k}),[...r,{outlets:f}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===c?(s.split("/").forEach((f,y)=>{0==y&&"."===f||(0==y&&""===f?e=!0:".."===f?n++:""!=f&&r.push(f))}),r):[...r,s]},[]);return new hL(e,n,i)}(n);if(s.toRoot())return WT(r,r,new Ms([],{}),e,i);const c=function NX(t,n,e){if(t.isAbsolute)return new S4(n,!0,0);if(!e)return new S4(n,!1,NaN);if(null===e.parent)return new S4(e,!0,0);const i=C4(t.commands[0])?0:1;return function BX(t,n,e){let i=t,r=n,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Ht(4005,!1);r=i.segments.length}return new S4(i,!1,r-s)}(e,e.segments.length-1+i,t.numberOfDoubleDots)}(s,r,t),f=c.processChildren?ok(c.segmentGroup,c.index,s.commands):uL(c.segmentGroup,c.index,s.commands);return WT(r,c.segmentGroup,f,e,i)}function C4(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function rk(t){return"object"==typeof t&&null!=t&&t.outlets}function WT(t,n,e,i,r){let c,s={};i&&Object.entries(i).forEach(([y,k])=>{s[y]=Array.isArray(k)?k.map(E=>`${E}`):`${k}`}),c=t===n?e:dL(t,n,e);const f=sL(aL(c));return new S2(f,s,r)}function dL(t,n,e){const i={};return Object.entries(t.children).forEach(([r,s])=>{i[r]=s===n?e:dL(s,n,e)}),new Ms(t.segments,i)}class hL{constructor(n,e,i){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=i,n&&i.length>0&&C4(i[0]))throw new Ht(4003,!1);const r=i.find(rk);if(r&&r!==K7(i))throw new Ht(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class S4{constructor(n,e,i){this.segmentGroup=n,this.processChildren=e,this.index=i}}function uL(t,n,e){if(t||(t=new Ms([],{})),0===t.segments.length&&t.hasChildren())return ok(t,n,e);const i=function jX(t,n,e){let i=0,r=n;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<t.segments.length;){if(i>=e.length)return s;const c=t.segments[r],f=e[i];if(rk(f))break;const y=`${f}`,k=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&k&&"object"==typeof k&&void 0===k.outlets){if(!fL(y,k,c))return s;i+=2}else{if(!fL(y,{},c))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(t,n,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const s=new Ms(t.segments.slice(0,i.pathIndex),{});return s.children[Wr]=new Ms(t.segments.slice(i.pathIndex),t.children),ok(s,0,r)}return i.match&&0===r.length?new Ms(t.segments,{}):i.match&&!t.hasChildren()?ZT(t,n,e):i.match?ok(t,0,r):ZT(t,n,e)}function ok(t,n,e){if(0===e.length)return new Ms(t.segments,{});{const i=function VX(t){return rk(t[0])?t[0].outlets:{[Wr]:t}}(e),r={};if(Object.keys(i).some(s=>s!==Wr)&&t.children[Wr]&&1===t.numberOfChildren&&0===t.children[Wr].segments.length){const s=ok(t.children[Wr],n,e);return new Ms(t.segments,s.children)}return Object.entries(i).forEach(([s,c])=>{"string"==typeof c&&(c=[c]),null!==c&&(r[s]=uL(t.children[s],n,c))}),Object.entries(t.children).forEach(([s,c])=>{void 0===i[s]&&(r[s]=c)}),new Ms(t.segments,r)}}function ZT(t,n,e){const i=t.segments.slice(0,n);let r=0;for(;r<e.length;){const s=e[r];if(rk(s)){const y=HX(s.outlets);return new Ms(i,y)}if(0===r&&C4(e[0])){i.push(new tk(t.segments[n].path,pL(e[0]))),r++;continue}const c=rk(s)?s.outlets[Wr]:`${s}`,f=r<e.length-1?e[r+1]:null;c&&f&&C4(f)?(i.push(new tk(c,pL(f))),r+=2):(i.push(new tk(c,{})),r++)}return new Ms(i,{})}function HX(t){const n={};return Object.entries(t).forEach(([e,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(n[e]=ZT(new Ms([],{}),0,i))}),n}function pL(t){const n={};return Object.entries(t).forEach(([e,i])=>n[e]=`${i}`),n}function fL(t,n,e){return t==e.path&&If(n,e.parameters)}const sk="imperative";class Of{constructor(n,e){this.id=n,this.url=e}}class E4 extends Of{constructor(n,e,i="imperative",r=null){super(n,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class A1 extends Of{constructor(n,e,i){super(n,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ak extends Of{constructor(n,e,i,r){super(n,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class E2 extends Of{constructor(n,e,i,r){super(n,e),this.reason=i,this.code=r,this.type=16}}class D4 extends Of{constructor(n,e,i,r){super(n,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class mL extends Of{constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class UX extends Of{constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qX extends Of{constructor(n,e,i,r,s){super(n,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $X extends Of{constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GX extends Of{constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WX{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ZX{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class YX{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class XX{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KX{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QX{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gL{constructor(n,e,i){this.routerEvent=n,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class YT{}class XT{constructor(n){this.url=n}}class JX{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new lk,this.attachRef=null}}let lk=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new JX,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class _L{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=KT(n,this._root);return e?e.children.map(i=>i.value):[]}firstChild(n){const e=KT(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=QT(n,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==n)}pathFromRoot(n){return QT(n,this._root).map(e=>e.value)}}function KT(t,n){if(t===n.value)return n;for(const e of n.children){const i=KT(t,e);if(i)return i}return null}function QT(t,n){if(t===n.value)return[n];for(const e of n.children){const i=QT(t,e);if(i.length)return i.unshift(n),i}return[]}class Ym{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function D2(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class yL extends _L{constructor(n,e){super(n),this.snapshot=e,JT(this,n)}toString(){return this.snapshot.toString()}}function vL(t,n){const e=function eK(t,n){const c=new T4([],{},{},"",{},Wr,n,null,{});return new xL("",new Ym(c,[]))}(0,n),i=new Is([new tk("",{})]),r=new Is({}),s=new Is({}),c=new Is({}),f=new Is(""),y=new Rf(i,r,c,f,s,Wr,n,e.root);return y.snapshot=e.root,new yL(new Ym(y,[]),e)}class Rf{constructor(n,e,i,r,s,c,f,y){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=c,this.component=f,this._futureSnapshot=y,this.title=this.dataSubject?.pipe(zi(k=>k[ek]))??Un(void 0),this.url=n,this.params=e,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(zi(n=>C2(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(zi(n=>C2(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bL(t,n="emptyOnly"){const e=t.pathFromRoot;let i=0;if("always"!==n)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function tK(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(i))}class T4{get title(){return this.data?.[ek]}constructor(n,e,i,r,s,c,f,y,k){this.url=n,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=c,this.component=f,this.routeConfig=y,this._resolve=k}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=C2(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=C2(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class xL extends _L{constructor(n,e){super(e),this.url=n,JT(this,e)}toString(){return wL(this._root)}}function JT(t,n){n.value._routerState=t,n.children.forEach(e=>JT(t,e))}function wL(t){const n=t.children.length>0?` { ${t.children.map(wL).join(", ")} } `:"";return`${t.value}${n}`}function eA(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,If(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),If(n.params,e.params)||t.paramsSubject.next(e.params),function _X(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!If(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.urlSubject.next(e.url),If(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function tA(t,n){const e=If(t.params,n.params)&&function xX(t,n){return G_(t,n)&&t.every((e,i)=>If(e.parameters,n[i].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||tA(t.parent,n.parent))}let T2=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Wr,this.activateEvents=new Xi,this.deactivateEvents=new Xi,this.attachEvents=new Xi,this.detachEvents=new Xi,this.parentContexts=Rn(lk),this.location=Rn(Ou),this.changeDetector=Rn(Pf),this.environmentInjector=Rn(Yd),this.inputBinder=Rn(A4,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){const{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ht(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ht(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ht(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Ht(4013,!1);this._activatedRoute=e;const r=this.location,c=e.snapshot.component,f=this.parentContexts.getOrCreateContext(this.name).children,y=new nK(e,f,r.injector);this.activated=r.createComponent(c,{index:r.length,injector:y,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=gi({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ol]})}}return t})();class nK{constructor(n,e,i){this.route=n,this.childContexts=e,this.parent=i}get(n,e){return n===Rf?this.route:n===lk?this.childContexts:this.parent.get(n,e)}}const A4=new tn("");let kL=(()=>{class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:i}=e,r=f4([i.queryParams,i.params,i.data]).pipe($o(([s,c,f],y)=>(f={...s,...c,...f},0===y?Un(f):Promise.resolve(f)))).subscribe(s=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(e);const c=function WG(t){const n=Wi(t);if(!n)return null;const e=new xf(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(i.component);if(c)for(const{templateName:f}of c.inputs)e.activatedComponentRef.setInput(f,s[f]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,r)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();function ck(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=n.value;const r=function rK(t,n,e){return n.children.map(i=>{for(const r of e.children)if(t.shouldReuseRoute(i.value,r.value.snapshot))return ck(t,i,r);return ck(t,i)})}(t,n,e);return new Ym(i,r)}{if(t.shouldAttach(n.value)){const s=t.retrieve(n.value);if(null!==s){const c=s.route;return c.value._futureSnapshot=n.value,c.children=n.children.map(f=>ck(t,f)),c}}const i=function oK(t){return new Rf(new Is(t.url),new Is(t.params),new Is(t.queryParams),new Is(t.fragment),new Is(t.data),t.outlet,t.component,t)}(n.value),r=n.children.map(s=>ck(t,s));return new Ym(i,r)}}const nA="ngNavigationCancelingError";function ML(t,n){const{redirectTo:e,navigationBehaviorOptions:i}=W_(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,r=CL(!1,0,n);return r.url=e,r.navigationBehaviorOptions=i,r}function CL(t,n,e){const i=new Error("NavigationCancelingError: "+(t||""));return i[nA]=!0,i.cancellationCode=n,e&&(i.url=e),i}function SL(t){return t&&t[nA]}let EL=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["ng-component"]],standalone:!0,features:[wO],decls:1,vars:0,template:function(i,r){1&i&&$e(0,"router-outlet")},dependencies:[T2],encapsulation:2})}}return t})();function iA(t){const n=t.children&&t.children.map(iA),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Wr&&(e.component=EL),e}function Dp(t){return t.outlet||Wr}function dk(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class pK{constructor(n,e,i,r,s){this.routeReuseStrategy=n,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(n){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,n),eA(this.futureState.root),this.activateChildRoutes(e,i,n)}deactivateChildRoutes(n,e,i){const r=D2(e);n.children.forEach(s=>{const c=s.value.outlet;this.deactivateRoutes(s,r[c],i),delete r[c]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(n,e,i){const r=n.value,s=e?e.value:null;if(r===s)if(r.component){const c=i.getContext(r.outlet);c&&this.deactivateChildRoutes(n,e,c.children)}else this.deactivateChildRoutes(n,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const i=e.getContext(n.value.outlet),r=i&&n.value.component?i.children:e,s=D2(n);for(const c of Object.keys(s))this.deactivateRouteAndItsChildren(s[c],r);if(i&&i.outlet){const c=i.outlet.detach(),f=i.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:c,route:n,contexts:f})}}deactivateRouteAndOutlet(n,e){const i=e.getContext(n.value.outlet),r=i&&n.value.component?i.children:e,s=D2(n);for(const c of Object.keys(s))this.deactivateRouteAndItsChildren(s[c],r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(n,e,i){const r=D2(e);n.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new QX(s.value.snapshot))}),n.children.length&&this.forwardEvent(new XX(n.value.snapshot))}activateRoutes(n,e,i){const r=n.value,s=e?e.value:null;if(eA(r),r===s)if(r.component){const c=i.getOrCreateContext(r.outlet);this.activateChildRoutes(n,e,c.children)}else this.activateChildRoutes(n,e,i);else if(r.component){const c=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const f=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),c.children.onOutletReAttached(f.contexts),c.attachRef=f.componentRef,c.route=f.route.value,c.outlet&&c.outlet.attach(f.componentRef,f.route.value),eA(f.route.value),this.activateChildRoutes(n,null,c.children)}else{const f=dk(r.snapshot);c.attachRef=null,c.route=r,c.injector=f,c.outlet&&c.outlet.activateWith(r,c.injector),this.activateChildRoutes(n,null,c.children)}}else this.activateChildRoutes(n,null,i)}}class DL{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class P4{constructor(n,e){this.component=n,this.route=e}}function fK(t,n,e){const i=t._root;return hk(i,n?n._root:null,e,[i.value])}function A2(t,n){const e=Symbol(),i=n.get(t,e);return i===e?"function"!=typeof t||function Uu(t){return null!==Ni(t)}(t)?n.get(t):t:i}function hk(t,n,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=D2(n);return t.children.forEach(c=>{(function gK(t,n,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=t.value,c=n?n.value:null,f=e?e.getContext(t.value.outlet):null;if(c&&s.routeConfig===c.routeConfig){const y=function _K(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!G_(t.url,n.url);case"pathParamsOrQueryParamsChange":return!G_(t.url,n.url)||!If(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!tA(t,n)||!If(t.queryParams,n.queryParams);default:return!tA(t,n)}}(c,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new DL(i)):(s.data=c.data,s._resolvedData=c._resolvedData),hk(t,n,s.component?f?f.children:null:e,i,r),y&&f&&f.outlet&&f.outlet.isActivated&&r.canDeactivateChecks.push(new P4(f.outlet.component,c))}else c&&uk(n,f,r),r.canActivateChecks.push(new DL(i)),hk(t,null,s.component?f?f.children:null:e,i,r)})(c,s[c.value.outlet],e,i.concat([c.value]),r),delete s[c.value.outlet]}),Object.entries(s).forEach(([c,f])=>uk(f,e.getContext(c),r)),r}function uk(t,n,e){const i=D2(t),r=t.value;Object.entries(i).forEach(([s,c])=>{uk(c,r.component?n?n.children.getContext(s):null:n,e)}),e.canDeactivateChecks.push(new P4(r.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,r))}function pk(t){return"function"==typeof t}function TL(t){return t instanceof m4||"EmptyError"===t?.name}const I4=Symbol("INITIAL_VALUE");function P2(){return $o(t=>f4(t.map(n=>n.pipe(Fu(1),y4(I4)))).pipe(zi(n=>{for(const e of n)if(!0!==e){if(e===I4)return I4;if(!1===e||e instanceof S2)return e}return!0}),rd(n=>n!==I4),Fu(1)))}function AL(t){return function wa(...t){return Pi(t)}(Tl(n=>{if(W_(n))throw ML(0,n)}),zi(n=>!0===n))}class O4{constructor(n){this.segmentGroup=n||null}}class PL{constructor(n){this.urlTree=n}}function I2(t){return q_(new O4(t))}function IL(t){return q_(new PL(t))}class zK{constructor(n,e){this.urlSerializer=n,this.urlTree=e}noMatchError(n){return new Ht(4002,!1)}lineralizeSegments(n,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Un(i);if(r.numberOfChildren>1||!r.children[Wr])return q_(new Ht(4e3,!1));r=r.children[Wr]}}applyRedirectCommands(n,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,i)}applyRedirectCreateUrlTree(n,e,i,r){const s=this.createSegmentGroup(n,e.root,i,r);return new S2(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const i={};return Object.entries(n).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const f=s.substring(1);i[r]=e[f]}else i[r]=s}),i}createSegmentGroup(n,e,i,r){const s=this.createSegments(n,e.segments,i,r);let c={};return Object.entries(e.children).forEach(([f,y])=>{c[f]=this.createSegmentGroup(n,y,i,r)}),new Ms(s,c)}createSegments(n,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(n,s,r):this.findOrReturn(s,i))}findPosParam(n,e,i){const r=i[e.path.substring(1)];if(!r)throw new Ht(4001,!1);return r}findOrReturn(n,e){let i=0;for(const r of e){if(r.path===n.path)return e.splice(i),r;i++}return n}}const rA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function NK(t,n,e,i,r){const s=oA(t,n,e);return s.matched?(i=function aK(t,n){return t.providers&&!t._injector&&(t._injector=vD(t.providers,n,`Route: ${t.path}`)),t._injector??n}(n,i),function RK(t,n,e,i){const r=n.canMatch;return r&&0!==r.length?Un(r.map(c=>{const f=A2(c,t);return T1(function kK(t){return t&&pk(t.canMatch)}(f)?f.canMatch(n,e):t.runInContext(()=>f(n,e)))})).pipe(P2(),AL()):Un(!0)}(i,n,e).pipe(zi(c=>!0===c?s:{...rA}))):Un(s)}function oA(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...rA}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const r=(n.matcher||gX)(e,t,n);if(!r)return{...rA};const s={};Object.entries(r.posParams??{}).forEach(([f,y])=>{s[f]=y.path});const c=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:c,positionalParamSegments:r.posParams??{}}}function OL(t,n,e,i){return e.length>0&&function jK(t,n,e){return e.some(i=>R4(t,n,i)&&Dp(i)!==Wr)}(t,e,i)?{segmentGroup:new Ms(n,VK(i,new Ms(e,t.children))),slicedSegments:[]}:0===e.length&&function HK(t,n,e){return e.some(i=>R4(t,n,i))}(t,e,i)?{segmentGroup:new Ms(t.segments,BK(t,0,e,i,t.children)),slicedSegments:e}:{segmentGroup:new Ms(t.segments,t.children),slicedSegments:e}}function BK(t,n,e,i,r){const s={};for(const c of i)if(R4(t,e,c)&&!r[Dp(c)]){const f=new Ms([],{});s[Dp(c)]=f}return{...r,...s}}function VK(t,n){const e={};e[Wr]=n;for(const i of t)if(""===i.path&&Dp(i)!==Wr){const r=new Ms([],{});e[Dp(i)]=r}return e}function R4(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}class GK{constructor(n,e,i,r,s,c,f){this.injector=n,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=c,this.urlSerializer=f,this.allowRedirects=!0,this.applyRedirects=new zK(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ht(4002,!1)}recognize(){const n=OL(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,Wr).pipe(Zm(e=>{if(e instanceof PL)return this.allowRedirects=!1,this.urlTree=e.urlTree,this.match(e.urlTree);throw e instanceof O4?this.noMatchError(e):e}),zi(e=>{const i=new T4([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Wr,this.rootComponentType,null,{}),r=new Ym(i,e),s=new xL("",r),c=function FX(t,n,e=null,i=null){return cL(lL(t),n,e,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return c.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(c),this.inheritParamsAndData(s._root),{state:s,tree:c}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,Wr).pipe(Zm(i=>{throw i instanceof O4?this.noMatchError(i):i}))}inheritParamsAndData(n){const e=n.value,i=bL(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),n.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(n,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(n,e,i):this.processSegment(n,e,i,i.segments,r,!0)}processChildren(n,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return ti(r).pipe(k2(s=>{const c=i.children[s],f=function hK(t,n){const e=t.filter(i=>Dp(i)===n);return e.push(...t.filter(i=>Dp(i)!==n)),e}(e,s);return this.processSegmentGroup(n,f,c,s)}),function uX(t,n){return Lr(function hX(t,n,e,i,r){return(s,c)=>{let f=e,y=n,k=0;s.subscribe(ui(c,E=>{const F=k++;y=f?t(y,E,F):(f=!0,E),i&&c.next(y)},r&&(()=>{f&&c.next(y),c.complete()})))}}(t,n,arguments.length>=2,!0))}((s,c)=>(s.push(...c),s)),v4(null),function pX(t,n){const e=arguments.length>=2;return i=>i.pipe(t?rd((r,s)=>t(r,s,i)):no,UT(1),e?v4(n):Y7(()=>new m4))}(),fi(s=>{if(null===s)return I2(i);const c=RL(s);return function WK(t){t.sort((n,e)=>n.value.outlet===Wr?-1:e.value.outlet===Wr?1:n.value.outlet.localeCompare(e.value.outlet))}(c),Un(c)}))}processSegment(n,e,i,r,s,c){return ti(e).pipe(k2(f=>this.processSegmentAgainstRoute(f._injector??n,e,f,i,r,s,c).pipe(Zm(y=>{if(y instanceof O4)return Un(null);throw y}))),$_(f=>!!f),Zm(f=>{if(TL(f))return function qK(t,n,e){return 0===n.length&&!t.children[e]}(i,r,s)?Un([]):I2(i);throw f}))}processSegmentAgainstRoute(n,e,i,r,s,c,f){return function UK(t,n,e,i){return!!(Dp(t)===i||i!==Wr&&R4(n,e,t))&&("**"===t.path||oA(n,t,e).matched)}(i,r,s,c)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(n,r,i,s,c,f):f&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,r,e,i,s,c):I2(r):I2(r)}expandSegmentAgainstRouteUsingRedirect(n,e,i,r,s,c){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,i,r,c):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,r,s,c)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,i,r){const s=this.applyRedirects.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?IL(s):this.applyRedirects.lineralizeSegments(i,s).pipe(fi(c=>{const f=new Ms(c,{});return this.processSegment(n,e,f,c,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,r,s,c){const{matched:f,consumedSegments:y,remainingSegments:k,positionalParamSegments:E}=oA(e,r,s);if(!f)return I2(e);const F=this.applyRedirects.applyRedirectCommands(y,r.redirectTo,E);return r.redirectTo.startsWith("/")?IL(F):this.applyRedirects.lineralizeSegments(r,F).pipe(fi($=>this.processSegment(n,i,e,$.concat(k),c,!1)))}matchSegmentAgainstRoute(n,e,i,r,s,c){let f;if("**"===i.path){const y=r.length>0?K7(r).parameters:{};f=Un({snapshot:new T4(r,y,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,LL(i),Dp(i),i.component??i._loadedComponent??null,i,FL(i)),consumedSegments:[],remainingSegments:[]}),e.children={}}else f=NK(e,i,r,n).pipe(zi(({matched:y,consumedSegments:k,remainingSegments:E,parameters:F})=>y?{snapshot:new T4(k,F,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,LL(i),Dp(i),i.component??i._loadedComponent??null,i,FL(i)),consumedSegments:k,remainingSegments:E}:null));return f.pipe($o(y=>null===y?I2(e):this.getChildConfig(n=i._injector??n,i,r).pipe($o(({routes:k})=>{const E=i._loadedInjector??n,{snapshot:F,consumedSegments:$,remainingSegments:W}=y,{segmentGroup:re,slicedSegments:he}=OL(e,$,W,k);if(0===he.length&&re.hasChildren())return this.processChildren(E,k,re).pipe(zi(Pe=>null===Pe?null:[new Ym(F,Pe)]));if(0===k.length&&0===he.length)return Un([new Ym(F,[])]);const me=Dp(i)===s;return this.processSegment(E,k,re,he,me?Wr:s,!0).pipe(zi(Pe=>[new Ym(F,Pe)]))}))))}getChildConfig(n,e,i){return e.children?Un({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?Un({routes:e._loadedRoutes,injector:e._loadedInjector}):function OK(t,n,e,i){const r=n.canLoad;return void 0===r||0===r.length?Un(!0):Un(r.map(c=>{const f=A2(c,t);return T1(function vK(t){return t&&pk(t.canLoad)}(f)?f.canLoad(n,e):t.runInContext(()=>f(n,e)))})).pipe(P2(),AL())}(n,e,i).pipe(fi(r=>r?this.configLoader.loadChildren(n,e).pipe(Tl(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function FK(t){return q_(CL(!1,3))}())):Un({routes:[],injector:n})}}function ZK(t){const n=t.value.routeConfig;return n&&""===n.path}function RL(t){const n=[],e=new Set;for(const i of t){if(!ZK(i)){n.push(i);continue}const r=n.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):n.push(i)}for(const i of e){const r=RL(i.children);n.push(new Ym(i.value,r))}return n.filter(i=>!e.has(i))}function LL(t){return t.data||{}}function FL(t){return t.resolve||{}}function zL(t){return"string"==typeof t.title||null===t.title}function sA(t){return $o(n=>{const e=t(n);return e?ti(e).pipe(zi(()=>n)):Un(n)})}const O2=new tn("ROUTES");let aA=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Rn(p8)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Un(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=T1(e.loadComponent()).pipe(zi(NL),Tl(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),M2(()=>{this.componentLoaders.delete(e)})),r=new Z7(i,()=>new Sn).pipe(HT());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Un({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=function tQ(t,n,e,i){return T1(t.loadChildren()).pipe(zi(NL),fi(r=>r instanceof bO||Array.isArray(r)?Un(r):ti(n.compileModuleAsync(r))),zi(r=>{i&&i(t);let s,c,f=!1;return Array.isArray(r)?(c=r,!0):(s=r.create(e).injector,c=s.get(O2,[],{optional:!0,self:!0}).flat()),{routes:c.map(iA),injector:s}}))}(i,this.compiler,e,this.onLoadEndListener).pipe(M2(()=>{this.childrenLoaders.delete(i)})),c=new Z7(s,()=>new Sn).pipe(HT());return this.childrenLoaders.set(i,c),c}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function NL(t){return function nQ(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let L4=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Sn,this.transitionAbortSubject=new Sn,this.configLoader=Rn(aA),this.environmentInjector=Rn(Yd),this.urlSerializer=Rn(nk),this.rootContexts=Rn(lk),this.inputBindingEnabled=null!==Rn(A4,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Un(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new ZX(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new WX(r))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:i})}setupNavigations(e,i,r){return this.transitions=new Is({id:0,currentUrlTree:i,currentRawUrl:i,currentBrowserUrl:i,extractedUrl:e.urlHandlingStrategy.extract(i),urlAfterRedirects:e.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:sk,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(rd(s=>0!==s.id),zi(s=>({...s,extractedUrl:e.urlHandlingStrategy.extract(s.rawUrl)})),$o(s=>{this.currentTransition=s;let c=!1,f=!1;return Un(s).pipe(Tl(y=>{this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),$o(y=>{const k=y.currentBrowserUrl.toString(),E=!e.navigated||y.extractedUrl.toString()!==k||k!==y.currentUrlTree.toString();if(!E&&"reload"!==(y.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const $="";return this.events.next(new E2(y.id,this.urlSerializer.serialize(y.rawUrl),$,0)),y.resolve(null),Si}if(e.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return Un(y).pipe($o($=>{const W=this.transitions?.getValue();return this.events.next(new E4($.id,this.urlSerializer.serialize($.extractedUrl),$.source,$.restoredState)),W!==this.transitions?.getValue()?Si:Promise.resolve($)}),function YK(t,n,e,i,r,s){return fi(c=>function $K(t,n,e,i,r,s,c="emptyOnly"){return new GK(t,n,e,i,r,c,s).recognize()}(t,n,e,i,c.extractedUrl,r,s).pipe(zi(({state:f,tree:y})=>({...c,targetSnapshot:f,urlAfterRedirects:y}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),Tl($=>{s.targetSnapshot=$.targetSnapshot,s.urlAfterRedirects=$.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:$.urlAfterRedirects};const W=new mL($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(W)}));if(E&&e.urlHandlingStrategy.shouldProcessUrl(y.currentRawUrl)){const{id:$,extractedUrl:W,source:re,restoredState:he,extras:me}=y,Pe=new E4($,this.urlSerializer.serialize(W),re,he);this.events.next(Pe);const Re=vL(0,this.rootComponentType).snapshot;return this.currentTransition=s={...y,targetSnapshot:Re,urlAfterRedirects:W,extras:{...me,skipLocationChange:!1,replaceUrl:!1}},Un(s)}{const $="";return this.events.next(new E2(y.id,this.urlSerializer.serialize(y.extractedUrl),$,1)),y.resolve(null),Si}}),Tl(y=>{const k=new UX(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot);this.events.next(k)}),zi(y=>(this.currentTransition=s={...y,guards:fK(y.targetSnapshot,y.currentSnapshot,this.rootContexts)},s)),function CK(t,n){return fi(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:c}}=e;return 0===c.length&&0===s.length?Un({...e,guardsResult:!0}):function SK(t,n,e,i){return ti(t).pipe(fi(r=>function IK(t,n,e,i,r){const s=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return s&&0!==s.length?Un(s.map(f=>{const y=dk(n)??r,k=A2(f,y);return T1(function wK(t){return t&&pk(t.canDeactivate)}(k)?k.canDeactivate(t,n,e,i):y.runInContext(()=>k(t,n,e,i))).pipe($_())})).pipe(P2()):Un(!0)}(r.component,r.route,e,n,i)),$_(r=>!0!==r,!0))}(c,i,r,t).pipe(fi(f=>f&&function yK(t){return"boolean"==typeof t}(f)?function EK(t,n,e,i){return ti(n).pipe(k2(r=>g4(function TK(t,n){return null!==t&&n&&n(new YX(t)),Un(!0)}(r.route.parent,i),function DK(t,n){return null!==t&&n&&n(new KX(t)),Un(!0)}(r.route,i),function PK(t,n,e){const i=n[n.length-1],s=n.slice(0,n.length-1).reverse().map(c=>function mK(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(c)).filter(c=>null!==c).map(c=>_4(()=>Un(c.guards.map(y=>{const k=dk(c.node)??e,E=A2(y,k);return T1(function xK(t){return t&&pk(t.canActivateChild)}(E)?E.canActivateChild(i,t):k.runInContext(()=>E(i,t))).pipe($_())})).pipe(P2())));return Un(s).pipe(P2())}(t,r.path,e),function AK(t,n,e){const i=n.routeConfig?n.routeConfig.canActivate:null;if(!i||0===i.length)return Un(!0);const r=i.map(s=>_4(()=>{const c=dk(n)??e,f=A2(s,c);return T1(function bK(t){return t&&pk(t.canActivate)}(f)?f.canActivate(n,t):c.runInContext(()=>f(n,t))).pipe($_())}));return Un(r).pipe(P2())}(t,r.route,e))),$_(r=>!0!==r,!0))}(i,s,t,n):Un(f)),zi(f=>({...e,guardsResult:f})))})}(this.environmentInjector,y=>this.events.next(y)),Tl(y=>{if(s.guardsResult=y.guardsResult,W_(y.guardsResult))throw ML(0,y.guardsResult);const k=new qX(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.events.next(k)}),rd(y=>!!y.guardsResult||(this.cancelNavigationTransition(y,"",3),!1)),sA(y=>{if(y.guards.canActivateChecks.length)return Un(y).pipe(Tl(k=>{const E=new $X(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(E)}),$o(k=>{let E=!1;return Un(k).pipe(function XK(t,n){return fi(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Un(e);let s=0;return ti(r).pipe(k2(c=>function KK(t,n,e,i){const r=t.routeConfig,s=t._resolve;return void 0!==r?.title&&!zL(r)&&(s[ek]=r.title),function QK(t,n,e,i){const r=function JK(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===r.length)return Un({});const s={};return ti(r).pipe(fi(c=>function eQ(t,n,e,i){const r=dk(n)??i,s=A2(t,r);return T1(s.resolve?s.resolve(n,e):r.runInContext(()=>s(n,e)))}(t[c],n,e,i).pipe($_(),Tl(f=>{s[c]=f}))),UT(1),function fX(t){return zi(()=>t)}(s),Zm(c=>TL(c)?Si:q_(c)))}(s,t,n,i).pipe(zi(c=>(t._resolvedData=c,t.data=bL(t,e).resolve,r&&zL(r)&&(t.data[ek]=r.title),null)))}(c.route,i,t,n)),Tl(()=>s++),UT(1),fi(c=>s===r.length?Un(e):Si))})}(e.paramsInheritanceStrategy,this.environmentInjector),Tl({next:()=>E=!0,complete:()=>{E||this.cancelNavigationTransition(k,"",2)}}))}),Tl(k=>{const E=new GX(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(E)}))}),sA(y=>{const k=E=>{const F=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&F.push(this.configLoader.loadComponent(E.routeConfig).pipe(Tl($=>{E.component=$}),zi(()=>{})));for(const $ of E.children)F.push(...k($));return F};return f4(k(y.targetSnapshot.root)).pipe(v4(),Fu(1))}),sA(()=>this.afterPreactivation()),zi(y=>{const k=function iK(t,n,e){const i=ck(t,n._root,e?e._root:void 0);return new yL(i,n)}(e.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return this.currentTransition=s={...y,targetRouterState:k},s}),Tl(()=>{this.events.next(new YT)}),((t,n,e,i)=>zi(r=>(new pK(n,r.targetRouterState,r.currentRouterState,e,i).activate(t),r)))(this.rootContexts,e.routeReuseStrategy,y=>this.events.next(y),this.inputBindingEnabled),Fu(1),Tl({next:y=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new A1(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects))),e.titleStrategy?.updateTitle(y.targetRouterState.snapshot),y.resolve(!0)},complete:()=>{c=!0}}),b4(this.transitionAbortSubject.pipe(Tl(y=>{throw y}))),M2(()=>{c||f||this.cancelNavigationTransition(s,"",1),this.currentNavigation?.id===s.id&&(this.currentNavigation=null)}),Zm(y=>{if(f=!0,SL(y))this.events.next(new ak(s.id,this.urlSerializer.serialize(s.extractedUrl),y.message,y.cancellationCode)),function sK(t){return SL(t)&&W_(t.url)}(y)?this.events.next(new XT(y.url)):s.resolve(!1);else{this.events.next(new D4(s.id,this.urlSerializer.serialize(s.extractedUrl),y,s.targetSnapshot??void 0));try{s.resolve(e.errorHandler(y))}catch(k){s.reject(k)}}return Si}))}))}cancelNavigationTransition(e,i,r){const s=new ak(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(s),e.resolve(!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function BL(t){return t!==sk}let VL=(()=>{class t{buildTitle(e){let i,r=e.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===Wr);return i}getResolvedTitleForRoute(e){return e.data[ek]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return Rn(iQ)},providedIn:"root"})}}return t})(),iQ=(()=>{class t extends VL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||t)(Dt(FR))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),rQ=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return Rn(sQ)},providedIn:"root"})}}return t})();class oQ{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let sQ=(()=>{class t extends oQ{static{this.\u0275fac=function(){let e;return function(r){return(e||(e=V(t)))(r||t)}}()}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const F4=new tn("",{providedIn:"root",factory:()=>({})});let aQ=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:function(){return Rn(lQ)},providedIn:"root"})}}return t})(),lQ=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var fk=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(fk||{});function jL(t,n){t.events.pipe(rd(e=>e instanceof A1||e instanceof ak||e instanceof D4||e instanceof E2),zi(e=>e instanceof A1||e instanceof E2?fk.COMPLETE:e instanceof ak&&(0===e.code||1===e.code)?fk.REDIRECTING:fk.FAILED),rd(e=>e!==fk.REDIRECTING),Fu(1)).subscribe(()=>{n()})}function cQ(t){throw t}function dQ(t,n,e){return n.parse("/")}const hQ={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},uQ={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Na=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Rn(u8),this.isNgZoneEnabled=!1,this._events=new Sn,this.options=Rn(F4,{optional:!0})||{},this.pendingTasks=Rn(I3),this.errorHandler=this.options.errorHandler||cQ,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||dQ,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Rn(aQ),this.routeReuseStrategy=Rn(rQ),this.titleStrategy=Rn(VL),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Rn(O2,{optional:!0})?.flat()??[],this.navigationTransitions=Rn(L4),this.urlSerializer=Rn(nk),this.location=Rn(Nw),this.componentInputBindingEnabled=!!Rn(A4,{optional:!0}),this.eventsSubscription=new En,this.isNgZoneEnabled=Rn(Mr)instanceof Mr&&Mr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new S2,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=vL(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(i=>{try{const{currentTransition:r}=this.navigationTransitions;if(null===r)return void(HL(i)&&this._events.next(i));if(i instanceof E4)BL(r.source)&&(this.browserUrlTree=r.extractedUrl);else if(i instanceof E2)this.rawUrlTree=r.rawUrl;else if(i instanceof mL){if("eager"===this.urlUpdateStrategy){if(!r.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl);this.setBrowserUrl(s,r)}this.browserUrlTree=r.urlAfterRedirects}}else if(i instanceof YT)this.currentUrlTree=r.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r),this.browserUrlTree=r.urlAfterRedirects);else if(i instanceof ak)0!==i.code&&1!==i.code&&(this.navigated=!0),(3===i.code||2===i.code)&&this.restoreHistory(r);else if(i instanceof XT){const s=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),c={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||BL(r.source)};this.scheduleNavigation(s,sk,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}i instanceof D4&&this.restoreHistory(r,!0),i instanceof A1&&(this.navigated=!0),HL(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),sk,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,i,e.state)},0)}))}navigateToSyncWithBrowser(e,i,r){const s={replaceUrl:!0},c=r?.navigationId?r:null;if(r){const y={...r};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const f=this.parseUrl(e);this.scheduleNavigation(f,i,c,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(iA),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:c,queryParamsHandling:f,preserveFragment:y}=i,k=y?this.currentUrlTree.fragment:c;let F,E=null;switch(f){case"merge":E={...this.currentUrlTree.queryParams,...s};break;case"preserve":E=this.currentUrlTree.queryParams;break;default:E=s||null}null!==E&&(E=this.removeEmptyProps(E));try{F=lL(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||!e[0].startsWith("/"))&&(e=[]),F=this.currentUrlTree.root}return cL(F,e,E,k??null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=W_(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,sk,null,i)}navigate(e,i={skipLocationChange:!1}){return function pQ(t){for(let n=0;n<t.length;n++)if(null==t[n])throw new Ht(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?{...hQ}:!1===i?{...uQ}:i,W_(e))return J7(this.currentUrlTree,e,r);const s=this.parseUrl(e);return J7(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}scheduleNavigation(e,i,r,s,c){if(this.disposed)return Promise.resolve(!1);let f,y,k;c?(f=c.resolve,y=c.reject,k=c.promise):k=new Promise((F,$)=>{f=F,y=$});const E=this.pendingTasks.add();return jL(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(E))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:e,extras:s,resolve:f,reject:y,promise:k,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),k.catch(F=>Promise.reject(F))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const c={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",c)}else{const s={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(r,"",s)}}restoreHistory(e,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-this.browserPageId;0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function HL(t){return!(t instanceof YT||t instanceof XT)}let od=(()=>{class t{constructor(e,i,r,s,c,f){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=c,this.locationStrategy=f,this.href=null,this.commands=null,this.onChanges=new Sn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const y=c.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===y||"area"===y,this.isAnchorElement?this.subscription=e.events.subscribe(k=>{k instanceof A1&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(e,i,r,s,c){return!!(null===this.urlTree||this.isAnchorElement&&(0!==e||i||r||s||c||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const e=null===this.href?null:function ux(t,n,e){return function QM(t,n){return"src"===n&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===n&&("base"===t||"link"===t)?YM:fs}(n,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",e)}applyAttributeValue(e,i){const r=this.renderer,s=this.el.nativeElement;null!==i?r.setAttribute(s,e,i):r.removeAttribute(s,e)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(i){return new(i||t)(st(Na),st(Rf),function Q(t){return function Jp(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(Ih(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===n)return e[r+1];r+=2}}}return null}(Ml(),t)}("tabindex"),st(sc),st(ns),st(B_))}}static{this.\u0275dir=gi({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){1&i&&qt("click",function(c){return r.onClick(c.button,c.ctrlKey,c.shiftKey,c.altKey,c.metaKey)}),2&i&&La("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",_2],skipLocationChange:["skipLocationChange","skipLocationChange",_2],replaceUrl:["replaceUrl","replaceUrl",_2],routerLink:"routerLink"},standalone:!0,features:[s3,ol]})}}return t})(),R2=(()=>{class t{get isActive(){return this._isActive}constructor(e,i,r,s,c){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=c,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Xi,this.routerEventsSubscription=e.events.subscribe(f=>{f instanceof A1&&this.update()})}ngAfterContentInit(){Un(this.links.changes,Un(null)).pipe(ki()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const e=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=ti(e).pipe(ki()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const e=this.hasActiveLinks();this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function fQ(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&e.isActive(r.urlTree,i)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static{this.\u0275fac=function(i){return new(i||t)(st(Na),st(ns),st(sc),st(Pf),st(od,8))}}static{this.\u0275dir=gi({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,s){if(1&i&&Ac(s,od,5),2&i){let c;js(c=Hs())&&(r.links=c)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[ol]})}}return t})();class UL{}let mQ=(()=>{class t{constructor(e,i,r,s,c){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe(rd(e=>e instanceof A1),k2(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=vD(s.providers,e,`Route: ${s.path}`));const c=s._injector??e,f=s._loadedInjector??c;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(c,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(f,s.children??s._loadedRoutes))}return ti(r).pipe(ki())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Un(null);const s=r.pipe(fi(c=>null===c?Un(void 0):(i._loadedRoutes=c.routes,i._loadedInjector=c.injector,this.processRoutes(c.injector??e,c.routes))));return i.loadComponent&&!i._loadedComponent?ti([s,this.loader.loadComponent(i)]).pipe(ki()):s})}static{this.\u0275fac=function(i){return new(i||t)(Dt(Na),Dt(p8),Dt(Yd),Dt(UL),Dt(aA))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const lA=new tn("");let qL=(()=>{class t{constructor(e,i,r,s,c={}){this.urlSerializer=e,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof E4?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof A1?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof E2&&0===e.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof gL&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new gL(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){p1()}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();function Xm(t,n){return{\u0275kind:t,\u0275providers:n}}function GL(){const t=Rn(ws);return n=>{const e=t.get(k1);if(n!==e.components[0])return;const i=t.get(Na),r=t.get(WL);1===t.get(cA)&&i.initialNavigation(),t.get(ZL,null,Fi.Optional)?.setUpPreloading(),t.get(lA,null,Fi.Optional)?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const WL=new tn("",{factory:()=>new Sn}),cA=new tn("",{providedIn:"root",factory:()=>1}),ZL=new tn("");function vQ(t){return Xm(0,[{provide:ZL,useExisting:mQ},{provide:UL,useExisting:t}])}const YL=new tn("ROUTER_FORROOT_GUARD"),xQ=[Nw,{provide:nk,useClass:qT},Na,lk,{provide:Rf,useFactory:function $L(t){return t.routerState.root},deps:[Na]},aA,[]];function wQ(){return new b8("Router",Na)}let XL=(()=>{class t{constructor(e){}static forRoot(e,i){return{ngModule:t,providers:[xQ,[],{provide:O2,multi:!0,useValue:e},{provide:YL,useFactory:SQ,deps:[[Na,new oo,new vo]]},{provide:F4,useValue:i||{}},i?.useHash?{provide:B_,useClass:QG}:{provide:B_,useClass:K8},{provide:lA,useFactory:()=>{const t=Rn(uZ),n=Rn(Mr),e=Rn(F4),i=Rn(L4),r=Rn(nk);return e.scrollOffset&&t.setOffset(e.scrollOffset),new qL(r,i,t,n,e)}},i?.preloadingStrategy?vQ(i.preloadingStrategy).\u0275providers:[],{provide:b8,multi:!0,useFactory:wQ},i?.initialNavigation?EQ(i):[],i?.bindToComponentInputs?Xm(8,[kL,{provide:A4,useExisting:kL}]).\u0275providers:[],[{provide:KL,useFactory:GL},{provide:jD,multi:!0,useExisting:KL}]]}}static forChild(e){return{ngModule:t,providers:[{provide:O2,multi:!0,useValue:e}]}}static{this.\u0275fac=function(i){return new(i||t)(Dt(YL,8))}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})();function SQ(t){return"guarded"}function EQ(t){return["disabled"===t.initialNavigation?Xm(3,[{provide:OD,multi:!0,useFactory:()=>{const n=Rn(Na);return()=>{n.setUpLocationChangeListener()}}},{provide:cA,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Xm(2,[{provide:cA,useValue:0},{provide:OD,multi:!0,deps:[ws],useFactory:n=>{const e=n.get(XG,Promise.resolve());return()=>e.then(()=>new Promise(i=>{const r=n.get(Na),s=n.get(WL);jL(r,()=>{i(!0)}),n.get(L4).afterPreactivation=()=>(i(!0),s.closed?Un(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const KL=new tn(""),TQ=new tn("JWT_OPTIONS");let AQ=(()=>{class t{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let i=e.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(i)}b64decode(e){let r="";if((e=String(e).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let c,f,s=0,y=0;f=e.charAt(y++);~f&&(c=s%4?64*c+f:f,s++%4)?r+=String.fromCharCode(255&c>>(-2*s&6)):0)f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(i=>this._decodeToken(i)):this._decodeToken(e)}_decodeToken(e){if(!e||""===e)return null;const i=e.split(".");if(3!==i.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const r=this.urlBase64Decode(i[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(i=>this._getTokenExpirationDate(i)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let i;if(i=this.decodeToken(e),!i||!i.hasOwnProperty("exp"))return null;const r=new Date(0);return r.setUTCSeconds(i.exp),r}isTokenExpired(e=this.tokenGetter(),i){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,i)):this._isTokenExpired(e,i)}_isTokenExpired(e,i){if(!e||""===e)return!0;const r=this.getTokenExpirationDate(e);return i=i||0,null!==r&&!(r.valueOf()>(new Date).valueOf()+1e3*i)}getAuthScheme(e,i){return"function"==typeof e?e(i):e}}return t.\u0275fac=function(e){return new(e||t)(Dt(TQ))},t.\u0275prov=vn({token:t,factory:t.\u0275fac}),t})();class z4{}class N4{}class Lf{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),c=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(c):this.headers.set(s,[c])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,i)=>{this.setHeaderEntries(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof Lf?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new Lf;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Lf?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let i=n.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(n.name,e);const r=("a"===n.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=n.value;if(s){let c=this.headers.get(e);if(!c)return;c=c.filter(f=>-1===s.indexOf(f)),0===c.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,c)}else this.headers.delete(e),this.normalizedNames.delete(e)}}setHeaderEntries(n,e){const i=(Array.isArray(e)?e:[e]).map(s=>s.toString()),r=n.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(n,r)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class PQ{encodeKey(n){return QL(n)}encodeValue(n){return QL(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const OQ=/%(\d[a-f0-9])/gi,RQ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function QL(t){return encodeURIComponent(t).replace(OQ,(n,e)=>RQ[e]??n)}function B4(t){return`${t}`}class P1{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new PQ,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function IQ(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[c,f]=-1==s?[n.decodeKey(r),""]:[n.decodeKey(r.slice(0,s)),n.decodeValue(r.slice(s+1))],y=e.get(c)||[];y.push(f),e.set(c,y)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const i=n.fromObject[e],r=Array.isArray(i)?i.map(B4):[B4(i)];this.map.set(e,r)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(i=>{const r=n[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new P1({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(B4(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let i=this.map.get(n.param)||[];const r=i.indexOf(B4(n.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(n.param,i):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class LQ{constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function JL(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function eF(t){return typeof Blob<"u"&&t instanceof Blob}function tF(t){return typeof FormData<"u"&&t instanceof FormData}class mk{constructor(n,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function FQ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Lf),this.context||(this.context=new LQ),this.params){const c=this.params.toString();if(0===c.length)this.urlWithParams=e;else{const f=e.indexOf("?");this.urlWithParams=e+(-1===f?"?":f<e.length-1?"&":"")+c}}else this.params=new P1,this.urlWithParams=e}serializeBody(){return null===this.body?null:JL(this.body)||eF(this.body)||tF(this.body)||function zQ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof P1?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||tF(this.body)?null:eF(this.body)?this.body.type||null:JL(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof P1?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const e=n.method||this.method,i=n.url||this.url,r=n.responseType||this.responseType,s=void 0!==n.body?n.body:this.body,c=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,f=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let y=n.headers||this.headers,k=n.params||this.params;const E=n.context??this.context;return void 0!==n.setHeaders&&(y=Object.keys(n.setHeaders).reduce((F,$)=>F.set($,n.setHeaders[$]),y)),n.setParams&&(k=Object.keys(n.setParams).reduce((F,$)=>F.set($,n.setParams[$]),k)),new mk(e,i,s,{params:k,headers:y,context:E,reportProgress:f,responseType:r,withCredentials:c})}}var L2=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(L2||{});class dA{constructor(n,e=200,i="OK"){this.headers=n.headers||new Lf,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||i,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class hA extends dA{constructor(n={}){super(n),this.type=L2.ResponseHeader}clone(n={}){return new hA({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class F2 extends dA{constructor(n={}){super(n),this.type=L2.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new F2({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class nF extends dA{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function uA(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let Ff=(()=>{class t{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof mk)s=e;else{let y,k;y=r.headers instanceof Lf?r.headers:new Lf(r.headers),r.params&&(k=r.params instanceof P1?r.params:new P1({fromObject:r.params})),s=new mk(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:k,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const c=Un(s).pipe(k2(y=>this.handler.handle(y)));if(e instanceof mk||"events"===r.observe)return c;const f=c.pipe(rd(y=>y instanceof F2));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return f.pipe(zi(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return f.pipe(zi(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return f.pipe(zi(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return f.pipe(zi(y=>y.body))}case"response":return f;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new P1).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,uA(r,i))}post(e,i,r={}){return this.request("POST",e,uA(r,i))}put(e,i,r={}){return this.request("PUT",e,uA(r,i))}static{this.\u0275fac=function(i){return new(i||t)(Dt(z4))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();function oF(t,n){return n(t)}function BQ(t,n){return(e,i)=>n.intercept(e,{handle:r=>t(r,i)})}const sF=new tn(""),gk=new tn(""),aF=new tn("");function jQ(){let t=null;return(n,e)=>{null===t&&(t=(Rn(sF,{optional:!0})??[]).reduceRight(BQ,oF));const i=Rn(I3),r=i.add();return t(n,e).pipe(M2(()=>i.remove(r)))}}let lF=(()=>{class t extends z4{constructor(e,i){super(),this.backend=e,this.injector=i,this.chain=null,this.pendingTasks=Rn(I3)}handle(e){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(gk),...this.injector.get(aF,[])]));this.chain=r.reduceRight((s,c)=>function VQ(t,n,e){return(i,r)=>e.runInContext(()=>n(i,s=>t(s,r)))}(s,c,this.injector),oF)}const i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(M2(()=>this.pendingTasks.remove(i)))}static{this.\u0275fac=function(i){return new(i||t)(Dt(N4),Dt(Yd))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const $Q=/^\)\]\}',?\n/;let dF=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Ht(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?ti(i.\u0275loadImpl()):Un(null)).pipe($o(()=>new Jn(s=>{const c=i.build();if(c.open(e.method,e.urlWithParams),e.withCredentials&&(c.withCredentials=!0),e.headers.forEach((he,me)=>c.setRequestHeader(he,me.join(","))),e.headers.has("Accept")||c.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const he=e.detectContentTypeHeader();null!==he&&c.setRequestHeader("Content-Type",he)}if(e.responseType){const he=e.responseType.toLowerCase();c.responseType="json"!==he?he:"text"}const f=e.serializeBody();let y=null;const k=()=>{if(null!==y)return y;const he=c.statusText||"OK",me=new Lf(c.getAllResponseHeaders()),Pe=function GQ(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(c)||e.url;return y=new hA({headers:me,status:c.status,statusText:he,url:Pe}),y},E=()=>{let{headers:he,status:me,statusText:Pe,url:Re}=k(),rt=null;204!==me&&(rt=typeof c.response>"u"?c.responseText:c.response),0===me&&(me=rt?200:0);let ft=me>=200&&me<300;if("json"===e.responseType&&"string"==typeof rt){const Ct=rt;rt=rt.replace($Q,"");try{rt=""!==rt?JSON.parse(rt):null}catch(Vt){rt=Ct,ft&&(ft=!1,rt={error:Vt,text:rt})}}ft?(s.next(new F2({body:rt,headers:he,status:me,statusText:Pe,url:Re||void 0})),s.complete()):s.error(new nF({error:rt,headers:he,status:me,statusText:Pe,url:Re||void 0}))},F=he=>{const{url:me}=k(),Pe=new nF({error:he,status:c.status||0,statusText:c.statusText||"Unknown Error",url:me||void 0});s.error(Pe)};let $=!1;const W=he=>{$||(s.next(k()),$=!0);let me={type:L2.DownloadProgress,loaded:he.loaded};he.lengthComputable&&(me.total=he.total),"text"===e.responseType&&c.responseText&&(me.partialText=c.responseText),s.next(me)},re=he=>{let me={type:L2.UploadProgress,loaded:he.loaded};he.lengthComputable&&(me.total=he.total),s.next(me)};return c.addEventListener("load",E),c.addEventListener("error",F),c.addEventListener("timeout",F),c.addEventListener("abort",F),e.reportProgress&&(c.addEventListener("progress",W),null!==f&&c.upload&&c.upload.addEventListener("progress",re)),c.send(f),s.next({type:L2.Sent}),()=>{c.removeEventListener("error",F),c.removeEventListener("abort",F),c.removeEventListener("load",E),c.removeEventListener("timeout",F),e.reportProgress&&(c.removeEventListener("progress",W),null!==f&&c.upload&&c.upload.removeEventListener("progress",re)),c.readyState!==c.DONE&&c.abort()}})))}static{this.\u0275fac=function(i){return new(i||t)(Dt(yR))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const pA=new tn("XSRF_ENABLED"),hF=new tn("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),uF=new tn("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class pF{}let YQ=(()=>{class t{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=aR(e,this.cookieName),this.lastCookieString=e),this.lastToken}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(mh),Dt(hF))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();function XQ(t,n){const e=t.url.toLowerCase();if(!Rn(pA)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const i=Rn(pF).getToken(),r=Rn(uF);return null!=i&&!t.headers.has(r)&&(t=t.clone({headers:t.headers.set(r,i)})),n(t)}var I1=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(I1||{});function Z_(t,n){return{\u0275kind:t,\u0275providers:n}}function KQ(...t){const n=[Ff,dF,lF,{provide:z4,useExisting:lF},{provide:N4,useExisting:dF},{provide:gk,useValue:XQ,multi:!0},{provide:pA,useValue:!0},{provide:pF,useClass:YQ}];for(const e of t)n.push(...e.\u0275providers);return function sv(t){return{\u0275providers:t}}(n)}const fF=new tn("LEGACY_INTERCEPTOR_FN");let JQ=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[KQ(Z_(I1.LegacyInterceptors,[{provide:fF,useFactory:jQ},{provide:gk,useExisting:fF,multi:!0}]))]})}}return t})(),Km=(()=>{class t{handleAuth(e){this.setToken(e);const i=this.jwtHelper.decodeToken(e);this.currentUserSubject.next(i)}constructor(e){this.http=e,this.apiUrl="https://backend.ddev.site/api",this.tokenKey="auth_token",this.jwtHelper=new AQ,this.currentUserSubject=new Is(null),this.currentUser$=this.currentUserSubject.asObservable();const i=this.getToken();if(i&&!this.jwtHelper.isTokenExpired(i)){const r=this.jwtHelper.decodeToken(i);this.currentUserSubject.next(r)}else this.logout()}login(e,i){return this.http.post(`${this.apiUrl}/login_check`,{username:e,password:i}).pipe(Tl(r=>{r?.token&&this.handleAuth(r.token)}))}get currentUser(){return this.currentUserSubject.value}register(e,i,r,s,c,f){return this.http.post(`${this.apiUrl}/register`,{email:i,password:r,name:e,phoneNumber:s,role:c,lastName:f})}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,{email:e})}resetPassword(e,i){return this.http.post(`${this.apiUrl}/reset-password`,{token:e,password:i})}logout(){localStorage.removeItem(this.tokenKey),this.currentUserSubject.next(null)}isLoggedIn(){const e=this.getToken();return null!==e&&!this.jwtHelper.isTokenExpired(e)}getToken(){return localStorage.getItem(this.tokenKey)}setToken(e){localStorage.setItem(this.tokenKey,e)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Ff))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function oJ(t,n){1&t&&(z(0,"span"),q(1,"Email is required"),B())}function sJ(t,n){1&t&&(z(0,"span"),q(1,"Please enter a valid email"),B())}function aJ(t,n){if(1&t&&(z(0,"div",24),He(1,oJ,2,0,"span",25),He(2,sJ,2,0,"span",25),B()),2&t){const e=ht();let i,r;ne(1),ye("ngIf",null==(i=e.loginForm.get("email"))||null==i.errors?null:i.errors.required),ne(1),ye("ngIf",null==(r=e.loginForm.get("email"))||null==r.errors?null:r.errors.email)}}function lJ(t,n){1&t&&(z(0,"div",24),q(1," Password is required and must be at least 8 characters. "),B())}const mF=function(t){return{"invalid-field":t}};let cJ=(()=>{class t{constructor(e,i,r,s){this.formBuilder=e,this.authService=i,this.route=r,this.router=s,this.loading=!1,this.submitted=!1,this.error="",this.returnUrl=""}ngOnInit(){this.loginForm=this.formBuilder.group({email:["",[Gi.required,Gi.email]],password:["",Gi.required]}),this.returnUrl=this.route.snapshot.queryParams.returnUrl||"/home"}get f(){return this.loginForm.controls}onSubmit(){if(this.submitted=!0,this.loginForm.invalid)return;this.loading=!0;const e=this.loginForm.value;this.authService.login(e.email,e.password).subscribe({next:()=>{this.router.navigate([this.returnUrl])},error:i=>{this.error=i.error?.message||"Login failed",this.loading=!1}})}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(Km),st(Rf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-login"]],decls:38,vars:11,consts:[[1,"register-container"],[1,"register-card"],[1,"brand-header"],[1,"logo"],[1,"brand-name"],[1,"form-header"],[1,"title"],[1,"subtitle"],[3,"formGroup","ngSubmit"],[1,"form-row"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","email","placeholder","Enter your email",3,"ngClass"],[1,"error-container"],["class","error-message",4,"ngIf"],[2,"display","flex","justify-content","space-between","align-items","center"],["for","password"],["routerLink","/forgot-password",1,"forgot-password"],["type","password","id","password","formControlName","password","placeholder","Enter your password",3,"ngClass"],["type","submit",1,"register-btn",3,"disabled"],[1,"divider"],[1,"divider-text"],[1,"login-link"],["routerLink","/register"],[1,"error-message"],[4,"ngIf"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2),$e(3,"div",3),z(4,"div",4),q(5,"Easy Rent"),B()(),z(6,"div",5)(7,"h2",6),q(8,"Welcome Back!"),B(),z(9,"p",7),q(10,"Enter your credentials to access your account"),B()(),z(11,"form",8),qt("ngSubmit",function(){return r.onSubmit()}),z(12,"div",9)(13,"div",10)(14,"label",11),q(15,"Email address"),B(),$e(16,"input",12),z(17,"div",13),He(18,aJ,3,2,"div",14),B()()(),z(19,"div",9)(20,"div",10)(21,"div",15)(22,"label",16),q(23,"Password"),B(),z(24,"a",17),q(25,"Forgot password?"),B()(),$e(26,"input",18),z(27,"div",13),He(28,lJ,2,0,"div",14),B()()(),z(29,"button",19),q(30),B()(),z(31,"div",20)(32,"span",21),q(33,"or"),B()(),z(34,"div",22),q(35," Don't have an account? "),z(36,"a",23),q(37,"Sign Up"),B()()()()),2&i){let s,c,f,y;ne(11),ye("formGroup",r.loginForm),ne(5),ye("ngClass",Gr(7,mF,(null==(s=r.loginForm.get("email"))?null:s.invalid)&&(null==(s=r.loginForm.get("email"))?null:s.touched))),ne(2),ye("ngIf",(null==(c=r.loginForm.get("email"))?null:c.invalid)&&(null==(c=r.loginForm.get("email"))?null:c.touched)),ne(8),ye("ngClass",Gr(9,mF,(null==(f=r.loginForm.get("password"))?null:f.invalid)&&(null==(f=r.loginForm.get("password"))?null:f.touched))),ne(2),ye("ngIf",(null==(y=r.loginForm.get("password"))?null:y.invalid)&&(null==(y=r.loginForm.get("password"))?null:y.touched)),ne(1),ye("disabled",r.loginForm.invalid||r.loading),ne(1),Ft(" ",r.loading?"Logging in...":"Login"," ")}},dependencies:[ha,wo,od,Zh,hl,Wl,Pc,Ic,wh],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box;margin:0;padding:0;font-family:popins,sans-serif}body[_ngcontent-%COMP%]{background-color:#f8f8f8;color:#222;line-height:1.5}.register-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px}.register-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:24px;box-shadow:0 6px 16px #00000014;width:100%;max-width:730px;padding:40px;margin-bottom:20px}@media (max-width: 576px){.register-card[_ngcontent-%COMP%]{padding:30px 20px}.form-row.two-column[_ngcontent-%COMP%]{flex-direction:column;gap:24px}}.brand-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:40px}.brand-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);margin-right:16px}.brand-header[_ngcontent-%COMP%]   .brand-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#4db299;letter-spacing:-.5px}.form-header[_ngcontent-%COMP%]{margin-bottom:32px;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards;animation-delay:.1s}.form-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:30px;font-weight:700;color:#222;margin-bottom:12px}.form-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#717171;font-size:16px}.form-row[_ngcontent-%COMP%]{margin-bottom:24px;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards}.form-row[_ngcontent-%COMP%]:nth-child(1){animation-delay:.2s}.form-row[_ngcontent-%COMP%]:nth-child(2){animation-delay:.3s}.form-row[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.form-row[_ngcontent-%COMP%]:nth-child(4){animation-delay:.5s}.form-row[_ngcontent-%COMP%]:nth-child(5){animation-delay:.6s}.form-row[_ngcontent-%COMP%]:nth-child(6){animation-delay:.7s}.form-row.two-column[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row.two-column[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.form-group[_ngcontent-%COMP%]{margin-bottom:8px}label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;margin-bottom:8px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{display:block;width:100%;padding:16px;font-size:16px;border:1px solid #DDDDDD;border-radius:16px;background-color:#fff;transition:all .3s ease}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4db299;box-shadow:0 0 0 3px #4db29933}input.invalid-field[_ngcontent-%COMP%], select.invalid-field[_ngcontent-%COMP%]{border-color:#ff385c}input[_ngcontent-%COMP%]::placeholder, select[_ngcontent-%COMP%]::placeholder{color:#9a9a9a}.phone-input[_ngcontent-%COMP%]{display:flex;gap:12px}.phone-input[_ngcontent-%COMP%]   .country-code[_ngcontent-%COMP%]{width:90px;flex-shrink:0;background-color:#f8f8f8;text-align:center}.error-container[_ngcontent-%COMP%]{min-height:20px;margin-top:6px}.error-message[_ngcontent-%COMP%]{color:#ff385c;font-size:12px}.register-btn[_ngcontent-%COMP%]{display:block;width:100%;padding:16px;margin-top:8px;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);color:#fff;font-size:16px;font-weight:600;border:none;border-radius:16px;cursor:pointer;transition:all .3s ease;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards;animation-delay:.8s}.register-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #2f7c6a4d}.register-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.register-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed;transform:none;box-shadow:none}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:28px 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #DDDDDD}.divider[_ngcontent-%COMP%]   .divider-text[_ngcontent-%COMP%]{padding:0 16px;color:#717171;font-size:14px}.login-link[_ngcontent-%COMP%]{text-align:center;font-size:15px;color:#717171}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4db299;font-weight:600;text-decoration:none}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.progress-steps[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:16px}.progress-steps[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background-color:#ddd;margin:0 6px}.progress-steps[_ngcontent-%COMP%]   .step.active[_ngcontent-%COMP%]{background-color:#4db299;width:24px;border-radius:4px}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.register-container[_ngcontent-%COMP%]{min-height:100vh;background:url(/assets/bg-15.jpg) no-repeat center center/cover;position:relative}.register-container[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background-color:#ffffff80;-webkit-backdrop-filter:blur(1px);backdrop-filter:blur(1px);z-index:0}.register-card[_ngcontent-%COMP%]{position:relative;z-index:1}',"@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');"]})}}return t})();function dJ(t,n){1&t&&(z(0,"div",38),q(1," First name is required "),B())}function hJ(t,n){1&t&&(z(0,"div",38),q(1," Last name is required "),B())}function uJ(t,n){1&t&&(z(0,"div",38),q(1," Please enter a valid email "),B())}function pJ(t,n){1&t&&(z(0,"div",38),q(1," Phone number is required "),B())}function fJ(t,n){1&t&&(z(0,"div",38),q(1," Please select a role "),B())}function mJ(t,n){if(1&t&&(z(0,"div",38),q(1),B()),2&t){const e=ht();ne(1),Ft(" ",e.getPasswordErrorMessage()," ")}}function gJ(t,n){1&t&&(z(0,"div",38),q(1," Passwords do not match "),B())}const Y_=function(t){return{"invalid-field":t}};let _J=(()=>{class t{constructor(e,i,r){this.fb=e,this.authService=i,this.router=r,this.submitted=!1,this.errorMessage="",this.loading=!1,this.successMessage="",this.registerForm=this.fb.group({name:["",Gi.required],role:["",Gi.required],email:["",[Gi.required,Gi.email]],lastName:["",Gi.required],phoneNumber:["",[Gi.required,Gi.pattern("^[0-9]{8,11}$")]],password:["",[Gi.required,Gi.minLength(8),Gi.maxLength(30),this.createPasswordStrengthValidator()]],confirmPassword:["",Gi.required]},{validators:this.passwordsMatch})}createPasswordStrengthValidator(){return e=>{const i=e.value;if(!i)return null;const r=/[A-Z]+/.test(i),s=/[a-z]+/.test(i),c=/[0-9]+/.test(i),f=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(i);return r&&s&&c&&f?null:{passwordStrength:!0}}}passwordsMatch(e){const i=e.get("password")?.value,r=e.get("confirmPassword")?.value;return i===r?null:{passwordsMismatch:!0}}isFieldInvalid(e){const i=this.registerForm.get(e);return!!(i&&i.invalid&&(i.dirty||i.touched||this.submitted))}getPasswordErrorMessage(){const e=this.registerForm.get("password");return e?.hasError("required")?"Password is required":e?.hasError("minLength")?"Password must be at least 8 characters long":e?.hasError("maxLength")?"Password cannot exceed 30 characters":e?.hasError("passwordStrength")?"Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character":""}onSubmit(){if(this.submitted=!0,this.registerForm.valid){console.log("Form submitted:",this.registerForm.value);const e=this.registerForm.value;this.authService.register(e.name,e.email,e.password,e.phoneNumber,e.role,e.lastName).subscribe({next:()=>{this.router.navigate(["/login"])},error:i=>{console.log("Error during registration:",i)}})}else{console.log("Form invalid");const e=this.registerForm.controls;for(const i in e)e[i].invalid&&console.log(`Field ${i} is invalid`)}}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(Km),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-register"]],decls:77,vars:31,consts:[[1,"register-container"],[1,"register-card"],[1,"brand-header"],[1,"logo"],[1,"brand-name"],[1,"form-header"],[1,"title"],[1,"subtitle"],[3,"formGroup","ngSubmit"],[1,"form-row","two-column"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name","placeholder","Enter first name",3,"ngClass"],[1,"error-container"],["class","error-message",4,"ngIf"],["for","lastName"],["type","text","id","lastName","formControlName","lastName","placeholder","Enter last name",3,"ngClass"],[1,"form-row"],["for","email"],["type","email","id","email","formControlName","email","placeholder","example@email.com",3,"ngClass"],["for","phoneNumber"],[1,"phone-input"],["type","text","value","+216","readonly","",1,"country-code"],["type","tel","id","phoneNumber","formControlName","phoneNumber","placeholder","XX XXX XXX","maxlength","11",3,"ngClass"],["for","role"],["id","role","formControlName","role",3,"ngClass"],["value","","disabled","","selected",""],["value","user"],["value","owner"],["for","password"],["type","password","id","password","formControlName","password","placeholder","Create a secure password",3,"ngClass"],["for","confirmPassword"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",3,"ngClass"],["type","submit",1,"register-btn",3,"disabled"],[1,"divider"],[1,"divider-text"],[1,"login-link"],["routerLink","/login"],[1,"error-message"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2),$e(3,"div",3),z(4,"div",4),q(5,"Easy Rent"),B()(),z(6,"div",5)(7,"h1",6),q(8,"Create your account"),B(),z(9,"p",7),q(10,"Join our community to find your perfect home"),B()(),z(11,"form",8),qt("ngSubmit",function(){return r.onSubmit()}),z(12,"div",9)(13,"div",10)(14,"label",11),q(15,"First Name"),B(),$e(16,"input",12),z(17,"div",13),He(18,dJ,2,0,"div",14),B()(),z(19,"div",10)(20,"label",15),q(21,"Last Name"),B(),$e(22,"input",16),z(23,"div",13),He(24,hJ,2,0,"div",14),B()()(),z(25,"div",17)(26,"div",10)(27,"label",18),q(28,"Email Address"),B(),$e(29,"input",19),z(30,"div",13),He(31,uJ,2,0,"div",14),B()()(),z(32,"div",17)(33,"div",10)(34,"label",20),q(35,"Phone Number"),B(),z(36,"div",21),$e(37,"input",22)(38,"input",23),B(),z(39,"div",13),He(40,pJ,2,0,"div",14),B()()(),z(41,"div",17)(42,"div",10)(43,"label",24),q(44,"I am a"),B(),z(45,"select",25)(46,"option",26),q(47,"Select your role"),B(),z(48,"option",27),q(49,"Tenant looking for a place"),B(),z(50,"option",28),q(51,"Property owner"),B()(),z(52,"div",13),He(53,fJ,2,0,"div",14),B()()(),z(54,"div",17)(55,"div",10)(56,"label",29),q(57,"Password"),B(),$e(58,"input",30),z(59,"div",13),He(60,mJ,2,1,"div",14),B()()(),z(61,"div",17)(62,"div",10)(63,"label",31),q(64,"Confirm Password"),B(),$e(65,"input",32),z(66,"div",13),He(67,gJ,2,0,"div",14),B()()(),z(68,"button",33),q(69),B()(),z(70,"div",34)(71,"span",35),q(72,"or"),B()(),z(73,"div",36),q(74," Already have an account? "),z(75,"a",37),q(76,"Log in"),B()()()()),2&i&&(ne(11),ye("formGroup",r.registerForm),ne(5),ye("ngClass",Gr(17,Y_,r.isFieldInvalid("name"))),ne(2),ye("ngIf",r.isFieldInvalid("name")),ne(4),ye("ngClass",Gr(19,Y_,r.isFieldInvalid("lastName"))),ne(2),ye("ngIf",r.isFieldInvalid("lastName")),ne(5),ye("ngClass",Gr(21,Y_,r.isFieldInvalid("email"))),ne(2),ye("ngIf",r.isFieldInvalid("email")),ne(7),ye("ngClass",Gr(23,Y_,r.isFieldInvalid("phoneNumber"))),ne(2),ye("ngIf",r.isFieldInvalid("phoneNumber")),ne(5),ye("ngClass",Gr(25,Y_,r.isFieldInvalid("role"))),ne(8),ye("ngIf",r.isFieldInvalid("role")),ne(5),ye("ngClass",Gr(27,Y_,r.isFieldInvalid("password"))),ne(2),ye("ngIf",r.isFieldInvalid("password")),ne(5),ye("ngClass",Gr(29,Y_,r.isFieldInvalid("confirmPassword"))),ne(2),ye("ngIf",(null==r.registerForm.errors?null:r.registerForm.errors.passwordsMismatch)&&r.registerForm.controls.confirmPassword.touched),ne(1),ye("disabled",r.loading),ne(1),Ft(" ",r.loading?"Creating Account...":"Create Account"," "))},dependencies:[ha,wo,od,Zh,h4,u4,hl,w2,Wl,Pc,jT,Ic,wh],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box;margin:0;padding:0;font-family:popins,sans-serif}body[_ngcontent-%COMP%]{background-color:#f8f8f8;color:#222;line-height:1.5}.register-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 20px}.register-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:24px;box-shadow:0 6px 16px #00000014;width:100%;max-width:820px;padding:40px;margin-bottom:20px}@media (max-width: 576px){.register-card[_ngcontent-%COMP%]{padding:30px 20px}.form-row.two-column[_ngcontent-%COMP%]{flex-direction:column;gap:24px}}.brand-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:40px}.brand-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);margin-right:16px}.brand-header[_ngcontent-%COMP%]   .brand-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#4db299;letter-spacing:-.5px}.form-header[_ngcontent-%COMP%]{margin-bottom:32px;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards;animation-delay:.1s}.form-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:30px;font-weight:700;color:#1f2744;margin-bottom:12px}.form-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#717171;font-size:16px}.form-row[_ngcontent-%COMP%]{margin-bottom:24px;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards}.form-row[_ngcontent-%COMP%]:nth-child(1){animation-delay:.2s}.form-row[_ngcontent-%COMP%]:nth-child(2){animation-delay:.3s}.form-row[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.form-row[_ngcontent-%COMP%]:nth-child(4){animation-delay:.5s}.form-row[_ngcontent-%COMP%]:nth-child(5){animation-delay:.6s}.form-row[_ngcontent-%COMP%]:nth-child(6){animation-delay:.7s}.form-row.two-column[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row.two-column[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.form-group[_ngcontent-%COMP%]{margin-bottom:8px}label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#1f2744;margin-bottom:8px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{display:block;width:100%;padding:16px;font-size:16px;border:1px solid #DDDDDD;border-radius:16px;background-color:#fff;transition:all .3s ease}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4db299;box-shadow:0 0 0 3px #4db29933}input.invalid-field[_ngcontent-%COMP%], select.invalid-field[_ngcontent-%COMP%]{border-color:#ff385c}input[_ngcontent-%COMP%]::placeholder, select[_ngcontent-%COMP%]::placeholder{color:#9a9a9a}.phone-input[_ngcontent-%COMP%]{display:flex;gap:12px}.phone-input[_ngcontent-%COMP%]   .country-code[_ngcontent-%COMP%]{width:90px;flex-shrink:0;background-color:#f8f8f8;text-align:center}.error-container[_ngcontent-%COMP%]{min-height:20px;margin-top:6px}.error-message[_ngcontent-%COMP%]{color:#ff385c;font-size:12px}.register-btn[_ngcontent-%COMP%]{display:block;width:100%;padding:16px;margin-top:8px;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);color:#fff;font-size:16px;font-weight:600;border:none;border-radius:16px;cursor:pointer;transition:all .3s ease;opacity:0;animation:_ngcontent-%COMP%_fadeInUp .4s ease forwards;animation-delay:.8s}.register-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #2f7c6a4d}.register-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.register-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed;transform:none;box-shadow:none}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:28px 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #DDDDDD}.divider[_ngcontent-%COMP%]   .divider-text[_ngcontent-%COMP%]{padding:0 16px;color:#717171;font-size:14px}.login-link[_ngcontent-%COMP%]{text-align:center;font-size:15px;color:#717171}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4db299;font-weight:600;text-decoration:none}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.progress-steps[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:16px}.progress-steps[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background-color:#ddd;margin:0 6px}.progress-steps[_ngcontent-%COMP%]   .step.active[_ngcontent-%COMP%]{background-color:#4db299;width:24px;border-radius:4px}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.register-container[_ngcontent-%COMP%]{min-height:100vh;background:url(/assets/bg-16.jpg) no-repeat center center/cover;position:relative}.register-container[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background-color:#ffffff80;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:0}.register-card[_ngcontent-%COMP%]{position:relative;z-index:1}',"@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');"]})}}return t})();function yJ(t,n){1&t&&$e(0,"span",16)}function vJ(t,n){if(1&t&&(z(0,"div",17),q(1),B()),2&t){const e=ht();ne(1),Qe(e.error)}}function bJ(t,n){if(1&t&&(z(0,"div",18),q(1),B()),2&t){const e=ht();ne(1),Qe(e.success)}}const xJ=function(t){return{"is-invalid":t}};let wJ=(()=>{class t{constructor(e,i){this.formBuilder=e,this.authService=i,this.loading=!1,this.submitted=!1,this.error="",this.success=""}ngOnInit(){this.forgotPasswordForm=this.formBuilder.group({email:["",[Gi.required,Gi.email]]})}get f(){return this.forgotPasswordForm.controls}onSubmit(){this.submitted=!0,!this.forgotPasswordForm.invalid&&(this.loading=!0,this.authService.forgotPassword(this.f.email.value).subscribe({next:e=>{this.success=e.message,this.loading=!1},error:e=>{this.error=e.error?.message||"Request failed",this.loading=!1}}))}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(Km))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-forgot-password"]],decls:24,vars:7,consts:[[3,"formGroup","ngSubmit"],[1,"forgot-password-container"],[1,"title"],[1,"subtitle"],[1,"form-group"],["for","email"],["type","email","id","email","placeholder","Enter your email","formControlName","email","required","",1,"form-control",3,"ngClass"],[1,"btn-reset"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"divider"],[1,"line"],[1,"text"],[1,"back-link"],["routerLink","/login"],["class","alert alert-danger mt-3",4,"ngIf"],["class","alert alert-success mt-3",4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"alert","alert-danger","mt-3"],[1,"alert","alert-success","mt-3"]],template:function(i,r){1&i&&(z(0,"form",0),qt("ngSubmit",function(){return r.onSubmit()}),z(1,"div",1)(2,"h1",2),q(3,"Reset Password"),B(),z(4,"p",3),q(5,"Enter your email address to receive a password reset link"),B(),z(6,"div",4)(7,"label",5),q(8,"Email address"),B(),$e(9,"input",6),B(),z(10,"button",7),He(11,yJ,1,0,"span",8),q(12," Send reset link "),B(),z(13,"div",9),$e(14,"span",10),z(15,"span",11),q(16,"or"),B(),$e(17,"span",10),B(),z(18,"div",12),q(19," Remember your password? "),z(20,"a",13),q(21,"Back to Login"),B()(),He(22,vJ,2,1,"div",14),He(23,bJ,2,1,"div",15),B()()),2&i&&(ye("formGroup",r.forgotPasswordForm),ne(9),ye("ngClass",Gr(5,xJ,r.submitted&&r.f.email.errors)),ne(2),ye("ngIf",r.loading),ne(11),ye("ngIf",r.error),ne(1),ye("ngIf",r.success))},dependencies:[ha,wo,od,Zh,hl,Wl,Pc,p4,Ic,wh],styles:[".forgot-password-container[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:40px 20px;text-align:center}.title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;margin-bottom:10px;color:#333}.subtitle[_ngcontent-%COMP%]{font-size:16px;color:#666;margin-bottom:30px}.form-group[_ngcontent-%COMP%]{margin-bottom:25px;text-align:left}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#333}.form-control[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:1px solid #ccc;border-radius:4px;font-size:16px;transition:border-color .3s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#4b7a3f}.btn-reset[_ngcontent-%COMP%]{width:100%;padding:14px;background-color:#4b7a3f;color:#fff;border:none;border-radius:4px;font-size:16px;cursor:pointer;transition:background-color .3s}.btn-reset[_ngcontent-%COMP%]:hover{background-color:#3d6234}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:25px 0}.line[_ngcontent-%COMP%]{flex:1;height:1px;background-color:#ddd}.text[_ngcontent-%COMP%]{padding:0 15px;color:#888}.back-link[_ngcontent-%COMP%]{margin-top:15px;color:#666}.back-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4b7a3f;text-decoration:none;font-weight:500}.back-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.success-message[_ngcontent-%COMP%]{margin-top:20px;padding:10px;background-color:#e0f2dc;color:#4b7a3f;border-radius:4px}.error-message[_ngcontent-%COMP%]{margin-top:20px;padding:10px;background-color:#fee;color:#e53935;border-radius:4px}"]})}}return t})(),kJ=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-verify-email"]],decls:2,vars:0,template:function(i,r){1&i&&(z(0,"p"),q(1,"verify-email works!"),B())}})}}return t})();var MJ=wn(32),X_=wn.n(MJ);let ac=(()=>{class t{constructor(e){this.http=e,this.apiUrl2="https://backend.ddev.site/api/user/properties",this.apiUrl="https://backend.ddev.site/api/properties/",this.baseApiUrl="https://backend.ddev.site/api"}getAllProperties(){return this.http.get(this.apiUrl).pipe(zi(e=>e.map(i=>(i.mainImage=i?.Media?.photos?.length>0?"https://backend.ddev.site"+i.Media.photos[0].imageName:"/assets/default.jpg",i))))}getAllPropertiesByOwnerId(){return this.http.get(`${this.apiUrl2}`).pipe(zi(e=>e.map(i=>(i.mainImage=i?.Media?.photos?.length>0?"https://backend.ddev.site"+i.Media.photos[0].imageName:"/assets/default.jpg",i))))}getPropertyById(e){return this.http.get(`${this.apiUrl}${e}`)}addBooking(e,i){return this.http.post(`https://backend.ddev.site/api/booking/properties/${e}/book`,i)}addProperty(e){return this.http.post(this.apiUrl,e)}getUserBookings(){return this.http.get("https://backend.ddev.site/api/booking/my-bookings")}updateProperty(e,i){return this.http.put(`${this.apiUrl}/${e}`,i)}deleteProperty(e){return this.http.delete(`${this.apiUrl}/${e}`)}scheduleAppointment(e){return this.http.post("https://backend.ddev.site/api/appointments",e)}getAvailableAppointmentSlots(e,i){return this.http.get(`https://backend.ddev.site/api/properties/${e}/available-slots?date=${i}`)}getUserAppointments(){return this.http.get("https://backend.ddev.site/api/my-appointments")}getOwnerAppointments(){return this.http.get("https://backend.ddev.site/api/owner/appointments")}updateAppointmentStatus(e,i){return this.http.patch(`https://backend.ddev.site/api/appointments/${e}/approve`,{status:i})}sendEmailToOwner(e){return this.http.post(`${this.baseApiUrl}/properties/${e.propertyId}/send-email`,e)}getEmailMessages(){return this.http.get(`${this.baseApiUrl}/owner/messages`)}sendOwnerReply(e,i){return this.http.post(`${this.baseApiUrl}/owner/messages/${e}/reply`,i)}recordView(e){return this.http.post(`${this.baseApiUrl}/properties/${e}/view`,{})}getPropertyViews(e){return this.http.get(`${this.baseApiUrl}/properties/${e}/views`)}getUserViews(){return this.http.get(`${this.baseApiUrl}/user/views`)}getTotalViewsForOwner(){return this.http.get("https://backend.ddev.site/api/owner/allviews")}getApprovedPropertiesCount(){return this.http.get(`${this.baseApiUrl}/owner/approved-properties`)}getAllPropertiesCount(){return this.http.get(`${this.baseApiUrl}/owner/all-properties-count`)}getPendingAppointmentsCount(){return this.http.get(`${this.baseApiUrl}/owner/countappointments`)}getUnreadMessageCount(){return this.http.get(`${this.baseApiUrl}/messagescount`)}getmonthlyviews(){return this.http.get(`${this.baseApiUrl}/owner/views`)}getauthcheck(){return this.http.get(`${this.baseApiUrl}/authcheck`)}markMessageAsRead(e){return this.http.put(`${this.baseApiUrl}/messages/${e}`,{})}approveBooking(e){return this.http.post(`https://backend.ddev.site/api/booking/${e}/approval`,{approval:"approved"})}getownerBookings(){return this.http.get("https://backend.ddev.site/api/booking/owner/bookings")}rejectBooking(e){return this.http.post(`https://backend.ddev.site/api/booking/${e}/approval`,{approval:"rejected"})}getPendingPropertiesCount(){return this.http.get(`${this.baseApiUrl}/admin/pending-properties`)}getUserGrowthOverTime(){return this.http.get("https://backend.ddev.site/api/admin/analytics/user-growth")}getPropertyGrowthOverTime(){return this.http.get("https://backend.ddev.site/api/admin/analytics/property-growth")}getTotalUsersCount(){return this.http.get("https://backend.ddev.site/api/admin/total-users")}getTotalOwnersCount(){return this.http.get("https://backend.ddev.site/api/admin/total-owners")}getallusers(){return this.http.get(`${this.baseApiUrl}/admin/users`)}getallowners(){return this.http.get(`${this.baseApiUrl}/admin/allowners`)}deleteUser(e){return this.http.delete(`${this.baseApiUrl}/admin/user/${e}/delete`)}updatePropertyApproval(e,i){return this.http.patch(`https://backend.ddev.site/api/admin/properties/${e}/approval`,{approval:i})}getAdminProperties(){return this.http.get("https://backend.ddev.site/api/admin/properties")}AdminDeleteProperty(e){return this.http.delete(`https://backend.ddev.site/api/admin/properties/${e}`)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Ff))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const CJ=function(t,n){return{"disabled-option":t,"selected-option":n}};function SJ(t,n){if(1&t){const e=Ki();z(0,"div",4),qt("click",function(){const s=An(e).$implicit;return Mn(ht().selectOption(s))}),q(1),B()}if(2&t){const e=n.$implicit,i=ht();ye("ngClass",z_(2,CJ,e.disabled,e.value===i.selectedValue)),ne(1),Ft(" ",e.label," ")}}let fA=(()=>{class t{constructor(e){this.eRef=e,this.options=[],this.placeholder="Select an option",this.selectedValue=null,this.optionSelected=new Xi,this.customClass="",this.disabled=!1,this.isOpen=!1,this.onChange=i=>{},this.onTouched=()=>{}}clickOutside(e){this.eRef.nativeElement.contains(e.target)||(this.isOpen=!1,this.onTouched())}toggleDropdown(e){this.disabled||(this.isOpen=!this.isOpen,e.stopPropagation(),this.onTouched(),setTimeout(()=>{const i=this.eRef.nativeElement.querySelector(".dropdown-content");if(!i)return;const r=i.getBoundingClientRect(),s=window.innerHeight;r.bottom>s?(i.style.top="auto",i.style.bottom="100%"):(i.style.top="100%",i.style.bottom="auto")}))}selectOption(e){e.disabled||this.disabled||(this.selectedValue=e.value,this.isOpen=!1,this.onChange(e.value),this.onTouched(),this.optionSelected.emit(e.value))}get selectedLabel(){const e=this.options.find(i=>i.value===this.selectedValue);return e?e.label:this.placeholder}writeValue(e){this.selectedValue=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}static{this.\u0275fac=function(i){return new(i||t)(st(ns))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-dropdown"]],hostBindings:function(i,r){1&i&&qt("click",function(c){return r.clickOutside(c)},0,o_)},inputs:{options:"options",placeholder:"placeholder",selectedValue:"selectedValue",customClass:"customClass",disabled:"disabled"},outputs:{optionSelected:"optionSelected"},features:[Vs([{provide:Wh,useExisting:Tr(()=>t),multi:!0}])],decls:5,vars:5,consts:[[1,"dropdown","select-status",3,"ngClass"],["type","button",1,"dropdown-button",3,"click"],[1,"dropdown-content"],["class","dropdown-option",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"dropdown-option",3,"ngClass","click"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"button",1),qt("click",function(c){return r.toggleDropdown(c)}),q(2),B(),z(3,"div",2),He(4,SJ,2,5,"div",3),B()()),2&i&&(ye("ngClass",r.customClass),ne(2),Ft(" ",r.selectedLabel," "),ne(1),Z("show",r.isOpen),ne(1),ye("ngForOf",r.options))},dependencies:[ha,qs],styles:['.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block;width:100%;font-family:popins,sans-serif}.dropdown-button[_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#fff;border:1px solid #ccc;border-radius:4px;cursor:pointer;text-align:left;position:relative}.dropdown-button[_ngcontent-%COMP%]:after{content:"";position:absolute;right:10px;top:50%;transform:translateY(-50%);border-width:6px 6px 0 6px;border-style:solid;border-color:#555 transparent transparent transparent}.dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;width:100%;background-color:#fff;border:1px solid #ccc;border-top:none;border-radius:0 0 4px 4px;box-shadow:0 2px 5px #0003;z-index:9999;max-height:300px;overflow-y:auto}.dropdown-option[_ngcontent-%COMP%]{padding:10px;cursor:pointer}.dropdown-option[_ngcontent-%COMP%]:hover{background-color:#69b99d}.show[_ngcontent-%COMP%]{display:block}.dropdown-option.disabled-option[_ngcontent-%COMP%]{color:#5f5e5e;cursor:not-allowed;background-color:#f5f5f5;text-decoration-color:#3e3d3d;font-weight:750;font-size:small;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif}.empty-select[_ngcontent-%COMP%]   .dropdown-button[_ngcontent-%COMP%]{opacity:.6;color:#999;cursor:not-allowed!important}']})}}return t})();function EJ(t,n){1&t&&(z(0,"div",28),q(1,"Deal type is required"),B())}function DJ(t,n){1&t&&(z(0,"div",28),q(1," title is required "),B())}function TJ(t,n){1&t&&(z(0,"div",28),q(1," Status is required "),B())}function AJ(t,n){1&t&&(z(0,"div",28),q(1," Availability date is required for rent properties "),B())}const gF=function(t){return{"is-invalid":t}};function PJ(t,n){if(1&t&&(z(0,"div",16)(1,"label",29),q(2,"Availability Date"),B(),z(3,"div",18),$e(4,"input",30),B(),z(5,"p",31),q(6,"Required"),B(),He(7,AJ,2,0,"div",14),B()),2&t){const e=ht();ne(4),ye("ngClass",Gr(2,gF,e.isInvalid("availabilityDate"))),ne(3),ye("ngIf",e.isInvalid("availabilityDate"))}}function IJ(t,n){1&t&&(z(0,"div",28),q(1,"Status is required"),B())}function OJ(t,n){1&t&&(z(0,"div",28),q(1," Description is required "),B())}let RJ=(()=>{class t{constructor(){this.PropertyCondition=[{value:"new",label:"New"},{value:"renovated",label:"Renovated"},{value:"Needs_Renovation",label:"Needs Renovation"}],this.propertyType=[{value:"apartment",label:"Apartment"},{value:"house",label:"House"},{value:"studio",label:"Studio"},{value:"villa",label:"Villa"}],this.selectedPropertyType=null,this.selectedPropertyCondition=null}ngOnInit(){}isInvalid(e){const i=this.parentForm.get(e);return!!i&&i.invalid&&(i.dirty||i.touched)}onPropertyTypeSelected(e){this.selectedPropertyType=e,this.parentForm.get("propertyType")?.setValue(e)}onPropertyConditionSelected(e){this.parentForm.get("PropertyCondition")?.setValue(e),this.selectedPropertyCondition=e}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-general-tab"]],inputs:{parentForm:"parentForm"},decls:45,vars:16,consts:[[1,"tab-container",3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc","text-body-secondary"],[1,"form-row-body"],[1,"form-list-view"],[1,"radio_legend"],[1,"radio_options"],[1,"radio_option"],["type","radio","name","deal_type","formControlName","deal_type","value","sale",1,"radio_input"],[1,"radio_state","text-base"],["type","radio","name","deal_type","formControlName","deal_type","value","rent",1,"radio_input"],["class","error-message",4,"ngIf"],[1,"d-grid","gap-4",2,"grid-template-columns","repeat(2, 1fr)"],[1,"input"],["for","inputref",1,"input_label"],[1,"input_inner"],["type","text","id","title","name","inputref","formControlName","title","placeholder","Enter a title",1,"input_control",3,"ngClass"],[1,"select-status"],["for","propertyType",1,"input_label"],["formControlName","propertyType",3,"options","placeholder","selectedValue","optionSelected"],["class","input",4,"ngIf"],["for","PropertyCondition",1,"input_label"],["formControlName","PropertyCondition",3,"options","placeholder","selectedValue","optionSelected"],["for","description",1,"input_label"],["id","description","formControlName","description","rows","5","placeholder","Enter property description",1,"form-control"],[1,"error-message"],["for","availabilityDate",1,"input_label"],["type","date","formControlName","availabilityDate",1,"input_control",3,"ngClass"],[1,"input_hint","mt-1"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"General"),B(),z(6,"p",5),q(7," Set status and category for this property "),B()(),z(8,"div",6)(9,"div",7)(10,"legend",8),q(11,"Deal type"),B(),z(12,"div",9)(13,"label",10),$e(14,"input",11),z(15,"span",12),q(16,"Sale"),B()(),z(17,"label",10),$e(18,"input",13),z(19,"span",12),q(20,"Rent"),B()()(),He(21,EJ,2,0,"div",14),B(),z(22,"div",15)(23,"div",16)(24,"label",17),q(25,"Title"),B(),z(26,"div",18),$e(27,"input",19),B(),He(28,DJ,2,0,"div",14),B(),z(29,"div",20)(30,"label",21),q(31,"Property Type"),B(),z(32,"app-dropdown",22),qt("optionSelected",function(c){return r.onPropertyTypeSelected(c)}),B(),He(33,TJ,2,0,"div",14),B(),He(34,PJ,8,4,"div",23),z(35,"div",20)(36,"label",24),q(37,"Property Condition"),B(),z(38,"app-dropdown",25),qt("optionSelected",function(c){return r.onPropertyConditionSelected(c)}),B(),He(39,IJ,2,0,"div",14),B()(),z(40,"div",16)(41,"label",26),q(42,"Description"),B(),$e(43,"textarea",27),He(44,OJ,2,0,"div",14),B()()()()()),2&i){let s;ye("formGroup",r.parentForm),ne(21),ye("ngIf",r.isInvalid("deal_type")),ne(6),ye("ngClass",Gr(14,gF,r.isInvalid("title"))),ne(1),ye("ngIf",r.isInvalid("title")),ne(4),ye("options",r.propertyType)("placeholder","Select a property type")("selectedValue",r.selectedPropertyType),ne(1),ye("ngIf",r.isInvalid("propertyType")),ne(1),ye("ngIf","rent"===(null==(s=r.parentForm.get("deal_type"))?null:s.value)),ne(4),ye("options",r.PropertyCondition)("placeholder","Select Property Condition")("selectedValue",r.selectedPropertyCondition),ne(1),ye("ngIf",r.isInvalid("PropertyCondition")),ne(5),ye("ngIf",r.isInvalid("description"))}},dependencies:[ha,wo,hl,Jw,Wl,Pc,Ic,wh,fA],styles:[".form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.radio_legend[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin-bottom:.5rem;font-weight:600;font-size:1rem;line-height:1.5;margin-top:.5rem}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.radio_input[_ngcontent-%COMP%]{appearance:none;background-color:#fff;border:2px solid #E1E1E1;border-radius:50%;width:20px;height:20px;cursor:pointer;position:relative}.radio_input[_ngcontent-%COMP%]:checked{background-color:#69b99d;border-color:#69b99d}.radio_input[_ngcontent-%COMP%]:checked:before{content:\"\";display:block;width:7px;height:7px;background-color:#fff;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.radio_options[_ngcontent-%COMP%]{display:flex}.radio--row[_ngcontent-%COMP%]   .radio_options[_ngcontent-%COMP%]{flex-direction:row}.radio--row[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0}.radio_option[_ngcontent-%COMP%]{display:flex;gap:1rem;width:-moz-fit-content;width:fit-content;cursor:pointer;line-height:1.5;flex-grow:1;flex-basis:0;padding:1.4375rem;border-width:.0625rem;border-right-width:0;border:1px solid #DEDEDE;border-radius:.25rem}.input_label[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin:0 0 .25rem;font-weight:500;cursor:pointer;font-size:1rem;line-height:1.5}.error-message[_ngcontent-%COMP%]{color:red;font-size:.875rem;line-height:1.43;margin-top:.25rem}.input_control[_ngcontent-%COMP%]{flex-grow:1;width:100%;height:100%;padding:0 .4rem;font:inherit;color:#1e1e1e;background:none;border:none;border-radius:.25rem}.input_inner[_ngcontent-%COMP%]{display:flex;align-items:center;height:3rem;padding:0 .05rem;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.input_hint[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#918f90}.select[_ngcontent-%COMP%]{flex-grow:1;height:3rem;font:inherit;color:inherit;background:none;border:1px solid #DEDEDE;border-radius:.25rem;padding:0 .9375rem 0 .875rem;appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:right 15px center;font-size:17px;line-height:1.5;width:100%}.select-status[_ngcontent-%COMP%]   option.selected-option[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#fff important}.select-status[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{background-color:#e5e7eb;color:#fff important;cursor:not-allowed}.select-status[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{pointer-events:none}.first-select[_ngcontent-%COMP%]{background-color:#fff;color:#1e1e1e;background:none}.select-wraper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin:0;padding:0;border:none}.box[_ngcontent-%COMP%]{display:grid;flex-wrap:wrap;place-content:center;min-width:3rem;min-height:3rem;padding:.75rem;text-align:center;cursor:pointer;border:.0625rem solid #E5E7EB;border-radius:.25rem}.form-row-view[_ngcontent-%COMP%]:not(:last-child){padding-bottom:2.5rem;margin-bottom:1.5rem;border-bottom:.0625rem solid lightgray}.grid-col-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(1,1fr);gap:6px}.select-wraper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:grid;flex-wrap:wrap;place-content:center;min-width:3rem;min-height:3rem;padding:.75rem;text-align:center;cursor:pointer;border:.0625rem solid #E5E7EB;border-radius:.25rem;background-color:#fff}.select-wraper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .select-wraper[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#d3d3d3}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}"]})}}return t})();var LJ=wn(247),j4=wn.n(LJ);const FJ=["mapElement"];let zJ=(()=>{class t{constructor(){this.center=[0,0],this.zoom=0,this.positionSelected=new Xi,this.marker=null,this.defaultcenter=[10.1815,36.8065]}ngAfterViewInit(){this.initializeMap(),this.center&&0!==this.center[0]&&0!==this.center[1]&&(this.defaultcenter=this.center,this.map.on("load",()=>{this.setMarkerPosition(this.center),this.map.flyTo({center:this.center,zoom:this.zoom||16,essential:!0})}))}ngOnDestroy(){this.map&&this.map.remove()}initializeMap(){j4().accessToken=this.accessToken,this.map=new(j4().Map)({container:this.mapElement.nativeElement,style:"/assets/style.json",center:this.defaultcenter,zoom:this.zoom,pitch:60,bearing:0}),this.map.addControl(new(j4().NavigationControl)),this.map.on("click",e=>{const i=[e.lngLat.lng,e.lngLat.lat];this.placeMarker(i),this.positionSelected.emit(i)})}placeMarker(e){this.marker&&this.marker.remove(),this.marker=new(j4().Marker)({draggable:!0,color:"#FF0000"}).setLngLat(e).addTo(this.map),this.marker.on("dragend",()=>{const i=this.marker.getLngLat();this.positionSelected.emit([i.lng,i.lat])})}setMarkerPosition(e){this.placeMarker(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-map"]],viewQuery:function(i,r){if(1&i&&Df(FJ,5),2&i){let s;js(s=Hs())&&(r.mapElement=s.first)}},inputs:{accessToken:"accessToken",center:"center",zoom:"zoom"},outputs:{positionSelected:"positionSelected"},decls:3,vars:0,consts:[[1,"map-container"],[1,"map"],["mapElement",""]],template:function(i,r){1&i&&(z(0,"div",0),$e(1,"div",1,2),B())},styles:[".map-container[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;border-radius:10px}.map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;border-radius:10px}"]})}}return t})();function NJ(t,n){1&t&&(z(0,"p",24),q(1,"Required"),B())}function BJ(t,n){1&t&&(z(0,"div",24),q(1," please select the location on the map "),B())}function VJ(t,n){1&t&&(z(0,"p",24),q(1,"Required"),B())}function jJ(t,n){1&t&&(z(0,"p",24),q(1,"Required"),B())}function HJ(t,n){1&t&&(z(0,"p",24),q(1,"Required"),B())}function UJ(t,n){1&t&&(z(0,"p",24),q(1,"Required"),B())}const qJ=function(t,n){return[t,n]},$J=function(t){return{"is-invalid":t}};let GJ=(()=>{class t{constructor(e,i){this.fb=e,this.cdr=i,this.latitude=0,this.longitude=0,this.selectedPosition=null,this.subscriptions=[],this.country={tunisia:"Tunisia"},this.state={ariana:"Ariana",beja:"B\xe9ja",ben_arous:"Ben Arous",bizerte:"Bizerte",gabes:"Gab\xe8s",gafsa:"Gafsa",jendouba:"Jendouba",kairouan:"Kairouan",kasserine:"Kasserine",kebili:"Kebili",la_manouba:"La Manouba",le_kef:"Le Kef",mahdia:"Mahdia",medenine:"M\xe9denine",monastir:"Monastir",nabeul:"Nabeul",sfax:"Sfax",sidi_bouzid:"Sidi Bouzid",siliana:"Siliana",sousse:"Sousse",tataouine:"Tataouine",tozeur:"Tozeur",tunis:"Tunis",zaghouan:"Zaghouan"},this.subcities={ariana:["Ariana Ville","La Soukra","Raoued","Ettadhamen","Kalaat el-Andalous"],beja:["B\xe9ja Nord","B\xe9ja Sud","Testour","Nefza","T\xe9boursouk"],ben_arous:["Ben Arous","Rades","Hammam Lif","Ezzahra","M\xe9grine"],bizerte:["Bizerte Nord","Bizerte Sud","Menzel Bourguiba","Ras Jebel","Mateur"],gabes:["Gab\xe8s Ville","Gab\xe8s Sud","El Hamma","Matmata","Mareth"],gafsa:["Gafsa Nord","Gafsa Sud","El Ksar","M\xe9tlaoui","Redeyef"],jendouba:["Jendouba Nord","Jendouba Sud","Ghardimaou","Tabarka","Fernana"],kairouan:["Kairouan Nord","Kairouan Sud","Chebika","Sbikha","Haffouz"],kasserine:["Kasserine Nord","Kasserine Sud","Sbeitla","Feriana","F\xe9riana"],kebili:["Kebili Nord","Kebili Sud","Douz","Souk Lahad"],la_manouba:["Manouba","Denden","Oued Ellil","Douar Hicher","Tebourba"],le_kef:["Le Kef Est","Le Kef Ouest","Nebeur","Tajerouine","Kalaat Senan"],mahdia:["Mahdia Ville","Ksour Essef","El Jem","Chebba","Bou Merdes"],medenine:["Medenine Nord","Medenine Sud","Houmt Souk","Midoun","Ben Gardane"],monastir:["Monastir Ville","Ksar Hellal","Sahline","Jemmel","Bekalta"],nabeul:["Nabeul Ville","Hammamet","Dar Chaabane","Korba","Kelibia"],sfax:["Sfax Ville","Sakiet Ezzit","Sakiet Eddaier","Thyna","El Ain"],sidi_bouzid:["Sidi Bouzid Est","Sidi Bouzid Ouest","Menzel Bouzaiene","Regueb","Jilma"],siliana:["Siliana Nord","Siliana Sud","Kesra","Makthar","Bourouis"],sousse:["Sousse Ville","Kalaa Kebira","Hammam Sousse","Msaken","Sidi Bou Ali"],tataouine:["Tataouine Nord","Tataouine Sud","Ghomrassen","Smar","Bir Lahmar"],tozeur:["Tozeur Ville","Nefta","Degache","Tameghza"],tunis:["Tunis Centre","La Marsa","Le Bardo","El Menzah","Carthage"],zaghouan:["Zaghouan Ville","Zriba","Nadhour","El Fahs","Bir Mcherga"]},this.stateOptions=Object.entries(this.state).map(([r,s])=>({value:r,label:s})),this.countryOptions=Object.entries(this.country).map(([r,s])=>({value:r,label:s})),this.selectedState=null,this.selectedCountry=null,this.subcityOptions=[],this.selectedSubcity=null}ngOnInit(){this.initializeFormValues(),this.subscribeToFormChanges()}ngAfterViewInit(){this.cdr.detectChanges()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}initializeFormValues(){this.latitude=this.parentForm.get("latitude")?.value||0,this.longitude=this.parentForm.get("longitude")?.value||0,this.selectedCountry=this.parentForm.get("country")?.value||null,this.selectedState=this.parentForm.get("state")?.value||null,this.cdr.markForCheck()}subscribeToFormChanges(){const e=this.parentForm.get("country")?.valueChanges.subscribe(c=>{this.selectedCountry=c,this.cdr.markForCheck()});e&&this.subscriptions.push(e);const i=this.parentForm.get("state")?.valueChanges.subscribe(c=>{this.selectedState=c,c&&this.subcities[c]?(this.subcityOptions=this.subcities[c].map(f=>({value:f,label:f})),this.parentForm.get("subcity")?.enable()):(this.subcityOptions=[],this.parentForm.get("subcity")?.reset(),this.parentForm.get("subcity")?.disable()),this.cdr.markForCheck()});i&&this.subscriptions.push(i);const r=this.parentForm.get("latitude")?.valueChanges.subscribe(c=>{this.latitude=c||0,this.cdr.markForCheck()});r&&this.subscriptions.push(r);const s=this.parentForm.get("longitude")?.valueChanges.subscribe(c=>{this.longitude=c||0,this.cdr.markForCheck()});s&&this.subscriptions.push(s)}onPositionSelected(e){this.selectedPosition=e,this.latitude=e[0],this.longitude=e[1],this.parentForm.get("latitude")?.setValue(this.latitude),this.parentForm.get("longitude")?.setValue(this.longitude),this.cdr.markForCheck()}onCountrySelected(e){this.selectedCountry=e,this.parentForm.get("country")?.setValue(e),this.cdr.markForCheck()}onStateSelected(e){this.selectedState=e,this.parentForm.get("state")?.setValue(e),this.parentForm.get("subcity")?.reset(),this.cdr.markForCheck()}onSubcitySelected(e){this.parentForm.get("subcity")?.setValue(e)}isInvalid(e){const i=this.parentForm.get(e);return!!i&&i.invalid&&(i.dirty||i.touched)}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(Pf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-location-tab"]],inputs:{parentForm:"parentForm"},decls:42,vars:24,consts:[[3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc"],[1,"form-row-body"],[1,"form-list-view"],[1,"map-container"],[2,"height","25rem","width","100%"],["accessToken","ctKDhXSujtr3KEz3ny53",3,"center","zoom","positionSelected"],[1,"grid"],["for","latitude",1,"input_label"],[1,"input_inner"],["type","text","id","latitude","formControlName","latitude",1,"input_control",3,"ngClass"],["class","input_hint mt-1","class","error-message",4,"ngIf"],["class","error-message",4,"ngIf"],["for","longitude",1,"input_label"],["type","text","id","longitude","formControlName","longitude",1,"input_control"],[1,"select-status"],["for","country",1,"input_label"],[3,"options","placeholder","selectedValue","optionSelected"],["for","city",1,"input_label"],["placeholder","Select Subcity",3,"options","selectedValue","disabled","optionSelected"],[1,"error-message"]],template:function(i,r){if(1&i&&(z(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"Location"),B(),z(6,"p",5),q(7," Indicate longitude and latitude on the map and select an address from the list "),B()(),z(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"app-map",10),qt("positionSelected",function(c){return r.onPositionSelected(c)}),B()()(),z(13,"div",11)(14,"div")(15,"label",12),q(16,"Latitude:"),B(),z(17,"div",13),$e(18,"input",14),B(),He(19,NJ,2,0,"p",15),He(20,BJ,2,0,"div",16),B(),z(21,"div")(22,"label",17),q(23,"Longitude:"),B(),z(24,"div",13),$e(25,"input",18),B(),He(26,VJ,2,0,"p",15),B(),z(27,"div",19)(28,"label",20),q(29,"Country"),B(),z(30,"app-dropdown",21),qt("optionSelected",function(c){return r.onCountrySelected(c)}),B(),He(31,jJ,2,0,"p",15),B(),z(32,"div",19)(33,"label",22),q(34,"State"),B(),z(35,"app-dropdown",21),qt("optionSelected",function(c){return r.onStateSelected(c)}),B(),He(36,HJ,2,0,"p",15),B(),z(37,"div",19)(38,"label",22),q(39,"State"),B(),z(40,"app-dropdown",23),qt("optionSelected",function(c){return r.onSubcitySelected(c)}),B(),He(41,UJ,2,0,"p",15),B()()()()()()()),2&i){let s;ye("formGroup",r.parentForm),ne(12),ye("center",z_(19,qJ,r.latitude,r.longitude))("zoom",10),ne(6),ye("ngClass",Gr(22,$J,r.isInvalid("latitude"))),ne(1),ye("ngIf",r.isInvalid("latitude")),ne(1),ye("ngIf",r.isInvalid("latitude")),ne(6),ye("ngIf",r.isInvalid("latitude")),ne(4),ye("options",r.countryOptions)("placeholder","Select a country")("selectedValue",r.selectedCountry),ne(1),ye("ngIf",r.isInvalid("country")),ne(4),ye("options",r.stateOptions)("placeholder","Select a city")("selectedValue",r.selectedState),ne(1),ye("ngIf",r.isInvalid("city")),ne(4),ye("options",r.subcityOptions)("selectedValue",r.selectedSubcity)("disabled",!(null!=(s=r.parentForm.get("state"))&&s.value)),ne(1),ye("ngIf",r.isInvalid("city"))}},dependencies:[ha,wo,Zh,hl,Wl,Pc,Ic,wh,fA,zJ],styles:[".form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5;color:#918f90}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}#map[_ngcontent-%COMP%]{height:400px;width:100%;border-radius:10px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:1.5rem}.form-list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.input_label[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin:0 0 .25rem;font-weight:500;cursor:pointer;font-size:1rem;line-height:1.5}.input_inner[_ngcontent-%COMP%]{display:flex;align-items:center;height:3rem;padding:0 .05rem;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.input_control[_ngcontent-%COMP%]{flex-grow:1;width:100%;height:100%;padding:0 .4rem;font:inherit;color:#1e1e1e;background:none;border:none;border-radius:.25rem}.select-status[_ngcontent-%COMP%]   option.selected-option[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#fff important}.select-status[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{background-color:#e5e7eb;color:#fff important;cursor:not-allowed}.select-status[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{pointer-events:none}.select[_ngcontent-%COMP%]{flex-grow:1;height:3rem;font:inherit;color:inherit;background:none;border:1px solid #DEDEDE;border-radius:.25rem;padding:0 .9375rem 0 .875rem;appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:right 15px center;font-size:17px;line-height:1.5;width:100%}.input_hint[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#918f90}.error-message[_ngcontent-%COMP%]{color:red;font-size:.875rem;line-height:1.43;margin-top:.25rem}"],changeDetection:0})}}return t})();function WJ(t,n){if(1&t){const e=Ki();z(0,"button",37),qt("click",function(){const s=An(e).$implicit;return Mn(ht().selectBedroom(s.value))}),q(1),B()}if(2&t){const e=n.$implicit;let r;Z("selected",(null==(r=ht().parentForm.get("bedrooms"))?null:r.value)===e.value),ne(1),Ft(" ",e.label," ")}}function ZJ(t,n){1&t&&(z(0,"div",38),q(1,"Required"),B())}function YJ(t,n){if(1&t){const e=Ki();z(0,"button",37),qt("click",function(){const s=An(e).$implicit;return Mn(ht().selectBathroom(s.value))}),q(1),B()}if(2&t){const e=n.$implicit;let r;Z("selected",(null==(r=ht().parentForm.get("bathrooms"))?null:r.value)===e.value),ne(1),Ft(" ",e.label," ")}}function XJ(t,n){1&t&&(z(0,"div",38),q(1,"Required"),B())}function KJ(t,n){if(1&t){const e=Ki();z(0,"button",37),qt("click",function(){const s=An(e).$implicit;return Mn(ht().selectParking(s.value))}),q(1),B()}if(2&t){const e=n.$implicit;let r;Z("selected",(null==(r=ht().parentForm.get("parkingSpots"))?null:r.value)===e.value),ne(1),Ft(" ",e.label," ")}}function QJ(t,n){1&t&&(z(0,"div",38),q(1,"Required"),B())}let JJ=(()=>{class t{constructor(){this.bedroomOptions=[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"},{value:"studio",label:"Studio"}],this.bathroomOptions=[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"}],this.parkingOptions=[{value:"0",label:"0"},{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5+",label:"5+"}]}ngOnInit(){}isInvalid(e){const i=this.parentForm.get(e);return!!i&&i.invalid&&(i.dirty||i.touched)}selectBedroom(e){this.parentForm.get("bedrooms")?.setValue(e)}selectBathroom(e){this.parentForm.get("bathrooms")?.setValue(e)}selectParking(e){this.parentForm.get("parkingSpots")?.setValue(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-specification-tab"]],inputs:{parentForm:"parentForm"},decls:90,vars:7,consts:[[1,"tab-container",3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc"],[1,"form-row-body"],[1,"form-list-view"],["for","bedroom-options",1,"input_label"],[1,"bedroom-options"],["type","button",3,"selected","click",4,"ngFor","ngForOf"],["class","input_hint mt-1","class","error-message",4,"ngIf"],["for","bathroom-options",1,"input_label"],["for","parking-options",1,"input_label"],[1,"grid"],[1,"input"],["for","size",1,"input_label"],[1,"input_inner"],["type","number","id","size","formControlName","size",1,"form_control"],[1,"unit"],["for","plotSize",1,"input_label"],["type","number","id","plotSize","formControlName","plotSize",1,"form_control"],["for","builtUpArea",1,"input_label"],["type","number","id","builtUpArea","formControlName","builtUpArea",1,"form_control"],[1,"grid-2"],["for","constructionYear",1,"input_label"],["type","number","id","constructionYear","formControlName","constructionYear",1,"form_control"],["for","Renovationyear",1,"input_label"],["type","number","id","Renovationyear","formControlName","Renovationyear",1,"form_control"],["for","Furnishing",1,"input_label"],[1,"radio_options"],[1,"radio_option"],["type","radio","formControlName","Furnishing","value","YES",1,"radio_input"],[1,"radio_state","text-bold"],["type","radio","formControlName","Furnishing","value","NO",1,"radio_input"],[1,"radio_state"],["type","radio","formControlName","Furnishing","value","PARTLY",1,"radio_input"],["type","button",3,"click"],[1,"error-message"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"Rooms"),B(),z(6,"p",5),q(7," Specify the number of rooms. Kitchen and other auxiliary premises do not need to be indicated. "),B()(),z(8,"div",6)(9,"div",7)(10,"label",8),q(11,"Number of bedrooms"),B(),z(12,"div",9),He(13,WJ,2,3,"button",10),B(),He(14,ZJ,2,0,"div",11),B(),z(15,"div",7)(16,"label",12),q(17,"Number of bathrooms"),B(),z(18,"div",9),He(19,YJ,2,3,"button",10),B(),He(20,XJ,2,0,"div",11),B()()(),z(21,"div",2)(22,"div",3)(23,"h2",4),q(24,"Parking"),B(),z(25,"p",5),q(26,"Provide information about parking availability"),B()(),z(27,"div",6)(28,"div",7)(29,"label",13),q(30,"Number of parking slots"),B(),z(31,"div",9),He(32,KJ,2,3,"button",10),B(),He(33,QJ,2,0,"div",11),B()()(),z(34,"div",2)(35,"div",3)(36,"h2",4),q(37,"Parameters"),B(),z(38,"p",5),q(39,"Provide apartment's characteristics"),B()(),z(40,"div",6)(41,"div",14)(42,"div",15)(43,"label",16),q(44,"Size"),B(),z(45,"div",17),$e(46,"input",18),z(47,"span",19),q(48,"m\xb2"),B()()(),z(49,"div",15)(50,"label",20),q(51,"Plot Size"),B(),z(52,"div",17),$e(53,"input",21),z(54,"span",19),q(55,"m\xb2"),B()()(),z(56,"div",15)(57,"label",22),q(58,"Built-up area"),B(),z(59,"div",17),$e(60,"input",23),z(61,"span",19),q(62,"m\xb2"),B()()()(),z(63,"div",24)(64,"div",15)(65,"label",25),q(66,"Construction year"),B(),z(67,"div",17),$e(68,"input",26),B()(),z(69,"div",15)(70,"label",27),q(71,"Renovation year"),B(),z(72,"div",17),$e(73,"input",28),B()()(),z(74,"div",15)(75,"label",29),q(76,"Furnishing"),B(),z(77,"div",30)(78,"label",31),$e(79,"input",32),z(80,"span",33),q(81,"Yes"),B()(),z(82,"label",31),$e(83,"input",34),z(84,"span",35),q(85,"No"),B()(),z(86,"label",31),$e(87,"input",36),z(88,"span",35),q(89,"Partly"),B()()()()()()()()),2&i&&(ye("formGroup",r.parentForm),ne(13),ye("ngForOf",r.bedroomOptions),ne(1),ye("ngIf",r.isInvalid("bedrooms")),ne(5),ye("ngForOf",r.bathroomOptions),ne(1),ye("ngIf",r.isInvalid("bathrooms")),ne(12),ye("ngForOf",r.parkingOptions),ne(1),ye("ngIf",r.isInvalid("parkingSpots")))},dependencies:[qs,wo,hl,Qw,Jw,Wl,Pc,Ic,wh],styles:['.form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto;border-bottom:#DEDEDE 1px solid;padding-bottom:1rem}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5;color:#918f90}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.bedroom-options[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:5px}.bedroom-options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:40px;height:40px;border:1px solid #ccc;background-color:#fff;border-radius:4px;cursor:pointer;padding:8px 12px;font-size:14px}.bedroom-options[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#69b99d;border-color:#999}.input_hint[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#918f90}.input_label[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin:0 0 .25rem;font-weight:500;cursor:pointer;font-size:1rem;line-height:1.5}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1.5rem}.input_control[_ngcontent-%COMP%]{flex-grow:1;width:100%;height:100%;padding:0 .04rem;font:inherit;color:#1e1e1e;background:none;border:none;border-radius:.25rem}.input_inner[_ngcontent-%COMP%]{display:flex;align-items:center;height:3rem;padding:0 .05rem;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.form_control[_ngcontent-%COMP%]{outline:none;flex-grow:1;width:100%;height:100%;padding:0 .5rem;font:inherit;color:inherit;background:none;border:none;border-radius:.25rem}.unit[_ngcontent-%COMP%]{color:gray;margin-right:.5rem}.grid-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr));gap:1.5rem;display:grid}.radio_input[_ngcontent-%COMP%]{appearance:none;background-color:#fff;border:2px solid #E1E1E1;border-radius:50%;width:20px;height:20px;cursor:pointer;position:relative}.radio_input[_ngcontent-%COMP%]:checked{background-color:#69b99d;border-color:#69b99d}.radio_input[_ngcontent-%COMP%]:checked:before{content:"";display:block;width:7px;height:7px;background-color:#fff;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.radio_options[_ngcontent-%COMP%]{display:flex}.radio--row[_ngcontent-%COMP%]   .radio_options[_ngcontent-%COMP%]{flex-direction:row}.radio--row[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0}.radio_option[_ngcontent-%COMP%]{display:flex;gap:1rem;width:-moz-fit-content;width:fit-content;cursor:pointer;line-height:1.5;flex-grow:1;flex-basis:0;padding:1.4375rem;border-width:.0625rem;border-right-width:0;border:1px solid #DEDEDE;border-radius:.25rem}.form-row-view[_ngcontent-%COMP%]:last-child{border-bottom:none}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.error-message[_ngcontent-%COMP%]{color:red;font-size:.875rem;line-height:1.43;margin-top:.25rem}']})}}return t})();function eee(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}function tee(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}function nee(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}function iee(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}function ree(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}function oee(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11),q(2),B(),z(3,"div",12)(4,"button",13),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"check"))}),z(5,"span"),Ao(),z(6,"svg",14),$e(7,"path",15),B()()(),Ns(),z(8,"button",16),qt("click",function(){const s=An(e).$implicit;return Mn(ht().toggleAmenity(s.id,"delete"))}),z(9,"span"),Ao(),z(10,"svg",17),$e(11,"path",18),B()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.name),ne(2),Z("selected",i.isSelected(e.id,"check")),ne(4),Z("selected",i.isSelected(e.id,"delete"))}}let see=(()=>{class t{constructor(e){this.fb=e,this.selectedAction={},this.buildingAmenities=[{id:"centralAC",name:"Central A/C & Heating"},{id:"parking",name:"Parking"},{id:"elevator",name:"Elevator"},{id:"petsAllowed",name:"Pets Allowed"}],this.serviceAmenities=[{id:"conciergeService",name:"Concierge Service"},{id:"maidService",name:"Maid Service"},{id:"securityService",name:"Security Service"},{id:"lobbyInBuilding",name:"Lobby in Building"}],this.roomAmenities=[{id:"maidsRoom",name:"Maids Room"},{id:"studyRoom",name:"Study Room"},{id:"balcony",name:"Balcony"},{id:"walkInCloset",name:"Walk-In Closet"}],this.areaAmenities=[{id:"childrensPlayArea",name:"Children's Play Area"},{id:"garden",name:"Garden"},{id:"barbecueArea",name:"Barbecue Area"}],this.wellnessAmenities=[{id:"jacuzzi",name:"Jacuzzi"},{id:"sauna",name:"Sauna"},{id:"sharedGym",name:"Shared Gym"},{id:"privateGym",name:"Private Gym"},{id:"sharedPool",name:"Shared Pool"},{id:"privatePool",name:"Private Pool"},{id:"spa",name:"Spa"}],this.nearbyAmenities=[{id:"viewOfWater",name:"View of Water"},{id:"viewOfLandmark",name:"View of Landmark"},{id:"nearbyHospitals",name:"Nearby Hospitals"},{id:"nearbyPublicTransport",name:"Nearby Public Transport"},{id:"nearbySchools",name:"Nearby Schools"},{id:"nearbyShopping",name:"Nearby Shopping"}]}ngOnInit(){this.initForm(),this.amenitiesData?(this.amenitiesForm.patchValue(this.amenitiesData),Object.keys(this.amenitiesData).forEach(e=>{this.selectedAction[e]=this.amenitiesData[e]?"check":"delete"})):this.setDefaultSelectedActions(),this.parentForm&&this.parentForm.addControl("amenities",this.amenitiesForm)}initForm(){const e={};[...this.buildingAmenities,...this.serviceAmenities,...this.roomAmenities,...this.areaAmenities,...this.wellnessAmenities,...this.nearbyAmenities].forEach(i=>{e[i.id]=[!1]}),this.amenitiesForm=this.fb.group(e)}toggleAmenity(e,i){const r=this.amenitiesForm.get(e);r&&("check"===i?(this.selectedAction[e]="check",r.setValue(!0)):"delete"===i&&(this.selectedAction[e]="delete",r.setValue(!1)))}isSelected(e,i){return this.selectedAction[e]===i}setDefaultSelectedActions(){[...this.buildingAmenities,...this.serviceAmenities,...this.roomAmenities,...this.areaAmenities,...this.wellnessAmenities,...this.nearbyAmenities].forEach(e=>{this.selectedAction[e.id]="delete"})}static{this.\u0275fac=function(i){return new(i||t)(st(Ep))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-amenities-tab"]],inputs:{parentForm:"parentForm",amenitiesData:"amenitiesData"},decls:62,vars:7,consts:[[1,"tab-container",3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc","text-body-secondary"],[1,"form-row-body"],[1,"form-list-view"],[1,"amenities-list"],["class","amenity-item",4,"ngFor","ngForOf"],[1,"amenity-item"],[1,"amenity-name","fs-6","text"],[1,"amenity-controls"],["type","button",1,"circle-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"icon-check"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0"],["type","button",1,"circle-button","delete-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"icon-del"],["d","M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"Building"),B(),z(6,"p",5),q(7,"These are amenities that clients typically look for in a property"),B()(),z(8,"div",6)(9,"div",7)(10,"div",8),He(11,eee,12,5,"div",9),B()()()(),z(12,"div",2)(13,"div",3)(14,"h2",4),q(15,"Service"),B(),z(16,"p",5),q(17,"Assistance given to residents"),B()(),z(18,"div",6)(19,"div",7)(20,"div",8),He(21,tee,12,5,"div",9),B()()()(),z(22,"div",2)(23,"div",3)(24,"h2",4),q(25,"Rooms"),B(),z(26,"p",5),q(27,"Add all the rooms residents can use"),B()(),z(28,"div",6)(29,"div",7)(30,"div",8),He(31,nee,12,5,"div",9),B()()()(),z(32,"div",2)(33,"div",3)(34,"h2",4),q(35,"Areas"),B(),z(36,"p",5),q(37,"Add all the areas residents can use"),B()(),z(38,"div",6)(39,"div",7)(40,"div",8),He(41,iee,12,5,"div",9),B()()()(),z(42,"div",2)(43,"div",3)(44,"h2",4),q(45,"Wellness"),B(),z(46,"p",5),q(47,"Facilities to empower residents to focus on their physical and mental health"),B()(),z(48,"div",6)(49,"div",7)(50,"div",8),He(51,ree,12,5,"div",9),B()()()(),z(52,"div",2)(53,"div",3)(54,"h2",4),q(55,"Nearby"),B(),z(56,"p",5),q(57,"Point some location features "),B()(),z(58,"div",6)(59,"div",7)(60,"div",8),He(61,oee,12,5,"div",9),B()()()()()()),2&i&&(ye("formGroup",r.parentForm),ne(11),ye("ngForOf",r.buildingAmenities),ne(10),ye("ngForOf",r.serviceAmenities),ne(10),ye("ngForOf",r.roomAmenities),ne(10),ye("ngForOf",r.areaAmenities),ne(10),ye("ngForOf",r.wellnessAmenities),ne(10),ye("ngForOf",r.nearbyAmenities))},dependencies:[qs,Pc,Ic],styles:[".form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto;padding:25px}.form-row-view[_ngcontent-%COMP%]:not(:first-child){padding-bottom:.5rem;margin-bottom:.5rem;border-top:.0625rem solid lightgray}.separator[_ngcontent-%COMP%]{width:100px;height:1px;background-color:#d3d3d3;margin:1rem 0}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.file-uploader[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:5px;padding:2rem;text-align:center;cursor:pointer;transition:all .3s ease}.file-uploader.dragover[_ngcontent-%COMP%]{background-color:#0000000d;border-color:#666}.upload-area[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem}.input-text[_ngcontent-%COMP%]{margin-bottom:.5rem}.text-sm[_ngcontent-%COMP%]{font-size:.875rem}.upload-limits[_ngcontent-%COMP%]{color:#6c757d}.error[_ngcontent-%COMP%]{color:#dc3545;margin-top:.5rem}.preview-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;margin-top:1rem}.preview-item[_ngcontent-%COMP%]{position:relative;width:150px;height:150px;border:1px solid #ddd;border-radius:4px;overflow:hidden}.preview-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;width:24px;height:24px;border-radius:50%;background-color:#fffc;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s}.remove-btn[_ngcontent-%COMP%]:hover{background-color:#fff}.remove-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:12px;height:12px;fill:#dc3545}.video-tour[_ngcontent-%COMP%], .virtual-tour[_ngcontent-%COMP%]{width:100%}.video-inputs[_ngcontent-%COMP%], .virtual-tour-inputs[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem;border-radius:5px;margin-bottom:1rem}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex-grow:1}label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-weight:500}input[type=text][_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ced4da;border-radius:.25rem;margin-bottom:1rem}.delete-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.25rem}.delete-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px;fill:#dc3545}.add-btn[_ngcontent-%COMP%]{background-color:#212529;color:#fff;border:none;padding:.5rem 1rem;border-radius:.25rem;cursor:pointer;transition:background-color .2s}.add-btn[_ngcontent-%COMP%]:hover{background-color:#343a40}.amenities-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.amenity-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 0}.amenity-item[_ngcontent-%COMP%]:not(:first-child){border-top:.0625rem solid lightgray}.amenity-name[_ngcontent-%COMP%]{font-size:14px;color:#000}.amenity-controls[_ngcontent-%COMP%]{display:flex;gap:10px}.circle-button[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid black;background-color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.circle-button[_ngcontent-%COMP%]:hover{background-color:#000}.circle-button[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]{color:#fff}.icon-del[_ngcontent-%COMP%]{width:100%;height:100%}.circle-button.selected[_ngcontent-%COMP%]{background-color:#000;border-color:gray;color:#fff}"]})}}return t})();function aee(t,n){1&t&&(z(0,"p",26),q(1,"Required"),B())}function lee(t,n){1&t&&(z(0,"p",26),q(1,"Required"),B())}function cee(t,n){if(1&t){const e=Ki();z(0,"div",8)(1,"label",9),q(2,"select unit"),B(),z(3,"app-dropdown",27),qt("optionSelected",function(r){return An(e),Mn(ht().onPriceUnitSelected(r))}),B(),He(4,lee,2,0,"p",13),B()}if(2&t){const e=ht();ne(3),ye("options",e.priceunit)("placeholder","Select a unit")("selectedValue",e.selectedPriceUnit),ne(1),ye("ngIf",e.isInvalid("pricepermonth"))}}function dee(t,n){1&t&&(z(0,"div",28)(1,"div",8)(2,"label",29),q(3,"Price/m\xb2"),B(),z(4,"div",10),$e(5,"input",30),z(6,"span",12),q(7,"DTN"),B()()()())}let hee=(()=>{class t{constructor(){this.dealType="sale",this.priceunit=[{value:"per month",label:"per month"},{value:"per day",label:"per day"}],this.selectedPriceUnit=null}ngOnInit(){}ngOnChanges(e){e.dealType&&console.log("Deal type changed to:",this.dealType)}isInvalid(e){const i=this.parentForm.get(e);return!!i&&i.invalid&&(i.dirty||i.touched)}get isRental(){return"rent"===this.dealType}onPriceUnitSelected(e){this.selectedPriceUnit=e,this.parentForm.get("priceunit")?.setValue(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-price-tab"]],inputs:{parentForm:"parentForm",dealType:"dealType"},features:[ol],decls:45,vars:5,consts:[[1,"tab-container",3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc","text-body-secondary"],[1,"form-row-body"],[1,"form-list-view"],[1,"input"],["for","inputref",1,"input_label"],[1,"input_inner"],["type","number","id","inputref","name","inputref","formControlName","price","placeholder","Enter the price",1,"input_control"],[1,"unit"],["class","input_hint mt-1","class","error-message",4,"ngIf"],["class","input",4,"ngIf"],["class","grid",4,"ngIf"],[1,"checkbox-container"],[1,"custom-checkbox"],["type","checkbox","formControlName","hideprice"],[1,"checkmark"],[1,"input_label"],[1,"radio_options"],[1,"radio_option"],["type","radio","name","charges","formControlName","charges","value","Included",1,"radio_input"],[1,"radio_state","text-base"],["type","radio","name","charges","formControlName","charges","value","Notincluded",1,"radio_input"],[1,"error-message"],["formControlName","priceunit",3,"options","placeholder","selectedValue","optionSelected"],[1,"grid"],["for","price/sqt",1,"input_label"],["type","number","id","price/sqt","name","inputref","formControlName","pricesqft","placeholder","Enter the price per sqft",1,"input_control"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"Price"),B(),z(6,"p",5),q(7," Specify the real price without additional fees, charges and other payments "),B()(),z(8,"div",6)(9,"div",7)(10,"div",8)(11,"label",9),q(12),B(),z(13,"div",10),$e(14,"input",11),z(15,"span",12),q(16,"DTN"),B()(),He(17,aee,2,0,"p",13),B(),He(18,cee,5,4,"div",14),B(),He(19,dee,8,0,"div",15),z(20,"div",8)(21,"div",16)(22,"label",17),$e(23,"input",18)(24,"span",19),q(25," Hides the price "),B()()()()(),z(26,"div",2)(27,"div",3)(28,"h2",4),q(29,"Costs"),B(),z(30,"p",5),q(31," Specify all the additional fees and charges like water, electricity,taxes, gas, internet, etc. that will be charged to the tenant or buyer. "),B()(),z(32,"div",6)(33,"div",7)(34,"label",20),q(35,"Charges"),B(),z(36,"div",21)(37,"label",22),$e(38,"input",23),z(39,"span",24),q(40,"Included"),B()(),z(41,"label",22),$e(42,"input",25),z(43,"span",24),q(44," Not included"),B()()()()()()()()),2&i&&(ye("formGroup",r.parentForm),ne(12),Ft(" ",r.isRental?"Price per month":"Price"," "),ne(5),ye("ngIf",r.isInvalid("price")),ne(1),ye("ngIf",r.isRental),ne(1),ye("ngIf",!r.isRental))},dependencies:[wo,hl,Qw,CT,Jw,Wl,Pc,Ic,wh,fA],styles:['.form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto;border-bottom:#DEDEDE 1px solid;padding-bottom:1rem}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.input_label[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin:0 0 .25rem;font-weight:500;cursor:pointer;font-size:1rem;line-height:1.5}.input_inner[_ngcontent-%COMP%]{display:flex;align-items:center;height:3rem;padding:0 .05rem;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.input_control[_ngcontent-%COMP%]{outline:none;flex-grow:1;width:100%;height:100%;padding:0 .5rem;font:inherit;color:inherit;background:none;border:none;border-radius:.25rem}.unit[_ngcontent-%COMP%]{color:#918f90;margin-right:.5rem}.input_hint[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#918f90}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.input-button[_ngcontent-%COMP%]{place-self:center}.button[_ngcontent-%COMP%]{width:3rem;height:3rem;margin-bottom:5px;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.custom-checkbox[_ngcontent-%COMP%]{position:relative;cursor:pointer;font-size:16px;padding-left:35px;-webkit-user-select:none;user-select:none;color:#333;font-weight:500}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.checkmark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:24px;width:24px;background-color:#fff;border:2px solid #ddd;border-radius:4px}.custom-checkbox[_ngcontent-%COMP%]:hover   input[_ngcontent-%COMP%] ~ .checkmark[_ngcontent-%COMP%]{border-color:#ccc}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]{background-color:#69b99d;border-color:#69b99d}.checkmark[_ngcontent-%COMP%]:after{content:"";position:absolute;display:none}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]:after{display:block}.custom-checkbox[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{left:9px;top:5px;width:5px;height:10px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg)}.form-row-view[_ngcontent-%COMP%]:last-child{border-bottom:none}.radio_legend[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin-bottom:.5rem;font-weight:600;font-size:1rem;line-height:1.5;margin-top:.5rem}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.radio_input[_ngcontent-%COMP%]{appearance:none;background-color:#fff;border:2px solid #E1E1E1;border-radius:50%;width:20px;height:20px;cursor:pointer;position:relative}.radio_input[_ngcontent-%COMP%]:checked{background-color:#69b99d;border-color:#69b99d}.radio_input[_ngcontent-%COMP%]:checked:before{content:"";display:block;width:7px;height:7px;background-color:#fff;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.radio_options[_ngcontent-%COMP%]{display:flex}.radio--row[_ngcontent-%COMP%]   .radio_options[_ngcontent-%COMP%]{flex-direction:row}.radio--row[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0}.radio_option[_ngcontent-%COMP%]{display:flex;gap:1rem;width:-moz-fit-content;width:fit-content;cursor:pointer;line-height:1.5;flex-grow:1;flex-basis:0;padding:1.4375rem;border-width:.0625rem;border-right-width:0;border:1px solid #DEDEDE;border-radius:.25rem}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.error-message[_ngcontent-%COMP%]{color:red;font-size:.875rem;line-height:1.43;margin-top:.25rem}']})}}return t})();const uee=["photoFileInput"],pee=["floorFileInput"],fee=["docFileInput"];function mee(t,n){1&t&&(z(0,"p",20),q(1,"Please upload at least 1 item"),B())}function gee(t,n){if(1&t){const e=Ki();z(0,"div",23),$e(1,"img",24),z(2,"button",25),qt("click",function(){const s=An(e).index;return Mn(ht(2).removePhoto(s))}),Ao(),z(3,"svg",26),$e(4,"path",27),B()()()}if(2&t){const e=n.$implicit;ne(1),ye("src",e,fs)}}function _ee(t,n){if(1&t&&(z(0,"div",21),He(1,gee,5,1,"div",22),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.imagePreviews)}}function yee(t,n){1&t&&(z(0,"p",20),q(1,"Please upload at least 1 floor plan"),B())}function vee(t,n){if(1&t){const e=Ki();z(0,"div",23),$e(1,"img",28),z(2,"button",25),qt("click",function(){const s=An(e).index;return Mn(ht(2).removeFloorPlan(s))}),Ao(),z(3,"svg",26),$e(4,"path",27),B()()()}if(2&t){const e=n.$implicit;ne(1),ye("src",e,fs)}}function bee(t,n){if(1&t&&(z(0,"div",21),He(1,vee,5,1,"div",22),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.floorPreviews)}}function xee(t,n){1&t&&(z(0,"p",20),q(1,"Please upload at least 1 document"),B())}function wee(t,n){if(1&t){const e=Ki();z(0,"div",23),$e(1,"img",29),z(2,"button",25),qt("click",function(){const s=An(e).index;return Mn(ht(2).removeDocument(s))}),Ao(),z(3,"svg",26),$e(4,"path",27),B()()()}if(2&t){const e=n.$implicit;ne(1),ye("src",e,fs)}}function kee(t,n){if(1&t&&(z(0,"div",21),He(1,wee,5,1,"div",22),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.documentPreviews)}}let Mee=(()=>{class t{constructor(e){this.fb=e,this.isPhotoDragOver=!1,this.isFloorDragOver=!1,this.isDocDragOver=!1,this.showPhotoError=!1,this.showFloorError=!1,this.showDocError=!1,this.imagePreviews=[],this.floorPreviews=[],this.documentPreviews=[]}ngOnInit(){this.initializeFormArrays(),this.loadExistingPreviews()}initializeFormArrays(){const e=this.parentForm.get("media");e?(e.contains("photos")||e.addControl("photos",this.fb.array([])),e.contains("floorPlans")||e.addControl("floorPlans",this.fb.array([])),e.contains("documents")||e.addControl("documents",this.fb.array([])),e.contains("videos")||e.addControl("videos",this.fb.array([])),e.contains("virtualTours")||e.addControl("virtualTours",this.fb.array([]))):(this.parentForm.contains("photos")||this.parentForm.addControl("photos",this.fb.array([])),this.parentForm.contains("floorPlans")||this.parentForm.addControl("floorPlans",this.fb.array([])),this.parentForm.contains("documents")||this.parentForm.addControl("documents",this.fb.array([])),this.parentForm.contains("videos")||this.parentForm.addControl("videos",this.fb.array([])),this.parentForm.contains("virtualTours")||this.parentForm.addControl("virtualTours",this.fb.array([])))}loadExistingPreviews(){this.imagePreviews=this.photosArray.controls.map(e=>e.value.preview||""),this.showPhotoError=0===this.imagePreviews.length,this.floorPreviews=this.floorPlansArray.controls.map(e=>e.value.preview||""),this.showFloorError=0===this.floorPreviews.length,this.documentPreviews=this.documentsArray.controls.map(e=>e.value.preview||""),this.showDocError=0===this.documentPreviews.length}get photosArray(){const e=this.parentForm.get("media");return e?e.get("photos"):this.parentForm.get("photos")}get floorPlansArray(){const e=this.parentForm.get("media");return e?e.get("floorPlans"):this.parentForm.get("floorPlans")}get documentsArray(){const e=this.parentForm.get("media");return e?e.get("documents"):this.parentForm.get("documents")}get videosArray(){const e=this.parentForm.get("media");return e?e.get("videos"):this.parentForm.get("videos")}get virtualToursArray(){const e=this.parentForm.get("media");return e?e.get("virtualTours"):this.parentForm.get("virtualTours")}triggerPhotoFileInput(){this.photoFileInput.nativeElement.click()}onPhotoFileSelect(e){const i=e.target.files;i&&this.processPhotoFiles(i)}onPhotoDragOver(e){e.preventDefault(),this.isPhotoDragOver=!0}onPhotoDragLeave(){this.isPhotoDragOver=!1}onPhotoDrop(e){e.preventDefault(),this.isPhotoDragOver=!1,e.dataTransfer?.files&&this.processPhotoFiles(e.dataTransfer.files)}processPhotoFiles(e){Array.from(e).forEach(i=>{if(this.isValidFile(i)){const r=new FileReader;r.onload=s=>{const c=s.target?.result;this.imagePreviews.push(c),this.photosArray.push(this.fb.control({file:i,preview:c}))},r.readAsDataURL(i)}}),this.showPhotoError=0===this.imagePreviews.length}removePhoto(e){this.imagePreviews.splice(e,1),this.photosArray.removeAt(e),this.showPhotoError=0===this.imagePreviews.length}triggerFloorFileInput(){this.floorFileInput.nativeElement.click()}onFloorFileSelect(e){const i=e.target.files;i&&this.processFloorFiles(i)}onFloorDragOver(e){e.preventDefault(),this.isFloorDragOver=!0}onFloorDragLeave(){this.isFloorDragOver=!1}onFloorDrop(e){e.preventDefault(),this.isFloorDragOver=!1,e.dataTransfer?.files&&this.processFloorFiles(e.dataTransfer.files)}processFloorFiles(e){Array.from(e).forEach(i=>{if(this.isValidFile(i)){const r=new FileReader;r.onload=s=>{const c=s.target?.result;this.floorPreviews.push(c),this.floorPlansArray.push(this.fb.control({file:i,preview:c}))},r.readAsDataURL(i)}}),this.showFloorError=0===this.floorPreviews.length}removeFloorPlan(e){this.floorPreviews.splice(e,1),this.floorPlansArray.removeAt(e),this.showFloorError=0===this.floorPreviews.length}triggerDocFileInput(){this.docFileInput.nativeElement.click()}onDocFileSelect(e){const i=e.target.files;i&&this.processDocFiles(i)}onDocDragOver(e){e.preventDefault(),this.isDocDragOver=!0}onDocDragLeave(){this.isDocDragOver=!1}onDocDrop(e){e.preventDefault(),this.isDocDragOver=!1,e.dataTransfer?.files&&this.processDocFiles(e.dataTransfer.files)}processDocFiles(e){Array.from(e).forEach(i=>{if(this.isValidFile(i)){const r=new FileReader;r.onload=s=>{const c=s.target?.result;this.documentPreviews.push(c),this.documentsArray.push(this.fb.control({file:i,preview:c}))},r.readAsDataURL(i)}}),this.showDocError=0===this.documentPreviews.length}removeDocument(e){this.documentPreviews.splice(e,1),this.documentsArray.removeAt(e),this.showDocError=0===this.documentPreviews.length}addVideo(){this.videosArray.push(this.fb.group({title:[""],url:[""],description:[""]}))}removeVideo(e){this.videosArray.removeAt(e)}addVirtualTour(){this.virtualToursArray.push(this.fb.group({title:[""],url:[""],description:[""]}))}removeVirtualTour(e){this.virtualToursArray.removeAt(e)}isValidFile(e){const r=["image/webp","image/jpeg","image/jpg","image/png"].includes(e.type)&&e.size<=5242880;return r||alert("Invalid file type or size exceeds 5MB"),r}static{this.\u0275fac=function(i){return new(i||t)(st(Ep))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-media-tab"]],viewQuery:function(i,r){if(1&i&&(Df(uee,5),Df(pee,5),Df(fee,5)),2&i){let s;js(s=Hs())&&(r.photoFileInput=s.first),js(s=Hs())&&(r.floorFileInput=s.first),js(s=Hs())&&(r.docFileInput=s.first)}},inputs:{parentForm:"parentForm"},decls:65,vars:13,consts:[[3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc","text-body-secondary","fs-6"],[1,"form-row-body"],[1,"form-list-view"],[1,"form-list-view-body"],[1,"file-uploader",3,"click","dragover","dragleave","drop"],["type","file","accept","image/webp, image/jpeg, image/jpg, image/png","multiple","","hidden","",1,"upload-input",3,"change"],["photoFileInput",""],[1,"upload-area"],[1,"input-text"],[1,"text-decoration-underline"],[1,"upload-limits","text-sm"],["class","text-hint text-sm error",4,"ngIf"],["class","preview-container",4,"ngIf"],["floorFileInput",""],["docFileInput",""],[1,"text-hint","text-sm","error"],[1,"preview-container"],["class","preview-item",4,"ngFor","ngForOf"],[1,"preview-item"],["alt","Preview",3,"src"],["type","button",1,"remove-btn",3,"click"],["viewBox","0 0 448 512","xmlns","http://www.w3.org/2000/svg"],["d","M135.2 17.7C140.1 7.125 150.5 0 161.9 0H286.1C297.5 0 307.9 7.125 312.8 17.7L320 32H432C440.8 32 448 39.16 448 48V80C448 88.84 440.8 96 432 96H16C7.164 96 0 88.84 0 80V48C0 39.16 7.164 32 16 32H128L135.2 17.7zM32 128H416L395.6 467.8C394.2 489.1 377.4 505.7 355.1 505.7H92.9C70.58 505.7 53.79 489.1 52.42 467.8L32 128z"],["alt","Floor Preview",3,"src"],["alt","Document Preview",3,"src"]],template:function(i,r){1&i&&(z(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"Photos"),B(),z(6,"p",5),q(7," Upload photos of all the rooms, kitchen, bathroom, views from the window. The pictures should not contain people, animals, alcohol, tobacco, weapons. "),B()(),z(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),qt("click",function(){return r.triggerPhotoFileInput()})("dragover",function(c){return r.onPhotoDragOver(c)})("dragleave",function(){return r.onPhotoDragLeave()})("drop",function(c){return r.onPhotoDrop(c)}),z(12,"input",10,11),qt("change",function(c){return r.onPhotoFileSelect(c)}),B(),z(14,"div",12)(15,"p",13)(16,"span",14),q(17,"Upload a file"),B(),q(18," or drag and drop "),B(),z(19,"p",15),q(20,"WEBP, JPG, JPEG, PNG up to 5 MB"),B()(),He(21,mee,2,0,"p",16),B(),He(22,_ee,2,1,"div",17),B()()()(),z(23,"div",2)(24,"div",3)(25,"h2",4),q(26,"Floor"),B(),z(27,"p",5),q(28," Upload floor plans to show the layout of the property. "),B()(),z(29,"div",6)(30,"div",7)(31,"div",8)(32,"div",9),qt("click",function(){return r.triggerFloorFileInput()})("dragover",function(c){return r.onFloorDragOver(c)})("dragleave",function(){return r.onFloorDragLeave()})("drop",function(c){return r.onFloorDrop(c)}),z(33,"input",10,18),qt("change",function(c){return r.onFloorFileSelect(c)}),B(),z(35,"div",12)(36,"p",13)(37,"span",14),q(38,"Upload floor plan"),B(),q(39," or drag and drop "),B(),z(40,"p",15),q(41,"WEBP, JPG, JPEG, PNG up to 5 MB"),B()(),He(42,yee,2,0,"p",16),B(),He(43,bee,2,1,"div",17),B()()()(),z(44,"div",2)(45,"div",3)(46,"h2",4),q(47,"Documents"),B(),z(48,"p",5),q(49," Upload all the necessary documents one by one and set their visibility "),B()(),z(50,"div",6)(51,"div",7)(52,"div",8)(53,"div",9),qt("click",function(){return r.triggerDocFileInput()})("dragover",function(c){return r.onDocDragOver(c)})("dragleave",function(){return r.onDocDragLeave()})("drop",function(c){return r.onDocDrop(c)}),z(54,"input",10,19),qt("change",function(c){return r.onDocFileSelect(c)}),B(),z(56,"div",12)(57,"p",13)(58,"span",14),q(59,"Upload a document"),B(),q(60," or drag and drop "),B(),z(61,"p",15),q(62,"WEBP, JPG, JPEG, PNG up to 5 MB"),B()(),He(63,xee,2,0,"p",16),B(),He(64,kee,2,1,"div",17),B()()()()()()),2&i&&(ye("formGroup",r.parentForm),ne(11),Z("dragover",r.isPhotoDragOver),ne(10),ye("ngIf",r.showPhotoError),ne(1),ye("ngIf",r.imagePreviews.length),ne(10),Z("dragover",r.isFloorDragOver),ne(10),ye("ngIf",r.showFloorError),ne(1),ye("ngIf",r.floorPreviews.length),ne(10),Z("dragover",r.isDocDragOver),ne(10),ye("ngIf",r.showDocError),ne(1),ye("ngIf",r.documentPreviews.length))},dependencies:[qs,wo,Zh,Pc,Ic],styles:[".form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto;padding:25px}.separator[_ngcontent-%COMP%]{width:100px;height:1px;background-color:#d3d3d3;margin:1rem 0}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.form-row-view[_ngcontent-%COMP%]:not(:first-child){padding-bottom:.5rem;margin-bottom:.5rem;border-top:.0625rem solid lightgray}.form-list-view-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.upload-area[_ngcontent-%COMP%]{position:relative;padding:2.875rem 1.25rem;text-align:center;border-radius:1rem;border:.0625rem dashed #918f90;cursor:pointer}.upload-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;cursor:pointer;opacity:0}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;font-weight:400;line-height:1.2;color:#918f90}.input-text[_ngcontent-%COMP%]{font-weight:400}.text-hint[_ngcontent-%COMP%]{padding:.5rem}.preview-container[_ngcontent-%COMP%]{display:flex;gap:5px;margin-top:10px;flex-wrap:wrap}.preview-item[_ngcontent-%COMP%]{position:relative;width:300px;height:300px}.preview-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:3px;border:1px solid #ccc}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background:rgba(0,0,0,.6);border:none;border-radius:50%;cursor:pointer;width:30px;height:30px;display:flex;align-items:center;justify-content:center;padding:2px}.remove-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:15px;height:15px;fill:#fff}.video-tour[_ngcontent-%COMP%]{margin:20px 0}.add-btn[_ngcontent-%COMP%]{margin:10px 0}.video-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-top:15px;padding:10px;border:1px solid #ddd;border-radius:5px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}input[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}.delete-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer}.delete-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px;fill:red}"]})}}return t})();function Cee(t,n){1&t&&(z(0,"p",15),q(1,"Required"),B())}function See(t,n){1&t&&(z(0,"p",15),q(1,"Required"),B())}let Eee=(()=>{class t{isInvalid(e){const i=this.parentForm.get(e);return!!i&&i.invalid&&(i.dirty||i.touched)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-contacts-tab"]],inputs:{parentForm:"parentForm"},decls:29,vars:3,consts:[[1,"tab-container",3,"formGroup"],[1,"form-body"],[1,"form-row-view"],[1,"form-row-legend"],[1,"title-2"],[1,"desc","text-body-secondary"],[1,"form-row-body"],[1,"form-list-view"],[1,"input"],["for","inputref",1,"input_label"],[1,"input_inner"],["type","email","id","inputref","name","inputref","formControlName","email","placeholder","Enter your email",1,"input_control"],["class","input_hint mt-1","class","error-message",4,"ngIf"],["for","Service",1,"input_label"],["type","number","id","Service","name","inputref","formControlName","phone","placeholder","Enter your phone number",1,"input_control"],[1,"error-message"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),q(5,"email"),B(),z(6,"p",5),q(7," please enter your email address to receive notifications and updates "),B()(),z(8,"div",6)(9,"div",7)(10,"div",8)(11,"label",9),q(12," email "),B(),z(13,"div",10),$e(14,"input",11),B(),He(15,Cee,2,0,"p",12),B()()()(),z(16,"div",2)(17,"div",3)(18,"h2",4),q(19,"Phone Number"),B(),z(20,"p",5),q(21," please enter your phone number to receive notifications and updates "),B()(),z(22,"div",6)(23,"div",8)(24,"label",13),q(25,"Phone Number"),B(),z(26,"div",10),$e(27,"input",14),B(),He(28,See,2,0,"p",12),B()()()()()),2&i&&(ye("formGroup",r.parentForm),ne(15),ye("ngIf",r.isInvalid("email")),ne(13),ye("ngIf",r.isInvalid("phone")))},dependencies:[wo,hl,Qw,Wl,Pc,Ic,wh],styles:['.form-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}.form-row-view[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:2rem;width:min(75rem,100%);margin-inline:auto;border-bottom:#DEDEDE 1px solid;padding-bottom:1rem}.title-2[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:500;line-height:1.2}.desc[_ngcontent-%COMP%]{line-height:1.5}.form-row-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;width:min(45rem,100%)}.input_label[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin:0 0 .25rem;font-weight:500;cursor:pointer;font-size:1rem;line-height:1.5}.input_inner[_ngcontent-%COMP%]{display:flex;align-items:center;height:3rem;padding:0 .05rem;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.input_control[_ngcontent-%COMP%]{outline:none;flex-grow:1;width:100%;height:100%;padding:0 .5rem;font:inherit;color:inherit;background:none;border:none;border-radius:.25rem}.unit[_ngcontent-%COMP%]{color:#918f90;margin-right:.5rem}.input_hint[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#918f90}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.input-button[_ngcontent-%COMP%]{place-self:center}.button[_ngcontent-%COMP%]{width:3rem;height:3rem;margin-bottom:5px;background:#ffffff;border:.0625rem solid #dedede;border-radius:.25rem;transition:.25s}.custom-checkbox[_ngcontent-%COMP%]{position:relative;cursor:pointer;font-size:16px;padding-left:35px;-webkit-user-select:none;user-select:none;color:#333;font-weight:500}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.checkmark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:24px;width:24px;background-color:#fff;border:2px solid #ddd;border-radius:4px}.custom-checkbox[_ngcontent-%COMP%]:hover   input[_ngcontent-%COMP%] ~ .checkmark[_ngcontent-%COMP%]{border-color:#ccc}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]{background-color:#10b981;border-color:#10b981}.checkmark[_ngcontent-%COMP%]:after{content:"";position:absolute;display:none}.custom-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]:after{display:block}.custom-checkbox[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{left:9px;top:5px;width:5px;height:10px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg)}.form-row-view[_ngcontent-%COMP%]:last-child{border-bottom:none}.radio_legend[_ngcontent-%COMP%]{display:block;width:-moz-fit-content;width:fit-content;margin-bottom:.5rem;font-weight:600;font-size:1rem;line-height:1.5;margin-top:.5rem}.form-row-legend[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0;display:grid;gap:.25rem}.radio_input[_ngcontent-%COMP%]{appearance:none;background-color:#fff;border:2px solid #E1E1E1;border-radius:50%;width:20px;height:20px;cursor:pointer;position:relative}.radio_input[_ngcontent-%COMP%]:checked{background-color:#00c775;border-color:#00c775}.radio_input[_ngcontent-%COMP%]:checked:before{content:"";display:block;width:7px;height:7px;background-color:#fff;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.radio_options[_ngcontent-%COMP%]{display:flex}.radio--row[_ngcontent-%COMP%]   .radio_options[_ngcontent-%COMP%]{flex-direction:row}.radio--row[_ngcontent-%COMP%]{flex-grow:1;flex-basis:0}.radio_option[_ngcontent-%COMP%]{display:flex;gap:1rem;width:-moz-fit-content;width:fit-content;cursor:pointer;line-height:1.5;flex-grow:1;flex-basis:0;padding:1.4375rem;border-width:.0625rem;border-right-width:0;border:1px solid #DEDEDE;border-radius:.25rem}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.error-message[_ngcontent-%COMP%]{color:red;font-size:.875rem;line-height:1.43;margin-top:.25rem}']})}}return t})();const Dee=function(t,n){return{active_tab:t,"invalid-tab":n}};function Tee(t,n){if(1&t){const e=Ki();z(0,"div",24),qt("click",function(){const s=An(e).$implicit;return Mn(ht(2).setActiveTab(s.id))}),z(1,"button",25),q(2),B()()}if(2&t){const e=n.$implicit,i=ht(2);let r;Z("active",i.activeTab===e.id),ne(1),ye("ngClass",z_(4,Dee,i.activeTab===e.id,(null==(r=i.propertyForm.get(e.id))?null:r.invalid)&&((null==(r=i.propertyForm.get(e.id))?null:r.dirty)||(null==(r=i.propertyForm.get(e.id))?null:r.touched)))),ne(1),Ft(" ",e.label," ")}}function Aee(t,n){1&t&&$e(0,"app-general-tab",26),2&t&&ye("parentForm",ht(2).generalGroup)}function Pee(t,n){1&t&&$e(0,"app-location-tab",26),2&t&&ye("parentForm",ht(2).locationGroup)}function Iee(t,n){1&t&&$e(0,"app-specification-tab",26),2&t&&ye("parentForm",ht(2).specificationGroup)}const Oee=function(){return{}};function Ree(t,n){if(1&t&&$e(0,"app-amenities-tab",27),2&t){const e=ht(2);ye("parentForm",e.amenitiesGroup)("amenitiesData",(null==e.property?null:e.property.Amenities)||x1(2,Oee))}}function Lee(t,n){if(1&t&&$e(0,"app-price-tab",28),2&t){const e=ht(2);let i;ye("parentForm",e.priceGroup)("dealType",null==(i=e.generalGroup.get("deal_type"))?null:i.value)}}function Fee(t,n){1&t&&$e(0,"app-media-tab",26),2&t&&ye("parentForm",ht(2).mediaGroup)}function zee(t,n){1&t&&$e(0,"app-contacts-tab",26),2&t&&ye("parentForm",ht(2).contactsGroup)}function Nee(t,n){if(1&t){const e=Ki();z(0,"form",18),qt("ngSubmit",function(){return An(e),Mn(ht().onSubmit())}),z(1,"div",19),He(2,Tee,3,7,"div",20),B(),He(3,Aee,1,1,"app-general-tab",21),He(4,Pee,1,1,"app-location-tab",21),He(5,Iee,1,1,"app-specification-tab",21),He(6,Ree,1,3,"app-amenities-tab",22),He(7,Lee,1,2,"app-price-tab",23),He(8,Fee,1,1,"app-media-tab",21),He(9,zee,1,1,"app-contacts-tab",21),B()}if(2&t){const e=ht();ye("formGroup",e.propertyForm),ne(2),ye("ngForOf",e.tabs),ne(1),ye("ngIf","general"===e.activeTab),ne(1),ye("ngIf","location"===e.activeTab),ne(1),ye("ngIf","specification"===e.activeTab),ne(1),ye("ngIf","amenities"===e.activeTab),ne(1),ye("ngIf","price"===e.activeTab),ne(1),ye("ngIf","media"===e.activeTab),ne(1),ye("ngIf","contacts"===e.activeTab)}}let _F=(()=>{class t{constructor(e,i,r,s,c){this.http=e,this.route=i,this.propertyService=r,this.fb=s,this.router=c,this.isSubmitting=!1,this.submitError="",this.isEditMode=!1,this.pageTitle="Create Property",this.tabs=[{id:"general",label:"General"},{id:"location",label:"Location"},{id:"specification",label:"Specification"},{id:"amenities",label:"Amenities"},{id:"price",label:"Price"},{id:"media",label:"Media"},{id:"contacts",label:"Contacts"}],this.activeTab="general"}ngOnInit(){this.propertyForm=this.fb.group({general:this.fb.group({deal_type:["sale",Gi.required],title:["",Gi.required],description:["",Gi.required],PropertyCondition:[null,Gi.required],propertyType:[null,Gi.required]}),location:this.fb.group({latitude:["",Gi.required],longitude:["",Gi.required],country:["",Gi.required],state:["",Gi.required],subcity:["",Gi.required]}),specification:this.fb.group({bedrooms:[null,Gi.required],bathrooms:[null,Gi.required],parkingSpots:[null,Gi.required],size:[],plotSize:[],builtUpArea:[],constructionYear:[],Renovationyear:[],Furnishing:[]}),amenities:this.fb.group({}),price:this.fb.group({price:[null,Gi.required],priceunit:[""],pricesqft:[],originalprice:[],hideprice:[!1],charges:[],servicecharge:[]}),media:this.fb.group({photos:this.fb.array([]),floorPlans:this.fb.array([]),documents:this.fb.array([]),videos:this.fb.array([]),virtualTours:this.fb.array([])}),contacts:this.fb.group({email:["",[Gi.required,Gi.email]],phone:[null,Gi.required]})}),this.setConditionalValidation(),this.route.paramMap.subscribe(e=>{const i=e.get("id");i&&"new"!==i?(this.isEditMode=!0,this.pageTitle="Edit Property",this.propertyId=Number(i),this.propertyService.getPropertyById(this.propertyId).subscribe(r=>{this.property=r,this.propertyForm.patchValue({general:this.property.generalinfo,location:{latitude:this.property.location.latitude,longitude:this.property.location.longitude,country:this.property.location.country,state:this.property.location.city,subcity:this.property.location.subcity},specification:this.property.Specification,price:this.property.price,amenities:this.property.Amenities,contacts:this.property.contacts,media:{photos:this.property.Media.photos,floorPlans:this.property.Media.floorPlans,documents:this.property.Media.documents,videos:[],virtualTours:[]}})},r=>{console.error("Error loading property:",r),this.submitError="Failed to load property data"})):(this.isEditMode=!1,this.pageTitle="Create Property")})}get generalGroup(){return this.propertyForm.get("general")}get locationGroup(){return this.propertyForm.get("location")}get specificationGroup(){return this.propertyForm.get("specification")}get amenitiesGroup(){return this.propertyForm.get("amenities")}get priceGroup(){return this.propertyForm.get("price")}get mediaGroup(){return this.propertyForm.get("media")}get contactsGroup(){return this.propertyForm.get("contacts")}setActiveTab(e){this.activeTab=e}onSubmit(){if(this.propertyForm.valid){this.isSubmitting=!0,this.submitError="";const e=new FormData,i={...this.propertyForm.value};delete i.media,e.append("data",JSON.stringify(i)),this.isEditMode&&e.append("_method","PUT");const r=this.propertyForm.get("media"),s=r.get("photos");s&&s.length>0&&s.controls.forEach((k,E)=>{k.value&&k.value.file&&e.append(`photos[${E}]`,k.value.file)});const c=r.get("floorPlans");c&&c.length>0&&c.controls.forEach((k,E)=>{k.value&&k.value.file&&e.append(`floorPlans[${E}]`,k.value.file)});const f=r.get("documents");let y;f&&f.length>0&&f.controls.forEach((k,E)=>{k.value&&k.value.file&&e.append(`documents[${E}]`,k.value.file)}),y=this.http.post(this.isEditMode?`http://backend.ddev.site/api/properties/${this.propertyId}`:"http://backend.ddev.site/api/properties",e),y.subscribe(k=>{this.isSubmitting=!1,console.log(`Property ${this.isEditMode?"updated":"created"} successfully`,k),X_().fire({icon:"success",title:`Property ${this.isEditMode?"Updated":"Created"}!`,text:"The property has been saved successfully.",confirmButtonText:"Go to My Properties",timer:2500,timerProgressBar:!0}).then(()=>{this.router.navigate(["/owner/properties"])})},k=>{this.isSubmitting=!1,this.submitError=`There was an error ${this.isEditMode?"updating":"creating"} the property. Please try again.`,console.error(`Error ${this.isEditMode?"updating":"creating"} property`,k)})}else this.markFormGroupAsTouched(this.propertyForm),console.log("Form is invalid:",this.propertyForm.errors)}markFormGroupAsTouched(e){Object.values(e.controls).forEach(i=>{i.markAsTouched(),i instanceof x2&&this.markFormGroupAsTouched(i)})}isInvalid(e,i){const r=e.get(i);return!!r&&r.invalid&&(r.dirty||r.touched)}setConditionalValidation(){const e=this.generalGroup;e.get("deal_type")?.valueChanges.subscribe(r=>{const s=e.get("availabilityDate"),c=e.get("frequency"),f=e.get("cheques");"rent"===r?(s?.setValidators([Gi.required]),c?.setValidators([Gi.required]),f?.setValidators([Gi.required])):(s?.clearValidators(),c?.clearValidators(),f?.clearValidators()),s?.updateValueAndValidity(),c?.updateValueAndValidity(),f?.updateValueAndValidity()})}onCancel(){this.router.navigate(["/owner"])}static{this.\u0275fac=function(i){return new(i||t)(st(Ff),st(Rf),st(ac),st(Ep),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-edit-property"]],decls:24,vars:4,consts:[[1,"property-edit"],[1,"top_body"],[1,"header"],[1,"header","m-2","d-flex"],[1,"breadcrumbs","d-flex","gap-3","align-items-center"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider","url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E\")"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","/properties"],["aria-current","page",1,"breadcrumb-item","active"],[1,"header_title","d-flex","justify-content-between","m-3","mb-4","align-items-center"],[1,""],[1,"header_end"],[1,"header_end_btn"],["type","reset",1,"btn","btn_cancel"],[1,"text-decoration-underline",3,"click"],[1,"btn","btn_save",3,"click"],["class","property-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"property-form",3,"formGroup","ngSubmit"],[1,"form_tab_view","d-flex","gap-3","mt-4","overflow-auto"],["class","form_tab",3,"active","click",4,"ngFor","ngForOf"],[3,"parentForm",4,"ngIf"],[3,"parentForm","amenitiesData",4,"ngIf"],[3,"parentForm","dealType",4,"ngIf"],[1,"form_tab",3,"click"],["type","button",1,"btn","btn_tab",3,"ngClass"],[3,"parentForm"],[3,"parentForm","amenitiesData"],[3,"parentForm","dealType"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"div",4)(5,"nav",5)(6,"ol",6)(7,"li",7)(8,"a",8),q(9,"Properties"),B()(),z(10,"li",9),q(11),B()()()()(),z(12,"div",10)(13,"h1",11),q(14),B(),z(15,"div",12)(16,"div",13)(17,"button",14)(18,"span",15),qt("click",function(){return r.onCancel()}),q(19,"Cancel"),B()(),z(20,"button",16),qt("click",function(){return r.onSubmit()}),z(21,"span"),q(22),B()()()()(),He(23,Nee,10,9,"form",17),B()()()),2&i&&(ne(11),Qe(r.isEditMode?"Property edit":"Property create"),ne(3),Qe(r.pageTitle),ne(8),Qe(r.isSubmitting?r.isEditMode?"Updating...":"Creating...":r.isEditMode?"Update Property":"Create Property"),ne(1),ye("ngIf",r.propertyForm))},dependencies:[ha,qs,wo,Zh,Pc,Ic,RJ,GJ,JJ,see,hee,Mee,Eee],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap";.breadcrumb[_ngcontent-%COMP%]{--bs-breadcrumb-divider: "\\203a"}.btn_save[_ngcontent-%COMP%]{background-color:#69b99d;color:#fff;border:none;cursor:pointer;width:6rem;font-family:poppins,sans-serif;font-weight:500}.btn_cancel[_ngcontent-%COMP%]{background-color:none;border:none}.btn_tab[_ngcontent-%COMP%]{border:none;outline:none;cursor:pointer;position:relative;padding-top:0;padding:0 1.5rem 1rem;font-family:poppins,sans-serif;font-weight:500;font-size:1.1rem;color:#000}.btn_tab.active_tab[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;bottom:0;left:0;width:100%;height:.12rem;background-color:#000}.form_tab_view[_ngcontent-%COMP%]{border-bottom:#DEDEDE 1px solid}.header_title[_ngcontent-%COMP%]{font-family:poppins,sans-serif;font-weight:600}li[_ngcontent-%COMP%]{padding:12px 1px;color:#666;cursor:pointer;font-weight:500;position:relative}.invalid-tab[_ngcontent-%COMP%]{border:2px solid red!important}.property-edit[_ngcontent-%COMP%]{overflow:auto;height:100vh}']})}}return t})();function Bee(t,n){1&t&&(z(0,"div"),q(1,"Password is required"),B())}function Vee(t,n){1&t&&(z(0,"div"),q(1,"Password must be at least 6 characters"),B())}function jee(t,n){if(1&t&&(z(0,"div",14),He(1,Bee,2,0,"div",15),He(2,Vee,2,0,"div",15),B()),2&t){const e=ht();ne(1),ye("ngIf",e.f.password.errors.required),ne(1),ye("ngIf",e.f.password.errors.minlength)}}function Hee(t,n){1&t&&(z(0,"div"),q(1,"Confirm Password is required"),B())}function Uee(t,n){1&t&&(z(0,"div"),q(1,"Passwords must match"),B())}function qee(t,n){if(1&t&&(z(0,"div",14),He(1,Hee,2,0,"div",15),He(2,Uee,2,0,"div",15),B()),2&t){const e=ht();ne(1),ye("ngIf",e.f.confirmPassword.errors.required),ne(1),ye("ngIf",e.f.confirmPassword.errors.mustMatch)}}function $ee(t,n){1&t&&$e(0,"span",16)}function Gee(t,n){if(1&t&&(z(0,"div",17),q(1),B()),2&t){const e=ht();ne(1),Qe(e.error)}}function Wee(t,n){if(1&t&&(z(0,"div",18),q(1),B()),2&t){const e=ht();ne(1),Qe(e.success)}}const yF=function(t){return{"is-invalid":t}};let Zee=(()=>{class t{constructor(e,i,r,s){this.formBuilder=e,this.authService=i,this.route=r,this.router=s,this.loading=!1,this.submitted=!1,this.error="",this.success="",this.token=""}ngOnInit(){this.token=this.route.snapshot.queryParams.token||"",this.token?this.resetPasswordForm=this.formBuilder.group({password:["",[Gi.required,Gi.minLength(6)]],confirmPassword:["",Gi.required]},{validator:this.mustMatch("password","confirmPassword")}):this.router.navigate(["/forgot-password"])}mustMatch(e,i){return r=>{const c=r.controls[i];c.errors&&!c.errors.mustMatch||c.setErrors(r.controls[e].value!==c.value?{mustMatch:!0}:null)}}get f(){return this.resetPasswordForm.controls}onSubmit(){this.submitted=!0,!this.resetPasswordForm.invalid&&(this.loading=!0,this.authService.resetPassword(this.token,this.f.password.value).subscribe({next:e=>{this.success=e.message,this.loading=!1,setTimeout(()=>{this.router.navigate(["/login"])},1500)},error:e=>{this.error=e.error?.message||"Password reset failed",this.loading=!1}}))}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(Km),st(Rf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-reset-password"]],decls:23,vars:13,consts:[[1,"reset-password-container"],[1,"card"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","password"],["type","password","id","password","formControlName","password",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","confirmPassword"],["type","password","id","confirmPassword","formControlName","confirmPassword",1,"form-control",3,"ngClass"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/login",1,"btn","btn-link"],["class","alert alert-danger mt-3",4,"ngIf"],["class","alert alert-success mt-3",4,"ngIf"],[1,"invalid-feedback"],[4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"alert","alert-danger","mt-3"],[1,"alert","alert-success","mt-3"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"h2"),q(3,"Reset Password"),B(),z(4,"form",2),qt("ngSubmit",function(){return r.onSubmit()}),z(5,"div",3)(6,"label",4),q(7,"New Password"),B(),$e(8,"input",5),He(9,jee,3,2,"div",6),B(),z(10,"div",3)(11,"label",7),q(12,"Confirm Password"),B(),$e(13,"input",8),He(14,qee,3,2,"div",6),B(),z(15,"div",3)(16,"button",9),He(17,$ee,1,0,"span",10),q(18," Reset Password "),B(),z(19,"a",11),q(20,"Back to Login"),B()(),He(21,Gee,2,1,"div",12),He(22,Wee,2,1,"div",13),B()()()),2&i&&(ne(4),ye("formGroup",r.resetPasswordForm),ne(4),ye("ngClass",Gr(9,yF,r.submitted&&r.f.password.errors)),ne(1),ye("ngIf",r.submitted&&r.f.password.errors),ne(4),ye("ngClass",Gr(11,yF,r.submitted&&r.f.confirmPassword.errors)),ne(1),ye("ngIf",r.submitted&&r.f.confirmPassword.errors),ne(2),ye("disabled",r.loading),ne(1),ye("ngIf",r.loading),ne(4),ye("ngIf",r.error),ne(1),ye("ngIf",r.success))},dependencies:[ha,wo,od,Zh,hl,Wl,Pc,Ic,wh]})}}return t})(),Yee=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-footer"]],decls:57,vars:0,consts:[[1,"footer"],[1,"footer-container"],[1,"brand-section"],[1,"logo"],[1,"logo-circle"],[1,"brand-name"],[1,"tagline"],[1,"newsletter"],[1,"newsletter-form"],["type","email","placeholder","Enter your email",1,"newsletter-input"],["type","submit",1,"newsletter-button"],[1,"links-section"],[1,"links-column"],["href","#"],[1,"social-icons"],["href","#",1,"social-icon"]],template:function(i,r){1&i&&(z(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),q(5,"E"),B(),z(6,"div",5),q(7,"EZrent"),B()(),z(8,"p",6),q(9,"We have built our reputation as true local area experts."),B(),z(10,"div",7)(11,"h3"),q(12,"Newsletter"),B(),z(13,"form",8),$e(14,"input",9),z(15,"button",10),q(16,"Send"),B()()()(),z(17,"div",11)(18,"div",12)(19,"h3"),q(20,"Service"),B(),z(21,"ul")(22,"li")(23,"a",13),q(24,"About us"),B()(),z(25,"li")(26,"a",13),q(27,"Careers"),B()(),z(28,"li")(29,"a",13),q(30,"Terms & Conditions"),B()(),z(31,"li")(32,"a",13),q(33,"Privacy & Policy"),B()()()(),z(34,"div",12)(35,"h3"),q(36,"Community"),B(),z(37,"ul")(38,"li")(39,"a",13),q(40,"Find agents"),B()(),z(41,"li")(42,"a",13),q(43,"Lifestyle"),B()(),z(44,"li")(45,"a",13),q(46,"Legal notice"),B()()()(),z(47,"div",12)(48,"h3"),q(49,"Follow us on"),B(),z(50,"div",14)(51,"a",15),q(52,"in"),B(),z(53,"a",15),q(54,"tw"),B(),z(55,"a",15),q(56,"f"),B()()()()()())},dependencies:[Zh,Pc,Xw],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Arial,sans-serif;background-color:#f5f5f5}.footer[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:60px;color:#333;margin:0 auto;width:100%}.footer-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;flex-wrap:wrap;padding:0 20px}.brand-section[_ngcontent-%COMP%]{flex:1;min-width:200px;margin-right:40px}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px}.logo-circle[_ngcontent-%COMP%]{width:30px;height:30px;background-color:#2a9d8f;border-radius:50%;display:flex;justify-content:center;align-items:center;color:#fff;font-weight:700;margin-right:5px}.brand-name[_ngcontent-%COMP%]{font-size:18px;font-weight:700}.tagline[_ngcontent-%COMP%]{font-size:14px;line-height:1.4;margin-bottom:20px}.newsletter[_ngcontent-%COMP%]{margin-top:20px}.newsletter[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;margin-bottom:10px}.newsletter-form[_ngcontent-%COMP%]{display:flex}.newsletter-input[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:1px solid #ddd;border-radius:4px 0 0 4px;font-size:14px}.newsletter-button[_ngcontent-%COMP%]{background-color:#2a9d8f;color:#fff;border:none;padding:8px 20px;border-radius:0 4px 4px 0;cursor:pointer;font-size:14px}.links-section[_ngcontent-%COMP%]{display:flex;flex:2;justify-content:space-around}.links-column[_ngcontent-%COMP%]{min-width:120px}.links-column[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;margin-bottom:15px}.links-column[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.links-column[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.links-column[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#333;text-decoration:none;font-size:14px}.social-icons[_ngcontent-%COMP%]{display:flex;gap:10px}.social-icon[_ngcontent-%COMP%]{width:30px;height:30px;background-color:#f1f1f1;border-radius:4px;display:flex;justify-content:center;align-items:center}@media (max-width: 768px){.footer-container[_ngcontent-%COMP%]{flex-direction:column}.brand-section[_ngcontent-%COMP%]{margin-right:0;margin-bottom:30px}.links-section[_ngcontent-%COMP%]{flex-wrap:wrap}.links-column[_ngcontent-%COMP%]{min-width:40%;margin-bottom:20px}}"]})}}return t})(),zf=(()=>{class t{getCurrentUserId(){throw new Error("Method not implemented.")}constructor(e){this.http=e,this.apiUrl="https://backend.ddev.site/api"}getUserProfile(){return this.http.get(`${this.apiUrl}/user`)}getImageUrl(e){return e?e.startsWith("http")?e:`https://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"assets/default-avatar.png"}updateUserProfileWithImage(e){return this.http.post(`${this.apiUrl}/user`,e)}changePassword(e){return this.http.post(`${this.apiUrl}/user/update-password`,e)}updateProfileImage(e){const i=new FormData;return i.append("profileImage",e),this.http.post(`${this.apiUrl}/user`,i)}removeProfileImage(){return this.http.delete(`${this.apiUrl}/user/remove-profile-picture`)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Ff))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Xee=(()=>{class t{constructor(e){this.elementRef=e,this.clickOutside=new Xi}onClick(e){this.elementRef.nativeElement.contains(e)||this.clickOutside.emit()}static{this.\u0275fac=function(i){return new(i||t)(st(ns))}}static{this.\u0275dir=gi({type:t,selectors:[["","clickOutside",""]],hostBindings:function(i,r){1&i&&qt("click",function(c){return r.onClick(c.target)},0,o_)},outputs:{clickOutside:"clickOutside"}})}}return t})();class Kee extends En{constructor(n,e){super()}schedule(n,e=0){return this}}const H4={setInterval(t,n,...e){const{delegate:i}=H4;return i?.setInterval?i.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){const{delegate:n}=H4;return(n?.clearInterval||clearInterval)(t)},delegate:void 0};class mA extends Kee{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var i;if(this.closed)return this;this.state=n;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(n,e,i=0){return H4.setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&H4.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let r,i=!1;try{this.work(n)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}}const vF={now:()=>(vF.delegate||Date).now(),delegate:void 0};class _k{constructor(n,e=_k.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,i){return new this.schedulerActionCtor(this,n).schedule(i,e)}}_k.now=vF.now;class gA extends _k{constructor(n,e=_k.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let i;this._active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,i){for(;n=e.shift();)n.unsubscribe();throw i}}}const U4=new gA(mA),Qee=U4;function bF(t=0,n,e=Qee){let i=-1;return null!=n&&(qo(n)?e=n:i=n),new Jn(r=>{let s=function Jee(t){return t instanceof Date&&!isNaN(t)}(t)?+t-e.now():t;s<0&&(s=0);let c=0;return e.schedule(function(){r.closed||(r.next(c++),0<=i?this.schedule(void 0,i):r.complete())},s)})}let tte=(()=>{class t{constructor(e){this.http=e,this.apiUrl="https://backend.ddev.site/api/booking"}getAllNotifications(){return this.http.get(`${this.apiUrl}/notifications`)}getNewOwnerNotifications(){return this.http.get(`${this.apiUrl}/owner/new-booking-notifications`)}markAsRead(e){return this.http.post(`${this.apiUrl}/notifications/${e}/read`,{})}static{this.\u0275fac=function(i){return new(i||t)(Dt(Ff))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function nte(t,n){if(1&t&&(z(0,"span",4),q(1),B()),2&t){const e=ht();ne(1),Qe(e.notifications.length)}}function ite(t,n){if(1&t){const e=Ki();z(0,"div",9),qt("click",function(){const s=An(e).$implicit;return Mn(ht(3).markNotificationAsRead(s))}),q(1),B()}if(2&t){const e=n.$implicit;Z("unread",!e.isRead),ne(1),Ft(" ",e.message," ")}}function rte(t,n){if(1&t&&(z(0,"div"),He(1,ite,2,3,"div",8),B()),2&t){const e=ht(2);ne(1),ye("ngForOf",e.notifications)}}function ote(t,n){1&t&&(z(0,"div",10),q(1,"No new notifications"),B())}function ste(t,n){if(1&t&&(z(0,"div",5),He(1,rte,2,1,"div",6),He(2,ote,2,0,"ng-template",null,7,Tf),B()),2&t){const e=Fa(3),i=ht();ne(1),ye("ngIf",i.notifications.length>0)("ngIfElse",e)}}let ate=(()=>{class t{constructor(e){this.notificationService=e,this.notifications=[],this.dropdownOpen=!1,this.unreadCount=0}ngOnInit(){this.loadNotifications(),this.refreshSub=function ete(t=0,n=U4){return t<0&&(t=0),bF(t,t,n)}(1e4).subscribe(()=>this.loadNotifications())}loadNotifications(){this.notificationService.getNewOwnerNotifications().subscribe(e=>{this.notifications=e,this.unreadCount=e.filter(i=>!i.isRead).length})}toggleDropdown(){this.dropdownOpen=!this.dropdownOpen,console.log("Dropdown toggled:",this.dropdownOpen)}markNotificationAsRead(e){this.notificationService.markAsRead(e.id).subscribe(()=>{e.isRead=!0,this.unreadCount--})}static{this.\u0275fac=function(i){return new(i||t)(st(tte))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-notification-bell"]],decls:5,vars:2,consts:[[1,"notification-bell-wrapper"],[1,"notification-bell",3,"click"],["class","badge",4,"ngIf"],["class","dropdown-menu",4,"ngIf"],[1,"badge"],[1,"dropdown-menu"],[4,"ngIf","ngIfElse"],["noNotif",""],["class","notif-item",3,"unread","click",4,"ngFor","ngForOf"],[1,"notif-item",3,"click"],[1,"no-notif"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1),qt("click",function(){return r.toggleDropdown()}),q(2," \u{1f514} "),He(3,nte,2,1,"span",2),He(4,ste,4,2,"div",3),B()()),2&i&&(ne(3),ye("ngIf",r.notifications.length>0),ne(1),ye("ngIf",r.dropdownOpen))},dependencies:[qs,wo],styles:[".notification-bell-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.notification-bell[_ngcontent-%COMP%]{cursor:pointer;font-size:22px;color:#484848;position:relative;-webkit-user-select:none;user-select:none;transition:color .2s ease}.notification-bell[_ngcontent-%COMP%]:hover{color:#ff385c}.badge[_ngcontent-%COMP%]{position:absolute;top:-6px;right:-8px;background-color:#ff385c;color:#fff;font-size:11px;font-weight:600;padding:2px 6px;border-radius:9999px;box-shadow:0 0 3px #ff385c80;pointer-events:none}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;display:block;top:36px;right:0;width:280px;background-color:#fff;border-radius:12px;box-shadow:0 10px 15px #0000001a;padding:12px 0;z-index:10000;font-size:14px;color:#484848;-webkit-user-select:none;user-select:none}.notif-item[_ngcontent-%COMP%]{padding:12px 20px;cursor:pointer;transition:background-color .15s ease;border-left:4px solid transparent;display:flex;align-items:center;gap:12px}.notif-item.unread[_ngcontent-%COMP%]{font-weight:600;background-color:#f0f0f0;border-left-color:#ff385c}.notif-item[_ngcontent-%COMP%]:hover{background-color:#f7f7f7}.no-notif[_ngcontent-%COMP%]{padding:20px;text-align:center;color:#999;font-style:italic}"]})}}return t})();function lte(t,n){1&t&&(z(0,"div",9)(1,"a",10),q(2,"Sign in"),B(),z(3,"button",11),q(4,"Login"),B()())}function cte(t,n){1&t&&(z(0,"a",34),Ao(),z(1,"svg",35),$e(2,"path",36)(3,"path",37),B(),Ns(),z(4,"span"),q(5,"Owner Dashboard"),B()())}function dte(t,n){1&t&&(z(0,"a",38),Ao(),z(1,"svg",35),$e(2,"path",36)(3,"path",37),B(),Ns(),z(4,"span"),q(5,"Admin Dashboard"),B()())}function hte(t,n){if(1&t){const e=Ki();z(0,"div",12),qt("clickOutside",function(){return An(e),Mn(ht().showDropdown=!1)}),z(1,"div",13),$e(2,"img",14),z(3,"span",15),q(4),B(),z(5,"div",16),Ao(),z(6,"svg",17),$e(7,"path",18),B()(),Ns(),$e(8,"app-notification-bell",19),z(9,"div",20),qt("click",function(){return An(e),Mn(ht().toggleDropdown())}),$e(10,"span",21)(11,"span",21)(12,"span",21),B()(),z(13,"div",22)(14,"a",23),$e(15,"i",24),z(16,"span"),q(17,"View profile"),B()(),z(18,"a",25),$e(19,"i",26),z(20,"span"),q(21,"Account settings"),B()(),z(22,"a",27),Ao(),z(23,"svg",28),$e(24,"path",29),B(),Ns(),z(25,"span"),q(26,"My Appointment"),B()(),He(27,cte,6,0,"a",30),He(28,dte,6,0,"a",31),z(29,"a",32),qt("click",function(){return An(e),Mn(ht().logout())}),$e(30,"i",33),z(31,"span"),q(32,"Log out"),B()()()()}if(2&t){const e=ht();ne(2),ye("src",e.getImageUrl((null==e.user?null:e.user.profileImage)||""),fs),ne(2),Yt("",(null==e.user?null:e.user.name)||"User"," ",null==e.user?null:e.user.lastName,""),ne(9),Z("show",e.showDropdown),ne(14),ye("ngIf",(null==e.user||null==e.user.roles?null:e.user.roles.includes("ROLE_OWNER"))||(null==e.user||null==e.user.roles?null:e.user.roles.includes("ROLE_ADMIN"))),ne(1),ye("ngIf",null==e.user||null==e.user.roles?null:e.user.roles.includes("ROLE_ADMIN"))}}const ute=function(){return["/home"]},pte=function(){return["/property-list"]},fte=function(){return["/about-us"]},mte=function(){return["/service"]},gte=function(){return["/contact"]};let z2=(()=>{class t{constructor(e,i){this.authService=e,this.userService=i,this.isLoggedIn=!1,this.currentUser=null,this.showDropdown=!1,this.showMobileMenu=!1,this.roles=[]}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}ngOnInit(){this.authService.currentUser$.subscribe(e=>{this.currentUser=e,this.isLoggedIn=this.authService.isLoggedIn(),console.log(this.currentUser)}),this.userService.getUserProfile().subscribe(e=>{this.user=e}),console.log(this.currentUser)}logout(){this.authService.logout()}toggleDropdown(){this.showDropdown=!this.showDropdown}toggleMobileMenu(){this.showMobileMenu=!this.showMobileMenu;const e=document.querySelector(".nav-links");e&&(this.showMobileMenu?e.classList.add("active"):e.classList.remove("active"))}onDocumentClick(e){const i=document.querySelector(".user-profile");i&&!i.contains(e.target)&&this.showDropdown&&(this.showDropdown=!1)}static{this.\u0275fac=function(i){return new(i||t)(st(Km),st(zf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-header"]],decls:26,vars:12,consts:[[1,"navbar-container"],[1,"navbar"],["routerLink","/home",1,"logo"],[1,"logo-circle"],[1,"logo-text"],[1,"nav-links"],["routerLinkActive","active",3,"routerLink"],["class","auth-buttons",4,"ngIf"],["class","user-profile","clickOutside","",3,"clickOutside",4,"ngIf"],[1,"auth-buttons"],["routerLink","/register",1,"sign-in"],["type","button","routerLink","/login",1,"login-btn"],["clickOutside","",1,"user-profile",3,"clickOutside"],[1,"profile-container"],[1,"avatar",3,"src"],[1,"username"],["routerLink","/user/messages","routerLinkActive","active",1,"notification","p-1"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","dark:text-white"],["stroke","currentColor","stroke-linecap","round","stroke-width","2","d","m3.5 5.5 7.893 6.036a1 1 0 0 0 1.214 0L20.5 5.5M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"],[1,"notification-bell"],[1,"menu-dots",3,"click"],[1,"dot"],[1,"dropdown-menu"],["routerLink","/user/profile",1,"dropdown-item"],[1,"profile-icon"],["routerLink","/user/settings",1,"dropdown-item"],[1,"settings-icon"],["routerLink","/user/my-appointments",1,"dropdown-item"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-calendar-check-fill"],["d","M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2m-5.146-5.146-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708"],["ng","","routerLink","/owner","class","dropdown-item",4,"ngIf"],["ng","","routerLink","/admin","class","dropdown-item",4,"ngIf"],[1,"dropdown-item",3,"click"],[1,"logout-icon"],["ng","","routerLink","/owner",1,"dropdown-item"],["_ngcontent-ng-c392972002","","xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","id","dashboard"],["_ngcontent-ng-c392972002","","fill","none","d","M0 0h24v24H0V0z"],["_ngcontent-ng-c392972002","","d","M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"],["ng","","routerLink","/admin",1,"dropdown-item"]],template:function(i,r){1&i&&(z(0,"section",0)(1,"body")(2,"nav",1)(3,"a",2)(4,"div",3),q(5,"E"),B(),z(6,"div",4),q(7,"Easy Rent"),B()(),z(8,"ul",5)(9,"li")(10,"a",6),q(11,"Home"),B()(),z(12,"li")(13,"a",6),q(14,"Property"),B()(),z(15,"li")(16,"a",6),q(17,"About"),B()(),z(18,"li")(19,"a",6),q(20,"Service"),B()(),z(21,"li")(22,"a",6),q(23,"Contact"),B()()(),He(24,lte,5,0,"div",7),He(25,hte,33,7,"div",8),B()()()),2&i&&(ne(10),ye("routerLink",x1(7,ute)),ne(3),ye("routerLink",x1(8,pte)),ne(3),ye("routerLink",x1(9,fte)),ne(3),ye("routerLink",x1(10,mte)),ne(3),ye("routerLink",x1(11,gte)),ne(2),ye("ngIf",!r.isLoggedIn),ne(1),ye("ngIf",r.isLoggedIn))},dependencies:[wo,od,R2,Xee,ate],styles:['*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;font-family:poppins,sans-serif}body[_ngcontent-%COMP%]{background-color:#f5f5f5}.navbar-container[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;height:5rem;background-color:#fff;z-index:1000}.navbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 10%;background-color:transparent}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;text-decoration:none}.logo-circle[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;background-color:#4db299;display:flex;justify-content:center;align-items:center;color:#fff;font-weight:700;font-size:1.125rem;margin-right:.625rem}.logo-text[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:500;color:#4db299}.nav-links[_ngcontent-%COMP%]{display:flex;align-items:center;list-style:none}.nav-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0 1.25rem}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#777;font-size:1rem;transition:color .3s}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#4db299}.nav-links[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#4db299;position:relative}.nav-links[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-.625rem;left:50%;transform:translate(-50%);width:.375rem;height:.375rem;background-color:#4db299;border-radius:50%}.auth-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.sign-in[_ngcontent-%COMP%]{color:#4db299;margin-right:1.25rem;text-decoration:none;font-size:1rem}.login-btn[_ngcontent-%COMP%]{background-color:#4db299;color:#fff;border:none;padding:.75rem 1.875rem;border-radius:.3125rem;cursor:pointer;font-size:1rem;transition:background-color .3s}.login-btn[_ngcontent-%COMP%]:hover{background-color:#3b9a84}.user-profile[_ngcontent-%COMP%]{position:relative}.profile-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;cursor:pointer}.avatar[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;object-fit:cover}.username[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#333}.menu-dots[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:.2rem;width:1.5rem;height:1.5rem;cursor:pointer;margin-left:.5rem}.dot[_ngcontent-%COMP%]{width:.25rem;height:.25rem;background-color:#555;border-radius:50%}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:3.5rem;right:0;width:14rem;background-color:#fff;border-radius:.5rem;box-shadow:0 .25rem 1rem #0000001a;z-index:1010;display:none;overflow:hidden}.dropdown-menu.show[_ngcontent-%COMP%]{display:block}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;text-decoration:none;color:#333;font-size:.9rem;transition:background-color .2s;position:relative}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;cursor:pointer}.dropdown-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem;display:flex;align-items:center;justify-content:center}.profile-icon[_ngcontent-%COMP%]:before{content:"\\f007";font-family:"Font Awesome 5 Free";font-weight:900}.settings-icon[_ngcontent-%COMP%]:before{content:"\\f013";font-family:"Font Awesome 5 Free";font-weight:900}.keyboard-icon[_ngcontent-%COMP%]:before{content:"\\f11c";font-family:"Font Awesome 5 Free";font-weight:900}.logout-icon[_ngcontent-%COMP%]:before{content:"\\f2f5";font-family:"Font Awesome 5 Free";font-weight:900}.version[_ngcontent-%COMP%]{position:absolute;right:1rem;color:#999;font-size:.8rem}.mobile-menu-btn[_ngcontent-%COMP%]{display:none;flex-direction:column;justify-content:space-between;width:2rem;height:1.5rem;cursor:pointer}.mobile-menu-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:.1875rem;width:100%;background-color:#4db299;border-radius:.3125rem}@media screen and (max-width: 1024px){.navbar[_ngcontent-%COMP%]{padding:1.25rem 5%}.nav-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0 .9375rem}}@media screen and (max-width: 768px){.mobile-menu-btn[_ngcontent-%COMP%]{display:flex;z-index:1010}.nav-links[_ngcontent-%COMP%]{position:fixed;top:0;right:-100%;height:100vh;width:70%;max-width:300px;background-color:#fff;flex-direction:column;justify-content:center;align-items:center;padding:3.125rem 0;transition:right .3s ease;box-shadow:-.3125rem 0 1.25rem #0000001a}.nav-links.active[_ngcontent-%COMP%]{right:0}.nav-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:1.25rem 0}.nav-links[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]:after{bottom:-.5rem}.auth-buttons[_ngcontent-%COMP%]{margin-top:1.875rem;flex-direction:column}.sign-in[_ngcontent-%COMP%]{margin-right:0;margin-bottom:1.25rem}.user-profile[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{display:none}}@media screen and (max-width: 480px){.navbar-container[_ngcontent-%COMP%]{height:4.375rem}.navbar[_ngcontent-%COMP%]{padding:1rem 5%}.logo-circle[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:1rem}.logo-text[_ngcontent-%COMP%]{font-size:1.25rem}}']})}}return t})();const _te=function(t){return["/property",t]};function yte(t,n){if(1&t&&(z(0,"div",75),$e(1,"img",76),z(2,"div",77)(3,"h3",78),q(4),B(),z(5,"p",79),q(6),B(),z(7,"div",80)(8,"p",81),q(9),ks(10,"currency"),B(),z(11,"p",82)(12,"span"),q(13),B(),q(14," Living Area "),B()(),z(15,"a",83),q(16,"Send Inquiry"),B()()()),2&t){const e=n.$implicit;ne(1),ye("src","http://backend.ddev.site"+(null==e.Media.photos[0]?null:e.Media.photos[0].imageName),fs)("alt",e.generalinfo.title),ne(3),Qe(e.generalinfo.title),ne(2),Yt("",null==e.location?null:e.location.city,", ",null==e.location?null:e.location.subcity,""),ne(3),Ft("",Xd(10,8,e.price.price,"TND")," "),ne(4),Ft("",e.Specification.size,"m\xb2"),ne(2),ye("routerLink",Gr(11,_te,e.id))}}function vte(t,n){if(1&t&&(z(0,"div",73),He(1,yte,17,13,"div",74),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.properties)}}let bte=(()=>{class t{constructor(e){this.propertyService=e,this.properties=[]}ngOnInit(){this.propertyService.getAllProperties().subscribe(e=>{this.properties=e.slice(0,3)})}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-home"]],decls:179,vars:1,consts:[[1,"hero"],[1,"hero-content"],[1,"category-label"],[1,"hero-title"],[1,"hero-description"],[1,"hero-image"],["src","/assets/property.png","alt","Modern wooden and brick home"],[1,"recommendations"],[1,"recommendation-container"],[1,"section-header"],[1,"title-description"],[1,"tag"],[1,"section-title"],[1,"section-description"],["routerLink","/property-list",1,"learn-more"],[1,"icon"],["class","properties-grid",4,"ngIf"],[1,"features"],[1,"features-container"],[1,"featured-cards"],[1,"card"],["xmlns","http://www.w3.org/2000/svg","width","46","height","44","viewBox","0 0 46 44","fill","none"],["fill-rule","evenodd","clip-rule","evenodd","d","M31.6616 0.62658C33.0813 0.62658 34.4988 0.82683 35.8466 1.27908C44.1513 3.97908 47.1438 13.0916 44.6441 21.0566C43.2266 25.1268 40.9091 28.8416 37.8738 31.8768C33.5291 36.0843 28.7613 39.8194 23.6291 43.0368L23.0666 43.3766L22.4816 43.0144C17.3313 39.8194 12.5366 36.0844 8.15131 31.8543C5.13631 28.8191 2.81656 25.1268 1.37656 21.0566C-1.16594 13.0916 1.82656 3.97908 10.2213 1.23183C10.8738 1.00683 11.5466 0.84933 12.2216 0.76158H12.4916C13.1238 0.66933 13.7516 0.62658 14.3816 0.62658H14.6291C16.0466 0.66933 17.4191 0.91683 18.7488 1.36908H18.8816C18.9716 1.41183 19.0391 1.45908 19.0841 1.50183C19.5813 1.66158 20.0516 1.84158 20.5016 2.08908L21.3566 2.47158C21.5632 2.58177 21.795 2.75013 21.9955 2.89564C22.1224 2.98783 22.2368 3.07085 22.3241 3.12408C22.3608 3.14574 22.3981 3.16753 22.4357 3.18949C22.6286 3.30211 22.8296 3.41942 22.9991 3.54933C25.4988 1.63908 28.5341 0.60408 31.6616 0.62658ZM37.6466 16.8266C38.5691 16.8018 39.3566 16.0616 39.4241 15.1143V14.8466C39.4916 11.6943 37.5813 8.83908 34.6766 7.73659C33.7541 7.41933 32.7416 7.91658 32.4041 8.86158C32.0891 9.80658 32.5841 10.8416 33.5291 11.1768C34.9713 11.7168 35.9366 13.1366 35.9366 14.7093V14.7791C35.8938 15.2943 36.0491 15.7916 36.3641 16.1741C36.6791 16.5566 37.1516 16.7793 37.6466 16.8266Z","fill","#69B99D"],[1,"card-title"],[1,"card-description"],["xmlns","http://www.w3.org/2000/svg","width","40","height","46","viewBox","0 0 40 46","fill","none"],["fill-rule","evenodd","clip-rule","evenodd","d","M19.3882 45.3057C19.6374 45.4359 19.916 45.5021 20.1946 45.4999C20.4732 45.4977 20.7496 45.4293 21.001 45.2969L29.0287 41.0055C31.3052 39.792 33.0879 38.4351 34.4787 36.8554C37.5027 33.4135 39.154 29.0206 39.1246 24.4909L39.0294 9.54946C39.0204 7.8285 37.89 6.29287 36.2184 5.73466L21.2842 0.724019C20.3849 0.419542 19.3995 0.426161 18.5161 0.739464L3.63855 5.92882C1.97592 6.5091 0.865994 8.05575 0.875055 9.77892L0.970192 24.7094C0.999639 29.2456 2.70757 33.6186 5.78139 37.0253C7.18579 38.583 8.98433 39.92 11.2857 41.1137L19.3882 45.3057ZM17.263 27.7451C17.5982 28.0672 18.0331 28.2261 18.4681 28.2217C18.903 28.2195 19.3356 28.0562 19.6663 27.7297L28.4393 19.0807C29.0985 18.4298 29.0917 17.384 28.4257 16.742C27.7575 16.0999 26.6815 16.1043 26.0224 16.7552L18.4431 24.226L15.3399 21.243C14.6717 20.6009 13.598 20.6075 12.9365 21.2584C12.2774 21.9093 12.2842 22.9551 12.9524 23.5971L17.263 27.7451Z","fill","#69B99D"],["d","M36.3165 27.2202C35.7337 27.785 35.466 28.6017 35.5987 29.4027L37.599 40.4727C37.7677 41.411 37.3717 42.3605 36.5865 42.9027C35.817 43.4652 34.7932 43.5327 33.954 43.0827L23.9887 37.8852C23.6422 37.7007 23.2575 37.6017 22.8637 37.5905H22.254C22.0425 37.622 21.8355 37.6895 21.6465 37.793L11.679 43.0152C11.1862 43.2627 10.6282 43.3505 10.0815 43.2627C8.74949 43.0107 7.86074 41.7417 8.07899 40.403L10.0815 29.333C10.2142 28.5252 9.94649 27.704 9.36374 27.1302L1.23899 19.2552C0.559494 18.596 0.323244 17.606 0.633744 16.7127C0.935244 15.8217 1.70474 15.1715 2.63399 15.0252L13.8165 13.403C14.667 13.3152 15.414 12.7977 15.7965 12.0327L20.724 1.93024C20.841 1.70524 20.9917 1.49824 21.174 1.32274L21.3765 1.16524C21.4822 1.04824 21.6037 0.951494 21.7387 0.872744L21.984 0.782744L22.3665 0.625244H23.3137C24.1597 0.712994 24.9045 1.21924 25.2937 1.97524L30.2865 12.0327C30.6465 12.7685 31.3462 13.2792 32.154 13.403L43.3365 15.0252C44.2815 15.1602 45.0712 15.8127 45.384 16.7127C45.6787 17.615 45.4245 18.605 44.7315 19.2552L36.3165 27.2202Z","fill","#69B99D"],["xmlns","http://www.w3.org/2000/svg","width","46","height","42","viewBox","0 0 46 42","fill","none"],["fill-rule","evenodd","clip-rule","evenodd","d","M40.4622 21.0022C40.4622 22.8326 41.9653 24.3219 43.8125 24.3219C44.744 24.3219 45.5 25.071 45.5 25.9939V32.0157C45.5 37.1077 41.3195 41.25 36.1805 41.25H9.82175C4.68275 41.25 0.5 37.1077 0.5 32.0157V25.9939C0.5 25.071 1.256 24.3219 2.1875 24.3219C4.037 24.3219 5.54 22.8326 5.54 21.0022C5.54 19.2187 4.09775 17.8766 2.1875 17.8766C1.73975 17.8766 1.31225 17.7004 0.995 17.3861C0.67775 17.0717 0.5 16.6459 0.5 16.2045L0.5045 9.98657C0.5045 4.89453 4.685 0.75 9.824 0.75H36.176C41.315 0.75 45.4977 4.89453 45.4977 9.98657L45.5 16.0105C45.5 16.4519 45.3223 16.88 45.0073 17.1921C44.69 17.5065 44.2625 17.6826 43.8125 17.6826C41.9653 17.6826 40.4622 19.1719 40.4622 21.0022ZM28.0669 22.4582L30.7197 19.8988C31.1809 19.4573 31.3407 18.8063 31.1404 18.2044C30.9424 17.6024 30.4249 17.1744 29.7994 17.0874L26.1342 16.5568L24.4939 13.2662C24.2127 12.6999 23.6412 12.3477 23.0044 12.3454H22.9999C22.3654 12.3454 21.7939 12.6977 21.5082 13.264L19.8679 16.5568L16.2094 17.0852C15.5772 17.1744 15.0597 17.6024 14.8594 18.2044C14.6614 18.8063 14.8212 19.4573 15.2802 19.8988L17.9329 22.4582L17.3074 26.0765C17.1994 26.7008 17.4537 27.3206 17.9712 27.6929C18.2637 27.9002 18.6034 28.0072 18.9477 28.0072C19.2109 28.0072 19.4764 27.9426 19.7194 27.8155L22.9999 26.1078L26.2737 27.811C26.8407 28.112 27.5134 28.0652 28.0287 27.6907C28.5484 27.3206 28.8027 26.7008 28.6947 26.0765L28.0669 22.4582Z","fill","#69B99D"],["fill-rule","evenodd","clip-rule","evenodd","d","M0.875 19.215C0.875 8.86526 9.52373 0.5 19.9853 0.5C30.4763 0.5 39.125 8.86526 39.125 19.215C39.125 24.4303 37.2283 29.2722 34.1064 33.376C30.6623 37.9029 26.4174 41.847 21.6392 44.943C20.5457 45.6584 19.5587 45.7124 18.3585 44.943C13.5532 41.847 9.3082 37.9029 5.89362 33.376C2.76946 29.2722 0.875 24.4303 0.875 19.215ZM13.687 19.7977C13.687 23.2649 16.5162 25.9918 19.9852 25.9918C23.4565 25.9918 26.313 23.2649 26.313 19.7977C26.313 16.3576 23.4565 13.4979 19.9852 13.4979C16.5162 13.4979 13.687 16.3576 13.687 19.7977Z","fill","#69B99D"],["xmlns","http://www.w3.org/2000/svg","width","46","height","46","viewBox","0 0 46 46","fill","none"],["fill-rule","evenodd","clip-rule","evenodd","d","M23.7343 0.971741C24.0936 0.649225 24.5689 0.48017 25.0554 0.501856C35.3398 0.809723 43.9348 8.27555 45.4926 18.2539C45.5024 18.3135 45.5024 18.3743 45.4926 18.4338C45.5261 18.906 45.3665 19.3718 45.0491 19.7282C44.7318 20.0846 44.2827 20.3022 43.8013 20.333L26.5225 21.4725C25.9511 21.5231 25.3844 21.3351 24.9616 20.9546C24.5389 20.574 24.2992 20.0363 24.3015 19.4734L23.1401 2.50096V2.22109C23.1612 1.74375 23.375 1.29426 23.7343 0.971741ZM22.5492 25.9106L37.5256 24.951L37.6275 24.991C38.2706 25.0015 38.8831 25.2623 39.3302 25.7159C39.7773 26.1696 40.0223 26.7789 40.0114 27.4099C39.4213 36.0096 33.1164 43.195 24.5362 45.0461C15.9561 46.8972 7.16039 42.9698 2.94751 35.4063C1.70874 33.2279 0.925931 30.8287 0.645021 28.3495C0.536071 27.6148 0.488368 26.8727 0.502389 26.1305C0.530785 16.986 7.04137 9.09297 16.1512 7.15895C17.254 6.95253 18.3596 7.50315 18.8408 8.49835C18.9606 8.67894 19.0564 8.87375 19.126 9.07809C19.2968 11.7141 19.474 14.3252 19.6503 16.9253C19.7896 18.9787 19.9285 21.0253 20.0633 23.0718C20.0564 23.5539 20.1322 24.0338 20.2875 24.4912C20.6531 25.3912 21.5631 25.9623 22.5492 25.9106Z","fill","#69B99D"],[1,"information-section"],[1,"container-information"],[1,"image-section"],["src","/assets/information.jpg","alt","Modern living room with fireplace",1,"information-image"],[1,"rating-box"],[1,"checkmark"],[1,"rating"],[1,"stars"],[1,"trusted-text"],[1,"reviews-count"],[1,"stats-container"],[1,"stat-box"],[1,"stat-number"],[1,"stat-label"],[1,"top"],[1,"bottom"],[1,"content-section"],[1,"about-us"],[1,"description"],["routerLink","/property-list",1,"cta-button"],[1,"testimonials"],[1,"container-testimonials"],[1,"customer-tag"],[1,"testimonial-header"],[1,"testimonial-title"],["routerLink","/about-us",1,"learn-more"],[1,"learn-more-icon"],[1,"testimonial-grid"],[1,"testimonial-card"],[1,"quote-icon"],[1,"testimonial-text-sm"],[1,"testimonial-author"],[1,"author-image"],["src","/assets/rev1.jpg","alt","Jayden Aminoff"],[1,"author-info"],[1,"author-name"],[1,"author-title"],["src","/assets/rev2.jpg","alt","Marcus Dorish"],["src","/assets/rev3.jpg","alt","Makenna Korsgaard"],[1,"footer-div"],[1,"properties-grid"],["class","property-card",4,"ngFor","ngForOf"],[1,"property-card"],[1,"property-image",3,"src","alt"],[1,"property-content"],[1,"property-title"],[1,"property-location"],[1,"property-details"],[1,"property-price"],[1,"property-area"],[1,"inquiry-btn",3,"routerLink"]],template:function(i,r){1&i&&($e(0,"app-header"),z(1,"section",0)(2,"div",1)(3,"p",2),q(4,"REAL ESTATE"),B(),z(5,"h1",3),q(6,"Let's hunt for your dream residence"),B(),z(7,"p",4),q(8,"Explore our range of beautiful properties with the addition of separate accommodation suitable for you."),B()(),z(9,"div",5),$e(10,"img",6),B()(),z(11,"section",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),q(16,"DISCOVER"),B(),z(17,"h2",12),q(18,"Best recomendation"),B(),z(19,"p",13),q(20,"Discover our exclusive selection of the finest one-of-a-kind luxury properties architectural masterpieces."),B()(),z(21,"a",14),q(22," Learn More "),z(23,"span",15),q(24,"\u2192"),B()()(),He(25,vte,2,1,"div",16),B()(),z(26,"section",17)(27,"div",18)(28,"div",9)(29,"div",10)(30,"div",11),q(31,"OUR ADVANTE"),B(),z(32,"h2",12),q(33,"Giving you peace of mind"),B(),z(34,"p",13),q(35,"Discover our exclusive selection of the finest one-of-a-kind luxury properties architectural masterpieces."),B()()(),z(36,"div",19)(37,"div",20),Ao(),z(38,"svg",21),$e(39,"path",22),B(),Ns(),z(40,"h3",23),q(41,"Comfortable"),B(),z(42,"p",24),q(43,"Enjoy lifestyle amenities designed to provide every homeowners modern comfort, a stone's throw away from schools, churches, and hospitals."),B()(),z(44,"div",20),Ao(),z(45,"svg",25),$e(46,"path",26),B(),Ns(),z(47,"h3",23),q(48,"Extra security"),B(),z(49,"p",24),q(50,"You can connect with potential tenants without having to share your phone number. We also require all users to register to validate their legitimacy."),B()(),z(51,"div",20),Ao(),z(52,"svg",21),$e(53,"path",27),B(),Ns(),z(54,"h3",23),q(55,"Luxury"),B(),z(56,"p",24),q(57,"Find out how we provide the highest standard of professional property management to give you all the benefits of property."),B()(),z(58,"div",20),Ao(),z(59,"svg",28),$e(60,"path",29),B(),Ns(),z(61,"h3",23),q(62,"Best price"),B(),z(63,"p",24),q(64,"Not sure what you should be charging for your property? Let us do the numbers for you\u2014contact us today for a free rental appraisal on your home."),B()(),z(65,"div",20),Ao(),z(66,"svg",25),$e(67,"path",30),B(),Ns(),z(68,"h3",23),q(69,"Strategic location"),B(),z(70,"p",24),q(71,"located in the city center close to the shopping center. Very good for areas surrounded by international education centers, start-up office centers."),B()(),z(72,"div",20),Ao(),z(73,"svg",31),$e(74,"path",32),B(),Ns(),z(75,"h3",23),q(76,"Efficient"),B(),z(77,"p",24),q(78,"Schedule visits to multiple properties at once in one day without having to call them one by one. Check everything and find the best properties for rent"),B()()()()(),z(79,"section",33)(80,"div",34)(81,"div",35),$e(82,"img",36),z(83,"div",37)(84,"div",38),q(85,"\u2713"),B(),z(86,"div",39),q(87,"4.8"),B(),z(88,"div",40),q(89,"\u2605\u2605\u2605\u2605\u2605"),B(),z(90,"div",41),q(91,"Trusted on"),B(),z(92,"div",42),q(93,"500+ Reviews"),B()(),z(94,"div",43)(95,"div",44)(96,"div",45),q(97,"250+"),B(),z(98,"div",46)(99,"div",47),q(100,"Property"),B(),z(101,"div",48),q(102,"Sale"),B()()(),z(103,"div",44)(104,"div",45),q(105,"550+"),B(),z(106,"div",46)(107,"div",47),q(108,"Apartment"),B(),z(109,"div",48),q(110,"Rent"),B()()()()(),z(111,"div",49)(112,"div",50),q(113,"ABOUT US"),B(),z(114,"h1"),q(115,"How much is your information worth now?"),B(),z(116,"p",51),q(117," We have built our reputation as true local area experts. We have gained more knowledge about buyer interests, our neighborhood and the market than any other brand because we live locally and work for local people. "),B(),z(118,"a",52),q(119,"Learn More"),B()()()(),z(120,"section",53)(121,"div",54)(122,"div",55),q(123,"CUSTOMER TESTIMONIAL"),B(),z(124,"div",56)(125,"h2",57),q(126,"Peopel say about us?"),B(),z(127,"a",58),q(128," Learn More "),z(129,"div",59),q(130," \u2192 "),B()()(),z(131,"div",60)(132,"div",61)(133,"div",62),q(134,"\u275d"),B(),z(135,"h3",63),q(136,"It proved to be exactly the kind of home we wanted."),B(),z(137,"p",63),q(138,"We wish to express our thanks for your hard work in finding us a temporary home, which proved to be exactly what we wanted, this really is life changing"),B(),z(139,"div",64)(140,"div",65),$e(141,"img",66),B(),z(142,"div",67)(143,"span",68),q(144,"Jayden Aminoff"),B(),z(145,"span",69),q(146,"UI Designer"),B()()()(),z(147,"div",61)(148,"div",62),q(149,"\u275d"),B(),z(150,"h3",63),q(151,"Nobody knows Portland and the peninsula better than David."),B(),z(152,"p",63),q(153,"My wife and I had a dream of downsizing from our house in Cape Elizabeth into a small condo closer to where we work and play in Portland."),B(),z(154,"div",64)(155,"div",65),$e(156,"img",70),B(),z(157,"div",67)(158,"span",68),q(159,"Marcus Dorish"),B(),z(160,"span",69),q(161,"UI Designer"),B()()()(),z(162,"div",61)(163,"div",62),q(164,"\u275d"),B(),z(165,"h3",63),q(166,"He keeps his client's best interests in sharp focus"),B(),z(167,"p",63),q(168,"After working with David to sell my home in 2013, I was convinced that he's the real deal! If ever need. Since then I've bought two properties and sold one."),B(),z(169,"div",64)(170,"div",65),$e(171,"img",71),B(),z(172,"div",67)(173,"span",68),q(174,"Makenna Korsgaard"),B(),z(175,"span",69),q(176,"UX Researcher"),B()()()()()()(),z(177,"div",72),$e(178,"app-footer"),B()),2&i&&(ne(25),ye("ngIf",r.properties.length>0))},dependencies:[qs,wo,od,Yee,z2,Hw],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap";@import"https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap";*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.top-header[_ngcontent-%COMP%]{background-color:#f5f5f5;width:100%}.container[_ngcontent-%COMP%]{width:100%;padding:0 1rem;margin:0 auto}.header-text[_ngcontent-%COMP%]{display:inline-flex;padding:.75rem 1.5rem;justify-content:center;align-items:center;gap:.625rem;position:relative;margin-top:2rem;margin-left:1rem;color:#4db299;font-family:Poppins,sans-serif;background-color:#f8f9fe;font-size:1.125rem;font-weight:500;line-height:1.625rem;letter-spacing:.03125rem}.header-content[_ngcontent-%COMP%]{background-color:#f5f5f5;width:100%;min-height:50vh;padding:2rem 0}.bg-color[_ngcontent-%COMP%]{background-color:#f5f5f5}.header-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header-img[_ngcontent-%COMP%]{width:100%;max-width:400px;height:auto;margin:0 auto;order:2}.hero[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#f5f5f5;width:100%}.hero-content[_ngcontent-%COMP%]{width:100%;padding:1.5rem;order:1}.hero-image[_ngcontent-%COMP%]{width:100%;height:auto;overflow:hidden;border-radius:.5rem;order:2}.hero-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover;transform:scaleX(-1);display:block}.category-label[_ngcontent-%COMP%]{color:#4db299;font-size:.875rem;text-transform:uppercase;letter-spacing:.0625rem;margin-bottom:1.25rem;font-weight:600;position:relative;background-color:#f8f9fe;display:inline-flex;padding:.75rem 1.5rem;justify-content:center;align-items:center;gap:.625rem}.hero-title[_ngcontent-%COMP%]{color:#1f2744;font-family:Rubik,sans-serif;font-size:2.5rem;font-weight:600;line-height:1.2;letter-spacing:.01rem;width:100%;margin-bottom:1.5rem}.hero-description[_ngcontent-%COMP%]{color:#73788c;font-family:Poppins,sans-serif;font-size:1rem;font-style:normal;font-weight:400;line-height:2rem;letter-spacing:.04px;padding-left:3rem}@media screen and (min-width: 768px){.container[_ngcontent-%COMP%]{padding:0 2rem;max-width:720px}.header-text[_ngcontent-%COMP%]{margin-top:3rem;margin-left:2rem}.header-row[_ngcontent-%COMP%], .hero[_ngcontent-%COMP%]{flex-direction:row}.hero-content[_ngcontent-%COMP%]{padding:2rem 2rem 2rem 3rem;order:1}.hero-image[_ngcontent-%COMP%]{order:2}.hero-title[_ngcontent-%COMP%]{font-size:3rem;width:100%}}@media screen and (min-width: 1024px){.container[_ngcontent-%COMP%]{max-width:960px}.header-text[_ngcontent-%COMP%]{margin-top:9.5rem;margin-left:11rem}.header-content[_ngcontent-%COMP%]{min-height:50rem}.hero-content[_ngcontent-%COMP%]{padding-right:2.5rem;padding-left:7.75rem;padding-bottom:14.625rem;flex:1}.hero-image[_ngcontent-%COMP%]{flex:1}.hero-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-width:50rem;height:auto}.category-label[_ngcontent-%COMP%]{top:-1.875rem;left:3.125rem}.hero-title[_ngcontent-%COMP%]{font-size:4rem;line-height:4.625rem;max-width:46.875rem;padding-left:3.25rem}}@media screen and (min-width: 1440px){.container[_ngcontent-%COMP%]{max-width:1320px}.header-content[_ngcontent-%COMP%]{max-width:1440px;margin:0 auto}.hero-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50rem;height:47.5rem}}.recommendations[_ngcontent-%COMP%]{min-height:100vh}.recommendation-container[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;padding:4rem 1rem}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:2.5rem;flex-wrap:wrap}.tag[_ngcontent-%COMP%]{background-color:#f8f9fe;color:#4db299;font-size:.875rem;font-weight:500;padding:.5rem 1rem;border-radius:4px;display:inline-block;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-size:2.5rem;font-weight:600;color:#1f2744;line-height:1.2;margin-bottom:1rem;width:100%}.section-description[_ngcontent-%COMP%]{color:#64748b;max-width:35rem;margin-bottom:1.5rem}.learn-more[_ngcontent-%COMP%]{display:flex;align-items:center;text-decoration:none;color:#4db299;font-weight:500;margin-top:1rem}.learn-more[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-left:.5rem;width:20px;height:20px;background-color:#4db299;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center}.properties-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:2rem}.property-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 0 20px #0000000d;transition:transform .3s ease}.property-card[_ngcontent-%COMP%]:hover{transform:translateY(-10px)}.property-image[_ngcontent-%COMP%]{width:100%;height:220px;object-fit:cover}.property-content[_ngcontent-%COMP%]{padding:1.5rem}.property-title[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-size:1.25rem;font-weight:600;margin-bottom:.5rem;color:#1f2744}.property-location[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b;margin-bottom:1rem}.property-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.property-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#4db299}.property-area[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.property-area[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#1f2744}.inquiry-btn[_ngcontent-%COMP%]{display:block;width:100%;padding:.75rem;text-align:center;background-color:transparent;color:#4db299;border:1px solid #4DB299;border-radius:4px;font-weight:500;text-decoration:none;transition:all .3s ease}.inquiry-btn[_ngcontent-%COMP%]:hover, .inquiry-btn.featured[_ngcontent-%COMP%]{background-color:#4db299;color:#fff}.inquiry-btn.featured[_ngcontent-%COMP%]:hover{background-color:#3da088}@media (min-width: 768px){.section-header[_ngcontent-%COMP%]{flex-wrap:nowrap}.title-description[_ngcontent-%COMP%]{flex:1}.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.features[_ngcontent-%COMP%]{background-color:#f5f5f5}.features-container[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;padding:4rem 1rem}.selection-title[_ngcontent-%COMP%]{color:#054457;font-family:Rubik,sans-serif;font-size:3rem;font-style:normal;font-weight:600;line-height:3.5rem;letter-spacing:.5px;width:100%;text-align:center}.featured-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:32px}.card[_ngcontent-%COMP%]{background-color:transparent;border:none;align-items:start;width:100%;max-width:23.5rem;height:auto;margin:0 auto}.card-title[_ngcontent-%COMP%]{color:#054457;font-family:Poppins,sans-serif;font-size:1.75rem;font-style:normal;font-weight:700;line-height:2.375rem;letter-spacing:.5px;padding-top:1rem}.card-description[_ngcontent-%COMP%]{color:#73788c;font-family:Poppins,sans-serif;font-size:1rem;font-style:normal;font-weight:400;line-height:1.625;letter-spacing:.5px;padding-top:1rem}@media (max-width: 768px){.selection-title[_ngcontent-%COMP%]{font-size:2rem;line-height:2.5rem}.card-title[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}.card-description[_ngcontent-%COMP%]{font-size:.95rem}}.information-section[_ngcontent-%COMP%]{background-color:#fff;padding-top:7rem;padding-bottom:5rem}.container-information[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:flex;padding:20px}.image-section[_ngcontent-%COMP%]{flex:1;position:relative}.information-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.rating-box[_ngcontent-%COMP%]{position:absolute;top:-6.25rem;left:6.25rem;background-color:#fffffff2;padding:20px;border-radius:5px;text-align:center;box-shadow:0 4px 8px #0000001a}.checkmark[_ngcontent-%COMP%]{color:#4db299;font-size:24px;margin-bottom:5px}.rating[_ngcontent-%COMP%]{font-size:48px;font-weight:700;color:#1a3b5d;line-height:1;margin-bottom:5px}.stars[_ngcontent-%COMP%]{color:#4db299;margin-bottom:10px}.trusted-text[_ngcontent-%COMP%]{color:#666;font-size:12px;margin-bottom:5px}.reviews-count[_ngcontent-%COMP%]{color:#1a3b5d;font-weight:700;font-size:14px}.stats-container[_ngcontent-%COMP%]{position:absolute;bottom:0rem;right:0rem;left:1.25rem;display:flex;justify-content:space-between;background-color:#fff;padding:15px 25px}.stat-box[_ngcontent-%COMP%]{display:flex;align-items:center}.stat-number[_ngcontent-%COMP%]{font-size:42px;font-weight:700;color:#0e4c66;margin-right:10px;line-height:1}.stat-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-label[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{color:#777;font-size:14px;margin-bottom:2px}.stat-label[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{color:#999;font-size:14px}.content-section[_ngcontent-%COMP%]{flex:1;padding:40px;display:flex;flex-direction:column;justify-content:center}.about-us[_ngcontent-%COMP%]{color:#4db299;text-transform:uppercase;font-size:14px;font-weight:700;letter-spacing:1px;margin-bottom:15px}h1[_ngcontent-%COMP%]{color:#054457;font-family:Rubik,sans-serif;font-style:normal;font-weight:600;line-height:56px;letter-spacing:.5px;padding-bottom:1rem}.description[_ngcontent-%COMP%]{color:#73788c;font-family:Poppins,sans-serif;font-size:16px;font-style:normal;padding-bottom:4rem;font-weight:400;line-height:1.625rem;letter-spacing:.04px}h3[_ngcontent-%COMP%]{margin-bottom:1rem}.cta-button[_ngcontent-%COMP%]{display:inline-block;color:#fff;padding:1rem 2.5rem;text-decoration:none;background:#69B99D;box-shadow:24px 24px 65px #518c773d;font-weight:700;transition:background-color .3s;align-self:flex-start}.cta-button[_ngcontent-%COMP%]:hover{background-color:#4db299}@media (max-width: 900px){.container[_ngcontent-%COMP%]{flex-direction:column}.image-section[_ngcontent-%COMP%]{height:350px}.content-section[_ngcontent-%COMP%]{padding:30px 20px}}.container-testimonials[_ngcontent-%COMP%]{padding:4rem 1rem;max-width:1200px;margin:0 auto}.testimonial-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.testimonial-title[_ngcontent-%COMP%]{color:#06515e;font-size:28px;font-weight:600}.learn-more[_ngcontent-%COMP%]{color:#6dc9b8;text-decoration:none;display:flex;align-items:center;font-size:14px}.learn-more-icon[_ngcontent-%COMP%]{width:20px;height:20px;background-color:#6dc9b8;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;margin-left:5px}.testimonial-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.testimonial-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:30px 30px 50px;box-shadow:0 4px 6px #0000000d}.quote-icon[_ngcontent-%COMP%]{color:#ddd;font-size:32px;line-height:1;margin-bottom:15px}.testimonial-text[_ngcontent-%COMP%]{color:#1f2744;font-family:Poppins,sans-serif;font-size:18px;font-style:normal;font-weight:600;line-height:28px;letter-spacing:.045px;padding-bottom:1rem}.testimonial-text-sm[_ngcontent-%COMP%] > {color:#1f2744;font-family:Poppins,sans-serif;font-size:16px;font-style:normal;margin-top:1rem;font-weight:400;line-height:24px;letter-spacing:.04px}.testimonial-author[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:20px}.author-image[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#eee;overflow:hidden;margin-right:10px}.author-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.author-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.author-name[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#333}.author-title[_ngcontent-%COMP%]{font-size:12px;color:#777}.customer-tag[_ngcontent-%COMP%]{color:#6dc9b8;text-transform:uppercase;font-size:14px;font-weight:500;letter-spacing:.5px;margin-bottom:10px}']})}}return t})();function xte(t,n){if(1&t&&(z(0,"option",20),q(1),ks(2,"titlecase"),B()),2&t){const e=n.$implicit;ye("value",e),ne(1),Qe(Iu(2,2,e))}}function wte(t,n){if(1&t&&(z(0,"option",20),q(1),B()),2&t){const e=n.$implicit;ye("value",e),ne(1),Qe(e)}}function kte(t,n){if(1&t&&(z(0,"option",20),q(1),B()),2&t){const e=n.$implicit;ye("value",e.display),ne(1),Qe(e.display)}}function Mte(t,n){if(1&t&&(z(0,"option",20),q(1),B()),2&t){const e=n.$implicit;ye("value",e),ne(1),Qe(e)}}let Cte=(()=>{class t{constructor(){this.filterChanged=new Xi,this.type="",this.city="",this.minPrice=null,this.maxPrice=null,this.search="",this.dealType="",this.lookingFor="Residence in Tunis",this.selectedLocation="Tunis",this.priceRangeDisplay="10000 - 50000 TND",this.dealTypes=["Rent","Sale"],this.propertyTypes=["apartment","house","villa","studio"],this.locations=["Ariana","Beja","Ben Arous","Bizerte","Gabes","Gafsa","Jendouba","Kairouan","Kasserine","Kebili","Kef","Mahdia","Manouba","Medenine","Monastir","Nabeul","Sfax","Sidi Bouzid","Siliana","Sousse","Tataouine","Tozeur","Tunis","Zaghouan"],this.priceRanges=[{display:"10000 - 50000 TND",min:1e4,max:5e4},{display:"50000 - 100000 TND",min:5e4,max:1e5},{display:"100000 - 250000 TND",min:1e5,max:25e4},{display:"250000 - 500000 TND",min:25e4,max:5e5},{display:"500000+",min:5e5,max:null}]}onTypeChange(e){this.type=e,this.updateLookingForText(),this.applyFilters()}onLocationChange(e){this.selectedLocation=e,this.city="Tunis"===e?"Tunis":e,this.updateLookingForText(),this.applyFilters()}onPriceRangeChange(e){this.priceRangeDisplay=e;const i=this.priceRanges.find(r=>r.display===e);i&&(this.minPrice=i.min,this.maxPrice=i.max),this.applyFilters()}onSearchChange(e){this.search=e,this.applyFilters()}updateLookingForText(){this.lookingFor=`${this.type||"Residence"} in ${this.city||this.selectedLocation}`}applyFilters(){this.filterChanged.emit({dealType:this.dealType,type:this.type,city:this.city,minPrice:this.minPrice,maxPrice:this.maxPrice,search:this.search})}resetFilters(){this.type="",this.city="",this.minPrice=null,this.maxPrice=null,this.search="",this.dealType="",this.lookingFor="Residence in Tunis",this.selectedLocation="Tunis",this.priceRangeDisplay="10000 - 50000 TND",this.applyFilters()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-filter"]],outputs:{filterChanged:"filterChanged"},decls:49,vars:10,consts:[[1,"filter-container"],[1,"filter-row"],[1,"filter-group"],[1,"input-icon-wrapper"],["type","text","readonly","",1,"form-control","modern-input",3,"ngModel","ngModelChange"],[1,"select-wrapper","modern-select-wrapper"],[1,"form-control","modern-select",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"input-icon-wrapper","modern-select-wrapper"],[1,"fa-solid","fa-location-dot","icon-left"],[1,"form-control","modern-select","icon-input",3,"ngModel","ngModelChange","change"],[1,"filter-group","wide"],[1,"search-input-container","modern-search"],["type","text","placeholder","Ex. hunian apart",1,"form-control","modern-input",3,"ngModel","ngModelChange","input"],[1,"search-button","modern-search-button"],[1,"fas","fa-search"],[1,"filter-group","action-button"],[1,"filter-button","modern-filter-button",3,"click"],[1,"fas","fa-sliders-h"],[3,"value"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"label"),q(4,"Looking For"),B(),z(5,"div",3)(6,"input",4),qt("ngModelChange",function(c){return r.lookingFor=c}),B()()(),z(7,"div",2)(8,"label"),q(9,"Type"),B(),z(10,"div",5)(11,"select",6),qt("ngModelChange",function(c){return r.type=c})("change",function(){return r.onTypeChange(r.type)}),z(12,"option",7),q(13,"Any"),B(),He(14,xte,3,4,"option",8),B()()(),z(15,"div",2)(16,"label"),q(17,"Deal Type"),B(),z(18,"div",5)(19,"select",6),qt("ngModelChange",function(c){return r.dealType=c})("change",function(){return r.applyFilters()}),z(20,"option",7),q(21,"Any"),B(),He(22,wte,2,2,"option",8),B()()(),z(23,"div",2)(24,"label"),q(25,"Price"),B(),z(26,"div",5)(27,"select",6),qt("ngModelChange",function(c){return r.priceRangeDisplay=c})("change",function(){return r.onPriceRangeChange(r.priceRangeDisplay)}),He(28,kte,2,2,"option",8),B()()(),z(29,"div",2)(30,"label"),q(31,"Location"),B(),z(32,"div",9),$e(33,"i",10),z(34,"select",11),qt("ngModelChange",function(c){return r.selectedLocation=c})("change",function(){return r.onLocationChange(r.selectedLocation)}),He(35,Mte,2,2,"option",8),B()()(),z(36,"div",12)(37,"label"),q(38,"Find Specific Property"),B(),z(39,"div",13)(40,"input",14),qt("ngModelChange",function(c){return r.search=c})("input",function(){return r.onSearchChange(r.search)}),B(),z(41,"button",15),$e(42,"i",16),B()()(),z(43,"div",17)(44,"label"),q(45,"\xa0"),B(),z(46,"button",18),qt("click",function(){return r.resetFilters()}),$e(47,"i",19),q(48," Reset Filter "),B()()()()),2&i&&(ne(6),ye("ngModel",r.lookingFor),ne(5),ye("ngModel",r.type),ne(3),ye("ngForOf",r.propertyTypes),ne(5),ye("ngModel",r.dealType),ne(3),ye("ngForOf",r.dealTypes),ne(5),ye("ngModel",r.priceRangeDisplay),ne(1),ye("ngForOf",r.priceRanges),ne(6),ye("ngModel",r.selectedLocation),ne(1),ye("ngForOf",r.locations),ne(5),ye("ngModel",r.search))},dependencies:[qs,h4,u4,hl,w2,Wl,Wm,jw],styles:[".filter-container[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-radius:14px;border-top:#4DB299 2px solid;margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.25rem;border-bottom:gray 1px solid;padding-bottom:1rem;align-items:flex-end}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:160px}.filter-group.wide[_ngcontent-%COMP%]{flex:2}.modern-input[_ngcontent-%COMP%]{border:1px solid #4DB299;border-radius:1.5rem;padding:.75rem 1rem;font-size:0rem;width:100%;transition:all .3s ease;background-color:#f9f9f9}.modern-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4db299;box-shadow:0 0 0 3px #4db299;background-color:#fff}.modern-select-wrapper[_ngcontent-%COMP%]{position:relative}.modern-select[_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;border:1px solid #4DB299;border-radius:1.5rem;padding:.75rem 2.5rem .75rem 1rem;font-size:.95rem;width:100%;cursor:pointer;background-color:#f9f9f9;transition:all .3s ease;background-image:url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\");background-repeat:no-repeat;background-position:right 1rem center;background-size:1rem}.modern-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4db299;background-color:#fff}.icon-left[_ngcontent-%COMP%]{position:absolute;top:50%;right:2.5rem;transform:translateY(-50%);font-size:1rem;color:#4db299;z-index:2;pointer-events:none}.modern-search[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.modern-search-button[_ngcontent-%COMP%]{position:absolute;right:.75rem;background:none;border:none;color:#4db299;cursor:pointer;font-size:1rem;padding:.5rem;transition:color .2s}.modern-search-button[_ngcontent-%COMP%]:hover{color:#4db299}.modern-filter-button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:1.5rem;background-color:#4db299;color:#fff;border:none;cursor:pointer;font-weight:600;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:.5rem}.modern-filter-button[_ngcontent-%COMP%]:hover{background-color:#0e8b6c;transform:translateY(-1px)}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;font-size:.9rem;color:#444}@media (max-width: 768px){.filter-group[_ngcontent-%COMP%]{min-width:100%}.filter-group.wide[_ngcontent-%COMP%]{flex:1 0 100%}}"]})}}return t})();function Ste(t,n){if(1&t&&(z(0,"p",9),q(1),ks(2,"currency"),B()),2&t){const e=ht();ne(1),Qe(Xd(2,1,e.property.price.price,"TND"))}}function Ete(t,n){1&t&&(z(0,"p",9),q(1,"Price on request"),B())}const Dte=function(t){return["/property",t]};let Tte=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-card"]],inputs:{property:"property"},decls:17,vars:13,consts:[[1,"property-card"],[1,"property-image",3,"src","alt"],[1,"property-content"],[1,"property-title"],[1,"property-location"],[1,"property-details"],["class","property-price",4,"ngIf"],[1,"property-area"],[1,"inquiry-btn",3,"routerLink"],[1,"property-price"]],template:function(i,r){1&i&&(z(0,"div",0),$e(1,"img",1),z(2,"div",2)(3,"h3",3),q(4),B(),z(5,"p",4),q(6),ks(7,"titlecase"),B(),z(8,"div",5),He(9,Ste,3,4,"p",6),He(10,Ete,2,0,"p",6),z(11,"p",7)(12,"span"),q(13),B(),q(14," Living Area "),B()(),z(15,"a",8),q(16,"View Details"),B()()()),2&i&&(ne(1),R_("alt",r.property.generalinfo.title),ye("src","http://backend.ddev.site"+(null==r.property.Media.photos[0]?null:r.property.Media.photos[0].imageName),fs),ne(3),Qe(r.property.generalinfo.title),ne(2),Yt("",Iu(7,9,r.property.location.city),", ",r.property.location.subcity,""),ne(3),ye("ngIf",!r.property.price.hideprice),ne(1),ye("ngIf",r.property.price.hideprice),ne(3),Ft("",r.property.Specification.size||"N/A","m\xb2"),ne(2),ye("routerLink",Gr(11,Dte,r.property.id)))},dependencies:[wo,od,jw,Hw],styles:[".properties-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:2rem}.property-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 0 20px #0000000d;transition:transform .3s ease}.property-card[_ngcontent-%COMP%]:hover{transform:translateY(-10px)}.property-image[_ngcontent-%COMP%]{width:100%;height:220px;object-fit:cover}.property-content[_ngcontent-%COMP%]{padding:1.5rem}.property-title[_ngcontent-%COMP%]{font-family:Rubik,sans-serif;font-size:1.25rem;font-weight:600;margin-bottom:.5rem;color:#1f2744}.property-location[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b;margin-bottom:1rem}.property-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.property-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#4db299}.property-area[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.property-area[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#1f2744}.inquiry-btn[_ngcontent-%COMP%]{display:block;width:100%;padding:.75rem;text-align:center;background-color:transparent;color:#4db299;border:1px solid #4DB299;border-radius:4px;font-weight:500;text-decoration:none;transition:all .3s ease}.inquiry-btn[_ngcontent-%COMP%]:hover, .inquiry-btn.featured[_ngcontent-%COMP%]{background-color:#4db299;color:#fff}.inquiry-btn.featured[_ngcontent-%COMP%]:hover{background-color:#3da088}@media (min-width: 768px){.section-header[_ngcontent-%COMP%]{flex-wrap:nowrap}.title-description[_ngcontent-%COMP%]{flex:1}.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1024px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}"]})}}return t})();function Ate(t,n){1&t&&$e(0,"app-property-card",4),2&t&&ye("property",n.$implicit)}let Pte=(()=>{class t{constructor(e){this.propertyService=e,this.allProperties=[],this.filteredProperties=[]}ngOnInit(){this.propertyService.getAllProperties().subscribe(e=>{this.allProperties=e,this.filteredProperties=e})}onFiltersChanged(e){console.log("FILTER TYPE:",e.type),console.log("ACTUAL TYPES:",this.allProperties.map(i=>i.generalinfo.propertyType)),this.filteredProperties=this.allProperties.filter(i=>{const r=!e.dealType||i.generalinfo.deal_type.toLowerCase()===e.dealType.toLowerCase(),s=!e.type||i.generalinfo.propertyType===e.type,c=!e.city||i.location.city.toLowerCase().includes(e.city.toLowerCase()),f=!e.minPrice||+i.price.price>=e.minPrice,y=!e.maxPrice||+i.price.price<=e.maxPrice,k=!e.search||i.generalinfo.title.toLowerCase().includes(e.search.toLowerCase());return r&&s&&c&&f&&y&&k})}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-list"]],decls:5,vars:1,consts:[[3,"filterChanged"],[1,"properties-container"],[1,"properties-grid"],[3,"property",4,"ngFor","ngForOf"],[3,"property"]],template:function(i,r){1&i&&($e(0,"app-header"),z(1,"app-property-filter",0),qt("filterChanged",function(c){return r.onFiltersChanged(c)}),B(),z(2,"div",1)(3,"div",2),He(4,Ate,1,1,"app-property-card",3),B()()),2&i&&(ne(4),ye("ngForOf",r.filteredProperties))},dependencies:[qs,z2,Cte,Tte],styles:[".properties-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}.properties-container[_ngcontent-%COMP%]{width:100%;max-width:1800px;margin:0 auto;padding:1rem}@media screen and (min-width: 576px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}app-property-filter[_ngcontent-%COMP%]{margin:1.5rem}}@media screen and (min-width: 768px){app-property-filter[_ngcontent-%COMP%]{margin:1.5rem 2rem}.properties-container[_ngcontent-%COMP%]{padding:1.5rem}}@media screen and (min-width: 992px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}app-property-filter[_ngcontent-%COMP%]{margin:2rem;padding:1.5rem}}@media screen and (min-width: 1200px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}.properties-container[_ngcontent-%COMP%]{padding:2rem}app-property-filter[_ngcontent-%COMP%]{padding:1.5rem 2rem}}@media screen and (min-width: 1400px){.properties-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(5,1fr)}}"]})}}return t})();function Ite(t,n){if(1&t){const e=Ki();z(0,"div",11),qt("click",function(){const s=An(e).$implicit,c=ht();return Mn(!s.isBooked&&!s.isPast&&c.selectDate(s.date))})("mouseenter",function(){const s=An(e).$implicit;return Mn(ht().handleHover(s.date))}),q(1),B()}if(2&t){const e=n.$implicit,i=ht();Z("other-month",!e.isCurrentMonth)("booked",e.isBooked)("past-date",e.isPast)("today",e.isToday)("selected",i.isStartDate(e.date)||i.isEndDate(e.date))("in-range",i.isInRange(e.date))("start-date",i.isStartDate(e.date))("end-date",i.isEndDate(e.date)),ne(1),Ft(" ",e.day," ")}}function Ote(t,n){if(1&t&&(z(0,"span"),q(1),ks(2,"date"),B()),2&t){const e=ht(2);ne(1),Ft(" Selected start: ",Xd(2,1,e.startDate,"mediumDate")," ")}}function Rte(t,n){if(1&t&&(z(0,"span"),q(1),ks(2,"date"),ks(3,"date"),B()),2&t){const e=ht(2);ne(1),Yt(" ",Xd(2,2,e.startDate,"mediumDate")," - ",Xd(3,5,e.endDate,"mediumDate")," ")}}function Lte(t,n){if(1&t&&(z(0,"div",12),He(1,Ote,3,4,"span",13),He(2,Rte,4,8,"span",13),B()),2&t){const e=ht();ne(1),ye("ngIf",e.startDate&&!e.endDate),ne(1),ye("ngIf",e.startDate&&e.endDate)}}let Fte=(()=>{class t{constructor(){this.bookings=[],this.dateRangeChange=new Xi,this.currentDate=new Date,this.calendarDays=[],this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],this.startDate=null,this.endDate=null,this.hoveredDate=null,this.quickSelectionRanges=[{label:"Today",days:0},{label:"Yesterday",days:-1},{label:"This Week",days:7},{label:"Last Week",days:14},{label:"This Month",days:30},{label:"Last Month",days:60}],this.currentMonth=this.currentDate.getMonth(),this.currentYear=this.currentDate.getFullYear()}ngOnInit(){this.generateCalendar()}generateCalendar(){this.calendarDays=[];const e=new Date(this.currentYear,this.currentMonth,1),i=new Date(this.currentYear,this.currentMonth+1,0),s=e.getDay();if(0!==s){const y=new Date(this.currentYear,this.currentMonth,0).getDate();for(let k=s-1;k>=0;k--){const E=y-k,F=new Date(this.currentYear,this.currentMonth-1,E);this.calendarDays.push({date:F,day:E,isCurrentMonth:!1,isBooked:this.isDayBooked(F),isToday:this.isToday(F),isPast:this.isPastDate(F)})}}for(let f=1;f<=i.getDate();f++){const y=new Date(this.currentYear,this.currentMonth,f);this.calendarDays.push({date:y,day:f,isCurrentMonth:!0,isBooked:this.isDayBooked(y),isToday:this.isToday(y),isPast:this.isPastDate(y)})}const c=i.getDay();if(6!==c)for(let f=1;f<=6-c;f++){const y=new Date(this.currentYear,this.currentMonth+1,f);this.calendarDays.push({date:y,day:f,isCurrentMonth:!1,isBooked:this.isDayBooked(y),isToday:this.isToday(y),isPast:this.isPastDate(y)})}}isDayBooked(e){return this.bookings.some(i=>{const r=new Date(i.startDate),s=new Date(i.endDate);return e>=r&&e<=s})}isPastDate(e){const i=new Date;return i.setHours(0,0,0,0),e<i}prevMonth(){0===this.currentMonth?(this.currentMonth=11,this.currentYear--):this.currentMonth--,this.generateCalendar()}nextMonth(){11===this.currentMonth?(this.currentMonth=0,this.currentYear++):this.currentMonth++,this.generateCalendar()}selectDate(e){this.isDayBooked(e)||this.isPastDate(e)||(!this.startDate||this.startDate&&this.endDate?(this.startDate=e,this.endDate=null,this.dateRangeChange.emit({startDate:this.startDate,endDate:null})):(e<this.startDate?(this.endDate=this.startDate,this.startDate=e):this.endDate=e,this.isRangeValid()?this.dateRangeChange.emit({startDate:this.startDate,endDate:this.endDate}):(this.endDate=null,this.dateRangeChange.emit({startDate:this.startDate,endDate:null}))))}isRangeValid(){if(!this.startDate||!this.endDate)return!0;const e=this.startDate.getTime(),i=this.endDate.getTime();return!this.bookings.some(r=>{const s=new Date(r.startDate).getTime(),c=new Date(r.endDate).getTime();return e<=c&&i>=s})}handleHover(e){this.hoveredDate=e}isInRange(e){return!!this.startDate&&(this.endDate?e>=this.startDate&&e<=this.endDate:!!this.hoveredDate&&e>=this.startDate&&e<=this.hoveredDate)}isStartDate(e){return!!this.startDate&&e.getTime()===this.startDate.getTime()}isEndDate(e){return!!this.endDate&&e.getTime()===this.endDate.getTime()}quickSelect(e){const i=new Date;let r;0===e?r=new Date:-1===e?(r=new Date,r.setDate(r.getDate()-1),i.setDate(i.getDate()-1)):(r=new Date,r.setDate(r.getDate()-e)),this.startDate=r,this.endDate=i,this.isRangeValid()||(this.startDate=new Date,this.endDate=new Date),this.dateRangeChange.emit({startDate:this.startDate,endDate:this.endDate})}getCurrentSelection(){return{startDate:this.startDate,endDate:this.endDate}}isToday(e){const i=new Date;return e.getDate()===i.getDate()&&e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-date-range-picker"]],inputs:{bookings:"bookings"},outputs:{dateRangeChange:"dateRangeChange"},decls:28,vars:4,consts:[[1,"date-range-picker"],[1,"calendar-container"],[1,"calendar-header"],[1,"nav-btn",3,"click"],[1,"current-month"],[1,"calendar"],[1,"weekdays"],[1,"weekday"],[1,"calendar-days"],["class","day",3,"other-month","booked","past-date","today","selected","in-range","start-date","end-date","click","mouseenter",4,"ngFor","ngForOf"],["class","selected-range",4,"ngIf"],[1,"day",3,"click","mouseenter"],[1,"selected-range"],[4,"ngIf"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),qt("click",function(){return r.prevMonth()}),q(4,"<"),B(),z(5,"div",4),q(6),B(),z(7,"button",3),qt("click",function(){return r.nextMonth()}),q(8,">"),B()(),z(9,"div",5)(10,"div",6)(11,"div",7),q(12,"Sun"),B(),z(13,"div",7),q(14,"Mon"),B(),z(15,"div",7),q(16,"Tue"),B(),z(17,"div",7),q(18,"Wed"),B(),z(19,"div",7),q(20,"Thu"),B(),z(21,"div",7),q(22,"Fri"),B(),z(23,"div",7),q(24,"Sat"),B()(),z(25,"div",8),He(26,Ite,2,17,"div",9),B()()(),He(27,Lte,3,2,"div",10),B()),2&i&&(ne(6),Yt(" ",r.monthNames[r.currentMonth]," ",r.currentYear," "),ne(20),ye("ngForOf",r.calendarDays),ne(1),ye("ngIf",r.startDate))},dependencies:[qs,wo,v2],styles:['.date-range-picker[_ngcontent-%COMP%]{font-family:poppins,sans-serif;width:100%;border:1px solid #e0e0e0;border-radius:12px;box-shadow:0 4px 12px #00000014;background-color:#fff}.quick-selection[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:24px;border-bottom:1px solid #f0f0f0;padding-bottom:18px}.quick-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;width:140px}.quick-option[_ngcontent-%COMP%]{padding:12px;border:none;background-color:#f8f9fa;border-radius:6px;cursor:pointer;text-align:left;font-size:14px;color:#81cdb7;transition:all .2s ease}.quick-option[_ngcontent-%COMP%]:hover{background-color:#e9ecef;color:#212529}.custom-range[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center}.btn[_ngcontent-%COMP%]{padding:10px 14px;border:1px solid #81CDB7;background-color:#3a8e7b;border-radius:6px;cursor:pointer;font-size:14px;color:#495057;transition:all .2s ease}.btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#3a8e7b;color:#212529}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.calendar-container[_ngcontent-%COMP%]{padding:8px;background-color:#fff;border-radius:8px}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding:0 12px}.current-month[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#212529}.nav-btn[_ngcontent-%COMP%]{background-color:#f8f9fa;border:none;font-size:18px;cursor:pointer;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.nav-btn[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.weekdays[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);text-align:center;margin-bottom:10px;padding:6px 0}.weekday[_ngcontent-%COMP%]{padding:8px;font-size:14px;font-weight:500;color:#6c757d}.calendar-days[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}.day[_ngcontent-%COMP%]{height:46px;display:flex;align-items:center;justify-content:center;cursor:pointer;border-radius:50%;position:relative;font-size:15px;transition:all .15s ease;border:2px solid transparent}.day[_ngcontent-%COMP%]:hover:not(.booked):not(.other-month){background-color:#f1f3f5}.other-month[_ngcontent-%COMP%]{color:#adb5bd}.today[_ngcontent-%COMP%]{border:2px solid #3A8E7B;font-weight:600}.booked[_ngcontent-%COMP%]{background-color:#ffe3e3;color:#fa5252;cursor:not-allowed;position:relative}.booked[_ngcontent-%COMP%]:after{content:"";position:absolute;width:80%;height:2px;background-color:#ff6b6b;transform:rotate(45deg)}.selected[_ngcontent-%COMP%]{background-color:#3a8e7b;color:#fff;font-weight:600}.in-range[_ngcontent-%COMP%]{background:#81CDB7;border-radius:10px}.start-date[_ngcontent-%COMP%]{border-radius:50% 0 0 50%}.end-date[_ngcontent-%COMP%]{border-radius:0 50% 50% 0}.selected-range[_ngcontent-%COMP%]{margin-top:20px;padding:14px;background-color:#f8f9fa;border-radius:8px;text-align:center;font-size:15px;color:#495057;border:1px solid #e9ecef}.past-date[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#b0b0b0;cursor:not-allowed;position:relative}.past-date[_ngcontent-%COMP%]:after{content:"";position:absolute;width:80%;height:2px;background-color:silver;transform:rotate(45deg)}']})}}return t})();var yk=wn(244);let zte=(()=>{class t{constructor(){this.latitude=0,this.longitude=0,this.propertyTitle=""}ngAfterViewInit(){setTimeout(()=>{this.initializeMap()},300)}ngOnChanges(e){(e.latitude||e.longitude)&&this.map&&(this.map.remove(),this.initializeMap())}ngOnDestroy(){this.map&&this.map.remove(),this.resizeObserver&&this.resizeObserver.disconnect()}initializeMap(){const e=this.latitude||0,i=this.longitude||0,r=document.getElementById("map");if(!r)return void console.error("Map container not found");const y=yk.icon({iconRetinaUrl:"/assets/marker-icon-2x-red.png",iconUrl:"/assets/marker-icon-red.png",shadowUrl:"/assets/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});yk.Marker.prototype.options.icon=y,this.map=yk.map("map",{center:[i,e],zoom:13}),yk.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(this.map),yk.marker([i,e]).addTo(this.map).bindPopup(this.propertyTitle||"Property Location").openPopup(),this.resizeObserver=new ResizeObserver(()=>{this.map&&this.map.invalidateSize()}),this.resizeObserver.observe(r),setTimeout(()=>{this.map&&this.map.invalidateSize()},500)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-map2"]],inputs:{latitude:"latitude",longitude:"longitude",propertyTitle:"propertyTitle"},features:[ol],decls:9,vars:2,consts:[[1,"map-wrapper"],["id","map"],[1,"map-coordinates"],[1,"fas","fa-map-marker-alt"]],template:function(i,r){1&i&&(z(0,"div",0),$e(1,"div",1),z(2,"div",2)(3,"div"),$e(4,"i",3),q(5),B(),z(6,"div"),$e(7,"i",3),q(8),B()()()),2&i&&(ne(5),Ft(" Latitude: ",r.latitude,""),ne(3),Ft(" Longitude: ",r.longitude,""))},styles:[".map-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column}#map[_ngcontent-%COMP%]{height:auto;width:100%;min-height:470px;border-radius:8px;z-index:0}.map-coordinates[_ngcontent-%COMP%]{margin-top:10px;background-color:#f8f9fa;padding:10px;border-radius:8px;font-size:14px}.map-coordinates[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:5px}.map-coordinates[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3498db;margin-right:8px}"]})}}return t})();function Nte(t,n){if(1&t&&(z(0,"div",30),q(1),B()),2&t){const e=ht();ne(1),Ft(" ",e.error," ")}}function Bte(t,n){1&t&&(z(0,"div",31),q(1," Please enter your name "),B())}function Vte(t,n){1&t&&(z(0,"div",31),q(1," Please enter a valid email address "),B())}function jte(t,n){1&t&&(z(0,"div",31),q(1," Please enter a valid phone number "),B())}function Hte(t,n){1&t&&(z(0,"div",31),q(1," Please select a valid date "),B())}function Ute(t,n){if(1&t&&(z(0,"option",32),q(1),B()),2&t){const e=n.$implicit;ye("value",e),ne(1),Ft(" ",e," ")}}function qte(t,n){1&t&&(z(0,"div",33)(1,"small"),q(2,"Loading available times..."),B()())}function $te(t,n){1&t&&(z(0,"div",31),q(1," Please select a time slot "),B())}function Gte(t,n){1&t&&(z(0,"span"),q(1,"Scheduling..."),B())}function Wte(t,n){1&t&&(z(0,"span"),q(1,"Schedule Appointment"),B())}const vk=function(t){return{"is-invalid":t}};let Zte=(()=>{class t{constructor(e,i,r){this.fb=e,this.propertyService=i,this.userService=r,this.appointmentScheduled=new Xi,this.formClosed=new Xi,this.availableTimeSlots=[],this.isLoading=!1,this.submitting=!1,this.error=null,this.currentUser=null;const s=new Date;s.setDate(s.getDate()+1),this.minDate=s.toISOString().split("T")[0]}ngOnInit(){this.currentUser=this.userService.getUserProfile(),this.userService.getUserProfile().subscribe(e=>{console.log("Fetched user:",e),this.appointmentForm.patchValue({name:`${e.name} ${e.lastName}`,email:e.email,phone:e.phoneNumber})}),this.appointmentForm=this.fb.group({name:[this.currentUser?.name||""],email:[this.currentUser?.email||""],phone:[this.currentUser?.phoneNumber||""],appointmentDate:["",[Gi.required]],appointmentTime:["",[Gi.required]],message:[""]}),this.appointmentForm.get("appointmentDate")?.valueChanges.subscribe(e=>{e?this.loadAvailableTimeSlots(e):this.availableTimeSlots=[]})}loadAvailableTimeSlots(e){this.isLoading=!0,this.availableTimeSlots=[],this.propertyService.getAvailableAppointmentSlots(this.propertyId,e).subscribe({next:i=>{this.availableTimeSlots=i.availableSlots,this.isLoading=!1},error:i=>{console.error("Error loading time slots",i),this.error="Unable to load available time slots. Please try again.",this.isLoading=!1,this.availableTimeSlots=this.generateDummyTimeSlots()}})}generateDummyTimeSlots(){return["10:00","10:30","11:00","11:30","12:00","14:00","14:30","15:00","15:30","16:00","16:30"]}onSubmit(){if(this.appointmentForm.invalid)return Object.keys(this.appointmentForm.controls).forEach(i=>{this.appointmentForm.get(i)?.markAsTouched()}),void console.log(this.appointmentForm.value);this.submitting=!0,this.propertyService.scheduleAppointment({propertyId:this.propertyId,name:this.appointmentForm.value.name,email:this.appointmentForm.value.email,phone:this.appointmentForm.value.phone,appointmentDate:this.appointmentForm.value.appointmentDate,appointmentTime:this.appointmentForm.value.appointmentTime,message:this.appointmentForm.value.message,propertyTitle:"",propertycity:"",lastName:"",userPhone:""}).subscribe({next:i=>{this.submitting=!1,this.appointmentScheduled.emit(i)},error:i=>{console.error("Error scheduling appointment",i),this.error="Failed to schedule appointment. Please try again.",this.submitting=!1}})}closeForm(){this.formClosed.emit()}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(ac),st(zf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-appointment-form"]],inputs:{propertyId:"propertyId"},outputs:{appointmentScheduled:"appointmentScheduled",formClosed:"formClosed"},decls:52,vars:29,consts:[[1,"appointment-form-container"],[1,"modal-header"],["type","button",1,"close-btn",3,"click"],[1,"modal-body"],["class","alert alert-danger",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","name"],["readonly","","type","text","id","name","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"form-row"],[1,"form-group","col-md-6"],["for","email"],["readonly","","type","email","id","email","formControlName","email",1,"form-control",3,"ngClass"],["for","phone"],["readonly","","type","tel","id","phone","formControlName","phone",1,"form-control",3,"ngClass"],["for","appointmentDate"],["type","date","id","appointmentDate","formControlName","appointmentDate",1,"form-control",3,"min","ngClass"],[1,"form-text","text-muted"],["for","appointmentTime"],["id","appointmentTime","formControlName","appointmentTime",1,"form-control",3,"ngClass","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],["for","message"],["id","message","formControlName","message","rows","3","placeholder","Any specific questions or requirements for your viewing?",1,"form-control"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],[1,"alert","alert-danger"],[1,"invalid-feedback"],[3,"value"],[1,"mt-2"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"h2"),q(3,"Schedule a Property Viewing"),B(),z(4,"button",2),qt("click",function(){return r.closeForm()}),q(5,"\xd7"),B()(),z(6,"div",3),He(7,Nte,2,1,"div",4),z(8,"form",5),qt("ngSubmit",function(){return r.onSubmit()}),z(9,"div",6)(10,"label",7),q(11,"Full Name"),B(),$e(12,"input",8),He(13,Bte,2,0,"div",9),B(),z(14,"div",10)(15,"div",11)(16,"label",12),q(17,"Email Address"),B(),$e(18,"input",13),He(19,Vte,2,0,"div",9),B(),z(20,"div",11)(21,"label",14),q(22,"Phone Number"),B(),$e(23,"input",15),He(24,jte,2,0,"div",9),B()(),z(25,"div",10)(26,"div",11)(27,"label",16),q(28,"Preferred Date"),B(),$e(29,"input",17),He(30,Hte,2,0,"div",9),z(31,"small",18),q(32,"Available for inspection: Monday to Friday"),B()(),z(33,"div",11)(34,"label",19),q(35,"Preferred Time"),B(),z(36,"select",20)(37,"option",21),q(38,"Select a time"),B(),He(39,Ute,2,2,"option",22),B(),He(40,qte,3,0,"div",23),He(41,$te,2,0,"div",9),B()(),z(42,"div",6)(43,"label",24),q(44,"Additional Notes (Optional)"),B(),$e(45,"textarea",25),B(),z(46,"div",26)(47,"button",27),qt("click",function(){return r.closeForm()}),q(48,"Cancel"),B(),z(49,"button",28),He(50,Gte,2,0,"span",29),He(51,Wte,2,0,"span",29),B()()()()()),2&i){let s,c,f,y,k,E,F,$,W,re;ne(7),ye("ngIf",r.error),ne(1),ye("formGroup",r.appointmentForm),ne(4),ye("ngClass",Gr(19,vk,(null==(s=r.appointmentForm.get("name"))?null:s.touched)&&(null==(s=r.appointmentForm.get("name"))?null:s.invalid))),ne(1),ye("ngIf",(null==(c=r.appointmentForm.get("name"))?null:c.touched)&&(null==(c=r.appointmentForm.get("name"))?null:c.invalid)),ne(5),ye("ngClass",Gr(21,vk,(null==(f=r.appointmentForm.get("email"))?null:f.touched)&&(null==(f=r.appointmentForm.get("email"))?null:f.invalid))),ne(1),ye("ngIf",(null==(y=r.appointmentForm.get("email"))?null:y.touched)&&(null==(y=r.appointmentForm.get("email"))?null:y.invalid)),ne(4),ye("ngClass",Gr(23,vk,(null==(k=r.appointmentForm.get("phone"))?null:k.touched)&&(null==(k=r.appointmentForm.get("phone"))?null:k.invalid))),ne(1),ye("ngIf",(null==(E=r.appointmentForm.get("phone"))?null:E.touched)&&(null==(E=r.appointmentForm.get("phone"))?null:E.invalid)),ne(5),ye("min",r.minDate)("ngClass",Gr(25,vk,(null==(F=r.appointmentForm.get("appointmentDate"))?null:F.touched)&&(null==(F=r.appointmentForm.get("appointmentDate"))?null:F.invalid))),ne(1),ye("ngIf",(null==($=r.appointmentForm.get("appointmentDate"))?null:$.touched)&&(null==($=r.appointmentForm.get("appointmentDate"))?null:$.invalid)),ne(6),ye("ngClass",Gr(27,vk,(null==(W=r.appointmentForm.get("appointmentTime"))?null:W.touched)&&(null==(W=r.appointmentForm.get("appointmentTime"))?null:W.invalid)))("disabled",r.isLoading||0===r.availableTimeSlots.length),ne(3),ye("ngForOf",r.availableTimeSlots),ne(1),ye("ngIf",r.isLoading),ne(1),ye("ngIf",(null==(re=r.appointmentForm.get("appointmentTime"))?null:re.touched)&&(null==(re=r.appointmentForm.get("appointmentTime"))?null:re.invalid)),ne(8),ye("disabled",r.submitting||r.appointmentForm.invalid),ne(1),ye("ngIf",r.submitting),ne(1),ye("ngIf",!r.submitting)}},dependencies:[ha,qs,wo,Zh,h4,u4,hl,w2,Wl,Pc,Ic,wh],styles:[".appointment-form-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:100%;max-width:600px;box-shadow:0 5px 15px #0000001a}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #e9ecef}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer;padding:0;line-height:1}.modal-body[_ngcontent-%COMP%]{padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-right:-10px;margin-left:-10px}.col-md-6[_ngcontent-%COMP%]{flex:0 0 50%;max-width:50%;padding-right:10px;padding-left:10px}.form-control[_ngcontent-%COMP%]{display:block;width:100%;padding:.375rem .75rem;font-size:1rem;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control[_ngcontent-%COMP%]:focus{border-color:#4db299;outline:0;box-shadow:0 0 0 .2rem #007bff40}.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.invalid-feedback[_ngcontent-%COMP%]{display:block;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}.btn[_ngcontent-%COMP%]{display:inline-block;font-weight:400;text-align:center;white-space:nowrap;vertical-align:middle;-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-primary[_ngcontent-%COMP%]{color:#fff;background-color:#4db299;border-color:#4db299}.btn[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:not-allowed}.alert[_ngcontent-%COMP%]{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-danger[_ngcontent-%COMP%]{color:#721c24;background-color:#f8d7da;border-color:#f5c6cb}"]})}}return t})();function Yte(t,n){1&t&&(z(0,"div",20),q(1," Name is required "),B())}function Xte(t,n){1&t&&(z(0,"div",20),q(1," Valid email is required "),B())}function Kte(t,n){1&t&&(z(0,"div",20),q(1," Subject is required "),B())}function Qte(t,n){1&t&&(z(0,"div",20),q(1," Message should be at least 10 characters "),B())}function Jte(t,n){if(1&t&&(z(0,"div",21),q(1),B()),2&t){const e=ht();ne(1),Ft(" ",e.errorMessage," ")}}const q4=function(t){return{"is-invalid":t}};let ene=(()=>{class t{constructor(e,i,r,s){this.fb=e,this.propertyService=i,this.authService=r,this.userService=s,this.recipientName="Agent",this.close=new Xi,this.emailSent=new Xi,this.isSubmitting=!1,this.hasError=!1,this.errorMessage=""}ngOnInit(){if(this.initializeForm("",""),this.authService.isLoggedIn()){const e=this.authService.currentUser,i=e?.email||"";console.log("JWT currentUser:",e),this.userService.getUserProfile().subscribe({next:r=>{console.log("User profile from API:",r);let s="";r.name&&(s=r.name,(r.lastname||r.lastName)&&(s+=" "+(r.lastname||r.lastName))),console.log("Final userName:",s),console.log("Final userEmail:",r.email||i),this.emailForm.patchValue({name:s,email:r.email||i})},error:r=>{console.error("Error fetching user profile:",r),e?.email&&this.emailForm.patchValue({email:e.email})}})}else console.log("User not logged in")}initializeForm(e="",i=""){this.emailForm=this.fb.group({name:[e,[Gi.required]],email:[i,[Gi.required,Gi.email]],subject:["",[Gi.required]],message:["",[Gi.required,Gi.minLength(10)]]})}onSubmit(){if(this.emailForm.invalid)return void this.emailForm.markAllAsTouched();this.isSubmitting=!0,this.hasError=!1;const e={...this.emailForm.value,propertyId:this.propertyId,recipientId:this.recipientId};console.log("Sending email data:",e),this.propertyService.sendEmailToOwner(e).subscribe({next:i=>{this.isSubmitting=!1,this.emailSent.emit(!0),X_().fire({icon:"success",title:"Message Sent!",text:"Your email was successfully sent to the agent.",timer:2500,showConfirmButton:!1}),setTimeout(()=>this.close.emit(),2e3)},error:i=>{this.isSubmitting=!1,this.hasError=!0,this.errorMessage=i.message||"Failed to send email. Please try again.",X_().fire({icon:"error",title:"Sending Failed",text:this.errorMessage})}})}closeModal(){this.close.emit()}static{this.\u0275fac=function(i){return new(i||t)(st(Ep),st(ac),st(Km),st(zf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-email-modal"]],inputs:{propertyId:"propertyId",recipientId:"recipientId",recipientName:"recipientName"},outputs:{close:"close",emailSent:"emailSent"},decls:35,vars:21,consts:[[1,"modal-overlay"],[1,"modal-container"],[1,"modal-header"],["type","button",1,"close-button",3,"click"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","email"],["type","email","id","email","formControlName","email",1,"form-control",3,"ngClass"],["for","subject"],["type","text","id","subject","formControlName","subject",1,"form-control",3,"ngClass"],["for","message"],["id","message","formControlName","message","rows","5",1,"form-control",3,"ngClass"],["class","error-message",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"invalid-feedback"],[1,"error-message"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),q(4),B(),z(5,"button",3),qt("click",function(){return r.closeModal()}),q(6,"\xd7"),B()(),z(7,"div",4)(8,"form",5),qt("ngSubmit",function(){return r.onSubmit()}),z(9,"div",6)(10,"label",7),q(11,"Your Name"),B(),$e(12,"input",8),He(13,Yte,2,0,"div",9),B(),z(14,"div",6)(15,"label",10),q(16,"Your Email Address"),B(),$e(17,"input",11),He(18,Xte,2,0,"div",9),B(),z(19,"div",6)(20,"label",12),q(21,"Subject"),B(),$e(22,"input",13),He(23,Kte,2,0,"div",9),B(),z(24,"div",6)(25,"label",14),q(26,"Message"),B(),$e(27,"textarea",15),He(28,Qte,2,0,"div",9),B(),He(29,Jte,2,1,"div",16),z(30,"div",17)(31,"button",18),qt("click",function(){return r.closeModal()}),q(32,"Cancel"),B(),z(33,"button",19),q(34),B()()()()()()),2&i){let s,c,f,y,k,E,F,$;ne(4),Ft("Contact ",r.recipientName,""),ne(4),ye("formGroup",r.emailForm),ne(4),ye("ngClass",Gr(13,q4,(null==(s=r.emailForm.get("name"))?null:s.invalid)&&(null==(s=r.emailForm.get("name"))?null:s.touched))),ne(1),ye("ngIf",(null==(c=r.emailForm.get("name"))?null:c.invalid)&&(null==(c=r.emailForm.get("name"))?null:c.touched)),ne(4),ye("ngClass",Gr(15,q4,(null==(f=r.emailForm.get("email"))?null:f.invalid)&&(null==(f=r.emailForm.get("email"))?null:f.touched))),ne(1),ye("ngIf",(null==(y=r.emailForm.get("email"))?null:y.invalid)&&(null==(y=r.emailForm.get("email"))?null:y.touched)),ne(4),ye("ngClass",Gr(17,q4,(null==(k=r.emailForm.get("subject"))?null:k.invalid)&&(null==(k=r.emailForm.get("subject"))?null:k.touched))),ne(1),ye("ngIf",(null==(E=r.emailForm.get("subject"))?null:E.invalid)&&(null==(E=r.emailForm.get("subject"))?null:E.touched)),ne(4),ye("ngClass",Gr(19,q4,(null==(F=r.emailForm.get("message"))?null:F.invalid)&&(null==(F=r.emailForm.get("message"))?null:F.touched))),ne(1),ye("ngIf",(null==($=r.emailForm.get("message"))?null:$.invalid)&&(null==($=r.emailForm.get("message"))?null:$.touched)),ne(1),ye("ngIf",r.hasError),ne(4),ye("disabled",r.isSubmitting||r.emailForm.invalid),ne(1),Ft(" ",r.isSubmitting?"Sending...":"Send Message"," ")}},dependencies:[ha,wo,Zh,hl,Wl,Pc,Ic,wh],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.45);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000}.modal-container[_ngcontent-%COMP%]{background:#ffffff;border-radius:16px;padding:2rem;width:100%;max-width:600px;box-shadow:0 12px 28px #00000026;animation:_ngcontent-%COMP%_fadeIn .3s ease;font-family:Helvetica Neue,Helvetica,Arial,sans-serif}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#222;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;color:#717171;cursor:pointer}.close-button[_ngcontent-%COMP%]:hover{color:#000}.form-group[_ngcontent-%COMP%]{margin-bottom:1.2rem}label[_ngcontent-%COMP%]{display:block;font-size:.95rem;font-weight:500;color:#484848;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border-radius:8px;border:1px solid #dcdcdc;background:#fafafa;font-size:1rem;color:#333;transition:border .2s ease,box-shadow .2s ease}.form-control[_ngcontent-%COMP%]:focus{border-color:#4db299;background-color:#fff;outline:none;box-shadow:linear-gradient(135deg,#4DB299,#1F2F2C)}.is-invalid[_ngcontent-%COMP%]{border-color:#ff6f61}.invalid-feedback[_ngcontent-%COMP%]{color:#ff6f61;font-size:.85rem;margin-top:.3rem}.error-message[_ngcontent-%COMP%]{background:#ffe9ec;border-left:4px solid #4DB299;padding:.75rem 1rem;border-radius:8px;margin-top:.8rem;color:#b91c1c;font-weight:500}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}.btn[_ngcontent-%COMP%]{padding:.7rem 1.4rem;font-size:1rem;font-weight:600;border-radius:8px;border:none;cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]{background:#f7f7f7;color:#484848}.btn-secondary[_ngcontent-%COMP%]:hover{background:#ebebeb}.btn-primary[_ngcontent-%COMP%]{background-color:#4db299;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#e01e48}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}"]})}}return t})();function tne(t,n){if(1&t&&(z(0,"div",64)(1,"span"),q(2),B()()),2&t){const e=ht(4);ne(2),Ft("+",e.allImages.length-5," more")}}function nne(t,n){if(1&t){const e=Ki();z(0,"div",61),qt("click",function(){const s=An(e).index,c=ht(3);return c.openFullGallery(),Mn(c.selectImage(s+1))}),$e(1,"img",62),He(2,tne,3,1,"div",63),B()}if(2&t){const e=n.$implicit,i=n.index,r=ht(3);ne(1),ye("src",e,fs),ne(1),ye("ngIf",3===i&&r.allImages.length>5)}}function ine(t,n){if(1&t){const e=Ki();z(0,"div",55)(1,"div",56)(2,"div",57),qt("click",function(){return An(e),Mn(ht(2).openFullGallery())}),$e(3,"img",58),B(),z(4,"div",59),He(5,nne,3,2,"div",60),B()()()}if(2&t){const e=ht(2);ne(3),ye("src",e.allImages[0],fs),ne(2),ye("ngForOf",e.allImages.slice(1,5))}}function rne(t,n){if(1&t){const e=Ki();z(0,"div",79),qt("click",function(){const s=An(e).index;return Mn(ht(3).selectImage(s))}),$e(1,"img",80),B()}if(2&t){const e=n.$implicit,i=n.index;Z("active",ht(3).selectedImageIndex===i),ne(1),ye("src",e,fs)}}function one(t,n){if(1&t){const e=Ki();z(0,"div",65)(1,"div",66)(2,"div",67)(3,"h3"),q(4),B(),z(5,"button",68),qt("click",function(){return An(e),Mn(ht(2).closeFullGallery())}),$e(6,"i",69),B()(),z(7,"div",70)(8,"div",71),$e(9,"img",72),z(10,"button",73),qt("click",function(){return An(e),Mn(ht(2).prevImage())}),$e(11,"i",74),B(),z(12,"button",75),qt("click",function(){return An(e),Mn(ht(2).nextImage())}),$e(13,"i",76),B()(),z(14,"div",77),He(15,rne,2,3,"div",78),B()()()()}if(2&t){const e=ht(2);ne(4),Ft("All Photos (",e.allImages.length,")"),ne(5),ye("src",e.allImages[e.selectedImageIndex],fs),ne(6),ye("ngForOf",e.allImages)}}function sne(t,n){1&t&&(z(0,"div",85),$e(1,"i",86),q(2," Central A/C "),B())}function ane(t,n){1&t&&(z(0,"div",85),$e(1,"i",87),q(2," Parking "),B())}function lne(t,n){1&t&&(z(0,"div",85),$e(1,"i",88),q(2," Elevator "),B())}function cne(t,n){1&t&&(z(0,"div",85),$e(1,"i",89),q(2," Pets Allowed "),B())}function dne(t,n){1&t&&(z(0,"div",85),$e(1,"i",90),q(2," Concierge "),B())}function hne(t,n){1&t&&(z(0,"div",85),$e(1,"i",91),q(2," Security "),B())}function une(t,n){1&t&&(z(0,"div",85),$e(1,"i",92),q(2," Balcony "),B())}function pne(t,n){1&t&&(z(0,"div",85),$e(1,"i",93),q(2," Walk-in Closet "),B())}function fne(t,n){1&t&&(z(0,"div",85),$e(1,"i",94),q(2," Gym "),B())}function mne(t,n){1&t&&(z(0,"div",85),$e(1,"i",95),q(2," Pool "),B())}function gne(t,n){1&t&&(z(0,"div",85),$e(1,"i",96),q(2," Nearby Schools "),B())}function _ne(t,n){1&t&&(z(0,"div",85),$e(1,"i",97),q(2," Nearby Shopping "),B())}function yne(t,n){if(1&t){const e=Ki();z(0,"button",98),qt("click",function(){return An(e),Mn(ht(3).toggleAllAmenities())}),q(1," Show all amenities "),B()}}function vne(t,n){if(1&t&&(z(0,"div",81)(1,"h2"),q(2,"What this place offers"),B(),z(3,"div",82),He(4,sne,3,0,"div",83),He(5,ane,3,0,"div",83),He(6,lne,3,0,"div",83),He(7,cne,3,0,"div",83),He(8,dne,3,0,"div",83),He(9,hne,3,0,"div",83),He(10,une,3,0,"div",83),He(11,pne,3,0,"div",83),He(12,fne,3,0,"div",83),He(13,mne,3,0,"div",83),He(14,gne,3,0,"div",83),He(15,_ne,3,0,"div",83),B(),He(16,yne,2,0,"button",84),B()),2&t){const e=ht(2);ne(4),ye("ngIf",e.property.Amenities.centralAC),ne(1),ye("ngIf",e.property.Amenities.parking),ne(1),ye("ngIf",e.property.Amenities.elevator),ne(1),ye("ngIf",e.property.Amenities.petsAllowed),ne(1),ye("ngIf",e.property.Amenities.conciergeService),ne(1),ye("ngIf",e.property.Amenities.securityService),ne(1),ye("ngIf",e.property.Amenities.balcony),ne(1),ye("ngIf",e.property.Amenities.walkInCloset),ne(1),ye("ngIf",e.property.Amenities.sharedGym||e.property.Amenities.privateGym),ne(1),ye("ngIf",e.property.Amenities.sharedPool||e.property.Amenities.privatePool),ne(1),ye("ngIf",e.property.Amenities.nearbySchools),ne(1),ye("ngIf",e.property.Amenities.nearbyShopping),ne(1),ye("ngIf",e.hasMoreAmenities())}}function bne(t,n){if(1&t&&(z(0,"span",99),q(1),B()),2&t){const e=ht(2);ne(1),Ft(" ",e.property.price.priceunit," ")}}function xne(t,n){if(1&t&&(z(0,"div",107),q(1),ks(2,"date"),B()),2&t){const e=ht(4);ne(1),Qe(Xd(2,1,e.selectedDateRange.endDate,"mediumDate"))}}function wne(t,n){1&t&&(z(0,"div",110),q(1,"Select date"),B())}function kne(t,n){if(1&t&&(z(0,"div",104)(1,"div",105)(2,"div")(3,"div",106),q(4,"Check in"),B(),z(5,"div",107),q(6),ks(7,"date"),B()(),z(8,"div")(9,"div",106),q(10,"Check out"),B(),He(11,xne,3,4,"div",108),He(12,wne,2,0,"div",109),B()()()),2&t){const e=ht(3);ne(6),Qe(Xd(7,3,e.selectedDateRange.startDate,"mediumDate")),ne(5),ye("ngIf",e.selectedDateRange.endDate),ne(1),ye("ngIf",!e.selectedDateRange.endDate)}}function Mne(t,n){if(1&t){const e=Ki();z(0,"div",100)(1,"h3"),q(2,"Select your dates"),B(),z(3,"app-date-range-picker",101),qt("dateRangeChange",function(r){return An(e),Mn(ht(2).onDateRangeChange(r))}),B(),He(4,kne,13,6,"div",102),z(5,"button",103),qt("click",function(){return An(e),Mn(ht(2).submitBooking())}),q(6," Book Now "),B()()}if(2&t){const e=ht(2);ne(3),ye("bookings",e.property.bookings),ne(1),ye("ngIf",e.selectedDateRange.startDate),ne(1),ye("disabled",!e.selectedDateRange.startDate||!e.selectedDateRange.endDate)}}function Cne(t,n){if(1&t){const e=Ki();z(0,"div",6)(1,"div",7)(2,"h1"),q(3),B(),z(4,"div",8),$e(5,"i",9),z(6,"span"),q(7),B()()(),He(8,ine,6,2,"div",10),He(9,one,16,3,"div",11),z(10,"div",12)(11,"div",13)(12,"div",14)(13,"h2"),q(14,"About this property"),B(),z(15,"p"),q(16),B()(),z(17,"div",15)(18,"div",16),$e(19,"i",17),z(20,"div")(21,"div",18),q(22),B(),z(23,"div",19),q(24,"Type"),B()()(),z(25,"div",16),$e(26,"i",20),z(27,"div")(28,"div",18),q(29),B(),z(30,"div",19),q(31,"Bedrooms"),B()()(),z(32,"div",16),$e(33,"i",21),z(34,"div")(35,"div",18),q(36),B(),z(37,"div",19),q(38,"Bathrooms"),B()()(),z(39,"div",16),$e(40,"i",22),z(41,"div")(42,"div",18),q(43),B(),z(44,"div",19),q(45,"Size (m\xb2)"),B()()()(),He(46,vne,17,13,"div",23),z(47,"div",24)(48,"h2"),q(49,"Where you'll be"),B(),z(50,"div",25),$e(51,"app-map2",26),B(),z(52,"div",27),$e(53,"i",28),z(54,"span"),q(55),B()()()(),z(56,"div",29)(57,"div",30)(58,"div",31)(59,"span",32),q(60),ks(61,"currency"),B(),He(62,bne,2,1,"span",33),B(),z(63,"div",34)(64,"span",35),q(65),B(),z(66,"span",36),q(67),B()()(),He(68,Mne,7,3,"div",37),z(69,"div",38)(70,"div",39),$e(71,"img",40),z(72,"div",41)(73,"div",42),q(74,"Hosted by"),B(),z(75,"div",43),q(76),B()()(),z(77,"div",44)(78,"button",45),qt("click",function(){return An(e),Mn(ht().openEmailModal())}),$e(79,"i",46),q(80," Message "),B(),z(81,"button",47),qt("click",function(){return An(e),Mn(ht().callAgent())}),$e(82,"i",48),q(83," Call "),B()()(),z(84,"div",49)(85,"h3"),q(86,"Schedule a Visit"),B(),z(87,"div",50)(88,"div",51),q(89,"Monday - Friday"),B(),z(90,"div",52),q(91,"10:00am - 5:00pm"),B()(),z(92,"button",53),qt("click",function(){return An(e),Mn(ht().openAppointmentForm())}),$e(93,"i",54),q(94," Make Appointment "),B()()()()()}if(2&t){const e=ht();ne(3),Qe(e.property.generalinfo.title),ne(4),Yt("",e.property.location.city,", ",e.property.location.country,""),ne(1),ye("ngIf",e.allImages.length>0),ne(1),ye("ngIf",e.showFullGallery),ne(7),Qe(e.property.generalinfo.description),ne(6),Qe(e.property.generalinfo.propertyType),ne(7),Qe(e.property.Specification.bedrooms),ne(7),Qe(e.property.Specification.bathrooms),ne(7),Qe(e.property.Specification.size),ne(3),ye("ngIf",e.property.Amenities),ne(5),ye("latitude",e.property.location.latitude)("longitude",e.property.location.longitude)("propertyTitle",e.property.generalinfo.title),ne(4),un("",e.property.location.country,", ",e.property.location.city,", ",e.property.location.subcity,""),ne(5),Qe(Xd(61,25,e.property.price.price,"TND")),ne(2),ye("ngIf","rent"===e.property.generalinfo.deal_type),ne(3),Qe("rent"===e.property.generalinfo.deal_type?"For Rent":"For Sale"),ne(2),Qe(e.property.generalinfo.PropertyCondition),ne(1),ye("ngIf","rent"===e.property.generalinfo.deal_type),ne(3),ye("src",e.getImageUrl(e.property.user.profileImage||""),fs),ne(5),Yt("",e.property.user.name||"Property Owner"," ",e.property.user.lastname,"")}}function Sne(t,n){if(1&t){const e=Ki();z(0,"app-email-modal",111),qt("close",function(){return An(e),Mn(ht().closeEmailModal())})("emailSent",function(r){return An(e),Mn(ht().onEmailSent(r))}),B()}if(2&t){const e=ht();ye("propertyId",e.property.id)("recipientId",e.property.user.id)("recipientName",e.property.user.name||"Agent")}}function Ene(t,n){if(1&t){const e=Ki();z(0,"div",112)(1,"div",113)(2,"app-appointment-form",114),qt("appointmentScheduled",function(r){return An(e),Mn(ht().onAppointmentScheduled(r))})("formClosed",function(){return An(e),Mn(ht().closeAppointmentForm())}),B()()()}if(2&t){const e=ht();ne(2),ye("propertyId",e.property.id)}}function Dne(t,n){if(1&t){const e=Ki();z(0,"div",115)(1,"div",116),$e(2,"i",117),z(3,"div")(4,"h4"),q(5,"Appointment Scheduled!"),B(),z(6,"p"),q(7),ks(8,"date"),B()(),z(9,"button",118),qt("click",function(){return An(e),Mn(ht().appointmentSuccess=!1)}),q(10,"\xd7"),B()()()}if(2&t){const e=ht();ne(7),Yt("Your visit has been booked for ",Xd(8,2,null==e.scheduledAppointment?null:e.scheduledAppointment.appointmentDate,"longDate")," at ",null==e.scheduledAppointment?null:e.scheduledAppointment.appointmentTime,". ")}}function Tne(t,n){1&t&&(z(0,"div",119),$e(1,"div",120),z(2,"p"),q(3,"Loading property details..."),B()())}function Ane(t,n){if(1&t&&(z(0,"div",121),q(1),B()),2&t){const e=ht();ne(1),Ft(" ",e.error,"\n")}}let Pne=(()=>{class t{constructor(e,i){this.route=e,this.propertyService=i,this.property={},this.isLoading=!0,this.error=null,this.allImages=[],this.selectedImageIndex=0,this.showFullGallery=!1,this.showEmailModal=!1,this.showAppointmentForm=!1,this.showAllAmenities=!1,this.appointmentSuccess=!1,this.scheduledAppointment=null,this.selectedDateRange={startDate:null,endDate:null}}ngOnInit(){this.route.params.subscribe(e=>{const i=e.id;i?(this.loadPropertyDetails(i),this.recordPropertyView(+i)):(this.error="Property ID not found",this.isLoading=!1)})}loadPropertyDetails(e){this.isLoading=!0,this.error=null,this.propertyService.getPropertyById(parseInt(e)).subscribe({next:i=>{this.property=i,this.loadPropertyImages(e),this.isLoading=!1},error:i=>{this.error="Failed to load property details. Please try again later.",this.isLoading=!1,console.error("Error loading property:",i)}})}loadPropertyImages(e){this.propertyService.getPropertyById(parseInt(e)).subscribe({next:i=>{i.Media&&i.Media.photos&&(this.allImages=i.Media.photos.map(r=>"http://backend.ddev.site"+r.imageName))},error:i=>{console.error("Error loading images:",i)}})}selectImage(e){this.selectedImageIndex=e}prevImage(){this.selectedImageIndex=(this.selectedImageIndex-1+this.allImages.length)%this.allImages.length}nextImage(){this.selectedImageIndex=(this.selectedImageIndex+1)%this.allImages.length}openFullGallery(){this.showFullGallery=!0,document.body.style.overflow="hidden"}closeFullGallery(){this.showFullGallery=!1,document.body.style.overflow=""}hasMoreAmenities(){return Object.values(this.property.Amenities||{}).filter(i=>!0===i).length>12}toggleAllAmenities(){this.showAllAmenities=!this.showAllAmenities}openEmailModal(){this.showEmailModal=!0}closeEmailModal(){this.showEmailModal=!1}onEmailSent(e){this.closeEmailModal()}callAgent(){this.property&&this.property.user&&this.property.user.phoneNumber?window.location.href=`tel:${this.property.user.phoneNumber}`:alert("Phone number not available")}openAppointmentForm(){this.showAppointmentForm=!0}closeAppointmentForm(){this.showAppointmentForm=!1}onAppointmentScheduled(e){this.closeAppointmentForm(),this.appointmentSuccess=!0,this.scheduledAppointment=e,setTimeout(()=>{this.appointmentSuccess=!1},5e3)}onDateRangeChange(e){this.selectedDateRange=e}submitBooking(){this.selectedDateRange.startDate&&this.selectedDateRange.endDate&&this.propertyService.addBooking(this.property.id,{propertyId:this.property.id,startDate:this.selectedDateRange.startDate,endDate:this.selectedDateRange.endDate}).subscribe({next:i=>{alert("Booking successful!")},error:i=>{console.error("Booking error:",i),alert("Failed to book. Please try again.")}})}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}reload(){this.property&&this.property.id?this.loadPropertyDetails(this.property.id):window.location.reload()}recordPropertyView(e){this.propertyService.recordView(e).subscribe({next:()=>{console.log("View recorded")},error:i=>{console.error("Failed to record view:",i)}})}static{this.\u0275fac=function(i){return new(i||t)(st(Rf),st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-detail"]],decls:7,vars:6,consts:[["class","property-container",4,"ngIf"],[3,"propertyId","recipientId","recipientName","close","emailSent",4,"ngIf"],["class","modal-overlay",4,"ngIf"],["class","success-toast",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"property-container"],[1,"title-section"],[1,"property-location"],[1,"fas","fa-map-marker-alt"],["class","gallery-section",4,"ngIf"],["class","gallery-modal",4,"ngIf"],[1,"main-content"],[1,"details-section"],[1,"description-section"],[1,"key-details"],[1,"key-detail-item"],[1,"fas","fa-house"],[1,"detail-value"],[1,"detail-label"],[1,"fas","fa-bed"],[1,"fas","fa-bath"],[1,"fas","fa-expand"],["class","amenities-section",4,"ngIf"],[1,"location-section"],[1,"map-container"],[3,"latitude","longitude","propertyTitle"],[1,"location-details"],[1,"fas","fa-map-marked-alt"],[1,"booking-card"],[1,"price-section"],[1,"price"],[1,"price-amount"],["class","price-period",4,"ngIf"],[1,"deal-type"],[1,"deal-badge"],[1,"condition-badge"],["class","calendar-section",4,"ngIf"],[1,"agent-section"],[1,"agent-info"],["alt","Agent","onerror","this.src='/assets/default-profile-image.png'",1,"agent-photo",3,"src"],[1,"agent-details"],[1,"agent-label"],[1,"agent-name"],[1,"contact-buttons"],[1,"contact-btn","message-btn",3,"click"],[1,"bi","bi-envelope"],[1,"contact-btn","call-btn",3,"click"],[1,"bi","bi-telephone"],[1,"inspection-section"],[1,"inspection-times"],[1,"inspection-days"],[1,"inspection-hours"],[1,"schedule-btn",3,"click"],[1,"bi","bi-calendar-check"],[1,"gallery-section"],[1,"gallery-grid"],[1,"main-image",3,"click"],["alt","Main Property Image",3,"src"],[1,"gallery-grid-secondary"],["class","secondary-image",3,"click",4,"ngFor","ngForOf"],[1,"secondary-image",3,"click"],["alt","Property Image",3,"src"],["class","show-all-overlay",4,"ngIf"],[1,"show-all-overlay"],[1,"gallery-modal"],[1,"modal-content"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"bi","bi-x-lg"],[1,"modal-body"],[1,"modal-image-container"],["alt","Property Image",1,"modal-main-image",3,"src"],[1,"modal-nav-btn","modal-prev-btn",3,"click"],[1,"bi","bi-chevron-left"],[1,"modal-nav-btn","modal-next-btn",3,"click"],[1,"bi","bi-chevron-right"],[1,"modal-thumbnails"],["class","modal-thumbnail",3,"active","click",4,"ngFor","ngForOf"],[1,"modal-thumbnail",3,"click"],["alt","Thumbnail",3,"src"],[1,"amenities-section"],[1,"amenities-grid"],["class","amenity-item",4,"ngIf"],["class","show-all-amenities",3,"click",4,"ngIf"],[1,"amenity-item"],[1,"fas","fa-snowflake"],[1,"fas","fa-car"],[1,"fas","fa-elevator"],[1,"fas","fa-paw"],[1,"fas","fa-bell-concierge"],[1,"fas","fa-shield-alt"],[1,"fas","fa-umbrella-beach"],[1,"fas","fa-tshirt"],[1,"fas","fa-dumbbell"],[1,"fas","fa-swimming-pool"],[1,"fas","fa-school"],[1,"fas","fa-shopping-cart"],[1,"show-all-amenities",3,"click"],[1,"price-period"],[1,"calendar-section"],[3,"bookings","dateRangeChange"],["class","booking-summary",4,"ngIf"],[1,"book-now-btn",3,"disabled","click"],[1,"booking-summary"],[1,"date-range"],[1,"date-label"],[1,"date-value"],["class","date-value",4,"ngIf"],["class","date-value empty",4,"ngIf"],[1,"date-value","empty"],[3,"propertyId","recipientId","recipientName","close","emailSent"],[1,"modal-overlay"],[1,"modal-container"],[3,"propertyId","appointmentScheduled","formClosed"],[1,"success-toast"],[1,"success-content"],[1,"bi","bi-check-circle"],[1,"close-toast",3,"click"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-message"]],template:function(i,r){1&i&&($e(0,"app-header"),He(1,Cne,95,28,"div",0),He(2,Sne,1,3,"app-email-modal",1),He(3,Ene,3,1,"div",2),He(4,Dne,11,5,"div",3),He(5,Tne,4,0,"div",4),He(6,Ane,2,1,"div",5)),2&i&&(ne(1),ye("ngIf",!r.isLoading),ne(1),ye("ngIf",r.showEmailModal),ne(1),ye("ngIf",r.showAppointmentForm),ne(1),ye("ngIf",r.appointmentSuccess),ne(1),ye("ngIf",r.isLoading),ne(1),ye("ngIf",!r.isLoading&&r.error))},dependencies:[qs,wo,z2,Fte,zte,Zte,ene,Hw,v2],styles:["[_nghost-%COMP%]{--airbnb-pink: #FF385C;--airbnb-black: #222222;--airbnb-light-gray: #F7F7F7;--airbnb-gray: #717171;--airbnb-border: #DDDDDD;--airbnb-shadow: rgba(0, 0, 0, .08);display:block;font-family:poppins,sans-serif;color:#1f2744;line-height:1.5}.property-container[_ngcontent-%COMP%]{max-width:1800px;margin:0 auto;padding:24px 80px}@media (max-width: 992px){.property-container[_ngcontent-%COMP%]{padding:24px}}.title-section[_ngcontent-%COMP%]{margin-bottom:24px}.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:26px;font-weight:600;margin:0 0 8px;color:#1f2744}.property-location[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:14px;color:var(--airbnb-gray)}.property-location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:6px}.gallery-section[_ngcontent-%COMP%]{margin-bottom:48px;border-radius:12px;border-bottom:1px solid var(--airbnb-border);overflow:hidden}.gallery-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;grid-gap:8px;height:450px}.main-image[_ngcontent-%COMP%]{grid-row:span 2;overflow:hidden;height:100%;cursor:pointer}.gallery-grid-secondary[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;grid-gap:8px;height:100%}.main-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .secondary-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.main-image[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%], .secondary-image[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.05)}.secondary-image[_ngcontent-%COMP%]{position:relative;overflow:hidden;cursor:pointer}.show-all-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background-color:#0009;color:#fff;padding:8px 16px;border-top-left-radius:8px;font-weight:600;font-size:14px}@media (max-width: 768px){.gallery-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;height:auto}.gallery-grid-secondary[_ngcontent-%COMP%]{display:none}.main-image[_ngcontent-%COMP%]{height:300px}}.main-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;grid-gap:80px;margin-top:48px}@media (max-width: 992px){.main-content[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-gap:40px}}.details-section[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:40px;padding-bottom:40px;border-bottom:1px solid var(--airbnb-border)}.details-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;font-weight:600;margin-bottom:16px;color:#1f2744}.description-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#484848;line-height:1.6}.key-details[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin:24px 0}.key-detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:50%;margin-bottom:24px}.key-detail-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;margin-right:16px;color:var(--airbnb-gray)}.detail-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.detail-label[_ngcontent-%COMP%]{font-size:14px;color:var(--airbnb-gray)}.amenities-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:16px;margin-top:16px}.amenity-item[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:16px;padding:8px 0}.amenity-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;width:24px;margin-right:16px;color:var(--airbnb-gray)}.show-all-amenities[_ngcontent-%COMP%]{background:none;border:1px solid #1F2744;color:#1f2744;font-size:16px;font-weight:600;padding:12px 24px;border-radius:8px;margin-top:24px;cursor:pointer;transition:all .2s}.show-all-amenities[_ngcontent-%COMP%]:hover{background-color:var(--airbnb-light-gray)}.map-container[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;height:540px;margin-bottom:16px}.location-details[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:16px;font-size:16px}.location-details[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:12px;color:var(--airbnb-gray)}.booking-card[_ngcontent-%COMP%]{position:sticky;top:80px;background-color:#fff;border-radius:12px;border:1px solid var(--airbnb-border);box-shadow:0 6px 16px var(--airbnb-shadow);padding:24px;max-height:calc(100vh - 93px);overflow-y:auto}.price-section[_ngcontent-%COMP%]{padding-bottom:16px;border-bottom:1px solid var(--airbnb-border)}.price[_ngcontent-%COMP%]{display:flex;align-items:baseline;margin-bottom:8px}.price-amount[_ngcontent-%COMP%]{font-size:22px;font-weight:600}.price-period[_ngcontent-%COMP%]{font-size:16px;margin-left:4px;color:var(--airbnb-gray)}.deal-type[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.deal-badge[_ngcontent-%COMP%], .condition-badge[_ngcontent-%COMP%]{background-color:var(--airbnb-light-gray);color:#1f2744;padding:4px 8px;border-radius:5px;font-size:1rem;font-weight:540}.calendar-section[_ngcontent-%COMP%]{padding:24px 0;border-bottom:1px solid var(--airbnb-border)}.calendar-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:16px}.date-range[_ngcontent-%COMP%]{display:flex;justify-content:space-between;border:1px solid var(--airbnb-border);border-radius:8px;margin-top:16px}.date-range[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;padding:12px}.date-range[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{border-right:1px solid var(--airbnb-border)}.date-label[_ngcontent-%COMP%]{font-size:12px;font-weight:600;margin-bottom:4px}.date-value[_ngcontent-%COMP%]{font-size:14px}.date-value.empty[_ngcontent-%COMP%]{color:var(--airbnb-gray)}.book-now-btn[_ngcontent-%COMP%]{width:100%;background-color:#81cdb7;color:#fff;border:none;border-radius:8px;padding:14px;font-size:16px;font-weight:600;cursor:pointer;margin-top:24px;transition:background-color .2s}.book-now-btn[_ngcontent-%COMP%]:hover{background-color:#276358}.book-now-btn[_ngcontent-%COMP%]:disabled{background-color:#ddd;cursor:not-allowed}.agent-section[_ngcontent-%COMP%]{padding:24px 0;border-bottom:1px solid var(--airbnb-border)}.agent-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.agent-photo[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover;margin-right:16px}.agent-label[_ngcontent-%COMP%]{font-size:12px;color:var(--airbnb-gray)}.agent-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.contact-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px}.contact-btn[_ngcontent-%COMP%]{padding:10px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;display:flex;justify-content:center;align-items:center}.contact-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px}.message-btn[_ngcontent-%COMP%]{background-color:#81cdb7;color:#fff;border:none}.message-btn[_ngcontent-%COMP%]:hover{background-color:#3c4c47}.call-btn[_ngcontent-%COMP%]{background-color:#fff;color:#1f2744;border:1px solid lightslategray}.call-btn[_ngcontent-%COMP%]:hover{background-color:#b0c4de}.inspection-section[_ngcontent-%COMP%]{padding-top:24px}.inspection-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:16px}.inspection-times[_ngcontent-%COMP%]{margin-bottom:16px}.inspection-days[_ngcontent-%COMP%]{font-weight:600;font-size:14px}.inspection-hours[_ngcontent-%COMP%]{font-size:14px;color:var(--airbnb-gray)}.schedule-btn[_ngcontent-%COMP%]{width:100%;background-color:#fff;border:1px solid #1F2744;color:#1f2744;padding:12px;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:all .2s}.schedule-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px}.schedule-btn[_ngcontent-%COMP%]:hover{background-color:var(--airbnb-light-gray)}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;position:relative}.gallery-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000e6;z-index:1000;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;color:#fff}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:24px;cursor:pointer}.modal-body[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;overflow:hidden}.modal-image-container[_ngcontent-%COMP%]{position:relative;height:70vh;display:flex;justify-content:center;align-items:center}.modal-main-image[_ngcontent-%COMP%]{max-height:100%;max-width:90%;object-fit:contain}.modal-nav-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);background-color:#fff;border:none;width:40px;height:40px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;font-size:18px}.modal-prev-btn[_ngcontent-%COMP%]{left:24px}.modal-next-btn[_ngcontent-%COMP%]{right:24px}.modal-thumbnails[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;padding:16px;overflow-x:auto}.modal-thumbnail[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:4px;overflow:hidden;opacity:.7;cursor:pointer;transition:opacity .2s}.modal-thumbnail.active[_ngcontent-%COMP%]{opacity:1;box-shadow:0 0 0 2px #fff}.modal-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.success-toast[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;background-color:#fff;border-radius:8px;box-shadow:0 6px 16px #0000001f;z-index:1000;animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.success-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding:16px;max-width:400px}.success-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#00a699;margin-right:16px}.success-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:16px;font-weight:600}.success-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--airbnb-gray)}.close-toast[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;padding:0 8px;margin-left:16px;color:var(--airbnb-gray)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:400px}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--airbnb-light-gray);border-top:3px solid var(--airbnb-pink);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;text-align:center;padding:24px}.error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:var(--airbnb-pink);margin-bottom:16px}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;margin-bottom:16px}.reload-btn[_ngcontent-%COMP%]{background-color:var(--airbnb-pink);color:#fff;border:none;border-radius:8px;padding:10px 16px;font-size:14px;font-weight:500;cursor:pointer}.no-images-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px;background-color:var(--airbnb-light-gray);border-radius:12px;margin-bottom:48px}.no-images-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:var(--airbnb-gray);margin-bottom:16px}@media (max-width: 768px){.property-container[_ngcontent-%COMP%]{padding:16px}.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:22px}.main-content[_ngcontent-%COMP%]{grid-gap:32px;margin-top:32px}.booking-card[_ngcontent-%COMP%]{position:relative;top:0;margin-top:24px}.key-detail-item[_ngcontent-%COMP%]{width:100%}.amenities-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.gallery-section[_ngcontent-%COMP%]{margin-bottom:32px}.map-container[_ngcontent-%COMP%]{height:300px}}"]})}}return t})(),Ine=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-contact"]],decls:98,vars:0,consts:[[1,"contact-area"],[1,"container"],[1,"row"],[1,"col-xl-7","col-lg-8"],[1,"section-title","mt-45"],[1,"title"],[1,"contact-form","form-style-four","mt-15"],["action","#"],[1,"col-md-6"],[1,"form-input","mt-15"],[1,"input-items","default"],[1,"lni","lni-user"],["type","text","placeholder","John Doe"],[1,"lni","lni-envelope"],["type","text","placeholder","admin@uideck.com"],[1,"lni","lni-phone"],["type","text","placeholder","01234567890"],[1,"lni","lni-bubble"],["type","text","placeholder","Type here"],[1,"col-md-12"],[1,"lni","lni-pencil-alt"],["placeholder","Type your message here"],[1,"single-form","mt-15"],[1,"input-form","rounded-buttons"],["type","submit",1,"btn","primary-btn","rounded-full"],[1,"col-xl-4","col-lg-4","col-md-6","col-sm-8","offset-xl-1"],[1,"section-title","mt-5"],[1,"contact-info"],[1,"info"],[1,"single-info"],[1,"info-icon"],[1,"lni","lni-map-marker"],[1,"info-content"],[1,"text"],[1,"lni","lni-phone-set"],[1,"social","mt-5"],["href","javascript:void(0)"],[1,"lni","lni-facebook-filled"],[1,"lni","lni-twitter-original"],[1,"lni","lni-instagram-original"],[1,"lni","lni-linkedin-original"]],template:function(i,r){1&i&&($e(0,"app-header"),z(1,"section",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h3",5),q(7,"Get in touch"),B()(),z(8,"div",6)(9,"form",7)(10,"div",2)(11,"div",8)(12,"div",9)(13,"label"),q(14,"Full Name"),B(),z(15,"div",10),$e(16,"i",11)(17,"input",12),B()()(),z(18,"div",8)(19,"div",9)(20,"label"),q(21,"Email Address"),B(),z(22,"div",10),$e(23,"i",13)(24,"input",14),B()()(),z(25,"div",8)(26,"div",9)(27,"label"),q(28,"Phone Number"),B(),z(29,"div",10),$e(30,"i",15)(31,"input",16),B()()(),z(32,"div",8)(33,"div",9)(34,"label"),q(35,"Subject"),B(),z(36,"div",10),$e(37,"i",17)(38,"input",18),B()()(),z(39,"div",19)(40,"div",9)(41,"label"),q(42,"Your Message"),B(),z(43,"div",10),$e(44,"i",20)(45,"textarea",21),B()()(),z(46,"div",19)(47,"div",22)(48,"div",23)(49,"button",24),q(50," SEND MESSAGE "),B()()()()()()()(),z(51,"div",25)(52,"div",26)(53,"h3",5),q(54,"Contact Information"),B()(),z(55,"div",27)(56,"ul",28)(57,"li")(58,"div",29)(59,"div",30),$e(60,"i",31),B(),z(61,"div",32)(62,"p",33),q(63," Level 13, 2 Elizabeth St, Melbourne, Victoria 3000, Australia "),B()()()(),z(64,"li")(65,"div",29)(66,"div",30),$e(67,"i",15),B(),z(68,"div",32)(69,"p",33),q(70,"+61 (8) 8234 3555"),B()()()(),z(71,"li")(72,"div",29)(73,"div",30),$e(74,"i",34),B(),z(75,"div",32)(76,"p",33),q(77,"+61 (8) 8234 3555"),B()()()(),z(78,"li")(79,"div",29)(80,"div",30),$e(81,"i",13),B(),z(82,"div",32)(83,"p",33),q(84,"emailhere"),B()()()()(),z(85,"ul",35)(86,"li")(87,"a",36),$e(88,"i",37),B()(),z(89,"li")(90,"a",36),$e(91,"i",38),B()(),z(92,"li")(93,"a",36),$e(94,"i",39),B()(),z(95,"li")(96,"a",36),$e(97,"i",40),B()()()()()()()())},dependencies:[Zh,Pc,Xw,z2],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}body[_ngcontent-%COMP%]{background-color:#f4f8f9;color:#333}app-header[_ngcontent-%COMP%]{margin-bottom:40px}.contact-area[_ngcontent-%COMP%]{padding:60px 0;background-color:#fff}.container[_ngcontent-%COMP%]{max-width:1140px;margin:0 auto}.section-title[_ngcontent-%COMP%]{text-align:center;margin-bottom:40px}.title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#333;text-transform:uppercase}.contact-form[_ngcontent-%COMP%]{background-color:#fff;padding:40px;border-radius:10px;box-shadow:0 10px 30px #0000001a}.form-input[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{font-weight:700;font-size:16px;color:#333}.input-items[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#f9f9f9;border-radius:5px;border:1px solid #ddd;padding:10px;margin-top:5px}.input-items[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-items[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;background:transparent;outline:none;padding:10px;font-size:14px;color:#333;flex:1;border-radius:5px}.input-items[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .input-items[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border-color:#4db299}textarea[_ngcontent-%COMP%]{resize:vertical;min-height:120px}button[_ngcontent-%COMP%]{background-color:#4db299;color:#fff;padding:12px 30px;font-size:16px;border:none;border-radius:50px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#3c9f80}.contact-info[_ngcontent-%COMP%]{background-color:#fff;padding:40px;border-radius:10px;box-shadow:0 10px 30px #0000001a}.info[_ngcontent-%COMP%]{list-style:none;padding:0;margin-bottom:30px}.single-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px}.info-icon[_ngcontent-%COMP%]{font-size:20px;margin-right:15px;color:#4db299}.info-content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:14px;color:#555}.social[_ngcontent-%COMP%]{list-style:none;padding:0;display:flex;gap:15px}.social[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:20px;color:#333;transition:color .3s ease}.social[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#4db299}@media (max-width: 991px){.contact-form[_ngcontent-%COMP%]{padding:30px}.contact-info[_ngcontent-%COMP%]{margin-top:30px}}@media (max-width: 767px){.section-title[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:24px}.contact-form[_ngcontent-%COMP%]{padding:20px}}"]})}}return t})(),One=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-about-us"]],decls:53,vars:0,consts:[[1,"about-hero"],[1,"container"],[1,"about-content"],[1,"container","grid"],[1,"about-text"],[1,"about-image"],["src","https://images.unsplash.com/photo-1600585154340-be6161a56a0c","alt","Modern Real Estate"],[1,"about-stats"],[1,"container","stats-grid"],[1,"stat-box"]],template:function(i,r){1&i&&($e(0,"app-header"),z(1,"section",0)(2,"div",1)(3,"h1"),q(4,"About Us"),B(),z(5,"p"),q(6,"Your Gateway to Modern Real Estate in Tunisia"),B()()(),z(7,"section",2)(8,"div",3)(9,"div",4)(10,"h2"),q(11,"Who We Are"),B(),z(12,"p"),q(13," We are a forward-thinking real estate platform based in Tunisia, dedicated to transforming the way people buy, rent, and invest in properties. Whether you're searching for your dream home or seeking investment opportunities, we provide a secure and user-friendly experience backed by cutting-edge technology. "),B(),z(14,"h2"),q(15,"Our Vision"),B(),z(16,"p"),q(17," To become the most trusted digital hub for real estate in Tunisia by simplifying the process and delivering transparency, innovation, and customer satisfaction at every step. "),B(),z(18,"h2"),q(19,"What We Offer"),B(),z(20,"ul")(21,"li"),q(22,"\u{1f9ed} Easy property discovery via interactive maps"),B(),z(23,"li"),q(24,"\u{1f512} Verified listings to ensure trust and accuracy"),B(),z(25,"li"),q(26,"\u{1f4de} Direct contact between buyers, renters, and owners"),B(),z(27,"li"),q(28,"\u{1f4a1} Smart search filters for tailored results"),B()()(),z(29,"div",5),$e(30,"img",6),B()()(),z(31,"section",7)(32,"div",8)(33,"div",9)(34,"h3"),q(35,"500+"),B(),z(36,"p"),q(37,"Properties Listed"),B()(),z(38,"div",9)(39,"h3"),q(40,"1000+"),B(),z(41,"p"),q(42,"Satisfied Clients"),B()(),z(43,"div",9)(44,"h3"),q(45,"20+"),B(),z(46,"p"),q(47,"Cities Covered"),B()(),z(48,"div",9)(49,"h3"),q(50,"99%"),B(),z(51,"p"),q(52,"Customer Satisfaction"),B()()()())},dependencies:[z2],styles:["[_ngcontent-%COMP%]:root{--primary: #4DB299;--text: #333;--bg-light: #f4f8f9;--white: #fff}body[_ngcontent-%COMP%]{margin:0;font-family:Segoe UI,sans-serif;background-color:var(--bg-light);color:var(--text)}.about-hero[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4DB299 0%,#3c9f80 100%);color:var(--white);text-align:center;padding:80px 20px}.about-hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:48px;margin-bottom:10px;letter-spacing:1px}.about-hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;opacity:.9}.about-content[_ngcontent-%COMP%]{padding:60px 20px}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:40px;align-items:center}.about-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:28px;color:var(--primary);margin-top:30px}.about-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:1.7;margin-top:10px}.about-text[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:20px;padding-left:20px}.about-text[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:16px;margin-bottom:10px}.about-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;border-radius:10px;box-shadow:0 12px 30px #0000001a}.about-stats[_ngcontent-%COMP%]{background-color:var(--white);padding:60px 20px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:30px;text-align:center}.stat-box[_ngcontent-%COMP%]{padding:20px;background-color:var(--bg-light);border-radius:10px;transition:transform .3s ease}.stat-box[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.stat-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:36px;color:var(--primary)}.stat-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px;font-size:16px;color:#555}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.about-hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:36px}}"]})}}return t})(),Rne=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-service"]],decls:51,vars:0,consts:[[1,"services-hero"],[1,"container"],[1,"services-list"],[1,"container","services-grid"],[1,"service-card"],[1,"icon-box"],[1,"lni","lni-home"],[1,"lni","lni-map-marker"],[1,"lni","lni-users"],[1,"lni","lni-graph"],[1,"lni","lni-calendar"],[1,"lni","lni-support"]],template:function(i,r){1&i&&($e(0,"app-header"),z(1,"section",0)(2,"div",1)(3,"h1"),q(4,"Our Services"),B(),z(5,"p"),q(6,"Helping you navigate Tunisia\u2019s real estate market with ease, innovation, and trust."),B()()(),z(7,"section",2)(8,"div",3)(9,"div",4)(10,"div",5),$e(11,"i",6),B(),z(12,"h3"),q(13,"Property Listings"),B(),z(14,"p"),q(15,"Access verified listings for rent and sale across Tunisia. Filter by price, region, and property type easily."),B()(),z(16,"div",4)(17,"div",5),$e(18,"i",7),B(),z(19,"h3"),q(20,"Location-Based Search"),B(),z(21,"p"),q(22,"Find properties near your desired location using smart map integration and interactive filters."),B()(),z(23,"div",4)(24,"div",5),$e(25,"i",8),B(),z(26,"h3"),q(27,"Owner & Agent Profiles"),B(),z(28,"p"),q(29,"Connect with trusted owners and certified real estate agents. Transparency and trust are guaranteed."),B()(),z(30,"div",4)(31,"div",5),$e(32,"i",9),B(),z(33,"h3"),q(34,"Market Insights"),B(),z(35,"p"),q(36,"Stay ahead of market trends with price analytics, location stats, and the latest updates."),B()(),z(37,"div",4)(38,"div",5),$e(39,"i",10),B(),z(40,"h3"),q(41,"Online Booking"),B(),z(42,"p"),q(43,"Schedule property visits or book rentals online with real-time availability tracking."),B()(),z(44,"div",4)(45,"div",5),$e(46,"i",11),B(),z(47,"h3"),q(48,"24/7 Support"),B(),z(49,"p"),q(50,"Have questions or issues? Our support team is available around the clock to help you out."),B()()()())},dependencies:[z2],styles:["[_ngcontent-%COMP%]:root{--primary: #4DB299;--text: #333;--bg-light: #f4f8f9;--white: #fff}.services-hero[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4DB299 0%,#3c9f80 100%);color:var(--white);text-align:center;padding:80px 20px}.services-hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:48px;margin-bottom:10px}.services-hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;opacity:.9}.services-list[_ngcontent-%COMP%]{padding:60px 20px;background-color:var(--bg-light)}.services-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:30px}.service-card[_ngcontent-%COMP%]{background-color:var(--white);border-radius:12px;padding:30px 25px;text-align:center;box-shadow:0 8px 25px #0000000d;transition:transform .3s ease,box-shadow .3s ease}.service-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 12px 30px #00000014}.icon-box[_ngcontent-%COMP%]{font-size:40px;color:var(--primary);margin-bottom:20px}.service-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;margin-bottom:12px;color:var(--primary)}.service-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:15px;color:#555;line-height:1.6}@media (max-width: 768px){.services-hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:36px}}"]})}}return t})();function Lne(t,n){if(1&t&&$e(0,"img",16),2&t){const e=ht(2);ye("src",e.getImageUrl((null==e.user?null:e.user.profileImage)||""),fs)}}function Fne(t,n){if(1&t&&(z(0,"div",17)(1,"span"),q(2),B()()),2&t){const e=ht(2);ne(2),Qe(null==e.user||null==e.user.name?null:e.user.name[0])}}function zne(t,n){if(1&t&&(z(0,"div",2)(1,"div",3)(2,"div",4),He(3,Lne,1,1,"img",5),He(4,Fne,3,1,"ng-template",null,6,Tf),z(6,"span",7),q(7),B()(),z(8,"div",8),q(9,"Profile"),B(),z(10,"button",9),q(11,"\xd7"),B()(),z(12,"div",10)(13,"div",11)(14,"div",12)(15,"h3"),q(16,"First Name"),B(),z(17,"p",13),q(18),B()(),z(19,"div",12)(20,"h3"),q(21,"Last Name"),B(),z(22,"p",13),q(23),B()(),z(24,"div",12)(25,"h3"),q(26,"Email"),B(),z(27,"p",13),q(28),B()(),z(29,"div",12)(30,"h3"),q(31,"Phone Number"),B(),z(32,"p",13),q(33),B()(),z(34,"div",14)(35,"button",15),q(36,"Edit Profile"),B()()()()()),2&t){const e=Fa(5),i=ht();ne(3),ye("ngIf",null==i.user?null:i.user.profileImage)("ngIfElse",e),ne(4),Yt("",null==i.user?null:i.user.name," ",null==i.user?null:i.user.lastName,""),ne(11),Qe(null==i.user?null:i.user.name),ne(5),Qe(null==i.user?null:i.user.lastName),ne(5),Qe(null==i.user?null:i.user.email),ne(5),Qe((null==i.user?null:i.user.phoneNumber)||"Not provided")}}function Nne(t,n){1&t&&(z(0,"div",18)(1,"span"),q(2,"Loading..."),B()())}let Bne=(()=>{class t{constructor(e,i){this.userService=e,this.router=i,this.user=null,this.loading=!0,this.firstName="",this.lastName=""}ngOnInit(){this.userService.getUserProfile().subscribe({next:e=>{this.user=e,this.firstName=this.user.name||"",this.lastName=this.user.lastName||"",this.loading=!1},error:e=>{console.error("Failed to load user profile",e),this.loading=!1}})}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"assets/default-avatar.png"}navigateToSettings(){this.router.navigate(["/settings"])}static{this.\u0275fac=function(i){return new(i||t)(st(zf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-profile"]],decls:2,vars:2,consts:[["class","settings-container",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"settings-container"],[1,"profile-header"],[1,"user-info"],["class","profile-avatar","alt","Profile Picture",3,"src",4,"ngIf","ngIfElse"],["defaultImage",""],[1,"user-name"],[1,"account-title"],["routerLink","/home",1,"close-button"],[1,"content-container"],[1,"main-content"],[1,"profile-section"],[1,"read-only-value"],[1,"footer-actions"],["routerLink","/settings",1,"save-button"],["alt","Profile Picture",1,"profile-avatar",3,"src"],[1,"profile-avatar-placeholder"],[1,"loading-spinner"]],template:function(i,r){1&i&&(He(0,zne,37,8,"div",0),He(1,Nne,3,0,"div",1)),2&i&&(ye("ngIf",!r.loading),ne(1),ye("ngIf",r.loading))},dependencies:[wo,od],styles:[".settings-container[_ngcontent-%COMP%]{max-width:1200px;margin:2rem auto;padding:2rem;background-color:#fff;border-radius:16px;box-shadow:0 2px 16px #0000000d;font-family:Arial,sans-serif}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #eee;padding-bottom:1.5rem;margin-bottom:2rem}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.profile-avatar[_ngcontent-%COMP%], .main-profile-image[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover}.profile-avatar-placeholder[_ngcontent-%COMP%], .main-profile-placeholder[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;background-color:#f3f3f3;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:24px;color:#555}.user-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.account-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.close-button[_ngcontent-%COMP%]{background:transparent;border:none;font-size:2rem;cursor:pointer;color:#888}.content-container[_ngcontent-%COMP%]{display:flex;gap:2rem}.sidebar[_ngcontent-%COMP%]{width:250px;border-right:1px solid #eee;padding-right:1rem}.sidebar-section[_ngcontent-%COMP%]{margin-bottom:2rem}.section-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:1rem;font-size:.9rem;color:#555}.menu-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-radius:8px;transition:background .2s;cursor:pointer;font-size:.95rem;color:#333}.menu-item.active[_ngcontent-%COMP%], .menu-item[_ngcontent-%COMP%]:hover{background-color:#f7f7f7}.main-content[_ngcontent-%COMP%]{flex:1}.profile-section[_ngcontent-%COMP%]{margin-bottom:2rem}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.5rem;font-weight:600}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #ccc;border-radius:12px;font-size:1rem;transition:border .2s}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#333}.invalid[_ngcontent-%COMP%]{border-color:#ff4d4f}.validation-error[_ngcontent-%COMP%]{color:#ff4d4f;font-size:.85rem;margin-top:.25rem}.name-container[_ngcontent-%COMP%]{display:flex;gap:1rem}.name-field[_ngcontent-%COMP%]{flex:1}.profile-picture-container[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center}.image-wrapper[_ngcontent-%COMP%]{width:80px;height:80px}.image-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.upload-button[_ngcontent-%COMP%]{cursor:pointer;color:#fff;background-color:#333;padding:.5rem 1rem;border-radius:12px;font-size:.9rem}.remove-button[_ngcontent-%COMP%]{background:transparent;border:1px solid #ccc;padding:.5rem 1rem;border-radius:12px;cursor:pointer;font-size:.9rem}.upload-info[_ngcontent-%COMP%]{font-size:.75rem;color:#888}.password-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.password-fields[_ngcontent-%COMP%]{margin-top:1rem}.password-field[_ngcontent-%COMP%]{margin-bottom:1rem}.change-password-button[_ngcontent-%COMP%]{background:none;border:none;color:#007bff;cursor:pointer;font-weight:500}.footer-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}.cancel-button[_ngcontent-%COMP%], .save-button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:12px;font-weight:600;font-size:.95rem;cursor:pointer}.cancel-button[_ngcontent-%COMP%]{background:#f3f3f3;color:#333}.save-button[_ngcontent-%COMP%]{background:#4DB299;color:#fff}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem;font-size:1.25rem;font-weight:500}.read-only-value[_ngcontent-%COMP%]{padding:.75rem 1rem;background-color:#f9f9f9;border-radius:8px;border:1px solid #e0e0e0;font-size:1rem;color:#333;margin-top:.25rem}"]})}}return t})();function Vne(t,n){if(1&t&&$e(0,"img",38),2&t){const e=ht(2);ye("src",e.getImageUrl((null==e.user?null:e.user.profileImage)||""),fs)}}function jne(t,n){if(1&t&&(z(0,"div",39)(1,"span"),q(2),B()()),2&t){const e=ht(2);let i;ne(2),Qe(null==(i=e.userForm.get("name"))?null:i.value[0])}}function Hne(t,n){1&t&&$e(0,"img",40),2&t&&ye("src",ht(2).profileImagePreview,fs)}function Une(t,n){if(1&t&&(z(0,"div",41)(1,"span"),q(2),B()()),2&t){const e=ht(2);let i;ne(2),Qe(null==(i=e.userForm.get("name"))?null:i.value[0])}}function qne(t,n){1&t&&(z(0,"div",42),q(1," First name is required "),B())}function $ne(t,n){1&t&&(z(0,"div",42),q(1," Last name is required "),B())}function Gne(t,n){1&t&&(z(0,"div",42),q(1," Please enter a valid email address "),B())}function Wne(t,n){1&t&&(z(0,"div",42),q(1," Current password is required "),B())}function Zne(t,n){1&t&&(z(0,"div",42),q(1," Password must be at least 8 characters "),B())}function Yne(t,n){1&t&&(z(0,"div",42),q(1," Passwords do not match "),B())}const N2=function(t){return{invalid:t}};function Xne(t,n){if(1&t&&(z(0,"div",43)(1,"div",44)(2,"h3"),q(3,"Current Password"),B(),$e(4,"input",45),He(5,Wne,2,0,"div",26),B(),z(6,"div",44)(7,"h3"),q(8,"New Password"),B(),$e(9,"input",46),He(10,Zne,2,0,"div",26),B(),z(11,"div",44)(12,"h3"),q(13,"Confirm New Password"),B(),$e(14,"input",47),He(15,Yne,2,0,"div",26),B()()),2&t){const e=ht(2);let i,r,s,c,f,y;ye("formGroup",e.passwordForm),ne(4),ye("ngClass",Gr(7,N2,(null==(i=e.passwordForm.get("currentPassword"))?null:i.invalid)&&(null==(i=e.passwordForm.get("currentPassword"))?null:i.touched))),ne(1),ye("ngIf",(null==(r=e.passwordForm.get("currentPassword"))?null:r.invalid)&&(null==(r=e.passwordForm.get("currentPassword"))?null:r.touched)),ne(4),ye("ngClass",Gr(9,N2,(null==(s=e.passwordForm.get("newPassword"))?null:s.invalid)&&(null==(s=e.passwordForm.get("newPassword"))?null:s.touched))),ne(1),ye("ngIf",(null==(c=e.passwordForm.get("newPassword"))?null:c.invalid)&&(null==(c=e.passwordForm.get("newPassword"))?null:c.touched)),ne(4),ye("ngClass",Gr(11,N2,(null==(f=e.passwordForm.get("confirmPassword"))?null:f.value)!==(null==(f=e.passwordForm.get("newPassword"))?null:f.value)&&(null==(f=e.passwordForm.get("confirmPassword"))?null:f.touched))),ne(1),ye("ngIf",(null==(y=e.passwordForm.get("confirmPassword"))?null:y.value)!==(null==(y=e.passwordForm.get("newPassword"))?null:y.value)&&(null==(y=e.passwordForm.get("confirmPassword"))?null:y.touched))}}function Kne(t,n){if(1&t){const e=Ki();z(0,"div",2)(1,"div",3)(2,"div",4),He(3,Vne,1,1,"img",5),He(4,jne,3,1,"ng-template",null,6,Tf),z(6,"span",7),q(7),B()(),z(8,"div",8),q(9,"Settings"),B(),z(10,"button",9),qt("click",function(){return An(e),Mn(ht().cancel())}),q(11,"\xd7"),B()(),z(12,"div",10)(13,"div",11)(14,"form",12),qt("ngSubmit",function(){return An(e),Mn(ht().onSubmit())}),z(15,"div",13)(16,"h3"),q(17,"Profile Picture"),B(),z(18,"div",14)(19,"div",15),He(20,Hne,1,1,"img",16),He(21,Une,3,1,"ng-template",null,17,Tf),B(),z(23,"div",18)(24,"label",19)(25,"span"),q(26,"Upload Image"),B(),z(27,"input",20),qt("change",function(r){return An(e),Mn(ht().onFileSelected(r))}),B()(),z(28,"button",21),qt("click",function(){return An(e),Mn(ht().removeProfileImage())}),q(29," Remove "),B(),z(30,"p",22),q(31,"We support JPEGs, JPGs and GIFs under 10MB"),B()()()(),z(32,"div",13)(33,"div",23)(34,"div",24)(35,"h3"),q(36,"First Name"),B(),$e(37,"input",25),He(38,qne,2,0,"div",26),B(),z(39,"div",24)(40,"h3"),q(41,"Last Name"),B(),$e(42,"input",27),He(43,$ne,2,0,"div",26),B()()(),z(44,"div",13)(45,"h3"),q(46,"Email"),B(),$e(47,"input",28),He(48,Gne,2,0,"div",26),z(49,"p",29),q(50,"Used to log in to your account"),B()(),z(51,"div",13)(52,"h3"),q(53,"Phone Number"),B(),$e(54,"input",30),B(),z(55,"div",13)(56,"div",31)(57,"div")(58,"h3"),q(59,"Password"),B(),z(60,"p",32),q(61,"Log in with your password instead of using temporary login codes"),B()(),z(62,"button",33),qt("click",function(){return An(e),Mn(ht().togglePasswordFields())}),q(63),B()(),He(64,Xne,16,13,"div",34),B(),z(65,"div",35)(66,"button",36),qt("click",function(){return An(e),Mn(ht().cancel())}),q(67,"Cancel"),B(),z(68,"button",37),q(69,"Save"),B()()()()()()}if(2&t){const e=Fa(5),i=Fa(22),r=ht();let s,c,f,y,k,E,F;ne(3),ye("ngIf",r.profileImagePreview)("ngIfElse",e),ne(4),Yt("",null==(s=r.userForm.get("name"))?null:s.value," ",null==(s=r.userForm.get("lastName"))?null:s.value,""),ne(7),ye("formGroup",r.userForm),ne(6),ye("ngIf",r.profileImagePreview)("ngIfElse",i),ne(8),ye("disabled",!r.profileImagePreview),ne(9),ye("ngClass",Gr(17,N2,(null==(c=r.userForm.get("name"))?null:c.invalid)&&(null==(c=r.userForm.get("name"))?null:c.touched))),ne(1),ye("ngIf",(null==(f=r.userForm.get("name"))?null:f.invalid)&&(null==(f=r.userForm.get("name"))?null:f.touched)),ne(4),ye("ngClass",Gr(19,N2,(null==(y=r.userForm.get("lastName"))?null:y.invalid)&&(null==(y=r.userForm.get("lastName"))?null:y.touched))),ne(1),ye("ngIf",(null==(k=r.userForm.get("lastName"))?null:k.invalid)&&(null==(k=r.userForm.get("lastName"))?null:k.touched)),ne(4),ye("ngClass",Gr(21,N2,(null==(E=r.userForm.get("email"))?null:E.invalid)&&(null==(E=r.userForm.get("email"))?null:E.touched))),ne(1),ye("ngIf",(null==(F=r.userForm.get("email"))?null:F.invalid)&&(null==(F=r.userForm.get("email"))?null:F.touched)),ne(15),Ft(" ",r.showPasswordFields?"Cancel":"Change Password"," "),ne(1),ye("ngIf",r.showPasswordFields),ne(4),ye("disabled",r.userForm.invalid||r.showPasswordFields&&r.passwordForm.invalid)}}function Qne(t,n){1&t&&(z(0,"div",48)(1,"span"),q(2,"Loading..."),B()())}let Jne=(()=>{class t{constructor(e,i,r){this.userService=e,this.formBuilder=i,this.router=r,this.user=null,this.loading=!0,this.showPasswordFields=!1,this.profileImageFile=null,this.profileImagePreview=null,this.userForm=this.formBuilder.group({name:["",Gi.required],lastName:["",Gi.required],email:["",[Gi.required,Gi.email]],phoneNumber:[""]}),this.passwordForm=this.formBuilder.group({currentPassword:["",Gi.required],newPassword:["",[Gi.required,Gi.minLength(8)]],confirmPassword:["",Gi.required]})}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}ngOnInit(){this.userService.getUserProfile().subscribe({next:e=>{this.user=e,this.profileImagePreview=this.userService.getImageUrl(this.user.profileImage),this.userForm.patchValue({name:this.user.name,lastName:this.user.lastName,email:this.user.email,phoneNumber:this.user.phoneNumber||""}),this.user.profileImage&&(this.profileImagePreview=this.user.profileImage),this.loading=!1},error:e=>{console.error("Failed to load user profile",e),this.loading=!1}})}onFileSelected(e){const i=e.target;if(i.files&&i.files.length){const r=i.files[0];if(r.size>10485760)return void alert("File size should be less than 10MB");this.profileImageFile=r;const s=new FileReader;s.onload=()=>{this.profileImagePreview=s.result},s.readAsDataURL(r)}}togglePasswordFields(){this.showPasswordFields=!this.showPasswordFields,this.showPasswordFields||this.passwordForm.reset()}onSubmit(){if(console.log("User Form:",this.userForm.value),this.userForm.invalid)return this.showPasswordFields&&this.passwordForm.value.newPassword!==this.passwordForm.value.confirmPassword?void alert("New password and confirmation do not match."):void this.userForm.markAllAsTouched();if(this.showPasswordFields&&this.passwordForm.invalid)return void this.passwordForm.markAllAsTouched();const i=this.showPasswordFields&&this.passwordForm.valid;if(null!==this.profileImageFile){const r=new FormData;r.append("name",this.userForm.value.name),r.append("lastName",this.userForm.value.lastName),r.append("email",this.userForm.value.email),this.userForm.value.phoneNumber&&r.append("phoneNumber",this.userForm.value.phoneNumber),r.append("file",this.profileImageFile),this.userService.updateUserProfileWithImage(r).subscribe({next:s=>{console.log("Profile updated successfully",s),i?this.updatePassword():(alert("Profile updated successfully!"),this.router.navigate(["/profile"]))},error:s=>{console.error("Error updating profile",s),alert("Error updating profile. Please try again.")}})}else{const r=new FormData;r.append("name",this.userForm.value.name),r.append("lastName",this.userForm.value.lastName),r.append("email",this.userForm.value.email),this.userForm.value.phoneNumber&&r.append("phoneNumber",this.userForm.value.phoneNumber),this.userService.updateUserProfileWithImage(r).subscribe({next:s=>{console.log("Profile updated successfully",s),i?this.updatePassword():(alert("Profile updated successfully!"),this.router.navigate(["/profile"]))},error:s=>{console.error("Error updating profile",s),alert("Error updating profile. Please try again.")}})}}updatePassword(){this.userService.changePassword({currentPassword:this.passwordForm.value.currentPassword,newPassword:this.passwordForm.value.newPassword}).subscribe({next:()=>{alert("Profile and password updated successfully!"),this.router.navigate(["/profile"])},error:i=>{console.error("Error updating password",i),alert("Profile updated but there was an error updating password. Please try again."),this.router.navigate(["/profile"])}})}removeProfileImage(){this.profileImagePreview&&!this.profileImageFile?this.userService.removeProfileImage().subscribe({next:()=>{this.profileImagePreview=null,console.log("Profile image removed successfully")},error:e=>{console.error("Error removing profile image",e),alert("Error removing profile image. Please try again.")}}):(this.profileImageFile=null,this.profileImagePreview=this.user?.profileImage||null)}cancel(){this.router.navigate(["/profile"])}static{this.\u0275fac=function(i){return new(i||t)(st(zf),st(Ep),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-user-settings"]],decls:2,vars:2,consts:[["class","settings-container",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"settings-container"],[1,"profile-header"],[1,"user-info"],["class","profile-avatar","alt","Profile Picture",3,"src",4,"ngIf","ngIfElse"],["defaultImage",""],[1,"user-name"],[1,"account-title"],[1,"close-button",3,"click"],[1,"content-container"],[1,"main-content"],[3,"formGroup","ngSubmit"],[1,"profile-section"],[1,"profile-picture-container"],[1,"image-wrapper"],["class","main-profile-image","alt","Profile Picture",3,"src",4,"ngIf","ngIfElse"],["mainDefaultImage",""],[1,"image-actions"],[1,"upload-button"],["type","file","accept","image/jpeg,image/jpg,image/gif",2,"display","none",3,"change"],["type","button",1,"remove-button",3,"disabled","click"],[1,"upload-info"],[1,"name-container"],[1,"name-field"],["type","text","formControlName","name",1,"form-input",3,"ngClass"],["class","validation-error",4,"ngIf"],["type","text","formControlName","lastName",1,"form-input",3,"ngClass"],["type","email","formControlName","email",1,"form-input",3,"ngClass"],[1,"email-info"],["type","tel","formControlName","phoneNumber",1,"form-input"],[1,"password-container"],[1,"password-info"],["type","button",1,"change-password-button",3,"click"],["class","password-fields",3,"formGroup",4,"ngIf"],[1,"footer-actions"],["type","button",1,"cancel-button",3,"click"],["type","submit",1,"save-button",3,"disabled"],["alt","Profile Picture",1,"profile-avatar",3,"src"],[1,"profile-avatar-placeholder"],["alt","Profile Picture",1,"main-profile-image",3,"src"],[1,"main-profile-placeholder"],[1,"validation-error"],[1,"password-fields",3,"formGroup"],[1,"password-field"],["type","password","formControlName","currentPassword",1,"form-input",3,"ngClass"],["type","password","formControlName","newPassword",1,"form-input",3,"ngClass"],["type","password","formControlName","confirmPassword",1,"form-input",3,"ngClass"],[1,"loading-spinner"]],template:function(i,r){1&i&&(He(0,Kne,70,23,"div",0),He(1,Qne,3,0,"div",1)),2&i&&(ye("ngIf",!r.loading),ne(1),ye("ngIf",r.loading))},dependencies:[ha,wo,Zh,hl,Wl,Pc,Ic,wh],styles:[".settings-container[_ngcontent-%COMP%]{max-width:1200px;margin:2rem auto;padding:2rem;background-color:#fff;border-radius:16px;box-shadow:0 2px 16px #0000000d;font-family:Arial,sans-serif}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #eee;padding-bottom:1.5rem;margin-bottom:2rem}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.profile-avatar[_ngcontent-%COMP%], .main-profile-image[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;object-fit:cover}.profile-avatar-placeholder[_ngcontent-%COMP%], .main-profile-placeholder[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:50%;background-color:#f3f3f3;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:24px;color:#555}.user-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.account-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600}.close-button[_ngcontent-%COMP%]{background:transparent;border:none;font-size:2rem;cursor:pointer;color:#888}.content-container[_ngcontent-%COMP%]{display:flex;gap:2rem}.sidebar[_ngcontent-%COMP%]{width:250px;border-right:1px solid #eee;padding-right:1rem}.sidebar-section[_ngcontent-%COMP%]{margin-bottom:2rem}.section-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:1rem;font-size:.9rem;color:#555}.menu-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-radius:8px;transition:background .2s;cursor:pointer;font-size:.95rem;color:#333}.menu-item.active[_ngcontent-%COMP%], .menu-item[_ngcontent-%COMP%]:hover{background-color:#f7f7f7}.main-content[_ngcontent-%COMP%]{flex:1}.profile-section[_ngcontent-%COMP%]{margin-bottom:2rem}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.5rem;font-weight:600}.form-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #ccc;border-radius:12px;font-size:1rem;transition:border .2s}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#333}.invalid[_ngcontent-%COMP%]{border-color:#4db299}.validation-error[_ngcontent-%COMP%]{color:#4db299;font-size:.85rem;margin-top:.25rem}.name-container[_ngcontent-%COMP%]{display:flex;gap:1rem}.name-field[_ngcontent-%COMP%]{flex:1}.profile-picture-container[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center}.image-wrapper[_ngcontent-%COMP%]{width:80px;height:80px}.image-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.upload-button[_ngcontent-%COMP%]{cursor:pointer;color:#fff;background-color:#333;padding:.5rem 1rem;border-radius:12px;font-size:.9rem}.remove-button[_ngcontent-%COMP%]{background:transparent;border:1px solid #ccc;padding:.5rem 1rem;border-radius:12px;cursor:pointer;font-size:.9rem}.upload-info[_ngcontent-%COMP%]{font-size:.75rem;color:#888}.password-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.password-fields[_ngcontent-%COMP%]{margin-top:1rem}.password-field[_ngcontent-%COMP%]{margin-bottom:1rem}.change-password-button[_ngcontent-%COMP%]{background:none;border:none;color:#007bff;cursor:pointer;font-weight:500}.footer-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}.cancel-button[_ngcontent-%COMP%], .save-button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:12px;font-weight:600;font-size:.95rem;cursor:pointer}.cancel-button[_ngcontent-%COMP%]{background:#f3f3f3;color:#333}.save-button[_ngcontent-%COMP%]{background:#4DB299;color:#fff}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem;font-size:1.25rem;font-weight:500}"]})}}return t})();class xF{}class eie{}const Qm="*";function O1(t,n){return{type:7,name:t,definitions:n,options:{}}}function zu(t,n=null){return{type:4,styles:n,timings:t}}function kF(t,n=null){return{type:2,steps:t,options:n}}function Za(t){return{type:6,styles:t,offset:null}}function Yh(t,n,e=null){return{type:1,expr:t,animation:n,options:e}}function $4(t,n,e=null){return{type:11,selector:t,animation:n,options:e}}function tie(t,n){return{type:12,timings:t,animation:n}}class bk{constructor(n=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){const e="start"==n?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class CF{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let e=0,i=0,r=0;const s=this.players.length;0==s?queueMicrotask(()=>this._onFinish()):this.players.forEach(c=>{c.onDone(()=>{++e==s&&this._onFinish()}),c.onDestroy(()=>{++i==s&&this._onDestroy()}),c.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((c,f)=>Math.max(c,f.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){const e=n*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const n=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=n?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){const e="start"==n?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function nie(t,n){1&t&&(z(0,"div",7),q(1,"Loading appointments..."),B())}function iie(t,n){1&t&&(z(0,"div",8),q(1," No appointments found. "),B())}function rie(t,n){if(1&t&&(z(0,"span"),q(1),B()),2&t){const e=ht().$implicit;ne(1),Ft(" - ",e.propertysubcity,"")}}function oie(t,n){if(1&t&&(z(0,"p",20),$e(1,"i",25),q(2),B()),2&t){const e=ht().$implicit;ne(2),Ft(" ",e.message," ")}}function sie(t,n){if(1&t&&(z(0,"div",9)(1,"div",10),$e(2,"div",11),B(),z(3,"div",12)(4,"div",13)(5,"div",14)(6,"div")(7,"h5",15),q(8),B(),z(9,"small",16),q(10),He(11,rie,2,1,"span",17),B()(),z(12,"span",18),q(13),B()(),z(14,"div",19)(15,"p",20),$e(16,"i",21),q(17),B(),He(18,oie,3,1,"p",22),z(19,"p",23),$e(20,"i",24),q(21),B()()()()()),2&t){const e=n.$implicit,i=ht();ne(2),ye("ngClass",i.getStatusClass(e.status)),ne(6),Qe(e.propertyTitle),ne(2),Ft(" ",e.propertycity," "),ne(1),ye("ngIf",e.propertysubcity),ne(1),ye("ngClass",i.getStatusBadgeClass(e.status)),ne(1),Ft(" ",i.formatStatus(e.status)," "),ne(4),Yt(" ",e.appointmentDate," at ",e.appointmentTime," "),ne(1),ye("ngIf",e.message),ne(3),Ft(" Property ID: ",e.propertyId," ")}}let aie=(()=>{class t{constructor(e,i){this.propertyService=e,this.appointments=[],this.isLoading=!0}ngOnInit(){this.propertyService.getUserAppointments().subscribe({next:e=>{this.appointments=e,this.isLoading=!1},error:()=>{this.isLoading=!1,console.error("Failed to load appointments")}})}formatStatus(e){return e?"approved"===e?"Confirmed":e.charAt(0).toUpperCase()+e.slice(1):""}getStatusBadgeClass(e){switch(e){case"pending":return"pending";case"confirmed":case"approved":return"confirmed";case"canceled":return"cancelled";default:return""}}getStatusClass(e){return`marker-${"approved"===e?"confirmed":e}`}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(zf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-my-appointments"]],decls:8,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-9","col-lg-10","mt-4","px-4"],[1,"mb-4"],["class","text-center",4,"ngIf"],["class","text-muted text-center",4,"ngIf"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"text-center"],[1,"text-muted","text-center"],[1,"timeline-item"],[1,"timeline-marker"],[3,"ngClass"],[1,"timeline-content","card","shadow-sm"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"card-title","mb-0"],[1,"text-muted"],[4,"ngIf"],[1,"badge",3,"ngClass"],[1,"appointment-details"],[1,"mb-1"],[1,"bi","bi-calendar-event"],["class","mb-1",4,"ngIf"],[1,"mb-0"],[1,"bi","bi-house-door"],[1,"bi","bi-chat-left-text"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),q(4,"My Appointments"),B(),He(5,nie,2,0,"div",4),He(6,iie,2,0,"div",5),He(7,sie,22,10,"div",6),B()()()),2&i&&(ne(5),ye("ngIf",r.isLoading),ne(1),ye("ngIf",!r.isLoading&&0===r.appointments.length),ne(1),ye("ngForOf",r.appointments))},dependencies:[ha,qs,wo],styles:['.container-fluid[_ngcontent-%COMP%]{max-width:100rem;margin:2rem auto;padding:0 1rem}app-sidebar[_ngcontent-%COMP%]{height:100vh;background-color:#f8f9fa;border-right:1px solid #e0e0e0}.timeline-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-bottom:2rem;position:relative}.timeline-marker[_ngcontent-%COMP%]{position:relative;margin-right:20px}.timeline-marker[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;border:3px solid white;position:relative;top:10px}.timeline-marker[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:7px;width:3px;height:100%;background-color:#ddd;z-index:-1}.card[_ngcontent-%COMP%]{width:100%;border-left:5px solid transparent;transition:transform .2s,box-shadow .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 15px #0000001a}.card-body[_ngcontent-%COMP%]{padding:1rem 1.25rem}.badge[_ngcontent-%COMP%]{text-transform:capitalize;padding:.35rem .6rem;font-size:.75rem}.appointment-details[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}.pending[_ngcontent-%COMP%]{background-color:#ffc107}.confirmed[_ngcontent-%COMP%]{background-color:#198754}.cancelled[_ngcontent-%COMP%]{background-color:#dc3545}.approved[_ngcontent-%COMP%]{background-color:#198754}.marker-pending[_ngcontent-%COMP%]{background-color:#ffc107}.marker-confirmed[_ngcontent-%COMP%], .marker-approved[_ngcontent-%COMP%]{background-color:#198754}.marker-cancelled[_ngcontent-%COMP%]{background-color:#dc3545}@media (max-width: 768px){.timeline-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.timeline-marker[_ngcontent-%COMP%]{margin:0 0 10px}.timeline-marker[_ngcontent-%COMP%]:after{left:50%;transform:translate(-50%);height:3px;width:100%}.card-body[_ngcontent-%COMP%]{padding:.75rem}.badge[_ngcontent-%COMP%]{font-size:.7rem;padding:.3rem .5rem}app-sidebar[_ngcontent-%COMP%]{position:relative;width:100%;height:auto;border-right:none;border-bottom:1px solid #e0e0e0}}'],data:{animation:[O1("listAnimation",[Yh("* => *",[$4(":enter",[Za({opacity:0,transform:"translateY(20px)"}),tie(100,[zu("300ms ease-out",Za({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])])]}})}}return t})();function lie(t,n){1&t&&(z(0,"div",5),q(1," No bookings found. "),B())}const cie=function(t,n,e){return{"bg-orange":t,"bg-green":n,"bg-red":e}};function die(t,n){if(1&t&&(z(0,"span",18),q(1),ks(2,"titlecase"),B()),2&t){const e=ht().$implicit;ye("ngClass",Pw(4,cie,"pending"===e.status,"approved"===e.status,"rejected"===e.status)),ne(1),Ft(" ",Iu(2,2,e.status),"\n")}}function hie(t,n){if(1&t&&(z(0,"div",6)(1,"div",7),$e(2,"div",8),B(),z(3,"div",9)(4,"div",10)(5,"div",11)(6,"div")(7,"h5",12),q(8),B(),z(9,"small",13),q(10),B()(),He(11,die,3,8,"span",14),B(),z(12,"div",15)(13,"p",16),$e(14,"i",17),q(15),B()()()()()),2&t){const e=n.$implicit,i=ht();ne(2),ye("ngClass",i.getStatusClass(e.status)),ne(6),Ft("Property ID: ",e.propertyId,""),ne(2),Yt(" From: ",e.startDate," To: ",e.endDate," "),ne(1),ye("ngIf",e.status),ne(4),Yt(" From ",e.startDate," to ",e.endDate," ")}}let uie=(()=>{class t{constructor(e){this.propertyService=e,this.bookings=[],this.isLoading=!0}ngOnInit(){this.propertyService.getUserBookings().subscribe(e=>{this.bookings=e})}getStatusClass(e){if(!e)return"badge-secondary";switch(e){case"pending":return"badge-warning";case"approved":return"badge-success";case"cancelled":return"badge-danger";default:return""}}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-my-bookings"]],decls:6,vars:2,consts:[[1,"d-flex","container-fluid"],[1,"content-container","flex-grow-1","p-4"],[1,"mb-4"],["class","text-muted text-center",4,"ngIf"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"text-muted","text-center"],[1,"timeline-item"],[1,"timeline-marker"],[3,"ngClass"],[1,"timeline-content","card","shadow-sm"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"card-title","mb-0"],[1,"text-muted"],["class","pill",3,"ngClass",4,"ngIf"],[1,"booking-details"],[1,"mb-1"],[1,"bi","bi-calendar-event"],[1,"pill",3,"ngClass"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"h2",2),q(3,"My Bookings"),B(),He(4,lie,2,0,"div",3),He(5,hie,16,7,"div",4),B()()),2&i&&(ne(4),ye("ngIf",!r.isLoading&&0===r.bookings.length),ne(1),ye("ngForOf",r.bookings))},dependencies:[ha,qs,wo,jw],styles:['.timeline-item[_ngcontent-%COMP%]{display:flex;margin-bottom:2rem;position:relative}.container-fluid[_ngcontent-%COMP%]{max-width:100rem;margin:2rem auto;padding:0 1rem}.timeline-marker[_ngcontent-%COMP%]{position:relative;margin-right:20px}.timeline-marker[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;border:3px solid white;position:relative;top:10px}.timeline-marker[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:7px;width:3px;height:100%;background-color:#ddd;z-index:-1}.card[_ngcontent-%COMP%]{width:100%;border-left:5px solid transparent;transition:transform .2s,box-shadow .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 15px #0000001a}.card-body[_ngcontent-%COMP%]{padding:1rem 1.25rem}.badge[_ngcontent-%COMP%]{text-transform:capitalize;padding:.35rem .6rem;font-size:.75rem}.booking-details[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}.pending[_ngcontent-%COMP%]{background-color:#ffc107}.approved[_ngcontent-%COMP%]{background-color:#198754}.cancelled[_ngcontent-%COMP%]{background-color:#dc3545}.marker-pending[_ngcontent-%COMP%]{background-color:#ffc107}.marker-approved[_ngcontent-%COMP%]{background-color:#198754}.marker-cancelled[_ngcontent-%COMP%]{background-color:#dc3545}.pill[_ngcontent-%COMP%]{padding:5px 10px;border-radius:15px;color:#fff;font-size:.9rem;display:inline-block}.bg-orange[_ngcontent-%COMP%]{background-color:orange}.bg-green[_ngcontent-%COMP%]{background-color:green}.bg-red[_ngcontent-%COMP%]{background-color:#dc143c}']})}}return t})();function pie(t,n){1&t&&(z(0,"h4"),q(1,"Welcome back"),B())}function fie(t,n){1&t&&(z(0,"div",25)(1,"h2"),q(2,"Owner controle center"),B()())}function mie(t,n){1&t&&(Ao(),Ns(),z(0,"span"),q(1,"Dashboard"),B())}function gie(t,n){1&t&&(z(0,"span"),q(1,"My Properties"),B())}function _ie(t,n){1&t&&(z(0,"span"),q(1,"Appointments"),B())}function yie(t,n){1&t&&(z(0,"span"),q(1,"Messages"),B())}function vie(t,n){1&t&&(z(0,"span"),q(1,"Bookings"),B())}function bie(t,n){1&t&&(z(0,"span"),q(1,"Home"),B())}function xie(t,n){if(1&t&&(z(0,"div",30)(1,"div",31),q(2),B(),z(3,"div",32),q(4),B()()),2&t){const e=ht(2);ne(2),Yt("",e.user.name," ",e.user.lastName," "),ne(2),Qe(e.user.email)}}function wie(t,n){if(1&t&&(z(0,"div",26)(1,"div",27),$e(2,"img",28),B(),He(3,xie,5,3,"div",29),B()),2&t){const e=ht();ne(2),ye("src",e.getImageUrl((null==e.user?null:e.user.profileImage)||""),fs),ne(1),ye("ngIf",!e.isCollapsed)}}const kie=function(t){return{collapsed:t}},Mie=function(t,n){return{"fa-chevron-left":t,"fa-chevron-right":n}};let Cie=(()=>{class t{constructor(e,i){this.authService=e,this.userService=i,this.isCollapsed=!1,this.currentUser=null}ngOnInit(){this.authService.currentUser$.subscribe(e=>{this.currentUser=e}),this.userService.getUserProfile().subscribe(e=>{this.user=e}),console.log(this.currentUser)}toggleSidebar(){this.isCollapsed=!this.isCollapsed}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}static{this.\u0275fac=function(i){return new(i||t)(st(Km),st(zf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-owner-sidebar"]],decls:31,vars:16,consts:[[1,"sidebar-container",3,"ngClass"],[1,"sidebar"],[1,"sidebar-header"],[1,"logo-container"],[4,"ngIf"],[1,"collapse-btn",3,"click"],[1,"fa",3,"ngClass"],["class","header-title",4,"ngIf"],[1,"sidebar-content"],[1,"nav-section"],["routerLink","/owner/owner-dash","routerLinkActive","active",1,"nav-link"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","id","dashboard"],["fill","none","d","M0 0h24v24H0V0z"],["d","M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"],["routerLink","/owner/properties","routerLinkActive","active",1,"nav-link"],[1,"fa-solid","fa-house-user"],["routerLink","/owner/calendar","routerLinkActive","active",1,"nav-link"],[1,"fa-duotone","fa-solid","fa-calendar-days"],["routerLink","/owner/messages","routerLinkActive","active",1,"nav-link"],[1,"fa-solid","fa-message"],["routerLink","/owner/bookings","routerLinkActive","active",1,"nav-link"],[1,"fa-solid","fa-calendar-plus"],["routerLink","/home","routerLinkActive","active",1,"nav-link"],[1,"fa-solid","fa-house"],["class","sidebar-footer",4,"ngIf"],[1,"header-title"],[1,"sidebar-footer"],[1,"user-avatar-container"],[1,"user-avatar",3,"src"],["class","user-info",4,"ngIf"],[1,"user-info"],[1,"user-name"],[1,"user-email"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),He(4,pie,2,0,"h4",4),z(5,"button",5),qt("click",function(){return r.toggleSidebar()}),$e(6,"i",6),B()(),He(7,fie,3,0,"div",7),B(),z(8,"div",8)(9,"nav",9)(10,"a",10),Ao(),z(11,"svg",11),$e(12,"path",12)(13,"path",13),B(),He(14,mie,2,0,"span",4),B(),Ns(),z(15,"a",14),$e(16,"i",15),He(17,gie,2,0,"span",4),B(),z(18,"a",16),$e(19,"i",17),He(20,_ie,2,0,"span",4),B(),z(21,"a",18),$e(22,"i",19),He(23,yie,2,0,"span",4),B(),z(24,"a",20),$e(25,"i",21),He(26,vie,2,0,"span",4),B(),z(27,"a",22),$e(28,"i",23),He(29,bie,2,0,"span",4),B()()(),He(30,wie,4,2,"div",24),B()()),2&i&&(ye("ngClass",Gr(11,kie,r.isCollapsed)),ne(4),ye("ngIf",!r.isCollapsed),ne(2),ye("ngClass",z_(13,Mie,!r.isCollapsed,r.isCollapsed)),ne(1),ye("ngIf",!r.isCollapsed),ne(7),ye("ngIf",!r.isCollapsed),ne(3),ye("ngIf",!r.isCollapsed),ne(3),ye("ngIf",!r.isCollapsed),ne(3),ye("ngIf",!r.isCollapsed),ne(3),ye("ngIf",!r.isCollapsed),ne(3),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.currentUser))},dependencies:[ha,wo,od,R2],styles:['[_nghost-%COMP%]{display:block}.sidebar-container[_ngcontent-%COMP%]{height:auto;transition:all .4s cubic-bezier(.23,1,.32,1);width:280px;align-items:stretch;position:relative}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:90px}.sidebar[_ngcontent-%COMP%]{background:linear-gradient(145deg,#ffffff,#f9fbff);box-shadow:0 8px 32px #1f268726;border-right:1px solid rgba(255,255,255,.18);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);display:flex;flex-direction:column;height:100%;width:100%;border-radius:0 16px 16px 0;overflow:hidden;position:relative}.sidebar[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(135deg,#4DB299,#2A7B68);background-size:200% 200%;animation:_ngcontent-%COMP%_gradientShift 8s ease infinite;z-index:1}@keyframes _ngcontent-%COMP%_gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.sidebar-header[_ngcontent-%COMP%]{align-items:center;border-bottom:1px solid rgba(240,240,240,.5);display:flex;flex-direction:column;padding:24px 15px;position:relative;background:rgba(255,255,255,.7)}.sidebar-header[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between;width:100%}.sidebar-header[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:32px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.1));transition:all .3s ease}.sidebar-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;font-size:18px;font-weight:600;margin:12px 0 0;background:linear-gradient(90deg,#333,#666);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:.5px}.sidebar-header[_ngcontent-%COMP%]   .collapse-btn[_ngcontent-%COMP%]{align-items:center;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border:none;border-radius:50%;cursor:pointer;display:flex;height:34px;justify-content:center;width:34px;box-shadow:4px 4px 8px #0000000d,-4px -4px 8px #ffffffe6;transition:all .3s ease}.sidebar-header[_ngcontent-%COMP%]   .collapse-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 5px 15px #0000001a,-4px -4px 8px #ffffffe6}.sidebar-header[_ngcontent-%COMP%]   .collapse-btn[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:inset 2px 2px 5px #0000001a,inset -2px -2px 5px #ffffff80}.sidebar-header[_ngcontent-%COMP%]   .collapse-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#666;font-size:14px;transition:all .3s ease}.sidebar-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:10px 0;scrollbar-width:thin;scrollbar-color:linear-gradient(135deg,#4DB299,#2A7B68)}.sidebar-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.sidebar-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.sidebar-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:linear-gradient(135deg,#4DB299,#2A7B68);border-radius:10px}.nav-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;padding:12px 20px;color:#555;text-decoration:none;font-size:16px;transition:all .3s ease;border-left:3px solid transparent;position:relative;overflow:hidden}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;height:100%;width:0;background:linear-gradient(90deg,rgba(71,118,230,.1),rgba(142,84,233,.1));transition:width .3s ease;z-index:-1}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover:before{width:100%}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;transition:transform .3s ease}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:#333}.nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:translate(3px)}.nav-section[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border-left:3px solid #2F7C6A;color:#789;font-weight:600;box-shadow:0 0 10px #8e54e91a}.nav-section[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#789;text-shadow:0 0 8px linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A)}.user-avatar[_ngcontent-%COMP%]{width:42px;height:42px;border:2px solid transparent;border-radius:50%;background:linear-gradient(white,white) padding-box,linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A) border-box;box-shadow:0 0 10px #8e54e966;object-fit:cover;animation:_ngcontent-%COMP%_pulse 2s infinite alternate}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 5px #8e54e966}to{box-shadow:0 0 15px #4776e699}}.sidebar-footer[_ngcontent-%COMP%]{border-top:1px solid rgba(240,240,240,.5);padding:15px 20px;display:flex;align-items:center;background:rgba(250,250,250,.7);backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);height:70px;position:relative;overflow:hidden}.sidebar-footer[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A),transparent}.user-info[_ngcontent-%COMP%]{margin-left:12px;display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#333;transition:all .3s ease}.user-email[_ngcontent-%COMP%]{font-size:12px;color:#777;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:all .3s ease}.sidebar-container.collapsed[_ngcontent-%COMP%]   .sidebar-header[_ngcontent-%COMP%]{padding:20px 10px}.sidebar-container.collapsed[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%], .sidebar-container.collapsed[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%], .sidebar-container.collapsed[_ngcontent-%COMP%]   .nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar-container.collapsed[_ngcontent-%COMP%]   .nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{justify-content:center;padding:15px 0}.sidebar-container.collapsed[_ngcontent-%COMP%]   .nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px}.sidebar-container.collapsed[_ngcontent-%COMP%]   .sidebar-footer[_ngcontent-%COMP%]{justify-content:center;padding:15px 10px}.sidebar-container.collapsed[_ngcontent-%COMP%]   .nav-section[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover:after{content:attr(data-title);position:absolute;left:100%;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.95);color:#333;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;box-shadow:0 3px 10px #0000001a;z-index:10}']})}}return t})(),SF=(()=>{class t{constructor(e,i,r){this.propertyService=e,this.userService=i,this.router=r,this.properties=[],this.appointments=[],this.filteredProperties=[],this.isLoading=!0,this.error=null,this.totalViews=0,this.approvedPropertiesCount=0,this.pendingRequestsCount=2,this.newMessagesCount=1,this.upcomingAppointmentsCount=0,this.currentFilters={}}ngOnInit(){this.loadProperties(),this.loadAppointments()}loadProperties(){this.isLoading=!0,this.propertyService.getAllProperties().subscribe({next:e=>{this.totalViews=e.reduce((i,r)=>i+(Number(r.viewCount)||0),0),this.approvedPropertiesCount=e.filter(i=>"approved"===i.approval||this.appointments.some(r=>"confirmed"===r.status)).length,this.properties=e,this.filteredProperties=e,this.isLoading=!1},error:e=>{this.error="Failed to load properties. Please try again.",this.isLoading=!1,console.error("Error loading properties:",e)}})}loadAppointments(){this.propertyService.getOwnerAppointments().subscribe({next:e=>{this.appointments=e;const i=new Date;this.upcomingAppointmentsCount=e.filter(r=>new Date(r.appointmentDate)>=i).length},error:e=>{console.error("Error loading appointments:",e)}})}onFilterChanged(e){this.currentFilters=e,this.applyFilters()}applyFilters(){let e=[...this.properties];if(this.currentFilters.dealType&&(e=e.filter(i=>i.generalinfo.deal_type.toLowerCase()===this.currentFilters.dealType.toLowerCase())),this.currentFilters.type&&(e=e.filter(i=>i.generalinfo.propertyType.toLowerCase()===this.currentFilters.type.toLowerCase())),this.currentFilters.city&&(e=e.filter(i=>i.location.city.toLowerCase().includes(this.currentFilters.city.toLowerCase()))),this.currentFilters.minPrice&&(e=e.filter(i=>Number(i.price.price)>=this.currentFilters.minPrice)),this.currentFilters.maxPrice&&this.currentFilters.maxPrice>0&&(e=e.filter(i=>Number(i.price.price)<=this.currentFilters.maxPrice)),this.currentFilters.search){const i=this.currentFilters.search.toLowerCase();e=e.filter(r=>r.generalinfo.title.toLowerCase().includes(i)||r.generalinfo.description.toLowerCase().includes(i)||r.location.city.toLowerCase().includes(i)||r.location.country.toLowerCase().includes(i))}this.filteredProperties=e}addNewProperty(){this.router.navigate(["/properties/add"])}clearAllFilters(){this.currentFilters={},this.filteredProperties=this.properties}exportProperties(){const e=JSON.stringify(this.filteredProperties,null,2),i=new Blob([e],{type:"application/json"}),r=window.URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download="my-properties.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(zf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-owner-dash"]],decls:5,vars:0,consts:[[1,"page-body"],[1,"left-sidebar"],[1,"main-content"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1),$e(2,"app-owner-sidebar"),B(),z(3,"div",2),$e(4,"router-outlet"),B()())},dependencies:[T2,Cie],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;max-width:1400px;margin:0 auto;font-family:Arial,sans-serif}.breadcrumb[_ngcontent-%COMP%]{font-size:14px;color:#777;margin-bottom:15px}.breadcrumb[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#777;text-decoration:none}.dashboard-title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;margin-bottom:20px}.controls-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.search-box[_ngcontent-%COMP%]{position:relative;width:300px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px 35px 10px 15px;border:1px solid #ddd;border-radius:4px;font-size:14px}.search-icon[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#999}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px}.btn-export[_ngcontent-%COMP%], .btn-add[_ngcontent-%COMP%], .btn-retry[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 15px;border-radius:4px;font-weight:500;cursor:pointer;border:none;font-size:14px}.btn-export[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333;border:1px solid #ddd}.btn-add[_ngcontent-%COMP%]{background-color:#5ec269;color:#fff}.dashboard-content[_ngcontent-%COMP%]{display:flex;gap:20px}.property-grid[_ngcontent-%COMP%]{flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.filter-sidebar[_ngcontent-%COMP%]{width:300px;background-color:#f9f9f9;border-radius:8px;padding:15px}.filter-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.filter-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin:0}.btn-clear[_ngcontent-%COMP%]{background:none;border:none;color:#1976d2;cursor:pointer;font-size:14px}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]{grid-column:1 / -1;padding:40px;text-align:center;color:#666}.error-container[_ngcontent-%COMP%]{color:#d32f2f}.left-sidebar[_ngcontent-%COMP%]{flex-shrink:0;background-color:#fff;transition:all .3s ease}.page-body[_ngcontent-%COMP%]{display:flex;min-height:100vh}.main-content[_ngcontent-%COMP%]{flex:1;padding:20px;overflow-y:auto}"]})}}return t})();const Sie=function(t){return["/property/edit",t]};let Eie=(()=>{class t{constructor(e){this.router=e,this.propertyStatus="",this.isOffMarket=!1}ngOnInit(){this.propertyStatus=this.determinePropertyStatus(),this.isOffMarket=this.checkIfOffMarket(),console.log(this.property)}determinePropertyStatus(){return this.property?.generalinfo?.PropertyCondition||"Active"}checkIfOffMarket(){return"Off Market"===this.property?.generalinfo?.PropertyCondition}navigateToDetail(){this.router.navigate(["/property",this.property.id])}getPropertyImage(){return this.property?.Media?.photos?.length>0?"http://backend.ddev.site"+this.property.Media.photos[0].imageName:"/assets/default-property.jpg"}static{this.\u0275fac=function(i){return new(i||t)(st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-card2"]],inputs:{property:"property"},decls:62,vars:20,consts:[[1,"property-card",3,"click"],[1,"property-card-image"],[1,"property-image-container"],[1,"property-image",3,"src","alt"],[1,"property-card-info"],[1,"property-name"],[1,"property-title"],[1,"property-status"],[1,"property-card-adress"],[1,"label","ttext"],[1,"property-card-adress-item"],[1,"property-data"],[1,"property-data-item"],[1,"property-card-value","para"],[1,"property-card-caption"],[1,"property-card-caption","ttext"],[1,"inquiry-btn",3,"routerLink"]],template:function(i,r){1&i&&(z(0,"div",0),qt("click",function(){return r.navigateToDetail()}),z(1,"div",1)(2,"div",2),$e(3,"img",3),B()(),z(4,"div",4)(5,"div",5)(6,"h3",6),q(7),B(),$e(8,"div",7),B(),z(9,"div",8)(10,"div",9),q(11,"Property Type:"),B(),z(12,"div",10)(13,"p"),q(14),B()(),z(15,"div",9),q(16,"Deal Type:"),B(),z(17,"div",10)(18,"p"),q(19),B()(),z(20,"div",9),q(21,"Property Condition:"),B(),z(22,"div",10)(23,"p"),q(24),B()(),z(25,"div",9),q(26,"Property Status:"),B(),z(27,"div",10)(28,"p"),q(29),B()()(),z(30,"div",9),q(31,"Location:"),B(),z(32,"div",8)(33,"p"),q(34),B()(),z(35,"ul",11)(36,"li",12)(37,"div",13),q(38),ks(39,"number"),B(),z(40,"p",14),q(41,"Price"),B()(),z(42,"li",12),$e(43,"div",13),q(44),B(),z(45,"li",12)(46,"div",13),q(47),B(),z(48,"p",15),q(49,"Bathrooms"),B()(),z(50,"li",12)(51,"div",13),q(52),B(),z(53,"p",15),q(54,"Bedrooms"),B()(),z(55,"li",12)(56,"div",13),q(57),B(),z(58,"p",15),q(59,"views"),B()()(),z(60,"a",16),q(61,"edit"),B()()()),2&i&&(ne(3),R_("alt",r.property.generalinfo.title),ye("src",r.getPropertyImage(),fs),ne(4),Qe(r.property.generalinfo.title),ne(7),Qe(r.property.generalinfo.propertyType),ne(5),Qe(r.property.generalinfo.dealType),ne(5),Qe(r.property.generalinfo.propertyCondition),ne(5),Qe(r.property.approval),ne(5),un("",r.property.location.country,", ",r.property.location.city,", ",r.property.location.subcity,""),ne(4),Ft("",Iu(39,16,r.property.price.price),"TND"),ne(6),Qe(r.property.Specification.size),ne(3),Qe(r.property.Specification.bathrooms),ne(5),Ft("",r.property.Specification.bedrooms," "),ne(5),Qe(r.property.viewCount),ne(3),ye("routerLink",Gr(18,Sie,r.property.id)))},dependencies:[od,X3],styles:[".property-card[_ngcontent-%COMP%]{position:relative;display:flex;gap:2rem;align-items:center;cursor:pointer;margin-bottom:2rem;border-bottom:lightgray solid 1px}h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1f2744}.ttext[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#789}.para[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:green;align-items:center}.property-card-image[_ngcontent-%COMP%]{align-self:flex-start;object-fit:cover;overflow:hidden;border-radius:1rem}.property-card-info[_ngcontent-%COMP%]{flex:1}img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:1rem}.property-name[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem 1rem;align-items:center;margin-bottom:.5rem;overflow-wrap:anywhere}.property-card-adress[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;color:#918f90}.property-card-adress-item[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;text-transform:capitalize}.property-data-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.1875rem}.property-card-caption[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.43;color:#789}.property-image-container[_ngcontent-%COMP%]{position:relative;width:16rem;height:14rem;overflow:hidden;border-radius:1rem}.property-data[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem 2rem;padding:0}@media (max-width: 1200px){.property-card[_ngcontent-%COMP%]{gap:1.5rem}.property-image-container[_ngcontent-%COMP%]{width:14rem;height:12rem}}@media (max-width: 992px){.property-card[_ngcontent-%COMP%]{gap:1.25rem}.property-image-container[_ngcontent-%COMP%]{width:12rem;height:10rem}.property-data[_ngcontent-%COMP%]{gap:.75rem 1.5rem}}@media (max-width: 768px){.property-card[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.property-image-container[_ngcontent-%COMP%]{width:100%;height:16rem;margin-bottom:1rem}.property-card-info[_ngcontent-%COMP%]{width:100%}h3[_ngcontent-%COMP%]{font-size:1.25rem}}@media (max-width: 576px){.property-card[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding-bottom:1.5rem}.property-image-container[_ngcontent-%COMP%]{height:12rem}.property-card-adress[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.property-data[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.property-data-item[_ngcontent-%COMP%]{flex:0 0 calc(50% - .5rem);margin-bottom:.5rem}h3[_ngcontent-%COMP%]{font-size:1.125rem}.ttext[_ngcontent-%COMP%], .para[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{font-size:.9rem}.property-card-caption[_ngcontent-%COMP%]{font-size:.8rem}}"]})}}return t})();function Die(t,n){1&t&&$e(0,"app-property-card2",18),2&t&&ye("property",n.$implicit)}function Tie(t,n){if(1&t&&(kp(0),He(1,Die,1,1,"app-property-card2",17),Vm()),2&t){const e=ht();ne(1),ye("ngForOf",e.paginatedProperties)}}function Aie(t,n){if(1&t){const e=Ki();z(0,"li",20),qt("click",function(){const s=An(e).index;return Mn(ht(2).onPageChange(s+1))}),z(1,"a",21),q(2),B()()}if(2&t){const e=n.index;Z("active",ht(2).currentPage===e+1),ne(2),Qe(e+1)}}const Pie=function(){return[]};function Iie(t,n){if(1&t){const e=Ki();z(0,"nav")(1,"ul",19)(2,"li",20),qt("click",function(){An(e);const r=ht();return Mn(r.currentPage>1&&r.onPageChange(r.currentPage-1))}),z(3,"a",21),q(4,"Previous"),B()(),He(5,Aie,3,3,"li",22),z(6,"li",20),qt("click",function(){An(e);const r=ht();return Mn(r.currentPage<r.totalPages&&r.onPageChange(r.currentPage+1))}),z(7,"a",21),q(8,"Next"),B()()()()}if(2&t){const e=ht();ne(2),Z("disabled",1===e.currentPage),ne(3),ye("ngForOf",x1(5,Pie).constructor(e.Math.ceil(e.filteredProperties.length/e.itemsPerPage))),ne(1),Z("disabled",e.currentPage>=e.totalPages)}}let Oie=(()=>{class t{constructor(e,i,r){this.propertyService=e,this.userService=i,this.router=r,this.properties=[],this.filteredProperties=[],this.isLoading=!0,this.error=null,this.currentFilters={},this.currentPage=1,this.itemsPerPage=3,this.Math=Math,this.paginatedProperties=[]}ngOnInit(){this.loadProperties()}loadProperties(){this.isLoading=!0,this.propertyService.getAllPropertiesByOwnerId().subscribe({next:e=>{this.properties=e,this.filteredProperties=e,this.updatePaginatedProperties(),this.isLoading=!1},error:e=>{this.error="Failed to load properties. Please try again.",this.isLoading=!1,console.error("Error loading properties:",e)}})}onFilterChanged(e){this.currentFilters=e,this.applyFilters()}applyFilters(){let e=[...this.properties];if(this.currentFilters.dealType&&(e=e.filter(i=>i.generalinfo.deal_type.toLowerCase()===this.currentFilters.dealType.toLowerCase())),this.currentFilters.type&&(e=e.filter(i=>i.generalinfo.propertyType.toLowerCase()===this.currentFilters.type.toLowerCase())),this.currentFilters.city&&(e=e.filter(i=>i.location.city.toLowerCase().includes(this.currentFilters.city.toLowerCase()))),this.currentFilters.minPrice&&(e=e.filter(i=>Number(i.price.price)>=this.currentFilters.minPrice)),this.currentFilters.maxPrice&&this.currentFilters.maxPrice>0&&(e=e.filter(i=>Number(i.price.price)<=this.currentFilters.maxPrice)),this.currentFilters.search){const i=this.currentFilters.search.toLowerCase();e=e.filter(r=>r.generalinfo.title.toLowerCase().includes(i)||r.generalinfo.description.toLowerCase().includes(i)||r.location.city.toLowerCase().includes(i)||r.location.country.toLowerCase().includes(i))}this.filteredProperties=e,this.updatePaginatedProperties()}updatePaginatedProperties(){const e=(this.currentPage-1)*this.itemsPerPage;this.paginatedProperties=this.filteredProperties.slice(e,e+this.itemsPerPage)}onPageChange(e){this.currentPage=e,this.updatePaginatedProperties()}get totalPages(){return Math.ceil(this.filteredProperties.length/this.itemsPerPage)}addNewProperty(){this.router.navigate(["/properties/add"])}clearAllFilters(){this.currentFilters={},this.filteredProperties=this.properties}exportProperties(){const e=JSON.stringify(this.filteredProperties,null,2),i=new Blob([e],{type:"application/json"}),r=window.URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download="my-properties.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(zf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-list-dash"]],decls:20,vars:3,consts:[[1,"property-list"],[1,"page-header"],[1,"page-header-end","d-flex","gap-1"],[1,"property-list-filter"],[1,"table-panel"],[1,"table-panel-search"],[1,"search-box"],["type","text","placeholder","Search",1,"search-input",3,"ngModel","ngModelChange","input"],[1,"fa-solid","fa-magnifying-glass","search-icon"],[1,"flex","flex-wrap","gap-4"],["type","button","routerLink","/property/new",1,"btn"],[1,"btn-text"],[1,"fa-solid","fa-plus"],[1,"property-list-view"],[1,"property-list-cards"],[1,"property-list-cards-items"],[4,"ngIf"],[3,"property",4,"ngFor","ngForOf"],[3,"property"],[1,"pagination","justify-content-center"],[1,"page-item",3,"click"],[1,"page-link"],["class","page-item",3,"active","click",4,"ngFor","ngForOf"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"header",1)(2,"div"),$e(3,"div",2),B()(),z(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"input",7),qt("ngModelChange",function(c){return r.currentFilters.search=c})("input",function(){return r.applyFilters()}),B(),$e(9,"i",8),B()()(),z(10,"div",9)(11,"button",10)(12,"span",11),$e(13,"i",12),q(14,"Add New property"),B()()()(),z(15,"div",13)(16,"div",14)(17,"div",15),He(18,Tie,2,1,"ng-container",16),B()()(),He(19,Iie,9,6,"nav",16),B()),2&i&&(ne(8),ye("ngModel",r.currentFilters.search),ne(10),ye("ngIf",!r.isLoading&&!r.error),ne(1),ye("ngIf",r.filteredProperties.length>r.itemsPerPage))},dependencies:[qs,wo,od,hl,Wl,Wm,Eie],styles:[".property-list[_ngcontent-%COMP%]{margin:1rem;padding:1rem;box-sizing:border-box;width:calc(100% - 2rem)}.page-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem 1.5rem;justify-content:space-between;align-items:center;margin-bottom:1rem}.text-h1[_ngcontent-%COMP%]{font-family:poppins,sans-serif;font-size:2.25rem;font-weight:400;line-height:1.33;margin:0}.property-list-filter[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:center;justify-content:space-between;margin-bottom:2rem;width:100%}.table-panel-search[_ngcontent-%COMP%]{width:22rem;max-width:100%}.table-panel[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:2rem;justify-content:space-between;width:100%}.input--sm[_ngcontent-%COMP%]{height:2.5rem;width:100%;box-sizing:border-box}.input-icon[_ngcontent-%COMP%]{order:1;margin-right:.3rem}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px 35px 10px 15px;border:1px solid #ddd;border-radius:4px;font-size:14px;box-sizing:border-box}.search-icon[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#999}.search-box[_ngcontent-%COMP%]{position:relative;width:300px;max-width:100%}.controls-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:1rem;width:100%}.btn[_ngcontent-%COMP%]{position:relative;display:flex;background:#4DB299;width:-moz-fit-content;width:fit-content;font-weight:500;border-radius:.25rem;transition:.25s ease-in-out;padding:.5rem 1rem;cursor:pointer}.btn-text[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;justify-content:center;white-space:nowrap}.property-list-cards[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;width:100%}.properties-list-cards-items[_ngcontent-%COMP%]{flex-basis:0;flex-grow:1;min-width:250px;width:100%}.properties-list-cards-item[_ngcontent-%COMP%]:not(:last-child){margin-bottom:2rem;padding-bottom:2rem;border-bottom:.0625rem solid gray}.filter-sidebar[_ngcontent-%COMP%]{width:300px;background-color:#f9f9f9;border-radius:8px;padding:15px;box-sizing:border-box}.filter-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.filter-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin:0}.btn-clear[_ngcontent-%COMP%]{background:none;border:none;color:#1976d2;cursor:pointer;font-size:14px}@media (max-width: 1200px){.property-list-cards[_ngcontent-%COMP%]{gap:1.5rem}.properties-list-cards-items[_ngcontent-%COMP%]{min-width:220px}}@media (max-width: 992px){.property-list[_ngcontent-%COMP%]{margin:.75rem;padding:.75rem}.filter-sidebar[_ngcontent-%COMP%]{width:100%;margin-bottom:1.5rem}.table-panel[_ngcontent-%COMP%]{gap:1.5rem}}@media (max-width: 768px){.text-h1[_ngcontent-%COMP%]{font-size:1.75rem}.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.property-list-filter[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.table-panel-search[_ngcontent-%COMP%]{width:100%}.table-panel[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;width:100%}.search-box[_ngcontent-%COMP%]{width:100%}.property-list-cards[_ngcontent-%COMP%]{flex-direction:column}.properties-list-cards-items[_ngcontent-%COMP%]{width:100%}}@media (max-width: 576px){.property-list[_ngcontent-%COMP%]{margin:.5rem;padding:.5rem}.text-h1[_ngcontent-%COMP%]{font-size:1.5rem}.controls-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})}}return t})(),EF=(()=>{class t{constructor(e,i){this.authService=e,this.router=i}canActivate(e,i){return!!this.authService.isLoggedIn()||(this.router.navigate(["/login"],{queryParams:{returnUrl:i.url}}),!1)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Km),Dt(Na))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var xk,ji,DF,TF,B2,K_,AF,PF,IF,G4={},OF=[],Rie=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Jm(t,n){for(var e in n)t[e]=n[e];return t}function RF(t){var n=t.parentNode;n&&n.removeChild(t)}function et(t,n,e){var i,r,s,c={};for(s in n)"key"==s?i=n[s]:"ref"==s?r=n[s]:c[s]=n[s];if(arguments.length>2&&(c.children=arguments.length>3?xk.call(arguments,2):e),"function"==typeof t&&null!=t.defaultProps)for(s in t.defaultProps)void 0===c[s]&&(c[s]=t.defaultProps[s]);return wk(t,c,i,r,null)}function wk(t,n,e,i,r){var s={type:t,props:n,key:e,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r??++DF};return null==r&&null!=ji.vnode&&ji.vnode(s),s}function ms(t){return t.children}function LF(t,n,e){"-"===n[0]?t.setProperty(n,e??""):t[n]=null==e?"":"number"!=typeof e||Rie.test(n)?e:e+"px"}function W4(t,n,e,i,r){var s;e:if("style"===n)if("string"==typeof e)t.style.cssText=e;else{if("string"==typeof i&&(t.style.cssText=i=""),i)for(n in i)e&&n in e||LF(t.style,n,"");if(e)for(n in e)i&&e[n]===i[n]||LF(t.style,n,e[n])}else if("o"===n[0]&&"n"===n[1])s=n!==(n=n.replace(/Capture$/,"")),n=n.toLowerCase()in t?n.toLowerCase().slice(2):n.slice(2),t.l||(t.l={}),t.l[n+s]=e,e?i||t.addEventListener(n,s?zF:FF,s):t.removeEventListener(n,s?zF:FF,s);else if("dangerouslySetInnerHTML"!==n){if(r)n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==n&&"height"!==n&&"href"!==n&&"list"!==n&&"form"!==n&&"tabIndex"!==n&&"download"!==n&&n in t)try{t[n]=e??"";break e}catch{}"function"==typeof e||(null==e||!1===e&&-1==n.indexOf("-")?t.removeAttribute(n):t.setAttribute(n,e))}}function FF(t){B2=!0;try{return this.l[t.type+!1](ji.event?ji.event(t):t)}finally{B2=!1}}function zF(t){B2=!0;try{return this.l[t.type+!0](ji.event?ji.event(t):t)}finally{B2=!1}}function kh(t,n){this.props=t,this.context=n}function kk(t,n){if(null==n)return t.__?kk(t.__,t.__.__k.indexOf(t)+1):null;for(var e;n<t.__k.length;n++)if(null!=(e=t.__k[n])&&null!=e.__e)return e.__e;return"function"==typeof t.type?kk(t):null}function NF(t){var n,e;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,n=0;n<t.__k.length;n++)if(null!=(e=t.__k[n])&&null!=e.__e){t.__e=t.__c.base=e.__e;break}return NF(t)}}function Fie(t){B2?setTimeout(t):PF(t)}function vA(t){(!t.__d&&(t.__d=!0)&&K_.push(t)&&!Z4.__r++||AF!==ji.debounceRendering)&&((AF=ji.debounceRendering)||Fie)(Z4)}function Z4(){var t,n,e,i,r,s,c,f;for(K_.sort(function(y,k){return y.__v.__b-k.__v.__b});t=K_.shift();)t.__d&&(n=K_.length,i=void 0,r=void 0,c=(s=(e=t).__v).__e,(f=e.__P)&&(i=[],(r=Jm({},s)).__v=s.__v+1,bA(f,s,r,e.__n,void 0!==f.ownerSVGElement,null!=s.__h?[c]:null,i,c??kk(s),s.__h),UF(i,s),s.__e!=c&&NF(s)),K_.length>n&&K_.sort(function(y,k){return y.__v.__b-k.__v.__b}));Z4.__r=0}function BF(t,n,e,i,r,s,c,f,y,k){var E,F,$,W,re,he,me,Pe=i&&i.__k||OF,Re=Pe.length;for(e.__k=[],E=0;E<n.length;E++)if(null!=(W=e.__k[E]=null==(W=n[E])||"boolean"==typeof W?null:"string"==typeof W||"number"==typeof W||"bigint"==typeof W?wk(null,W,null,null,W):Array.isArray(W)?wk(ms,{children:W},null,null,null):W.__b>0?wk(W.type,W.props,W.key,W.ref?W.ref:null,W.__v):W)){if(W.__=e,W.__b=e.__b+1,null===($=Pe[E])||$&&W.key==$.key&&W.type===$.type)Pe[E]=void 0;else for(F=0;F<Re;F++){if(($=Pe[F])&&W.key==$.key&&W.type===$.type){Pe[F]=void 0;break}$=null}bA(t,W,$=$||G4,r,s,c,f,y,k),re=W.__e,(F=W.ref)&&$.ref!=F&&(me||(me=[]),$.ref&&me.push($.ref,null,W),me.push(F,W.__c||re,W)),null!=re?(null==he&&(he=re),"function"==typeof W.type&&W.__k===$.__k?W.__d=y=VF(W,y,t):y=jF(t,W,$,Pe,re,y),"function"==typeof e.type&&(e.__d=y)):y&&$.__e==y&&y.parentNode!=t&&(y=kk($))}for(e.__e=he,E=Re;E--;)null!=Pe[E]&&("function"==typeof e.type&&null!=Pe[E].__e&&Pe[E].__e==e.__d&&(e.__d=HF(i).nextSibling),$F(Pe[E],Pe[E]));if(me)for(E=0;E<me.length;E++)qF(me[E],me[++E],me[++E])}function VF(t,n,e){for(var i,r=t.__k,s=0;r&&s<r.length;s++)(i=r[s])&&(i.__=t,n="function"==typeof i.type?VF(i,n,e):jF(e,i,i,r,i.__e,n));return n}function eg(t,n){return n=n||[],null==t||"boolean"==typeof t||(Array.isArray(t)?t.some(function(e){eg(e,n)}):n.push(t)),n}function jF(t,n,e,i,r,s){var c,f,y;if(void 0!==n.__d)c=n.__d,n.__d=void 0;else if(null==e||r!=s||null==r.parentNode)e:if(null==s||s.parentNode!==t)t.appendChild(r),c=null;else{for(f=s,y=0;(f=f.nextSibling)&&y<i.length;y+=1)if(f==r)break e;t.insertBefore(r,s),c=s}return void 0!==c?c:r.nextSibling}function HF(t){var n,e,i;if(null==t.type||"string"==typeof t.type)return t.__e;if(t.__k)for(n=t.__k.length-1;n>=0;n--)if((e=t.__k[n])&&(i=HF(e)))return i;return null}function bA(t,n,e,i,r,s,c,f,y){var k,E,F,$,W,re,he,me,Pe,Re,rt,ft,Ct,Vt,sn,Qt=n.type;if(void 0!==n.constructor)return null;null!=e.__h&&(y=e.__h,f=n.__e=e.__e,n.__h=null,s=[f]),(k=ji.__b)&&k(n);try{e:if("function"==typeof Qt){if(me=n.props,Pe=(k=Qt.contextType)&&i[k.__c],Re=k?Pe?Pe.props.value:k.__:i,e.__c?he=(E=n.__c=e.__c).__=E.__E:("prototype"in Qt&&Qt.prototype.render?n.__c=E=new Qt(me,Re):(n.__c=E=new kh(me,Re),E.constructor=Qt,E.render=Nie),Pe&&Pe.sub(E),E.props=me,E.state||(E.state={}),E.context=Re,E.__n=i,F=E.__d=!0,E.__h=[],E._sb=[]),null==E.__s&&(E.__s=E.state),null!=Qt.getDerivedStateFromProps&&(E.__s==E.state&&(E.__s=Jm({},E.__s)),Jm(E.__s,Qt.getDerivedStateFromProps(me,E.__s))),$=E.props,W=E.state,E.__v=n,F)null==Qt.getDerivedStateFromProps&&null!=E.componentWillMount&&E.componentWillMount(),null!=E.componentDidMount&&E.__h.push(E.componentDidMount);else{if(null==Qt.getDerivedStateFromProps&&me!==$&&null!=E.componentWillReceiveProps&&E.componentWillReceiveProps(me,Re),!E.__e&&null!=E.shouldComponentUpdate&&!1===E.shouldComponentUpdate(me,E.__s,Re)||n.__v===e.__v){for(n.__v!==e.__v&&(E.props=me,E.state=E.__s,E.__d=!1),n.__e=e.__e,n.__k=e.__k,n.__k.forEach(function(Vn){Vn&&(Vn.__=n)}),rt=0;rt<E._sb.length;rt++)E.__h.push(E._sb[rt]);E._sb=[],E.__h.length&&c.push(E);break e}null!=E.componentWillUpdate&&E.componentWillUpdate(me,E.__s,Re),null!=E.componentDidUpdate&&E.__h.push(function(){E.componentDidUpdate($,W,re)})}if(E.context=Re,E.props=me,E.__P=t,ft=ji.__r,Ct=0,"prototype"in Qt&&Qt.prototype.render){for(E.state=E.__s,E.__d=!1,ft&&ft(n),k=E.render(E.props,E.state,E.context),Vt=0;Vt<E._sb.length;Vt++)E.__h.push(E._sb[Vt]);E._sb=[]}else do{E.__d=!1,ft&&ft(n),k=E.render(E.props,E.state,E.context),E.state=E.__s}while(E.__d&&++Ct<25);E.state=E.__s,null!=E.getChildContext&&(i=Jm(Jm({},i),E.getChildContext())),F||null==E.getSnapshotBeforeUpdate||(re=E.getSnapshotBeforeUpdate($,W)),sn=null!=k&&k.type===ms&&null==k.key?k.props.children:k,BF(t,Array.isArray(sn)?sn:[sn],n,e,i,r,s,c,f,y),E.base=n.__e,n.__h=null,E.__h.length&&c.push(E),he&&(E.__E=E.__=null),E.__e=!1}else null==s&&n.__v===e.__v?(n.__k=e.__k,n.__e=e.__e):n.__e=function zie(t,n,e,i,r,s,c,f){var y,k,E,F=e.props,$=n.props,W=n.type,re=0;if("svg"===W&&(r=!0),null!=s)for(;re<s.length;re++)if((y=s[re])&&"setAttribute"in y==!!W&&(W?y.localName===W:3===y.nodeType)){t=y,s[re]=null;break}if(null==t){if(null===W)return document.createTextNode($);t=r?document.createElementNS("http://www.w3.org/2000/svg",W):document.createElement(W,$.is&&$),s=null,f=!1}if(null===W)F===$||f&&t.data===$||(t.data=$);else{if(s=s&&xk.call(t.childNodes),k=(F=e.props||G4).dangerouslySetInnerHTML,E=$.dangerouslySetInnerHTML,!f){if(null!=s)for(F={},re=0;re<t.attributes.length;re++)F[t.attributes[re].name]=t.attributes[re].value;(E||k)&&(E&&(k&&E.__html==k.__html||E.__html===t.innerHTML)||(t.innerHTML=E&&E.__html||""))}if(function Lie(t,n,e,i,r){var s;for(s in e)"children"===s||"key"===s||s in n||W4(t,s,null,e[s],i);for(s in n)r&&"function"!=typeof n[s]||"children"===s||"key"===s||"value"===s||"checked"===s||e[s]===n[s]||W4(t,s,n[s],e[s],i)}(t,$,F,r,f),E)n.__k=[];else if(re=n.props.children,BF(t,Array.isArray(re)?re:[re],n,e,i,r&&"foreignObject"!==W,s,c,s?s[0]:e.__k&&kk(e,0),f),null!=s)for(re=s.length;re--;)null!=s[re]&&RF(s[re]);f||("value"in $&&void 0!==(re=$.value)&&(re!==t.value||"progress"===W&&!re||"option"===W&&re!==F.value)&&W4(t,"value",re,F.value,!1),"checked"in $&&void 0!==(re=$.checked)&&re!==t.checked&&W4(t,"checked",re,F.checked,!1))}return t}(e.__e,n,e,i,r,s,c,y);(k=ji.diffed)&&k(n)}catch(Vn){n.__v=null,(y||null!=s)&&(n.__e=f,n.__h=!!y,s[s.indexOf(f)]=null),ji.__e(Vn,n,e)}}function UF(t,n){ji.__c&&ji.__c(n,t),t.some(function(e){try{t=e.__h,e.__h=[],t.some(function(i){i.call(e)})}catch(i){ji.__e(i,e.__v)}})}function qF(t,n,e){try{"function"==typeof t?t(n):t.current=n}catch(i){ji.__e(i,e)}}function $F(t,n,e){var i,r;if(ji.unmount&&ji.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||qF(i,null,n)),null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){ji.__e(s,n)}i.base=i.__P=null,t.__c=void 0}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&$F(i[r],n,e||"function"!=typeof t.type);e||null==t.__e||RF(t.__e),t.__=t.__e=t.__d=void 0}function Nie(t,n,e){return this.constructor(t,e)}function L1(t,n,e){var i,r,s;ji.__&&ji.__(t,n),r=(i="function"==typeof e)?null:e&&e.__k||n.__k,s=[],bA(n,t=(!i&&e||n).__k=et(ms,null,[t]),r||G4,G4,void 0!==n.ownerSVGElement,!i&&e?[e]:r?null:n.firstChild?xk.call(n.childNodes):null,s,!i&&e?e:r?r.__e:n.firstChild,i),UF(s,t)}xk=OF.slice,ji={__e:function(t,n,e,i){for(var r,s,c;n=n.__;)if((r=n.__c)&&!r.__)try{if((s=r.constructor)&&null!=s.getDerivedStateFromError&&(r.setState(s.getDerivedStateFromError(t)),c=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(t,i||{}),c=r.__d),c)return r.__E=r}catch(f){t=f}throw t}},DF=0,TF=function(t){return null!=t&&void 0===t.constructor},B2=!1,kh.prototype.setState=function(t,n){var e;e=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Jm({},this.state),"function"==typeof t&&(t=t(Jm({},e),this.props)),t&&Jm(e,t),null!=t&&this.__v&&(n&&this._sb.push(n),vA(this))},kh.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),vA(this))},kh.prototype.render=ms,K_=[],PF="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Z4.__r=0,IF=0;var ua,xA,ZF,YF=[],Y4=[],XF=ji.__b,KF=ji.__r,QF=ji.diffed,JF=ji.__c,e9=ji.unmount;function Gie(){for(var t;t=YF.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(K4),t.__H.__h.forEach(MA),t.__H.__h=[]}catch(n){t.__H.__h=[],ji.__e(n,t.__v)}}ji.__b=function(t){ua=null,XF&&XF(t)},ji.__r=function(t){KF&&KF(t);var n=(ua=t.__c).__H;n&&(xA===ua?(n.__h=[],ua.__h=[],n.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=Y4,e.__N=e.i=void 0})):(n.__h.forEach(K4),n.__h.forEach(MA),n.__h=[])),xA=ua},ji.diffed=function(t){QF&&QF(t);var n=t.__c;n&&n.__H&&(n.__H.__h.length&&(1!==YF.push(n)&&ZF===ji.requestAnimationFrame||((ZF=ji.requestAnimationFrame)||Wie)(Gie)),n.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==Y4&&(e.__=e.__V),e.i=void 0,e.__V=Y4})),xA=ua=null},ji.__c=function(t,n){n.some(function(e){try{e.__h.forEach(K4),e.__h=e.__h.filter(function(i){return!i.__||MA(i)})}catch(i){n.some(function(r){r.__h&&(r.__h=[])}),n=[],ji.__e(i,e.__v)}}),JF&&JF(t,n)},ji.unmount=function(t){e9&&e9(t);var n,e=t.__c;e&&e.__H&&(e.__H.__.forEach(function(i){try{K4(i)}catch(r){n=r}}),e.__H=void 0,n&&ji.__e(n,e.__v))};var r9="function"==typeof requestAnimationFrame;function Wie(t){var n,e=function(){clearTimeout(i),r9&&cancelAnimationFrame(n),setTimeout(t)},i=setTimeout(e,100);r9&&(n=requestAnimationFrame(e))}function K4(t){var n=ua,e=t.__c;"function"==typeof e&&(t.__c=void 0,e()),ua=n}function MA(t){var n=ua;t.__c=t.__(),ua=n}function SA(t,n){for(var e in t)if("__source"!==e&&!(e in n))return!0;for(var i in n)if("__source"!==i&&t[i]!==n[i])return!0;return!1}function DA(t){this.props=t}(DA.prototype=new kh).isPureReactComponent=!0,DA.prototype.shouldComponentUpdate=function(t,n){return SA(this.props,t)||SA(this.state,n)};var a9=ji.__b;ji.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),a9&&a9(t)},typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref");var Qie=ji.__e;ji.__e=function(t,n,e,i){if(t.then)for(var r,s=n;s=s.__;)if((r=s.__c)&&r.__c)return null==n.__e&&(n.__e=e.__e,n.__k=e.__k),r.__c(t,n);Qie(t,n,e,i)};var c9=ji.unmount;function d9(t,n,e){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){"function"==typeof i.__c&&i.__c()}),t.__c.__H=null),null!=(t=function s9(t,n){for(var e in n)t[e]=n[e];return t}({},t)).__c&&(t.__c.__P===e&&(t.__c.__P=n),t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return d9(i,n,e)})),t}function h9(t,n,e){return t&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return h9(i,n,e)}),t.__c&&t.__c.__P===n&&(t.__e&&e.insertBefore(t.__e,t.__d),t.__c.__e=!0,t.__c.__P=e)),t}function Q4(){this.__u=0,this.t=null,this.__b=null}function u9(t){var n=t.__.__c;return n&&n.__a&&n.__a(t)}function Mk(){this.u=null,this.o=null}ji.unmount=function(t){var n=t.__c;n&&n.__R&&n.__R(),n&&!0===t.__h&&(t.type=null),c9&&c9(t)},(Q4.prototype=new kh).__c=function(t,n){var e=n.__c,i=this;null==i.t&&(i.t=[]),i.t.push(e);var r=u9(i.__v),s=!1,c=function(){s||(s=!0,e.__R=null,r?r(f):f())};e.__R=c;var f=function(){if(! --i.__u){if(i.state.__a){var k=i.state.__a;i.__v.__k[0]=h9(k,k.__c.__P,k.__c.__O)}var E;for(i.setState({__a:i.__b=null});E=i.t.pop();)E.forceUpdate()}},y=!0===n.__h;i.__u++||y||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(c,c)},Q4.prototype.componentWillUnmount=function(){this.t=[]},Q4.prototype.render=function(t,n){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=d9(this.__b,e,i.__O=i.__P)}this.__b=null}var r=n.__a&&et(ms,null,t.fallback);return r&&(r.__h=null),[et(ms,null,n.__a?null:t.children),r]};var p9=function(t,n,e){if(++e[1]===e[0]&&t.o.delete(n),t.props.revealOrder&&("t"!==t.props.revealOrder[0]||!t.o.size))for(e=t.u;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;t.u=e=e[2]}};function ere(t){return this.getChildContext=function(){return t.context},t.children}function tre(t){var n=this,e=t.i;n.componentWillUnmount=function(){L1(null,n.l),n.l=null,n.i=null},n.i&&n.i!==e&&n.componentWillUnmount(),t.__v?(n.l||(n.i=e,n.l={nodeType:1,parentNode:e,childNodes:[],appendChild:function(i){this.childNodes.push(i),n.i.appendChild(i)},insertBefore:function(i,r){this.childNodes.push(i),n.i.appendChild(i)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),n.i.removeChild(i)}}),L1(et(ere,{context:n.context},t.__v),n.l)):n.l&&n.componentWillUnmount()}(Mk.prototype=new kh).__a=function(t){var n=this,e=u9(n.__v),i=n.o.get(t);return i[0]++,function(r){var s=function(){n.props.revealOrder?(i.push(r),p9(n,t,i)):r()};e?e(s):s()}},Mk.prototype.render=function(t){this.u=null,this.o=new Map;var n=eg(t.children);t.revealOrder&&"b"===t.revealOrder[0]&&n.reverse();for(var e=n.length;e--;)this.o.set(n[e],this.u=[1,0,this.u]);return t.children},Mk.prototype.componentDidUpdate=Mk.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(n,e){p9(t,e,n)})};var m9=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,nre=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,ire=typeof document<"u",rre=function(t){return(typeof Symbol<"u"&&"symbol"==typeof Symbol()?/fil|che|rad/i:/fil|che|ra/i).test(t)};kh.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(kh.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(n){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:n})}})});var g9=ji.event;function are(){}function lre(){return this.cancelBubble}function cre(){return this.defaultPrevented}ji.event=function(t){return g9&&(t=g9(t)),t.persist=are,t.isPropagationStopped=lre,t.isDefaultPrevented=cre,t.nativeEvent=t};var y9={configurable:!0,get:function(){return this.class}},v9=ji.vnode;ji.vnode=function(t){var n=t.type,e=t.props,i=e;if("string"==typeof n){var r=-1===n.indexOf("-");for(var s in i={},e){var c=e[s];ire&&"children"===s&&"noscript"===n||"value"===s&&"defaultValue"in e&&null==c||("defaultValue"===s&&"value"in e&&null==e.value?s="value":"download"===s&&!0===c?c="":/ondoubleclick/i.test(s)?s="ondblclick":/^onchange(textarea|input)/i.test(s+n)&&!rre(e.type)?s="oninput":/^onfocus$/i.test(s)?s="onfocusin":/^onblur$/i.test(s)?s="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(s)?s=s.toLowerCase():r&&nre.test(s)?s=s.replace(/[A-Z0-9]/g,"-$&").toLowerCase():null===c&&(c=void 0),/^oninput$/i.test(s)&&(s=s.toLowerCase(),i[s]&&(s="oninputCapture")),i[s]=c)}"select"==n&&i.multiple&&Array.isArray(i.value)&&(i.value=eg(e.children).forEach(function(f){f.props.selected=-1!=i.value.indexOf(f.props.value)})),"select"==n&&null!=i.defaultValue&&(i.value=eg(e.children).forEach(function(f){f.props.selected=i.multiple?-1!=i.defaultValue.indexOf(f.props.value):i.defaultValue==f.props.value})),t.props=i,e.class!=e.className&&(y9.enumerable="className"in e,null!=e.className&&(i.class=e.className),Object.defineProperty(i,"className",y9))}t.$$typeof=m9,v9&&v9(t)};var b9=ji.__r;ji.__r=function(t){b9&&b9(t)};const k9=[],TA=new Map;function J4(t){k9.push(t),TA.forEach(n=>{C9(n,t)})}function M9(t){let n=TA.get(t);if(!n||!n.isConnected){if(n=t.querySelector("style[data-fullcalendar]"),!n){n=document.createElement("style"),n.setAttribute("data-fullcalendar","");const e=function Mre(){return void 0===AA&&(AA=function Cre(){const t=document.querySelector('meta[name="csp-nonce"]');if(t&&t.hasAttribute("content"))return t.getAttribute("content");const n=document.querySelector("script[nonce]");return n&&n.nonce||""}()),AA}();e&&(n.nonce=e);const i=t===document?document.head:t,r=t===document?i.querySelector("script,link[rel=stylesheet],link[as=style],style"):i.firstChild;i.insertBefore(n,r)}TA.set(t,n),function kre(t){for(const n of k9)C9(t,n)}(n)}}function C9(t,n){const{sheet:e}=t,i=e.cssRules.length;n.split("}").forEach((r,s)=>{(r=r.trim())&&e.insertRule(r+"}",i+s)})}let AA;typeof document<"u"&&M9(document),J4(':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}');class PA{constructor(n){this.drainedOption=n,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(n){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),null==n?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),n))}pause(n=""){let{pauseDepths:e}=this;e[n]=(e[n]||0)+1,this.clearTimeout()}resume(n="",e){let{pauseDepths:i}=this;n in i&&(e?delete i[n]:(i[n]-=1,i[n]<=0&&delete i[n]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}}function IA(t){t.parentNode&&t.parentNode.removeChild(t)}function Sd(t,n){if(t.closest)return t.closest(n);if(!document.documentElement.contains(t))return null;do{if(S9(t,n))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}function S9(t,n){return(t.matches||t.matchesSelector||t.msMatchesSelector).call(t,n)}const Dre=/(top|left|right|bottom|width|height)$/i;function Ck(t,n){for(let e in n)E9(t,e,n[e])}function E9(t,n,e){t.style[n]=null==e?"":"number"==typeof e&&Dre.test(n)?`${e}px`:e}function D9(t){var n,e;return null!==(e=null===(n=t.composedPath)||void 0===n?void 0:n.call(t)[0])&&void 0!==e?e:t.target}let T9=0;function z1(){return T9+=1,"fc-dom-"+T9}function e5(t){t.preventDefault()}function A9(t,n,e,i){let r=function Tre(t,n){return e=>{let i=Sd(e.target,t);i&&n.call(i,e,i)}}(e,i);return t.addEventListener(n,r),()=>{t.removeEventListener(n,r)}}const P9=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function I9(t){return Object.assign({onClick:t},O9(t))}function O9(t){return{tabIndex:0,onKeyDown(n){("Enter"===n.key||" "===n.key)&&(t(n),n.preventDefault())}}}let R9=0;function J_(){return R9+=1,String(R9)}function OA(){document.body.classList.add("fc-not-allowed")}function RA(){document.body.classList.remove("fc-not-allowed")}function Nre(t,n,e){return e.func?e.func(t,n):function Bre(t,n){return t||n?null==n?-1:null==t?1:"string"==typeof t||"string"==typeof n?String(t).localeCompare(String(n)):t-n:0}(t[e.field],n[e.field])*(e.order||1)}function j2(t,n){let e=String(t);return"000".substr(0,n-e.length)+e}function Sk(t,n,e){return"function"==typeof t?t(...n):"string"==typeof t?n.reduce((i,r,s)=>i.replace("$"+s,r||""),t):e}function Vre(t,n){return t-n}function t5(t){return t%1==0}function jre(t){let n=t.querySelector(".fc-scrollgrid-shrink-frame"),e=t.querySelector(".fc-scrollgrid-shrink-cushion");if(!n)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!e)throw new Error("needs fc-scrollgrid-shrink-cushion className");return t.getBoundingClientRect().width-n.getBoundingClientRect().width+e.getBoundingClientRect().width}const L9=["years","months","days","milliseconds"],Hre=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function ko(t,n){return"string"==typeof t?function Ure(t){let n=Hre.exec(t);if(n){let e=n[1]?-1:1;return{years:0,months:0,days:e*(n[2]?parseInt(n[2],10):0),milliseconds:e*(60*(n[3]?parseInt(n[3],10):0)*60*1e3+60*(n[4]?parseInt(n[4],10):0)*1e3+1e3*(n[5]?parseInt(n[5],10):0)+(n[6]?parseInt(n[6],10):0))}}return null}(t):"object"==typeof t&&t?F9(t):"number"==typeof t?F9({[n||"milliseconds"]:t}):null}function F9(t){let n={years:t.years||t.year||0,months:t.months||t.month||0,days:t.days||t.day||0,milliseconds:60*(t.hours||t.hour||0)*60*1e3+60*(t.minutes||t.minute||0)*1e3+1e3*(t.seconds||t.second||0)+(t.milliseconds||t.millisecond||t.ms||0)},e=t.weeks||t.week;return e&&(n.days+=7*e,n.specifiedWeeks=!0),n}function LA(t,n){return{years:t.years+n.years,months:t.months+n.months,days:t.days+n.days,milliseconds:t.milliseconds+n.milliseconds}}function H2(t){return Xh(t)/864e5}function Xh(t){return 31536e6*t.years+2592e6*t.months+864e5*t.days+t.milliseconds}function FA(t,n){let e=null;for(let i=0;i<L9.length;i+=1){let r=L9[i];if(n[r]){let s=t[r]/n[r];if(!t5(s)||null!==e&&e!==s)return null;e=s}else if(t[r])return null}return e}function zA(t){let n=t.milliseconds;if(n){if(n%1e3!=0)return{unit:"millisecond",value:n};if(n%6e4!=0)return{unit:"second",value:n/1e3};if(n%36e5!=0)return{unit:"minute",value:n/6e4};if(n)return{unit:"hour",value:n/36e5}}return t.days?t.specifiedWeeks&&t.days%7==0?{unit:"week",value:t.days/7}:{unit:"day",value:t.days}:t.months?{unit:"month",value:t.months}:t.years?{unit:"year",value:t.years}:{unit:"millisecond",value:0}}function Nf(t,n,e){if(t===n)return!0;let r,i=t.length;if(i!==n.length)return!1;for(r=0;r<i;r+=1)if(!(e?e(t[r],n[r]):t[r]===n[r]))return!1;return!0}const z9=["sun","mon","tue","wed","thu","fri","sat"];function N9(t,n){let e=V1(t);return e[2]+=7*n,Mh(e)}function Oc(t,n){let e=V1(t);return e[2]+=n,Mh(e)}function N1(t,n){let e=V1(t);return e[6]+=n,Mh(e)}function B1(t,n){return(n.valueOf()-t.valueOf())/864e5}function n5(t,n){return j1(t)===j1(n)?Math.round(B1(t,n)):null}function $s(t){return Mh([t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()])}function NA(t,n,e,i){let r=Mh([n,0,1+ooe(n,e,i)]),s=$s(t),c=Math.round(B1(r,s));return Math.floor(c/7)+1}function ooe(t,n,e){let i=7+n-e;return-(7+Mh([t,0,i]).getUTCDay()-n)%7+i-1}function B9(t){return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]}function V9(t){return new Date(t[0],t[1]||0,null==t[2]?1:t[2],t[3]||0,t[4]||0,t[5]||0)}function V1(t){return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()]}function Mh(t){return 1===t.length&&(t=t.concat([0])),new Date(Date.UTC(...t))}function j9(t){return!isNaN(t.valueOf())}function j1(t){return 1e3*t.getUTCHours()*60*60+1e3*t.getUTCMinutes()*60+1e3*t.getUTCSeconds()+t.getUTCMilliseconds()}function H9(t,n,e=!1){let i=t.toISOString();return i=i.replace(".000",""),e&&(i=i.replace("T00:00:00Z","")),i.length>10&&(null==n?i=i.replace("Z",""):0!==n&&(i=i.replace("Z",BA(n,!0)))),i}function Ek(t){return t.toISOString().replace(/T.*$/,"")}function aoe(t){return j2(t.getUTCHours(),2)+":"+j2(t.getUTCMinutes(),2)+":"+j2(t.getUTCSeconds(),2)}function BA(t,n=!1){let e=t<0?"-":"+",i=Math.abs(t),r=Math.floor(i/60),s=Math.round(i%60);return n?`${e+j2(r,2)}:${j2(s,2)}`:`GMT${e}${r}${s?`:${j2(s,2)}`:""}`}function er(t,n,e){let i,r;return function(...s){if(i){if(!Nf(i,s)){e&&e(r);let c=t.apply(this,s);(!n||!n(c,r))&&(r=c)}}else r=t.apply(this,s);return i=s,r}}function r5(t,n,e){let i,r;return s=>{if(i){if(!Bf(i,s)){e&&e(r);let c=t.call(this,s);(!n||!n(c,r))&&(r=c)}}else r=t.call(this,s);return i=s,r}}const VA={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},o5={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},s5=/\s*([ap])\.?m\.?/i,loe=/,/g,coe=/\s+/g,doe=/\u200e/g,hoe=/UTC|GMT/;class uoe{constructor(n){let e={},i={},r=9;for(let s in n)s in VA?(i[s]=n[s],VA[s]<9&&(r=Math.min(VA[s],r))):(e[s]=n[s],s in o5&&(r=Math.min(o5[s],r)));this.standardDateProps=e,this.extendedSettings=i,this.smallestUnitNum=r,this.buildFormattingFunc=er(U9)}format(n,e){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,e)(n)}formatRange(n,e,i,r){let{standardDateProps:s,extendedSettings:c}=this,f=function yoe(t,n,e){return e.getMarkerYear(t)!==e.getMarkerYear(n)?5:e.getMarkerMonth(t)!==e.getMarkerMonth(n)?4:e.getMarkerDay(t)!==e.getMarkerDay(n)?2:j1(t)!==j1(n)?1:0}(n.marker,e.marker,i.calendarSystem);if(!f)return this.format(n,i);let y=f;y>1&&("numeric"===s.year||"2-digit"===s.year)&&("numeric"===s.month||"2-digit"===s.month)&&("numeric"===s.day||"2-digit"===s.day)&&(y=1);let k=this.format(n,i),E=this.format(e,i);if(k===E)return k;let F=function voe(t,n){let e={};for(let i in t)(!(i in o5)||o5[i]<=n)&&(e[i]=t[i]);return e}(s,y),$=U9(F,c,i),W=$(n),re=$(e),he=function boe(t,n,e,i){let r=0;for(;r<t.length;){let s=t.indexOf(n,r);if(-1===s)break;let c=t.substr(0,s);r=s+n.length;let f=t.substr(r),y=0;for(;y<e.length;){let k=e.indexOf(i,y);if(-1===k)break;let E=e.substr(0,k);y=k+i.length;let F=e.substr(y);if(c===E&&f===F)return{before:c,after:f}}}return null}(k,W,E,re),me=c.separator||r||i.defaultSeparator||"";return he?he.before+W+me+re+he.after:k+me+E}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}}function U9(t,n,e){let i=Object.keys(t).length;return 1===i&&"short"===t.timeZoneName?r=>BA(r.timeZoneOffset):0===i&&n.week?r=>function _oe(t,n,e,i,r){let s=[];return"long"===r?s.push(e):("short"===r||"narrow"===r)&&s.push(n),("long"===r||"short"===r)&&s.push(" "),s.push(i.simpleNumberFormat.format(t)),"rtl"===i.options.direction&&s.reverse(),s.join("")}(e.computeWeekNumber(r.marker),e.weekText,e.weekTextLong,e.locale,n.week):function poe(t,n,e){t=Object.assign({},t),n=Object.assign({},n),function foe(t,n){t.timeZoneName&&(t.hour||(t.hour="2-digit"),t.minute||(t.minute="2-digit")),"long"===t.timeZoneName&&(t.timeZoneName="short"),n.omitZeroMinute&&(t.second||t.millisecond)&&delete n.omitZeroMinute}(t,n),t.timeZone="UTC";let r,i=new Intl.DateTimeFormat(e.locale.codes,t);if(n.omitZeroMinute){let s=Object.assign({},t);delete s.minute,r=new Intl.DateTimeFormat(e.locale.codes,s)}return s=>{let f,{marker:c}=s;return f=r&&!c.getUTCMinutes()?r:i,function moe(t,n,e,i,r){return t=t.replace(doe,""),"short"===e.timeZoneName&&(t=function goe(t,n){let e=!1;return t=t.replace(hoe,()=>(e=!0,n)),e||(t+=` ${n}`),t}(t,"UTC"===r.timeZone||null==n.timeZoneOffset?"UTC":BA(n.timeZoneOffset))),i.omitCommas&&(t=t.replace(loe,"").trim()),i.omitZeroMinute&&(t=t.replace(":00","")),!1===i.meridiem?t=t.replace(s5,"").trim():"narrow"===i.meridiem?t=t.replace(s5,(s,c)=>c.toLocaleLowerCase()):"short"===i.meridiem?t=t.replace(s5,(s,c)=>`${c.toLocaleLowerCase()}m`):"lowercase"===i.meridiem&&(t=t.replace(s5,s=>s.toLocaleLowerCase())),t=(t=t.replace(coe," ")).trim()}(f.format(c),s,t,n,e)}}(t,n,e)}function q9(t,n){let e=n.markerToArray(t.marker);return{marker:t.marker,timeZoneOffset:t.timeZoneOffset,array:e,year:e[0],month:e[1],day:e[2],hour:e[3],minute:e[4],second:e[5],millisecond:e[6]}}function a5(t,n,e,i){let r=q9(t,e.calendarSystem);return{date:r,start:r,end:n?q9(n,e.calendarSystem):null,timeZone:e.timeZone,localeCodes:e.locale.codes,defaultSeparator:i||e.defaultSeparator}}class xoe{constructor(n){this.cmdStr=n}format(n,e,i){return e.cmdFormatter(this.cmdStr,a5(n,null,e,i))}formatRange(n,e,i,r){return i.cmdFormatter(this.cmdStr,a5(n,e,i,r))}}class woe{constructor(n){this.func=n}format(n,e,i){return this.func(a5(n,null,e,i))}formatRange(n,e,i,r){return this.func(a5(n,e,i,r))}}function pa(t){return"object"==typeof t&&t?new uoe(t):"string"==typeof t?new xoe(t):"function"==typeof t?new woe(t):null}const $9={navLinkDayClick:Gt,navLinkWeekClick:Gt,duration:ko,bootstrapFontAwesome:Gt,buttonIcons:Gt,customButtons:Gt,defaultAllDayEventDuration:ko,defaultTimedEventDuration:ko,nextDayThreshold:ko,scrollTime:ko,scrollTimeReset:Boolean,slotMinTime:ko,slotMaxTime:ko,dayPopoverFormat:pa,slotDuration:ko,snapDuration:ko,headerToolbar:Gt,footerToolbar:Gt,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:pa,dayHeaderClassNames:Gt,dayHeaderContent:Gt,dayHeaderDidMount:Gt,dayHeaderWillUnmount:Gt,dayCellClassNames:Gt,dayCellContent:Gt,dayCellDidMount:Gt,dayCellWillUnmount:Gt,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:Gt,weekNumbers:Boolean,weekNumberClassNames:Gt,weekNumberContent:Gt,weekNumberDidMount:Gt,weekNumberWillUnmount:Gt,editable:Boolean,viewClassNames:Gt,viewDidMount:Gt,viewWillUnmount:Gt,nowIndicator:Boolean,nowIndicatorClassNames:Gt,nowIndicatorContent:Gt,nowIndicatorDidMount:Gt,nowIndicatorWillUnmount:Gt,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:Gt,locale:Gt,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:Gt,eventOrder:function Fre(t){let i,r,n=[],e=[];for("string"==typeof t?e=t.split(/\s*,\s*/):"function"==typeof t?e=[t]:Array.isArray(t)&&(e=t),i=0;i<e.length;i+=1)r=e[i],"string"==typeof r?n.push("-"===r.charAt(0)?{field:r.substring(1),order:-1}:{field:r,order:1}):"function"==typeof r&&n.push({func:r});return n},eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:Gt,contentHeight:Gt,direction:String,weekNumberFormat:pa,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:Gt,initialDate:Gt,now:Gt,eventDataTransform:Gt,stickyHeaderDates:Gt,stickyFooterScrollbar:Gt,viewHeight:Gt,defaultAllDay:Boolean,eventSourceFailure:Gt,eventSourceSuccess:Gt,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:Gt,eventConstraint:Gt,eventAllow:Gt,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:Gt,eventContent:Gt,eventDidMount:Gt,eventWillUnmount:Gt,selectConstraint:Gt,selectOverlap:Gt,selectAllow:Gt,droppable:Boolean,unselectCancel:String,slotLabelFormat:Gt,slotLaneClassNames:Gt,slotLaneContent:Gt,slotLaneDidMount:Gt,slotLaneWillUnmount:Gt,slotLabelClassNames:Gt,slotLabelContent:Gt,slotLabelDidMount:Gt,slotLabelWillUnmount:Gt,dayMaxEvents:Gt,dayMaxEventRows:Gt,dayMinWidth:Number,slotLabelInterval:ko,allDayText:String,allDayClassNames:Gt,allDayContent:Gt,allDayDidMount:Gt,allDayWillUnmount:Gt,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:pa,rerenderDelay:Number,moreLinkText:Gt,moreLinkHint:Gt,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:Gt,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:ko,hiddenDays:Gt,fixedWeekCount:Boolean,validRange:Gt,visibleRange:Gt,titleFormat:Gt,eventInteractive:Boolean,noEventsText:String,viewHint:Gt,navLinkHint:Gt,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:Gt,moreLinkClassNames:Gt,moreLinkContent:Gt,moreLinkDidMount:Gt,moreLinkWillUnmount:Gt,monthStartFormat:pa,handleCustomRendering:Gt,customRenderingMetaMap:Gt,customRenderingReplaces:Boolean},Dk={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"}},G9={datesSet:Gt,eventsSet:Gt,eventAdd:Gt,eventChange:Gt,eventRemove:Gt,windowResize:Gt,eventClick:Gt,eventMouseEnter:Gt,eventMouseLeave:Gt,select:Gt,unselect:Gt,loading:Gt,_unmount:Gt,_beforeprint:Gt,_afterprint:Gt,_noEventDrop:Gt,_noEventResize:Gt,_resize:Gt,_scrollRequest:Gt},W9={buttonText:Gt,buttonHints:Gt,views:Gt,plugins:Gt,initialEvents:Gt,events:Gt,eventSources:Gt},ey={headerToolbar:ty,footerToolbar:ty,buttonText:ty,buttonHints:ty,buttonIcons:ty,dateIncrement:ty,plugins:l5,events:l5,eventSources:l5,resources:l5};function ty(t,n){return"object"==typeof t&&"object"==typeof n&&t&&n?Bf(t,n):t===n}function l5(t,n){return Array.isArray(t)&&Array.isArray(n)?Nf(t,n):t===n}const koe={type:String,component:Gt,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:Gt,usesMinMaxTime:Boolean,classNames:Gt,content:Gt,didMount:Gt,willUnmount:Gt};function jA(t){return HA(t,ey)}function c5(t,n){let e={},i={};for(let r in n)r in t&&(e[r]=n[r](t[r]));for(let r in t)r in n||(i[r]=t[r]);return{refined:e,extra:i}}function Gt(t){return t}const{hasOwnProperty:d5}=Object.prototype;function HA(t,n){let e={};if(n)for(let i in n)if(n[i]===ty){let r=[];for(let s=t.length-1;s>=0;s-=1){let c=t[s][i];if("object"==typeof c&&c)r.unshift(c);else if(void 0!==c){e[i]=c;break}}r.length&&(e[i]=HA(r))}for(let i=t.length-1;i>=0;i-=1){let r=t[i];for(let s in r)s in e||(e[s]=r[s])}return e}function ny(t,n){let e={};for(let i in t)n(t[i],i)&&(e[i]=t[i]);return e}function tg(t,n){let e={};for(let i in t)e[i]=n(t[i],i);return e}function Z9(t){let n={};for(let e of t)n[e]=!0;return n}function UA(t){let n=[];for(let e in t)n.push(t[e]);return n}function Bf(t,n){if(t===n)return!0;for(let e in t)if(d5.call(t,e)&&!(e in n))return!1;for(let e in n)if(d5.call(n,e)&&t[e]!==n[e])return!1;return!0}const Moe=/^on[A-Z]/;function qA(t,n){let e=[];for(let i in t)d5.call(t,i)&&(i in n||e.push(i));for(let i in n)d5.call(n,i)&&t[i]!==n[i]&&e.push(i);return e}function $A(t,n,e={}){if(t===n)return!0;for(let i in n)if(!(i in t)||!Soe(t[i],n[i],e[i]))return!1;for(let i in t)if(!(i in n))return!1;return!0}function Soe(t,n,e){return t===n||!0===e||!!e&&e(t,n)}let Y9={};!function Doe(t,n){Y9[t]=n}("gregory",class Aoe{getMarkerYear(n){return n.getUTCFullYear()}getMarkerMonth(n){return n.getUTCMonth()}getMarkerDay(n){return n.getUTCDate()}arrayToMarker(n){return Mh(n)}markerToArray(n){return V1(n)}});const Poe=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;class Ooe{constructor(n){let e=this.timeZone=n.timeZone,i="local"!==e&&"UTC"!==e;n.namedTimeZoneImpl&&i&&(this.namedTimeZoneImpl=new n.namedTimeZoneImpl(e)),this.canComputeOffset=!(i&&!this.namedTimeZoneImpl),this.calendarSystem=function Toe(t){return new Y9[t]}(n.calendarSystem),this.locale=n.locale,this.weekDow=n.locale.week.dow,this.weekDoy=n.locale.week.doy,"ISO"===n.weekNumberCalculation&&(this.weekDow=1,this.weekDoy=4),"number"==typeof n.firstDay&&(this.weekDow=n.firstDay),"function"==typeof n.weekNumberCalculation&&(this.weekNumberFunc=n.weekNumberCalculation),this.weekText=null!=n.weekText?n.weekText:n.locale.options.weekText,this.weekTextLong=(null!=n.weekTextLong?n.weekTextLong:n.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=n.cmdFormatter,this.defaultSeparator=n.defaultSeparator}createMarker(n){let e=this.createMarkerMeta(n);return null===e?null:e.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker((new Date).valueOf()):Mh(B9(new Date))}createMarkerMeta(n){if("string"==typeof n)return this.parse(n);let e=null;return"number"==typeof n?e=this.timestampToMarker(n):n instanceof Date?(n=n.valueOf(),isNaN(n)||(e=this.timestampToMarker(n))):Array.isArray(n)&&(e=Mh(n)),null!==e&&j9(e)?{marker:e,isTimeUnspecified:!1,forcedTzo:null}:null}parse(n){let e=function Ioe(t){let n=Poe.exec(t);if(n){let e=new Date(Date.UTC(Number(n[1]),n[3]?Number(n[3])-1:0,Number(n[5]||1),Number(n[7]||0),Number(n[8]||0),Number(n[10]||0),n[12]?1e3*+`0.${n[12]}`:0));if(j9(e)){let i=null;return n[13]&&(i=("-"===n[15]?-1:1)*(60*Number(n[16]||0)+Number(n[18]||0))),{marker:e,isTimeUnspecified:!n[6],timeZoneOffset:i}}}return null}(n);if(null===e)return null;let{marker:i}=e,r=null;return null!==e.timeZoneOffset&&(this.canComputeOffset?i=this.timestampToMarker(i.valueOf()-60*e.timeZoneOffset*1e3):r=e.timeZoneOffset),{marker:i,isTimeUnspecified:e.isTimeUnspecified,forcedTzo:r}}getYear(n){return this.calendarSystem.getMarkerYear(n)}getMonth(n){return this.calendarSystem.getMarkerMonth(n)}getDay(n){return this.calendarSystem.getMarkerDay(n)}add(n,e){let i=this.calendarSystem.markerToArray(n);return i[0]+=e.years,i[1]+=e.months,i[2]+=e.days,i[6]+=e.milliseconds,this.calendarSystem.arrayToMarker(i)}subtract(n,e){let i=this.calendarSystem.markerToArray(n);return i[0]-=e.years,i[1]-=e.months,i[2]-=e.days,i[6]-=e.milliseconds,this.calendarSystem.arrayToMarker(i)}addYears(n,e){let i=this.calendarSystem.markerToArray(n);return i[0]+=e,this.calendarSystem.arrayToMarker(i)}addMonths(n,e){let i=this.calendarSystem.markerToArray(n);return i[1]+=e,this.calendarSystem.arrayToMarker(i)}diffWholeYears(n,e){let{calendarSystem:i}=this;return j1(n)===j1(e)&&i.getMarkerDay(n)===i.getMarkerDay(e)&&i.getMarkerMonth(n)===i.getMarkerMonth(e)?i.getMarkerYear(e)-i.getMarkerYear(n):null}diffWholeMonths(n,e){let{calendarSystem:i}=this;return j1(n)===j1(e)&&i.getMarkerDay(n)===i.getMarkerDay(e)?i.getMarkerMonth(e)-i.getMarkerMonth(n)+12*(i.getMarkerYear(e)-i.getMarkerYear(n)):null}greatestWholeUnit(n,e){let i=this.diffWholeYears(n,e);return null!==i?{unit:"year",value:i}:(i=this.diffWholeMonths(n,e),null!==i?{unit:"month",value:i}:(i=function eoe(t,n){let e=n5(t,n);return null!==e&&e%7==0?e/7:null}(n,e),null!==i?{unit:"week",value:i}:(i=n5(n,e),null!==i?{unit:"day",value:i}:(i=function Xre(t,n){return(n.valueOf()-t.valueOf())/36e5}(n,e),t5(i)?{unit:"hour",value:i}:(i=function Kre(t,n){return(n.valueOf()-t.valueOf())/6e4}(n,e),t5(i)?{unit:"minute",value:i}:(i=function Qre(t,n){return(n.valueOf()-t.valueOf())/1e3}(n,e),t5(i)?{unit:"second",value:i}:{unit:"millisecond",value:e.valueOf()-n.valueOf()}))))))}countDurationsBetween(n,e,i){let r;return i.years&&(r=this.diffWholeYears(n,e),null!==r)?r/function Wre(t){return H2(t)/365}(i):i.months&&(r=this.diffWholeMonths(n,e),null!==r)?r/function Zre(t){return H2(t)/30}(i):i.days&&(r=n5(n,e),null!==r)?r/H2(i):(e.valueOf()-n.valueOf())/Xh(i)}startOf(n,e){return"year"===e?this.startOfYear(n):"month"===e?this.startOfMonth(n):"week"===e?this.startOfWeek(n):"day"===e?$s(n):"hour"===e?function toe(t){return Mh([t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours()])}(n):"minute"===e?function noe(t){return Mh([t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes()])}(n):"second"===e?function ioe(t){return Mh([t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds()])}(n):null}startOfYear(n){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(n)])}startOfMonth(n){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(n),this.calendarSystem.getMarkerMonth(n)])}startOfWeek(n){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(n),this.calendarSystem.getMarkerMonth(n),n.getUTCDate()-(n.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(n){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(n)):function roe(t,n,e){let i=t.getUTCFullYear(),r=NA(t,i,n,e);if(r<1)return NA(t,i-1,n,e);let s=NA(t,i+1,n,e);return s>=1?Math.min(r,s):r}(n,this.weekDow,this.weekDoy)}format(n,e,i={}){return e.format({marker:n,timeZoneOffset:null!=i.forcedTzo?i.forcedTzo:this.offsetForMarker(n)},this)}formatRange(n,e,i,r={}){return r.isEndExclusive&&(e=N1(e,-1)),i.formatRange({marker:n,timeZoneOffset:null!=r.forcedStartTzo?r.forcedStartTzo:this.offsetForMarker(n)},{marker:e,timeZoneOffset:null!=r.forcedEndTzo?r.forcedEndTzo:this.offsetForMarker(e)},this,r.defaultSeparator)}formatIso(n,e={}){let i=null;return e.omitTimeZoneOffset||(i=null!=e.forcedTzo?e.forcedTzo:this.offsetForMarker(n)),H9(n,i,e.omitTime)}timestampToMarker(n){return"local"===this.timeZone?Mh(B9(new Date(n))):"UTC"!==this.timeZone&&this.namedTimeZoneImpl?Mh(this.namedTimeZoneImpl.timestampToArray(n)):new Date(n)}offsetForMarker(n){return"local"===this.timeZone?-V9(V1(n)).getTimezoneOffset():"UTC"===this.timeZone?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(V1(n)):null}toDate(n,e){return"local"===this.timeZone?V9(V1(n)):"UTC"===this.timeZone?new Date(n.valueOf()):this.namedTimeZoneImpl?new Date(n.valueOf()-1e3*this.namedTimeZoneImpl.offsetForArray(V1(n))*60):new Date(n.valueOf()-(e||0))}}class Tk{constructor(n){this.iconOverrideOption&&this.setIconOverride(n[this.iconOverrideOption])}setIconOverride(n){let e,i;if("object"==typeof n&&n){for(i in e=Object.assign({},this.iconClasses),n)e[i]=this.applyIconOverridePrefix(n[i]);this.iconClasses=e}else!1===n&&(this.iconClasses={})}applyIconOverridePrefix(n){let e=this.iconOverridePrefix;return e&&0!==n.indexOf(e)&&(n=e+n),n}getClass(n){return this.classes[n]||""}getIconClass(n,e){let i;return i=e&&this.rtlIconClasses&&this.rtlIconClasses[n]||this.iconClasses[n],i?`${this.baseIconClass} ${i}`:""}getCustomButtonIconClass(n){let e;return this.iconOverrideCustomButtonOption&&(e=n[this.iconOverrideCustomButtonOption],e)?`${this.baseIconClass} ${this.applyIconOverridePrefix(e)}`:""}}function h5(t){t();let n=ji.debounceRendering,e=[];for(ji.debounceRendering=function i(r){e.push(r)},L1(et(Roe,{}),document.createElement("div"));e.length;)e.shift()();ji.debounceRendering=n}Tk.prototype.classes={},Tk.prototype.iconClasses={},Tk.prototype.baseIconClass="",Tk.prototype.iconOverridePrefix="";class Roe extends kh{render(){return et("div",{})}componentDidMount(){this.setState({})}}function X9(t){let n=function WF(t,n){var e={__c:n="__cC"+IF++,__:t,Consumer:function(i,r){return i.children(r)},Provider:function(i){var r,s;return this.getChildContext||(r=[],(s={})[n]=this,this.getChildContext=function(){return s},this.shouldComponentUpdate=function(c){this.props.value!==c.value&&r.some(function(f){f.__e=!0,vA(f)})},this.sub=function(c){r.push(c);var f=c.componentWillUnmount;c.componentWillUnmount=function(){r.splice(r.indexOf(c),1),f&&f.call(c)}}),i.children}};return e.Provider.__=e.Consumer.contextType=e}(t),e=n.Provider;return n.Provider=function(){let i=!this.getChildContext,r=e.apply(this,arguments);if(i){let s=[];this.shouldComponentUpdate=c=>{this.props.value!==c.value&&s.forEach(f=>{f.context=c.value,f.forceUpdate()})},this.sub=c=>{s.push(c);let f=c.componentWillUnmount;c.componentWillUnmount=()=>{s.splice(s.indexOf(c),1),f&&f.call(c)}}}return r},n}class Loe{constructor(n,e,i,r){this.execFunc=n,this.emitter=e,this.scrollTime=i,this.scrollTimeReset=r,this.handleScrollRequest=s=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},s),this.drain()},e.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(n){n&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}}const ng=X9({});function Foe(t,n,e,i,r,s,c,f,y,k,E,F,$,W){return{dateEnv:r,nowManager:s,options:e,pluginHooks:f,emitter:E,dispatch:y,getCurrentData:k,calendarApi:F,viewSpec:t,viewApi:n,dateProfileGenerator:i,theme:c,isRtl:"rtl"===e.direction,addResizeHandler(re){E.on("_resize",re)},removeResizeHandler(re){E.off("_resize",re)},createScrollResponder:re=>new Loe(re,E,ko(e.scrollTime),e.scrollTimeReset),registerInteractiveComponent:$,unregisterInteractiveComponent:W}}let u5=(()=>{class t extends kh{shouldComponentUpdate(e,i){return this.debug&&console.log(qA(e,this.props),qA(i,this.state)),!$A(this.props,e,this.propEquality)||!$A(this.state,i,this.stateEquality)}safeSetState(e){$A(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}}return t.addPropsEquality=zoe,t.addStateEquality=Noe,t.contextType=ng,t})();u5.prototype.propEquality={},u5.prototype.stateEquality={};let os=(()=>{class t extends u5{}return t.contextType=ng,t})();function zoe(t){let n=Object.create(this.prototype.propEquality);Object.assign(n,t),this.prototype.propEquality=n}function Noe(t){let n=Object.create(this.prototype.stateEquality);Object.assign(n,t),this.prototype.stateEquality=n}function ig(t,n){"function"==typeof t?t(n):t&&(t.current=n)}class GA extends os{constructor(){super(...arguments),this.id=J_(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=n=>{const{options:e}=this.context,{generatorName:i}=this.props;(!e.customRenderingReplaces||!WA(i,e))&&this.updateElRef(n)},this.updateElRef=n=>{this.props.elRef&&ig(this.props.elRef,n)}}render(){const{props:n,context:e}=this,{options:i}=e,{customGenerator:r,defaultGenerator:s,renderProps:c}=n,f=K9(n,[],this.handleEl);let k,F,y=!1,E=[];if(null!=r){const $="function"==typeof r?r(c,et):r;if(!0===$)y=!0;else{const W=$&&"object"==typeof $;W&&"html"in $?f.dangerouslySetInnerHTML={__html:$.html}:W&&"domNodes"in $?E=Array.prototype.slice.call($.domNodes):(W?TF($):"function"!=typeof $)?k=$:F=$}}else y=!WA(n.generatorName,i);return y&&s&&(k=s(c)),this.queuedDomNodes=E,this.currentGeneratorMeta=F,et(n.elTag,f,k)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(n){var e;const{props:i,context:r}=this,{handleCustomRendering:s,customRenderingMetaMap:c}=r.options;if(s){const f=null!==(e=this.currentGeneratorMeta)&&void 0!==e?e:c?.[i.generatorName];f&&s(Object.assign(Object.assign({id:this.id,isActive:n,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:f},i),{elClasses:(i.elClasses||[]).filter(Boe)}))}}applyQueueudDomNodes(){const{queuedDomNodes:n,currentDomNodes:e}=this,i=this.base;if(!Nf(n,e)){e.forEach(IA);for(let r of n)i.appendChild(r);this.currentDomNodes=n}}}function WA(t,n){var e;return!!(n.handleCustomRendering&&t&&null!==(e=n.customRenderingMetaMap)&&void 0!==e&&e[t])}function K9(t,n,e){const i=Object.assign(Object.assign({},t.elAttrs),{ref:e});return(t.elClasses||n)&&(i.className=(t.elClasses||[]).concat(n||[]).concat(i.className||[]).filter(Boolean).join(" ")),t.elStyle&&(i.style=t.elStyle),i}function Boe(t){return!!t}GA.addPropsEquality({elClasses:Nf,elStyle:Bf,elAttrs:function Coe(t,n){const e=qA(t,n);for(let i of e)if(!Moe.test(i))return!1;return!0},renderProps:Bf});const Q9=X9(0);let eh=(()=>{class t extends kh{constructor(){super(...arguments),this.InnerContent=Voe.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(ig(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){const{props:e}=this,i=function joe(t,n){const e="function"==typeof t?t(n):t||[];return"string"==typeof e?[e]:e}(e.classNameGenerator,e.renderProps);if(e.children){const r=K9(e,i,this.handleEl),s=e.children(this.InnerContent,e.renderProps,r);return e.elTag?et(e.elTag,r,s):s}return et(GA,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(i),renderId:this.context}))}componentDidMount(){var e,i;this.el?null===(i=(e=this.props).didMount)||void 0===i||i.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,i;null===(i=(e=this.props).willUnmount)||void 0===i||i.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}}return t.contextType=Q9,t})();function Voe(t,n){const e=t.props;return et(GA,Object.assign({renderProps:e.renderProps,generatorName:e.generatorName,customGenerator:e.customGenerator,defaultGenerator:e.defaultGenerator,renderId:t.context},n))}class Ak extends os{render(){let{props:n,context:e}=this,{options:i}=e,r={view:e.viewApi};return et(eh,Object.assign({},n,{elTag:n.elTag||"div",elClasses:[...J9(n.viewSpec),...n.elClasses||[]],renderProps:r,classNameGenerator:i.viewClassNames,generatorName:void 0,didMount:i.viewDidMount,willUnmount:i.viewWillUnmount}),()=>n.children)}}function J9(t){return[`fc-${t.type}-view`,"fc-view"]}function ez(t,n){let r,s,e=[],{start:i}=n;for(t.sort(Uoe),r=0;r<t.length;r+=1)s=t[r],s.start>i&&e.push({start:i,end:s.start}),s.end>i&&(i=s.end);return i<n.end&&e.push({start:i,end:n.end}),e}function Uoe(t,n){return t.start.valueOf()-n.start.valueOf()}function H1(t,n){let{start:e,end:i}=t,r=null;return null!==n.start&&(e=null===e?n.start:new Date(Math.max(e.valueOf(),n.start.valueOf()))),null!=n.end&&(i=null===i?n.end:new Date(Math.min(i.valueOf(),n.end.valueOf()))),(null===e||null===i||e<i)&&(r={start:e,end:i}),r}function ZA(t,n){return(null===t.end||null===n.start||t.end>n.start)&&(null===t.start||null===n.end||t.start<n.end)}function p5(t,n){return(null===t.start||null!==n.start&&n.start>=t.start)&&(null===t.end||null!==n.end&&n.end<=t.end)}function rg(t,n){return(null===t.start||n>=t.start)&&(null===t.end||n<t.end)}function tz(t){let n=Math.floor(B1(t.start,t.end))||1,e=$s(t.start);return{start:e,end:Oc(e,n)}}function YA(t,n=ko(0)){let e=null,i=null;if(t.end){i=$s(t.end);let r=t.end.valueOf()-i.valueOf();r&&r>=Xh(n)&&(i=Oc(i,1))}return t.start&&(e=$s(t.start),i&&i<=e&&(i=Oc(e,1))),{start:e,end:i}}function U2(t,n,e,i){return"year"===i?ko(e.diffWholeYears(t,n),"year"):"month"===i?ko(e.diffWholeMonths(t,n),"month"):function Jre(t,n){let e=$s(t),i=$s(n);return{years:0,months:0,days:Math.round(B1(e,i)),milliseconds:n.valueOf()-i.valueOf()-(t.valueOf()-e.valueOf())}}(t,n)}class nz{constructor(n){this.props=n,this.initHiddenDays()}buildPrev(n,e,i){let{dateEnv:r}=this.props,s=r.subtract(r.startOf(e,n.currentRangeUnit),n.dateIncrement);return this.build(s,-1,i)}buildNext(n,e,i){let{dateEnv:r}=this.props,s=r.add(r.startOf(e,n.currentRangeUnit),n.dateIncrement);return this.build(s,1,i)}build(n,e,i=!0){let s,c,f,y,k,E,{props:r}=this;return s=this.buildValidRange(),s=this.trimHiddenDays(s),i&&(n=function $oe(t,n){return null!=n.start&&t<n.start?n.start:null!=n.end&&t>=n.end?new Date(n.end.valueOf()-1):t}(n,s)),c=this.buildCurrentRangeInfo(n,e),f=/^(year|month|week|day)$/.test(c.unit),y=this.buildRenderRange(this.trimHiddenDays(c.range),c.unit,f),y=this.trimHiddenDays(y),k=y,r.showNonCurrentDates||(k=H1(k,c.range)),k=this.adjustActiveRange(k),k=H1(k,s),E=ZA(c.range,s),rg(y,n)||(n=y.start),{currentDate:n,validRange:s,currentRange:c.range,currentRangeUnit:c.unit,isRangeAllDay:f,activeRange:k,renderRange:y,slotMinTime:r.slotMinTime,slotMaxTime:r.slotMaxTime,isValid:E,dateIncrement:this.buildDateIncrement(c.duration)}}buildValidRange(){let n=this.props.validRangeInput,e="function"==typeof n?n.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):n;return this.refineRange(e)||{start:null,end:null}}buildCurrentRangeInfo(n,e){let f,{props:i}=this,r=null,s=null,c=null;return i.duration?(r=i.duration,s=i.durationUnit,c=this.buildRangeFromDuration(n,e,r,s)):(f=this.props.dayCount)?(s="day",c=this.buildRangeFromDayCount(n,e,f)):(c=this.buildCustomVisibleRange(n))?s=i.dateEnv.greatestWholeUnit(c.start,c.end).unit:(r=this.getFallbackDuration(),s=zA(r).unit,c=this.buildRangeFromDuration(n,e,r,s)),{duration:r,unit:s,range:c}}getFallbackDuration(){return ko({day:1})}adjustActiveRange(n){let{dateEnv:e,usesMinMaxTime:i,slotMinTime:r,slotMaxTime:s}=this.props,{start:c,end:f}=n;return i&&(H2(r)<0&&(c=$s(c),c=e.add(c,r)),H2(s)>1&&(f=$s(f),f=Oc(f,-1),f=e.add(f,s))),{start:c,end:f}}buildRangeFromDuration(n,e,i,r){let f,y,k,{dateEnv:s,dateAlignment:c}=this.props;if(!c){let{dateIncrement:F}=this.props;c=F&&Xh(F)<Xh(i)?zA(F).unit:r}function E(){f=s.startOf(n,c),y=s.add(f,i),k={start:f,end:y}}return H2(i)<=1&&this.isHiddenDay(f)&&(f=this.skipHiddenDays(f,e),f=$s(f)),E(),this.trimHiddenDays(k)||(n=this.skipHiddenDays(n,e),E()),k}buildRangeFromDayCount(n,e,i){let y,{dateEnv:r,dateAlignment:s}=this.props,c=0,f=n;s&&(f=r.startOf(f,s)),f=$s(f),f=this.skipHiddenDays(f,e),y=f;do{y=Oc(y,1),this.isHiddenDay(y)||(c+=1)}while(c<i);return{start:f,end:y}}buildCustomVisibleRange(n){let{props:e}=this,i=e.visibleRangeInput,r="function"==typeof i?i.call(e.calendarApi,e.dateEnv.toDate(n)):i,s=this.refineRange(r);return!s||null!=s.start&&null!=s.end?s:null}buildRenderRange(n,e,i){return n}buildDateIncrement(n){let i,{dateIncrement:e}=this.props;return e||((i=this.props.dateAlignment)?ko(1,i):n||ko({days:1}))}refineRange(n){if(n){let e=function Hoe(t,n){let e=null,i=null;return t.start&&(e=n.createMarker(t.start)),t.end&&(i=n.createMarker(t.end)),!e&&!i||e&&i&&i<e?null:{start:e,end:i}}(n,this.props.dateEnv);return e&&(e=YA(e)),e}return null}initHiddenDays(){let r,n=this.props.hiddenDays||[],e=[],i=0;for(!1===this.props.weekends&&n.push(0,6),r=0;r<7;r+=1)(e[r]=-1!==n.indexOf(r))||(i+=1);if(!i)throw new Error("invalid hiddenDays");this.isHiddenDayHash=e}trimHiddenDays(n){let{start:e,end:i}=n;return e&&(e=this.skipHiddenDays(e)),i&&(i=this.skipHiddenDays(i,-1,!0)),null==e||null==i||e<i?{start:e,end:i}:null}isHiddenDay(n){return n instanceof Date&&(n=n.getUTCDay()),this.isHiddenDayHash[n]}skipHiddenDays(n,e=1,i=!1){for(;this.isHiddenDayHash[(n.getUTCDay()+(i?e:0)+7)%7];)n=Oc(n,e);return n}}function XA(t,n,e,i){return{instanceId:J_(),defId:t,range:n,forcedStartTzo:e??null,forcedEndTzo:i??null}}function iy(t,n,e){let{dateEnv:i,pluginHooks:r,options:s}=e,{defs:c,instances:f}=t;f=ny(f,y=>!c[y.defId].recurringDef);for(let y in c){let k=c[y];if(k.recurringDef){let{duration:E}=k.recurringDef;E||(E=k.allDay?s.defaultAllDayEventDuration:s.defaultTimedEventDuration);let F=Zoe(k,E,n,i,r.recurringTypes);for(let $ of F){let W=XA(y,{start:$,end:i.add($,E)});f[W.instanceId]=W}}}return{defs:c,instances:f}}function Zoe(t,n,e,i,r){let c=r[t.recurringDef.typeId].expand(t.recurringDef.typeData,{start:i.subtract(e.start,n),end:e.end},i);return t.allDay&&(c=c.map($s)),c}const f5={id:String,groupId:String,title:String,url:String,interactive:Boolean},iz={start:Gt,end:Gt,date:Gt,allDay:Boolean},Yoe=Object.assign(Object.assign(Object.assign({},f5),iz),{extendedProps:Gt});function rz(t,n,e,i,r=KA(e),s,c){let{refined:f,extra:y}=oz(t,e,r),k=function Koe(t,n){let e=null;return t&&(e=t.defaultAllDay),null==e&&(e=n.options.defaultAllDay),e}(n,e),E=function Woe(t,n,e,i){for(let r=0;r<i.length;r+=1){let s=i[r].parse(t,e);if(s){let{allDay:c}=t;return null==c&&(c=n,null==c&&(c=s.allDayGuess,null==c&&(c=!1))),{allDay:c,duration:s.duration,typeData:s.typeData,typeId:r}}}return null}(f,k,e.dateEnv,e.pluginHooks.recurringTypes);if(E){let $=QA(f,y,n?n.sourceId:"",E.allDay,!!E.duration,e,s);return $.recurringDef={typeId:E.typeId,typeData:E.typeData,duration:E.duration},{def:$,instance:null}}let F=function Xoe(t,n,e,i){let s,y,{allDay:r}=t,c=null,f=!1,k=null;if(s=e.dateEnv.createMarkerMeta(null!=t.start?t.start:t.date),s)c=s.marker;else if(!i)return null;return null!=t.end&&(y=e.dateEnv.createMarkerMeta(t.end)),null==r&&(r=null!=n?n:(!s||s.isTimeUnspecified)&&(!y||y.isTimeUnspecified)),r&&c&&(c=$s(c)),y&&(k=y.marker,r&&(k=$s(k)),c&&k<=c&&(k=null)),k?f=!0:i||(f=e.options.forceEventDuration||!1,k=e.dateEnv.add(c,r?e.options.defaultAllDayEventDuration:e.options.defaultTimedEventDuration)),{allDay:r,hasEnd:f,range:{start:c,end:k},forcedStartTzo:s?s.forcedTzo:null,forcedEndTzo:y?y.forcedTzo:null}}(f,k,e,i);if(F){let $=QA(f,y,n?n.sourceId:"",F.allDay,F.hasEnd,e,s),W=XA($.defId,F.range,F.forcedStartTzo,F.forcedEndTzo);return c&&$.publicId&&c[$.publicId]&&(W.instanceId=c[$.publicId]),{def:$,instance:W}}return null}function oz(t,n,e=KA(n)){return c5(t,e)}function KA(t){return Object.assign(Object.assign(Object.assign({},g5),Yoe),t.pluginHooks.eventRefiners)}function QA(t,n,e,i,r,s,c){let f={title:t.title||"",groupId:t.groupId||"",publicId:t.id||"",url:t.url||"",recurringDef:null,defId:(c&&t.id?c[t.id]:"")||J_(),sourceId:e,allDay:i,hasEnd:r,interactive:t.interactive,ui:_5(t,s),extendedProps:Object.assign(Object.assign({},t.extendedProps||{}),n)};for(let y of s.pluginHooks.eventDefMemberAdders)Object.assign(f,y(t));return Object.freeze(f.ui.classNames),Object.freeze(f.extendedProps),f}function Pk(t,n,e,i,r,s){let c={defs:{},instances:{}},f=KA(e);for(let y of t){let k=rz(y,n,e,i,f,r,s);k&&JA(k,c)}return c}function JA(t,n={defs:{},instances:{}}){return n.defs[t.def.defId]=t.def,t.instance&&(n.instances[t.instance.instanceId]=t.instance),n}function eP(t,n){let e=t.instances[n];if(e){let i=t.defs[e.defId],r=m5(t,s=>function Qoe(t,n){return!(!t.groupId||t.groupId!==n.groupId)}(i,s));return r.defs[i.defId]=i,r.instances[e.instanceId]=e,r}return{defs:{},instances:{}}}function tP(t,n){return{defs:Object.assign(Object.assign({},t.defs),n.defs),instances:Object.assign(Object.assign({},t.instances),n.instances)}}function m5(t,n){let e=ny(t.defs,n),i=ny(t.instances,r=>e[r.defId]);return{defs:e,instances:i}}function sz(t){return Array.isArray(t)?t:"string"==typeof t?t.split(/\s+/):[]}const g5={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:Gt,overlap:Gt,allow:Gt,className:sz,classNames:sz,color:String,backgroundColor:String,borderColor:String,textColor:String},tse={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function _5(t,n){let e=function ese(t,n){return Array.isArray(t)?Pk(t,null,n,!0):"object"==typeof t&&t?Pk([t],null,n,!0):null!=t?String(t):null}(t.constraint,n);return{display:t.display||null,startEditable:null!=t.startEditable?t.startEditable:t.editable,durationEditable:null!=t.durationEditable?t.durationEditable:t.editable,constraints:null!=e?[e]:[],overlap:null!=t.overlap?t.overlap:null,allows:null!=t.allow?[t.allow]:[],backgroundColor:t.backgroundColor||t.color||"",borderColor:t.borderColor||t.color||"",textColor:t.textColor||"",classNames:(t.className||[]).concat(t.classNames||[])}}function az(t){return t.reduce(nse,tse)}function nse(t,n){return{display:null!=n.display?n.display:t.display,startEditable:null!=n.startEditable?n.startEditable:t.startEditable,durationEditable:null!=n.durationEditable?n.durationEditable:t.durationEditable,constraints:t.constraints.concat(n.constraints),overlap:"boolean"==typeof n.overlap?n.overlap:t.overlap,allows:t.allows.concat(n.allows),backgroundColor:n.backgroundColor||t.backgroundColor,borderColor:n.borderColor||t.borderColor,textColor:n.textColor||t.textColor,classNames:t.classNames.concat(n.classNames)}}const ise={id:String,defaultAllDay:Boolean,url:String,format:String,events:Gt,eventDataTransform:Gt,success:Gt,failure:Gt};function lz(t,n,e=cz(n)){let i;if("string"==typeof t?i={url:t}:"function"==typeof t||Array.isArray(t)?i={events:t}:"object"==typeof t&&t&&(i=t),i){let{refined:r,extra:s}=c5(i,e),c=function rse(t,n){let e=n.pluginHooks.eventSourceDefs;for(let i=e.length-1;i>=0;i-=1){let s=e[i].parseMeta(t);if(s)return{sourceDefId:i,meta:s}}return null}(r,n);if(c)return{_raw:t,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:r.defaultAllDay,eventDataTransform:r.eventDataTransform,success:r.success,failure:r.failure,publicId:r.id||"",sourceId:J_(),sourceDefId:c.sourceDefId,meta:c.meta,ui:_5(r,n),extendedProps:s}}return null}function cz(t){return Object.assign(Object.assign(Object.assign({},g5),ise),t.pluginHooks.eventSourceRefiners)}function dz(t,n,e){let i=e.options.eventDataTransform,r=n?n.eventDataTransform:null;return r&&(t=hz(t,r)),i&&(t=hz(t,i)),t}function hz(t,n){let e;if(n){e=[];for(let i of t){let r=n(i);r?e.push(r):null==r&&e.push(i)}}else e=t;return e}function uz(t,n,e){let{defs:i}=t,r=tg(t.instances,s=>i[s.defId].allDay?s:Object.assign(Object.assign({},s),{range:{start:e.createMarker(n.toDate(s.range.start,s.forcedStartTzo)),end:e.createMarker(n.toDate(s.range.end,s.forcedEndTzo))},forcedStartTzo:e.canComputeOffset?null:s.forcedStartTzo,forcedEndTzo:e.canComputeOffset?null:s.forcedEndTzo}));return{defs:i,instances:r}}function pz(t,n){return m5(t,e=>e.sourceId!==n)}class y5{constructor(){this.handlers={},this.thisContext=null}setThisContext(n){this.thisContext=n}setOptions(n){this.options=n}on(n,e){!function hse(t,n,e){(t[n]||(t[n]=[])).push(e)}(this.handlers,n,e)}off(n,e){!function use(t,n,e){e?t[n]&&(t[n]=t[n].filter(i=>i!==e)):delete t[n]}(this.handlers,n,e)}trigger(n,...e){let s=[].concat(this.options&&this.options[n]||[],this.handlers[n]||[]);for(let c of s)c.apply(this.thisContext,e)}hasHandlers(n){return!!(this.handlers[n]&&this.handlers[n].length||this.options&&this.options[n])}}const pse={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function fz(t,n,e){e.emitter.trigger("select",Object.assign(Object.assign({},nP(t,e)),{jsEvent:n?n.origEvent:null,view:e.viewApi||e.calendarApi.view}))}function nP(t,n){let e={};for(let i of n.pluginHooks.dateSpanTransforms)Object.assign(e,i(t,n));return Object.assign(e,function Ase(t,n){return Object.assign(Object.assign({},xz(t.range,n,t.allDay)),{allDay:t.allDay})}(t,n.dateEnv)),e}function mz(t,n,e){let{dateEnv:i,options:r}=e,s=n;return t?(s=$s(s),s=i.add(s,r.defaultAllDayEventDuration)):s=i.add(s,r.defaultTimedEventDuration),s}function iP(t,n,e,i){let r=v5(t.defs,n),s={defs:{},instances:{}};for(let c in t.defs)s.defs[c]=_se(t.defs[c],r[c],e,i);for(let c in t.instances){let f=t.instances[c];s.instances[c]=yse(f,s.defs[f.defId],r[f.defId],e,i)}return s}function _se(t,n,e,i){let r=e.standardProps||{};null==r.hasEnd&&n.durationEditable&&(e.startDelta||e.endDelta)&&(r.hasEnd=!0);let s=Object.assign(Object.assign(Object.assign({},t),r),{ui:Object.assign(Object.assign({},t.ui),r.ui)});e.extendedProps&&(s.extendedProps=Object.assign(Object.assign({},s.extendedProps),e.extendedProps));for(let c of i.pluginHooks.eventDefMutationAppliers)c(s,e,i);return!s.hasEnd&&i.options.forceEventDuration&&(s.hasEnd=!0),s}function yse(t,n,e,i,r){let{dateEnv:s}=r,c=i.standardProps&&!0===i.standardProps.allDay,f=i.standardProps&&!1===i.standardProps.hasEnd,y=Object.assign({},t);return c&&(y.range=tz(y.range)),i.datesDelta&&e.startEditable&&(y.range={start:s.add(y.range.start,i.datesDelta),end:s.add(y.range.end,i.datesDelta)}),i.startDelta&&e.durationEditable&&(y.range={start:s.add(y.range.start,i.startDelta),end:y.range.end}),i.endDelta&&e.durationEditable&&(y.range={start:y.range.start,end:s.add(y.range.end,i.endDelta)}),f&&(y.range={start:y.range.start,end:mz(n.allDay,y.range.start,r)}),n.allDay&&(y.range={start:$s(y.range.start),end:$s(y.range.end)}),y.range.end<y.range.start&&(y.range.end=mz(n.allDay,y.range.start,r)),y}class q2{constructor(n,e){this.context=n,this.internalEventSource=e}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}}class Ba{constructor(n,e,i){this._context=n,this._def=e,this._instance=i||null}setProp(n,e){if(n in iz)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if("id"===n)e=f5[n](e),this.mutate({standardProps:{publicId:e}});else if(n in f5)e=f5[n](e),this.mutate({standardProps:{[n]:e}});else if(n in g5){let i=g5[n](e);i="color"===n?{backgroundColor:e,borderColor:e}:"editable"===n?{startEditable:e,durationEditable:e}:{[n]:e},this.mutate({standardProps:{ui:i}})}else console.warn(`Could not set prop '${n}'. Use setExtendedProp instead.`)}setExtendedProp(n,e){this.mutate({extendedProps:{[n]:e}})}setStart(n,e={}){let{dateEnv:i}=this._context,r=i.createMarker(n);if(r&&this._instance){let c=U2(this._instance.range.start,r,i,e.granularity);this.mutate(e.maintainDuration?{datesDelta:c}:{startDelta:c})}}setEnd(n,e={}){let r,{dateEnv:i}=this._context;if((null==n||(r=i.createMarker(n),r))&&this._instance)if(r){let s=U2(this._instance.range.end,r,i,e.granularity);this.mutate({endDelta:s})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(n,e,i={}){let f,{dateEnv:r}=this._context,s={allDay:i.allDay},c=r.createMarker(n);if(c&&(null==e||(f=r.createMarker(e),f))&&this._instance){let y=this._instance.range;!0===i.allDay&&(y=tz(y));let k=U2(y.start,c,r,i.granularity);if(f){let E=U2(y.end,f,r,i.granularity);!function qre(t,n){return t.years===n.years&&t.months===n.months&&t.days===n.days&&t.milliseconds===n.milliseconds}(k,E)?this.mutate({startDelta:k,endDelta:E,standardProps:s}):this.mutate({datesDelta:k,standardProps:s})}else s.hasEnd=!1,this.mutate({datesDelta:k,standardProps:s})}}moveStart(n){let e=ko(n);e&&this.mutate({startDelta:e})}moveEnd(n){let e=ko(n);e&&this.mutate({endDelta:e})}moveDates(n){let e=ko(n);e&&this.mutate({datesDelta:e})}setAllDay(n,e={}){let i={allDay:n},{maintainDuration:r}=e;null==r&&(r=this._context.options.allDayMaintainDuration),this._def.allDay!==n&&(i.hasEnd=r),this.mutate({standardProps:i})}formatRange(n){let{dateEnv:e}=this._context,i=this._instance,r=pa(n);return this._def.hasEnd?e.formatRange(i.range.start,i.range.end,r,{forcedStartTzo:i.forcedStartTzo,forcedEndTzo:i.forcedEndTzo}):e.format(i.range.start,r,{forcedTzo:i.forcedStartTzo})}mutate(n){let e=this._instance;if(e){let i=this._def,r=this._context,{eventStore:s}=r.getCurrentData(),c=eP(s,e.instanceId);c=iP(c,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},n,r);let y=new Ba(r,i,e);this._def=c.defs[i.defId],this._instance=c.instances[e.instanceId],r.dispatch({type:"MERGE_EVENTS",eventStore:c}),r.emitter.trigger("eventChange",{oldEvent:y,event:this,relatedEvents:ry(c,r,e),revert(){r.dispatch({type:"RESET_EVENTS",eventStore:s})}})}}remove(){let n=this._context,e=gz(this);n.dispatch({type:"REMOVE_EVENTS",eventStore:e}),n.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){n.dispatch({type:"MERGE_EVENTS",eventStore:e})}})}get source(){let{sourceId:n}=this._def;return n?new q2(this._context,this._context.getCurrentData().eventSources[n]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let n=this._instance;return n?this._context.dateEnv.formatIso(n.range.start,{omitTime:this._def.allDay,forcedTzo:n.forcedStartTzo}):""}get endStr(){let n=this._instance;return n&&this._def.hasEnd?this._context.dateEnv.formatIso(n.range.end,{omitTime:this._def.allDay,forcedTzo:n.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(n={}){let e=this._def,{ui:i}=e,{startStr:r,endStr:s}=this,c={allDay:e.allDay};return e.title&&(c.title=e.title),r&&(c.start=r),s&&(c.end=s),e.publicId&&(c.id=e.publicId),e.groupId&&(c.groupId=e.groupId),e.url&&(c.url=e.url),i.display&&"auto"!==i.display&&(c.display=i.display),n.collapseColor&&i.backgroundColor&&i.backgroundColor===i.borderColor?c.color=i.backgroundColor:(i.backgroundColor&&(c.backgroundColor=i.backgroundColor),i.borderColor&&(c.borderColor=i.borderColor)),i.textColor&&(c.textColor=i.textColor),i.classNames.length&&(c.classNames=i.classNames),Object.keys(e.extendedProps).length&&(n.collapseExtendedProps?Object.assign(c,e.extendedProps):c.extendedProps=e.extendedProps),c}toJSON(){return this.toPlainObject()}}function gz(t){let n=t._def,e=t._instance;return{defs:{[n.defId]:n},instances:e?{[e.instanceId]:e}:{}}}function ry(t,n,e){let{defs:i,instances:r}=t,s=[],c=e?e.instanceId:"";for(let f in r){let y=r[f];y.instanceId!==c&&s.push(new Ba(n,i[y.defId],y))}return s}function rP(t,n,e,i){let r={},s={},c={},f=[],y=[],k=v5(t.defs,n);for(let E in t.defs){let F=t.defs[E];"inverse-background"===k[F.defId].display&&(F.groupId?(r[F.groupId]=[],c[F.groupId]||(c[F.groupId]=F)):s[E]=[])}for(let E in t.instances){let F=t.instances[E],$=t.defs[F.defId],W=k[$.defId],re=F.range,he=!$.allDay&&i?YA(re,i):re,me=H1(he,e);me&&("inverse-background"===W.display?$.groupId?r[$.groupId].push(me):s[F.defId].push(me):"none"!==W.display&&("background"===W.display?f:y).push({def:$,ui:W,instance:F,range:me,isStart:he.start&&he.start.valueOf()===me.start.valueOf(),isEnd:he.end&&he.end.valueOf()===me.end.valueOf()}))}for(let E in r){let $=ez(r[E],e);for(let W of $){let re=c[E];f.push({def:re,ui:k[re.defId],instance:null,range:W,isStart:!1,isEnd:!1})}}for(let E in s){let $=ez(s[E],e);for(let W of $)f.push({def:t.defs[E],ui:k[E],instance:null,range:W,isStart:!1,isEnd:!1})}return{bg:f,fg:y}}function _z(t,n){t.fcSeg=n}function $2(t){return t.fcSeg||t.parentNode.fcSeg||null}function v5(t,n){return tg(t,e=>yz(e,n))}function yz(t,n){let e=[];return n[""]&&e.push(n[""]),n[t.defId]&&e.push(n[t.defId]),e.push(t.ui),az(e)}function oP(t,n){let e=t.map(bse);return e.sort((i,r)=>function zre(t,n,e){let i,r;for(i=0;i<e.length;i+=1)if(r=Nre(t,n,e[i]),r)return r;return 0}(i,r,n)),e.map(i=>i._seg)}function bse(t){let{eventRange:n}=t,e=n.def,i=n.instance?n.instance.range:n.range,r=i.start?i.start.valueOf():0,s=i.end?i.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},e.extendedProps),e),{id:e.publicId,start:r,end:s,duration:s-r,allDay:Number(e.allDay),_seg:t})}function xse(t,n){let{pluginHooks:e}=n,i=e.isDraggableTransformers,{def:r,ui:s}=t.eventRange,c=s.startEditable;for(let f of i)c=f(c,r,s,n);return c}function wse(t,n){return t.isStart&&t.eventRange.ui.durationEditable&&n.options.eventResizableFromStart}function Ik(t,n,e,i,r,s,c){let{dateEnv:f,options:y}=e,{displayEventTime:k,displayEventEnd:E}=y,F=t.eventRange.def,$=t.eventRange.instance;null==k&&(k=!1!==i),null==E&&(E=!1!==r);let W=$.range.start,re=$.range.end,he=s||t.start||t.eventRange.range.start,me=c||t.end||t.eventRange.range.end,Pe=$s(W).valueOf()===$s(he).valueOf(),Re=$s(N1(re,-1)).valueOf()===$s(N1(me,-1)).valueOf();return k&&!F.allDay&&(Pe||Re)?(he=Pe?W:he,me=Re?re:me,E&&F.hasEnd?f.formatRange(he,me,n,{forcedStartTzo:s?null:$.forcedStartTzo,forcedEndTzo:c?null:$.forcedEndTzo}):f.format(he,n,{forcedTzo:s?null:$.forcedStartTzo})):""}function og(t,n,e){let i=t.eventRange.range;return{isPast:i.end<=(e||n.start),isFuture:i.start>=(e||n.end),isToday:n&&rg(n,i.start)}}function Mse(t){let n=["fc-event"];return t.isMirror&&n.push("fc-event-mirror"),t.isDraggable&&n.push("fc-event-draggable"),(t.isStartResizable||t.isEndResizable)&&n.push("fc-event-resizable"),t.isDragging&&n.push("fc-event-dragging"),t.isResizing&&n.push("fc-event-resizing"),t.isSelected&&n.push("fc-event-selected"),t.isStart&&n.push("fc-event-start"),t.isEnd&&n.push("fc-event-end"),t.isPast&&n.push("fc-event-past"),t.isToday&&n.push("fc-event-today"),t.isFuture&&n.push("fc-event-future"),n}function vz(t){return t.instance?t.instance.instanceId:`${t.def.defId}:${t.range.start.toISOString()}`}function sP(t,n){let{def:e,instance:i}=t.eventRange,{url:r}=e;if(r)return{href:r};let{emitter:s,options:c}=n,{eventInteractive:f}=c;return null==f&&(f=e.interactive,null==f&&(f=!!s.hasHandlers("eventClick"))),f?O9(y=>{s.trigger("eventClick",{el:y.target,event:new Ba(n,e,i),jsEvent:y,view:n.viewApi})}):{}}const Cse={start:Gt,end:Gt,allDay:Boolean};function bz(t,n,e){return Object.assign(Object.assign({},xz(t,n,e)),{timeZone:n.timeZone})}function xz(t,n,e){return{start:n.toDate(t.start),end:n.toDate(t.end),startStr:n.formatIso(t.start,{omitTime:e}),endStr:n.formatIso(t.end,{omitTime:e})}}class wz extends Error{constructor(n,e){super(n),this.response=e}}let aP;function kz(){return null==aP&&(aP=function Rse(){if(typeof document>"u")return!0;let t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.innerHTML="<table><tr><td><div></div></td></tr></table>",t.querySelector("table").style.height="100px",t.querySelector("div").style.height="100%",document.body.appendChild(t);let e=t.querySelector("div").offsetHeight>0;return document.body.removeChild(t),e}()),aP}class Lse extends os{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{h5(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{h5(()=>{this.setState({forPrint:!1})})}}render(){let{props:n}=this,{options:e}=n,{forPrint:i}=this.state,r=i||"auto"===e.height||"auto"===e.contentHeight,s=r||null==e.height?"":e.height,c=["fc",i?"fc-media-print":"fc-media-screen",`fc-direction-${e.direction}`,n.theme.getClass("root")];return kz()||c.push("fc-liquid-hack"),n.children(c,s,r,i)}componentDidMount(){let{emitter:n}=this.props;n.on("_beforeprint",this.handleBeforePrint),n.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:n}=this.props;n.off("_beforeprint",this.handleBeforePrint),n.off("_afterprint",this.handleAfterPrint)}}class G2{constructor(n){this.component=n.component,this.isHitComboAllowed=n.isHitComboAllowed||null}destroy(){}}function lP(t){return{[t.component.uid]:t}}const cP={};let W2=(()=>{class t extends kh{constructor(e,i){super(e,i),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:i}=this;return e.children(i.nowDate,i.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:i}=this,r=i.nowManager.getDateMarker(),s=i.dateEnv.startOf(r,e.unit),f=i.dateEnv.add(s,ko(1,e.unit)).valueOf()-r.valueOf();return f=Math.min(864e5,f),{state:{nowDate:s,todayRange:zse(s)},waitMs:f}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{const i=this.computeTiming();this.setState(i.state,()=>{this.setTimeout(i.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}}return t.contextType=ng,t})();function zse(t){let n=$s(t);return{start:n,end:Oc(n,1)}}class Nse{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(n){this.currentDataManager.dispatch(n)}get view(){return this.getCurrentData().viewApi}batchRendering(n){n()}updateSize(){this.trigger("_resize",!0)}setOption(n,e){this.dispatch({type:"SET_OPTION",optionName:n,rawOptionValue:e})}getOption(n){return this.currentDataManager.currentCalendarOptionsInput[n]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(n,e){let{currentDataManager:i}=this;i.currentCalendarOptionsRefiners[n]?i.emitter.on(n,e):console.warn(`Unknown listener name '${n}'`)}off(n,e){this.currentDataManager.emitter.off(n,e)}trigger(n,...e){this.currentDataManager.emitter.trigger(n,...e)}changeView(n,e){this.batchRendering(()=>{if(this.unselect(),e)if(e.start&&e.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:n}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:e});else{let{dateEnv:i}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:n,dateMarker:i.createMarker(e)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:n})})}zoomTo(n,e){let r;r=this.getCurrentData().viewSpecs[e=e||"day"]||this.getUnitViewSpec(e),this.unselect(),this.dispatch(r?{type:"CHANGE_VIEW_TYPE",viewType:r.type,dateMarker:n}:{type:"CHANGE_DATE",dateMarker:n})}getUnitViewSpec(n){let s,c,{viewSpecs:e,toolbarConfig:i}=this.getCurrentData(),r=[].concat(i.header?i.header.viewsWithButtons:[],i.footer?i.footer.viewsWithButtons:[]);for(let f in e)r.push(f);for(s=0;s<r.length;s+=1)if(c=e[r[s]],c&&c.singleUnit===n)return c;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let n=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:n.dateEnv.addYears(n.currentDate,-1)})}nextYear(){let n=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:n.dateEnv.addYears(n.currentDate,1)})}today(){let n=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:n.nowManager.getDateMarker()})}gotoDate(n){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.createMarker(n)})}incrementDate(n){let e=this.getCurrentData(),i=ko(n);i&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.add(e.currentDate,i)}))}getDate(){let n=this.getCurrentData();return n.dateEnv.toDate(n.currentDate)}formatDate(n,e){let{dateEnv:i}=this.getCurrentData();return i.format(i.createMarker(n),pa(e))}formatRange(n,e,i){let{dateEnv:r}=this.getCurrentData();return r.formatRange(r.createMarker(n),r.createMarker(e),pa(i),i)}formatIso(n,e){let{dateEnv:i}=this.getCurrentData();return i.formatIso(i.createMarker(n),{omitTime:e})}select(n,e){let i;i=null==e?null!=n.start?n:{start:n,end:null}:{start:n,end:e};let r=this.getCurrentData(),s=function Sse(t,n,e){let i=function Ese(t,n){let{refined:e,extra:i}=c5(t,Cse),r=e.start?n.createMarkerMeta(e.start):null,s=e.end?n.createMarkerMeta(e.end):null,{allDay:c}=e;return null==c&&(c=r&&r.isTimeUnspecified&&(!s||s.isTimeUnspecified)),Object.assign({range:{start:r?r.marker:null,end:s?s.marker:null},allDay:c},i)}(t,n),{range:r}=i;if(!r.start)return null;if(!r.end){if(null==e)return null;r.end=n.add(r.start,e)}return i}(i,r.dateEnv,ko({days:1}));s&&(this.dispatch({type:"SELECT_DATES",selection:s}),fz(s,null,r))}unselect(n){let e=this.getCurrentData();e.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),function gse(t,n){n.emitter.trigger("unselect",{jsEvent:t?t.origEvent:null,view:n.viewApi||n.calendarApi.view})}(n,e))}addEvent(n,e){if(n instanceof Ba){let c=n._def,f=n._instance;return this.getCurrentData().eventStore.defs[c.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:JA({def:c,instance:f})}),this.triggerEventAdd(n)),n}let r,i=this.getCurrentData();if(e instanceof q2)r=e.internalEventSource;else if("boolean"==typeof e)e&&([r]=UA(i.eventSources));else if(null!=e){let c=this.getEventSourceById(e);if(!c)return console.warn(`Could not find an event source with ID "${e}"`),null;r=c.internalEventSource}let s=rz(n,r,i,!1);if(s){let c=new Ba(i,s.def,s.def.recurringDef?null:s.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:JA(s)}),this.triggerEventAdd(c),c}return null}triggerEventAdd(n){let{emitter:e}=this.getCurrentData();e.trigger("eventAdd",{event:n,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:gz(n)})}})}getEventById(n){let e=this.getCurrentData(),{defs:i,instances:r}=e.eventStore;n=String(n);for(let s in i){let c=i[s];if(c.publicId===n){if(c.recurringDef)return new Ba(e,c,null);for(let f in r){let y=r[f];if(y.defId===c.defId)return new Ba(e,c,y)}}}return null}getEvents(){let n=this.getCurrentData();return ry(n.eventStore,n)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let n=this.getCurrentData(),e=n.eventSources,i=[];for(let r in e)i.push(new q2(n,e[r]));return i}getEventSourceById(n){let e=this.getCurrentData(),i=e.eventSources;n=String(n);for(let r in i)if(i[r].publicId===n)return new q2(e,i[r]);return null}addEventSource(n){let e=this.getCurrentData();if(n instanceof q2)return e.eventSources[n.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n.internalEventSource]}),n;let i=lz(n,e);return i?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[i]}),new q2(e,i)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(n){let e=ko(n);e&&this.trigger("_scrollRequest",{time:e})}}function Bse(t,n){return t.left>=n.left&&t.left<n.right&&t.top>=n.top&&t.top<n.bottom}function Mz(t,n){let e={left:Math.max(t.left,n.left),right:Math.min(t.right,n.right),top:Math.max(t.top,n.top),bottom:Math.min(t.bottom,n.bottom)};return e.left<e.right&&e.top<e.bottom&&e}const dP={defs:{},instances:{}};class Use{constructor(){this.getKeysForEventDefs=er(this._getKeysForEventDefs),this.splitDateSelection=er(this._splitDateSpan),this.splitEventStore=er(this._splitEventStore),this.splitIndividualUi=er(this._splitIndividualUi),this.splitEventDrag=er(this._splitInteraction),this.splitEventResize=er(this._splitInteraction),this.eventUiBuilders={}}splitProps(n){let e=this.getKeyInfo(n),i=this.getKeysForEventDefs(n.eventStore),r=this.splitDateSelection(n.dateSelection),s=this.splitIndividualUi(n.eventUiBases,i),c=this.splitEventStore(n.eventStore,i),f=this.splitEventDrag(n.eventDrag),y=this.splitEventResize(n.eventResize),k={};this.eventUiBuilders=tg(e,(E,F)=>this.eventUiBuilders[F]||er(qse));for(let E in e){let F=e[E],$=c[E]||dP;k[E]={businessHours:F.businessHours||n.businessHours,dateSelection:r[E]||null,eventStore:$,eventUiBases:(0,this.eventUiBuilders[E])(n.eventUiBases[""],F.ui,s[E]),eventSelection:$.instances[n.eventSelection]?n.eventSelection:"",eventDrag:f[E]||null,eventResize:y[E]||null}}return k}_splitDateSpan(n){let e={};if(n){let i=this.getKeysForDateSpan(n);for(let r of i)e[r]=n}return e}_getKeysForEventDefs(n){return tg(n.defs,e=>this.getKeysForEventDef(e))}_splitEventStore(n,e){let{defs:i,instances:r}=n,s={};for(let c in i)for(let f of e[c])s[f]||(s[f]={defs:{},instances:{}}),s[f].defs[c]=i[c];for(let c in r){let f=r[c];for(let y of e[f.defId])s[y]&&(s[y].instances[c]=f)}return s}_splitIndividualUi(n,e){let i={};for(let r in n)if(r)for(let s of e[r])i[s]||(i[s]={}),i[s][r]=n[r];return i}_splitInteraction(n){let e={};if(n){let i=this._splitEventStore(n.affectedEvents,this._getKeysForEventDefs(n.affectedEvents)),r=this._getKeysForEventDefs(n.mutatedEvents),s=this._splitEventStore(n.mutatedEvents,r),c=f=>{e[f]||(e[f]={affectedEvents:i[f]||dP,mutatedEvents:s[f]||dP,isEvent:n.isEvent})};for(let f in i)c(f);for(let f in s)c(f)}return e}}function qse(t,n,e){let i=[];t&&i.push(t),n&&i.push(n);let r={"":az(i)};return e&&Object.assign(r,e),r}function hP(t,n,e,i){return{dow:t.getUTCDay(),isDisabled:!(!i||i.activeRange&&rg(i.activeRange,t)),isOther:!(!i||rg(i.currentRange,t)),isToday:!(!n||!rg(n,t)),isPast:!!(e?t<e:n&&t<n.start),isFuture:!!(e?t>e:n&&t>=n.end)}}function b5(t,n){let e=["fc-day",`fc-day-${z9[t.dow]}`];return t.isDisabled?e.push("fc-day-disabled"):(t.isToday&&(e.push("fc-day-today"),e.push(n.getClass("today"))),t.isPast&&e.push("fc-day-past"),t.isFuture&&e.push("fc-day-future"),t.isOther&&e.push("fc-day-other")),e}const $se=pa({year:"numeric",month:"long",day:"numeric"}),Gse=pa({week:"long"});function Z2(t,n,e="day",i=!0){const{dateEnv:r,options:s,calendarApi:c}=t;let f=r.format(n,"week"===e?Gse:$se);if(s.navLinks){let y=r.toDate(n);const k=E=>{let F="day"===e?s.navLinkDayClick:"week"===e?s.navLinkWeekClick:null;"function"==typeof F?F.call(c,r.toDate(n),E):("string"==typeof F&&(e=F),c.zoomTo(n,e))};return Object.assign({title:Sk(s.navLinkHint,[f,y],f),"data-navlink":""},i?I9(k):{onClick:k})}return{"aria-label":f}}let pP,uP=null;function Cz(t){return{x:t.offsetHeight-t.clientHeight,y:t.offsetWidth-t.clientWidth}}function Qse(t,n=!1,e){let i=e?t.getBoundingClientRect():fP(t),r=function Kse(t,n=!1){let e=window.getComputedStyle(t),i=parseInt(e.borderLeftWidth,10)||0,r=parseInt(e.borderRightWidth,10)||0,s=parseInt(e.borderTopWidth,10)||0,c=parseInt(e.borderBottomWidth,10)||0,f=Cz(t),y=f.y-i-r,E={borderLeft:i,borderRight:r,borderTop:s,borderBottom:c,scrollbarBottom:f.x-s-c,scrollbarLeft:0,scrollbarRight:0};return function Wse(){return null===uP&&(uP=function Zse(){let t=document.createElement("div");Ck(t,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),t.innerHTML="<div></div>",document.body.appendChild(t);let e=t.firstChild.getBoundingClientRect().left>t.getBoundingClientRect().left;return IA(t),e}()),uP}()&&"rtl"===e.direction?E.scrollbarLeft=y:E.scrollbarRight=y,n&&(E.paddingLeft=parseInt(e.paddingLeft,10)||0,E.paddingRight=parseInt(e.paddingRight,10)||0,E.paddingTop=parseInt(e.paddingTop,10)||0,E.paddingBottom=parseInt(e.paddingBottom,10)||0),E}(t,n),s={left:i.left+r.borderLeft+r.scrollbarLeft,right:i.right-r.borderRight-r.scrollbarRight,top:i.top+r.borderTop,bottom:i.bottom-r.borderBottom-r.scrollbarBottom};return n&&(s.left+=r.paddingLeft,s.right-=r.paddingRight,s.top+=r.paddingTop,s.bottom-=r.paddingBottom),s}function fP(t){let n=t.getBoundingClientRect();return{left:n.left+window.scrollX,top:n.top+window.scrollY,right:n.right+window.scrollX,bottom:n.bottom+window.scrollY}}function Sz(t){let n=[];for(;t instanceof HTMLElement;){let e=window.getComputedStyle(t);if("fixed"===e.position)break;/(auto|scroll)/.test(e.overflow+e.overflowY+e.overflowX)&&n.push(t),t=t.parentNode}return n}class Y2{constructor(n,e,i,r){this.els=e;let s=this.originClientRect=n.getBoundingClientRect();i&&this.buildElHorizontals(s.left),r&&this.buildElVerticals(s.top)}buildElHorizontals(n){let e=[],i=[];for(let r of this.els){let s=r.getBoundingClientRect();e.push(s.left-n),i.push(s.right-n)}this.lefts=e,this.rights=i}buildElVerticals(n){let e=[],i=[];for(let r of this.els){let s=r.getBoundingClientRect();e.push(s.top-n),i.push(s.bottom-n)}this.tops=e,this.bottoms=i}leftToIndex(n){let s,{lefts:e,rights:i}=this,r=e.length;for(s=0;s<r;s+=1)if(n>=e[s]&&n<i[s])return s}topToIndex(n){let s,{tops:e,bottoms:i}=this,r=e.length;for(s=0;s<r;s+=1)if(n>=e[s]&&n<i[s])return s}getWidth(n){return this.rights[n]-this.lefts[n]}getHeight(n){return this.bottoms[n]-this.tops[n]}similarTo(n){return x5(this.tops||[],n.tops||[])&&x5(this.bottoms||[],n.bottoms||[])&&x5(this.lefts||[],n.lefts||[])&&x5(this.rights||[],n.rights||[])}}function x5(t,n){const e=t.length;if(e!==n.length)return!1;for(let i=0;i<e;i++)if(Math.round(t[i])!==Math.round(n[i]))return!1;return!0}class mP{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}}class eae extends mP{constructor(n){super(),this.el=n}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(n){this.el.scrollTop=n}setScrollLeft(n){this.el.scrollLeft=n}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}}class tae extends mP{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(n){window.scroll(window.scrollX,n)}setScrollLeft(n){window.scroll(n,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}}class Tp extends os{constructor(){super(...arguments),this.uid=J_()}prepareHits(){}queryHit(n,e,i,r){return null}isValidSegDownEl(n){return!this.props.eventDrag&&!this.props.eventResize&&!Sd(n,".fc-event-mirror")}isValidDateDownEl(n){return!(Sd(n,".fc-event:not(.fc-bg-event)")||Sd(n,".fc-more-link")||Sd(n,"a[data-navlink]")||Sd(n,".fc-popover"))}}class Ez{constructor(n=(e=>e.thickness||1)){this.getEntryThickness=n,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(n){let e=[];for(let i of n)this.insertEntry(i,e);return e}insertEntry(n,e){let i=this.findInsertion(n);this.isInsertionValid(i,n)?this.insertEntryAt(n,i):this.handleInvalidInsertion(i,n,e)}isInsertionValid(n,e){return(-1===this.maxCoord||n.levelCoord+this.getEntryThickness(e)<=this.maxCoord)&&(-1===this.maxStackCnt||n.stackCnt<this.maxStackCnt)}handleInvalidInsertion(n,e,i){if(this.allowReslicing&&n.touchingEntry){const r=Object.assign(Object.assign({},e),{span:_P(e.span,n.touchingEntry.span)});i.push(r),this.splitEntry(e,n.touchingEntry,i)}else i.push(e)}splitEntry(n,e,i){let r=n.span,s=e.span;r.start<s.start&&this.insertEntry({index:n.index,thickness:n.thickness,span:{start:r.start,end:s.start}},i),r.end>s.end&&this.insertEntry({index:n.index,thickness:n.thickness,span:{start:s.end,end:r.end}},i)}insertEntryAt(n,e){let{entriesByLevel:i,levelCoords:r}=this;-1===e.lateral?(yP(r,e.level,e.levelCoord),yP(i,e.level,[n])):yP(i[e.level],e.lateral,n),this.stackCnts[oy(n)]=e.stackCnt}findInsertion(n){let{levelCoords:e,entriesByLevel:i,strictOrder:r,stackCnts:s}=this,c=e.length,f=0,y=-1,k=-1,E=null,F=0;for(let re=0;re<c;re+=1){const he=e[re];if(!r&&he>=f+this.getEntryThickness(n))break;let Pe,me=i[re],Re=vP(me,n.span.start,gP),rt=Re[0]+Re[1];for(;(Pe=me[rt])&&Pe.span.start<n.span.end;){let ft=he+this.getEntryThickness(Pe);ft>f&&(f=ft,E=Pe,y=re,k=rt),ft===f&&(F=Math.max(F,s[oy(Pe)]+1)),rt+=1}}let $=0;if(E)for($=y+1;$<c&&e[$]<f;)$+=1;let W=-1;return $<c&&e[$]===f&&(W=vP(i[$],n.span.end,gP)[0]),{touchingLevel:y,touchingLateral:k,touchingEntry:E,stackCnt:F,levelCoord:f,level:$,lateral:W}}toRects(){let{entriesByLevel:n,levelCoords:e}=this,i=n.length,r=[];for(let s=0;s<i;s+=1){let c=n[s],f=e[s];for(let y of c)r.push(Object.assign(Object.assign({},y),{thickness:this.getEntryThickness(y),levelCoord:f}))}return r}}function gP(t){return t.span.end}function oy(t){return t.index+":"+t.span.start}function iae(t,n){return{start:Math.min(t.start,n.start),end:Math.max(t.end,n.end)}}function _P(t,n){let e=Math.max(t.start,n.start),i=Math.min(t.end,n.end);return e<i?{start:e,end:i}:null}function yP(t,n,e){t.splice(n,0,e)}function vP(t,n,e){let i=0,r=t.length;if(!r||n<e(t[i]))return[0,0];if(n>e(t[r-1]))return[r,0];for(;i<r;){let s=Math.floor(i+(r-i)/2),c=e(t[s]);if(n<c)r=s;else{if(!(n>c))return[s,1];i=s+1}}return[i,0]}class Dz{constructor(n,e){this.emitter=new y5}destroy(){}setMirrorIsVisible(n){}setMirrorNeedsRevert(n){}setAutoScrollEnabled(n){}}const bP={};Boolean;const Tz="fc-col-header-cell";function Az(t){return t.text}class sae extends os{render(){let{dateEnv:n,options:e,theme:i,viewApi:r}=this.context,{props:s}=this,{date:c,dateProfile:f}=s,y=hP(c,s.todayRange,null,f),k=[Tz].concat(b5(y,i)),E=n.format(c,s.dayHeaderFormat),F=!y.isDisabled&&s.colCnt>1?Z2(this.context,c):{},$=n.toDate(c);n.namedTimeZoneImpl&&($=N1($,36e5));let W=Object.assign(Object.assign(Object.assign({date:$,view:r},s.extraRenderProps),{text:E}),y);return et(eh,{elTag:"th",elClasses:k,elAttrs:Object.assign({role:"columnheader",colSpan:s.colSpan,"data-date":y.isDisabled?void 0:Ek(c)},s.extraDataAttrs),renderProps:W,generatorName:"dayHeaderContent",customGenerator:e.dayHeaderContent,defaultGenerator:Az,classNameGenerator:e.dayHeaderClassNames,didMount:e.dayHeaderDidMount,willUnmount:e.dayHeaderWillUnmount},re=>et("div",{className:"fc-scrollgrid-sync-inner"},!y.isDisabled&&et(re,{elTag:"a",elAttrs:F,elClasses:["fc-col-header-cell-cushion",s.isSticky&&"fc-sticky"]})))}}const aae=pa({weekday:"long"});class lae extends os{render(){let{props:n}=this,{dateEnv:e,theme:i,viewApi:r,options:s}=this.context,c=Oc(new Date(2592e5),n.dow),f={dow:n.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},y=e.format(c,n.dayHeaderFormat),k=Object.assign(Object.assign(Object.assign(Object.assign({date:c},f),{view:r}),n.extraRenderProps),{text:y});return et(eh,{elTag:"th",elClasses:[Tz,...b5(f,i),...n.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:n.colSpan},n.extraDataAttrs),renderProps:k,generatorName:"dayHeaderContent",customGenerator:s.dayHeaderContent,defaultGenerator:Az,classNameGenerator:s.dayHeaderClassNames,didMount:s.dayHeaderDidMount,willUnmount:s.dayHeaderWillUnmount},E=>et("div",{className:"fc-scrollgrid-sync-inner"},et(E,{elTag:"a",elClasses:["fc-col-header-cell-cushion",n.isSticky&&"fc-sticky"],elAttrs:{"aria-label":e.format(c,aae)}})))}}class Pz extends os{constructor(){super(...arguments),this.createDayHeaderFormatter=er(cae)}render(){let{context:n}=this,{dates:e,dateProfile:i,datesRepDistinctDays:r,renderIntro:s}=this.props,c=this.createDayHeaderFormatter(n.options.dayHeaderFormat,r,e.length);return et(W2,{unit:"day"},(f,y)=>et("tr",{role:"row"},s&&s("day"),e.map(k=>r?et(sae,{key:k.toISOString(),date:k,dateProfile:i,todayRange:y,colCnt:e.length,dayHeaderFormat:c}):et(lae,{key:k.getUTCDay(),dow:k.getUTCDay(),dayHeaderFormat:c}))))}}function cae(t,n,e){return t||function oae(t,n){return pa(!t||n>10?{weekday:"short"}:n>1?{weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}:{weekday:"long"})}(n,e)}class Iz{constructor(n,e){let i=n.start,{end:r}=n,s=[],c=[],f=-1;for(;i<r;)e.isHiddenDay(i)?s.push(f+.5):(f+=1,s.push(f),c.push(i)),i=Oc(i,1);this.dates=c,this.indices=s,this.cnt=c.length}sliceRange(n){let e=this.getDateDayIndex(n.start),i=this.getDateDayIndex(Oc(n.end,-1)),r=Math.max(0,e),s=Math.min(this.cnt-1,i);return r=Math.ceil(r),s=Math.floor(s),r<=s?{firstIndex:r,lastIndex:s,isStart:e===r,isEnd:i===s}:null}getDateDayIndex(n){let{indices:e}=this,i=Math.floor(B1(this.dates[0],n));return i<0?e[0]-1:i>=e.length?e[e.length-1]+1:e[i]}}class Oz{constructor(n,e){let r,s,c,{dates:i}=n;if(e){for(s=i[0].getUTCDay(),r=1;r<i.length&&i[r].getUTCDay()!==s;r+=1);c=Math.ceil(i.length/r)}else c=1,r=i.length;this.rowCnt=c,this.colCnt=r,this.daySeries=n,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let n=[];for(let e=0;e<this.rowCnt;e+=1){let i=[];for(let r=0;r<this.colCnt;r+=1)i.push(this.buildCell(e,r));n.push(i)}return n}buildCell(n,e){let i=this.daySeries.dates[n*this.colCnt+e];return{key:i.toISOString(),date:i}}buildHeaderDates(){let n=[];for(let e=0;e<this.colCnt;e+=1)n.push(this.cells[0][e].date);return n}sliceRange(n){let{colCnt:e}=this,i=this.daySeries.sliceRange(n),r=[];if(i){let{firstIndex:s,lastIndex:c}=i,f=s;for(;f<=c;){let y=Math.floor(f/e),k=Math.min((y+1)*e,c+1);r.push({row:y,firstCol:f%e,lastCol:(k-1)%e,isStart:i.isStart&&f===s,isEnd:i.isEnd&&k-1===c}),f=k}}return r}}class Rz{constructor(){this.sliceBusinessHours=er(this._sliceBusinessHours),this.sliceDateSelection=er(this._sliceDateSpan),this.sliceEventStore=er(this._sliceEventStore),this.sliceEventDrag=er(this._sliceInteraction),this.sliceEventResize=er(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(n,e,i,r,...s){let{eventUiBases:c}=n,f=this.sliceEventStore(n.eventStore,c,e,i,...s);return{dateSelectionSegs:this.sliceDateSelection(n.dateSelection,e,i,c,r,...s),businessHourSegs:this.sliceBusinessHours(n.businessHours,e,i,r,...s),fgEventSegs:f.fg,bgEventSegs:f.bg,eventDrag:this.sliceEventDrag(n.eventDrag,c,e,i,...s),eventResize:this.sliceEventResize(n.eventResize,c,e,i,...s),eventSelection:n.eventSelection}}sliceNowDate(n,e,i,r,...s){return this._sliceDateSpan({range:{start:n,end:N1(n,1)},allDay:!1},e,i,{},r,...s)}_sliceBusinessHours(n,e,i,r,...s){return n?this._sliceEventStore(iy(n,w5(e,!!i),r),{},e,i,...s).bg:[]}_sliceEventStore(n,e,i,r,...s){if(n){let c=rP(n,e,w5(i,!!r),r);return{bg:this.sliceEventRanges(c.bg,s),fg:this.sliceEventRanges(c.fg,s)}}return{bg:[],fg:[]}}_sliceInteraction(n,e,i,r,...s){if(!n)return null;let c=rP(n.mutatedEvents,e,w5(i,!!r),r);return{segs:this.sliceEventRanges(c.fg,s),affectedInstances:n.affectedEvents.instances,isEvent:n.isEvent}}_sliceDateSpan(n,e,i,r,s,...c){if(!n)return[];let f=w5(e,!!i),y=H1(n.range,f);if(y){let k=function Pse(t,n,e){let i=oz({editable:!1},e),r=QA(i.refined,i.extra,"",t.allDay,!0,e);return{def:r,ui:yz(r,n),instance:XA(r.defId,t.range),range:t.range,isStart:!0,isEnd:!0}}(n=Object.assign(Object.assign({},n),{range:y}),r,s),E=this.sliceRange(n.range,...c);for(let F of E)F.eventRange=k;return E}return[]}sliceEventRanges(n,e){let i=[];for(let r of n)i.push(...this.sliceEventRange(r,e));return i}sliceEventRange(n,e){let i=n.range;this.forceDayIfListItem&&"list-item"===n.ui.display&&(i={start:i.start,end:Oc(i.start,1)});let r=this.sliceRange(i,...e);for(let s of r)s.eventRange=n,s.isStart=n.isStart&&s.isStart,s.isEnd=n.isEnd&&s.isEnd;return r}}function w5(t,n){let e=t.activeRange;return n?e:{start:N1(e.start,t.slotMinTime.milliseconds),end:N1(e.end,t.slotMaxTime.milliseconds-864e5)}}function Lz(t,n,e){let{instances:i}=t.mutatedEvents;for(let r in i)if(!p5(n.validRange,i[r].range))return!1;return Fz({eventDrag:t},e)}function Fz(t,n){let e=n.getCurrentData(),i=Object.assign({businessHours:e.businessHours,dateSelection:"",eventStore:e.eventStore,eventUiBases:e.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},t);return(n.pluginHooks.isPropsValid||hae)(i,n)}function hae(t,n,e={},i){return!(t.eventDrag&&!function uae(t,n,e,i){let r=n.getCurrentData(),s=t.eventDrag,c=s.mutatedEvents,f=c.defs,y=c.instances,k=v5(f,s.isEvent?t.eventUiBases:{"":r.selectionConfig});i&&(k=tg(k,i));let E=function cse(t,n){return{defs:t.defs,instances:ny(t.instances,e=>!n[e.instanceId])}}(t.eventStore,s.affectedEvents.instances),F=E.defs,$=E.instances,W=v5(F,t.eventUiBases);for(let re in y){let he=y[re],me=he.range,Pe=k[he.defId],Re=f[he.defId];if(!zz(Pe.constraints,me,E,t.businessHours,n))return!1;let{eventOverlap:rt}=n.options,ft="function"==typeof rt?rt:null;for(let Vt in $){let sn=$[Vt];if(ZA(me,sn.range)&&(!1===W[sn.defId].overlap&&s.isEvent||!1===Pe.overlap||ft&&!ft(new Ba(n,F[sn.defId],sn),new Ba(n,Re,he))))return!1}let Ct=r.eventStore;for(let Vt of Pe.allows){let Hi,sn=Object.assign(Object.assign({},e),{range:he.range,allDay:Re.allDay}),Qt=Ct.defs[Re.defId];if(Hi=Qt?new Ba(n,Qt,Ct.instances[re]):new Ba(n,Re),!Vt(nP(sn,n),Hi))return!1}}return!0}(t,n,e,i)||t.dateSelection&&!function pae(t,n,e,i){let r=t.eventStore,s=r.defs,c=r.instances,f=t.dateSelection,y=f.range,{selectionConfig:k}=n.getCurrentData();if(i&&(k=i(k)),!zz(k.constraints,y,r,t.businessHours,n))return!1;let{selectOverlap:E}=n.options,F="function"==typeof E?E:null;for(let $ in c){let W=c[$];if(ZA(y,W.range)&&(!1===k.overlap||F&&!F(new Ba(n,s[W.defId],W),null)))return!1}for(let $ of k.allows)if(!$(nP(Object.assign(Object.assign({},e),f),n),null))return!1;return!0}(t,n,e,i))}function zz(t,n,e,i,r){for(let s of t)if(!mae(fae(s,n,e,i,r),n))return!1;return!0}function fae(t,n,e,i,r){return"businessHours"===t?xP(iy(i,n,r)):"string"==typeof t?xP(m5(e,s=>s.groupId===t)):"object"==typeof t&&t?xP(iy(t,n,r)):[]}function xP(t){let{instances:n}=t,e=[];for(let i in n)e.push(n[i].range);return e}function mae(t,n){for(let e of t)if(p5(e,n))return!0;return!1}const k5=/^(visible|hidden)$/;class Nz extends os{constructor(){super(...arguments),this.handleEl=n=>{this.el=n,ig(this.props.elRef,n)}}render(){let{props:n}=this,{liquid:e,liquidIsAbsolute:i}=n,r=e&&i,s=["fc-scroller"];return e&&s.push(i?"fc-scroller-liquid-absolute":"fc-scroller-liquid"),et("div",{ref:this.handleEl,className:s.join(" "),style:{overflowX:n.overflowX,overflowY:n.overflowY,left:r&&-(n.overcomeLeft||0)||"",right:r&&-(n.overcomeRight||0)||"",bottom:r&&-(n.overcomeBottom||0)||"",marginLeft:!r&&-(n.overcomeLeft||0)||"",marginRight:!r&&-(n.overcomeRight||0)||"",marginBottom:!r&&-(n.overcomeBottom||0)||"",maxHeight:n.maxHeight||""}},n.children)}needsXScrolling(){if(k5.test(this.props.overflowX))return!1;let{el:n}=this,e=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:i}=n;for(let r=0;r<i.length;r+=1)if(i[r].getBoundingClientRect().width>e)return!0;return!1}needsYScrolling(){if(k5.test(this.props.overflowY))return!1;let{el:n}=this,e=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:i}=n;for(let r=0;r<i.length;r+=1)if(i[r].getBoundingClientRect().height>e)return!0;return!1}getXScrollbarWidth(){return k5.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return k5.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}}class sg{constructor(n){this.masterCallback=n,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(e,i)=>{let{depths:r,currentMap:s}=this,c=!1,f=!1;null!==e?(c=i in s,s[i]=e,r[i]=(r[i]||0)+1,f=!0):(r[i]-=1,r[i]||(delete s[i],delete this.callbackMap[i],c=!0)),this.masterCallback&&(c&&this.masterCallback(null,String(i)),f&&this.masterCallback(e,String(i)))}}createRef(n){let e=this.callbackMap[n];return e||(e=this.callbackMap[n]=i=>{this.handleValue(i,String(n))}),e}collect(n,e,i){return function Eoe(t,n=0,e,i=1){let r=[];null==e&&(e=Object.keys(t).length);for(let s=n;s<e;s+=i){let c=t[s];void 0!==c&&r.push(c)}return r}(this.currentMap,n,e,i)}getAll(){return UA(this.currentMap)}}function Bz(t,n){return t.liquid&&n.liquid}function vae(t,n){return Nf(t,n,Bf)}function bae(t,n){let e=[];for(let i of t){let r=i.span||1;for(let s=0;s<r;s+=1)e.push(et("col",{style:{width:"shrink"===i.width?xae(n):i.width||"",minWidth:i.minWidth||""}}))}return et("colgroup",{},...e)}function xae(t){return t??4}function Mae(t,n){let e=["fc-scrollgrid-section",`fc-scrollgrid-section-${t.type}`,t.className];return n&&t.liquid&&null==t.maxHeight&&e.push("fc-scrollgrid-section-liquid"),t.isSticky&&e.push("fc-scrollgrid-section-sticky"),e}function wP(t){return et("div",{className:"fc-scrollgrid-sticky-shim",style:{width:t.clientWidth,minWidth:t.tableMinWidth}})}function M5(t){let{stickyHeaderDates:n}=t;return(null==n||"auto"===n)&&(n="auto"===t.height||"auto"===t.viewHeight),n}function Vz(t){let{stickyFooterScrollbar:n}=t;return(null==n||"auto"===n)&&(n="auto"===t.height||"auto"===t.viewHeight),n}class kP extends os{constructor(){super(...arguments),this.processCols=er(n=>n,vae),this.renderMicroColGroup=er(bae),this.scrollerRefs=new sg,this.scrollerElRefs=new sg(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:n,state:e,context:i}=this,r=n.sections||[],s=this.processCols(n.cols),c=this.renderMicroColGroup(s,e.shrinkWidth),f=function kae(t,n){let e=["fc-scrollgrid",n.theme.getClass("table")];return t&&e.push("fc-scrollgrid-liquid"),e}(n.liquid,i);n.collapsibleWidth&&f.push("fc-scrollgrid-collapsible");let E,y=r.length,k=0,F=[],$=[],W=[];for(;k<y&&"header"===(E=r[k]).type;)F.push(this.renderSection(E,c,!0)),k+=1;for(;k<y&&"body"===(E=r[k]).type;)$.push(this.renderSection(E,c,!1)),k+=1;for(;k<y&&"footer"===(E=r[k]).type;)W.push(this.renderSection(E,c,!0)),k+=1;let re=!kz();const he={role:"rowgroup"};return et("table",{role:"grid",className:f.join(" "),style:{height:n.height}},!(re||!F.length)&&et("thead",he,...F),!(re||!$.length)&&et("tbody",he,...$),!(re||!W.length)&&et("tfoot",he,...W),re&&et("tbody",he,...F,...$,...W))}renderSection(n,e,i){return"outerContent"in n?et(ms,{key:n.key},n.outerContent):et("tr",{key:n.key,role:"presentation",className:Mae(n,this.props.liquid).join(" ")},this.renderChunkTd(n,e,n.chunk,i))}renderChunkTd(n,e,i,r){if("outerContent"in i)return i.outerContent;let{props:s}=this,{forceYScrollbars:c,scrollerClientWidths:f,scrollerClientHeights:y}=this.state,k=function _ae(t,n){return null!=n.maxHeight||Bz(t,n)}(s,n),E=Bz(s,n),F=s.liquid?c?"scroll":k?"auto":"hidden":"visible",$=n.key,W=function yae(t,n,e,i){let{expandRows:r}=e;return"function"==typeof n.content?n.content(e):et("table",{role:"presentation",className:[n.tableClassName,t.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:r?e.clientHeight:""}},e.tableColGroupNode,et(i?"thead":"tbody",{role:"presentation"},"function"==typeof n.rowContent?n.rowContent(e):n.rowContent))}(n,i,{tableColGroupNode:e,tableMinWidth:"",clientWidth:s.collapsibleWidth||void 0===f[$]?null:f[$],clientHeight:void 0!==y[$]?y[$]:null,expandRows:n.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},r);return et(r?"th":"td",{ref:i.elRef,role:"presentation"},et("div",{className:"fc-scroller-harness"+(E?" fc-scroller-harness-liquid":"")},et(Nz,{ref:this.scrollerRefs.createRef($),elRef:this.scrollerElRefs.createRef($),overflowY:F,overflowX:s.liquid?"hidden":"visible",maxHeight:n.maxHeight,liquid:E,liquidIsAbsolute:!0},W)))}_handleScrollerEl(n,e){let i=function Cae(t,n){for(let e of t)if(e.key===n)return e;return null}(this.props.sections,e);i&&ig(i.chunk.scrollerElRef,n)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return function wae(t){for(let n of t)if("shrink"===n.width)return!0;return!1}(this.props.cols)?function gae(t){let n=function Ere(t,n){let e=t instanceof HTMLElement?[t]:t,i=[];for(let r=0;r<e.length;r+=1){let s=e[r].querySelectorAll(n);for(let c=0;c<s.length;c+=1)i.push(s[c])}return i}(t,".fc-scrollgrid-shrink"),e=0;for(let i of n)e=Math.max(e,jre(i));return Math.ceil(e)}(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let n=function Yse(){return pP||(pP=function Xse(){let t=document.createElement("div");t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t);let n=Cz(t);return document.body.removeChild(t),n}()),pP}(),{scrollerRefs:e,scrollerElRefs:i}=this,r=!1,s={},c={};for(let f in e.currentMap){let y=e.currentMap[f];if(y&&y.needsYScrolling()){r=!0;break}}for(let f of this.props.sections){let y=f.key,k=i.currentMap[y];if(k){let E=k.parentNode;s[y]=Math.floor(E.getBoundingClientRect().width-(r?n.y:0)),c[y]=Math.floor(E.getBoundingClientRect().height)}}return{forceYScrollbars:r,scrollerClientWidths:s,scrollerClientHeights:c}}}kP.addStateEquality({scrollerClientWidths:Bf,scrollerClientHeights:Bf});class C5 extends os{constructor(){super(...arguments),this.handleEl=n=>{this.el=n,n&&_z(n,this.props.seg)}}render(){const{props:n,context:e}=this,{options:i}=e,{seg:r}=n,{eventRange:s}=r,{ui:c}=s,f={event:new Ba(e,s.def,s.instance),view:e.viewApi,timeText:n.timeText,textColor:c.textColor,backgroundColor:c.backgroundColor,borderColor:c.borderColor,isDraggable:!n.disableDragging&&xse(r,e),isStartResizable:!n.disableResizing&&wse(r,e),isEndResizable:!n.disableResizing&&(t=r,t.isEnd&&t.eventRange.ui.durationEditable),isMirror:!!(n.isDragging||n.isResizing||n.isDateSelecting),isStart:!!r.isStart,isEnd:!!r.isEnd,isPast:!!n.isPast,isFuture:!!n.isFuture,isToday:!!n.isToday,isSelected:!!n.isSelected,isDragging:!!n.isDragging,isResizing:!!n.isResizing};var t;return et(eh,Object.assign({},n,{elRef:this.handleEl,elClasses:[...Mse(f),...r.eventRange.ui.classNames,...n.elClasses||[]],renderProps:f,generatorName:"eventContent",customGenerator:i.eventContent,defaultGenerator:n.defaultGenerator,classNameGenerator:i.eventClassNames,didMount:i.eventDidMount,willUnmount:i.eventWillUnmount}))}componentDidUpdate(n){this.el&&this.props.seg!==n.seg&&_z(this.el,this.props.seg)}}class jz extends os{render(){let{props:n,context:e}=this,{options:i}=e,{seg:r}=n,{ui:s}=r.eventRange,f=Ik(r,i.eventTimeFormat||n.defaultTimeFormat,e,n.defaultDisplayEventTime,n.defaultDisplayEventEnd);return et(C5,Object.assign({},n,{elTag:"a",elStyle:{borderColor:s.borderColor,backgroundColor:s.backgroundColor},elAttrs:sP(r,e),defaultGenerator:Sae,timeText:f}),(y,k)=>et(ms,null,et(y,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:k.textColor}}),!!k.isStartResizable&&et("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!k.isEndResizable&&et("div",{className:"fc-event-resizer fc-event-resizer-end"})))}}function Sae(t){return et("div",{className:"fc-event-main-frame"},t.timeText&&et("div",{className:"fc-event-time"},t.timeText),et("div",{className:"fc-event-title-container"},et("div",{className:"fc-event-title fc-sticky"},t.event.title||et(ms,null,"\xa0"))))}const MP=t=>et(ng.Consumer,null,n=>{let{options:e}=n,i={isAxis:t.isAxis,date:n.dateEnv.toDate(t.date),view:n.viewApi};return et(eh,Object.assign({},t,{elTag:t.elTag||"div",renderProps:i,generatorName:"nowIndicatorContent",customGenerator:e.nowIndicatorContent,classNameGenerator:e.nowIndicatorClassNames,didMount:e.nowIndicatorDidMount,willUnmount:e.nowIndicatorWillUnmount}))}),Eae=pa({day:"numeric"});class CP extends os{constructor(){super(...arguments),this.refineRenderProps=r5(Dae)}render(){let{props:n,context:e}=this,{options:i}=e,r=this.refineRenderProps({date:n.date,dateProfile:n.dateProfile,todayRange:n.todayRange,isMonthStart:n.isMonthStart||!1,showDayNumber:n.showDayNumber,extraRenderProps:n.extraRenderProps,viewApi:e.viewApi,dateEnv:e.dateEnv,monthStartFormat:i.monthStartFormat});return et(eh,Object.assign({},n,{elClasses:[...b5(r,e.theme),...n.elClasses||[]],elAttrs:Object.assign(Object.assign({},n.elAttrs),r.isDisabled?{}:{"data-date":Ek(n.date)}),renderProps:r,generatorName:"dayCellContent",customGenerator:i.dayCellContent,defaultGenerator:n.defaultGenerator,classNameGenerator:r.isDisabled?void 0:i.dayCellClassNames,didMount:i.dayCellDidMount,willUnmount:i.dayCellWillUnmount}))}}function SP(t){return!(!t.dayCellContent&&!WA("dayCellContent",t))}function Dae(t){let{date:n,dateEnv:e,dateProfile:i,isMonthStart:r}=t,s=hP(n,t.todayRange,null,i),c=t.showDayNumber?e.format(n,r?t.monthStartFormat:Eae):"";return Object.assign(Object.assign(Object.assign({date:e.toDate(n),view:t.viewApi},s),{isMonthStart:r,dayNumberText:c}),t.extraRenderProps)}class Hz extends os{render(){let{props:n}=this,{seg:e}=n;return et(C5,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:e.eventRange.ui.backgroundColor},defaultGenerator:Tae,seg:e,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:n.isPast,isFuture:n.isFuture,isToday:n.isToday,disableDragging:!0,disableResizing:!0})}}function Tae(t){let{title:n}=t.event;return n&&et("div",{className:"fc-event-title"},t.event.title)}function Uz(t){return et("div",{className:`fc-${t}`})}const qz=t=>et(ng.Consumer,null,n=>{let{dateEnv:e,options:i}=n,{date:r}=t,s=i.weekNumberFormat||t.defaultFormat,c=e.computeWeekNumber(r),f=e.format(r,s);return et(eh,Object.assign({},t,{renderProps:{num:c,text:f,date:r},generatorName:"weekNumberContent",customGenerator:i.weekNumberContent,defaultGenerator:Aae,classNameGenerator:i.weekNumberClassNames,didMount:i.weekNumberDidMount,willUnmount:i.weekNumberWillUnmount}))});function Aae(t){return t.text}class Pae extends os{constructor(){super(...arguments),this.state={titleId:z1()},this.handleRootEl=n=>{this.rootEl=n,this.props.elRef&&ig(this.props.elRef,n)},this.handleDocumentMouseDown=n=>{const e=D9(n);this.rootEl.contains(e)||this.handleCloseClick()},this.handleDocumentKeyDown=n=>{"Escape"===n.key&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:n}=this.props;n&&n()}}render(){let{theme:n,options:e}=this.context,{props:i,state:r}=this,s=["fc-popover",n.getClass("popover")].concat(i.extraClassNames||[]);return function f9(t,n){var e=et(tre,{__v:t,i:n});return e.containerInfo=n,e}(et("div",Object.assign({},i.extraAttrs,{id:i.id,className:s.join(" "),"aria-labelledby":r.titleId,ref:this.handleRootEl}),et("div",{className:"fc-popover-header "+n.getClass("popoverHeader")},et("span",{className:"fc-popover-title",id:r.titleId},i.title),et("span",{className:"fc-popover-close "+n.getIconClass("close"),title:e.closeHint,onClick:this.handleCloseClick})),et("div",{className:"fc-popover-body "+n.getClass("popoverContent")},i.children)),i.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:n}=this.context,{alignmentEl:e,alignGridTop:i}=this.props,{rootEl:r}=this,s=function Jse(t){let n=Sz(t),e=t.getBoundingClientRect();for(let i of n){let r=Mz(e,i.getBoundingClientRect());if(!r)return null;e=r}return e}(e);if(s){let c=r.getBoundingClientRect(),f=i?Sd(e,".fc-scrollgrid").getBoundingClientRect().top:s.top,y=n?s.right-c.width:s.left;f=Math.max(f,10),y=Math.min(y,document.documentElement.clientWidth-10-c.width),y=Math.max(y,10);let k=r.offsetParent.getBoundingClientRect();Ck(r,{top:f-k.top,left:y-k.left})}}}class Iae extends Tp{constructor(){super(...arguments),this.handleRootEl=n=>{this.rootEl=n,n?this.context.registerInteractiveComponent(this,{el:n,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:n,dateEnv:e}=this.context,{props:i}=this,{startDate:r,todayRange:s,dateProfile:c}=i,f=e.format(r,n.dayPopoverFormat);return et(CP,{elRef:this.handleRootEl,date:r,dateProfile:c,todayRange:s},(y,k,E)=>et(Pae,{elRef:E.ref,id:i.id,title:f,extraClassNames:["fc-more-popover"].concat(E.className||[]),extraAttrs:E,parentEl:i.parentEl,alignmentEl:i.alignmentEl,alignGridTop:i.alignGridTop,onClose:i.onClose},SP(n)&&et(y,{elTag:"div",elClasses:["fc-more-popover-misc"]}),i.children))}queryHit(n,e,i,r){let{rootEl:s,props:c}=this;return n>=0&&n<i&&e>=0&&e<r?{dateProfile:c.dateProfile,dateSpan:Object.assign({allDay:!c.forceTimed,range:{start:c.startDate,end:c.endDate}},c.extraDateSpan),dayEl:s,rect:{left:0,top:0,right:i,bottom:r},layer:1}:null}}class $z extends os{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:z1()},this.handleLinkEl=n=>{this.linkEl=n,this.props.elRef&&ig(this.props.elRef,n)},this.handleClick=n=>{let{props:e,context:i}=this,{moreLinkClick:r}=i.options,s=Gz(e).start;function c(f){let{def:y,instance:k,range:E}=f.eventRange;return{event:new Ba(i,y,k),start:i.dateEnv.toDate(E.start),end:i.dateEnv.toDate(E.end),isStart:f.isStart,isEnd:f.isEnd}}"function"==typeof r&&(r=r({date:s,allDay:!!e.allDayDate,allSegs:e.allSegs.map(c),hiddenSegs:e.hiddenSegs.map(c),jsEvent:n,view:i.viewApi})),r&&"popover"!==r?"string"==typeof r&&i.calendarApi.zoomTo(s,r):this.setState({isPopoverOpen:!0})},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:n,state:e}=this;return et(ng.Consumer,null,i=>{let{viewApi:r,options:s,calendarApi:c}=i,{moreLinkText:f}=s,{moreCnt:y}=n,k=Gz(n),E="function"==typeof f?f.call(c,y):`+${y} ${f}`,F=Sk(s.moreLinkHint,[y],E),$={num:y,shortText:`+${y}`,text:E,view:r};return et(ms,null,!!n.moreCnt&&et(eh,{elTag:n.elTag||"a",elRef:this.handleLinkEl,elClasses:[...n.elClasses||[],"fc-more-link"],elStyle:n.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},n.elAttrs),I9(this.handleClick)),{title:F,"aria-expanded":e.isPopoverOpen,"aria-controls":e.isPopoverOpen?e.popoverId:""}),renderProps:$,generatorName:"moreLinkContent",customGenerator:s.moreLinkContent,defaultGenerator:n.defaultGenerator||Oae,classNameGenerator:s.moreLinkClassNames,didMount:s.moreLinkDidMount,willUnmount:s.moreLinkWillUnmount},n.children),e.isPopoverOpen&&et(Iae,{id:e.popoverId,startDate:k.start,endDate:k.end,dateProfile:n.dateProfile,todayRange:n.todayRange,extraDateSpan:n.extraDateSpan,parentEl:this.parentEl,alignmentEl:n.alignmentElRef?n.alignmentElRef.current:this.linkEl,alignGridTop:n.alignGridTop,forceTimed:n.forceTimed,onClose:this.handlePopoverClose},n.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Sd(this.linkEl,".fc-view-harness"))}}function Oae(t){return t.text}function Gz(t){if(t.allDayDate)return{start:t.allDayDate,end:Oc(t.allDayDate,1)};let{hiddenSegs:n}=t;return{start:Wz(n),end:Lae(n)}}function Wz(t){return t.reduce(Rae).eventRange.range.start}function Rae(t,n){return t.eventRange.range.start<n.eventRange.range.start?t:n}function Lae(t){return t.reduce(Fae).eventRange.range.end}function Fae(t,n){return t.eventRange.range.end>n.eventRange.range.end?t:n}class zae{constructor(){this.handlers=[]}set(n){this.currentValue=n;for(let e of this.handlers)e(n)}subscribe(n){this.handlers.push(n),void 0!==this.currentValue&&n(this.currentValue)}}class Nae extends zae{constructor(){super(...arguments),this.map=new Map}handle(n){const{map:e}=this;let i=!1;n.isActive?(e.set(n.id,n),i=!0):e.has(n.id)&&(e.delete(n.id),i=!0),i&&this.set(e)}}const Bae=[],Zz={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},Yz=Object.assign(Object.assign({},Zz),{buttonHints:{prev:"Previous $0",next:"Next $0",today:(t,n)=>"day"===n?"Today":`This ${t}`},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint:t=>`Show ${t} more event${1===t?"":"s"}`});function Xz(t){let n=t.length>0?t[0].code:"en",e=Bae.concat(t),i={en:Yz};for(let r of e)i[r.code]=r;return{map:i,defaultCode:n}}function DP(t,n){return"object"!=typeof t||Array.isArray(t)?function Vae(t,n){let e=[].concat(t||[]),i=function jae(t,n){for(let e=0;e<t.length;e+=1){let i=t[e].toLocaleLowerCase().split("-");for(let r=i.length;r>0;r-=1){let s=i.slice(0,r).join("-");if(n[s])return n[s]}}return null}(e,n)||Yz;return Kz(t,e,i)}(t,n):Kz(t.code,[t.code],t)}function Kz(t,n,e){let i=HA([Zz,e],["buttonText"]);delete i.code;let{week:r}=i;return delete i.week,{codeArg:t,codes:n,week:r,simpleNumberFormat:new Intl.NumberFormat(t),options:i}}function Vf(t){return{id:J_(),name:t.name,premiumReleaseDate:t.premiumReleaseDate?new Date(t.premiumReleaseDate):void 0,deps:t.deps||[],reducers:t.reducers||[],isLoadingFuncs:t.isLoadingFuncs||[],contextInit:[].concat(t.contextInit||[]),eventRefiners:t.eventRefiners||{},eventDefMemberAdders:t.eventDefMemberAdders||[],eventSourceRefiners:t.eventSourceRefiners||{},isDraggableTransformers:t.isDraggableTransformers||[],eventDragMutationMassagers:t.eventDragMutationMassagers||[],eventDefMutationAppliers:t.eventDefMutationAppliers||[],dateSelectionTransformers:t.dateSelectionTransformers||[],datePointTransforms:t.datePointTransforms||[],dateSpanTransforms:t.dateSpanTransforms||[],views:t.views||{},viewPropsTransformers:t.viewPropsTransformers||[],isPropsValid:t.isPropsValid||null,externalDefTransforms:t.externalDefTransforms||[],viewContainerAppends:t.viewContainerAppends||[],eventDropTransformers:t.eventDropTransformers||[],componentInteractions:t.componentInteractions||[],calendarInteractions:t.calendarInteractions||[],themeClasses:t.themeClasses||{},eventSourceDefs:t.eventSourceDefs||[],cmdFormatter:t.cmdFormatter,recurringTypes:t.recurringTypes||[],namedTimeZonedImpl:t.namedTimeZonedImpl,initialView:t.initialView||"",elementDraggingImpl:t.elementDraggingImpl,optionChangeHandlers:t.optionChangeHandlers||{},scrollGridImpl:t.scrollGridImpl||null,listenerRefiners:t.listenerRefiners||{},optionRefiners:t.optionRefiners||{},propSetHandlers:t.propSetHandlers||{}}}function qae(t,n){return{premiumReleaseDate:$ae(t.premiumReleaseDate,n.premiumReleaseDate),reducers:t.reducers.concat(n.reducers),isLoadingFuncs:t.isLoadingFuncs.concat(n.isLoadingFuncs),contextInit:t.contextInit.concat(n.contextInit),eventRefiners:Object.assign(Object.assign({},t.eventRefiners),n.eventRefiners),eventDefMemberAdders:t.eventDefMemberAdders.concat(n.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},t.eventSourceRefiners),n.eventSourceRefiners),isDraggableTransformers:t.isDraggableTransformers.concat(n.isDraggableTransformers),eventDragMutationMassagers:t.eventDragMutationMassagers.concat(n.eventDragMutationMassagers),eventDefMutationAppliers:t.eventDefMutationAppliers.concat(n.eventDefMutationAppliers),dateSelectionTransformers:t.dateSelectionTransformers.concat(n.dateSelectionTransformers),datePointTransforms:t.datePointTransforms.concat(n.datePointTransforms),dateSpanTransforms:t.dateSpanTransforms.concat(n.dateSpanTransforms),views:Object.assign(Object.assign({},t.views),n.views),viewPropsTransformers:t.viewPropsTransformers.concat(n.viewPropsTransformers),isPropsValid:n.isPropsValid||t.isPropsValid,externalDefTransforms:t.externalDefTransforms.concat(n.externalDefTransforms),viewContainerAppends:t.viewContainerAppends.concat(n.viewContainerAppends),eventDropTransformers:t.eventDropTransformers.concat(n.eventDropTransformers),calendarInteractions:t.calendarInteractions.concat(n.calendarInteractions),componentInteractions:t.componentInteractions.concat(n.componentInteractions),themeClasses:Object.assign(Object.assign({},t.themeClasses),n.themeClasses),eventSourceDefs:t.eventSourceDefs.concat(n.eventSourceDefs),cmdFormatter:n.cmdFormatter||t.cmdFormatter,recurringTypes:t.recurringTypes.concat(n.recurringTypes),namedTimeZonedImpl:n.namedTimeZonedImpl||t.namedTimeZonedImpl,initialView:t.initialView||n.initialView,elementDraggingImpl:t.elementDraggingImpl||n.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},t.optionChangeHandlers),n.optionChangeHandlers),scrollGridImpl:n.scrollGridImpl||t.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},t.listenerRefiners),n.listenerRefiners),optionRefiners:Object.assign(Object.assign({},t.optionRefiners),n.optionRefiners),propSetHandlers:Object.assign(Object.assign({},t.propSetHandlers),n.propSetHandlers)}}function $ae(t,n){return void 0===t?n:void 0===n?t:new Date(Math.max(t.valueOf(),n.valueOf()))}class U1 extends Tk{}function TP(t,n,e,i){if(n[t])return n[t];let r=function Wae(t,n,e,i){let r=e[t],s=i[t],c=E=>r&&null!==r[E]?r[E]:s&&null!==s[E]?s[E]:null,f=c("component"),y=c("superType"),k=null;if(y){if(y===t)throw new Error("Can't have a custom view type that references itself");k=TP(y,n,e,i)}return!f&&k&&(f=k.component),f?{type:t,component:f,defaults:Object.assign(Object.assign({},k?k.defaults:{}),r?r.rawOptions:{}),overrides:Object.assign(Object.assign({},k?k.overrides:{}),s?s.rawOptions:{})}:null}(t,n,e,i);return r&&(n[t]=r),r}function Qz(t){return tg(t,Zae)}function Zae(t){let n="function"==typeof t?{component:t}:t,{component:e}=n;return n.content?e=Jz(n):e&&!(e.prototype instanceof os)&&(e=Jz(Object.assign(Object.assign({},n),{content:e}))),{superType:n.type,component:e,rawOptions:n}}function Jz(t){return n=>et(ng.Consumer,null,e=>et(eh,{elTag:"div",elClasses:J9(e.viewSpec),renderProps:Object.assign(Object.assign({},n),{nextDayThreshold:e.options.nextDayThreshold}),generatorName:void 0,customGenerator:t.content,classNameGenerator:t.classNames,didMount:t.didMount,willUnmount:t.willUnmount}))}function Yae(t,n,e,i){let r=Qz(t),s=Qz(n.views),c=function Gae(t,n){let i,e={};for(i in t)TP(i,e,t,n);for(i in n)TP(i,e,t,n);return e}(r,s);return tg(c,f=>function Xae(t,n,e,i,r){let s=t.overrides.duration||t.defaults.duration||i.duration||e.duration,c=null,f="",y="",k={};if(s&&(c=function Kae(t){let n=JSON.stringify(t),e=eN[n];return void 0===e&&(e=ko(t),eN[n]=e),e}(s),c)){let $=zA(c);f=$.unit,1===$.value&&(y=f,k=n[f]?n[f].rawOptions:{})}let E=$=>{let W=$.buttonText||{},re=t.defaults.buttonTextKey;return null!=re&&null!=W[re]?W[re]:null!=W[t.type]?W[t.type]:null!=W[y]?W[y]:null},F=$=>{let W=$.buttonHints||{},re=t.defaults.buttonTextKey;return null!=re&&null!=W[re]?W[re]:null!=W[t.type]?W[t.type]:null!=W[y]?W[y]:null};return{type:t.type,component:t.component,duration:c,durationUnit:f,singleUnit:y,optionDefaults:t.defaults,optionOverrides:Object.assign(Object.assign({},k),t.overrides),buttonTextOverride:E(i)||E(e)||t.overrides.buttonText,buttonTextDefault:E(r)||t.defaults.buttonText||E(Dk)||t.type,buttonTitleOverride:F(i)||F(e)||t.overrides.buttonHint,buttonTitleDefault:F(r)||t.defaults.buttonHint||F(Dk)}}(f,s,n,e,i))}U1.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"},U1.prototype.baseIconClass="fc-icon",U1.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"},U1.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"},U1.prototype.iconOverrideOption="buttonIcons",U1.prototype.iconOverrideCustomButtonOption="icon",U1.prototype.iconOverridePrefix="fc-icon-";let eN={};function tN(t){for(let n in t)if(t[n].isFetching)return!0;return!1}function nN(t,n,e,i){let r={};for(let s of n)r[s.sourceId]=s;return e&&(r=iN(r,e,i)),Object.assign(Object.assign({},t),r)}function iN(t,n,e){return AP(t,ny(t,i=>function ale(t,n,e){return oN(t,e)?!e.options.lazyFetching||!t.fetchRange||t.isFetching||n.start<t.fetchRange.start||n.end>t.fetchRange.end:!t.latestFetchId}(i,n,e)),n,!1,e)}function AP(t,n,e,i,r){let s={};for(let c in t){let f=t[c];s[c]=n[c]?lle(f,e,i,r):f}return s}function lle(t,n,e,i){let{options:r,calendarApi:s}=i,c=i.pluginHooks.eventSourceDefs[t.sourceDefId],f=J_();return c.fetch({eventSource:t,range:n,isRefetch:e,context:i},y=>{let{rawEvents:k}=y;r.eventSourceSuccess&&(k=r.eventSourceSuccess.call(s,k,y.response)||k),t.success&&(k=t.success.call(s,k,y.response)||k),i.dispatch({type:"RECEIVE_EVENTS",sourceId:t.sourceId,fetchId:f,fetchRange:n,rawEvents:k})},y=>{let k=!1;r.eventSourceFailure&&(r.eventSourceFailure.call(s,y),k=!0),t.failure&&(t.failure(y),k=!0),k||console.warn(y.message,y),i.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:t.sourceId,fetchId:f,fetchRange:n,error:y})}),Object.assign(Object.assign({},t),{isFetching:!0,latestFetchId:f})}function rN(t,n){return ny(t,e=>oN(e,n))}function oN(t,n){return!n.pluginHooks.eventSourceDefs[t.sourceDefId].ignoreRange}function hle(t,n){switch(n.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return n.selection;default:return t}}function ule(t,n){switch(n.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return n.eventInstanceId;default:return t}}function ple(t,n){let e;switch(n.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return e=n.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return t}}function fle(t,n){let e;switch(n.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return e=n.state,{affectedEvents:e.affectedEvents,mutatedEvents:e.mutatedEvents,isEvent:e.isEvent};default:return t}}function mle(t,n,e,i,r){return{header:t.headerToolbar?sN(t.headerToolbar,t,n,e,i,r):null,footer:t.footerToolbar?sN(t.footerToolbar,t,n,e,i,r):null}}function sN(t,n,e,i,r,s){let c={},f=[],y=!1;for(let k in t){let F=gle(t[k],n,e,i,r,s);c[k]=F.widgets,f.push(...F.viewsWithButtons),y=y||F.hasTitle}return{sectionWidgets:c,viewsWithButtons:f,hasTitle:y}}function gle(t,n,e,i,r,s){let c="rtl"===n.direction,f=n.customButtons||{},y=e.buttonText||{},k=n.buttonText||{},E=e.buttonHints||{},F=n.buttonHints||{},$=t?t.split(" "):[],W=[],re=!1;return{widgets:$.map(me=>me.split(",").map(Pe=>{if("title"===Pe)return re=!0,{buttonName:Pe};let Re,rt,ft,Ct,Vt,sn;if(Re=f[Pe])ft=Qt=>{Re.click&&Re.click.call(Qt.target,Qt,Qt.target)},(Ct=i.getCustomButtonIconClass(Re))||(Ct=i.getIconClass(Pe,c))||(Vt=Re.text),sn=Re.hint||Re.text;else if(rt=r[Pe]){W.push(Pe),ft=()=>{s.changeView(Pe)},(Vt=rt.buttonTextOverride)||(Ct=i.getIconClass(Pe,c))||(Vt=rt.buttonTextDefault);let Qt=rt.buttonTextOverride||rt.buttonTextDefault;sn=Sk(rt.buttonTitleOverride||rt.buttonTitleDefault||n.viewHint,[Qt,Pe],Qt)}else if(s[Pe])if(ft=()=>{s[Pe]()},(Vt=y[Pe])||(Ct=i.getIconClass(Pe,c))||(Vt=k[Pe]),"prevYear"===Pe||"nextYear"===Pe){let Qt="prevYear"===Pe?"prev":"next";sn=Sk(E[Qt]||F[Qt],[k.year||"year","year"],k[Pe])}else sn=Qt=>Sk(E[Pe]||F[Pe],[k[Qt]||Qt,Qt],k[Pe]);return{buttonName:Pe,buttonClick:ft,buttonIcon:Ct,buttonText:Vt,buttonHint:sn}})),viewsWithButtons:W,hasTitle:re}}class _le{constructor(n,e,i){this.type=n,this.getCurrentData=e,this.dateEnv=i}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(n){return this.getCurrentData().options[n]}}const yle=Vf({name:"array-event-source",eventSourceDefs:[{ignoreRange:!0,parseMeta:t=>Array.isArray(t.events)?t.events:null,fetch(t,n){n({rawEvents:t.eventSource.meta})}}]}),vle=Vf({name:"func-event-source",eventSourceDefs:[{parseMeta:t=>"function"==typeof t.events?t.events:null,fetch(t,n,e){const{dateEnv:i}=t.context;!function Ise(t,n,e){let i=!1,r=function(f){i||(i=!0,n(f))},s=function(f){i||(i=!0,e(f))},c=t(r,s);c&&"function"==typeof c.then&&c.then(r,s)}(t.eventSource.meta.bind(null,bz(t.range,i)),s=>n({rawEvents:s}),e)}}]}),ble=Vf({name:"json-event-source",eventSourceRefiners:{method:String,extraParams:Gt,startParam:String,endParam:String,timeZoneParam:String},eventSourceDefs:[{parseMeta:t=>!t.url||"json"!==t.format&&t.format?null:{url:t.url,format:"json",method:(t.method||"GET").toUpperCase(),extraParams:t.extraParams,startParam:t.startParam,endParam:t.endParam,timeZoneParam:t.timeZoneParam},fetch(t,n,e){const{meta:i}=t.eventSource,r=function xle(t,n,e){let s,c,f,y,{dateEnv:i,options:r}=e,k={};return s=t.startParam,null==s&&(s=r.startParam),c=t.endParam,null==c&&(c=r.endParam),f=t.timeZoneParam,null==f&&(f=r.timeZoneParam),y="function"==typeof t.extraParams?t.extraParams():t.extraParams||{},Object.assign(k,y),k[s]=i.formatIso(n.start),k[c]=i.formatIso(n.end),"local"!==i.timeZone&&(k[f]=i.timeZone),k}(i,t.range,t.context);(function Ose(t,n,e){const i={method:t=t.toUpperCase()};return"GET"===t?n+=(-1===n.indexOf("?")?"?":"&")+new URLSearchParams(e):(i.body=new URLSearchParams(e),i.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(n,i).then(r=>{if(r.ok)return r.json().then(s=>[s,r],()=>{throw new wz("Failure parsing JSON",r)});throw new wz("Request failed",r)})})(i.method,i.url,r).then(([s,c])=>{n({rawEvents:s,response:c})},e)}}]}),wle=Vf({name:"simple-recurring-event",recurringTypes:[{parse(t,n){if(t.daysOfWeek||t.startTime||t.endTime||t.startRecur||t.endRecur){let i,e={daysOfWeek:t.daysOfWeek||null,startTime:t.startTime||null,endTime:t.endTime||null,startRecur:t.startRecur?n.createMarker(t.startRecur):null,endRecur:t.endRecur?n.createMarker(t.endRecur):null,dateEnv:n};return t.duration&&(i=t.duration),!i&&t.startTime&&t.endTime&&(i=function $re(t,n){return{years:t.years-n.years,months:t.months-n.months,days:t.days-n.days,milliseconds:t.milliseconds-n.milliseconds}}(t.endTime,t.startTime)),{allDayGuess:!t.startTime&&!t.endTime,duration:i,typeData:e}}return null},expand(t,n,e){let i=H1(n,{start:t.startRecur,end:t.endRecur});return i?function kle(t,n,e,i,r){let s=t?Z9(t):null,c=$s(r.start),f=r.end,y=[];for(;c<f;){let k;(!s||s[c.getUTCDay()])&&(k=n?i.add(c,n):c,y.push(i.createMarker(e.toDate(k)))),c=Oc(c,1)}return y}(t.daysOfWeek,t.startTime,t.dateEnv,e,i):[]}}],eventRefiners:{daysOfWeek:Gt,startTime:ko,endTime:ko,duration:ko,startRecur:Gt,endRecur:Gt}}),Mle=Vf({name:"change-handler",optionChangeHandlers:{events(t,n){aN([t],n)},eventSources:aN}});function aN(t,n){let e=UA(n.getCurrentData().eventSources);if(1===e.length&&1===t.length&&Array.isArray(e[0]._raw)&&Array.isArray(t[0]))return void n.dispatch({type:"RESET_RAW_EVENTS",sourceId:e[0].sourceId,rawEvents:t[0]});let i=[];for(let r of t){let s=!1;for(let c=0;c<e.length;c+=1)if(e[c]._raw===r){e.splice(c,1),s=!0;break}s||i.push(r)}for(let r of e)n.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:r.sourceId});for(let r of i)n.calendarApi.addEventSource(r)}const Ele=[yle,vle,ble,wle,Mle,Vf({name:"misc",isLoadingFuncs:[t=>tN(t.eventSources)],propSetHandlers:{dateProfile:function Cle(t,n){n.emitter.trigger("datesSet",Object.assign(Object.assign({},bz(t.activeRange,n.dateEnv)),{view:n.viewApi}))},eventStore:function Sle(t,n){let{emitter:e}=n;e.hasHandlers("eventsSet")&&e.trigger("eventsSet",ry(t,n))}}})];class Dle{constructor(n,e){this.runTaskOption=n,this.drainedOption=e,this.queue=[],this.delayedRunner=new PA(this.drain.bind(this))}request(n,e){this.queue.push(n),this.delayedRunner.request(e)}pause(n){this.delayedRunner.pause(n)}resume(n,e){this.delayedRunner.resume(n,e)}drain(){let{queue:n}=this;for(;n.length;){let i,e=[];for(;i=n.shift();)this.runTask(i),e.push(i);this.drained(e)}}runTask(n){this.runTaskOption&&this.runTaskOption(n)}drained(n){this.drainedOption&&this.drainedOption(n)}}function Tle(t,n,e){let i;return i=/^(year|month)$/.test(t.currentRangeUnit)?t.currentRange:t.activeRange,e.formatRange(i.start,i.end,pa(n.titleFormat||function Ale(t){let{currentRangeUnit:n}=t;if("year"===n)return{year:"numeric"};if("month"===n)return{year:"numeric",month:"long"};let e=n5(t.currentRange.start,t.currentRange.end);return null!==e&&e>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}(t)),{isEndExclusive:t.isRangeAllDay,defaultSeparator:n.titleRangeSeparator})}class lN{constructor(){this.resetListeners=new Set}handleInput(n,e){const i=this.dateEnv;if(n!==i&&("function"==typeof e?this.nowFn=e:i||(this.nowAnchorDate=n.toDate(e?n.createMarker(e):n.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=n,i))for(const r of this.resetListeners.values())r()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(n){this.resetListeners.add(n)}removeResetListener(n){this.resetListeners.delete(n)}}class Ple{constructor(n){this.computeCurrentViewData=er(this._computeCurrentViewData),this.organizeRawLocales=er(Xz),this.buildLocale=er(DP),this.buildPluginHooks=function Uae(){let e,t=[],n=[];return(i,r)=>((!e||!Nf(i,t)||!Nf(r,n))&&(e=function Hae(t,n){let e={},i={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function r(s){for(let c of s){const f=c.name,y=e[f];void 0===y?(e[f]=c.id,r(c.deps),i=qae(i,c)):y!==c.id&&console.warn(`Duplicate plugin '${f}'`)}}return t&&r(t),r(n),i}(i,r)),t=i,n=r,e)}(),this.buildDateEnv=er(Ile),this.buildTheme=er(Ole),this.parseToolbars=er(mle),this.buildViewSpecs=er(Yae),this.buildDateProfileGenerator=r5(Rle),this.buildViewApi=er(Lle),this.buildViewUiProps=r5(Nle),this.buildEventUiBySource=er(Fle,Bf),this.buildEventUiBases=er(zle),this.parseContextBusinessHours=r5(Ble),this.buildTitle=er(Tle),this.nowManager=new lN,this.emitter=new y5,this.actionRunner=new Dle(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=$=>{this.actionRunner.request($)},this.props=n,this.actionRunner.pause(),this.nowManager=new lN;let e={},i=this.computeOptionsData(n.optionOverrides,e,n.calendarApi),r=i.calendarOptions.initialView||i.pluginHooks.initialView,s=this.computeCurrentViewData(r,i,n.optionOverrides,e);n.calendarApi.currentDataManager=this,this.emitter.setThisContext(n.calendarApi),this.emitter.setOptions(s.options);let c={nowManager:this.nowManager,dateEnv:i.dateEnv,options:i.calendarOptions,pluginHooks:i.pluginHooks,calendarApi:n.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},f=function ele(t,n,e){let i=t.initialDate;return null!=i?n.createMarker(i):e.getDateMarker()}(i.calendarOptions,i.dateEnv,this.nowManager),y=s.dateProfileGenerator.build(f);rg(y.activeRange,f)||(f=y.currentRange.start);for(let $ of i.pluginHooks.contextInit)$(c);let k=function ile(t,n,e){let i=n?n.activeRange:null;return nN({},function dle(t,n){let e=cz(n),i=[].concat(t.eventSources||[]),r=[];t.initialEvents&&i.unshift(t.initialEvents),t.events&&i.unshift(t.events);for(let s of i){let c=lz(s,n,e);c&&r.push(c)}return r}(t,e),i,e)}(i.calendarOptions,y,c),E={dynamicOptionOverrides:e,currentViewType:r,currentDate:f,dateProfile:y,businessHours:this.parseContextBusinessHours(c),eventSources:k,eventUiBases:{},eventStore:{defs:{},instances:{}},renderableEventStore:{defs:{},instances:{}},dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(c).selectionConfig},F=Object.assign(Object.assign({},c),E);for(let $ of i.pluginHooks.reducers)Object.assign(E,$(null,null,F));PP(E,c)&&this.emitter.trigger("loading",!0),this.state=E,this.updateData(),this.actionRunner.resume()}resetOptions(n,e){let{props:i}=this;void 0===e?i.optionOverrides=n:(i.optionOverrides=Object.assign(Object.assign({},i.optionOverrides||{}),n),this.optionsForRefining.push(...e)),(void 0===e||e.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(n){let{props:e,state:i,emitter:r}=this,s=function tle(t,n){return"SET_OPTION"===n.type?Object.assign(Object.assign({},t),{[n.optionName]:n.rawOptionValue}):t}(i.dynamicOptionOverrides,n),c=this.computeOptionsData(e.optionOverrides,s,e.calendarApi),f=function Qae(t,n){return"CHANGE_VIEW_TYPE"===n.type&&(t=n.viewType),t}(i.currentViewType,n),y=this.computeCurrentViewData(f,c,e.optionOverrides,s);e.calendarApi.currentDataManager=this,r.setThisContext(e.calendarApi),r.setOptions(y.options);let k={nowManager:this.nowManager,dateEnv:c.dateEnv,options:c.calendarOptions,pluginHooks:c.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:r,getCurrentData:this.getCurrentData},{currentDate:E,dateProfile:F}=i;this.data&&this.data.dateProfileGenerator!==y.dateProfileGenerator&&(F=y.dateProfileGenerator.build(E)),E=function Jae(t,n){return"CHANGE_DATE"===n.type?n.dateMarker:t}(E,n),F=function nle(t,n,e,i){let r;switch(n.type){case"CHANGE_VIEW_TYPE":return i.build(n.dateMarker||e);case"CHANGE_DATE":return i.build(n.dateMarker);case"PREV":if(r=i.buildPrev(t,e),r.isValid)return r;break;case"NEXT":if(r=i.buildNext(t,e),r.isValid)return r}return t}(F,n,E,y.dateProfileGenerator),("PREV"===n.type||"NEXT"===n.type||!rg(F.currentRange,E))&&(E=F.currentRange.start);let $=function rle(t,n,e,i){let r=e?e.activeRange:null;switch(n.type){case"ADD_EVENT_SOURCES":return nN(t,n.sources,r,i);case"REMOVE_EVENT_SOURCE":return function sle(t,n){return ny(t,e=>e.sourceId!==n)}(t,n.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return e?iN(t,r,i):t;case"FETCH_EVENT_SOURCES":return AP(t,n.sourceIds?Z9(n.sourceIds):rN(t,i),r,n.isRefetch||!1,i);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return function cle(t,n,e,i){let r=t[n];return r&&e===r.latestFetchId?Object.assign(Object.assign({},t),{[n]:Object.assign(Object.assign({},r),{isFetching:!1,fetchRange:i})}):t}(t,n.sourceId,n.fetchId,n.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return t}}(i.eventSources,n,F,k),W=function ose(t,n,e,i,r){switch(n.type){case"RECEIVE_EVENTS":return function sse(t,n,e,i,r,s){if(n&&e===n.latestFetchId){let c=Pk(dz(r,n,s),n,s);return i&&(c=iy(c,i,s)),tP(pz(t,n.sourceId),c)}return t}(t,e[n.sourceId],n.fetchId,n.fetchRange,n.rawEvents,r);case"RESET_RAW_EVENTS":return function ase(t,n,e,i,r){const{defIdMap:s,instanceIdMap:c}=function dse(t){const{defs:n,instances:e}=t,i={},r={};for(let s in n){const c=n[s],{publicId:f}=c;f&&(i[f]=s)}for(let s in e){const f=n[e[s].defId],{publicId:y}=f;y&&(r[y]=s)}return{defIdMap:i,instanceIdMap:r}}(t);return iy(Pk(dz(e,n,r),n,r,!1,s,c),i,r)}(t,e[n.sourceId],n.rawEvents,i.activeRange,r);case"ADD_EVENTS":return function lse(t,n,e,i){return e&&(n=iy(n,e,i)),tP(t,n)}(t,n.eventStore,i?i.activeRange:null,r);case"RESET_EVENTS":return n.eventStore;case"MERGE_EVENTS":return tP(t,n.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return i?iy(t,i.activeRange,r):t;case"REMOVE_EVENTS":return function Joe(t,n){let{defs:e,instances:i}=t,r={},s={};for(let c in e)n.defs[c]||(r[c]=e[c]);for(let c in i)!n.instances[c]&&r[i[c].defId]&&(s[c]=i[c]);return{defs:r,instances:s}}(t,n.eventStore);case"REMOVE_EVENT_SOURCE":return pz(t,n.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return m5(t,s=>!s.sourceId);case"REMOVE_ALL_EVENTS":return{defs:{},instances:{}};default:return t}}(i.eventStore,n,$,F,k),he=tN($)&&!y.options.progressiveEventRendering&&i.renderableEventStore||W,{eventUiSingleBase:me,selectionConfig:Pe}=this.buildViewUiProps(k),Re=this.buildEventUiBySource($),ft={dynamicOptionOverrides:s,currentViewType:f,currentDate:E,dateProfile:F,eventSources:$,eventStore:W,renderableEventStore:he,selectionConfig:Pe,eventUiBases:this.buildEventUiBases(he.defs,me,Re),businessHours:this.parseContextBusinessHours(k),dateSelection:hle(i.dateSelection,n),eventSelection:ule(i.eventSelection,n),eventDrag:ple(i.eventDrag,n),eventResize:fle(i.eventResize,n)},Ct=Object.assign(Object.assign({},k),ft);for(let Qt of c.pluginHooks.reducers)Object.assign(ft,Qt(i,n,Ct));let Vt=PP(i,k),sn=PP(ft,k);!Vt&&sn?r.trigger("loading",!0):Vt&&!sn&&r.trigger("loading",!1),this.state=ft,e.onAction&&e.onAction(n)}updateData(){let{props:n,state:e}=this,i=this.data,r=this.computeOptionsData(n.optionOverrides,e.dynamicOptionOverrides,n.calendarApi),s=this.computeCurrentViewData(e.currentViewType,r,n.optionOverrides,e.dynamicOptionOverrides),c=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(e.dateProfile,s.options,r.dateEnv),calendarApi:n.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},r),s),e),f=r.pluginHooks.optionChangeHandlers,y=i&&i.calendarOptions,k=r.calendarOptions;if(y&&y!==k){y.timeZone!==k.timeZone&&(e.eventSources=c.eventSources=function ole(t,n,e){let i=n?n.activeRange:null;return AP(t,rN(t,e),i,!0,e)}(c.eventSources,e.dateProfile,c),e.eventStore=c.eventStore=uz(c.eventStore,i.dateEnv,c.dateEnv),e.renderableEventStore=c.renderableEventStore=uz(c.renderableEventStore,i.dateEnv,c.dateEnv));for(let E in f)(-1!==this.optionsForHandling.indexOf(E)||y[E]!==k[E])&&f[E](k[E],c)}this.optionsForHandling=[],n.onData&&n.onData(c)}computeOptionsData(n,e,i){if(!this.optionsForRefining.length&&n===this.stableOptionOverrides&&e===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:r,pluginHooks:s,localeDefaults:c,availableLocaleData:f,extra:y}=this.processRawCalendarOptions(n,e);cN(y);let k=this.buildDateEnv(r.timeZone,r.locale,r.weekNumberCalculation,r.firstDay,r.weekText,s,f,r.defaultRangeSeparator),E=this.buildViewSpecs(s.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,c),F=this.buildTheme(r,s),$=this.parseToolbars(r,this.stableOptionOverrides,F,E,i);return this.stableCalendarOptionsData={calendarOptions:r,pluginHooks:s,dateEnv:k,viewSpecs:E,theme:F,toolbarConfig:$,localeDefaults:c,availableRawLocales:f.map}}processRawCalendarOptions(n,e){let{locales:i,locale:r}=jA([Dk,n,e]),s=this.organizeRawLocales(i),f=this.buildLocale(r||s.defaultCode,s.map).options,y=this.buildPluginHooks(n.plugins||[],Ele),k=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$9),G9),W9),y.listenerRefiners),y.optionRefiners),E={},F=jA([Dk,f,n,e]),$={},W=this.currentCalendarOptionsInput,re=this.currentCalendarOptionsRefined,he=!1;for(let me in F)-1===this.optionsForRefining.indexOf(me)&&(F[me]===W[me]||ey[me]&&me in W&&ey[me](W[me],F[me]))?$[me]=re[me]:k[me]?($[me]=k[me](F[me]),he=!0):E[me]=W[me];return he&&(this.currentCalendarOptionsInput=F,this.currentCalendarOptionsRefined=$,this.stableOptionOverrides=n,this.stableDynamicOptionOverrides=e),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:y,availableLocaleData:s,localeDefaults:f,extra:E}}_computeCurrentViewData(n,e,i,r){let s=e.viewSpecs[n];if(!s)throw new Error(`viewType "${n}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:c,extra:f}=this.processRawViewOptions(s,e.pluginHooks,e.localeDefaults,i,r);return cN(f),this.nowManager.handleInput(e.dateEnv,c.now),{viewSpec:s,options:c,dateProfileGenerator:this.buildDateProfileGenerator({dateProfileGeneratorClass:s.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:s.duration,durationUnit:s.durationUnit,usesMinMaxTime:s.optionDefaults.usesMinMaxTime,dateEnv:e.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:c.slotMinTime,slotMaxTime:c.slotMaxTime,showNonCurrentDates:c.showNonCurrentDates,dayCount:c.dayCount,dateAlignment:c.dateAlignment,dateIncrement:c.dateIncrement,hiddenDays:c.hiddenDays,weekends:c.weekends,validRangeInput:c.validRange,visibleRangeInput:c.visibleRange,fixedWeekCount:c.fixedWeekCount}),viewApi:this.buildViewApi(n,this.getCurrentData,e.dateEnv)}}processRawViewOptions(n,e,i,r,s){let c=jA([Dk,n.optionDefaults,i,r,n.optionOverrides,s]),f=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$9),G9),W9),koe),e.listenerRefiners),e.optionRefiners),y={},k=this.currentViewOptionsInput,E=this.currentViewOptionsRefined,F=!1,$={};for(let W in c)c[W]===k[W]||ey[W]&&ey[W](c[W],k[W])?y[W]=E[W]:(c[W]===this.currentCalendarOptionsInput[W]||ey[W]&&ey[W](c[W],this.currentCalendarOptionsInput[W])?W in this.currentCalendarOptionsRefined&&(y[W]=this.currentCalendarOptionsRefined[W]):f[W]?y[W]=f[W](c[W]):$[W]=c[W],F=!0);return F&&(this.currentViewOptionsInput=c,this.currentViewOptionsRefined=y),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:$}}}function Ile(t,n,e,i,r,s,c,f){let y=DP(n||c.defaultCode,c.map);return new Ooe({calendarSystem:"gregory",timeZone:t,namedTimeZoneImpl:s.namedTimeZonedImpl,locale:y,weekNumberCalculation:e,firstDay:i,weekText:r,cmdFormatter:s.cmdFormatter,defaultSeparator:f})}function Ole(t,n){return new(n.themeClasses[t.themeSystem]||U1)(t)}function Rle(t){return new(t.dateProfileGeneratorClass||nz)(t)}function Lle(t,n,e){return new _le(t,n,e)}function Fle(t){return tg(t,n=>n.ui)}function zle(t,n,e){let i={"":n};for(let r in t){let s=t[r];s.sourceId&&e[s.sourceId]&&(i[r]=e[s.sourceId])}return i}function Nle(t){let{options:n}=t;return{eventUiSingleBase:_5({display:n.eventDisplay,editable:n.editable,startEditable:n.eventStartEditable,durationEditable:n.eventDurationEditable,constraint:n.eventConstraint,overlap:"boolean"==typeof n.eventOverlap?n.eventOverlap:void 0,allow:n.eventAllow,backgroundColor:n.eventBackgroundColor,borderColor:n.eventBorderColor,textColor:n.eventTextColor,color:n.eventColor},t),selectionConfig:_5({constraint:n.selectConstraint,overlap:"boolean"==typeof n.selectOverlap?n.selectOverlap:void 0,allow:n.selectAllow},t)}}function PP(t,n){for(let e of n.pluginHooks.isLoadingFuncs)if(e(t))return!0;return!1}function Ble(t){return function fse(t,n){return Pk(function mse(t){let n;return n=!0===t?[{}]:Array.isArray(t)?t.filter(e=>e.daysOfWeek):"object"==typeof t&&t?[t]:[],n=n.map(e=>Object.assign(Object.assign({},pse),e)),n}(t),null,n)}(t.options.businessHours,t)}function cN(t,n){for(let e in t)console.warn(`Unknown option '${e}'`+(n?` for view '${n}'`:""))}class Vle extends os{render(){return et("div",{className:"fc-toolbar-chunk"},...this.props.widgetGroups.map(e=>this.renderWidgetGroup(e)))}renderWidgetGroup(n){let{props:e}=this,{theme:i}=this.context,r=[],s=!0;for(let c of n){let{buttonName:f,buttonClick:y,buttonText:k,buttonIcon:E,buttonHint:F}=c;if("title"===f)s=!1,r.push(et("h2",{className:"fc-toolbar-title",id:e.titleId},e.title));else{let $=f===e.activeButton,W=!e.isTodayEnabled&&"today"===f||!e.isPrevEnabled&&"prev"===f||!e.isNextEnabled&&"next"===f,re=[`fc-${f}-button`,i.getClass("button")];$&&re.push(i.getClass("buttonActive")),r.push(et("button",{type:"button",title:"function"==typeof F?F(e.navUnit):F,disabled:W,"aria-pressed":$,className:re.join(" "),onClick:y},k||(E?et("span",{className:E,role:"img"}):"")))}}return r.length>1?et("div",{className:s&&i.getClass("buttonGroup")||""},...r):r[0]}}class dN extends os{render(){let r,s,{model:n,extraClassName:e}=this.props,i=!1,c=n.sectionWidgets,f=c.center;return c.left?(i=!0,r=c.left):r=c.start,c.right?(i=!0,s=c.right):s=c.end,et("div",{className:[e||"","fc-toolbar",i?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",r||[]),this.renderSection("center",f||[]),this.renderSection("end",s||[]))}renderSection(n,e){let{props:i}=this;return et(Vle,{key:n,widgetGroups:e,title:i.title,navUnit:i.navUnit,activeButton:i.activeButton,isTodayEnabled:i.isTodayEnabled,isPrevEnabled:i.isPrevEnabled,isNextEnabled:i.isNextEnabled,titleId:i.titleId})}}class jle extends os{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=n=>{this.el=n,ig(this.props.elRef,n),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:n,state:e}=this,{aspectRatio:i}=n,s="",c="";return i?null!==e.availableWidth?s=e.availableWidth/i:c=1/i*100+"%":s=n.height||"",et("div",{"aria-labelledby":n.labeledById,ref:this.handleEl,className:["fc-view-harness",i||n.liquid||n.height?"fc-view-harness-active":"fc-view-harness-passive"].join(" "),style:{height:s,paddingBottom:c}},n.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}}class Hle extends G2{constructor(n){super(n),this.handleSegClick=(e,i)=>{let{component:r}=this,{context:s}=r,c=$2(i);if(c&&r.isValidSegDownEl(e.target)){let f=Sd(e.target,".fc-event-forced-url"),y=f?f.querySelector("a[href]").href:"";s.emitter.trigger("eventClick",{el:i,event:new Ba(r.context,c.eventRange.def,c.eventRange.instance),jsEvent:e,view:s.viewApi}),y&&!e.defaultPrevented&&(window.location.href=y)}},this.destroy=A9(n.el,"click",".fc-event",this.handleSegClick)}}class Ule extends G2{constructor(n){super(n),this.handleEventElRemove=e=>{e===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(e,i)=>{$2(i)&&(this.currentSegEl=i,this.triggerEvent("eventMouseEnter",e,i))},this.handleSegLeave=(e,i)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",e,i))},this.removeHoverListeners=function Are(t,n,e,i){let r;return A9(t,"mouseover",n,(s,c)=>{if(c!==r){r=c,e(s,c);let f=y=>{r=null,i(y,c),c.removeEventListener("mouseleave",f)};c.addEventListener("mouseleave",f)}})}(n.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(n,e,i){let{component:r}=this,{context:s}=r,c=$2(i);(!e||r.isValidSegDownEl(e.target))&&s.emitter.trigger(n,{el:i,event:new Ba(s,c.eventRange.def,c.eventRange.instance),jsEvent:e,view:s.viewApi})}}class qle extends u5{constructor(){super(...arguments),this.buildViewContext=er(Foe),this.buildViewPropTransformers=er(Gle),this.buildToolbarProps=er($le),this.headerRef={current:null},this.footerRef={current:null},this.interactionsStore={},this.state={viewLabelId:z1()},this.registerInteractiveComponent=(n,e)=>{let i=function Fse(t,n){return{component:t,el:n.el,useEventCenter:null==n.useEventCenter||n.useEventCenter,isHitComboAllowed:n.isHitComboAllowed||null}}(n,e),c=[Hle,Ule].concat(this.props.pluginHooks.componentInteractions).map(f=>new f(i));this.interactionsStore[n.uid]=c,cP[n.uid]=i},this.unregisterInteractiveComponent=n=>{let e=this.interactionsStore[n.uid];if(e){for(let i of e)i.destroy();delete this.interactionsStore[n.uid]}delete cP[n.uid]},this.resizeRunner=new PA(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=n=>{let{options:e}=this.props;e.handleWindowResize&&n.target===window&&this.resizeRunner.request(e.windowResizeDelay)}}render(){let c,{props:n}=this,{toolbarConfig:e,options:i}=n,r=!1,s="";n.isHeightAuto||n.forPrint?s="":null!=i.height?r=!0:null!=i.contentHeight?s=i.contentHeight:c=Math.max(i.aspectRatio,.5);let f=this.buildViewContext(n.viewSpec,n.viewApi,n.options,n.dateProfileGenerator,n.dateEnv,n.nowManager,n.theme,n.pluginHooks,n.dispatch,n.getCurrentData,n.emitter,n.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),y=e.header&&e.header.hasTitle?this.state.viewLabelId:void 0;return et(ng.Provider,{value:f},et(W2,{unit:"day"},k=>{let E=this.buildToolbarProps(n.viewSpec,n.dateProfile,n.dateProfileGenerator,n.currentDate,k,n.viewTitle);return et(ms,null,e.header&&et(dN,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:e.header,titleId:y},E)),et(jle,{liquid:r,height:s,aspectRatio:c,labeledById:y},this.renderView(n),this.buildAppendContent()),e.footer&&et(dN,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:e.footer,titleId:""},E)))}))}componentDidMount(){let{props:n}=this;this.calendarInteractions=n.pluginHooks.calendarInteractions.map(i=>new i(n)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:e}=n.pluginHooks;for(let i in e)e[i](n[i],n)}componentDidUpdate(n){let{props:e}=this,{propSetHandlers:i}=e.pluginHooks;for(let r in i)e[r]!==n[r]&&i[r](e[r],e)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let n of this.calendarInteractions)n.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:n}=this;return et(ms,{},...n.pluginHooks.viewContainerAppends.map(i=>i(n)))}renderView(n){let{pluginHooks:e}=n,{viewSpec:i}=n,r={dateProfile:n.dateProfile,businessHours:n.businessHours,eventStore:n.renderableEventStore,eventUiBases:n.eventUiBases,dateSelection:n.dateSelection,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,isHeightAuto:n.isHeightAuto,forPrint:n.forPrint},s=this.buildViewPropTransformers(e.viewPropsTransformers);for(let f of s)Object.assign(r,f.transform(r,n));return et(i.component,Object.assign({},r))}}function $le(t,n,e,i,r,s){let c=e.build(r,void 0,!1),f=e.buildPrev(n,i,!1),y=e.buildNext(n,i,!1);return{title:s,activeButton:t.type,navUnit:t.singleUnit,isTodayEnabled:c.isValid&&!rg(n.currentRange,r),isPrevEnabled:f.isValid,isNextEnabled:y.isValid}}function Gle(t){return t.map(n=>new n)}class Wle extends Nse{constructor(n,e={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=i=>{switch(i.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=i=>{this.currentData=i,this.renderRunner.request(i.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:i}=this;h5(()=>{L1(et(Lse,{options:i.calendarOptions,theme:i.theme,emitter:i.emitter},(r,s,c,f)=>(this.setClassNames(r),this.setHeight(s),et(Q9.Provider,{value:this.customContentRenderId},et(qle,Object.assign({isHeightAuto:c,forPrint:f},i))))),this.el)})}else this.isRendered&&(this.isRendered=!1,L1(null,this.el),this.setClassNames([]),this.setHeight(""))},function wre(t){t.isConnected&&t.getRootNode&&M9(t.getRootNode())}(n),this.el=n,this.renderRunner=new PA(this.handleRenderRequest),new Ple({optionOverrides:e,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let n=this.isRendering;n?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),n&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){h5(()=>{super.updateSize()})}batchRendering(n){this.renderRunner.pause("batchRendering"),n(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(n,e){this.currentDataManager.resetOptions(n,e)}setClassNames(n){if(!Nf(n,this.currentClassNames)){let{classList:e}=this.el;for(let i of this.currentClassNames)e.remove(i);for(let i of n)e.add(i);this.currentClassNames=n}}setHeight(n){E9(this.el,"height",n)}}class Zle extends Tp{constructor(){super(...arguments),this.headerElRef={current:null}}renderSimpleLayout(n,e){let{props:i,context:r}=this,s=[],c=M5(r.options);return n&&s.push({type:"header",key:"header",isSticky:c,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:n}}),s.push({type:"body",key:"body",liquid:!0,chunk:{content:e}}),et(Ak,{elClasses:["fc-daygrid"],viewSpec:r.viewSpec},et(kP,{liquid:!i.isHeightAuto&&!i.forPrint,collapsibleWidth:i.forPrint,cols:[],sections:s}))}renderHScrollLayout(n,e,i,r){let s=this.context.pluginHooks.scrollGridImpl;if(!s)throw new Error("No ScrollGrid implementation");let{props:c,context:f}=this,y=!c.forPrint&&M5(f.options),k=!c.forPrint&&Vz(f.options),E=[];return n&&E.push({type:"header",key:"header",isSticky:y,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:n}]}),E.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:e}]}),k&&E.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:wP}]}),et(Ak,{elClasses:["fc-daygrid"],viewSpec:f.viewSpec},et(s,{liquid:!c.isHeightAuto&&!c.forPrint,forPrint:c.forPrint,collapsibleWidth:c.forPrint,colGroups:[{cols:[{span:i,minWidth:r}]}],sections:E}))}}function S5(t,n){let e=[];for(let i=0;i<n;i+=1)e[i]=[];for(let i of t)e[i.row].push(i);return e}function E5(t,n){let e=[];for(let i=0;i<n;i+=1)e[i]=[];for(let i of t)e[i.firstCol].push(i);return e}function uN(t,n){let e=[];if(t){for(let i=0;i<n;i+=1)e[i]={affectedInstances:t.affectedInstances,isEvent:t.isEvent,segs:[]};for(let i of t.segs)e[i.row].segs.push(i)}else for(let i=0;i<n;i+=1)e[i]=null;return e}const pN=pa({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function fN(t){let{display:n}=t.eventRange.ui;return"list-item"===n||"auto"===n&&!t.eventRange.def.allDay&&t.firstCol===t.lastCol&&t.isStart&&t.isEnd}class mN extends os{render(){let{props:n}=this;return et(jz,Object.assign({},n,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:pN,defaultDisplayEventEnd:n.defaultDisplayEventEnd,disableResizing:!n.seg.eventRange.def.allDay}))}}class gN extends os{render(){let{props:n,context:e}=this,{options:i}=e,{seg:r}=n,c=Ik(r,i.eventTimeFormat||pN,e,!0,n.defaultDisplayEventEnd);return et(C5,Object.assign({},n,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:sP(n.seg,e),defaultGenerator:Yle,timeText:c,isResizing:!1,isDateSelecting:!1}))}}function Yle(t){return et(ms,null,et("div",{className:"fc-daygrid-event-dot",style:{borderColor:t.borderColor||t.backgroundColor}}),t.timeText&&et("div",{className:"fc-event-time"},t.timeText),et("div",{className:"fc-event-title"},t.event.title||et(ms,null,"\xa0")))}class Xle extends os{constructor(){super(...arguments),this.compileSegs=er(Kle)}render(){let{props:n}=this,{allSegs:e,invisibleSegs:i}=this.compileSegs(n.singlePlacements);return et($z,{elClasses:["fc-daygrid-more-link"],dateProfile:n.dateProfile,todayRange:n.todayRange,allDayDate:n.allDayDate,moreCnt:n.moreCnt,allSegs:e,hiddenSegs:i,alignmentElRef:n.alignmentElRef,alignGridTop:n.alignGridTop,extraDateSpan:n.extraDateSpan,popoverContent:()=>{let r=(n.eventDrag?n.eventDrag.affectedInstances:null)||(n.eventResize?n.eventResize.affectedInstances:null)||{};return et(ms,null,e.map(s=>{let c=s.eventRange.instance.instanceId;return et("div",{className:"fc-daygrid-event-harness",key:c,style:{visibility:r[c]?"hidden":""}},fN(s)?et(gN,Object.assign({seg:s,isDragging:!1,isSelected:c===n.eventSelection,defaultDisplayEventEnd:!1},og(s,n.todayRange))):et(mN,Object.assign({seg:s,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:c===n.eventSelection,defaultDisplayEventEnd:!1},og(s,n.todayRange))))}))}})}}function Kle(t){let n=[],e=[];for(let i of t)n.push(i.seg),i.isVisible||e.push(i.seg);return{allSegs:n,invisibleSegs:e}}const Qle=pa({week:"narrow"});class Jle extends Tp{constructor(){super(...arguments),this.rootElRef={current:null},this.state={dayNumberId:z1()},this.handleRootEl=n=>{ig(this.rootElRef,n),ig(this.props.elRef,n)}}render(){let{context:n,props:e,state:i,rootElRef:r}=this,{options:s,dateEnv:c}=n,{date:f,dateProfile:y}=e;const k=e.showDayNumber&&function tce(t,n,e){const{start:i,end:r}=n,s=N1(r,-1),c=e.getYear(i),f=e.getMonth(i),y=e.getYear(s),k=e.getMonth(s);return!(c===y&&f===k)&&(t.valueOf()===i.valueOf()||1===e.getDay(t)&&t.valueOf()<r.valueOf())}(f,y.currentRange,c);return et(CP,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...e.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},e.extraDataAttrs),e.showDayNumber?{"aria-labelledby":i.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:ece,date:f,dateProfile:y,todayRange:e.todayRange,showDayNumber:e.showDayNumber,isMonthStart:k,extraRenderProps:e.extraRenderProps},(E,F)=>et("div",{ref:e.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:e.minHeight}},e.showWeekNumber&&et(qz,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:Z2(n,f,"week"),date:f,defaultFormat:Qle}),!F.isDisabled&&(e.showDayNumber||SP(s)||e.forceDayTop)?et("div",{className:"fc-daygrid-day-top"},et(E,{elTag:"a",elClasses:["fc-daygrid-day-number",k&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},Z2(n,f)),{id:i.dayNumberId})})):e.showDayNumber?et("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},et("a",{className:"fc-daygrid-day-number"},"\xa0")):void 0,et("div",{className:"fc-daygrid-day-events",ref:e.fgContentElRef},e.fgContent,et("div",{className:"fc-daygrid-day-bottom",style:{marginTop:e.moreMarginTop}},et(Xle,{allDayDate:f,singlePlacements:e.singlePlacements,moreCnt:e.moreCnt,alignmentElRef:r,alignGridTop:!e.showDayNumber,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange}))),et("div",{className:"fc-daygrid-day-bg"},e.bgContent)))}}function ece(t){return t.dayNumberText||et(ms,null,"\xa0")}function _N(t){return t.eventRange.instance.instanceId+":"+t.firstCol}function yN(t){return _N(t)+":"+t.lastCol}function X2(t,n,e,i){if(t.firstCol===n&&t.lastCol===e-1)return t;let r=t.eventRange,s=r.range,c=H1(s,{start:i[n].date,end:Oc(i[e-1].date,1)});return Object.assign(Object.assign({},t),{firstCol:n,lastCol:e-1,eventRange:{def:r.def,ui:Object.assign(Object.assign({},r.ui),{durationEditable:!1}),instance:r.instance,range:c},isStart:t.isStart&&c.start.valueOf()===s.start.valueOf(),isEnd:t.isEnd&&c.end.valueOf()===s.end.valueOf()})}class oce extends Ez{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(n){const e=super.addSegs(n),{entriesByLevel:i}=this,r=s=>!this.forceHidden[oy(s)];for(let s=0;s<i.length;s+=1)i[s]=i[s].filter(r);return e}handleInvalidInsertion(n,e,i){const{entriesByLevel:r,forceHidden:s}=this,{touchingEntry:c,touchingLevel:f,touchingLateral:y}=n;if(this.hiddenConsumes&&c){const k=oy(c);if(!s[k])if(this.allowReslicing){const E=Object.assign(Object.assign({},c),{span:_P(c.span,e.span)});s[oy(E)]=!0,r[f][y]=E,i.push(E),this.splitEntry(c,e,i)}else s[k]=!0,i.push(c)}super.handleInvalidInsertion(n,e,i)}}class vN extends Tp{constructor(){super(...arguments),this.cellElRefs=new sg,this.frameElRefs=new sg,this.fgElRefs=new sg,this.segHarnessRefs=new sg,this.rootElRef={current:null},this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=n=>{n&&this.updateSizing(!0)}}render(){let{props:n,state:e,context:i}=this,{options:r}=i,s=n.cells.length,c=E5(n.businessHourSegs,s),f=E5(n.bgEventSegs,s),y=E5(this.getHighlightSegs(),s),k=E5(this.getMirrorSegs(),s),{singleColPlacements:E,multiColPlacements:F,moreCnts:$,moreMarginTops:W}=function nce(t,n,e,i,r,s,c){let f=new oce(Pe=>r[t[Pe.index].eventRange.instance.instanceId+":"+Pe.span.start+":"+(Pe.span.end-1)]||1);f.allowReslicing=!0,f.strictOrder=i,!0===n||!0===e?(f.maxCoord=s,f.hiddenConsumes=!0):"number"==typeof n?f.maxStackCnt=n:"number"==typeof e&&(f.maxStackCnt=e,f.hiddenConsumes=!0);let y=[],k=[];for(let Pe=0;Pe<t.length;Pe+=1){let Re=t[Pe],rt=yN(Re);null!=r[rt]?y.push({index:Pe,span:{start:Re.firstCol,end:Re.lastCol+1}}):k.push(Re)}let E=f.addSegs(y),F=f.toRects(),{singleColPlacements:$,multiColPlacements:W,leftoverMargins:re}=function ice(t,n,e){let i=function rce(t,n){let e=[];for(let i=0;i<n;i+=1)e.push([]);for(let i of t)for(let r=i.span.start;r<i.span.end;r+=1)e[r].push(i);return e}(t,e.length),r=[],s=[],c=[];for(let f=0;f<e.length;f+=1){let y=i[f],k=[],E=0,F=0;for(let W of y)k.push({seg:X2(n[W.index],f,f+1,e),isVisible:!0,isAbsolute:!1,absoluteTop:W.levelCoord,marginTop:W.levelCoord-E}),E=W.levelCoord+W.thickness;let $=[];E=0,F=0;for(let W of y){let re=n[W.index],me=W.span.start===f;F+=W.levelCoord-E,E=W.levelCoord+W.thickness,W.span.end-W.span.start>1?(F+=W.thickness,me&&$.push({seg:X2(re,W.span.start,W.span.end,e),isVisible:!0,isAbsolute:!0,absoluteTop:W.levelCoord,marginTop:0})):me&&($.push({seg:X2(re,W.span.start,W.span.end,e),isVisible:!0,isAbsolute:!1,absoluteTop:W.levelCoord,marginTop:F}),F=0)}r.push(k),s.push($),c.push(F)}return{singleColPlacements:r,multiColPlacements:s,leftoverMargins:c}}(F,t,c),he=[],me=[];for(let Pe of k){W[Pe.firstCol].push({seg:Pe,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let Re=Pe.firstCol;Re<=Pe.lastCol;Re+=1)$[Re].push({seg:X2(Pe,Re,Re+1,c),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let Pe=0;Pe<c.length;Pe+=1)he.push(0);for(let Pe of E){let Re=t[Pe.index],rt=Pe.span;W[rt.start].push({seg:X2(Re,rt.start,rt.end,c),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let ft=rt.start;ft<rt.end;ft+=1)he[ft]+=1,$[ft].push({seg:X2(Re,ft,ft+1,c),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let Pe=0;Pe<c.length;Pe+=1)me.push(re[Pe]);return{singleColPlacements:$,multiColPlacements:W,moreCnts:he,moreMarginTops:me}}(oP(n.fgEventSegs,r.eventOrder),n.dayMaxEvents,n.dayMaxEventRows,r.eventOrderStrict,e.segHeights,e.maxContentHeight,n.cells),re=n.eventDrag&&n.eventDrag.affectedInstances||n.eventResize&&n.eventResize.affectedInstances||{};return et("tr",{ref:this.rootElRef,role:"row"},n.renderIntro&&n.renderIntro(),n.cells.map((he,me)=>{let Pe=this.renderFgSegs(me,n.forPrint?E[me]:F[me],n.todayRange,re),Re=this.renderFgSegs(me,function sce(t,n){if(!t.length)return[];let e=function ace(t){let n={};for(let e of t)for(let i of e)n[i.seg.eventRange.instance.instanceId]=i.absoluteTop;return n}(n);return t.map(i=>({seg:i,isVisible:!0,isAbsolute:!0,absoluteTop:e[i.eventRange.instance.instanceId],marginTop:0}))}(k[me],F),n.todayRange,{},!!n.eventDrag,!!n.eventResize,!1);return et(Jle,{key:he.key,elRef:this.cellElRefs.createRef(he.key),innerElRef:this.frameElRefs.createRef(he.key),dateProfile:n.dateProfile,date:he.date,showDayNumber:n.showDayNumbers,showWeekNumber:n.showWeekNumbers&&0===me,forceDayTop:n.showWeekNumbers,todayRange:n.todayRange,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,extraRenderProps:he.extraRenderProps,extraDataAttrs:he.extraDataAttrs,extraClassNames:he.extraClassNames,extraDateSpan:he.extraDateSpan,moreCnt:$[me],moreMarginTop:W[me],singlePlacements:E[me],fgContentElRef:this.fgElRefs.createRef(he.key),fgContent:et(ms,null,et(ms,null,Pe),et(ms,null,Re)),bgContent:et(ms,null,this.renderFillSegs(y[me],"highlight"),this.renderFillSegs(c[me],"non-business"),this.renderFillSegs(f[me],"bg-event")),minHeight:n.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(n,e){this.updateSizing(!Bf(n,this.props))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:n}=this;return n.eventDrag&&n.eventDrag.segs.length?n.eventDrag.segs:n.eventResize&&n.eventResize.segs.length?n.eventResize.segs:n.dateSelectionSegs}getMirrorSegs(){let{props:n}=this;return n.eventResize&&n.eventResize.segs.length?n.eventResize.segs:[]}renderFgSegs(n,e,i,r,s,c,f){let{context:y}=this,{eventSelection:k}=this.props,{framePositions:E}=this.state,F=1===this.props.cells.length,$=s||c||f,W=[];if(E)for(let re of e){let{seg:he}=re,{instanceId:me}=he.eventRange.instance,Pe=re.isVisible&&!r[me],Re=re.isAbsolute,rt="",ft="";Re&&(y.isRtl?(ft=0,rt=E.lefts[he.lastCol]-E.lefts[he.firstCol]):(rt=0,ft=E.rights[he.firstCol]-E.rights[he.lastCol])),W.push(et("div",{className:"fc-daygrid-event-harness"+(Re?" fc-daygrid-event-harness-abs":""),key:_N(he),ref:$?null:this.segHarnessRefs.createRef(yN(he)),style:{visibility:Pe?"":"hidden",marginTop:Re?"":re.marginTop,top:Re?re.absoluteTop:"",left:rt,right:ft}},fN(he)?et(gN,Object.assign({seg:he,isDragging:s,isSelected:me===k,defaultDisplayEventEnd:F},og(he,i))):et(mN,Object.assign({seg:he,isDragging:s,isResizing:c,isDateSelecting:f,isSelected:me===k,defaultDisplayEventEnd:F},og(he,i)))))}return W}renderFillSegs(n,e){let{isRtl:i}=this.context,{todayRange:r}=this.props,{framePositions:s}=this.state,c=[];if(s)for(let f of n){let y=i?{right:0,left:s.lefts[f.lastCol]-s.lefts[f.firstCol]}:{left:0,right:s.rights[f.firstCol]-s.rights[f.lastCol]};c.push(et("div",{key:vz(f.eventRange),className:"fc-daygrid-bg-harness",style:y},"bg-event"===e?et(Hz,Object.assign({seg:f},og(f,r))):Uz(e)))}return et(ms,{},...c)}updateSizing(n){let{props:e,state:i,frameElRefs:r}=this;if(!e.forPrint&&null!==e.clientWidth){if(n){let y=e.cells.map(k=>r.currentMap[k.key]);if(y.length){let k=this.rootElRef.current,E=new Y2(k,y,!0,!1);(!i.framePositions||!i.framePositions.similarTo(E))&&this.setState({framePositions:new Y2(k,y,!0,!1)})}}const s=this.state.segHeights,c=this.querySegHeights(),f=!0===e.dayMaxEvents||!0===e.dayMaxEventRows;this.safeSetState({segHeights:Object.assign(Object.assign({},s),c),maxContentHeight:f?this.computeMaxContentHeight():null})}}querySegHeights(){let n=this.segHarnessRefs.currentMap,e={};for(let i in n){let r=Math.round(n[i].getBoundingClientRect().height);e[i]=Math.max(e[i]||0,r)}return e}computeMaxContentHeight(){let n=this.props.cells[0].key,i=this.fgElRefs.currentMap[n];return this.cellElRefs.currentMap[n].getBoundingClientRect().bottom-i.getBoundingClientRect().top}getCellEls(){let n=this.cellElRefs.currentMap;return this.props.cells.map(e=>n[e.key])}}vN.addStateEquality({segHeights:Bf});class lce extends Tp{constructor(){super(...arguments),this.splitBusinessHourSegs=er(S5),this.splitBgEventSegs=er(S5),this.splitFgEventSegs=er(S5),this.splitDateSelectionSegs=er(S5),this.splitEventDrag=er(uN),this.splitEventResize=er(uN),this.rowRefs=new sg}render(){let{props:n,context:e}=this,i=n.cells.length,r=this.splitBusinessHourSegs(n.businessHourSegs,i),s=this.splitBgEventSegs(n.bgEventSegs,i),c=this.splitFgEventSegs(n.fgEventSegs,i),f=this.splitDateSelectionSegs(n.dateSelectionSegs,i),y=this.splitEventDrag(n.eventDrag,i),k=this.splitEventResize(n.eventResize,i),E=i>=7&&n.clientWidth?n.clientWidth/e.options.aspectRatio/6:null;return et(W2,{unit:"day"},(F,$)=>et(ms,null,n.cells.map((W,re)=>et(vN,{ref:this.rowRefs.createRef(re),key:W.length?W[0].date.toISOString():re,showDayNumbers:i>1,showWeekNumbers:n.showWeekNumbers,todayRange:$,dateProfile:n.dateProfile,cells:W,renderIntro:n.renderRowIntro,businessHourSegs:r[re],eventSelection:n.eventSelection,bgEventSegs:s[re].filter(cce),fgEventSegs:c[re],dateSelectionSegs:f[re],eventDrag:y[re],eventResize:k[re],dayMaxEvents:n.dayMaxEvents,dayMaxEventRows:n.dayMaxEventRows,clientWidth:n.clientWidth,clientHeight:n.clientHeight,cellMinHeight:E,forPrint:n.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){const n=this.rowRefs.currentMap[0].getCellEls()[0],e=n?n.closest(".fc-daygrid-body"):null;e&&(this.rootEl=e,this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new Y2(this.rootEl,this.rowRefs.collect().map(n=>n.getCellEls()[0]),!1,!0),this.colPositions=new Y2(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(n,e){let{colPositions:i,rowPositions:r}=this,s=i.leftToIndex(n),c=r.topToIndex(e);if(null!=c&&null!=s){let f=this.props.cells[c][s];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(c,s),allDay:!0},f.extraDateSpan),dayEl:this.getCellEl(c,s),rect:{left:i.lefts[s],right:i.rights[s],top:r.tops[c],bottom:r.bottoms[c]},layer:0}}return null}getCellEl(n,e){return this.rowRefs.currentMap[n].getCellEls()[e]}getCellRange(n,e){let i=this.props.cells[n][e].date;return{start:i,end:Oc(i,1)}}}function cce(t){return t.eventRange.def.allDay}class dce extends Tp{constructor(){super(...arguments),this.elRef={current:null},this.needsScrollReset=!1}render(){let{props:n}=this,{dayMaxEventRows:e,dayMaxEvents:i,expandRows:r}=n,s=!0===i||!0===e;return s&&!r&&(s=!1,e=null,i=null),et("div",{ref:this.elRef,className:["fc-daygrid-body",s?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",r?"":"fc-daygrid-body-natural"].join(" "),style:{width:n.clientWidth,minWidth:n.tableMinWidth}},et("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:n.clientWidth,minWidth:n.tableMinWidth,height:r?n.clientHeight:""}},n.colGroupNode,et("tbody",{role:"presentation"},et(lce,{dateProfile:n.dateProfile,cells:n.cells,renderRowIntro:n.renderRowIntro,showWeekNumbers:n.showWeekNumbers,clientWidth:n.clientWidth,clientHeight:n.clientHeight,businessHourSegs:n.businessHourSegs,bgEventSegs:n.bgEventSegs,fgEventSegs:n.fgEventSegs,dateSelectionSegs:n.dateSelectionSegs,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,dayMaxEvents:i,dayMaxEventRows:e,forPrint:n.forPrint,isHitComboAllowed:n.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(n){n.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){const n=function hce(t,n){let e;return n.currentRangeUnit.match(/year|month/)&&(e=t.querySelector(`[data-date="${function soe(t){return t.toISOString().match(/^\d{4}-\d{2}/)[0]}(n.currentDate)}-01"]`)),e||(e=t.querySelector(`[data-date="${Ek(n.currentDate)}"]`)),e}(this.elRef.current,this.props.dateProfile);if(n){const e=n.closest(".fc-daygrid-body"),i=e.closest(".fc-scroller"),r=n.getBoundingClientRect().top-e.getBoundingClientRect().top;i.scrollTop=r?r+1:0}this.needsScrollReset=!1}}}class uce extends Rz{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(n,e){return e.sliceRange(n)}}class bN extends Tp{constructor(){super(...arguments),this.slicer=new uce,this.tableRef={current:null}}render(){let{props:n,context:e}=this;return et(dce,Object.assign({ref:this.tableRef},this.slicer.sliceProps(n,n.dateProfile,n.nextDayThreshold,e,n.dayTableModel),{dateProfile:n.dateProfile,cells:n.dayTableModel.cells,colGroupNode:n.colGroupNode,tableMinWidth:n.tableMinWidth,renderRowIntro:n.renderRowIntro,dayMaxEvents:n.dayMaxEvents,dayMaxEventRows:n.dayMaxEventRows,showWeekNumbers:n.showWeekNumbers,expandRows:n.expandRows,headerAlignElRef:n.headerAlignElRef,clientWidth:n.clientWidth,clientHeight:n.clientHeight,forPrint:n.forPrint}))}}function fce(t,n){let e=new Iz(t.renderRange,n);return new Oz(e,/year|month|week/.test(t.currentRangeUnit))}J4(':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}');var yce=Vf({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:class pce extends Zle{constructor(){super(...arguments),this.buildDayTableModel=er(fce),this.headerRef={current:null},this.tableRef={current:null}}render(){let{options:n,dateProfileGenerator:e}=this.context,{props:i}=this,r=this.buildDayTableModel(i.dateProfile,e),s=n.dayHeaders&&et(Pz,{ref:this.headerRef,dateProfile:i.dateProfile,dates:r.headerDates,datesRepDistinctDays:1===r.rowCnt}),c=f=>et(bN,{ref:this.tableRef,dateProfile:i.dateProfile,dayTableModel:r,businessHours:i.businessHours,dateSelection:i.dateSelection,eventStore:i.eventStore,eventUiBases:i.eventUiBases,eventSelection:i.eventSelection,eventDrag:i.eventDrag,eventResize:i.eventResize,nextDayThreshold:n.nextDayThreshold,colGroupNode:f.tableColGroupNode,tableMinWidth:f.tableMinWidth,dayMaxEvents:n.dayMaxEvents,dayMaxEventRows:n.dayMaxEventRows,showWeekNumbers:n.weekNumbers,expandRows:!i.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:f.clientWidth,clientHeight:f.clientHeight,forPrint:i.forPrint});return n.dayMinWidth?this.renderHScrollLayout(s,c,r.colCnt,n.dayMinWidth):this.renderSimpleLayout(s,c)}},dateProfileGeneratorClass:class mce extends nz{buildRenderRange(n,e,i){let r=super.buildRenderRange(n,e,i),{props:s}=this;return function gce(t){let s,{dateEnv:n,currentRange:e}=t,{start:i,end:r}=e;if(t.snapToWeek&&(i=n.startOfWeek(i),s=n.startOfWeek(r),s.valueOf()!==r.valueOf()&&(r=N9(s,1))),t.fixedWeekCount){let c=n.startOfWeek(n.startOfMonth(Oc(e.end,-1))),f=Math.ceil(function Yre(t,n){return B1(t,n)/7}(c,r));r=N9(r,6-f)}return{start:i,end:r}}({currentRange:r,snapToWeek:/^(year|month)$/.test(e),fixedWeekCount:s.fixedWeekCount,dateEnv:s.dateEnv})}}},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});class vce extends Use{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(n){return n.allDay?["allDay"]:["timed"]}getKeysForEventDef(n){return n.allDay?function vse(t){return"background"===t.ui.display||"inverse-background"===t.ui.display}(n)?["timed","allDay"]:["allDay"]:["timed"]}}const bce=pa({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function xN(t){let n=["fc-timegrid-slot","fc-timegrid-slot-label",t.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return et(ng.Consumer,null,e=>{if(!t.isLabeled)return et("td",{className:n.join(" "),"data-time":t.isoTimeStr});let{dateEnv:i,options:r,viewApi:s}=e,c=null==r.slotLabelFormat?bce:Array.isArray(r.slotLabelFormat)?pa(r.slotLabelFormat[0]):pa(r.slotLabelFormat),f={level:0,time:t.time,date:i.toDate(t.date),view:s,text:i.format(t.date,c)};return et(eh,{elTag:"td",elClasses:n,elAttrs:{"data-time":t.isoTimeStr},renderProps:f,generatorName:"slotLabelContent",customGenerator:r.slotLabelContent,defaultGenerator:xce,classNameGenerator:r.slotLabelClassNames,didMount:r.slotLabelDidMount,willUnmount:r.slotLabelWillUnmount},y=>et("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},et(y,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function xce(t){return t.text}class wce extends os{render(){return this.props.slatMetas.map(n=>et("tr",{key:n.key},et(xN,Object.assign({},n))))}}const kce=pa({week:"short"});class Cce extends Tp{constructor(){super(...arguments),this.allDaySplitter=new vce,this.headerElRef={current:null},this.rootElRef={current:null},this.scrollerElRef={current:null},this.state={slatCoords:null},this.handleScrollTopRequest=n=>{let e=this.scrollerElRef.current;e&&(e.scrollTop=n)},this.renderHeadAxis=(n,e="")=>{let{options:i}=this.context,{dateProfile:r}=this.props,s=r.renderRange,f=1===B1(s.start,s.end)?Z2(this.context,s.start,"week"):{};return i.weekNumbers&&"day"===n?et(qz,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:s.start,defaultFormat:kce},y=>et("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:e}},et(y,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:f}))):et("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},et("div",{className:"fc-timegrid-axis-frame",style:{height:e}}))},this.renderTableRowAxis=n=>{let{options:e,viewApi:i}=this.context;return et(eh,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:{text:e.allDayText,view:i},generatorName:"allDayContent",customGenerator:e.allDayContent,defaultGenerator:Sce,classNameGenerator:e.allDayClassNames,didMount:e.allDayDidMount,willUnmount:e.allDayWillUnmount},s=>et("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",null==n?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:n}},et(s,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=n=>{this.setState({slatCoords:n})}}renderSimpleLayout(n,e,i){let{context:r,props:s}=this,c=[],f=M5(r.options);return n&&c.push({type:"header",key:"header",isSticky:f,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:n}}),e&&(c.push({type:"body",key:"all-day",chunk:{content:e}}),c.push({type:"body",key:"all-day-divider",outerContent:et("tr",{role:"presentation",className:"fc-scrollgrid-section"},et("td",{className:"fc-timegrid-divider "+r.theme.getClass("tableCellShaded")}))})),c.push({type:"body",key:"body",liquid:!0,expandRows:!!r.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:i}}),et(Ak,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:r.viewSpec},et(kP,{liquid:!s.isHeightAuto&&!s.forPrint,collapsibleWidth:s.forPrint,cols:[{width:"shrink"}],sections:c}))}renderHScrollLayout(n,e,i,r,s,c,f){let y=this.context.pluginHooks.scrollGridImpl;if(!y)throw new Error("No ScrollGrid implementation");let{context:k,props:E}=this,F=!E.forPrint&&M5(k.options),$=!E.forPrint&&Vz(k.options),W=[];n&&W.push({type:"header",key:"header",isSticky:F,syncRowHeights:!0,chunks:[{key:"axis",rowContent:he=>et("tr",{role:"presentation"},this.renderHeadAxis("day",he.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:n}]}),e&&(W.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:he=>et("tr",{role:"presentation"},this.renderTableRowAxis(he.rowSyncHeights[0]))},{key:"cols",content:e}]}),W.push({key:"all-day-divider",type:"body",outerContent:et("tr",{role:"presentation",className:"fc-scrollgrid-section"},et("td",{colSpan:2,className:"fc-timegrid-divider "+k.theme.getClass("tableCellShaded")}))}));let re=k.options.nowIndicator;return W.push({type:"body",key:"body",liquid:!0,expandRows:!!k.options.expandRows,chunks:[{key:"axis",content:he=>et("div",{className:"fc-timegrid-axis-chunk"},et("table",{"aria-hidden":!0,style:{height:he.expandRows?he.clientHeight:""}},he.tableColGroupNode,et("tbody",null,et(wce,{slatMetas:c}))),et("div",{className:"fc-timegrid-now-indicator-container"},et(W2,{unit:re?"minute":"day"},me=>{let Pe=re&&f&&f.safeComputeTop(me);return"number"==typeof Pe?et(MP,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:Pe},isAxis:!0,date:me}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:i}]}),$&&W.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:wP},{key:"cols",content:wP}]}),et(Ak,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:k.viewSpec},et(y,{liquid:!E.isHeightAuto&&!E.forPrint,forPrint:E.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:r,minWidth:s}]}],sections:W}))}getAllDayMaxEventProps(){let{dayMaxEvents:n,dayMaxEventRows:e}=this.context.options;return(!0===n||!0===e)&&(n=void 0,e=5),{dayMaxEvents:n,dayMaxEventRows:e}}}function Sce(t){return t.text}class Ece{constructor(n,e,i){this.positions=n,this.dateProfile=e,this.slotDuration=i}safeComputeTop(n){let{dateProfile:e}=this;if(rg(e.currentRange,n)){let i=$s(n),r=n.valueOf()-i.valueOf();if(r>=Xh(e.slotMinTime)&&r<Xh(e.slotMaxTime))return this.computeTimeTop(ko(r))}return null}computeDateTop(n,e){return e||(e=$s(n)),this.computeTimeTop(ko(n.valueOf()-e.valueOf()))}computeTimeTop(n){let c,f,{positions:e,dateProfile:i}=this,r=e.els.length,s=(n.milliseconds-Xh(i.slotMinTime))/Xh(this.slotDuration);return s=Math.max(0,s),s=Math.min(r,s),c=Math.floor(s),c=Math.min(c,r-1),f=s-c,e.tops[c]+e.getHeight(c)*f}}class Dce extends os{render(){let{props:n,context:e}=this,{options:i}=e,{slatElRefs:r}=n;return et("tbody",null,n.slatMetas.map((s,c)=>{let f={time:s.time,date:e.dateEnv.toDate(s.date),view:e.viewApi};return et("tr",{key:s.key,ref:r.createRef(s.key)},n.axis&&et(xN,Object.assign({},s)),et(eh,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!s.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":s.isoTimeStr},renderProps:f,generatorName:"slotLaneContent",customGenerator:i.slotLaneContent,classNameGenerator:i.slotLaneClassNames,didMount:i.slotLaneDidMount,willUnmount:i.slotLaneWillUnmount}))}))}}class Tce extends os{constructor(){super(...arguments),this.rootElRef={current:null},this.slatElRefs=new sg}render(){let{props:n,context:e}=this;return et("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},et("table",{"aria-hidden":!0,className:e.theme.getClass("table"),style:{minWidth:n.tableMinWidth,width:n.clientWidth,height:n.minHeight}},n.tableColGroupNode,et(Dce,{slatElRefs:this.slatElRefs,axis:n.axis,slatMetas:n.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:n,props:e}=this;e.onCoords&&null!==e.clientWidth&&this.rootElRef.current.offsetHeight&&e.onCoords(new Ece(new Y2(this.rootElRef.current,function Ace(t,n){return n.map(e=>t[e.key])}(this.slatElRefs.currentMap,e.slatMetas),!1,!0),this.props.dateProfile,n.options.slotDuration))}}function Ok(t,n){let i,e=[];for(i=0;i<n;i+=1)e.push([]);if(t)for(i=0;i<t.length;i+=1)e[t[i].col].push(t[i]);return e}function wN(t,n){let e=[];if(t){for(let i=0;i<n;i+=1)e[i]={affectedInstances:t.affectedInstances,isEvent:t.isEvent,segs:[]};for(let i of t.segs)e[i.col].segs.push(i)}else for(let i=0;i<n;i+=1)e[i]=null;return e}class Pce extends os{render(){let{props:n}=this;return et($z,{elClasses:["fc-timegrid-more-link"],elStyle:{top:n.top,bottom:n.bottom},allDayDate:null,moreCnt:n.hiddenSegs.length,allSegs:n.hiddenSegs,hiddenSegs:n.hiddenSegs,extraDateSpan:n.extraDateSpan,dateProfile:n.dateProfile,todayRange:n.todayRange,popoverContent:()=>SN(n.hiddenSegs,n),defaultGenerator:Ice,forceTimed:!0},e=>et(e,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}}function Ice(t){return t.shortText}function kN(t,n){if(!t)return[[],0];let{level:e,lateralStart:i,lateralEnd:r}=t,s=i,c=[];for(;s<r;)c.push(n(e,s)),s+=1;return c.sort(Lce),[c.map(Fce),c[0][1]]}function Lce(t,n){return n[1]-t[1]}function Fce(t){return t[0]}function Bce(t){let n=[];const e=IP((r,s,c)=>oy(r),(r,s,c)=>{let f=Object.assign(Object.assign({},r),{levelCoord:s,stackDepth:c,stackForward:0});return n.push(f),f.stackForward=i(r.nextLevelNodes,s+r.thickness,c+1)+1});function i(r,s,c){let f=0;for(let y of r)f=Math.max(e(y,s,c),f);return f}return i(t,0,0),n}function IP(t,n){const e={};return(...i)=>{let r=t(...i);return r in e?e[r]:e[r]=n(...i)}}function MN(t,n,e=null,i=0){let r=[];if(e)for(let s=0;s<t.length;s+=1){let c=t[s],f=e.computeDateTop(c.start,n),y=Math.max(f+(i||0),e.computeDateTop(c.end,n));r.push({start:Math.round(f),end:Math.round(y)})}return r}const jce=pa({hour:"numeric",minute:"2-digit",meridiem:!1});class CN extends os{render(){return et(jz,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:jce}))}}class Hce extends os{constructor(){super(...arguments),this.sortEventSegs=er(oP)}render(){let{props:n,context:e}=this,{options:i}=e,r=i.selectMirror,s=n.eventDrag&&n.eventDrag.segs||n.eventResize&&n.eventResize.segs||r&&n.dateSelectionSegs||[],c=n.eventDrag&&n.eventDrag.affectedInstances||n.eventResize&&n.eventResize.affectedInstances||{},f=this.sortEventSegs(n.fgEventSegs,i.eventOrder);return et(CP,{elTag:"td",elRef:n.elRef,elClasses:["fc-timegrid-col",...n.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},n.extraDataAttrs),date:n.date,dateProfile:n.dateProfile,todayRange:n.todayRange,extraRenderProps:n.extraRenderProps},y=>et("div",{className:"fc-timegrid-col-frame"},et("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(n.businessHourSegs,"non-business"),this.renderFillSegs(n.bgEventSegs,"bg-event"),this.renderFillSegs(n.dateSelectionSegs,"highlight")),et("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(f,c,!1,!1,!1)),et("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(s,{},!!n.eventDrag,!!n.eventResize,!!r,"mirror")),et("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(n.nowIndicatorSegs)),SP(i)&&et(y,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(n,e,i,r,s,c){let{props:f}=this;return f.forPrint?SN(n,f):this.renderPositionedFgSegs(n,e,i,r,s,c)}renderPositionedFgSegs(n,e,i,r,s,c){let{eventMaxStack:f,eventShortHeight:y,eventOrderStrict:k,eventMinHeight:E}=this.context.options,{date:F,slatCoords:$,eventSelection:W,todayRange:re,nowDate:he}=this.props,me=i||r||s,Pe=MN(n,F,$,E),{segPlacements:Re,hiddenGroups:rt}=function Vce(t,n,e,i){let r=[],s=[];for(let k=0;k<t.length;k+=1){let E=n[k];E?r.push({index:k,thickness:1,span:E}):s.push(t[k])}let{segRects:c,hiddenGroups:f}=function Oce(t,n,e){let i=new Ez;null!=n&&(i.strictOrder=n),null!=e&&(i.maxStackCnt=e);let s=function nae(t){let n=[];for(let e of t){let i=[],r={span:e.span,entries:[e]};for(let s of n)_P(s.span,r.span)?r={entries:s.entries.concat(r.entries),span:iae(s.span,r.span)}:i.push(s);i.push(r),n=i}return n}(i.addSegs(t)),c=function Rce(t){const{entriesByLevel:n}=t,e=IP((i,r)=>i+":"+r,(i,r)=>{let s=function zce(t,n,e){let{levelCoords:i,entriesByLevel:r}=t,s=r[n][e],c=i[n]+s.thickness,f=i.length,y=n;for(;y<f&&i[y]<c;y+=1);for(;y<f;y+=1){let E,k=r[y],F=vP(k,s.span.start,gP),$=F[0]+F[1],W=$;for(;(E=k[W])&&E.span.start<s.span.end;)W+=1;if($<W)return{level:y,lateralStart:$,lateralEnd:W}}return null}(t,i,r),c=kN(s,e),f=n[i][r];return[Object.assign(Object.assign({},f),{nextLevelNodes:c[0]}),f.thickness+c[1]]});return kN(n.length?{level:0,lateralStart:0,lateralEnd:n[0].length}:null,e)[0]}(i);return c=function Nce(t,n){const e=IP((i,r,s)=>oy(i),(i,r,s)=>{let E,{nextLevelNodes:c,thickness:f}=i,y=f+s,k=f/y,F=[];if(c.length)for(let W of c)if(void 0===E){let re=e(W,r,y);E=re[0],F.push(re[1])}else{let re=e(W,E,0);F.push(re[1])}else E=n;let $=(E-r)*k;return[E-$,Object.assign(Object.assign({},i),{thickness:$,nextLevelNodes:F})]});return t.map(i=>e(i,0,0)[1])}(c,1),{segRects:Bce(c),hiddenGroups:s}}(r,e,i),y=[];for(let k of c)y.push({seg:t[k.index],rect:k});for(let k of s)y.push({seg:k,rect:null});return{segPlacements:y,hiddenGroups:f}}(n,Pe,k,f);return et(ms,null,this.renderHiddenGroups(rt,n),Re.map(ft=>{let{seg:Ct,rect:Vt}=ft,sn=Ct.eventRange.instance.instanceId,Qt=me||!(e[sn]||!Vt),Vn=OP(Vt&&Vt.span),Hi=!me&&Vt?this.computeSegHStyle(Vt):{left:0,right:0},Or=!!Vt&&Vt.span.end-Vt.span.start<y;return et("div",{className:"fc-timegrid-event-harness"+(Vt&&Vt.stackForward>0?" fc-timegrid-event-harness-inset":""),key:c||sn,style:Object.assign(Object.assign({visibility:Qt?"":"hidden"},Vn),Hi)},et(CN,Object.assign({seg:Ct,isDragging:i,isResizing:r,isDateSelecting:s,isSelected:sn===W,isShort:Or},og(Ct,re,he))))}))}renderHiddenGroups(n,e){let{extraDateSpan:i,dateProfile:r,todayRange:s,nowDate:c,eventSelection:f,eventDrag:y,eventResize:k}=this.props;return et(ms,null,n.map(E=>{let F=OP(E.span),$=function Uce(t,n){return t.map(e=>n[e.index])}(E.entries,e);return et(Pce,{key:H9(Wz($)),hiddenSegs:$,top:F.top,bottom:F.bottom,extraDateSpan:i,dateProfile:r,todayRange:s,nowDate:c,eventSelection:f,eventDrag:y,eventResize:k})}))}renderFillSegs(n,e){let{props:i,context:r}=this,c=MN(n,i.date,i.slatCoords,r.options.eventMinHeight).map((f,y)=>{let k=n[y];return et("div",{key:vz(k.eventRange),className:"fc-timegrid-bg-harness",style:OP(f)},"bg-event"===e?et(Hz,Object.assign({seg:k},og(k,i.todayRange,i.nowDate))):Uz(e))});return et(ms,null,c)}renderNowIndicator(n){let{slatCoords:e,date:i}=this.props;return e?n.map((r,s)=>et(MP,{key:s,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:e.computeDateTop(r.start,i)},isAxis:!1,date:i})):null}computeSegHStyle(n){let f,y,{isRtl:e,options:i}=this.context,r=i.slotEventOverlap,s=n.levelCoord,c=n.levelCoord+n.thickness;r&&(c=Math.min(1,s+2*(c-s))),e?(f=1-c,y=s):(f=s,y=1-c);let k={zIndex:n.stackDepth+1,left:100*f+"%",right:100*y+"%"};return r&&!n.stackForward&&(k[e?"marginLeft":"marginRight"]=20),k}}function SN(t,{todayRange:n,nowDate:e,eventSelection:i,eventDrag:r,eventResize:s}){let c=(r?r.affectedInstances:null)||(s?s.affectedInstances:null)||{};return et(ms,null,t.map(f=>{let y=f.eventRange.instance.instanceId;return et("div",{key:y,style:{visibility:c[y]?"hidden":""}},et(CN,Object.assign({seg:f,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:y===i,isShort:!1},og(f,n,e))))}))}function OP(t){return t?{top:t.start,bottom:-t.end}:{top:"",bottom:""}}class qce extends os{constructor(){super(...arguments),this.splitFgEventSegs=er(Ok),this.splitBgEventSegs=er(Ok),this.splitBusinessHourSegs=er(Ok),this.splitNowIndicatorSegs=er(Ok),this.splitDateSelectionSegs=er(Ok),this.splitEventDrag=er(wN),this.splitEventResize=er(wN),this.rootElRef={current:null},this.cellElRefs=new sg}render(){let{props:n,context:e}=this,i=e.options.nowIndicator&&n.slatCoords&&n.slatCoords.safeComputeTop(n.nowDate),r=n.cells.length,s=this.splitFgEventSegs(n.fgEventSegs,r),c=this.splitBgEventSegs(n.bgEventSegs,r),f=this.splitBusinessHourSegs(n.businessHourSegs,r),y=this.splitNowIndicatorSegs(n.nowIndicatorSegs,r),k=this.splitDateSelectionSegs(n.dateSelectionSegs,r),E=this.splitEventDrag(n.eventDrag,r),F=this.splitEventResize(n.eventResize,r);return et("div",{className:"fc-timegrid-cols",ref:this.rootElRef},et("table",{role:"presentation",style:{minWidth:n.tableMinWidth,width:n.clientWidth}},n.tableColGroupNode,et("tbody",{role:"presentation"},et("tr",{role:"row"},n.axis&&et("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},et("div",{className:"fc-timegrid-col-frame"},et("div",{className:"fc-timegrid-now-indicator-container"},"number"==typeof i&&et(MP,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:i},isAxis:!0,date:n.nowDate})))),n.cells.map(($,W)=>et(Hce,{key:$.key,elRef:this.cellElRefs.createRef($.key),dateProfile:n.dateProfile,date:$.date,nowDate:n.nowDate,todayRange:n.todayRange,extraRenderProps:$.extraRenderProps,extraDataAttrs:$.extraDataAttrs,extraClassNames:$.extraClassNames,extraDateSpan:$.extraDateSpan,fgEventSegs:s[W],bgEventSegs:c[W],businessHourSegs:f[W],nowIndicatorSegs:y[W],dateSelectionSegs:k[W],eventDrag:E[W],eventResize:F[W],slatCoords:n.slatCoords,eventSelection:n.eventSelection,forPrint:n.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:n}=this;n.onColCoords&&null!==n.clientWidth&&n.onColCoords(new Y2(this.rootElRef.current,function $ce(t,n){return n.map(e=>t[e.key])}(this.cellElRefs.currentMap,n.cells),!0,!1))}}class Gce extends Tp{constructor(){super(...arguments),this.processSlotOptions=er(Wce),this.state={slatCoords:null},this.handleRootEl=n=>{n?this.context.registerInteractiveComponent(this,{el:n,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=n=>{let{onScrollTopRequest:e}=this.props,{slatCoords:i}=this.state;if(e&&i){if(n.time){let r=i.computeTimeTop(n.time);r=Math.ceil(r),r&&(r+=1),e(r)}return!0}return!1},this.handleColCoords=n=>{this.colCoords=n},this.handleSlatCoords=n=>{this.setState({slatCoords:n}),this.props.onSlatCoords&&this.props.onSlatCoords(n)}}render(){let{props:n,state:e}=this;return et("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:n.clientWidth,minWidth:n.tableMinWidth}},et(Tce,{axis:n.axis,dateProfile:n.dateProfile,slatMetas:n.slatMetas,clientWidth:n.clientWidth,minHeight:n.expandRows?n.clientHeight:"",tableMinWidth:n.tableMinWidth,tableColGroupNode:n.axis?n.tableColGroupNode:null,onCoords:this.handleSlatCoords}),et(qce,{cells:n.cells,axis:n.axis,dateProfile:n.dateProfile,businessHourSegs:n.businessHourSegs,bgEventSegs:n.bgEventSegs,fgEventSegs:n.fgEventSegs,dateSelectionSegs:n.dateSelectionSegs,eventSelection:n.eventSelection,eventDrag:n.eventDrag,eventResize:n.eventResize,todayRange:n.todayRange,nowDate:n.nowDate,nowIndicatorSegs:n.nowIndicatorSegs,clientWidth:n.clientWidth,tableMinWidth:n.tableMinWidth,tableColGroupNode:n.tableColGroupNode,slatCoords:e.slatCoords,onColCoords:this.handleColCoords,forPrint:n.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(n){this.scrollResponder.update(n.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(n,e){let{dateEnv:i,options:r}=this.context,{colCoords:s}=this,{dateProfile:c}=this.props,{slatCoords:f}=this.state,{snapDuration:y,snapsPerSlot:k}=this.processSlotOptions(this.props.slotDuration,r.snapDuration),E=s.leftToIndex(n),F=f.positions.topToIndex(e);if(null!=E&&null!=F){let $=this.props.cells[E],W=f.positions.tops[F],re=f.positions.getHeight(F),me=Math.floor((e-W)/re*k),Re=this.props.cells[E].date,rt=LA(c.slotMinTime,function Gre(t,n){return{years:t.years*n,months:t.months*n,days:t.days*n,milliseconds:t.milliseconds*n}}(y,F*k+me)),ft=i.add(Re,rt),Ct=i.add(ft,y);return{dateProfile:c,dateSpan:Object.assign({range:{start:ft,end:Ct},allDay:!1},$.extraDateSpan),dayEl:s.els[E],rect:{left:s.lefts[E],right:s.rights[E],top:W,bottom:W+re},layer:0}}return null}}function Wce(t,n){let e=n||t,i=FA(t,e);return null===i&&(e=t,i=1),{snapDuration:e,snapsPerSlot:i}}class Zce extends Rz{sliceRange(n,e){let i=[];for(let r=0;r<e.length;r+=1){let s=H1(n,e[r]);s&&i.push({start:s.start,end:s.end,isStart:s.start.valueOf()===n.start.valueOf(),isEnd:s.end.valueOf()===n.end.valueOf(),col:r})}return i}}class Yce extends Tp{constructor(){super(...arguments),this.buildDayRanges=er(Xce),this.slicer=new Zce,this.timeColsRef={current:null}}render(){let{props:n,context:e}=this,{dateProfile:i,dayTableModel:r}=n,{nowIndicator:s,nextDayThreshold:c}=e.options,f=this.buildDayRanges(r,i,e.dateEnv);return et(W2,{unit:s?"minute":"day"},(y,k)=>et(Gce,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(n,i,null,e,f),{forPrint:n.forPrint,axis:n.axis,dateProfile:i,slatMetas:n.slatMetas,slotDuration:n.slotDuration,cells:r.cells[0],tableColGroupNode:n.tableColGroupNode,tableMinWidth:n.tableMinWidth,clientWidth:n.clientWidth,clientHeight:n.clientHeight,expandRows:n.expandRows,nowDate:y,nowIndicatorSegs:s&&this.slicer.sliceNowDate(y,i,c,e,f),todayRange:k,onScrollTopRequest:n.onScrollTopRequest,onSlatCoords:n.onSlatCoords})))}}function Xce(t,n,e){let i=[];for(let r of t.headerDates)i.push({start:e.add(r,n.slotMinTime),end:e.add(r,n.slotMaxTime)});return i}const EN=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function Kce(t,n,e,i,r){let s=new Date(0),c=t,f=ko(0),y=e||function Qce(t){let n,e,i;for(n=EN.length-1;n>=0;n-=1)if(e=ko(EN[n]),i=FA(e,t),null!==i&&i>1)return e;return t}(i),k=[];for(;Xh(c)<Xh(n);){let E=r.add(s,c),F=null!==FA(f,y);k.push({date:E,time:c,key:E.toISOString(),isoTimeStr:aoe(E),isLabeled:F}),c=LA(c,i),f=LA(f,i)}return k}function ede(t,n){let e=new Iz(t.renderRange,n);return new Oz(e,!1)}J4('.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}');var nde=Vf({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:{allDaySlot:Boolean},views:{timeGrid:{component:class Jce extends Cce{constructor(){super(...arguments),this.buildTimeColsModel=er(ede),this.buildSlatMetas=er(Kce)}render(){let{options:n,dateEnv:e,dateProfileGenerator:i}=this.context,{props:r}=this,{dateProfile:s}=r,c=this.buildTimeColsModel(s,i),f=this.allDaySplitter.splitProps(r),y=this.buildSlatMetas(s.slotMinTime,s.slotMaxTime,n.slotLabelInterval,n.slotDuration,e),{dayMinWidth:k}=n,E=!k,F=k,$=n.dayHeaders&&et(Pz,{dates:c.headerDates,dateProfile:s,datesRepDistinctDays:!0,renderIntro:E?this.renderHeadAxis:null}),W=!1!==n.allDaySlot&&(he=>et(bN,Object.assign({},f.allDay,{dateProfile:s,dayTableModel:c,nextDayThreshold:n.nextDayThreshold,tableMinWidth:he.tableMinWidth,colGroupNode:he.tableColGroupNode,renderRowIntro:E?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:he.clientWidth,clientHeight:he.clientHeight,forPrint:r.forPrint},this.getAllDayMaxEventProps()))),re=he=>et(Yce,Object.assign({},f.timed,{dayTableModel:c,dateProfile:s,axis:E,slotDuration:n.slotDuration,slatMetas:y,forPrint:r.forPrint,tableColGroupNode:he.tableColGroupNode,tableMinWidth:he.tableMinWidth,clientWidth:he.clientWidth,clientHeight:he.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:he.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return F?this.renderHScrollLayout($,W,re,c.colCnt,k,y,this.state.slatCoords):this.renderSimpleLayout($,W,re)}},usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});bP.touchMouseIgnoreWait=500;let RP=0,D5=0,LP=!1;class FP{constructor(n){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=e=>{if(!this.shouldIgnoreMouse()&&function ide(t){return 0===t.button&&!t.ctrlKey}(e)&&this.tryStart(e)){let i=this.createEventFromMouse(e,!0);this.emitter.trigger("pointerdown",i),this.initScrollWatch(i),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=e=>{let i=this.createEventFromMouse(e);this.recordCoords(i),this.emitter.trigger("pointermove",i)},this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(e)),this.cleanup()},this.handleTouchStart=e=>{if(this.tryStart(e)){this.isTouchDragging=!0;let i=this.createEventFromTouch(e,!0);this.emitter.trigger("pointerdown",i),this.initScrollWatch(i);let r=e.target;this.shouldIgnoreMove||r.addEventListener("touchmove",this.handleTouchMove),r.addEventListener("touchend",this.handleTouchEnd),r.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=e=>{let i=this.createEventFromTouch(e);this.recordCoords(i),this.emitter.trigger("pointermove",i)},this.handleTouchEnd=e=>{if(this.isDragging){let i=e.target;i.removeEventListener("touchmove",this.handleTouchMove),i.removeEventListener("touchend",this.handleTouchEnd),i.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(e)),this.cleanup(),this.isTouchDragging=!1,function rde(){RP+=1,setTimeout(()=>{RP-=1},bP.touchMouseIgnoreWait)}()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=e=>{if(!this.shouldIgnoreMove){let i=window.scrollX-this.prevScrollX+this.prevPageX,r=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:e,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:i,pageY:r,deltaX:i-this.origPageX,deltaY:r-this.origPageY})}},this.containerEl=n,this.emitter=new y5,n.addEventListener("mousedown",this.handleMouseDown),n.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),function ode(){D5+=1,1===D5&&window.addEventListener("touchmove",DN,{passive:!1})}()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),function sde(){D5-=1,D5||window.removeEventListener("touchmove",DN,{passive:!1})}()}tryStart(n){let e=this.querySubjectEl(n);return!(!e||this.handleSelector&&!Sd(n.target,this.handleSelector)||(this.subjectEl=e,this.isDragging=!0,this.wasTouchScroll=!1,0))}cleanup(){LP=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(n){return this.selector?Sd(n.target,this.selector):this.containerEl}shouldIgnoreMouse(){return RP||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(LP=!0)}initScrollWatch(n){this.shouldWatchScroll&&(this.recordCoords(n),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(n){this.shouldWatchScroll&&(this.prevPageX=n.pageX,this.prevPageY=n.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(n,e){let i=0,r=0;return e?(this.origPageX=n.pageX,this.origPageY=n.pageY):(i=n.pageX-this.origPageX,r=n.pageY-this.origPageY),{origEvent:n,isTouch:!1,subjectEl:this.subjectEl,pageX:n.pageX,pageY:n.pageY,deltaX:i,deltaY:r}}createEventFromTouch(n,e){let r,s,i=n.touches,c=0,f=0;return i&&i.length?(r=i[0].pageX,s=i[0].pageY):(r=n.pageX,s=n.pageY),e?(this.origPageX=r,this.origPageY=s):(c=r-this.origPageX,f=s-this.origPageY),{origEvent:n,isTouch:!0,subjectEl:this.subjectEl,pageX:r,pageY:s,deltaX:c,deltaY:f}}}function DN(t){LP&&t.preventDefault()}class ade{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(n,e,i){this.sourceEl=n,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=e-window.scrollX,this.origScreenY=i-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(n,e){this.deltaX=n-window.scrollX-this.origScreenX,this.deltaY=e-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(n){n?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=n,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=n)}stop(n,e){let i=()=>{this.cleanup(),e()};n&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(i,this.revertDuration):setTimeout(i,0)}doRevertAnimation(n,e){let i=this.mirrorEl,r=this.sourceEl.getBoundingClientRect();i.style.transition="top "+e+"ms,left "+e+"ms",Ck(i,{left:r.left,top:r.top}),function Pre(t,n){let e=i=>{n(i),P9.forEach(r=>{t.removeEventListener(r,e)})};P9.forEach(i=>{t.addEventListener(i,e)})}(i,()=>{i.style.transition="",n()})}cleanup(){this.mirrorEl&&(IA(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&Ck(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let n=this.sourceElRect,e=this.mirrorEl;return e||(e=this.mirrorEl=this.sourceEl.cloneNode(!0),e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.pointerEvents="none",e.classList.add("fc-event-dragging"),Ck(e,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:n.right-n.left,height:n.bottom-n.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(e)),e}}class TN extends mP{constructor(n,e){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=n,this.doesListening=e,this.scrollTop=this.origScrollTop=n.getScrollTop(),this.scrollLeft=this.origScrollLeft=n.getScrollLeft(),this.scrollWidth=n.getScrollWidth(),this.scrollHeight=n.getScrollHeight(),this.clientWidth=n.getClientWidth(),this.clientHeight=n.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(n){this.scrollController.setScrollTop(n),this.doesListening||(this.scrollTop=Math.max(Math.min(n,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(n){this.scrollController.setScrollLeft(n),this.doesListening||(this.scrollLeft=Math.max(Math.min(n,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class AN extends TN{constructor(n,e){super(new eae(n),e)}getEventTarget(){return this.scrollController.el}computeClientRect(){return Qse(this.scrollController.el)}}class lde extends TN{constructor(n){super(new tae,n)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const PN="function"==typeof performance?performance.now:Date.now;class cde{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let n=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(n){let e=PN();this.handleSide(n,(e-this.msSinceRequest)/1e3),this.requestAnimation(e)}else this.isAnimating=!1}}}start(n,e,i){this.isEnabled&&(this.scrollCaches=this.buildCaches(i),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(n,e))}handleMove(n,e){if(this.isEnabled){let i=n-window.scrollX,r=e-window.scrollY,s=null===this.pointerScreenY?0:r-this.pointerScreenY,c=null===this.pointerScreenX?0:i-this.pointerScreenX;s<0?this.everMovedUp=!0:s>0&&(this.everMovedDown=!0),c<0?this.everMovedLeft=!0:c>0&&(this.everMovedRight=!0),this.pointerScreenX=i,this.pointerScreenY=r,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(PN()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let n of this.scrollCaches)n.destroy();this.scrollCaches=null}}requestAnimation(n){this.msSinceRequest=n,requestAnimationFrame(this.animate)}handleSide(n,e){let{scrollCache:i}=n,{edgeThreshold:r}=this,s=r-n.distance,c=s*s/(r*r)*this.maxVelocity*e,f=1;switch(n.name){case"left":f=-1;case"right":i.setScrollLeft(i.getScrollLeft()+c*f);break;case"top":f=-1;case"bottom":i.setScrollTop(i.getScrollTop()+c*f)}}computeBestEdge(n,e){let{edgeThreshold:i}=this,r=null,s=this.scrollCaches||[];for(let c of s){let f=c.clientRect,y=n-f.left,k=f.right-n,E=e-f.top,F=f.bottom-e;y>=0&&k>=0&&E>=0&&F>=0&&(E<=i&&this.everMovedUp&&c.canScrollUp()&&(!r||r.distance>E)&&(r={scrollCache:c,name:"top",distance:E}),F<=i&&this.everMovedDown&&c.canScrollDown()&&(!r||r.distance>F)&&(r={scrollCache:c,name:"bottom",distance:F}),y<=i&&this.everMovedLeft&&c.canScrollLeft()&&(!r||r.distance>y)&&(r={scrollCache:c,name:"left",distance:y}),k<=i&&this.everMovedRight&&c.canScrollRight()&&(!r||r.distance>k)&&(r={scrollCache:c,name:"right",distance:k}))}return r}buildCaches(n){return this.queryScrollEls(n).map(e=>e===window?new lde(!1):new AN(e,!1))}queryScrollEls(n){let e=[];for(let i of this.scrollQuery)"object"==typeof i?e.push(i):e.push(...Array.prototype.slice.call(n.getRootNode().querySelectorAll(i)));return e}}class K2 extends Dz{constructor(n,e){super(n),this.containerEl=n,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=r=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,function Ire(t){t.style.userSelect="none",t.style.webkitUserSelect="none",t.addEventListener("selectstart",e5)}(document.body),function Rre(t){t.addEventListener("contextmenu",e5)}(document.body),r.isTouch||r.origEvent.preventDefault(),this.emitter.trigger("pointerdown",r),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(r.subjectEl,r.pageX,r.pageY),this.startDelay(r),this.minDistance||this.handleDistanceSurpassed(r)))},this.onPointerMove=r=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",r),!this.isDistanceSurpassed){let c,s=this.minDistance,{deltaX:f,deltaY:y}=r;c=f*f+y*y,c>=s*s&&this.handleDistanceSurpassed(r)}this.isDragging&&("scroll"!==r.origEvent.type&&(this.mirror.handleMove(r.pageX,r.pageY),this.autoScroller.handleMove(r.pageX,r.pageY)),this.emitter.trigger("dragmove",r))}},this.onPointerUp=r=>{this.isInteracting&&(this.isInteracting=!1,function Ore(t){t.style.userSelect="",t.style.webkitUserSelect="",t.removeEventListener("selectstart",e5)}(document.body),function Lre(t){t.removeEventListener("contextmenu",e5)}(document.body),this.emitter.trigger("pointerup",r),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(r)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let i=this.pointer=new FP(n);i.emitter.on("pointerdown",this.onPointerDown),i.emitter.on("pointermove",this.onPointerMove),i.emitter.on("pointerup",this.onPointerUp),e&&(i.selector=e),this.mirror=new ade,this.autoScroller=new cde}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(n){"number"==typeof this.delay?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(n)},this.delay):this.handleDelayEnd(n)}handleDelayEnd(n){this.isDelayEnded=!0,this.tryStartDrag(n)}handleDistanceSurpassed(n){this.isDistanceSurpassed=!0,this.tryStartDrag(n)}tryStartDrag(n){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(n.pageX,n.pageY,this.containerEl),this.emitter.trigger("dragstart",n),!1===this.touchScrollAllowed&&this.pointer.cancelTouchScroll())}tryStopDrag(n){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,n))}stopDrag(n){this.isDragging=!1,this.emitter.trigger("dragend",n)}setIgnoreMove(n){this.pointer.shouldIgnoreMove=n}setMirrorIsVisible(n){this.mirror.setIsVisible(n)}setMirrorNeedsRevert(n){this.mirrorNeedsRevert=n}setAutoScrollEnabled(n){this.autoScroller.isEnabled=n}}class dde{constructor(n){this.el=n,this.origRect=fP(n),this.scrollCaches=Sz(n).map(e=>new AN(e,!0))}destroy(){for(let n of this.scrollCaches)n.destroy()}computeLeft(){let n=this.origRect.left;for(let e of this.scrollCaches)n+=e.origScrollLeft-e.getScrollLeft();return n}computeTop(){let n=this.origRect.top;for(let e of this.scrollCaches)n+=e.origScrollTop-e.getScrollTop();return n}isWithinClipping(n,e){let i={left:n,top:e};for(let r of this.scrollCaches)if(!hde(r.getEventTarget())&&!Bse(i,r.clientRect))return!1;return!0}}function hde(t){let n=t.tagName;return"HTML"===n||"BODY"===n}class Rk{constructor(n,e){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=i=>{let{dragging:r}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(i),this.initialHit||!this.requireInitial?(r.setIgnoreMove(!1),this.emitter.trigger("pointerdown",i)):r.setIgnoreMove(!0)},this.handleDragStart=i=>{this.emitter.trigger("dragstart",i),this.handleMove(i,!0)},this.handleDragMove=i=>{this.emitter.trigger("dragmove",i),this.handleMove(i)},this.handlePointerUp=i=>{this.releaseHits(),this.emitter.trigger("pointerup",i)},this.handleDragEnd=i=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,i),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",i)},this.droppableStore=e,n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("dragmove",this.handleDragMove),n.emitter.on("pointerup",this.handlePointerUp),n.emitter.on("dragend",this.handleDragEnd),this.dragging=n,this.emitter=new y5}processFirstCoord(n){let s,e={left:n.pageX,top:n.pageY},i=e,r=n.subjectEl;r instanceof HTMLElement&&(s=fP(r),i=function Vse(t,n){return{left:Math.min(Math.max(t.left,n.left),n.right),top:Math.min(Math.max(t.top,n.top),n.bottom)}}(i,s));let c=this.initialHit=this.queryHitForOffset(i.left,i.top);if(c){if(this.useSubjectCenter&&s){let f=Mz(s,c.rect);f&&(i=function jse(t){return{left:(t.left+t.right)/2,top:(t.top+t.bottom)/2}}(f))}this.coordAdjust=function Hse(t,n){return{left:t.left-n.left,top:t.top-n.top}}(i,e)}else this.coordAdjust={left:0,top:0}}handleMove(n,e){let i=this.queryHitForOffset(n.pageX+this.coordAdjust.left,n.pageY+this.coordAdjust.top);(e||!T5(this.movingHit,i))&&(this.movingHit=i,this.emitter.trigger("hitupdate",i,!1,n))}prepareHits(){this.offsetTrackers=tg(this.droppableStore,n=>(n.component.prepareHits(),new dde(n.el)))}releaseHits(){let{offsetTrackers:n}=this;for(let e in n)n[e].destroy();this.offsetTrackers={}}queryHitForOffset(n,e){let{droppableStore:i,offsetTrackers:r}=this,s=null;for(let c in i){let f=i[c].component,y=r[c];if(y&&y.isWithinClipping(n,e)){let k=y.computeLeft(),E=y.computeTop(),F=n-k,$=e-E,{origRect:W}=y,re=W.right-W.left,he=W.bottom-W.top;if(F>=0&&F<re&&$>=0&&$<he){let me=f.queryHit(F,$,re,he);me&&p5(me.dateProfile.activeRange,me.dateSpan.range)&&(this.disablePointCheck||y.el.contains(y.el.getRootNode().elementFromPoint(F+k-window.scrollX,$+E-window.scrollY)))&&(!s||me.layer>s.layer)&&(me.componentId=c,me.context=f.context,me.rect.left+=k,me.rect.right+=k,me.rect.top+=E,me.rect.bottom+=E,s=me)}}}return s}}function T5(t,n){return!t&&!n||!!t==!!n&&function Dse(t,n){return function qoe(t,n){return(null===t.start?null:t.start.valueOf())===(null===n.start?null:n.start.valueOf())&&(null===t.end?null:t.end.valueOf())===(null===n.end?null:n.end.valueOf())}(t.range,n.range)&&t.allDay===n.allDay&&function Tse(t,n){for(let e in n)if("range"!==e&&"allDay"!==e&&t[e]!==n[e])return!1;for(let e in t)if(!(e in n))return!1;return!0}(t,n)}(t.dateSpan,n.dateSpan)}function zP(t,n){let e={};for(let i of n.pluginHooks.datePointTransforms)Object.assign(e,i(t,n));return Object.assign(e,function ude(t,n){return{date:n.toDate(t.range.start),dateStr:n.formatIso(t.range.start,{omitTime:t.allDay}),allDay:t.allDay}}(t,n.dateEnv)),e}let IN=(()=>{class t extends G2{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=f=>{let y=f.origEvent.target,{component:k,dragging:E}=this,{mirror:F}=E,{options:$}=k.context,W=k.context;this.subjectEl=f.subjectEl;let re=this.subjectSeg=$2(f.subjectEl),me=(this.eventRange=re.eventRange).instance.instanceId;this.relevantEvents=eP(W.getCurrentData().eventStore,me),E.minDistance=f.isTouch?0:$.eventDragMinDistance,E.delay=f.isTouch&&me!==k.props.eventSelection?function yde(t){let{options:n}=t.context,e=n.eventLongPressDelay;return null==e&&(e=n.longPressDelay),e}(k):null,F.parentNode=$.fixedMirrorParent?$.fixedMirrorParent:Sd(y,".fc"),F.revertDuration=$.dragRevertDuration;let Pe=k.isValidSegDownEl(y)&&!Sd(y,".fc-event-resizer");E.setIgnoreMove(!Pe),this.isDragging=Pe&&f.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=f=>{let y=this.component.context,k=this.eventRange,E=k.instance.instanceId;f.isTouch?E!==this.component.props.eventSelection&&y.dispatch({type:"SELECT_EVENT",eventInstanceId:E}):y.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(y.calendarApi.unselect(f),y.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new Ba(y,k.def,k.instance),jsEvent:f.origEvent,view:y.viewApi}))},this.handleHitUpdate=(f,y)=>{if(!this.isDragging)return;let k=this.relevantEvents,E=this.hitDragging.initialHit,F=this.component.context,$=null,W=null,re=null,he=!1,me={affectedEvents:k,mutatedEvents:{defs:{},instances:{}},isEvent:!0};if(f){$=f.context;let Pe=$.options;F===$||Pe.editable&&Pe.droppable?(W=function _de(t,n,e,i){let r=t.dateSpan,s=n.dateSpan,c=r.range.start,f=s.range.start,y={};r.allDay!==s.allDay&&(y.allDay=s.allDay,y.hasEnd=n.context.options.allDayMaintainDuration,c=s.allDay?$s(e):e);let k=U2(c,f,t.context.dateEnv,t.componentId===n.componentId?t.largeUnit:null);k.milliseconds&&(y.allDay=!1);let E={datesDelta:k,standardProps:y};for(let F of i)F(E,t,n);return E}(E,f,this.eventRange.instance.range.start,$.getCurrentData().pluginHooks.eventDragMutationMassagers),W&&(re=iP(k,$.getCurrentData().eventUiBases,W,$),me.mutatedEvents=re,Lz(me,f.dateProfile,$)||(he=!0,W=null,re=null,me.mutatedEvents={defs:{},instances:{}}))):$=null}this.displayDrag($,me),he?OA():RA(),y||(F===$&&T5(E,f)&&(W=null),this.dragging.setMirrorNeedsRevert(!W),this.dragging.setMirrorIsVisible(!f||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=$,this.validMutation=W,this.mutatedRelevantEvents=re)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=f=>{if(this.isDragging){let y=this.component.context,k=y.viewApi,{receivingContext:E,validMutation:F}=this,$=this.eventRange.def,W=this.eventRange.instance,re=new Ba(y,$,W),he=this.relevantEvents,me=this.mutatedRelevantEvents,{finalHit:Pe}=this.hitDragging;if(this.clearDrag(),y.emitter.trigger("eventDragStop",{el:this.subjectEl,event:re,jsEvent:f.origEvent,view:k}),F){if(E===y){let Re=new Ba(y,me.defs[$.defId],W?me.instances[W.instanceId]:null);y.dispatch({type:"MERGE_EVENTS",eventStore:me});let rt={oldEvent:re,event:Re,relatedEvents:ry(me,y,W),revert(){y.dispatch({type:"MERGE_EVENTS",eventStore:he})}},ft={};for(let Ct of y.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(ft,Ct(F,y));y.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},rt),ft),{el:f.subjectEl,delta:F.datesDelta,jsEvent:f.origEvent,view:k})),y.emitter.trigger("eventChange",rt)}else if(E){let Re={event:re,relatedEvents:ry(he,y,W),revert(){y.dispatch({type:"MERGE_EVENTS",eventStore:he})}};y.emitter.trigger("eventLeave",Object.assign(Object.assign({},Re),{draggedEl:f.subjectEl,view:k})),y.dispatch({type:"REMOVE_EVENTS",eventStore:he}),y.emitter.trigger("eventRemove",Re);let ft=me.instances[W.instanceId],Ct=new Ba(E,me.defs[$.defId],ft);E.dispatch({type:"MERGE_EVENTS",eventStore:me});let Vt={event:Ct,relatedEvents:ry(me,E,ft),revert(){E.dispatch({type:"REMOVE_EVENTS",eventStore:me})}};E.emitter.trigger("eventAdd",Vt),f.isTouch&&E.dispatch({type:"SELECT_EVENT",eventInstanceId:W.instanceId}),E.emitter.trigger("drop",Object.assign(Object.assign({},zP(Pe.dateSpan,E)),{draggedEl:f.subjectEl,jsEvent:f.origEvent,view:Pe.context.viewApi})),E.emitter.trigger("eventReceive",Object.assign(Object.assign({},Vt),{draggedEl:f.subjectEl,view:Pe.context.viewApi}))}}else y.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:i}=this,{options:r}=i.context,s=this.dragging=new K2(e.el);s.pointer.selector=t.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=r.dragScroll;let c=this.hitDragging=new Rk(this.dragging,cP);c.useSubjectCenter=e.useEventCenter,c.emitter.on("pointerdown",this.handlePointerDown),c.emitter.on("dragstart",this.handleDragStart),c.emitter.on("hitupdate",this.handleHitUpdate),c.emitter.on("pointerup",this.handlePointerUp),c.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,i){let s=this.receivingContext;s&&s!==e&&s.dispatch(s===this.component.context?{type:"SET_EVENT_DRAG",state:{affectedEvents:i.affectedEvents,mutatedEvents:{defs:{},instances:{}},isEvent:!0}}:{type:"UNSET_EVENT_DRAG"}),e&&e.dispatch({type:"SET_EVENT_DRAG",state:i})}clearDrag(){let e=this.component.context,{receivingContext:i}=this;i&&i.dispatch({type:"UNSET_EVENT_DRAG"}),e!==i&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}}return t.SELECTOR=".fc-event-draggable, .fc-event-resizable",t})();const wde={fixedMirrorParent:Gt},kde={dateClick:Gt,eventDragStart:Gt,eventDragStop:Gt,eventDrop:Gt,eventResizeStart:Gt,eventResizeStop:Gt,eventResize:Gt,drop:Gt,eventReceive:Gt,eventLeave:Gt};bP.dataAttrPrefix="";var Dde=Vf({name:"@fullcalendar/interaction",componentInteractions:[class pde extends G2{constructor(n){super(n),this.handlePointerDown=i=>{let{dragging:r}=this;r.setIgnoreMove(!this.component.isValidDateDownEl(i.origEvent.target))},this.handleDragEnd=i=>{let{component:r}=this,{pointer:s}=this.dragging;if(!s.wasTouchScroll){let{initialHit:c,finalHit:f}=this.hitDragging;if(c&&f&&T5(c,f)){let{context:y}=r,k=Object.assign(Object.assign({},zP(c.dateSpan,y)),{dayEl:c.dayEl,jsEvent:i.origEvent,view:y.viewApi||y.calendarApi.view});y.emitter.trigger("dateClick",k)}}},this.dragging=new K2(n.el),this.dragging.autoScroller.isEnabled=!1;let e=this.hitDragging=new Rk(this.dragging,lP(n));e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},class fde extends G2{constructor(n){super(n),this.dragSelection=null,this.handlePointerDown=c=>{let{component:f,dragging:y}=this,{options:k}=f.context,E=k.selectable&&f.isValidDateDownEl(c.origEvent.target);y.setIgnoreMove(!E),y.delay=c.isTouch?function mde(t){let{options:n}=t.context,e=n.selectLongPressDelay;return null==e&&(e=n.longPressDelay),e}(f):null},this.handleDragStart=c=>{this.component.context.calendarApi.unselect(c)},this.handleHitUpdate=(c,f)=>{let{context:y}=this.component,k=null,E=!1;if(c){let F=this.hitDragging.initialHit;c.componentId===F.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(F,c)||(k=function gde(t,n,e){let i=t.dateSpan,r=n.dateSpan,s=[i.range.start,i.range.end,r.range.start,r.range.end];s.sort(Vre);let c={};for(let f of e){let y=f(t,n);if(!1===y)return null;y&&Object.assign(c,y)}return c.range={start:s[0],end:s[3]},c.allDay=i.allDay,c}(F,c,y.pluginHooks.dateSelectionTransformers)),(!k||!function dae(t,n,e){return!!p5(n.validRange,t.range)&&Fz({dateSelection:t},e)}(k,c.dateProfile,y))&&(E=!0,k=null)}k?y.dispatch({type:"SELECT_DATES",selection:k}):f||y.dispatch({type:"UNSELECT_DATES"}),E?OA():RA(),f||(this.dragSelection=k)},this.handlePointerUp=c=>{this.dragSelection&&(fz(this.dragSelection,c,this.component.context),this.dragSelection=null)};let{component:e}=n,{options:i}=e.context,r=this.dragging=new K2(n.el);r.touchScrollAllowed=!1,r.minDistance=i.selectMinDistance||0,r.autoScroller.isEnabled=i.dragScroll;let s=this.hitDragging=new Rk(this.dragging,lP(n));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}},IN,class vde extends G2{constructor(n){super(n),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=s=>{let{component:c}=this,y=$2(this.querySegEl(s)),k=this.eventRange=y.eventRange;this.dragging.minDistance=c.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(s.origEvent.target)||s.isTouch&&this.component.props.eventSelection!==k.instance.instanceId)},this.handleDragStart=s=>{let{context:c}=this.component,f=this.eventRange;this.relevantEvents=eP(c.getCurrentData().eventStore,this.eventRange.instance.instanceId);let y=this.querySegEl(s);this.draggingSegEl=y,this.draggingSeg=$2(y),c.calendarApi.unselect(),c.emitter.trigger("eventResizeStart",{el:y,event:new Ba(c,f.def,f.instance),jsEvent:s.origEvent,view:c.viewApi})},this.handleHitUpdate=(s,c,f)=>{let{context:y}=this.component,k=this.relevantEvents,E=this.hitDragging.initialHit,F=this.eventRange.instance,$=null,W=null,re=!1,he={affectedEvents:k,mutatedEvents:{defs:{},instances:{}},isEvent:!0};s&&(s.componentId===E.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(E,s)||($=function bde(t,n,e,i){let r=t.context.dateEnv,f=U2(t.dateSpan.range.start,n.dateSpan.range.start,r,t.largeUnit);if(e){if(r.add(i.start,f)<i.end)return{startDelta:f}}else if(r.add(i.end,f)>i.start)return{endDelta:f};return null}(E,s,f.subjectEl.classList.contains("fc-event-resizer-start"),F.range))),$&&(W=iP(k,y.getCurrentData().eventUiBases,$,y),he.mutatedEvents=W,Lz(he,s.dateProfile,y)||(re=!0,$=null,W=null,he.mutatedEvents=null)),y.dispatch(W?{type:"SET_EVENT_RESIZE",state:he}:{type:"UNSET_EVENT_RESIZE"}),re?OA():RA(),c||($&&T5(E,s)&&($=null),this.validMutation=$,this.mutatedRelevantEvents=W)},this.handleDragEnd=s=>{let{context:c}=this.component,f=this.eventRange.def,y=this.eventRange.instance,k=new Ba(c,f,y),E=this.relevantEvents,F=this.mutatedRelevantEvents;if(c.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:k,jsEvent:s.origEvent,view:c.viewApi}),this.validMutation){let $=new Ba(c,F.defs[f.defId],y?F.instances[y.instanceId]:null);c.dispatch({type:"MERGE_EVENTS",eventStore:F});let W={oldEvent:k,event:$,relatedEvents:ry(F,c,y),revert(){c.dispatch({type:"MERGE_EVENTS",eventStore:E})}};c.emitter.trigger("eventResize",Object.assign(Object.assign({},W),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||ko(0),endDelta:this.validMutation.endDelta||ko(0),jsEvent:s.origEvent,view:c.viewApi})),c.emitter.trigger("eventChange",W)}else c.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:e}=n,i=this.dragging=new K2(n.el);i.pointer.selector=".fc-event-resizer",i.touchScrollAllowed=!1,i.autoScroller.isEnabled=e.context.options.dragScroll;let r=this.hitDragging=new Rk(this.dragging,lP(n));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(n){return Sd(n.subjectEl,".fc-event")}}],calendarInteractions:[class xde{constructor(n){this.context=n,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=i=>{i.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=i=>{let r=this.context.options.unselectCancel,s=D9(i.origEvent);this.matchesCancel=!!Sd(s,r),this.matchesEvent=!!Sd(s,IN.SELECTOR)},this.onDocumentPointerUp=i=>{let{context:r}=this,{documentPointer:s}=this,c=r.getCurrentData();if(!s.wasTouchScroll){if(c.dateSelection&&!this.isRecentPointerDateSelect){let f=r.options.unselectAuto;f&&(!f||!this.matchesCancel)&&r.calendarApi.unselect(i)}c.eventSelection&&!this.matchesEvent&&r.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let e=this.documentPointer=new FP(document);e.shouldIgnoreMove=!0,e.shouldWatchScroll=!1,e.emitter.on("pointerdown",this.onDocumentPointerDown),e.emitter.on("pointerup",this.onDocumentPointerUp),n.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}}],elementDraggingImpl:K2,optionRefiners:wde,listenerRefiners:kde});class Tde extends os{constructor(){super(...arguments),this.state={textId:z1()}}render(){let{theme:n,dateEnv:e,options:i,viewApi:r}=this.context,{cellId:s,dayDate:c,todayRange:f}=this.props,{textId:y}=this.state,k=hP(c,f),E=i.listDayFormat?e.format(c,i.listDayFormat):"",F=i.listDaySideFormat?e.format(c,i.listDaySideFormat):"",$=Object.assign({date:e.toDate(c),view:r,textId:y,text:E,sideText:F,navLinkAttrs:Z2(this.context,c),sideNavLinkAttrs:Z2(this.context,c,"day",!1)},k);return et(eh,{elTag:"tr",elClasses:["fc-list-day",...b5(k,n)],elAttrs:{"data-date":Ek(c)},renderProps:$,generatorName:"dayHeaderContent",customGenerator:i.dayHeaderContent,defaultGenerator:Ade,classNameGenerator:i.dayHeaderClassNames,didMount:i.dayHeaderDidMount,willUnmount:i.dayHeaderWillUnmount},W=>et("th",{scope:"colgroup",colSpan:3,id:s,"aria-labelledby":y},et(W,{elTag:"div",elClasses:["fc-list-day-cushion",n.getClass("tableCellShaded")]})))}}function Ade(t){return et(ms,null,t.text&&et("a",Object.assign({id:t.textId,className:"fc-list-day-text"},t.navLinkAttrs),t.text),t.sideText&&et("a",Object.assign({"aria-hidden":!0,className:"fc-list-day-side-text"},t.sideNavLinkAttrs),t.sideText))}const Pde=pa({hour:"numeric",minute:"2-digit",meridiem:"short"});class Ide extends os{render(){let{props:n,context:e}=this,{options:i}=e,{seg:r,timeHeaderId:s,eventHeaderId:c,dateHeaderId:f}=n,y=i.eventTimeFormat||Pde;return et(C5,Object.assign({},n,{elTag:"tr",elClasses:["fc-list-event",r.eventRange.def.url&&"fc-event-forced-url"],defaultGenerator:()=>function Ode(t,n){let e=sP(t,n);return et("a",Object.assign({},e),t.eventRange.def.title)}(r,e),seg:r,timeText:"",disableDragging:!0,disableResizing:!0}),(k,E)=>et(ms,null,function Rde(t,n,e,i,r){let{options:s}=e;if(!1!==s.displayEventTime){let k,f=t.eventRange.instance,y=!1;return t.eventRange.def.allDay?y=!0:function Goe(t){let n=YA(t);return B1(n.start,n.end)>1}(t.eventRange.range)?t.isStart?k=Ik(t,n,e,null,null,f.range.start,t.end):t.isEnd?k=Ik(t,n,e,null,null,t.start,f.range.end):y=!0:k=Ik(t,n,e),y?et(eh,{elTag:"td",elClasses:["fc-list-event-time"],elAttrs:{headers:`${i} ${r}`},renderProps:{text:e.options.allDayText,view:e.viewApi},generatorName:"allDayContent",customGenerator:s.allDayContent,defaultGenerator:Lde,classNameGenerator:s.allDayClassNames,didMount:s.allDayDidMount,willUnmount:s.allDayWillUnmount}):et("td",{className:"fc-list-event-time"},k)}return null}(r,y,e,s,f),et("td",{"aria-hidden":!0,className:"fc-list-event-graphic"},et("span",{className:"fc-list-event-dot",style:{borderColor:E.borderColor||E.backgroundColor}})),et(k,{elTag:"td",elClasses:["fc-list-event-title"],elAttrs:{headers:`${c} ${f}`}})))}}function Lde(t){return t.text}function zde(t){return t.text}function Nde(t){let n=$s(t.renderRange.start),e=t.renderRange.end,i=[],r=[];for(;n<e;)i.push(n),r.push({start:n,end:Oc(n,1)}),n=Oc(n,1);return{dayDates:i,dayRanges:r}}function RN(t){return!1===t?null:pa(t)}J4(':root{--fc-list-event-dot-width:10px;--fc-list-event-hover-bg-color:#f5f5f5}.fc-theme-standard .fc-list{border:1px solid var(--fc-border-color)}.fc .fc-list-empty{align-items:center;background-color:var(--fc-neutral-bg-color);display:flex;height:100%;justify-content:center}.fc .fc-list-empty-cushion{margin:5em 0}.fc .fc-list-table{border-style:hidden;width:100%}.fc .fc-list-table tr>*{border-left:0;border-right:0}.fc .fc-list-sticky .fc-list-day>*{background:var(--fc-page-bg-color);position:sticky;top:0}.fc .fc-list-table thead{left:-10000px;position:absolute}.fc .fc-list-table tbody>tr:first-child th{border-top:0}.fc .fc-list-table th{padding:0}.fc .fc-list-day-cushion,.fc .fc-list-table td{padding:8px 14px}.fc .fc-list-day-cushion:after{clear:both;content:"";display:table}.fc-theme-standard .fc-list-day-cushion{background-color:var(--fc-neutral-bg-color)}.fc-direction-ltr .fc-list-day-text,.fc-direction-rtl .fc-list-day-side-text{float:left}.fc-direction-ltr .fc-list-day-side-text,.fc-direction-rtl .fc-list-day-text{float:right}.fc-direction-ltr .fc-list-table .fc-list-event-graphic{padding-right:0}.fc-direction-rtl .fc-list-table .fc-list-event-graphic{padding-left:0}.fc .fc-list-event.fc-event-forced-url{cursor:pointer}.fc .fc-list-event:hover td{background-color:var(--fc-list-event-hover-bg-color)}.fc .fc-list-event-graphic,.fc .fc-list-event-time{white-space:nowrap;width:1px}.fc .fc-list-event-dot{border:calc(var(--fc-list-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-list-event-dot-width)/2);box-sizing:content-box;display:inline-block;height:0;width:0}.fc .fc-list-event-title a{color:inherit;text-decoration:none}.fc .fc-list-event.fc-event-forced-url:hover a{text-decoration:underline}');var Hde=Vf({name:"@fullcalendar/list",optionRefiners:{listDayFormat:RN,listDaySideFormat:RN,noEventsClassNames:Gt,noEventsContent:Gt,noEventsDidMount:Gt,noEventsWillUnmount:Gt},views:{list:{component:class Fde extends Tp{constructor(){super(...arguments),this.computeDateVars=er(Nde),this.eventStoreToSegs=er(this._eventStoreToSegs),this.state={timeHeaderId:z1(),eventHeaderId:z1(),dateHeaderIdRoot:z1()},this.setRootEl=n=>{n?this.context.registerInteractiveComponent(this,{el:n}):this.context.unregisterInteractiveComponent(this)}}render(){let{props:n,context:e}=this,{dayDates:i,dayRanges:r}=this.computeDateVars(n.dateProfile),s=this.eventStoreToSegs(n.eventStore,n.eventUiBases,r);return et(Ak,{elRef:this.setRootEl,elClasses:["fc-list",e.theme.getClass("table"),!1!==e.options.stickyHeaderDates?"fc-list-sticky":""],viewSpec:e.viewSpec},et(Nz,{liquid:!n.isHeightAuto,overflowX:n.isHeightAuto?"visible":"hidden",overflowY:n.isHeightAuto?"visible":"auto"},s.length>0?this.renderSegList(s,i):this.renderEmptyMessage()))}renderEmptyMessage(){let{options:n,viewApi:e}=this.context;return et(eh,{elTag:"div",elClasses:["fc-list-empty"],renderProps:{text:n.noEventsText,view:e},generatorName:"noEventsContent",customGenerator:n.noEventsContent,defaultGenerator:zde,classNameGenerator:n.noEventsClassNames,didMount:n.noEventsDidMount,willUnmount:n.noEventsWillUnmount},r=>et(r,{elTag:"div",elClasses:["fc-list-empty-cushion"]}))}renderSegList(n,e){let{theme:i,options:r}=this.context,{timeHeaderId:s,eventHeaderId:c,dateHeaderIdRoot:f}=this.state,y=function Bde(t){let e,i,n=[];for(e=0;e<t.length;e+=1)i=t[e],(n[i.dayIndex]||(n[i.dayIndex]=[])).push(i);return n}(n);return et(W2,{unit:"day"},(k,E)=>{let F=[];for(let $=0;$<y.length;$+=1){let W=y[$];if(W){let re=Ek(e[$]),he=f+"-"+re;F.push(et(Tde,{key:re,cellId:he,dayDate:e[$],todayRange:E})),W=oP(W,r.eventOrder);for(let me of W)F.push(et(Ide,Object.assign({key:re+":"+me.eventRange.instance.instanceId,seg:me,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,timeHeaderId:s,eventHeaderId:c,dateHeaderId:he},og(me,E,k))))}}return et("table",{className:"fc-list-table "+i.getClass("table")},et("thead",null,et("tr",null,et("th",{scope:"col",id:s},r.timeHint),et("th",{scope:"col","aria-hidden":!0}),et("th",{scope:"col",id:c},r.eventHint))),et("tbody",null,F))})}_eventStoreToSegs(n,e,i){return this.eventRangesToSegs(rP(n,e,this.props.dateProfile.activeRange,this.context.options.nextDayThreshold).fg,i)}eventRangesToSegs(n,e){let i=[];for(let r of n)i.push(...this.eventRangeToSegs(r,e));return i}eventRangeToSegs(n,e){let f,y,k,{dateEnv:i}=this.context,{nextDayThreshold:r}=this.context.options,s=n.range,c=n.def.allDay,E=[];for(f=0;f<e.length;f+=1)if(y=H1(s,e[f]),y&&(k={component:this,eventRange:n,start:y.start,end:y.end,isStart:n.isStart&&y.start.valueOf()===s.start.valueOf(),isEnd:n.isEnd&&y.end.valueOf()===s.end.valueOf(),dayIndex:f},E.push(k),!k.isEnd&&!c&&f+1<e.length&&s.end<i.add(e[f+1].start,r))){k.end=s.end,k.isEnd=!0;break}return E}},buttonTextKey:"list",listDayFormat:{month:"long",day:"numeric",year:"numeric"}},listDay:{type:"list",duration:{days:1},listDayFormat:{weekday:"long"}},listWeek:{type:"list",duration:{weeks:1},listDayFormat:{weekday:"long"},listDaySideFormat:{month:"long",day:"numeric",year:"numeric"}},listMonth:{type:"list",duration:{month:1},listDaySideFormat:{weekday:"long"}},listYear:{type:"list",duration:{year:1},listDaySideFormat:{weekday:"long"}}}});const Ude=["*"],qde=["rootEl"],Q2=function(t){return{$implicit:t}};function $de(t,n){if(1&t&&(z(0,"div",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}function Gde(t,n){if(1&t&&(z(0,"span",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}function Wde(t,n){if(1&t&&(z(0,"a",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}function Zde(t,n){if(1&t&&(z(0,"tr",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}function Yde(t,n){if(1&t&&(z(0,"th",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}function Xde(t,n){if(1&t&&(z(0,"td",1,2),$l(2,3),B()),2&t){const e=ht();ye("ngClass",e.elClasses||"")("ngStyle",e.elStyle||null),ne(2),ye("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Gr(4,Q2,e.renderProps))}}const Kde=["dayHeaderContent"],Qde=["dayCellContent"],Jde=["weekNumberContent"],ehe=["nowIndicatorContent"],the=["eventContent"],nhe=["slotLaneContent"],ihe=["slotLabelContent"],rhe=["allDayContent"],ohe=["moreLinkContent"],she=["noEventsContent"],ahe=["resourceAreaHeaderContent"],lhe=["resourceGroupLabelContent"],che=["resourceLabelContent"],dhe=["resourceLaneContent"],hhe=["resourceGroupLaneContent"];function uhe(t,n){if(1&t&&$e(0,"transport-container",1),2&t){const e=n.$implicit;ye("inPlaceOf",e.containerEl)("reportEl",e.reportNewContainerEl)("elTag",e.elTag)("elClasses",e.elClasses)("elStyle",e.elStyle)("elAttrs",e.elAttrs)("template",e.generatorMeta)("renderProps",e.renderProps)}}const LN={headerToolbar:!0,footerToolbar:!0,events:!0,eventSources:!0,resources:!0},phe=["events","eventSources","resources"],fhe=Object.prototype.hasOwnProperty;function A5(t){return Array.isArray(t)?t.map(A5):t instanceof Date?new Date(t.valueOf()):"object"==typeof t&&t?FN(t,A5):t}function FN(t,n){const e={};for(const i in t)fhe.call(t,i)&&(e[i]=n(t[i],i));return e}function NP(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var e,i,r;if(Array.isArray(t)){if((e=t.length)!=n.length)return!1;for(i=e;0!=i--;)if(!NP(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((e=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=e;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,r[i]))return!1;for(i=e;0!=i--;){var s=r[i];if(!NP(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}const P5=typeof document<"u"?document.createDocumentFragment():null;let mhe=(()=>{class t{constructor(e){this.element=e}ngAfterViewInit(){P5&&P5.appendChild(this.element.nativeElement)}ngOnDestroy(){P5&&P5.removeChild(this.element.nativeElement)}}return t.\u0275fac=function(e){return new(e||t)(st(ns))},t.\u0275cmp=Xn({type:t,selectors:[["offscreen-fragment"]],ngContentSelectors:Ude,decls:1,vars:0,template:function(e,i){1&e&&(function a2(t){const n=cn()[fe][ee];if(!n.projection){const i=n.projection=It(t?t.length:1,null),r=i.slice();let s=n.child;for(;null!==s;){const c=t?v3(s,t):0;null!==c&&(r[c]?r[c].projectionNext=s:i[c]=s,r[c]=s),s=s.next}}}(),function l2(t,n=0,e){const i=cn(),r=Jr(),s=Em(r,Ar+t,16,null,e||null);null===s.projection&&(s.projection=n),Gd(),(!i[Ua]||Bh())&&32!=(32&s.flags)&&function lE(t,n,e){cf(n[yt],0,n,e,Xg(t,e,n),Yy(e.parent||n[ee],e,n))}(r,i,s)}(0))},encapsulation:2}),t})();const J2=typeof document<"u"?document.createDocumentFragment():null;let ghe=(()=>{class t{ngAfterViewInit(){const e=this.rootElRef?.nativeElement;zN(e,this.inPlaceOf),BP(e,void 0,this.elAttrs),this.inPlaceOf.style.display="none",this.reportEl(e)}ngOnChanges(e){const i=this.rootElRef?.nativeElement;if(i)if(this.inPlaceOf.parentNode!==J2)zN(i,this.inPlaceOf),BP(i,void 0,this.elAttrs),this.reportEl(i);else{const r=e.elAttrs;r&&BP(i,r.previousValue,r.currentValue)}}ngOnDestroy(){this.inPlaceOf.parentNode===J2&&J2&&J2.removeChild(this.inPlaceOf),this.reportEl(null)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Xn({type:t,selectors:[["transport-container"]],viewQuery:function(e,i){if(1&e&&Df(qde,5),2&e){let r;js(r=Hs())&&(i.rootElRef=r.first)}},inputs:{inPlaceOf:"inPlaceOf",reportEl:"reportEl",elTag:"elTag",elClasses:"elClasses",elStyle:"elStyle",elAttrs:"elAttrs",template:"template",renderProps:"renderProps"},features:[ol],decls:6,vars:6,consts:[[3,"ngIf"],[3,"ngClass","ngStyle"],["rootEl",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,i){1&e&&(He(0,$de,3,6,"ng-template",0),He(1,Gde,3,6,"ng-template",0),He(2,Wde,3,6,"ng-template",0),He(3,Zde,3,6,"ng-template",0),He(4,Yde,3,6,"ng-template",0),He(5,Xde,3,6,"ng-template",0)),2&e&&(ye("ngIf","div"==i.elTag),ne(1),ye("ngIf","span"==i.elTag),ne(1),ye("ngIf","a"==i.elTag),ne(1),ye("ngIf","tr"==i.elTag),ne(1),ye("ngIf","th"==i.elTag),ne(1),ye("ngIf","td"==i.elTag))},dependencies:[wo,ha,pR,fR],encapsulation:2}),t})();function zN(t,n){n.parentNode?.insertBefore(t,n.nextSibling),J2&&J2.appendChild(n)}function BP(t,n={},e={}){for(const i in n)i in e||(t[i]=null);for(const i in e)t[i]=e[i]}let _he=(()=>{class t{constructor(e,i){this.element=e,this.calendar=null,this.optionSnapshot={},this.customRenderingMap=new Map;const r=new Nae;r.subscribe(s=>{this.customRenderingMap=s,this.customRenderingArray=void 0,i.detectChanges()}),this.handleCustomRendering=r.handle.bind(r)}ngAfterViewInit(){const{deepChangeDetection:e}=this,i={...this.options,...this.buildInputOptions()};this.optionSnapshot=FN(i,(f,y)=>e&&LN[y]?A5(f):f);const r=this.element.nativeElement,s=this.calendar=new Wle(r,{...i,...this.buildExtraOptions()}),c=r.closest("ion-content");c&&c.componentOnReady?c.componentOnReady().then(()=>{window.requestAnimationFrame(()=>{s.render()})}):s.render(),setTimeout(()=>s.updateSize())}ngDoCheck(){if(this.calendar){const{deepChangeDetection:e,optionSnapshot:i}=this,r={...this.options,...this.buildInputOptions()},s={},c=[];for(const y in r)if(r.hasOwnProperty(y)){let k=r[y];e&&LN[y]?NP(i[y],k)||(i[y]=A5(k),c.push(y)):i[y]!==k&&(i[y]=k,c.push(y)),s[y]=k}const f=Object.keys(i);for(const y of f)y in r||(delete i[y],c.push(y));c.length&&(this.calendar.pauseRendering(),this.calendar.resetOptions({...s,...this.buildExtraOptions()},c))}}ngAfterContentChecked(){this.calendar&&this.calendar.resumeRendering()}ngOnDestroy(){this.calendar&&(this.calendar.destroy(),this.calendar=null)}get customRenderings(){return this.customRenderingArray||(this.customRenderingArray=[...this.customRenderingMap.values()])}getApi(){return this.calendar}buildInputOptions(){const e={};for(const i of phe){const r=this[i];null!=r&&(e[i]=r)}return e}buildExtraOptions(){return{handleCustomRendering:this.handleCustomRendering,customRenderingMetaMap:this,customRenderingReplaces:!0}}trackCustomRendering(e,i){return i.id}}return t.\u0275fac=function(e){return new(e||t)(st(ns),st(Pf))},t.\u0275cmp=Xn({type:t,selectors:[["full-calendar"]],contentQueries:function(e,i,r){if(1&e&&(Ac(r,Kde,7),Ac(r,Qde,7),Ac(r,Jde,7),Ac(r,ehe,7),Ac(r,the,7),Ac(r,nhe,7),Ac(r,ihe,7),Ac(r,rhe,7),Ac(r,ohe,7),Ac(r,she,7),Ac(r,ahe,7),Ac(r,lhe,7),Ac(r,che,7),Ac(r,dhe,7),Ac(r,hhe,7)),2&e){let s;js(s=Hs())&&(i.dayHeaderContent=s.first),js(s=Hs())&&(i.dayCellContent=s.first),js(s=Hs())&&(i.weekNumberContent=s.first),js(s=Hs())&&(i.nowIndicatorContent=s.first),js(s=Hs())&&(i.eventContent=s.first),js(s=Hs())&&(i.slotLaneContent=s.first),js(s=Hs())&&(i.slotLabelContent=s.first),js(s=Hs())&&(i.allDayContent=s.first),js(s=Hs())&&(i.moreLinkContent=s.first),js(s=Hs())&&(i.noEventsContent=s.first),js(s=Hs())&&(i.resourceAreaHeaderContent=s.first),js(s=Hs())&&(i.resourceGroupLabelContent=s.first),js(s=Hs())&&(i.resourceLabelContent=s.first),js(s=Hs())&&(i.resourceLaneContent=s.first),js(s=Hs())&&(i.resourceGroupLaneContent=s.first)}},inputs:{options:"options",deepChangeDetection:"deepChangeDetection",events:"events",eventSources:"eventSources",resources:"resources"},decls:2,vars:2,consts:[[3,"inPlaceOf","reportEl","elTag","elClasses","elStyle","elAttrs","template","renderProps",4,"ngFor","ngForOf","ngForTrackBy"],[3,"inPlaceOf","reportEl","elTag","elClasses","elStyle","elAttrs","template","renderProps"]],template:function(e,i){1&e&&(z(0,"offscreen-fragment"),He(1,uhe,1,8,"transport-container",0),B()),2&e&&(ne(1),ye("ngForOf",i.customRenderings)("ngForTrackBy",i.trackCustomRendering))},dependencies:[mhe,ghe,qs],encapsulation:2}),t})(),yhe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Bi({type:t}),t.\u0275inj=Ii({imports:[[Gm]]}),t})();function vhe(t,n){if(1&t){const e=Ki();z(0,"button",21),qt("click",function(){return An(e),Mn(ht().updateStatus("approved"))}),q(1,"Accept"),B()}}let bhe=(()=>{class t{constructor(e){this.propertyService=e,this.selectedEvent=null,this.calendarOptions={initialView:"timeGridWeek",plugins:[yce,nde,Dde,Hde],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},nowIndicator:!0,slotMinTime:"08:00:00",slotMaxTime:"18:00:00",weekends:!1,allDaySlot:!1,eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short",hour12:!0},editable:!0,eventClick:this.handleEventClick.bind(this),events:[],eventDidMount:i=>{new bootstrap.Tooltip(i.el,{title:`\n          <div class="calendar-tooltip">\n            <div><strong>Client:</strong> ${i.event.extendedProps.client}</div>\n            <div><strong>Phone:</strong> ${i.event.extendedProps.phone}</div>\n            <div><strong>Property:</strong> ${i.event.extendedProps.property}</div>\n            <div><strong>Status:</strong> ${i.event.extendedProps.status}</div>\n          </div>\n        `,placement:"top",trigger:"hover",html:!0})}}}ngOnInit(){this.loadAppointments(),console.log(this.propertyService.getOwnerAppointments()),this.propertyService.getOwnerAppointments().subscribe(e=>{console.log(e)})}loadAppointments(){this.propertyService.getOwnerAppointments().subscribe(e=>{this.calendarOptions.events=e.map(i=>({id:i.id?.toString()??"",title:`${i.propertyTitle}`,start:`${i.appointmentDate}T${i.appointmentTime}`,extendedProps:{status:i.status,client:`${i.name} ${i.lastName}`,phone:i.userPhone,property:i.propertyTitle,location:`${i.propertycity}, ${i.propertysubcity}`},color:this.getEventColor(i.status)}))})}getEventColor(e=""){return{approved:"#4CAF50",pending:"#FFC107",canceled:"#F44336"}[e.toLowerCase()]||"#2196F3"}handleEventClick(e){const i=e.event;this.selectedEvent={id:i.id,title:i.title,status:i.extendedProps.status,client:i.extendedProps.client,phone:i.extendedProps.phone,location:i.extendedProps.location},new bootstrap.Modal(document.getElementById("eventModal")).show()}updateStatus(e){const i=this.selectedEvent?.id;i&&(console.log("Updating status for appointment ID:",i,"to",e),this.propertyService.updateAppointmentStatus(+i,e).subscribe({next:()=>{this.loadAppointments(),bootstrap.Modal.getInstance(document.getElementById("eventModal"))?.hide()},error:r=>{console.error("Failed to update status",r)}}))}changeView(e){this.calendarOptions.initialView=e}conso(){console.log(this.calendarOptions.events)}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-appointments-calendar"]],decls:46,vars:8,consts:[[1,"calendar-container"],[1,"calendar-header"],[1,"legend","mb-3"],[1,"legend-item","me-3"],[1,"legend-color",2,"background-color","#FFC107"],[1,"legend-color",2,"background-color","#4CAF50"],[1,"legend-item"],[1,"legend-color",2,"background-color","#F44336"],[1,"aaa",3,"options"],["id","eventModal","tabindex","-1","aria-labelledby","eventModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-sm"],[1,"modal-content"],[1,"modal-header"],["id","eventModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"ngClass"],[1,"modal-footer"],["type","button","ng","","class","btn btn-success",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","ng","",1,"btn","btn-success",3,"click"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"h2"),q(3,"Appointment Calendar"),B()(),z(4,"div",2)(5,"span",3),$e(6,"span",4),q(7," Pending"),B(),z(8,"span",3),$e(9,"span",5),q(10," Approved"),B(),z(11,"span",6),$e(12,"span",7),q(13," Canceled"),B()(),$e(14,"full-calendar",8),B(),z(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h5",13),q(20),B(),$e(21,"button",14),B(),z(22,"div",15)(23,"p")(24,"strong"),q(25,"Status:"),B(),z(26,"span",16),q(27),B()(),z(28,"p")(29,"strong"),q(30,"Client:"),B(),q(31),B(),z(32,"p")(33,"strong"),q(34,"Phone:"),B(),q(35),B(),z(36,"p")(37,"strong"),q(38,"Location:"),B(),q(39),B()(),z(40,"div",17),He(41,vhe,2,0,"button",18),z(42,"button",19),qt("click",function(){return r.updateStatus("canceled")}),q(43,"Decline"),B(),z(44,"button",20),q(45,"Close"),B()()()()()),2&i&&(ne(14),ye("options",r.calendarOptions),ne(6),Qe(null==r.selectedEvent?null:r.selectedEvent.title),ne(6),ye("ngClass","status-"+(null==r.selectedEvent?null:r.selectedEvent.status)),ne(1),Qe(null==r.selectedEvent?null:r.selectedEvent.status),ne(4),Ft(" ",null==r.selectedEvent?null:r.selectedEvent.client,""),ne(4),Ft(" ",null==r.selectedEvent?null:r.selectedEvent.phone,""),ne(4),Ft(" ",null==r.selectedEvent?null:r.selectedEvent.location,""),ne(2),ye("ngIf","pending"===(null==r.selectedEvent?null:r.selectedEvent.status)))},dependencies:[ha,wo,_he],styles:["[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-timegrid-slot[_ngcontent-%COMP%]{border-bottom:0px;height:2.5rem!important}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-now-indicator[_ngcontent-%COMP%]{background-color:#ff4081;height:3px;box-shadow:0 0 6px #ff4081b3;z-index:9999}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-timegrid-now-indicator-line[_ngcontent-%COMP%]{background-color:#ff4081;height:3px;box-shadow:0 0 6px #ff4081b3}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-timegrid-now-indicator-arrow[_ngcontent-%COMP%]{border-top-color:#ff4081}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-button[_ngcontent-%COMP%]{background-color:#2a7b68;border:none;color:#fff;border-radius:4px;font-size:.85rem}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-button[_ngcontent-%COMP%]:hover{background-color:#2a7b68}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-event[_ngcontent-%COMP%]{border-radius:4px;border-left:3px solid;padding:2px 4px;margin:1px 0;font-size:14px}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-toolbar[_ngcontent-%COMP%]{padding:16px;background-color:#fff;border-bottom:1px solid #e9ecef}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-toolbar-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}[_ngcontent-%COMP%]:is()   [_ngcontent-%COMP%]:is(.fc   .fc-button-primary[_ngcontent-%COMP%]:not(:disabled).fc-button-active, .fc[_ngcontent-%COMP%]   .fc-button-primary[_ngcontent-%COMP%]:not(:disabled):active){background-color:#2a7b68;border-color:#f6f6fe;color:#fff}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-col-header-cell[_ngcontent-%COMP%]{padding:10px 0;background-color:#f8f9fa;font-weight:500}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-daygrid-day-number[_ngcontent-%COMP%]{padding:8px;font-size:14px;color:#495057}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-day-today[_ngcontent-%COMP%]{background-color:#66e5460d!important}[_ngcontent-%COMP%]:is()   [_ngcontent-%COMP%]:is(.fc   .fc-day-sun[_ngcontent-%COMP%], .fc[_ngcontent-%COMP%]   .fc-day-sat)[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#495057}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-scroller[_ngcontent-%COMP%]{overflow:hidden}[_ngcontent-%COMP%]:is()   .fc-event[_ngcontent-%COMP%]{border-radius:4px;border-left:3px solid;padding:2px 4px;margin:1px 0;font-size:13px}[_ngcontent-%COMP%]:is()   .fc-event-approved[_ngcontent-%COMP%]{background-color:#4caf501a;border-color:#4caf50;color:#2e7d32}[_ngcontent-%COMP%]:is()   .fc-event-pending[_ngcontent-%COMP%]{background-color:#ffc1071a;border-color:#ffc107;color:#ff8f00}[_ngcontent-%COMP%]:is()   .fc-event-canceled[_ngcontent-%COMP%]{background-color:#f443361a;border-color:#f44336;color:#d32f2f}[_ngcontent-%COMP%]:is()   .fc-event-emergency[_ngcontent-%COMP%]{background-color:#2196f31a;border-color:#2196f3;color:#1976d2}[_ngcontent-%COMP%]:is()   .fc-event-lunch[_ngcontent-%COMP%]{background-color:#f57c000d;border-color:#f57c00;color:#ef6c00}[_ngcontent-%COMP%]:is()   .fc-day-today[_ngcontent-%COMP%]   .fc-daygrid-day-frame[_ngcontent-%COMP%]{border:2px solid #2A7B68;border-radius:4px}[_ngcontent-%COMP%]:is()   .fc[_ngcontent-%COMP%]   .fc-timegrid-col.fc-day-today[_ngcontent-%COMP%]{background-color:#4f46e50d}.calendar-container[_ngcontent-%COMP%]{padding:20px;width:100%;height:600px;margin:0 auto}.aaa[_ngcontent-%COMP%]{width:100%;height:100vh}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.view-options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#f0f0f0;border:1px solid #ddd;padding:5px 10px;margin-left:5px;cursor:pointer}.fc-event[_ngcontent-%COMP%]{background-color:#2a7b68!important;color:#fff!important;border:none;border-radius:6px;font-size:.85rem;padding:2px 4px}.fc-timegrid-slot[_ngcontent-%COMP%]{background-color:#fafafa}.fc-toolbar[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:15px}.fc-timegrid-slot-label[_ngcontent-%COMP%]{font-size:1rem;color:green}.view-options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#e0e0e0}.fc-event-approved[_ngcontent-%COMP%]{background-color:#4caf50;border-color:#4caf50}.fc-event-pending[_ngcontent-%COMP%]{background-color:#ffc107;border-color:#ffc107}.fc-event-canceled[_ngcontent-%COMP%]{background-color:#f44336;border-color:#f44336}.status-approved[_ngcontent-%COMP%]{color:#4caf50}.status-pending[_ngcontent-%COMP%]{color:#ffc107}.status-canceled[_ngcontent-%COMP%]{color:#f44336}.modal-content[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 25px #0003;border:none;overflow:hidden}.modal-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef;padding:16px 20px}.modal-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#212529}.modal-body[_ngcontent-%COMP%]{padding:20px;font-size:14px}.modal-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:12px;display:flex;align-items:center}.modal-body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{width:100px;color:#6c757d;font-weight:500}.status-approved[_ngcontent-%COMP%]{color:#4caf50;font-weight:500}.status-pending[_ngcontent-%COMP%]{color:#ffc107;font-weight:500}.status-canceled[_ngcontent-%COMP%]{color:#f44336;font-weight:500}.status-emergency[_ngcontent-%COMP%]{color:#2196f3;font-weight:500}@media (min-width: 576px){.modal-dialog[_ngcontent-%COMP%]{max-width:400px}}.legend-item[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.legend-color[_ngcontent-%COMP%]{width:12px;height:12px;display:inline-block;margin-right:5px;border-radius:10px}"]})}}return t})();function eb(t){return t+.5|0}const ag=(t,n,e)=>Math.max(Math.min(t,e),n);function Lk(t){return ag(eb(2.55*t),0,255)}function q1(t){return ag(eb(255*t),0,255)}function lg(t){return ag(eb(t/2.55)/100,0,1)}function NN(t){return ag(eb(100*t),0,100)}const Nu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},VP=[..."0123456789ABCDEF"],xhe=t=>VP[15&t],whe=t=>VP[(240&t)>>4]+VP[15&t],I5=t=>(240&t)>>4==(15&t);const Ehe=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function BN(t,n,e){const i=n*Math.min(e,1-e),r=(s,c=(s+t/30)%12)=>e-i*Math.max(Math.min(c-3,9-c,1),-1);return[r(0),r(8),r(4)]}function Dhe(t,n,e){const i=(r,s=(r+t/60)%6)=>e-e*n*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function The(t,n,e){const i=BN(t,1,.5);let r;for(n+e>1&&(r=1/(n+e),n*=r,e*=r),r=0;r<3;r++)i[r]*=1-n-e,i[r]+=n;return i}function jP(t){const e=t.r/255,i=t.g/255,r=t.b/255,s=Math.max(e,i,r),c=Math.min(e,i,r),f=(s+c)/2;let y,k,E;return s!==c&&(E=s-c,k=f>.5?E/(2-s-c):E/(s+c),y=function Ahe(t,n,e,i,r){return t===r?(n-e)/i+(n<e?6:0):n===r?(e-t)/i+2:(t-n)/i+4}(e,i,r,E,s),y=60*y+.5),[0|y,k||0,f]}function HP(t,n,e,i){return(Array.isArray(n)?t(n[0],n[1],n[2]):t(n,e,i)).map(q1)}function UP(t,n,e){return HP(BN,t,n,e)}function VN(t){return(t%360+360)%360}const jN={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},HN={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let O5;const Nhe=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,qP=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,tb=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function R5(t,n,e){if(t){let i=jP(t);i[n]=Math.max(0,Math.min(i[n]+i[n]*e,0===n?360:1)),i=UP(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function UN(t,n){return t&&Object.assign(n||{},t)}function qN(t){var n={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(n={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(n.a=q1(t[3]))):(n=UN(t,{r:0,g:0,b:0,a:1})).a=q1(n.a),n}function Hhe(t){return"r"===t.charAt(0)?function Bhe(t){const n=Nhe.exec(t);let i,r,s,e=255;if(n){if(n[7]!==i){const c=+n[7];e=n[8]?Lk(c):ag(255*c,0,255)}return i=+n[1],r=+n[3],s=+n[5],i=255&(n[2]?Lk(i):ag(i,0,255)),r=255&(n[4]?Lk(r):ag(r,0,255)),s=255&(n[6]?Lk(s):ag(s,0,255)),{r:i,g:r,b:s,a:e}}}(t):function Ohe(t){const n=Ehe.exec(t);let i,e=255;if(!n)return;n[5]!==i&&(e=n[6]?Lk(+n[5]):q1(+n[5]));const r=VN(+n[2]),s=+n[3]/100,c=+n[4]/100;return i="hwb"===n[1]?function Phe(t,n,e){return HP(The,t,n,e)}(r,s,c):"hsv"===n[1]?function Ihe(t,n,e){return HP(Dhe,t,n,e)}(r,s,c):UP(r,s,c),{r:i[0],g:i[1],b:i[2],a:e}}(t)}class nb{constructor(n){if(n instanceof nb)return n;const e=typeof n;let i;"object"===e?i=qN(n):"string"===e&&(i=function Mhe(t){var e,n=t.length;return"#"===t[0]&&(4===n||5===n?e={r:255&17*Nu[t[1]],g:255&17*Nu[t[2]],b:255&17*Nu[t[3]],a:5===n?17*Nu[t[4]]:255}:(7===n||9===n)&&(e={r:Nu[t[1]]<<4|Nu[t[2]],g:Nu[t[3]]<<4|Nu[t[4]],b:Nu[t[5]]<<4|Nu[t[6]],a:9===n?Nu[t[7]]<<4|Nu[t[8]]:255})),e}(n)||function zhe(t){O5||(O5=function Fhe(){const t={},n=Object.keys(HN),e=Object.keys(jN);let i,r,s,c,f;for(i=0;i<n.length;i++){for(c=f=n[i],r=0;r<e.length;r++)s=e[r],f=f.replace(s,jN[s]);s=parseInt(HN[c],16),t[f]=[s>>16&255,s>>8&255,255&s]}return t}(),O5.transparent=[0,0,0,0]);const n=O5[t.toLowerCase()];return n&&{r:n[0],g:n[1],b:n[2],a:4===n.length?n[3]:255}}(n)||Hhe(n)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var n=UN(this._rgb);return n&&(n.a=lg(n.a)),n}set rgb(n){this._rgb=qN(n)}rgbString(){return this._valid?function Vhe(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${lg(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}(this._rgb):void 0}hexString(){return this._valid?function She(t){var n=(t=>I5(t.r)&&I5(t.g)&&I5(t.b)&&I5(t.a))(t)?xhe:whe;return t?"#"+n(t.r)+n(t.g)+n(t.b)+((t,n)=>t<255?n(t):"")(t.a,n):void 0}(this._rgb):void 0}hslString(){return this._valid?function Lhe(t){if(!t)return;const n=jP(t),e=n[0],i=NN(n[1]),r=NN(n[2]);return t.a<255?`hsla(${e}, ${i}%, ${r}%, ${lg(t.a)})`:`hsl(${e}, ${i}%, ${r}%)`}(this._rgb):void 0}mix(n,e){if(n){const i=this.rgb,r=n.rgb;let s;const c=e===s?.5:e,f=2*c-1,y=i.a-r.a,k=((f*y==-1?f:(f+y)/(1+f*y))+1)/2;s=1-k,i.r=255&k*i.r+s*r.r+.5,i.g=255&k*i.g+s*r.g+.5,i.b=255&k*i.b+s*r.b+.5,i.a=c*i.a+(1-c)*r.a,this.rgb=i}return this}interpolate(n,e){return n&&(this._rgb=function jhe(t,n,e){const i=tb(lg(t.r)),r=tb(lg(t.g)),s=tb(lg(t.b));return{r:q1(qP(i+e*(tb(lg(n.r))-i))),g:q1(qP(r+e*(tb(lg(n.g))-r))),b:q1(qP(s+e*(tb(lg(n.b))-s))),a:t.a+e*(n.a-t.a)}}(this._rgb,n._rgb,e)),this}clone(){return new nb(this.rgb)}alpha(n){return this._rgb.a=q1(n),this}clearer(n){return this._rgb.a*=1-n,this}greyscale(){const n=this._rgb,e=eb(.3*n.r+.59*n.g+.11*n.b);return n.r=n.g=n.b=e,this}opaquer(n){return this._rgb.a*=1+n,this}negate(){const n=this._rgb;return n.r=255-n.r,n.g=255-n.g,n.b=255-n.b,this}lighten(n){return R5(this._rgb,2,n),this}darken(n){return R5(this._rgb,2,-n),this}saturate(n){return R5(this._rgb,1,n),this}desaturate(n){return R5(this._rgb,1,-n),this}rotate(n){return function Rhe(t,n){var e=jP(t);e[0]=VN(e[0]+n),e=UP(e),t.r=e[0],t.g=e[1],t.b=e[2]}(this._rgb,n),this}}function cg(){}const Uhe=(()=>{let t=0;return()=>t++})();function Mo(t){return null==t}function fa(t){if(Array.isArray&&Array.isArray(t))return!0;const n=Object.prototype.toString.call(t);return"[object"===n.slice(0,7)&&"Array]"===n.slice(-6)}function Po(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function ul(t){return("number"==typeof t||t instanceof Number)&&isFinite(+t)}function Qh(t,n){return ul(t)?t:n}function Zr(t,n){return typeof t>"u"?n:t}const $N=(t,n)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*n:+t;function ta(t,n,e){if(t&&"function"==typeof t.call)return t.apply(e,n)}function Cs(t,n,e,i){let r,s,c;if(fa(t))if(s=t.length,i)for(r=s-1;r>=0;r--)n.call(e,t[r],r);else for(r=0;r<s;r++)n.call(e,t[r],r);else if(Po(t))for(c=Object.keys(t),s=c.length,r=0;r<s;r++)n.call(e,t[c[r]],c[r])}function L5(t,n){let e,i,r,s;if(!t||!n||t.length!==n.length)return!1;for(e=0,i=t.length;e<i;++e)if(r=t[e],s=n[e],r.datasetIndex!==s.datasetIndex||r.index!==s.index)return!1;return!0}function F5(t){if(fa(t))return t.map(F5);if(Po(t)){const n=Object.create(null),e=Object.keys(t),i=e.length;let r=0;for(;r<i;++r)n[e[r]]=F5(t[e[r]]);return n}return t}function GN(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function $he(t,n,e,i){if(!GN(t))return;const r=n[t],s=e[t];Po(r)&&Po(s)?Fk(r,s,i):n[t]=F5(s)}function Fk(t,n,e){const i=fa(n)?n:[n],r=i.length;if(!Po(t))return t;const s=(e=e||{}).merger||$he;let c;for(let f=0;f<r;++f){if(c=i[f],!Po(c))continue;const y=Object.keys(c);for(let k=0,E=y.length;k<E;++k)s(y[k],t,c,e)}return t}function zk(t,n){return Fk(t,n,{merger:Ghe})}function Ghe(t,n,e){if(!GN(t))return;const i=n[t],r=e[t];Po(i)&&Po(r)?zk(i,r):Object.prototype.hasOwnProperty.call(n,t)||(n[t]=F5(r))}const WN={"":t=>t,x:t=>t.x,y:t=>t.y};function $1(t,n){return(WN[n]||(WN[n]=function Zhe(t){const n=function Whe(t){const n=t.split("."),e=[];let i="";for(const r of n)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}(t);return e=>{for(const i of n){if(""===i)break;e=e&&e[i]}return e}}(n)))(t)}function $P(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Nk=t=>typeof t<"u",G1=t=>"function"==typeof t,ZN=(t,n)=>{if(t.size!==n.size)return!1;for(const e of t)if(!n.has(e))return!1;return!0},ma=Math.PI,ga=2*ma,Xhe=ga+ma,z5=Number.POSITIVE_INFINITY,Khe=ma/180,Al=ma/2,sy=ma/4,YN=2*ma/3,W1=Math.log10,jf=Math.sign;function Bk(t,n,e){return Math.abs(t-n)<e}function XN(t){const n=Math.round(t);t=Bk(t,n,t/1e3)?n:t;const e=Math.pow(10,Math.floor(W1(t))),i=t/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function ib(t){return!function Jhe(t){return"symbol"==typeof t||"object"==typeof t&&null!==t&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function KN(t,n,e){let i,r,s;for(i=0,r=t.length;i<r;i++)s=t[i][e],isNaN(s)||(n.min=Math.min(n.min,s),n.max=Math.max(n.max,s))}function Ap(t){return t*(ma/180)}function GP(t){return t*(180/ma)}function QN(t){if(!ul(t))return;let n=1,e=0;for(;Math.round(t*n)/n!==t;)n*=10,e++;return e}function JN(t,n){const e=n.x-t.x,i=n.y-t.y,r=Math.sqrt(e*e+i*i);let s=Math.atan2(i,e);return s<-.5*ma&&(s+=ga),{angle:s,distance:r}}function WP(t,n){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function tue(t,n){return(t-n+Xhe)%ga-ma}function Jh(t){return(t%ga+ga)%ga}function Vk(t,n,e,i){const r=Jh(t),s=Jh(n),c=Jh(e),f=Jh(s-r),y=Jh(c-r),k=Jh(r-s),E=Jh(r-c);return r===s||r===c||i&&s===c||f>y&&k<E}function Rc(t,n,e){return Math.max(n,Math.min(e,t))}function dg(t,n,e,i=1e-6){return t>=Math.min(n,e)-i&&t<=Math.max(n,e)+i}function ZP(t,n,e){e=e||(c=>t[c]<n);let s,i=t.length-1,r=0;for(;i-r>1;)s=r+i>>1,e(s)?r=s:i=s;return{lo:r,hi:i}}const hg=(t,n,e,i)=>ZP(t,e,i?r=>{const s=t[r][n];return s<e||s===e&&t[r+1][n]===e}:r=>t[r][n]<e),iue=(t,n,e)=>ZP(t,e,i=>t[i][n]>=e),eB=["push","pop","shift","splice","unshift"];function tB(t,n){const e=t._chartjs;if(!e)return;const i=e.listeners,r=i.indexOf(n);-1!==r&&i.splice(r,1),!(i.length>0)&&(eB.forEach(s=>{delete t[s]}),delete t._chartjs)}function nB(t){const n=new Set(t);return n.size===t.length?t:Array.from(n)}const iB=typeof window>"u"?function(t){return t()}:window.requestAnimationFrame;function rB(t,n){let e=[],i=!1;return function(...r){e=r,i||(i=!0,iB.call(window,()=>{i=!1,t.apply(n,e)}))}}const YP=t=>"start"===t?"left":"end"===t?"right":"center",Ed=(t,n,e)=>"start"===t?n:"end"===t?e:(n+e)/2;function oB(t,n,e){const i=n.length;let r=0,s=i;if(t._sorted){const{iScale:c,vScale:f,_parsed:y}=t,k=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,E=c.axis,{min:F,max:$,minDefined:W,maxDefined:re}=c.getUserBounds();if(W){if(r=Math.min(hg(y,E,F).lo,e?i:hg(n,E,c.getPixelForValue(F)).lo),k){const he=y.slice(0,r+1).reverse().findIndex(me=>!Mo(me[f.axis]));r-=Math.max(0,he)}r=Rc(r,0,i-1)}if(re){let he=Math.max(hg(y,c.axis,$,!0).hi+1,e?0:hg(n,E,c.getPixelForValue($),!0).hi+1);if(k){const me=y.slice(he-1).findIndex(Pe=>!Mo(Pe[f.axis]));he+=Math.max(0,me)}s=Rc(he,r,i)-r}else s=i-r}return{start:r,count:s}}function sB(t){const{xScale:n,yScale:e,_scaleRanges:i}=t,r={xmin:n.min,xmax:n.max,ymin:e.min,ymax:e.max};if(!i)return t._scaleRanges=r,!0;const s=i.xmin!==n.min||i.xmax!==n.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,r),s}const N5=t=>0===t||1===t,aB=(t,n,e)=>-Math.pow(2,10*(t-=1))*Math.sin((t-n)*ga/e),lB=(t,n,e)=>Math.pow(2,-10*t)*Math.sin((t-n)*ga/e)+1,jk={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*Al),easeOutSine:t=>Math.sin(t*Al),easeInOutSine:t=>-.5*(Math.cos(ma*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>N5(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>N5(t)?t:aB(t,.075,.3),easeOutElastic:t=>N5(t)?t:lB(t,.075,.3),easeInOutElastic:t=>N5(t)?t:t<.5?.5*aB(2*t,.1125,.45):.5+.5*lB(2*t-1,.1125,.45),easeInBack:t=>t*t*(2.70158*t-1.70158),easeOutBack:t=>(t-=1)*t*(2.70158*t+1.70158)+1,easeInOutBack(t){let n=1.70158;return(t/=.5)<1?t*t*((1+(n*=1.525))*t-n)*.5:.5*((t-=2)*t*((1+(n*=1.525))*t+n)+2)},easeInBounce:t=>1-jk.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?.5*jk.easeInBounce(2*t):.5*jk.easeOutBounce(2*t-1)+.5};function XP(t){if(t&&"object"==typeof t){const n=t.toString();return"[object CanvasPattern]"===n||"[object CanvasGradient]"===n}return!1}function cB(t){return XP(t)?t:new nb(t)}function KP(t){return XP(t)?t:new nb(t).saturate(.5).darken(.1).hexString()}const lue=["x","y","borderWidth","radius","tension"],cue=["color","borderColor","backgroundColor"],dB=new Map;function Hk(t,n,e){return function uue(t,n){n=n||{};const e=t+JSON.stringify(n);let i=dB.get(e);return i||(i=new Intl.NumberFormat(t,n),dB.set(e,i)),i}(n,e).format(t)}const hB={values:t=>fa(t)?t:""+t,numeric(t,n,e){if(0===t)return"0";const i=this.chart.options.locale;let r,s=t;if(e.length>1){const k=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(k<1e-4||k>1e15)&&(r="scientific"),s=function pue(t,n){let e=n.length>3?n[2].value-n[1].value:n[1].value-n[0].value;return Math.abs(e)>=1&&t!==Math.floor(t)&&(e=t-Math.floor(t)),e}(t,e)}const c=W1(Math.abs(s)),f=isNaN(c)?1:Math.max(Math.min(-1*Math.floor(c),20),0),y={notation:r,minimumFractionDigits:f,maximumFractionDigits:f};return Object.assign(y,this.options.ticks.format),Hk(t,i,y)},logarithmic(t,n,e){if(0===t)return"0";const i=e[n].significand||t/Math.pow(10,Math.floor(W1(t)));return[1,2,3,5,10,15].includes(i)||n>.8*e.length?hB.numeric.call(this,t,n,e):""}};var B5={formatters:hB};const ay=Object.create(null),QP=Object.create(null);function Uk(t,n){if(!n)return t;const e=n.split(".");for(let i=0,r=e.length;i<r;++i){const s=e[i];t=t[s]||(t[s]=Object.create(null))}return t}function JP(t,n,e){return"string"==typeof n?Fk(Uk(t,n),e):Fk(Uk(t,""),n)}class mue{constructor(n,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,r)=>KP(r.backgroundColor),this.hoverBorderColor=(i,r)=>KP(r.borderColor),this.hoverColor=(i,r)=>KP(r.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(n),this.apply(e)}set(n,e){return JP(this,n,e)}get(n){return Uk(this,n)}describe(n,e){return JP(QP,n,e)}override(n,e){return JP(ay,n,e)}route(n,e,i,r){const s=Uk(this,n),c=Uk(this,i),f="_"+e;Object.defineProperties(s,{[f]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const y=this[f],k=c[r];return Po(y)?Object.assign({},k,y):Zr(y,k)},set(y){this[f]=y}}})}apply(n){n.forEach(e=>e(this))}}var _a=new mue({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function due(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>"onProgress"!==n&&"onComplete"!==n&&"fn"!==n}),t.set("animations",{colors:{type:"color",properties:cue},numbers:{type:"number",properties:lue}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>0|n}}}})},function hue(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function fue(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,e)=>e.lineWidth,tickColor:(n,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:B5.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&"callback"!==n&&"parser"!==n,_indexable:n=>"borderDash"!==n&&"tickBorderDash"!==n&&"dash"!==n}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:n=>"backdropPadding"!==n&&"callback"!==n,_indexable:n=>"backdropPadding"!==n})}]);function V5(t,n,e,i,r){let s=n[r];return s||(s=n[r]=t.measureText(r).width,e.push(r)),s>i&&(i=s),i}function _ue(t,n,e,i){let r=(i=i||{}).data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==n&&(r=i.data={},s=i.garbageCollect=[],i.font=n),t.save(),t.font=n;let c=0;const f=e.length;let y,k,E,F,$;for(y=0;y<f;y++)if(F=e[y],null==F||fa(F)){if(fa(F))for(k=0,E=F.length;k<E;k++)$=F[k],null!=$&&!fa($)&&(c=V5(t,r,s,c,$))}else c=V5(t,r,s,c,F);t.restore();const W=s.length/2;if(W>e.length){for(y=0;y<W;y++)delete r[s[y]];s.splice(0,W)}return c}function ly(t,n,e){const i=t.currentDevicePixelRatio,r=0!==e?Math.max(e/2,.5):0;return Math.round((n-r)*i)/i+r}function uB(t,n){!n&&!t||((n=n||t.getContext("2d")).save(),n.resetTransform(),n.clearRect(0,0,t.width,t.height),n.restore())}function eI(t,n,e,i){pB(t,n,e,i,null)}function pB(t,n,e,i,r){let s,c,f,y,k,E,F,$;const W=n.pointStyle,re=n.rotation,he=n.radius;let me=(re||0)*Khe;if(W&&"object"==typeof W&&(s=W.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return t.save(),t.translate(e,i),t.rotate(me),t.drawImage(W,-W.width/2,-W.height/2,W.width,W.height),void t.restore();if(!(isNaN(he)||he<=0)){switch(t.beginPath(),W){default:r?t.ellipse(e,i,r/2,he,0,0,ga):t.arc(e,i,he,0,ga),t.closePath();break;case"triangle":E=r?r/2:he,t.moveTo(e+Math.sin(me)*E,i-Math.cos(me)*he),me+=YN,t.lineTo(e+Math.sin(me)*E,i-Math.cos(me)*he),me+=YN,t.lineTo(e+Math.sin(me)*E,i-Math.cos(me)*he),t.closePath();break;case"rectRounded":k=.516*he,y=he-k,c=Math.cos(me+sy)*y,F=Math.cos(me+sy)*(r?r/2-k:y),f=Math.sin(me+sy)*y,$=Math.sin(me+sy)*(r?r/2-k:y),t.arc(e-F,i-f,k,me-ma,me-Al),t.arc(e+$,i-c,k,me-Al,me),t.arc(e+F,i+f,k,me,me+Al),t.arc(e-$,i+c,k,me+Al,me+ma),t.closePath();break;case"rect":if(!re){y=Math.SQRT1_2*he,E=r?r/2:y,t.rect(e-E,i-y,2*E,2*y);break}me+=sy;case"rectRot":F=Math.cos(me)*(r?r/2:he),c=Math.cos(me)*he,f=Math.sin(me)*he,$=Math.sin(me)*(r?r/2:he),t.moveTo(e-F,i-f),t.lineTo(e+$,i-c),t.lineTo(e+F,i+f),t.lineTo(e-$,i+c),t.closePath();break;case"crossRot":me+=sy;case"cross":F=Math.cos(me)*(r?r/2:he),c=Math.cos(me)*he,f=Math.sin(me)*he,$=Math.sin(me)*(r?r/2:he),t.moveTo(e-F,i-f),t.lineTo(e+F,i+f),t.moveTo(e+$,i-c),t.lineTo(e-$,i+c);break;case"star":F=Math.cos(me)*(r?r/2:he),c=Math.cos(me)*he,f=Math.sin(me)*he,$=Math.sin(me)*(r?r/2:he),t.moveTo(e-F,i-f),t.lineTo(e+F,i+f),t.moveTo(e+$,i-c),t.lineTo(e-$,i+c),me+=sy,F=Math.cos(me)*(r?r/2:he),c=Math.cos(me)*he,f=Math.sin(me)*he,$=Math.sin(me)*(r?r/2:he),t.moveTo(e-F,i-f),t.lineTo(e+F,i+f),t.moveTo(e+$,i-c),t.lineTo(e-$,i+c);break;case"line":c=r?r/2:Math.cos(me)*he,f=Math.sin(me)*he,t.moveTo(e-c,i-f),t.lineTo(e+c,i+f);break;case"dash":t.moveTo(e,i),t.lineTo(e+Math.cos(me)*(r?r/2:he),i+Math.sin(me)*he);break;case!1:t.closePath()}t.fill(),n.borderWidth>0&&t.stroke()}}function ug(t,n,e){return e=e||.5,!n||t&&t.x>n.left-e&&t.x<n.right+e&&t.y>n.top-e&&t.y<n.bottom+e}function j5(t,n){t.save(),t.beginPath(),t.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),t.clip()}function H5(t){t.restore()}function yue(t,n,e,i,r){if(!n)return t.lineTo(e.x,e.y);if("middle"===r){const s=(n.x+e.x)/2;t.lineTo(s,n.y),t.lineTo(s,e.y)}else"after"===r!=!!i?t.lineTo(n.x,e.y):t.lineTo(e.x,n.y);t.lineTo(e.x,e.y)}function vue(t,n,e,i){if(!n)return t.lineTo(e.x,e.y);t.bezierCurveTo(i?n.cp1x:n.cp2x,i?n.cp1y:n.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function xue(t,n,e,i,r){if(r.strikethrough||r.underline){const s=t.measureText(i),c=n-s.actualBoundingBoxLeft,f=n+s.actualBoundingBoxRight,k=e+s.actualBoundingBoxDescent,E=r.strikethrough?(e-s.actualBoundingBoxAscent+k)/2:k;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(c,E),t.lineTo(f,E),t.stroke()}}function wue(t,n){const e=t.fillStyle;t.fillStyle=n.color,t.fillRect(n.left,n.top,n.width,n.height),t.fillStyle=e}function cy(t,n,e,i,r,s={}){const c=fa(n)?n:[n],f=s.strokeWidth>0&&""!==s.strokeColor;let y,k;for(t.save(),t.font=r.string,function bue(t,n){n.translation&&t.translate(n.translation[0],n.translation[1]),Mo(n.rotation)||t.rotate(n.rotation),n.color&&(t.fillStyle=n.color),n.textAlign&&(t.textAlign=n.textAlign),n.textBaseline&&(t.textBaseline=n.textBaseline)}(t,s),y=0;y<c.length;++y)k=c[y],s.backdrop&&wue(t,s.backdrop),f&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),Mo(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(k,e,i,s.maxWidth)),t.fillText(k,e,i,s.maxWidth),xue(t,e,i,k,s),i+=Number(r.lineHeight);t.restore()}function qk(t,n){const{x:e,y:i,w:r,h:s,radius:c}=n;t.arc(e+c.topLeft,i+c.topLeft,c.topLeft,1.5*ma,ma,!0),t.lineTo(e,i+s-c.bottomLeft),t.arc(e+c.bottomLeft,i+s-c.bottomLeft,c.bottomLeft,ma,Al,!0),t.lineTo(e+r-c.bottomRight,i+s),t.arc(e+r-c.bottomRight,i+s-c.bottomRight,c.bottomRight,Al,0,!0),t.lineTo(e+r,i+c.topRight),t.arc(e+r-c.topRight,i+c.topRight,c.topRight,0,-Al,!0),t.lineTo(e+c.topLeft,i)}const kue=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Mue=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Cue(t,n){const e=(""+t).match(kue);if(!e||"normal"===e[1])return 1.2*n;switch(t=+e[2],e[3]){case"px":return t;case"%":t/=100}return n*t}const Sue=t=>+t||0;function tI(t,n){const e={},i=Po(n),r=i?Object.keys(n):n,s=Po(t)?i?c=>Zr(t[c],t[n[c]]):c=>t[c]:()=>t;for(const c of r)e[c]=Sue(s(c));return e}function fB(t){return tI(t,{top:"y",right:"x",bottom:"y",left:"x"})}function dy(t){return tI(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Dd(t){const n=fB(t);return n.width=n.left+n.right,n.height=n.top+n.bottom,n}function lc(t,n){let e=Zr((t=t||{}).size,(n=n||_a.font).size);"string"==typeof e&&(e=parseInt(e,10));let i=Zr(t.style,n.style);i&&!(""+i).match(Mue)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const r={family:Zr(t.family,n.family),lineHeight:Cue(Zr(t.lineHeight,n.lineHeight),e),size:e,style:i,weight:Zr(t.weight,n.weight),string:""};return r.string=function gue(t){return!t||Mo(t.size)||Mo(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function $k(t,n,e,i){let s,c,f,r=!0;for(s=0,c=t.length;s<c;++s)if(f=t[s],void 0!==f&&(void 0!==n&&"function"==typeof f&&(f=f(n),r=!1),void 0!==e&&fa(f)&&(f=f[e%f.length],r=!1),void 0!==f))return i&&!r&&(i.cacheable=!1),f}function Z1(t,n){return Object.assign(Object.create(t),n)}function nI(t,n=[""],e,i,r=(()=>t[0])){const s=e||t;typeof i>"u"&&(i=vB("_fallback",t));const c={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:s,_fallback:i,_getTarget:r,override:f=>nI([f,...t],n,s,i)};return new Proxy(c,{deleteProperty:(f,y)=>(delete f[y],delete f._keys,delete t[0][y],!0),get:(f,y)=>gB(f,y,()=>function Lue(t,n,e,i){let r;for(const s of n)if(r=vB(Due(s,t),e),typeof r<"u")return iI(t,r)?rI(e,i,t,r):r}(y,n,t,f)),getOwnPropertyDescriptor:(f,y)=>Reflect.getOwnPropertyDescriptor(f._scopes[0],y),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(f,y)=>bB(f).includes(y),ownKeys:f=>bB(f),set(f,y,k){const E=f._storage||(f._storage=r());return f[y]=E[y]=k,delete f._keys,!0}})}function rb(t,n,e,i){const r={_cacheable:!1,_proxy:t,_context:n,_subProxy:e,_stack:new Set,_descriptors:mB(t,i),setContext:s=>rb(t,s,e,i),override:s=>rb(t.override(s),n,e,i)};return new Proxy(r,{deleteProperty:(s,c)=>(delete s[c],delete t[c],!0),get:(s,c,f)=>gB(s,c,()=>function Tue(t,n,e){const{_proxy:i,_context:r,_subProxy:s,_descriptors:c}=t;let f=i[n];return G1(f)&&c.isScriptable(n)&&(f=function Aue(t,n,e,i){const{_proxy:r,_context:s,_subProxy:c,_stack:f}=e;if(f.has(t))throw new Error("Recursion detected: "+Array.from(f).join("->")+"->"+t);f.add(t);let y=n(s,c||i);return f.delete(t),iI(t,y)&&(y=rI(r._scopes,r,t,y)),y}(n,f,t,e)),fa(f)&&f.length&&(f=function Pue(t,n,e,i){const{_proxy:r,_context:s,_subProxy:c,_descriptors:f}=e;if(typeof s.index<"u"&&i(t))return n[s.index%n.length];if(Po(n[0])){const y=n,k=r._scopes.filter(E=>E!==y);n=[];for(const E of y){const F=rI(k,r,t,E);n.push(rb(F,s,c&&c[t],f))}}return n}(n,f,t,c.isIndexable)),iI(n,f)&&(f=rb(f,r,s&&s[n],c)),f}(s,c,f)),getOwnPropertyDescriptor:(s,c)=>s._descriptors.allKeys?Reflect.has(t,c)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,c),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(s,c)=>Reflect.has(t,c),ownKeys:()=>Reflect.ownKeys(t),set:(s,c,f)=>(t[c]=f,delete s[c],!0)})}function mB(t,n={scriptable:!0,indexable:!0}){const{_scriptable:e=n.scriptable,_indexable:i=n.indexable,_allKeys:r=n.allKeys}=t;return{allKeys:r,scriptable:e,indexable:i,isScriptable:G1(e)?e:()=>e,isIndexable:G1(i)?i:()=>i}}const Due=(t,n)=>t?t+$P(n):n,iI=(t,n)=>Po(n)&&"adapters"!==t&&(null===Object.getPrototypeOf(n)||n.constructor===Object);function gB(t,n,e){if(Object.prototype.hasOwnProperty.call(t,n)||"constructor"===n)return t[n];const i=e();return t[n]=i,i}function _B(t,n,e){return G1(t)?t(n,e):t}const Iue=(t,n)=>!0===t?n:"string"==typeof t?$1(n,t):void 0;function Oue(t,n,e,i,r){for(const s of n){const c=Iue(e,s);if(c){t.add(c);const f=_B(c._fallback,e,r);if(typeof f<"u"&&f!==e&&f!==i)return f}else if(!1===c&&typeof i<"u"&&e!==i)return null}return!1}function rI(t,n,e,i){const r=n._rootScopes,s=_B(n._fallback,e,i),c=[...t,...r],f=new Set;f.add(i);let y=yB(f,c,e,s||e,i);return!(null===y||typeof s<"u"&&s!==e&&(y=yB(f,c,s,y,i),null===y))&&nI(Array.from(f),[""],r,s,()=>function Rue(t,n,e){const i=t._getTarget();n in i||(i[n]={});const r=i[n];return fa(r)&&Po(e)?e:r||{}}(n,e,i))}function yB(t,n,e,i,r){for(;e;)e=Oue(t,n,e,i,r);return e}function vB(t,n){for(const e of n){if(!e)continue;const i=e[t];if(typeof i<"u")return i}}function bB(t){let n=t._keys;return n||(n=t._keys=function Fue(t){const n=new Set;for(const e of t)for(const i of Object.keys(e).filter(r=>!r.startsWith("_")))n.add(i);return Array.from(n)}(t._scopes)),n}function xB(t,n,e,i){const{iScale:r}=t,{key:s="r"}=this._parsing,c=new Array(i);let f,y,k,E;for(f=0,y=i;f<y;++f)k=f+e,E=n[k],c[f]={r:r.parse($1(E,s),k)};return c}const zue=Number.EPSILON||1e-14,ob=(t,n)=>n<t.length&&!t[n].skip&&t[n],wB=t=>"x"===t?"y":"x";function Nue(t,n,e,i){const r=t.skip?n:t,s=n,c=e.skip?n:e,f=WP(s,r),y=WP(c,s);let k=f/(f+y),E=y/(f+y);k=isNaN(k)?0:k,E=isNaN(E)?0:E;const F=i*k,$=i*E;return{previous:{x:s.x-F*(c.x-r.x),y:s.y-F*(c.y-r.y)},next:{x:s.x+$*(c.x-r.x),y:s.y+$*(c.y-r.y)}}}function U5(t,n,e){return Math.max(Math.min(t,e),n)}function Uue(t,n,e,i,r){let s,c,f,y;if(n.spanGaps&&(t=t.filter(k=>!k.skip)),"monotone"===n.cubicInterpolationMode)!function jue(t,n="x"){const e=wB(n),i=t.length,r=Array(i).fill(0),s=Array(i);let c,f,y,k=ob(t,0);for(c=0;c<i;++c)if(f=y,y=k,k=ob(t,c+1),y){if(k){const E=k[n]-y[n];r[c]=0!==E?(k[e]-y[e])/E:0}s[c]=f?k?jf(r[c-1])!==jf(r[c])?0:(r[c-1]+r[c])/2:r[c-1]:r[c]}(function Bue(t,n,e){const i=t.length;let r,s,c,f,y,k=ob(t,0);for(let E=0;E<i-1;++E)if(y=k,k=ob(t,E+1),y&&k){if(Bk(n[E],0,zue)){e[E]=e[E+1]=0;continue}r=e[E]/n[E],s=e[E+1]/n[E],f=Math.pow(r,2)+Math.pow(s,2),!(f<=9)&&(c=3/Math.sqrt(f),e[E]=r*c*n[E],e[E+1]=s*c*n[E])}})(t,r,s),function Vue(t,n,e="x"){const i=wB(e),r=t.length;let s,c,f,y=ob(t,0);for(let k=0;k<r;++k){if(c=f,f=y,y=ob(t,k+1),!f)continue;const E=f[e],F=f[i];c&&(s=(E-c[e])/3,f[`cp1${e}`]=E-s,f[`cp1${i}`]=F-s*n[k]),y&&(s=(y[e]-E)/3,f[`cp2${e}`]=E+s,f[`cp2${i}`]=F+s*n[k])}}(t,s,n)}(t,r);else{let k=i?t[t.length-1]:t[0];for(s=0,c=t.length;s<c;++s)f=t[s],y=Nue(k,f,t[Math.min(s+1,c-(i?0:1))%c],n.tension),f.cp1x=y.previous.x,f.cp1y=y.previous.y,f.cp2x=y.next.x,f.cp2y=y.next.y,k=f}n.capBezierPoints&&function Hue(t,n){let e,i,r,s,c,f=ug(t[0],n);for(e=0,i=t.length;e<i;++e)c=s,s=f,f=e<i-1&&ug(t[e+1],n),s&&(r=t[e],c&&(r.cp1x=U5(r.cp1x,n.left,n.right),r.cp1y=U5(r.cp1y,n.top,n.bottom)),f&&(r.cp2x=U5(r.cp2x,n.left,n.right),r.cp2y=U5(r.cp2y,n.top,n.bottom)))}(t,e)}function oI(){return typeof window<"u"&&typeof document<"u"}function sI(t){let n=t.parentNode;return n&&"[object ShadowRoot]"===n.toString()&&(n=n.host),n}function q5(t,n,e){let i;return"string"==typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*n.parentNode[e])):i=t,i}const $5=t=>t.ownerDocument.defaultView.getComputedStyle(t,null),$ue=["top","right","bottom","left"];function hy(t,n,e){const i={};e=e?"-"+e:"";for(let r=0;r<4;r++){const s=$ue[r];i[s]=parseFloat(t[n+"-"+s+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Gue=(t,n,e)=>(t>0||n>0)&&(!e||!e.shadowRoot);function uy(t,n){if("native"in t)return t;const{canvas:e,currentDevicePixelRatio:i}=n,r=$5(e),s="border-box"===r.boxSizing,c=hy(r,"padding"),f=hy(r,"border","width"),{x:y,y:k,box:E}=function Wue(t,n){const e=t.touches,i=e&&e.length?e[0]:t,{offsetX:r,offsetY:s}=i;let f,y,c=!1;if(Gue(r,s,t.target))f=r,y=s;else{const k=n.getBoundingClientRect();f=i.clientX-k.left,y=i.clientY-k.top,c=!0}return{x:f,y,box:c}}(t,e),F=c.left+(E&&f.left),$=c.top+(E&&f.top);let{width:W,height:re}=n;return s&&(W-=c.width+f.width,re-=c.height+f.height),{x:Math.round((y-F)/W*e.width/i),y:Math.round((k-$)/re*e.height/i)}}const G5=t=>Math.round(10*t)/10;function kB(t,n,e){const i=n||1,r=Math.floor(t.height*i),s=Math.floor(t.width*i);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const c=t.canvas;return c.style&&(e||!c.style.height&&!c.style.width)&&(c.style.height=`${t.height}px`,c.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==i||c.height!==r||c.width!==s)&&(t.currentDevicePixelRatio=i,c.height=r,c.width=s,t.ctx.setTransform(i,0,0,i,0,0),!0)}const Xue=function(){let t=!1;try{const n={get passive(){return t=!0,!1}};oI()&&(window.addEventListener("test",null,n),window.removeEventListener("test",null,n))}catch{}return t}();function MB(t,n){const e=function que(t,n){return $5(t).getPropertyValue(n)}(t,n),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function py(t,n,e,i){return{x:t.x+e*(n.x-t.x),y:t.y+e*(n.y-t.y)}}function Kue(t,n,e,i){return{x:t.x+e*(n.x-t.x),y:"middle"===i?e<.5?t.y:n.y:"after"===i?e<1?t.y:n.y:e>0?n.y:t.y}}function Que(t,n,e,i){const r={x:t.cp2x,y:t.cp2y},s={x:n.cp1x,y:n.cp1y},c=py(t,r,e),f=py(r,s,e),y=py(s,n,e),k=py(c,f,e),E=py(f,y,e);return py(k,E,e)}function sb(t,n,e){return t?function(t,n){return{x:e=>t+t+n-e,setWidth(e){n=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,i)=>e-i,leftForLtr:(e,i)=>e-i}}(n,e):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,n)=>t+n,leftForLtr:(t,n)=>t}}function CB(t,n){let e,i;("ltr"===n||"rtl"===n)&&(e=t.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",n,"important"),t.prevTextDirection=i)}function SB(t,n){void 0!==n&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",n[0],n[1]))}function EB(t){return"angle"===t?{between:Vk,compare:tue,normalize:Jh}:{between:dg,compare:(n,e)=>n-e,normalize:n=>n}}function DB({start:t,end:n,count:e,loop:i,style:r}){return{start:t%e,end:n%e,loop:i&&(n-t+1)%e==0,style:r}}function TB(t,n,e){if(!e)return[t];const{property:i,start:r,end:s}=e,c=n.length,{compare:f,between:y,normalize:k}=EB(i),{start:E,end:F,loop:$,style:W}=function tpe(t,n,e){const{property:i,start:r,end:s}=e,{between:c,normalize:f}=EB(i),y=n.length;let $,W,{start:k,end:E,loop:F}=t;if(F){for(k+=y,E+=y,$=0,W=y;$<W&&c(f(n[k%y][i]),r,s);++$)k--,E--;k%=y,E%=y}return E<k&&(E+=y),{start:k,end:E,loop:F,style:t.style}}(t,n,e),re=[];let Pe,Re,rt,he=!1,me=null;for(let Qt=E,Vn=E;Qt<=F;++Qt)Re=n[Qt%c],!Re.skip&&(Pe=k(Re[i]),Pe!==rt&&(he=y(Pe,r,s),null===me&&(he||y(r,rt,Pe)&&0!==f(r,rt))&&(me=0===f(Pe,r)?Qt:Vn),null!==me&&(!he||0===f(s,Pe)||y(s,rt,Pe))&&(re.push(DB({start:me,end:Qt,loop:$,count:c,style:W})),me=null),Vn=Qt,rt=Pe));return null!==me&&re.push(DB({start:me,end:F,loop:$,count:c,style:W})),re}function AB(t,n){const e=[],i=t.segments;for(let r=0;r<i.length;r++){const s=TB(i[r],t.points,n);s.length&&e.push(...s)}return e}function IB(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function spe(t,n){if(!n)return!1;const e=[],i=function(r,s){return XP(s)?(e.includes(s)||e.push(s),e.indexOf(s)):s};return JSON.stringify(t,i)!==JSON.stringify(n,i)}function W5(t,n,e){return t.options.clip?t[e]:n[e]}function OB(t,n){const e=n._clip;if(e.disabled)return!1;const i=function ape(t,n){const{xScale:e,yScale:i}=t;return e&&i?{left:W5(e,n,"left"),right:W5(e,n,"right"),top:W5(i,n,"top"),bottom:W5(i,n,"bottom")}:n}(n,t.chartArea);return{left:!1===e.left?0:i.left-(!0===e.left?0:e.left),right:!1===e.right?t.width:i.right+(!0===e.right?0:e.right),top:!1===e.top?0:i.top-(!0===e.top?0:e.top),bottom:!1===e.bottom?t.height:i.bottom+(!0===e.bottom?0:e.bottom)}}class lpe{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(n,e,i,r){const c=e.duration;e.listeners[r].forEach(f=>f({chart:n,initial:e.initial,numSteps:c,currentStep:Math.min(i-e.start,c)}))}_refresh(){this._request||(this._running=!0,this._request=iB.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(n=Date.now()){let e=0;this._charts.forEach((i,r)=>{if(!i.running||!i.items.length)return;const s=i.items;let y,c=s.length-1,f=!1;for(;c>=0;--c)y=s[c],y._active?(y._total>i.duration&&(i.duration=y._total),y.tick(n),f=!0):(s[c]=s[s.length-1],s.pop());f&&(r.draw(),this._notify(r,i,n,"progress")),s.length||(i.running=!1,this._notify(r,i,n,"complete"),i.initial=!1),e+=s.length}),this._lastDate=n,0===e&&(this._running=!1)}_getAnims(n){const e=this._charts;let i=e.get(n);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(n,i)),i}listen(n,e,i){this._getAnims(n).listeners[e].push(i)}add(n,e){!e||!e.length||this._getAnims(n).items.push(...e)}has(n){return this._getAnims(n).items.length>0}start(n){const e=this._charts.get(n);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,r)=>Math.max(i,r._duration),0),this._refresh())}running(n){if(!this._running)return!1;const e=this._charts.get(n);return!(!e||!e.running||!e.items.length)}stop(n){const e=this._charts.get(n);if(!e||!e.items.length)return;const i=e.items;let r=i.length-1;for(;r>=0;--r)i[r].cancel();e.items=[],this._notify(n,e,Date.now(),"complete")}remove(n){return this._charts.delete(n)}}var pg=new lpe;const RB="transparent",cpe={boolean:(t,n,e)=>e>.5?n:t,color(t,n,e){const i=cB(t||RB),r=i.valid&&cB(n||RB);return r&&r.valid?r.mix(i,e).hexString():n},number:(t,n,e)=>t+(n-t)*e};class dpe{constructor(n,e,i,r){const s=e[i];r=$k([n.to,r,s,n.from]);const c=$k([n.from,s,r]);this._active=!0,this._fn=n.fn||cpe[n.type||typeof c],this._easing=jk[n.easing]||jk.linear,this._start=Math.floor(Date.now()+(n.delay||0)),this._duration=this._total=Math.floor(n.duration),this._loop=!!n.loop,this._target=e,this._prop=i,this._from=c,this._to=r,this._promises=void 0}active(){return this._active}update(n,e,i){if(this._active){this._notify(!1);const r=this._target[this._prop],s=i-this._start,c=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(c,n.duration)),this._total+=s,this._loop=!!n.loop,this._to=$k([n.to,e,r,n.from]),this._from=$k([n.from,r,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(n){const e=n-this._start,i=this._duration,r=this._prop,s=this._from,c=this._loop,f=this._to;let y;if(this._active=s!==f&&(c||e<i),!this._active)return this._target[r]=f,void this._notify(!0);e<0?this._target[r]=s:(y=e/i%2,y=c&&y>1?2-y:y,y=this._easing(Math.min(1,Math.max(0,y))),this._target[r]=this._fn(s,f,y))}wait(){const n=this._promises||(this._promises=[]);return new Promise((e,i)=>{n.push({res:e,rej:i})})}_notify(n){const e=n?"res":"rej",i=this._promises||[];for(let r=0;r<i.length;r++)i[r][e]()}}class LB{constructor(n,e){this._chart=n,this._properties=new Map,this.configure(e)}configure(n){if(!Po(n))return;const e=Object.keys(_a.animation),i=this._properties;Object.getOwnPropertyNames(n).forEach(r=>{const s=n[r];if(!Po(s))return;const c={};for(const f of e)c[f]=s[f];(fa(s.properties)&&s.properties||[r]).forEach(f=>{(f===r||!i.has(f))&&i.set(f,c)})})}_animateOptions(n,e){const i=e.options,r=function upe(t,n){if(!n)return;let e=t.options;if(e)return e.$shared&&(t.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e;t.options=n}(n,i);if(!r)return[];const s=this._createAnimations(r,i);return i.$shared&&function hpe(t,n){const e=[],i=Object.keys(n);for(let r=0;r<i.length;r++){const s=t[i[r]];s&&s.active()&&e.push(s.wait())}return Promise.all(e)}(n.options.$animations,i).then(()=>{n.options=i},()=>{}),s}_createAnimations(n,e){const i=this._properties,r=[],s=n.$animations||(n.$animations={}),c=Object.keys(e),f=Date.now();let y;for(y=c.length-1;y>=0;--y){const k=c[y];if("$"===k.charAt(0))continue;if("options"===k){r.push(...this._animateOptions(n,e));continue}const E=e[k];let F=s[k];const $=i.get(k);if(F){if($&&F.active()){F.update($,E,f);continue}F.cancel()}$&&$.duration?(s[k]=F=new dpe($,n,k,E),r.push(F)):n[k]=E}return r}update(n,e){if(0===this._properties.size)return void Object.assign(n,e);const i=this._createAnimations(n,e);return i.length?(pg.add(this._chart,i),!0):void 0}}function FB(t,n){const e=t&&t.options||{},i=e.reverse,r=void 0===e.min?n:0,s=void 0===e.max?n:0;return{start:i?s:r,end:i?r:s}}function zB(t,n){const e=[],i=t._getSortedDatasetMetas(n);let r,s;for(r=0,s=i.length;r<s;++r)e.push(i[r].index);return e}function NB(t,n,e,i={}){const r=t.keys,s="single"===i.mode;let c,f,y,k;if(null===n)return;let E=!1;for(c=0,f=r.length;c<f;++c){if(y=+r[c],y===e){if(E=!0,i.all)continue;break}k=t.values[y],ul(k)&&(s||0===n||jf(n)===jf(k))&&(n+=k)}return E||i.all?n:0}function aI(t,n){const e=t&&t.options.stacked;return e||void 0===e&&void 0!==n.stack}function ype(t,n,e){const i=t[n]||(t[n]={});return i[e]||(i[e]={})}function BB(t,n,e,i){for(const r of n.getMatchingVisibleMetas(i).reverse()){const s=t[r.index];if(e&&s>0||!e&&s<0)return r.index}return null}function VB(t,n){const{chart:e,_cachedMeta:i}=t,r=e._stacks||(e._stacks={}),{iScale:s,vScale:c,index:f}=i,y=s.axis,k=c.axis,E=function gpe(t,n,e){return`${t.id}.${n.id}.${e.stack||e.type}`}(s,c,i),F=n.length;let $;for(let W=0;W<F;++W){const re=n[W],{[y]:he,[k]:me}=re;$=(re._stacks||(re._stacks={}))[k]=ype(r,E,he),$[f]=me,$._top=BB($,c,!0,i.type),$._bottom=BB($,c,!1,i.type),($._visualValues||($._visualValues={}))[f]=me}}function lI(t,n){const e=t.scales;return Object.keys(e).filter(i=>e[i].axis===n).shift()}function Gk(t,n){const e=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){n=n||t._parsed;for(const r of n){const s=r._stacks;if(!s||void 0===s[i]||void 0===s[i][e])return;delete s[i][e],void 0!==s[i]._visualValues&&void 0!==s[i]._visualValues[e]&&delete s[i]._visualValues[e]}}}const cI=t=>"reset"===t||"none"===t,jB=(t,n)=>n?t:Object.assign({},t);let Y1=(()=>class t{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,i){this.chart=e,this._ctx=e.ctx,this.index=i,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=aI(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Gk(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,i=this._cachedMeta,r=this.getDataset(),s=($,W,re,he)=>"x"===$?W:"r"===$?he:re,c=i.xAxisID=Zr(r.xAxisID,lI(e,"x")),f=i.yAxisID=Zr(r.yAxisID,lI(e,"y")),y=i.rAxisID=Zr(r.rAxisID,lI(e,"r")),k=i.indexAxis,E=i.iAxisID=s(k,c,f,y),F=i.vAxisID=s(k,f,c,y);i.xScale=this.getScaleForId(c),i.yScale=this.getScaleForId(f),i.rScale=this.getScaleForId(y),i.iScale=this.getScaleForId(E),i.vScale=this.getScaleForId(F)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const i=this._cachedMeta;return e===i.iScale?i.vScale:i.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&tB(this._data,this),e._stacked&&Gk(e)}_dataCheck(){const e=this.getDataset(),i=e.data||(e.data=[]),r=this._data;if(Po(i))this._data=function mpe(t,n){const{iScale:e,vScale:i}=n,r="x"===e.axis?"x":"y",s="x"===i.axis?"x":"y",c=Object.keys(t),f=new Array(c.length);let y,k,E;for(y=0,k=c.length;y<k;++y)E=c[y],f[y]={[r]:E,[s]:t[E]};return f}(i,this._cachedMeta);else if(r!==i){if(r){tB(r,this);const s=this._cachedMeta;Gk(s),s._parsed=[]}i&&Object.isExtensible(i)&&function oue(t,n){t._chartjs?t._chartjs.listeners.push(n):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[n]}}),eB.forEach(e=>{const i="_onData"+$P(e),r=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...s){const c=r.apply(this,s);return t._chartjs.listeners.forEach(f=>{"function"==typeof f[i]&&f[i](...s)}),c}})}))}(i,this),this._syncList=[],this._data=i}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const i=this._cachedMeta,r=this.getDataset();let s=!1;this._dataCheck();const c=i._stacked;i._stacked=aI(i.vScale,i),i.stack!==r.stack&&(s=!0,Gk(i),i.stack=r.stack),this._resyncElements(e),(s||c!==i._stacked)&&(VB(this,i._parsed),i._stacked=aI(i.vScale,i))}configure(){const e=this.chart.config,i=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),i,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,i){const{_cachedMeta:r,_data:s}=this,{iScale:c,_stacked:f}=r,y=c.axis;let F,$,W,k=0===e&&i===s.length||r._sorted,E=e>0&&r._parsed[e-1];if(!1===this._parsing)r._parsed=s,r._sorted=!0,W=s;else{W=fa(s[e])?this.parseArrayData(r,s,e,i):Po(s[e])?this.parseObjectData(r,s,e,i):this.parsePrimitiveData(r,s,e,i);const re=()=>null===$[y]||E&&$[y]<E[y];for(F=0;F<i;++F)r._parsed[F+e]=$=W[F],k&&(re()&&(k=!1),E=$);r._sorted=k}f&&VB(this,W)}parsePrimitiveData(e,i,r,s){const{iScale:c,vScale:f}=e,y=c.axis,k=f.axis,E=c.getLabels(),F=c===f,$=new Array(s);let W,re,he;for(W=0,re=s;W<re;++W)he=W+r,$[W]={[y]:F||c.parse(E[he],he),[k]:f.parse(i[he],he)};return $}parseArrayData(e,i,r,s){const{xScale:c,yScale:f}=e,y=new Array(s);let k,E,F,$;for(k=0,E=s;k<E;++k)F=k+r,$=i[F],y[k]={x:c.parse($[0],F),y:f.parse($[1],F)};return y}parseObjectData(e,i,r,s){const{xScale:c,yScale:f}=e,{xAxisKey:y="x",yAxisKey:k="y"}=this._parsing,E=new Array(s);let F,$,W,re;for(F=0,$=s;F<$;++F)W=F+r,re=i[W],E[F]={x:c.parse($1(re,y),W),y:f.parse($1(re,k),W)};return E}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,i,r){const c=this._cachedMeta,f=i[e.axis];return NB({keys:zB(this.chart,!0),values:i._stacks[e.axis]._visualValues},f,c.index,{mode:r})}updateRangeFromParsed(e,i,r,s){const c=r[i.axis];let f=null===c?NaN:c;const y=s&&r._stacks[i.axis];s&&y&&(s.values=y,f=NB(s,c,this._cachedMeta.index)),e.min=Math.min(e.min,f),e.max=Math.max(e.max,f)}getMinMax(e,i){const r=this._cachedMeta,s=r._parsed,c=r._sorted&&e===r.iScale,f=s.length,y=this._getOtherScale(e),k=((t,n,e)=>t&&!n.hidden&&n._stacked&&{keys:zB(this.chart,!0),values:null})(i,r),E={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:F,max:$}=function _pe(t){const{min:n,max:e,minDefined:i,maxDefined:r}=t.getUserBounds();return{min:i?n:Number.NEGATIVE_INFINITY,max:r?e:Number.POSITIVE_INFINITY}}(y);let W,re;function he(){re=s[W];const me=re[y.axis];return!ul(re[e.axis])||F>me||$<me}for(W=0;W<f&&(he()||(this.updateRangeFromParsed(E,e,re,k),!c));++W);if(c)for(W=f-1;W>=0;--W)if(!he()){this.updateRangeFromParsed(E,e,re,k);break}return E}getAllParsedValues(e){const i=this._cachedMeta._parsed,r=[];let s,c,f;for(s=0,c=i.length;s<c;++s)f=i[s][e.axis],ul(f)&&r.push(f);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const i=this._cachedMeta,r=i.iScale,s=i.vScale,c=this.getParsed(e);return{label:r?""+r.getLabelForValue(c[r.axis]):"",value:s?""+s.getLabelForValue(c[s.axis]):""}}_update(e){const i=this._cachedMeta;this.update(e||"default"),i._clip=function fpe(t){let n,e,i,r;return Po(t)?(n=t.top,e=t.right,i=t.bottom,r=t.left):n=e=i=r=t,{top:n,right:e,bottom:i,left:r,disabled:!1===t}}(Zr(this.options.clip,function ppe(t,n,e){if(!1===e)return!1;const i=FB(t,e),r=FB(n,e);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(i.xScale,i.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,r=this._cachedMeta,s=r.data||[],c=this.chart.chartArea,f=[],y=this._drawStart||0,k=this._drawCount||s.length-y,E=this.options.drawActiveElementsOnTop;let F;for(r.dataset&&r.dataset.draw(e,c,y,k),F=y;F<y+k;++F){const $=s[F];$.hidden||($.active&&E?f.push($):$.draw(e,c))}for(F=0;F<f.length;++F)f[F].draw(e,c)}getStyle(e,i){const r=i?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,i,r){const s=this.getDataset();let c;if(e>=0&&e<this._cachedMeta.data.length){const f=this._cachedMeta.data[e];c=f.$context||(f.$context=function bpe(t,n,e){return Z1(t,{active:!1,dataIndex:n,parsed:void 0,raw:void 0,element:e,index:n,mode:"default",type:"data"})}(this.getContext(),e,f)),c.parsed=this.getParsed(e),c.raw=s.data[e],c.index=c.dataIndex=e}else c=this.$context||(this.$context=function vpe(t,n){return Z1(t,{active:!1,dataset:void 0,datasetIndex:n,index:n,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),c.dataset=s,c.index=c.datasetIndex=this.index;return c.active=!!i,c.mode=r,c}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,i){return this._resolveElementOptions(this.dataElementType.id,i,e)}_resolveElementOptions(e,i="default",r){const s="active"===i,c=this._cachedDataOpts,f=e+"-"+i,y=c[f],k=this.enableOptionSharing&&Nk(r);if(y)return jB(y,k);const E=this.chart.config,F=E.datasetElementScopeKeys(this._type,e),$=s?[`${e}Hover`,"hover",e,""]:[e,""],W=E.getOptionScopes(this.getDataset(),F),re=Object.keys(_a.elements[e]),me=E.resolveNamedOptions(W,re,()=>this.getContext(r,s,i),$);return me.$shared&&(me.$shared=k,c[f]=Object.freeze(jB(me,k))),me}_resolveAnimations(e,i,r){const s=this.chart,c=this._cachedDataOpts,f=`animation-${i}`,y=c[f];if(y)return y;let k;if(!1!==s.options.animation){const F=this.chart.config,$=F.datasetAnimationScopeKeys(this._type,i),W=F.getOptionScopes(this.getDataset(),$);k=F.createResolver(W,this.getContext(e,r,i))}const E=new LB(s,k&&k.animations);return k&&k._cacheable&&(c[f]=Object.freeze(E)),E}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,i){return!i||cI(e)||this.chart._animationsDisabled}_getSharedOptions(e,i){const r=this.resolveDataElementOptions(e,i),s=this._sharedOptions,c=this.getSharedOptions(r),f=this.includeOptions(i,c)||c!==s;return this.updateSharedOptions(c,i,r),{sharedOptions:c,includeOptions:f}}updateElement(e,i,r,s){cI(s)?Object.assign(e,r):this._resolveAnimations(i,s).update(e,r)}updateSharedOptions(e,i,r){e&&!cI(i)&&this._resolveAnimations(void 0,i).update(e,r)}_setStyle(e,i,r,s){e.active=s;const c=this.getStyle(i,s);this._resolveAnimations(i,r,s).update(e,{options:!s&&this.getSharedOptions(c)||c})}removeHoverStyle(e,i,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,i,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const i=this._data,r=this._cachedMeta.data;for(const[y,k,E]of this._syncList)this[y](k,E);this._syncList=[];const s=r.length,c=i.length,f=Math.min(c,s);f&&this.parse(0,f),c>s?this._insertElements(s,c-s,e):c<s&&this._removeElements(c,s-c)}_insertElements(e,i,r=!0){const s=this._cachedMeta,c=s.data,f=e+i;let y;const k=E=>{for(E.length+=i,y=E.length-1;y>=f;y--)E[y]=E[y-i]};for(k(c),y=e;y<f;++y)c[y]=new this.dataElementType;this._parsing&&k(s._parsed),this.parse(e,i),r&&this.updateElements(c,e,i,"reset")}updateElements(e,i,r,s){}_removeElements(e,i){const r=this._cachedMeta;if(this._parsing){const s=r._parsed.splice(e,i);r._stacked&&Gk(r,s)}r.data.splice(e,i)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[i,r,s]=e;this[i](r,s)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,i){i&&this._sync(["_removeElements",e,i]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}})();function kpe(t){const n=t.iScale,e=function wpe(t,n){if(!t._cache.$bar){const e=t.getMatchingVisibleMetas(n);let i=[];for(let r=0,s=e.length;r<s;r++)i=i.concat(e[r].controller.getAllParsedValues(t));t._cache.$bar=nB(i.sort((r,s)=>r-s))}return t._cache.$bar}(n,t.type);let r,s,c,f,i=n._length;const y=()=>{32767===c||-32768===c||(Nk(f)&&(i=Math.min(i,Math.abs(c-f)||i)),f=c)};for(r=0,s=e.length;r<s;++r)c=n.getPixelForValue(e[r]),y();for(f=void 0,r=0,s=n.ticks.length;r<s;++r)c=n.getPixelForTick(r),y();return i}function HB(t,n,e,i){return fa(t)?function Spe(t,n,e,i){const r=e.parse(t[0],i),s=e.parse(t[1],i),c=Math.min(r,s),f=Math.max(r,s);let y=c,k=f;Math.abs(c)>Math.abs(f)&&(y=f,k=c),n[e.axis]=k,n._custom={barStart:y,barEnd:k,start:r,end:s,min:c,max:f}}(t,n,e,i):n[e.axis]=e.parse(t,i),n}function UB(t,n,e,i){const r=t.iScale,s=t.vScale,c=r.getLabels(),f=r===s,y=[];let k,E,F,$;for(k=e,E=e+i;k<E;++k)$=n[k],F={},F[r.axis]=f||r.parse(c[k],k),y.push(HB($,F,s,k));return y}function dI(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function Tpe(t,n,e,i){let r=n.borderSkipped;const s={};if(!r)return void(t.borderSkipped=s);if(!0===r)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:c,end:f,reverse:y,top:k,bottom:E}=function Dpe(t){let n,e,i,r,s;return t.horizontal?(n=t.base>t.x,e="left",i="right"):(n=t.base<t.y,e="bottom",i="top"),n?(r="end",s="start"):(r="start",s="end"),{start:e,end:i,reverse:n,top:r,bottom:s}}(t);"middle"===r&&e&&(t.enableBorderRadius=!0,(e._top||0)===i?r=k:(e._bottom||0)===i?r=E:(s[qB(E,c,f,y)]=!0,r=k)),s[qB(r,c,f,y)]=!0,t.borderSkipped=s}function qB(t,n,e,i){return i?(t=function Ape(t,n,e){return t===n?e:t===e?n:t}(t,n,e),t=$B(t,e,n)):t=$B(t,n,e),t}function $B(t,n,e){return"start"===t?n:"end"===t?e:t}function Ppe(t,{inflateAmount:n},e){t.inflateAmount="auto"===n?1===e?.33:0:n}let Ipe=(()=>class t extends Y1{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,i,r,s){return UB(e,i,r,s)}parseArrayData(e,i,r,s){return UB(e,i,r,s)}parseObjectData(e,i,r,s){const{iScale:c,vScale:f}=e,{xAxisKey:y="x",yAxisKey:k="y"}=this._parsing,E="x"===c.axis?y:k,F="x"===f.axis?y:k,$=[];let W,re,he,me;for(W=r,re=r+s;W<re;++W)me=i[W],he={},he[c.axis]=c.parse($1(me,E),W),$.push(HB($1(me,F),he,f,W));return $}updateRangeFromParsed(e,i,r,s){super.updateRangeFromParsed(e,i,r,s);const c=r._custom;c&&i===this._cachedMeta.vScale&&(e.min=Math.min(e.min,c.min),e.max=Math.max(e.max,c.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const i=this._cachedMeta,{iScale:r,vScale:s}=i,c=this.getParsed(e),f=c._custom,y=dI(f)?"["+f.start+", "+f.end+"]":""+s.getLabelForValue(c[s.axis]);return{label:""+r.getLabelForValue(c[r.axis]),value:y}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(e){const i=this._cachedMeta;this.updateElements(i.data,0,i.data.length,e)}updateElements(e,i,r,s){const c="reset"===s,{index:f,_cachedMeta:{vScale:y}}=this,k=y.getBasePixel(),E=y.isHorizontal(),F=this._getRuler(),{sharedOptions:$,includeOptions:W}=this._getSharedOptions(i,s);for(let re=i;re<i+r;re++){const he=this.getParsed(re),me=c||Mo(he[y.axis])?{base:k,head:k}:this._calculateBarValuePixels(re),Pe=this._calculateBarIndexPixels(re,F),Re=(he._stacks||{})[y.axis],rt={horizontal:E,base:me.base,enableBorderRadius:!Re||dI(he._custom)||f===Re._top||f===Re._bottom,x:E?me.head:Pe.center,y:E?Pe.center:me.head,height:E?Pe.size:Math.abs(me.size),width:E?Math.abs(me.size):Pe.size};W&&(rt.options=$||this.resolveDataElementOptions(re,e[re].active?"active":s));const ft=rt.options||e[re].options;Tpe(rt,ft,Re,f),Ppe(rt,ft,F.ratio),this.updateElement(e[re],re,rt,s)}}_getStacks(e,i){const{iScale:r}=this._cachedMeta,s=r.getMatchingVisibleMetas(this._type).filter(F=>F.controller.options.grouped),c=r.options.stacked,f=[],y=this._cachedMeta.controller.getParsed(i),k=y&&y[r.axis],E=F=>{const $=F._parsed.find(re=>re[r.axis]===k),W=$&&$[F.vScale.axis];if(Mo(W)||isNaN(W))return!0};for(const F of s)if((void 0===i||!E(F))&&((!1===c||-1===f.indexOf(F.stack)||void 0===c&&void 0===F.stack)&&f.push(F.stack),F.index===e))break;return f.length||f.push(void 0),f}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,i,r){const s=this._getStacks(e,r),c=void 0!==i?s.indexOf(i):-1;return-1===c?s.length-1:c}_getRuler(){const e=this.options,i=this._cachedMeta,r=i.iScale,s=[];let c,f;for(c=0,f=i.data.length;c<f;++c)s.push(r.getPixelForValue(this.getParsed(c)[r.axis],c));const y=e.barThickness;return{min:y||kpe(i),pixels:s,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:e.grouped,ratio:y?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:i,_stacked:r,index:s},options:{base:c,minBarLength:f}}=this,y=c||0,k=this.getParsed(e),E=k._custom,F=dI(E);let he,me,$=k[i.axis],W=0,re=r?this.applyStack(i,k,r):$;re!==$&&(W=re-$,re=$),F&&($=E.barStart,re=E.barEnd-E.barStart,0!==$&&jf($)!==jf(E.barEnd)&&(W=0),W+=$);const Pe=Mo(c)||F?W:c;let Re=i.getPixelForValue(Pe);if(he=this.chart.getDataVisibility(e)?i.getPixelForValue(W+re):Re,me=he-Re,Math.abs(me)<f){me=function Epe(t,n,e){return 0!==t?jf(t):(n.isHorizontal()?1:-1)*(n.min>=e?1:-1)}(me,i,y)*f,$===y&&(Re-=me/2);const rt=i.getPixelForDecimal(0),ft=i.getPixelForDecimal(1),Ct=Math.min(rt,ft),Vt=Math.max(rt,ft);Re=Math.max(Math.min(Re,Vt),Ct),he=Re+me,r&&!F&&(k._stacks[i.axis]._visualValues[s]=i.getValueForPixel(he)-i.getValueForPixel(Re))}if(Re===i.getPixelForValue(y)){const rt=jf(me)*i.getLineWidthForValue(y)/2;Re+=rt,me-=rt}return{size:me,base:Re,head:he,center:he+me/2}}_calculateBarIndexPixels(e,i){const r=i.scale,s=this.options,c=s.skipNull,f=Zr(s.maxBarThickness,1/0);let y,k;if(i.grouped){const E=c?this._getStackCount(e):i.stackCount,F="flex"===s.barThickness?function Cpe(t,n,e,i){const r=n.pixels,s=r[t];let c=t>0?r[t-1]:null,f=t<r.length-1?r[t+1]:null;const y=e.categoryPercentage;null===c&&(c=s-(null===f?n.end-n.start:f-s)),null===f&&(f=s+s-c);const k=s-(s-Math.min(c,f))/2*y;return{chunk:Math.abs(f-c)/2*y/i,ratio:e.barPercentage,start:k}}(e,i,s,E):function Mpe(t,n,e,i){const r=e.barThickness;let s,c;return Mo(r)?(s=n.min*e.categoryPercentage,c=e.barPercentage):(s=r*i,c=1),{chunk:s/i,ratio:c,start:n.pixels[t]-s/2}}(e,i,s,E),$=this._getStackIndex(this.index,this._cachedMeta.stack,c?e:void 0);y=F.start+F.chunk*$+F.chunk/2,k=Math.min(f,F.chunk*F.ratio)}else y=r.getPixelForValue(this.getParsed(e)[r.axis],e),k=Math.min(f,i.min*i.ratio);return{base:y-k/2,head:y+k/2,center:y,size:k}}draw(){const e=this._cachedMeta,i=e.vScale,r=e.data,s=r.length;let c=0;for(;c<s;++c)null!==this.getParsed(c)[i.axis]&&!r[c].hidden&&r[c].draw(this._ctx)}})(),Ope=(()=>class t extends Y1{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,i,r,s){const c=super.parsePrimitiveData(e,i,r,s);for(let f=0;f<c.length;f++)c[f]._custom=this.resolveDataElementOptions(f+r).radius;return c}parseArrayData(e,i,r,s){const c=super.parseArrayData(e,i,r,s);for(let f=0;f<c.length;f++)c[f]._custom=Zr(i[r+f][2],this.resolveDataElementOptions(f+r).radius);return c}parseObjectData(e,i,r,s){const c=super.parseObjectData(e,i,r,s);for(let f=0;f<c.length;f++){const y=i[r+f];c[f]._custom=Zr(y&&y.r&&+y.r,this.resolveDataElementOptions(f+r).radius)}return c}getMaxOverflow(){const e=this._cachedMeta.data;let i=0;for(let r=e.length-1;r>=0;--r)i=Math.max(i,e[r].size(this.resolveDataElementOptions(r))/2);return i>0&&i}getLabelAndValue(e){const i=this._cachedMeta,r=this.chart.data.labels||[],{xScale:s,yScale:c}=i,f=this.getParsed(e),y=s.getLabelForValue(f.x),k=c.getLabelForValue(f.y),E=f._custom;return{label:r[e]||"",value:"("+y+", "+k+(E?", "+E:"")+")"}}update(e){const i=this._cachedMeta.data;this.updateElements(i,0,i.length,e)}updateElements(e,i,r,s){const c="reset"===s,{iScale:f,vScale:y}=this._cachedMeta,{sharedOptions:k,includeOptions:E}=this._getSharedOptions(i,s),F=f.axis,$=y.axis;for(let W=i;W<i+r;W++){const re=e[W],he=!c&&this.getParsed(W),me={},Pe=me[F]=c?f.getPixelForDecimal(.5):f.getPixelForValue(he[F]),Re=me[$]=c?y.getBasePixel():y.getPixelForValue(he[$]);me.skip=isNaN(Pe)||isNaN(Re),E&&(me.options=k||this.resolveDataElementOptions(W,re.active?"active":s),c&&(me.options.radius=0)),this.updateElement(re,W,me,s)}}resolveDataElementOptions(e,i){const r=this.getParsed(e);let s=super.resolveDataElementOptions(e,i);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const c=s.radius;return"active"!==i&&(s.radius=0),s.radius+=Zr(r&&r._custom,c),s}})(),hI=(()=>class t extends Y1{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const i=e.data;if(i.labels.length&&i.datasets.length){const{labels:{pointStyle:r,color:s}}=e.legend.options;return i.labels.map((c,f)=>{const k=e.getDatasetMeta(0).controller.getStyle(f);return{text:c,fillStyle:k.backgroundColor,strokeStyle:k.borderColor,fontColor:s,lineWidth:k.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(f),index:f}})}return[]}},onClick(e,i,r){r.chart.toggleDataVisibility(i.index),r.chart.update()}}}};constructor(e,i){super(e,i),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,i){const r=this.getDataset().data,s=this._cachedMeta;if(!1===this._parsing)s._parsed=r;else{let f,y,c=k=>+r[k];if(Po(r[e])){const{key:k="value"}=this._parsing;c=E=>+$1(r[E],k)}for(f=e,y=e+i;f<y;++f)s._parsed[f]=c(f)}}_getRotation(){return Ap(this.options.rotation-90)}_getCircumference(){return Ap(this.options.circumference)}_getRotationExtents(){let e=ga,i=-ga;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const s=this.chart.getDatasetMeta(r).controller,c=s._getRotation(),f=s._getCircumference();e=Math.min(e,c),i=Math.max(i,c+f)}return{rotation:e,circumference:i-e}}update(e){const i=this.chart,{chartArea:r}=i,s=this._cachedMeta,c=s.data,f=this.getMaxBorderWidth()+this.getMaxOffset(c)+this.options.spacing,y=Math.max((Math.min(r.width,r.height)-f)/2,0),k=Math.min(((t,n)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:+t/n)(this.options.cutout,y),1),E=this._getRingWeight(this.index),{circumference:F,rotation:$}=this._getRotationExtents(),{ratioX:W,ratioY:re,offsetX:he,offsetY:me}=function Rpe(t,n,e){let i=1,r=1,s=0,c=0;if(n<ga){const f=t,y=f+n,k=Math.cos(f),E=Math.sin(f),F=Math.cos(y),$=Math.sin(y),W=(rt,ft,Ct)=>Vk(rt,f,y,!0)?1:Math.max(ft,ft*e,Ct,Ct*e),re=(rt,ft,Ct)=>Vk(rt,f,y,!0)?-1:Math.min(ft,ft*e,Ct,Ct*e),he=W(0,k,F),me=W(Al,E,$),Pe=re(ma,k,F),Re=re(ma+Al,E,$);i=(he-Pe)/2,r=(me-Re)/2,s=-(he+Pe)/2,c=-(me+Re)/2}return{ratioX:i,ratioY:r,offsetX:s,offsetY:c}}($,F,k),rt=Math.max(Math.min((r.width-f)/W,(r.height-f)/re)/2,0),ft=$N(this.options.radius,rt),Vt=(ft-Math.max(ft*k,0))/this._getVisibleDatasetWeightTotal();this.offsetX=he*ft,this.offsetY=me*ft,s.total=this.calculateTotal(),this.outerRadius=ft-Vt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Vt*E,0),this.updateElements(c,0,c.length,e)}_circumference(e,i){const r=this.options,s=this._cachedMeta,c=this._getCircumference();return i&&r.animation.animateRotate||!this.chart.getDataVisibility(e)||null===s._parsed[e]||s.data[e].hidden?0:this.calculateCircumference(s._parsed[e]*c/ga)}updateElements(e,i,r,s){const c="reset"===s,f=this.chart,y=f.chartArea,F=(y.left+y.right)/2,$=(y.top+y.bottom)/2,W=c&&f.options.animation.animateScale,re=W?0:this.innerRadius,he=W?0:this.outerRadius,{sharedOptions:me,includeOptions:Pe}=this._getSharedOptions(i,s);let rt,Re=this._getRotation();for(rt=0;rt<i;++rt)Re+=this._circumference(rt,c);for(rt=i;rt<i+r;++rt){const ft=this._circumference(rt,c),Ct=e[rt],Vt={x:F+this.offsetX,y:$+this.offsetY,startAngle:Re,endAngle:Re+ft,circumference:ft,outerRadius:he,innerRadius:re};Pe&&(Vt.options=me||this.resolveDataElementOptions(rt,Ct.active?"active":s)),Re+=ft,this.updateElement(Ct,rt,Vt,s)}}calculateTotal(){const e=this._cachedMeta,i=e.data;let s,r=0;for(s=0;s<i.length;s++){const c=e._parsed[s];null!==c&&!isNaN(c)&&this.chart.getDataVisibility(s)&&!i[s].hidden&&(r+=Math.abs(c))}return r}calculateCircumference(e){const i=this._cachedMeta.total;return i>0&&!isNaN(e)?ga*(Math.abs(e)/i):0}getLabelAndValue(e){const r=this.chart,s=r.data.labels||[],c=Hk(this._cachedMeta._parsed[e],r.options.locale);return{label:s[e]||"",value:c}}getMaxBorderWidth(e){let i=0;const r=this.chart;let s,c,f,y,k;if(!e)for(s=0,c=r.data.datasets.length;s<c;++s)if(r.isDatasetVisible(s)){f=r.getDatasetMeta(s),e=f.data,y=f.controller;break}if(!e)return 0;for(s=0,c=e.length;s<c;++s)k=y.resolveDataElementOptions(s),"inner"!==k.borderAlign&&(i=Math.max(i,k.borderWidth||0,k.hoverBorderWidth||0));return i}getMaxOffset(e){let i=0;for(let r=0,s=e.length;r<s;++r){const c=this.resolveDataElementOptions(r);i=Math.max(i,c.offset||0,c.hoverOffset||0)}return i}_getRingWeightOffset(e){let i=0;for(let r=0;r<e;++r)this.chart.isDatasetVisible(r)&&(i+=this._getRingWeight(r));return i}_getRingWeight(e){return Math.max(Zr(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}})(),Lpe=(()=>class t extends Y1{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const i=this._cachedMeta,{dataset:r,data:s=[],_dataset:c}=i,f=this.chart._animationsDisabled;let{start:y,count:k}=oB(i,s,f);this._drawStart=y,this._drawCount=k,sB(i)&&(y=0,k=s.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!c._decimated,r.points=s;const E=this.resolveDatasetElementOptions(e);this.options.showLine||(E.borderWidth=0),E.segment=this.options.segment,this.updateElement(r,void 0,{animated:!f,options:E},e),this.updateElements(s,y,k,e)}updateElements(e,i,r,s){const c="reset"===s,{iScale:f,vScale:y,_stacked:k,_dataset:E}=this._cachedMeta,{sharedOptions:F,includeOptions:$}=this._getSharedOptions(i,s),W=f.axis,re=y.axis,{spanGaps:he,segment:me}=this.options,Pe=ib(he)?he:Number.POSITIVE_INFINITY,Re=this.chart._animationsDisabled||c||"none"===s,rt=i+r,ft=e.length;let Ct=i>0&&this.getParsed(i-1);for(let Vt=0;Vt<ft;++Vt){const sn=e[Vt],Qt=Re?sn:{};if(Vt<i||Vt>=rt){Qt.skip=!0;continue}const Vn=this.getParsed(Vt),Hi=Mo(Vn[re]),fr=Qt[W]=f.getPixelForValue(Vn[W],Vt),Or=Qt[re]=c||Hi?y.getBasePixel():y.getPixelForValue(k?this.applyStack(y,Vn,k):Vn[re],Vt);Qt.skip=isNaN(fr)||isNaN(Or)||Hi,Qt.stop=Vt>0&&Math.abs(Vn[W]-Ct[W])>Pe,me&&(Qt.parsed=Vn,Qt.raw=E.data[Vt]),$&&(Qt.options=F||this.resolveDataElementOptions(Vt,sn.active?"active":s)),Re||this.updateElement(sn,Vt,Qt,s),Ct=Vn}}getMaxOverflow(){const e=this._cachedMeta,i=e.dataset,r=i.options&&i.options.borderWidth||0,s=e.data||[];if(!s.length)return r;const c=s[0].size(this.resolveDataElementOptions(0)),f=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(r,c,f)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}})(),GB=(()=>class t extends Y1{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const i=e.data;if(i.labels.length&&i.datasets.length){const{labels:{pointStyle:r,color:s}}=e.legend.options;return i.labels.map((c,f)=>{const k=e.getDatasetMeta(0).controller.getStyle(f);return{text:c,fillStyle:k.backgroundColor,strokeStyle:k.borderColor,fontColor:s,lineWidth:k.borderWidth,pointStyle:r,hidden:!e.getDataVisibility(f),index:f}})}return[]}},onClick(e,i,r){r.chart.toggleDataVisibility(i.index),r.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,i){super(e,i),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const r=this.chart,s=r.data.labels||[],c=Hk(this._cachedMeta._parsed[e].r,r.options.locale);return{label:s[e]||"",value:c}}parseObjectData(e,i,r,s){return xB.bind(this)(e,i,r,s)}update(e){const i=this._cachedMeta.data;this._updateRadius(),this.updateElements(i,0,i.length,e)}getMinMax(){const i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return this._cachedMeta.data.forEach((r,s)=>{const c=this.getParsed(s).r;!isNaN(c)&&this.chart.getDataVisibility(s)&&(c<i.min&&(i.min=c),c>i.max&&(i.max=c))}),i}_updateRadius(){const e=this.chart,i=e.chartArea,r=e.options,s=Math.min(i.right-i.left,i.bottom-i.top),c=Math.max(s/2,0),y=(c-Math.max(r.cutoutPercentage?c/100*r.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=c-y*this.index,this.innerRadius=this.outerRadius-y}updateElements(e,i,r,s){const c="reset"===s,f=this.chart,k=f.options.animation,E=this._cachedMeta.rScale,F=E.xCenter,$=E.yCenter,W=E.getIndexAngle(0)-.5*ma;let he,re=W;const me=360/this.countVisibleElements();for(he=0;he<i;++he)re+=this._computeAngle(he,s,me);for(he=i;he<i+r;he++){const Pe=e[he];let Re=re,rt=re+this._computeAngle(he,s,me),ft=f.getDataVisibility(he)?E.getDistanceFromCenterForValue(this.getParsed(he).r):0;re=rt,c&&(k.animateScale&&(ft=0),k.animateRotate&&(Re=rt=W));const Ct={x:F,y:$,innerRadius:0,outerRadius:ft,startAngle:Re,endAngle:rt,options:this.resolveDataElementOptions(he,Pe.active?"active":s)};this.updateElement(Pe,he,Ct,s)}}countVisibleElements(){let i=0;return this._cachedMeta.data.forEach((r,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&i++}),i}_computeAngle(e,i,r){return this.chart.getDataVisibility(e)?Ap(this.resolveDataElementOptions(e,i).angle||r):0}})();var Fpe=Object.freeze({__proto__:null,BarController:Ipe,BubbleController:Ope,DoughnutController:hI,LineController:Lpe,PieController:(()=>class t extends hI{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}})(),PolarAreaController:GB,RadarController:(()=>class t extends Y1{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const i=this._cachedMeta.vScale,r=this.getParsed(e);return{label:i.getLabels()[e],value:""+i.getLabelForValue(r[i.axis])}}parseObjectData(e,i,r,s){return xB.bind(this)(e,i,r,s)}update(e){const i=this._cachedMeta,r=i.dataset,s=i.data||[],c=i.iScale.getLabels();if(r.points=s,"resize"!==e){const f=this.resolveDatasetElementOptions(e);this.options.showLine||(f.borderWidth=0),this.updateElement(r,void 0,{_loop:!0,_fullLoop:c.length===s.length,options:f},e)}this.updateElements(s,0,s.length,e)}updateElements(e,i,r,s){const c=this._cachedMeta.rScale,f="reset"===s;for(let y=i;y<i+r;y++){const k=e[y],E=this.resolveDataElementOptions(y,k.active?"active":s),F=c.getPointPositionForValue(y,this.getParsed(y).r),$=f?c.xCenter:F.x,W=f?c.yCenter:F.y,re={x:$,y:W,angle:F.angle,skip:isNaN($)||isNaN(W),options:E};this.updateElement(k,y,re,s)}}})(),ScatterController:(()=>class t extends Y1{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const i=this._cachedMeta,r=this.chart.data.labels||[],{xScale:s,yScale:c}=i,f=this.getParsed(e),y=s.getLabelForValue(f.x),k=c.getLabelForValue(f.y);return{label:r[e]||"",value:"("+y+", "+k+")"}}update(e){const i=this._cachedMeta,{data:r=[]}=i,s=this.chart._animationsDisabled;let{start:c,count:f}=oB(i,r,s);if(this._drawStart=c,this._drawCount=f,sB(i)&&(c=0,f=r.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:y,_dataset:k}=i;y._chart=this.chart,y._datasetIndex=this.index,y._decimated=!!k._decimated,y.points=r;const E=this.resolveDatasetElementOptions(e);E.segment=this.options.segment,this.updateElement(y,void 0,{animated:!s,options:E},e)}else this.datasetElementType&&(delete i.dataset,this.datasetElementType=!1);this.updateElements(r,c,f,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,i,r,s){const c="reset"===s,{iScale:f,vScale:y,_stacked:k,_dataset:E}=this._cachedMeta,F=this.resolveDataElementOptions(i,s),$=this.getSharedOptions(F),W=this.includeOptions(s,$),re=f.axis,he=y.axis,{spanGaps:me,segment:Pe}=this.options,Re=ib(me)?me:Number.POSITIVE_INFINITY,rt=this.chart._animationsDisabled||c||"none"===s;let ft=i>0&&this.getParsed(i-1);for(let Ct=i;Ct<i+r;++Ct){const Vt=e[Ct],sn=this.getParsed(Ct),Qt=rt?Vt:{},Vn=Mo(sn[he]),Hi=Qt[re]=f.getPixelForValue(sn[re],Ct),fr=Qt[he]=c||Vn?y.getBasePixel():y.getPixelForValue(k?this.applyStack(y,sn,k):sn[he],Ct);Qt.skip=isNaN(Hi)||isNaN(fr)||Vn,Qt.stop=Ct>0&&Math.abs(sn[re]-ft[re])>Re,Pe&&(Qt.parsed=sn,Qt.raw=E.data[Ct]),W&&(Qt.options=$||this.resolveDataElementOptions(Ct,Vt.active?"active":s)),rt||this.updateElement(Vt,Ct,Qt,s),ft=sn}this.updateSharedOptions($,s,F)}getMaxOverflow(){const e=this._cachedMeta,i=e.data||[];if(!this.options.showLine){let y=0;for(let k=i.length-1;k>=0;--k)y=Math.max(y,i[k].size(this.resolveDataElementOptions(k))/2);return y>0&&y}const r=e.dataset,s=r.options&&r.options.borderWidth||0;if(!i.length)return s;const c=i[0].size(this.resolveDataElementOptions(0)),f=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,c,f)/2}})()});function fy(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class uI{static override(n){Object.assign(uI.prototype,n)}options;constructor(n){this.options=n||{}}init(){}formats(){return fy()}parse(){return fy()}format(){return fy()}add(){return fy()}diff(){return fy()}startOf(){return fy()}endOf(){return fy()}}var zpe__date=uI;function Npe(t,n,e,i){const{controller:r,data:s,_sorted:c}=t,f=r._cachedMeta.iScale,y=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(f&&n===f.axis&&"r"!==n&&c&&s.length){const k=f._reversePixels?iue:hg;if(!i){const E=k(s,n,e);if(y){const{vScale:F}=r._cachedMeta,{_parsed:$}=t,W=$.slice(0,E.lo+1).reverse().findIndex(he=>!Mo(he[F.axis]));E.lo-=Math.max(0,W);const re=$.slice(E.hi).findIndex(he=>!Mo(he[F.axis]));E.hi+=Math.max(0,re)}return E}if(r._sharedOptions){const E=s[0],F="function"==typeof E.getRange&&E.getRange(n);if(F){const $=k(s,n,e-F),W=k(s,n,e+F);return{lo:$.lo,hi:W.hi}}}}return{lo:0,hi:s.length-1}}function Wk(t,n,e,i,r){const s=t.getSortedVisibleDatasetMetas(),c=e[n];for(let f=0,y=s.length;f<y;++f){const{index:k,data:E}=s[f],{lo:F,hi:$}=Npe(s[f],n,c,r);for(let W=F;W<=$;++W){const re=E[W];re.skip||i(re,k,W)}}}function pI(t,n,e,i,r){const s=[];return!r&&!t.isPointInArea(n)||Wk(t,e,n,function(f,y,k){!r&&!ug(f,t.chartArea,0)||f.inRange(n.x,n.y,i)&&s.push({element:f,datasetIndex:y,index:k})},!0),s}function fI(t,n,e,i,r,s){return s||t.isPointInArea(n)?"r"!==e||i?function jpe(t,n,e,i,r,s){let c=[];const f=function Bpe(t){const n=-1!==t.indexOf("x"),e=-1!==t.indexOf("y");return function(i,r){const s=n?Math.abs(i.x-r.x):0,c=e?Math.abs(i.y-r.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(c,2))}}(e);let y=Number.POSITIVE_INFINITY;return Wk(t,e,n,function k(E,F,$){const W=E.inRange(n.x,n.y,r);if(i&&!W)return;const re=E.getCenterPoint(r);if(!s&&!t.isPointInArea(re)&&!W)return;const me=f(n,re);me<y?(c=[{element:E,datasetIndex:F,index:$}],y=me):me===y&&c.push({element:E,datasetIndex:F,index:$})}),c}(t,n,e,i,r,s):function Vpe(t,n,e,i){let r=[];return Wk(t,e,n,function s(c,f,y){const{startAngle:k,endAngle:E}=c.getProps(["startAngle","endAngle"],i),{angle:F}=JN(c,{x:n.x,y:n.y});Vk(F,k,E)&&r.push({element:c,datasetIndex:f,index:y})}),r}(t,n,e,r):[]}function WB(t,n,e,i,r){const s=[],c="x"===e?"inXRange":"inYRange";let f=!1;return Wk(t,e,n,(y,k,E)=>{y[c]&&y[c](n[e],r)&&(s.push({element:y,datasetIndex:k,index:E}),f=f||y.inRange(n.x,n.y,r))}),i&&!f?[]:s}var Hpe={evaluateInteractionItems:Wk,modes:{index(t,n,e,i){const r=uy(n,t),s=e.axis||"x",c=e.includeInvisible||!1,f=e.intersect?pI(t,r,s,i,c):fI(t,r,s,!1,i,c),y=[];return f.length?(t.getSortedVisibleDatasetMetas().forEach(k=>{const E=f[0].index,F=k.data[E];F&&!F.skip&&y.push({element:F,datasetIndex:k.index,index:E})}),y):[]},dataset(t,n,e,i){const r=uy(n,t),s=e.axis||"xy",c=e.includeInvisible||!1;let f=e.intersect?pI(t,r,s,i,c):fI(t,r,s,!1,i,c);if(f.length>0){const y=f[0].datasetIndex,k=t.getDatasetMeta(y).data;f=[];for(let E=0;E<k.length;++E)f.push({element:k[E],datasetIndex:y,index:E})}return f},point:(t,n,e,i)=>pI(t,uy(n,t),e.axis||"xy",i,e.includeInvisible||!1),nearest:(t,n,e,i)=>fI(t,uy(n,t),e.axis||"xy",e.intersect,i,e.includeInvisible||!1),x:(t,n,e,i)=>WB(t,uy(n,t),"x",e.intersect,i),y:(t,n,e,i)=>WB(t,uy(n,t),"y",e.intersect,i)}};const ZB=["left","top","right","bottom"];function Zk(t,n){return t.filter(e=>e.pos===n)}function YB(t,n){return t.filter(e=>-1===ZB.indexOf(e.pos)&&e.box.axis===n)}function Yk(t,n){return t.sort((e,i)=>{const r=n?i:e,s=n?e:i;return r.weight===s.weight?r.index-s.index:r.weight-s.weight})}function XB(t,n,e,i){return Math.max(t[e],n[e])+Math.max(t[i],n[i])}function KB(t,n){t.top=Math.max(t.top,n.top),t.left=Math.max(t.left,n.left),t.bottom=Math.max(t.bottom,n.bottom),t.right=Math.max(t.right,n.right)}function Wpe(t,n,e,i){const{pos:r,box:s}=e,c=t.maxPadding;if(!Po(r)){e.size&&(t[r]-=e.size);const F=i[e.stack]||{size:0,count:1};F.size=Math.max(F.size,e.horizontal?s.height:s.width),e.size=F.size/F.count,t[r]+=e.size}s.getPadding&&KB(c,s.getPadding());const f=Math.max(0,n.outerWidth-XB(c,t,"left","right")),y=Math.max(0,n.outerHeight-XB(c,t,"top","bottom")),k=f!==t.w,E=y!==t.h;return t.w=f,t.h=y,e.horizontal?{same:k,other:E}:{same:E,other:k}}function Ype(t,n){const e=n.maxPadding;return function i(r){const s={left:0,top:0,right:0,bottom:0};return r.forEach(c=>{s[c]=Math.max(n[c],e[c])}),s}(t?["left","right"]:["top","bottom"])}function Xk(t,n,e,i){const r=[];let s,c,f,y,k,E;for(s=0,c=t.length,k=0;s<c;++s){f=t[s],y=f.box,y.update(f.width||n.w,f.height||n.h,Ype(f.horizontal,n));const{same:F,other:$}=Wpe(n,e,f,i);k|=F&&r.length,E=E||$,y.fullSize||r.push(f)}return k&&Xk(r,n,e,i)||E}function Z5(t,n,e,i,r){t.top=e,t.left=n,t.right=n+i,t.bottom=e+r,t.width=i,t.height=r}function QB(t,n,e,i){const r=e.padding;let{x:s,y:c}=n;for(const f of t){const y=f.box,k=i[f.stack]||{count:1,placed:0,weight:1},E=f.stackWeight/k.weight||1;if(f.horizontal){const F=n.w*E,$=k.size||y.height;Nk(k.start)&&(c=k.start),y.fullSize?Z5(y,r.left,c,e.outerWidth-r.right-r.left,$):Z5(y,n.left+k.placed,c,F,$),k.start=c,k.placed+=F,c=y.bottom}else{const F=n.h*E,$=k.size||y.width;Nk(k.start)&&(s=k.start),y.fullSize?Z5(y,s,r.top,$,e.outerHeight-r.bottom-r.top):Z5(y,s,n.top+k.placed,$,F),k.start=s,k.placed+=F,s=y.right}}n.x=s,n.y=c}var Td={addBox(t,n){t.boxes||(t.boxes=[]),n.fullSize=n.fullSize||!1,n.position=n.position||"top",n.weight=n.weight||0,n._layers=n._layers||function(){return[{z:0,draw(e){n.draw(e)}}]},t.boxes.push(n)},removeBox(t,n){const e=t.boxes?t.boxes.indexOf(n):-1;-1!==e&&t.boxes.splice(e,1)},configure(t,n,e){n.fullSize=e.fullSize,n.position=e.position,n.weight=e.weight},update(t,n,e,i){if(!t)return;const r=Dd(t.options.layout.padding),s=Math.max(n-r.width,0),c=Math.max(e-r.height,0),f=function Gpe(t){const n=function Upe(t){const n=[];let e,i,r,s,c,f;for(e=0,i=(t||[]).length;e<i;++e)r=t[e],({position:s,options:{stack:c,stackWeight:f=1}}=r),n.push({index:e,box:r,pos:s,horizontal:r.isHorizontal(),weight:r.weight,stack:c&&s+c,stackWeight:f});return n}(t),e=Yk(n.filter(k=>k.box.fullSize),!0),i=Yk(Zk(n,"left"),!0),r=Yk(Zk(n,"right")),s=Yk(Zk(n,"top"),!0),c=Yk(Zk(n,"bottom")),f=YB(n,"x"),y=YB(n,"y");return{fullSize:e,leftAndTop:i.concat(s),rightAndBottom:r.concat(y).concat(c).concat(f),chartArea:Zk(n,"chartArea"),vertical:i.concat(r).concat(y),horizontal:s.concat(c).concat(f)}}(t.boxes),y=f.vertical,k=f.horizontal;Cs(t.boxes,he=>{"function"==typeof he.beforeLayout&&he.beforeLayout()});const E=y.reduce((he,me)=>me.box.options&&!1===me.box.options.display?he:he+1,0)||1,F=Object.freeze({outerWidth:n,outerHeight:e,padding:r,availableWidth:s,availableHeight:c,vBoxMaxWidth:s/2/E,hBoxMaxHeight:c/2}),$=Object.assign({},r);KB($,Dd(i));const W=Object.assign({maxPadding:$,w:s,h:c,x:r.left,y:r.top},r),re=function $pe(t,n){const e=function qpe(t){const n={};for(const e of t){const{stack:i,pos:r,stackWeight:s}=e;if(!i||!ZB.includes(r))continue;const c=n[i]||(n[i]={count:0,placed:0,weight:0,size:0});c.count++,c.weight+=s}return n}(t),{vBoxMaxWidth:i,hBoxMaxHeight:r}=n;let s,c,f;for(s=0,c=t.length;s<c;++s){f=t[s];const{fullSize:y}=f.box,k=e[f.stack],E=k&&f.stackWeight/k.weight;f.horizontal?(f.width=E?E*i:y&&n.availableWidth,f.height=r):(f.width=i,f.height=E?E*r:y&&n.availableHeight)}return e}(y.concat(k),F);Xk(f.fullSize,W,F,re),Xk(y,W,F,re),Xk(k,W,F,re)&&Xk(y,W,F,re),function Zpe(t){const n=t.maxPadding;function e(i){const r=Math.max(n[i]-t[i],0);return t[i]+=r,r}t.y+=e("top"),t.x+=e("left"),e("right"),e("bottom")}(W),QB(f.leftAndTop,W,F,re),W.x+=W.w,W.y+=W.h,QB(f.rightAndBottom,W,F,re),t.chartArea={left:W.left,top:W.top,right:W.left+W.w,bottom:W.top+W.h,height:W.h,width:W.w},Cs(f.chartArea,he=>{const me=he.box;Object.assign(me,t.chartArea),me.update(W.w,W.h,{left:0,top:0,right:0,bottom:0})})}};class JB{acquireContext(n,e){}releaseContext(n){return!1}addEventListener(n,e,i){}removeEventListener(n,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(n,e,i,r){return e=Math.max(0,e||n.width),i=i||n.height,{width:e,height:Math.max(0,r?Math.floor(e/r):i)}}isAttached(n){return!0}updateConfig(n){}}class Xpe extends JB{acquireContext(n){return n&&n.getContext&&n.getContext("2d")||null}updateConfig(n){n.options.animation=!1}}const Y5="$chartjs",Kpe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},eV=t=>null===t||""===t,tV=!!Xue&&{passive:!0};function efe(t,n,e){t&&t.canvas&&t.canvas.removeEventListener(n,e,tV)}function X5(t,n){for(const e of t)if(e===n||e.contains(n))return!0}function nfe(t,n,e){const i=t.canvas,r=new MutationObserver(s=>{let c=!1;for(const f of s)c=c||X5(f.addedNodes,i),c=c&&!X5(f.removedNodes,i);c&&e()});return r.observe(document,{childList:!0,subtree:!0}),r}function ife(t,n,e){const i=t.canvas,r=new MutationObserver(s=>{let c=!1;for(const f of s)c=c||X5(f.removedNodes,i),c=c&&!X5(f.addedNodes,i);c&&e()});return r.observe(document,{childList:!0,subtree:!0}),r}const Kk=new Map;let nV=0;function iV(){const t=window.devicePixelRatio;t!==nV&&(nV=t,Kk.forEach((n,e)=>{e.currentDevicePixelRatio!==t&&n()}))}function sfe(t,n,e){const i=t.canvas,r=i&&sI(i);if(!r)return;const s=rB((f,y)=>{const k=r.clientWidth;e(f,y),k<r.clientWidth&&e()},window),c=new ResizeObserver(f=>{const y=f[0],k=y.contentRect.width,E=y.contentRect.height;0===k&&0===E||s(k,E)});return c.observe(r),function rfe(t,n){Kk.size||window.addEventListener("resize",iV),Kk.set(t,n)}(t,s),c}function mI(t,n,e){e&&e.disconnect(),"resize"===n&&function ofe(t){Kk.delete(t),Kk.size||window.removeEventListener("resize",iV)}(t)}function afe(t,n,e){const i=t.canvas,r=rB(s=>{null!==t.ctx&&e(function tfe(t,n){const e=Kpe[t.type]||t.type,{x:i,y:r}=uy(t,n);return{type:e,chart:n,native:t,x:void 0!==i?i:null,y:void 0!==r?r:null}}(s,t))},t);return function Jpe(t,n,e){t&&t.addEventListener(n,e,tV)}(i,n,r),r}class lfe extends JB{acquireContext(n,e){const i=n&&n.getContext&&n.getContext("2d");return i&&i.canvas===n?(function Qpe(t,n){const e=t.style,i=t.getAttribute("height"),r=t.getAttribute("width");if(t[Y5]={initial:{height:i,width:r,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",eV(r)){const s=MB(t,"width");void 0!==s&&(t.width=s)}if(eV(i))if(""===t.style.height)t.height=t.width/(n||2);else{const s=MB(t,"height");void 0!==s&&(t.height=s)}}(n,e),i):null}releaseContext(n){const e=n.canvas;if(!e[Y5])return!1;const i=e[Y5].initial;["height","width"].forEach(s=>{const c=i[s];Mo(c)?e.removeAttribute(s):e.setAttribute(s,c)});const r=i.style||{};return Object.keys(r).forEach(s=>{e.style[s]=r[s]}),e.width=e.width,delete e[Y5],!0}addEventListener(n,e,i){this.removeEventListener(n,e),(n.$proxies||(n.$proxies={}))[e]=({attach:nfe,detach:ife,resize:sfe}[e]||afe)(n,e,i)}removeEventListener(n,e){const i=n.$proxies||(n.$proxies={}),r=i[e];r&&(({attach:mI,detach:mI,resize:mI}[e]||efe)(n,e,r),i[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(n,e,i,r){return function Yue(t,n,e,i){const r=$5(t),s=hy(r,"margin"),c=q5(r.maxWidth,t,"clientWidth")||z5,f=q5(r.maxHeight,t,"clientHeight")||z5,y=function Zue(t,n,e){let i,r;if(void 0===n||void 0===e){const s=t&&sI(t);if(s){const c=s.getBoundingClientRect(),f=$5(s),y=hy(f,"border","width"),k=hy(f,"padding");n=c.width-k.width-y.width,e=c.height-k.height-y.height,i=q5(f.maxWidth,s,"clientWidth"),r=q5(f.maxHeight,s,"clientHeight")}else n=t.clientWidth,e=t.clientHeight}return{width:n,height:e,maxWidth:i||z5,maxHeight:r||z5}}(t,n,e);let{width:k,height:E}=y;if("content-box"===r.boxSizing){const $=hy(r,"border","width"),W=hy(r,"padding");k-=W.width+$.width,E-=W.height+$.height}return k=Math.max(0,k-s.width),E=Math.max(0,i?k/i:E-s.height),k=G5(Math.min(k,c,y.maxWidth)),E=G5(Math.min(E,f,y.maxHeight)),k&&!E&&(E=G5(k/2)),(void 0!==n||void 0!==e)&&i&&y.height&&E>y.height&&(E=y.height,k=G5(Math.floor(E*i))),{width:k,height:E}}(n,e,i,r)}isAttached(n){const e=n&&sI(n);return!(!e||!e.isConnected)}}class fg{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(n){const{x:e,y:i}=this.getProps(["x","y"],n);return{x:e,y:i}}hasValue(){return ib(this.x)&&ib(this.y)}getProps(n,e){const i=this.$animations;if(!e||!i)return this;const r={};return n.forEach(s=>{r[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),r}}function K5(t,n,e,i,r){const s=Zr(i,0),c=Math.min(Zr(r,t.length),t.length);let y,k,E,f=0;for(e=Math.ceil(e),r&&(y=r-i,e=y/Math.floor(y/e)),E=s;E<0;)f++,E=Math.round(s+f*e);for(k=Math.max(s,0);k<c;k++)k===E&&(n.push(t[k]),f++,E=Math.round(s+f*e))}const rV=(t,n,e)=>"top"===n||"left"===n?t[n]+e:t[n]-e,oV=(t,n)=>Math.min(n||t,t);function sV(t,n){const e=[],i=t.length/n,r=t.length;let s=0;for(;s<r;s+=i)e.push(t[Math.floor(s)]);return e}function _fe(t,n,e){const i=t.ticks.length,r=Math.min(n,i-1),s=t._startPixel,c=t._endPixel,f=1e-6;let k,y=t.getPixelForTick(r);if(!(e&&(k=1===i?Math.max(y-s,c-y):0===n?(t.getPixelForTick(1)-y)/2:(y-t.getPixelForTick(r-1))/2,y+=r<n?k:-k,y<s-f||y>c+f)))return y}function Qk(t){return t.drawTicks?t.tickLength:0}function aV(t,n){if(!t.display)return 0;const e=lc(t.font,n),i=Dd(t.padding);return(fa(t.text)?t.text.length:1)*e.lineHeight+i.height}function xfe(t,n,e){let i=YP(t);return(e&&"right"!==n||!e&&"right"===n)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class my extends fg{constructor(n){super(),this.id=n.id,this.type=n.type,this.options=void 0,this.ctx=n.ctx,this.chart=n.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(n){this.options=n.setContext(this.getContext()),this.axis=n.axis,this._userMin=this.parse(n.min),this._userMax=this.parse(n.max),this._suggestedMin=this.parse(n.suggestedMin),this._suggestedMax=this.parse(n.suggestedMax)}parse(n,e){return n}getUserBounds(){let{_userMin:n,_userMax:e,_suggestedMin:i,_suggestedMax:r}=this;return n=Qh(n,Number.POSITIVE_INFINITY),e=Qh(e,Number.NEGATIVE_INFINITY),i=Qh(i,Number.POSITIVE_INFINITY),r=Qh(r,Number.NEGATIVE_INFINITY),{min:Qh(n,i),max:Qh(e,r),minDefined:ul(n),maxDefined:ul(e)}}getMinMax(n){let c,{min:e,max:i,minDefined:r,maxDefined:s}=this.getUserBounds();if(r&&s)return{min:e,max:i};const f=this.getMatchingVisibleMetas();for(let y=0,k=f.length;y<k;++y)c=f[y].controller.getMinMax(this,n),r||(e=Math.min(e,c.min)),s||(i=Math.max(i,c.max));return e=s&&e>i?i:e,i=r&&e>i?e:i,{min:Qh(e,Qh(i,e)),max:Qh(i,Qh(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const n=this.chart.data;return this.options.labels||(this.isHorizontal()?n.xLabels:n.yLabels)||n.labels||[]}getLabelItems(n=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(n))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ta(this.options.beforeUpdate,[this])}update(n,e,i){const{beginAtZero:r,grace:s,ticks:c}=this.options,f=c.sampleSize;this.beforeUpdate(),this.maxWidth=n,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function Eue(t,n,e){const{min:i,max:r}=t,s=$N(n,(r-i)/2),c=(f,y)=>e&&0===f?0:f+y;return{min:c(i,-Math.abs(s)),max:c(r,s)}}(this,s,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const y=f<this.ticks.length;this._convertTicksToLabels(y?sV(this.ticks,f):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),c.display&&(c.autoSkip||"auto"===c.source)&&(this.ticks=function dfe(t,n){const e=t.options.ticks,i=function hfe(t){const n=t.options.offset,e=t._tickSize();return Math.floor(Math.min(t._length/e+(n?0:1),t._maxLength/e))}(t),r=Math.min(e.maxTicksLimit||i,i),s=e.major.enabled?function pfe(t){const n=[];let e,i;for(e=0,i=t.length;e<i;e++)t[e].major&&n.push(e);return n}(n):[],c=s.length,f=s[0],y=s[c-1],k=[];if(c>r)return function ffe(t,n,e,i){let c,r=0,s=e[0];for(i=Math.ceil(i),c=0;c<t.length;c++)c===s&&(n.push(t[c]),r++,s=e[r*i])}(n,k,s,c/r),k;const E=function ufe(t,n,e){const i=function mfe(t){const n=t.length;let e,i;if(n<2)return!1;for(i=t[0],e=1;e<n;++e)if(t[e]-t[e-1]!==i)return!1;return i}(t),r=n.length/e;if(!i)return Math.max(r,1);const s=function Qhe(t){const n=[],e=Math.sqrt(t);let i;for(i=1;i<e;i++)t%i==0&&(n.push(i),n.push(t/i));return e===(0|e)&&n.push(e),n.sort((r,s)=>r-s).pop(),n}(i);for(let c=0,f=s.length-1;c<f;c++){const y=s[c];if(y>r)return y}return Math.max(r,1)}(s,n,r);if(c>0){let F,$;const W=c>1?Math.round((y-f)/(c-1)):null;for(K5(n,k,E,Mo(W)?0:f-W,f),F=0,$=c-1;F<$;F++)K5(n,k,E,s[F],s[F+1]);return K5(n,k,E,y,Mo(W)?n.length:y+W),k}return K5(n,k,E),k}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),y&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,i,n=this.options.reverse;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,n=!n),this._startPixel=e,this._endPixel=i,this._reversePixels=n,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ta(this.options.afterUpdate,[this])}beforeSetDimensions(){ta(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ta(this.options.afterSetDimensions,[this])}_callHooks(n){this.chart.notifyPlugins(n,this.getContext()),ta(this.options[n],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ta(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(n){const e=this.options.ticks;let i,r,s;for(i=0,r=n.length;i<r;i++)s=n[i],s.label=ta(e.callback,[s.value,i,n],this)}afterTickToLabelConversion(){ta(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ta(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const n=this.options,e=n.ticks,i=oV(this.ticks.length,n.ticks.maxTicksLimit),r=e.minRotation||0,s=e.maxRotation;let f,y,k,c=r;if(!this._isVisible()||!e.display||r>=s||i<=1||!this.isHorizontal())return void(this.labelRotation=r);const E=this._getLabelSizes(),F=E.widest.width,$=E.highest.height,W=Rc(this.chart.width-F,0,this.maxWidth);f=n.offset?this.maxWidth/i:W/(i-1),F+6>f&&(f=W/(i-(n.offset?.5:1)),y=this.maxHeight-Qk(n.grid)-e.padding-aV(n.title,this.chart.options.font),k=Math.sqrt(F*F+$*$),c=GP(Math.min(Math.asin(Rc((E.highest.height+6)/f,-1,1)),Math.asin(Rc(y/k,-1,1))-Math.asin(Rc($/k,-1,1)))),c=Math.max(r,Math.min(s,c))),this.labelRotation=c}afterCalculateLabelRotation(){ta(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ta(this.options.beforeFit,[this])}fit(){const n={width:0,height:0},{chart:e,options:{ticks:i,title:r,grid:s}}=this,c=this._isVisible(),f=this.isHorizontal();if(c){const y=aV(r,e.options.font);if(f?(n.width=this.maxWidth,n.height=Qk(s)+y):(n.height=this.maxHeight,n.width=Qk(s)+y),i.display&&this.ticks.length){const{first:k,last:E,widest:F,highest:$}=this._getLabelSizes(),W=2*i.padding,re=Ap(this.labelRotation),he=Math.cos(re),me=Math.sin(re);f?n.height=Math.min(this.maxHeight,n.height+(i.mirror?0:me*F.width+he*$.height)+W):n.width=Math.min(this.maxWidth,n.width+(i.mirror?0:he*F.width+me*$.height)+W),this._calculatePadding(k,E,me,he)}}this._handleMargins(),f?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=n.height):(this.width=n.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(n,e,i,r){const{ticks:{align:s,padding:c},position:f}=this.options,y=0!==this.labelRotation,k="top"!==f&&"x"===this.axis;if(this.isHorizontal()){const E=this.getPixelForTick(0)-this.left,F=this.right-this.getPixelForTick(this.ticks.length-1);let $=0,W=0;y?k?($=r*n.width,W=i*e.height):($=i*n.height,W=r*e.width):"start"===s?W=e.width:"end"===s?$=n.width:"inner"!==s&&($=n.width/2,W=e.width/2),this.paddingLeft=Math.max(($-E+c)*this.width/(this.width-E),0),this.paddingRight=Math.max((W-F+c)*this.width/(this.width-F),0)}else{let E=e.height/2,F=n.height/2;"start"===s?(E=0,F=n.height):"end"===s&&(E=e.height,F=0),this.paddingTop=E+c,this.paddingBottom=F+c}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ta(this.options.afterFit,[this])}isHorizontal(){const{axis:n,position:e}=this.options;return"top"===e||"bottom"===e||"x"===n}isFullSize(){return this.options.fullSize}_convertTicksToLabels(n){let e,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(n),e=0,i=n.length;e<i;e++)Mo(n[e].label)&&(n.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let n=this._labelSizes;if(!n){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=sV(i,e)),this._labelSizes=n=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return n}_computeLabelSizes(n,e,i){const{ctx:r,_longestTextCache:s}=this,c=[],f=[],y=Math.floor(e/oV(e,i));let F,$,W,re,he,me,Pe,Re,rt,ft,Ct,k=0,E=0;for(F=0;F<e;F+=y){if(re=n[F].label,he=this._resolveTickFontOptions(F),r.font=me=he.string,Pe=s[me]=s[me]||{data:{},gc:[]},Re=he.lineHeight,rt=ft=0,Mo(re)||fa(re)){if(fa(re))for($=0,W=re.length;$<W;++$)Ct=re[$],!Mo(Ct)&&!fa(Ct)&&(rt=V5(r,Pe.data,Pe.gc,rt,Ct),ft+=Re)}else rt=V5(r,Pe.data,Pe.gc,rt,re),ft=Re;c.push(rt),f.push(ft),k=Math.max(rt,k),E=Math.max(ft,E)}!function yfe(t,n){Cs(t,e=>{const i=e.gc,r=i.length/2;let s;if(r>n){for(s=0;s<r;++s)delete e.data[i[s]];i.splice(0,r)}})}(s,e);const Vt=c.indexOf(k),sn=f.indexOf(E),Qt=Vn=>({width:c[Vn]||0,height:f[Vn]||0});return{first:Qt(0),last:Qt(e-1),widest:Qt(Vt),highest:Qt(sn),widths:c,heights:f}}getLabelForValue(n){return n}getPixelForValue(n,e){return NaN}getValueForPixel(n){}getPixelForTick(n){const e=this.ticks;return n<0||n>e.length-1?null:this.getPixelForValue(e[n].value)}getPixelForDecimal(n){this._reversePixels&&(n=1-n);const e=this._startPixel+n*this._length;return function nue(t){return Rc(t,-32768,32767)}(this._alignToPixels?ly(this.chart,e,0):e)}getDecimalForPixel(n){const e=(n-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:n,max:e}=this;return n<0&&e<0?e:n>0&&e>0?n:0}getContext(n){const e=this.ticks||[];if(n>=0&&n<e.length){const i=e[n];return i.$context||(i.$context=function bfe(t,n,e){return Z1(t,{tick:e,index:n,type:"tick"})}(this.getContext(),n,i))}return this.$context||(this.$context=function vfe(t,n){return Z1(t,{scale:n,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const n=this.options.ticks,e=Ap(this.labelRotation),i=Math.abs(Math.cos(e)),r=Math.abs(Math.sin(e)),s=this._getLabelSizes(),c=n.autoSkipPadding||0,f=s?s.widest.width+c:0,y=s?s.highest.height+c:0;return this.isHorizontal()?y*i>f*r?f/i:y/r:y*r<f*i?y/i:f/r}_isVisible(){const n=this.options.display;return"auto"!==n?!!n:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(n){const e=this.axis,i=this.chart,r=this.options,{grid:s,position:c,border:f}=r,y=s.offset,k=this.isHorizontal(),F=this.ticks.length+(y?1:0),$=Qk(s),W=[],re=f.setContext(this.getContext()),he=re.display?re.width:0,me=he/2,Pe=function(zn){return ly(i,zn,he)};let Re,rt,ft,Ct,Vt,sn,Qt,Vn,Hi,fr,Or,va;if("top"===c)Re=Pe(this.bottom),sn=this.bottom-$,Vn=Re-me,fr=Pe(n.top)+me,va=n.bottom;else if("bottom"===c)Re=Pe(this.top),fr=n.top,va=Pe(n.bottom)-me,sn=Re+me,Vn=this.top+$;else if("left"===c)Re=Pe(this.right),Vt=this.right-$,Qt=Re-me,Hi=Pe(n.left)+me,Or=n.right;else if("right"===c)Re=Pe(this.left),Hi=n.left,Or=Pe(n.right)-me,Vt=Re+me,Qt=this.left+$;else if("x"===e){if("center"===c)Re=Pe((n.top+n.bottom)/2+.5);else if(Po(c)){const zn=Object.keys(c)[0];Re=Pe(this.chart.scales[zn].getPixelForValue(c[zn]))}fr=n.top,va=n.bottom,sn=Re+me,Vn=sn+$}else if("y"===e){if("center"===c)Re=Pe((n.left+n.right)/2);else if(Po(c)){const zn=Object.keys(c)[0];Re=Pe(this.chart.scales[zn].getPixelForValue(c[zn]))}Vt=Re-me,Qt=Vt-$,Hi=n.left,Or=n.right}const Ad=Zr(r.ticks.maxTicksLimit,F),ss=Math.max(1,Math.ceil(F/Ad));for(rt=0;rt<F;rt+=ss){const zn=this.getContext(rt),Zn=s.setContext(zn),Oi=f.setContext(zn),sr=Zn.lineWidth,ba=Zn.color,th=Oi.dash||[],Yl=Oi.dashOffset,Eh=Zn.tickWidth,as=Zn.tickColor,o0=Zn.tickBorderDash||[],_g=Zn.tickBorderDashOffset;ft=_fe(this,rt,y),void 0!==ft&&(Ct=ly(i,ft,sr),k?Vt=Qt=Hi=Or=Ct:sn=Vn=fr=va=Ct,W.push({tx1:Vt,ty1:sn,tx2:Qt,ty2:Vn,x1:Hi,y1:fr,x2:Or,y2:va,width:sr,color:ba,borderDash:th,borderDashOffset:Yl,tickWidth:Eh,tickColor:as,tickBorderDash:o0,tickBorderDashOffset:_g}))}return this._ticksLength=F,this._borderValue=Re,W}_computeLabelItems(n){const e=this.axis,i=this.options,{position:r,ticks:s}=i,c=this.isHorizontal(),f=this.ticks,{align:y,crossAlign:k,padding:E,mirror:F}=s,$=Qk(i.grid),W=$+E,re=F?-E:W,he=-Ap(this.labelRotation),me=[];let Pe,Re,rt,ft,Ct,Vt,sn,Qt,Vn,Hi,fr,Or,va="middle";if("top"===r)Vt=this.bottom-re,sn=this._getXAxisLabelAlignment();else if("bottom"===r)Vt=this.top+re,sn=this._getXAxisLabelAlignment();else if("left"===r){const ss=this._getYAxisLabelAlignment($);sn=ss.textAlign,Ct=ss.x}else if("right"===r){const ss=this._getYAxisLabelAlignment($);sn=ss.textAlign,Ct=ss.x}else if("x"===e){if("center"===r)Vt=(n.top+n.bottom)/2+W;else if(Po(r)){const ss=Object.keys(r)[0];Vt=this.chart.scales[ss].getPixelForValue(r[ss])+W}sn=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===r)Ct=(n.left+n.right)/2-W;else if(Po(r)){const ss=Object.keys(r)[0];Ct=this.chart.scales[ss].getPixelForValue(r[ss])}sn=this._getYAxisLabelAlignment($).textAlign}"y"===e&&("start"===y?va="top":"end"===y&&(va="bottom"));const Ad=this._getLabelSizes();for(Pe=0,Re=f.length;Pe<Re;++Pe){rt=f[Pe],ft=rt.label;const ss=s.setContext(this.getContext(Pe));Qt=this.getPixelForTick(Pe)+s.labelOffset,Vn=this._resolveTickFontOptions(Pe),Hi=Vn.lineHeight,fr=fa(ft)?ft.length:1;const zn=fr/2,Zn=ss.color,Oi=ss.textStrokeColor,sr=ss.textStrokeWidth;let th,ba=sn;if(c?(Ct=Qt,"inner"===sn&&(ba=Pe===Re-1?this.options.reverse?"left":"right":0===Pe?this.options.reverse?"right":"left":"center"),Or="top"===r?"near"===k||0!==he?-fr*Hi+Hi/2:"center"===k?-Ad.highest.height/2-zn*Hi+Hi:Hi/2-Ad.highest.height:"near"===k||0!==he?Hi/2:"center"===k?Ad.highest.height/2-zn*Hi:Ad.highest.height-fr*Hi,F&&(Or*=-1),0!==he&&!ss.showLabelBackdrop&&(Ct+=Hi/2*Math.sin(he))):(Vt=Qt,Or=(1-fr)*Hi/2),ss.showLabelBackdrop){const Yl=Dd(ss.backdropPadding),Eh=Ad.heights[Pe],as=Ad.widths[Pe];let o0=Or-Yl.top,_g=0-Yl.left;switch(va){case"middle":o0-=Eh/2;break;case"bottom":o0-=Eh}switch(sn){case"center":_g-=as/2;break;case"right":_g-=as;break;case"inner":Pe===Re-1?_g-=as:Pe>0&&(_g-=as/2)}th={left:_g,top:o0,width:as+Yl.width,height:Eh+Yl.height,color:ss.backdropColor}}me.push({label:ft,font:Vn,textOffset:Or,options:{rotation:he,color:Zn,strokeColor:Oi,strokeWidth:sr,textAlign:ba,textBaseline:va,translation:[Ct,Vt],backdrop:th}})}return me}_getXAxisLabelAlignment(){const{position:n,ticks:e}=this.options;if(-Ap(this.labelRotation))return"top"===n?"left":"right";let r="center";return"start"===e.align?r="left":"end"===e.align?r="right":"inner"===e.align&&(r="inner"),r}_getYAxisLabelAlignment(n){const{position:e,ticks:{crossAlign:i,mirror:r,padding:s}}=this.options,f=n+s,y=this._getLabelSizes().widest.width;let k,E;return"left"===e?r?(E=this.right+s,"near"===i?k="left":"center"===i?(k="center",E+=y/2):(k="right",E+=y)):(E=this.right-f,"near"===i?k="right":"center"===i?(k="center",E-=y/2):(k="left",E=this.left)):"right"===e?r?(E=this.left+s,"near"===i?k="right":"center"===i?(k="center",E-=y/2):(k="left",E-=y)):(E=this.left+f,"near"===i?k="left":"center"===i?(k="center",E+=y/2):(k="right",E=this.right)):k="right",{textAlign:k,x:E}}_computeLabelArea(){if(this.options.ticks.mirror)return;const n=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:n.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:n.width}:void 0}drawBackground(){const{ctx:n,options:{backgroundColor:e},left:i,top:r,width:s,height:c}=this;e&&(n.save(),n.fillStyle=e,n.fillRect(i,r,s,c),n.restore())}getLineWidthForValue(n){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const r=this.ticks.findIndex(s=>s.value===n);return r>=0?e.setContext(this.getContext(r)).lineWidth:0}drawGrid(n){const e=this.options.grid,i=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(n));let s,c;const f=(y,k,E)=>{!E.width||!E.color||(i.save(),i.lineWidth=E.width,i.strokeStyle=E.color,i.setLineDash(E.borderDash||[]),i.lineDashOffset=E.borderDashOffset,i.beginPath(),i.moveTo(y.x,y.y),i.lineTo(k.x,k.y),i.stroke(),i.restore())};if(e.display)for(s=0,c=r.length;s<c;++s){const y=r[s];e.drawOnChartArea&&f({x:y.x1,y:y.y1},{x:y.x2,y:y.y2},y),e.drawTicks&&f({x:y.tx1,y:y.ty1},{x:y.tx2,y:y.ty2},{color:y.tickColor,width:y.tickWidth,borderDash:y.tickBorderDash,borderDashOffset:y.tickBorderDashOffset})}}drawBorder(){const{chart:n,ctx:e,options:{border:i,grid:r}}=this,s=i.setContext(this.getContext()),c=i.display?s.width:0;if(!c)return;const f=r.setContext(this.getContext(0)).lineWidth,y=this._borderValue;let k,E,F,$;this.isHorizontal()?(k=ly(n,this.left,c)-c/2,E=ly(n,this.right,f)+f/2,F=$=y):(F=ly(n,this.top,c)-c/2,$=ly(n,this.bottom,f)+f/2,k=E=y),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(k,F),e.lineTo(E,$),e.stroke(),e.restore()}drawLabels(n){if(!this.options.ticks.display)return;const i=this.ctx,r=this._computeLabelArea();r&&j5(i,r);const s=this.getLabelItems(n);for(const c of s)cy(i,c.label,0,c.textOffset,c.font,c.options);r&&H5(i)}drawTitle(){const{ctx:n,options:{position:e,title:i,reverse:r}}=this;if(!i.display)return;const s=lc(i.font),c=Dd(i.padding),f=i.align;let y=s.lineHeight/2;"bottom"===e||"center"===e||Po(e)?(y+=c.bottom,fa(i.text)&&(y+=s.lineHeight*(i.text.length-1))):y+=c.top;const{titleX:k,titleY:E,maxWidth:F,rotation:$}=function wfe(t,n,e,i){const{top:r,left:s,bottom:c,right:f,chart:y}=t,{chartArea:k,scales:E}=y;let $,W,re,F=0;const he=c-r,me=f-s;if(t.isHorizontal()){if(W=Ed(i,s,f),Po(e)){const Pe=Object.keys(e)[0];re=E[Pe].getPixelForValue(e[Pe])+he-n}else re="center"===e?(k.bottom+k.top)/2+he-n:rV(t,e,n);$=f-s}else{if(Po(e)){const Pe=Object.keys(e)[0];W=E[Pe].getPixelForValue(e[Pe])-me+n}else W="center"===e?(k.left+k.right)/2-me+n:rV(t,e,n);re=Ed(i,c,r),F="left"===e?-Al:Al}return{titleX:W,titleY:re,maxWidth:$,rotation:F}}(this,y,e,f);cy(n,i.text,0,0,s,{color:i.color,maxWidth:F,rotation:$,textAlign:xfe(f,e,r),textBaseline:"middle",translation:[k,E]})}draw(n){this._isVisible()&&(this.drawBackground(),this.drawGrid(n),this.drawBorder(),this.drawTitle(),this.drawLabels(n))}_layers(){const n=this.options,e=n.ticks&&n.ticks.z||0,i=Zr(n.grid&&n.grid.z,-1),r=Zr(n.border&&n.border.z,0);return this._isVisible()&&this.draw===my.prototype.draw?[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:r,draw:()=>{this.drawBorder()}},{z:e,draw:s=>{this.drawLabels(s)}}]:[{z:e,draw:s=>{this.draw(s)}}]}getMatchingVisibleMetas(n){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",r=[];let s,c;for(s=0,c=e.length;s<c;++s){const f=e[s];f[i]===this.id&&(!n||f.type===n)&&r.push(f)}return r}_resolveTickFontOptions(n){return lc(this.options.ticks.setContext(this.getContext(n)).font)}_maxDigits(){const n=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/n}}class Q5{constructor(n,e,i){this.type=n,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(n){return Object.prototype.isPrototypeOf.call(this.type.prototype,n.prototype)}register(n){const e=Object.getPrototypeOf(n);let i;(function Cfe(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const r=this.items,s=n.id,c=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+n);return s in r||(r[s]=n,function kfe(t,n,e){const i=Fk(Object.create(null),[e?_a.get(e):{},_a.get(n),t.defaults]);_a.set(n,i),t.defaultRoutes&&function Mfe(t,n){Object.keys(n).forEach(e=>{const i=e.split("."),r=i.pop(),s=[t].concat(i).join("."),c=n[e].split("."),f=c.pop(),y=c.join(".");_a.route(s,r,y,f)})}(n,t.defaultRoutes),t.descriptors&&_a.describe(n,t.descriptors)}(n,c,i),this.override&&_a.override(n.id,n.overrides)),c}get(n){return this.items[n]}unregister(n){const e=this.items,i=n.id,r=this.scope;i in e&&delete e[i],r&&i in _a[r]&&(delete _a[r][i],this.override&&delete ay[i])}}class Sfe{constructor(){this.controllers=new Q5(Y1,"datasets",!0),this.elements=new Q5(fg,"elements"),this.plugins=new Q5(Object,"plugins"),this.scales=new Q5(my,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...n){this._each("register",n)}remove(...n){this._each("unregister",n)}addControllers(...n){this._each("register",n,this.controllers)}addElements(...n){this._each("register",n,this.elements)}addPlugins(...n){this._each("register",n,this.plugins)}addScales(...n){this._each("register",n,this.scales)}getController(n){return this._get(n,this.controllers,"controller")}getElement(n){return this._get(n,this.elements,"element")}getPlugin(n){return this._get(n,this.plugins,"plugin")}getScale(n){return this._get(n,this.scales,"scale")}removeControllers(...n){this._each("unregister",n,this.controllers)}removeElements(...n){this._each("unregister",n,this.elements)}removePlugins(...n){this._each("unregister",n,this.plugins)}removeScales(...n){this._each("unregister",n,this.scales)}_each(n,e,i){[...e].forEach(r=>{const s=i||this._getRegistryForType(r);i||s.isForType(r)||s===this.plugins&&r.id?this._exec(n,s,r):Cs(r,c=>{const f=i||this._getRegistryForType(c);this._exec(n,f,c)})})}_exec(n,e,i){const r=$P(n);ta(i["before"+r],[],i),e[n](i),ta(i["after"+r],[],i)}_getRegistryForType(n){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(n))return i}return this.plugins}_get(n,e,i){const r=e.get(n);if(void 0===r)throw new Error('"'+n+'" is not a registered '+i+".");return r}}var Hf=new Sfe;class Efe{constructor(){this._init=[]}notify(n,e,i,r){"beforeInit"===e&&(this._init=this._createDescriptors(n,!0),this._notify(this._init,n,"install"));const s=r?this._descriptors(n).filter(r):this._descriptors(n),c=this._notify(s,n,e,i);return"afterDestroy"===e&&(this._notify(s,n,"stop"),this._notify(this._init,n,"uninstall")),c}_notify(n,e,i,r){r=r||{};for(const s of n){const c=s.plugin;if(!1===ta(c[i],[e,r,s.options],c)&&r.cancelable)return!1}return!0}invalidate(){Mo(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(n){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(n);return this._notifyStateChanges(n),e}_createDescriptors(n,e){const i=n&&n.config,r=Zr(i.options&&i.options.plugins,{}),s=function Dfe(t){const n={},e=[],i=Object.keys(Hf.plugins.items);for(let s=0;s<i.length;s++)e.push(Hf.getPlugin(i[s]));const r=t.plugins||[];for(let s=0;s<r.length;s++){const c=r[s];-1===e.indexOf(c)&&(e.push(c),n[c.id]=!0)}return{plugins:e,localIds:n}}(i);return!1!==r||e?function Afe(t,{plugins:n,localIds:e},i,r){const s=[],c=t.getContext();for(const f of n){const y=f.id,k=Tfe(i[y],r);null!==k&&s.push({plugin:f,options:Pfe(t.config,{plugin:f,local:e[y]},k,c)})}return s}(n,s,r,e):[]}_notifyStateChanges(n){const e=this._oldCache||[],i=this._cache,r=(s,c)=>s.filter(f=>!c.some(y=>f.plugin.id===y.plugin.id));this._notify(r(e,i),n,"stop"),this._notify(r(i,e),n,"start")}}function Tfe(t,n){return n||!1!==t?!0===t?{}:t:null}function Pfe(t,{plugin:n,local:e},i,r){const s=t.pluginScopeKeys(n),c=t.getOptionScopes(i,s);return e&&n.defaults&&c.push(n.defaults),t.createResolver(c,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function gI(t,n){return((n.datasets||{})[t]||{}).indexAxis||n.indexAxis||(_a.datasets[t]||{}).indexAxis||"x"}function lV(t){if("x"===t||"y"===t||"r"===t)return t}function Rfe(t){return"top"===t||"bottom"===t?"x":"left"===t||"right"===t?"y":void 0}function _I(t,...n){if(lV(t))return t;for(const e of n){const i=e.axis||Rfe(e.position)||t.length>1&&lV(t[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function cV(t,n,e){if(e[n+"AxisID"]===t)return{axis:n}}function dV(t){const n=t.options||(t.options={});n.plugins=Zr(n.plugins,{}),n.scales=function Ffe(t,n){const e=ay[t.type]||{scales:{}},i=n.scales||{},r=gI(t.type,n),s=Object.create(null);return Object.keys(i).forEach(c=>{const f=i[c];if(!Po(f))return console.error(`Invalid scale configuration for scale: ${c}`);if(f._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${c}`);const y=_I(c,f,function Lfe(t,n){if(n.data&&n.data.datasets){const e=n.data.datasets.filter(i=>i.xAxisID===t||i.yAxisID===t);if(e.length)return cV(t,"x",e[0])||cV(t,"y",e[0])}return{}}(c,t),_a.scales[f.type]),k=function Ofe(t,n){return t===n?"_index_":"_value_"}(y,r),E=e.scales||{};s[c]=zk(Object.create(null),[{axis:y},f,E[y],E[k]])}),t.data.datasets.forEach(c=>{const f=c.type||t.type,y=c.indexAxis||gI(f,n),E=(ay[f]||{}).scales||{};Object.keys(E).forEach(F=>{const $=function Ife(t,n){let e=t;return"_index_"===t?e=n:"_value_"===t&&(e="x"===n?"y":"x"),e}(F,y),W=c[$+"AxisID"]||$;s[W]=s[W]||Object.create(null),zk(s[W],[{axis:$},i[W],E[F]])})}),Object.keys(s).forEach(c=>{const f=s[c];zk(f,[_a.scales[f.type],_a.scale])}),s}(t,n)}function hV(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const uV=new Map,pV=new Set;function J5(t,n){let e=uV.get(t);return e||(e=n(),uV.set(t,e),pV.add(e)),e}const Jk=(t,n,e)=>{const i=$1(n,e);void 0!==i&&t.add(i)};class Nfe{constructor(n){this._config=function zfe(t){return(t=t||{}).data=hV(t.data),dV(t),t}(n),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(n){this._config.type=n}get data(){return this._config.data}set data(n){this._config.data=hV(n)}get options(){return this._config.options}set options(n){this._config.options=n}get plugins(){return this._config.plugins}update(){const n=this._config;this.clearCache(),dV(n)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(n){return J5(n,()=>[[`datasets.${n}`,""]])}datasetAnimationScopeKeys(n,e){return J5(`${n}.transition.${e}`,()=>[[`datasets.${n}.transitions.${e}`,`transitions.${e}`],[`datasets.${n}`,""]])}datasetElementScopeKeys(n,e){return J5(`${n}-${e}`,()=>[[`datasets.${n}.elements.${e}`,`datasets.${n}`,`elements.${e}`,""]])}pluginScopeKeys(n){const e=n.id;return J5(`${this.type}-plugin-${e}`,()=>[[`plugins.${e}`,...n.additionalOptionScopes||[]]])}_cachedScopes(n,e){const i=this._scopeCache;let r=i.get(n);return(!r||e)&&(r=new Map,i.set(n,r)),r}getOptionScopes(n,e,i){const{options:r,type:s}=this,c=this._cachedScopes(n,i),f=c.get(e);if(f)return f;const y=new Set;e.forEach(E=>{n&&(y.add(n),E.forEach(F=>Jk(y,n,F))),E.forEach(F=>Jk(y,r,F)),E.forEach(F=>Jk(y,ay[s]||{},F)),E.forEach(F=>Jk(y,_a,F)),E.forEach(F=>Jk(y,QP,F))});const k=Array.from(y);return 0===k.length&&k.push(Object.create(null)),pV.has(e)&&c.set(e,k),k}chartOptionScopes(){const{options:n,type:e}=this;return[n,ay[e]||{},_a.datasets[e]||{},{type:e},_a,QP]}resolveNamedOptions(n,e,i,r=[""]){const s={$shared:!0},{resolver:c,subPrefixes:f}=fV(this._resolverCache,n,r);let y=c;(function Vfe(t,n){const{isScriptable:e,isIndexable:i}=mB(t);for(const r of n){const s=e(r),c=i(r),f=(c||s)&&t[r];if(s&&(G1(f)||Bfe(f))||c&&fa(f))return!0}return!1})(c,e)&&(s.$shared=!1,y=rb(c,i=G1(i)?i():i,this.createResolver(n,i,f)));for(const k of e)s[k]=y[k];return s}createResolver(n,e,i=[""],r){const{resolver:s}=fV(this._resolverCache,n,i);return Po(e)?rb(s,e,void 0,r):s}}function fV(t,n,e){let i=t.get(n);i||(i=new Map,t.set(n,i));const r=e.join();let s=i.get(r);return s||(s={resolver:nI(n,e),subPrefixes:e.filter(f=>!f.toLowerCase().includes("hover"))},i.set(r,s)),s}const Bfe=t=>Po(t)&&Object.getOwnPropertyNames(t).some(n=>G1(t[n])),Hfe=["top","bottom","left","right","chartArea"];function mV(t,n){return"top"===t||"bottom"===t||-1===Hfe.indexOf(t)&&"x"===n}function gV(t,n){return function(e,i){return e[t]===i[t]?e[n]-i[n]:e[t]-i[t]}}function _V(t){const n=t.chart,e=n.options.animation;n.notifyPlugins("afterRender"),ta(e&&e.onComplete,[t],n)}function Ufe(t){const n=t.chart,e=n.options.animation;ta(e&&e.onProgress,[t],n)}function yV(t){return oI()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const eS={},vV=t=>{const n=yV(t);return Object.values(eS).filter(e=>e.canvas===n).pop()};function qfe(t,n,e){const i=Object.keys(t);for(const r of i){const s=+r;if(s>=n){const c=t[r];delete t[r],(e>0||s>n)&&(t[s+e]=c)}}}let tS=(()=>class t{static defaults=_a;static instances=eS;static overrides=ay;static registry=Hf;static version="4.4.9";static getChart=vV;static register(...e){Hf.add(...e),bV()}static unregister(...e){Hf.remove(...e),bV()}constructor(e,i){const r=this.config=new Nfe(i),s=yV(e),c=vV(s);if(c)throw new Error("Canvas is already in use. Chart with ID '"+c.id+"' must be destroyed before the canvas with ID '"+c.canvas.id+"' can be reused.");const f=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||function cfe(t){return!oI()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?Xpe:lfe}(s)),this.platform.updateConfig(r);const y=this.platform.acquireContext(s,f.aspectRatio),k=y&&y.canvas,E=k&&k.height,F=k&&k.width;this.id=Uhe(),this.ctx=y,this.canvas=k,this.width=F,this.height=E,this._options=f,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Efe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function sue(t,n){let e;return function(...i){return n?(clearTimeout(e),e=setTimeout(t,n,i)):t.apply(this,i),n}}($=>this.update($),f.resizeDelay||0),this._dataChanges=[],eS[this.id]=this,y&&k?(pg.listen(this,"complete",_V),pg.listen(this,"progress",Ufe),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:i},width:r,height:s,_aspectRatio:c}=this;return Mo(e)?i&&c?c:s?r/s:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Hf}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():kB(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return uB(this.canvas,this.ctx),this}stop(){return pg.stop(this),this}resize(e,i){pg.running(this)?this._resizeBeforeDraw={width:e,height:i}:this._resize(e,i)}_resize(e,i){const r=this.options,f=this.platform.getMaximumSize(this.canvas,e,i,r.maintainAspectRatio&&this.aspectRatio),y=r.devicePixelRatio||this.platform.getDevicePixelRatio(),k=this.width?"resize":"attach";this.width=f.width,this.height=f.height,this._aspectRatio=this.aspectRatio,kB(this,y,!0)&&(this.notifyPlugins("resize",{size:f}),ta(r.onResize,[this,f],this),this.attached&&this._doResize(k)&&this.render())}ensureScalesHaveIDs(){Cs(this.options.scales||{},(r,s)=>{r.id=s})}buildOrUpdateScales(){const e=this.options,i=e.scales,r=this.scales,s=Object.keys(r).reduce((f,y)=>(f[y]=!1,f),{});let c=[];i&&(c=c.concat(Object.keys(i).map(f=>{const y=i[f],k=_I(f,y),E="r"===k,F="x"===k;return{options:y,dposition:E?"chartArea":F?"bottom":"left",dtype:E?"radialLinear":F?"category":"linear"}}))),Cs(c,f=>{const y=f.options,k=y.id,E=_I(k,y),F=Zr(y.type,f.dtype);(void 0===y.position||mV(y.position,E)!==mV(f.dposition))&&(y.position=f.dposition),s[k]=!0;let $=null;k in r&&r[k].type===F?$=r[k]:($=new(Hf.getScale(F))({id:k,type:F,ctx:this.ctx,chart:this}),r[$.id]=$),$.init(y,e)}),Cs(s,(f,y)=>{f||delete r[y]}),Cs(r,f=>{Td.configure(this,f,f.options),Td.addBox(this,f)})}_updateMetasets(){const e=this._metasets,i=this.data.datasets.length,r=e.length;if(e.sort((s,c)=>s.index-c.index),r>i){for(let s=i;s<r;++s)this._destroyDatasetMeta(s);e.splice(i,r-i)}this._sortedMetasets=e.slice(0).sort(gV("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:i}}=this;e.length>i.length&&delete this._stacks,e.forEach((r,s)=>{0===i.filter(c=>c===r._dataset).length&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const e=[],i=this.data.datasets;let r,s;for(this._removeUnreferencedMetasets(),r=0,s=i.length;r<s;r++){const c=i[r];let f=this.getDatasetMeta(r);const y=c.type||this.config.type;if(f.type&&f.type!==y&&(this._destroyDatasetMeta(r),f=this.getDatasetMeta(r)),f.type=y,f.indexAxis=c.indexAxis||gI(y,this.options),f.order=c.order||0,f.index=r,f.label=""+c.label,f.visible=this.isDatasetVisible(r),f.controller)f.controller.updateIndex(r),f.controller.linkScales();else{const k=Hf.getController(y),{datasetElementType:E,dataElementType:F}=_a.datasets[y];Object.assign(k,{dataElementType:Hf.getElement(F),datasetElementType:E&&Hf.getElement(E)}),f.controller=new k(this,r),e.push(f.controller)}}return this._updateMetasets(),e}_resetElements(){Cs(this.data.datasets,(e,i)=>{this.getDatasetMeta(i).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const i=this.config;i.update();const r=this._options=i.createResolver(i.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const c=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let f=0;for(let E=0,F=this.data.datasets.length;E<F;E++){const{controller:$}=this.getDatasetMeta(E),W=!s&&-1===c.indexOf($);$.buildOrUpdateElements(W),f=Math.max(+$.getMaxOverflow(),f)}f=this._minPadding=r.layout.autoPadding?f:0,this._updateLayout(f),s||Cs(c,E=>{E.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(gV("z","_idx"));const{_active:y,_lastEvent:k}=this;k?this._eventHandler(k,!0):y.length&&this._updateHoverStyles(y,y,!0),this.render()}_updateScales(){Cs(this.scales,e=>{Td.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,i=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!ZN(i,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,i=this._getUniformDataChanges()||[];for(const{method:r,start:s,count:c}of i)qfe(e,s,"_removeElements"===r?-c:c)}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const i=this.data.datasets.length,r=c=>new Set(e.filter(f=>f[0]===c).map((f,y)=>y+","+f.splice(1).join(","))),s=r(0);for(let c=1;c<i;c++)if(!ZN(s,r(c)))return;return Array.from(s).map(c=>c.split(",")).map(c=>({method:c[1],start:+c[2],count:+c[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Td.update(this,this.width,this.height,e);const i=this.chartArea,r=i.width<=0||i.height<=0;this._layers=[],Cs(this.boxes,s=>{r&&"chartArea"===s.position||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,c)=>{s._idx=c}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let i=0,r=this.data.datasets.length;i<r;++i)this.getDatasetMeta(i).controller.configure();for(let i=0,r=this.data.datasets.length;i<r;++i)this._updateDataset(i,G1(e)?e({datasetIndex:i}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,i){const r=this.getDatasetMeta(e),s={meta:r,index:e,mode:i,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",s)&&(r.controller._update(i),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(pg.has(this)?this.attached&&!pg.running(this)&&pg.start(this):(this.draw(),_V({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,s)}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const i=this._layers;for(e=0;e<i.length&&i[e].z<=0;++e)i[e].draw(this.chartArea);for(this._drawDatasets();e<i.length;++e)i[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const i=this._sortedMetasets,r=[];let s,c;for(s=0,c=i.length;s<c;++s){const f=i[s];(!e||f.visible)&&r.push(f)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let i=e.length-1;i>=0;--i)this._drawDataset(e[i]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const i=this.ctx,r={meta:e,index:e.index,cancelable:!0},s=OB(this,e);!1!==this.notifyPlugins("beforeDatasetDraw",r)&&(s&&j5(i,s),e.controller.draw(),s&&H5(i),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return ug(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,i,r,s){const c=Hpe.modes[i];return"function"==typeof c?c(this,e,r,s):[]}getDatasetMeta(e){const i=this.data.datasets[e],r=this._metasets;let s=r.filter(c=>c&&c._dataset===i).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:i&&i.order||0,index:e,_dataset:i,_parsed:[],_sorted:!1},r.push(s)),s}getContext(){return this.$context||(this.$context=Z1(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const i=this.data.datasets[e];if(!i)return!1;const r=this.getDatasetMeta(e);return"boolean"==typeof r.hidden?!r.hidden:!i.hidden}setDatasetVisibility(e,i){this.getDatasetMeta(e).hidden=!i}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,i,r){const s=r?"show":"hide",c=this.getDatasetMeta(e),f=c.controller._resolveAnimations(void 0,s);Nk(i)?(c.data[i].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),f.update(c,{visible:r}),this.update(y=>y.datasetIndex===e?s:void 0))}hide(e,i){this._updateVisibility(e,i,!1)}show(e,i){this._updateVisibility(e,i,!0)}_destroyDatasetMeta(e){const i=this._metasets[e];i&&i.controller&&i.controller._destroy(),delete this._metasets[e]}_stop(){let e,i;for(this.stop(),pg.remove(this),e=0,i=this.data.datasets.length;e<i;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:i}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),uB(e,i),this.platform.releaseContext(i),this.canvas=null,this.ctx=null),delete eS[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,i=this.platform,r=(c,f)=>{i.addEventListener(this,c,f),e[c]=f},s=(c,f,y)=>{c.offsetX=f,c.offsetY=y,this._eventHandler(c)};Cs(this.options.events,c=>r(c,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,i=this.platform,r=(k,E)=>{i.addEventListener(this,k,E),e[k]=E},s=(k,E)=>{e[k]&&(i.removeEventListener(this,k,E),delete e[k])},c=(k,E)=>{this.canvas&&this.resize(k,E)};let f;const y=()=>{s("attach",y),this.attached=!0,this.resize(),r("resize",c),r("detach",f)};f=()=>{this.attached=!1,s("resize",c),this._stop(),this._resize(0,0),r("attach",y)},i.isAttached(this.canvas)?y():f()}unbindEvents(){Cs(this._listeners,(e,i)=>{this.platform.removeEventListener(this,i,e)}),this._listeners={},Cs(this._responsiveListeners,(e,i)=>{this.platform.removeEventListener(this,i,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,i,r){const s=r?"set":"remove";let c,f,y,k;for("dataset"===i&&(c=this.getDatasetMeta(e[0].datasetIndex),c.controller["_"+s+"DatasetHoverStyle"]()),y=0,k=e.length;y<k;++y){f=e[y];const E=f&&this.getDatasetMeta(f.datasetIndex).controller;E&&E[s+"HoverStyle"](f.element,f.datasetIndex,f.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const i=this._active||[],r=e.map(({datasetIndex:c,index:f})=>{const y=this.getDatasetMeta(c);if(!y)throw new Error("No dataset found at index "+c);return{datasetIndex:c,element:y.data[f],index:f}});!L5(r,i)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,i))}notifyPlugins(e,i,r){return this._plugins.notify(this,e,i,r)}isPluginEnabled(e){return 1===this._plugins._cache.filter(i=>i.plugin.id===e).length}_updateHoverStyles(e,i,r){const s=this.options.hover,c=(k,E)=>k.filter(F=>!E.some($=>F.datasetIndex===$.datasetIndex&&F.index===$.index)),f=c(i,e),y=r?e:c(e,i);f.length&&this.updateHoverStyle(f,s.mode,!1),y.length&&s.mode&&this.updateHoverStyle(y,s.mode,!0)}_eventHandler(e,i){const r={event:e,replay:i,cancelable:!0,inChartArea:this.isPointInArea(e)},s=f=>(f.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",r,s))return;const c=this._handleEvent(e,i,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,s),(c||r.changed)&&this.render(),this}_handleEvent(e,i,r){const{_active:s=[],options:c}=this,y=this._getActiveElements(e,s,r,i),k=function Yhe(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(e),E=function $fe(t,n,e,i){return e&&"mouseout"!==t.type?i?n:t:null}(e,this._lastEvent,r,k);r&&(this._lastEvent=null,ta(c.onHover,[e,y,this],this),k&&ta(c.onClick,[e,y,this],this));const F=!L5(y,s);return(F||i)&&(this._active=y,this._updateHoverStyles(y,s,i)),this._lastEvent=E,F}_getActiveElements(e,i,r,s){if("mouseout"===e.type)return[];if(!r)return i;const c=this.options.hover;return this.getElementsAtEventForMode(e,c.mode,c,s)}})();function bV(){return Cs(tS.instances,t=>t._plugins.invalidate())}function ab(t,n,e,i){return{x:e+t*Math.cos(n),y:i+t*Math.sin(n)}}function nS(t,n,e,i,r,s){const{x:c,y:f,startAngle:y,pixelMargin:k,innerRadius:E}=n,F=Math.max(n.outerRadius+i+e-k,0),$=E>0?E+i+e+k:0;let W=0;const re=r-y;if(i){const Zn=((E>0?E-i:0)+(F>0?F-i:0))/2;W=(re-(0!==Zn?re*Zn/(Zn+i):re))/2}const me=(re-Math.max(.001,re*F-e/ma)/F)/2,Pe=y+me+W,Re=r-me-W,{outerStart:rt,outerEnd:ft,innerStart:Ct,innerEnd:Vt}=function Zfe(t,n,e,i){const r=function Wfe(t){return tI(t,["outerStart","outerEnd","innerStart","innerEnd"])}(t.options.borderRadius),s=(e-n)/2,c=Math.min(s,i*n/2),f=y=>{const k=(e-Math.min(s,y))*i/2;return Rc(y,0,Math.min(s,k))};return{outerStart:f(r.outerStart),outerEnd:f(r.outerEnd),innerStart:Rc(r.innerStart,0,c),innerEnd:Rc(r.innerEnd,0,c)}}(n,$,F,Re-Pe),sn=F-rt,Qt=F-ft,Vn=Pe+rt/sn,Hi=Re-ft/Qt,fr=$+Ct,Or=$+Vt,va=Pe+Ct/fr,Ad=Re-Vt/Or;if(t.beginPath(),s){const ss=(Vn+Hi)/2;if(t.arc(c,f,F,Vn,ss),t.arc(c,f,F,ss,Hi),ft>0){const sr=ab(Qt,Hi,c,f);t.arc(sr.x,sr.y,ft,Hi,Re+Al)}const zn=ab(Or,Re,c,f);if(t.lineTo(zn.x,zn.y),Vt>0){const sr=ab(Or,Ad,c,f);t.arc(sr.x,sr.y,Vt,Re+Al,Ad+Math.PI)}const Zn=(Re-Vt/$+(Pe+Ct/$))/2;if(t.arc(c,f,$,Re-Vt/$,Zn,!0),t.arc(c,f,$,Zn,Pe+Ct/$,!0),Ct>0){const sr=ab(fr,va,c,f);t.arc(sr.x,sr.y,Ct,va+Math.PI,Pe-Al)}const Oi=ab(sn,Pe,c,f);if(t.lineTo(Oi.x,Oi.y),rt>0){const sr=ab(sn,Vn,c,f);t.arc(sr.x,sr.y,rt,Pe-Al,Vn)}}else{t.moveTo(c,f);const ss=Math.cos(Vn)*F+c,zn=Math.sin(Vn)*F+f;t.lineTo(ss,zn);const Zn=Math.cos(Hi)*F+c,Oi=Math.sin(Hi)*F+f;t.lineTo(Zn,Oi)}t.closePath()}function xV(t,n,e=n){t.lineCap=Zr(e.borderCapStyle,n.borderCapStyle),t.setLineDash(Zr(e.borderDash,n.borderDash)),t.lineDashOffset=Zr(e.borderDashOffset,n.borderDashOffset),t.lineJoin=Zr(e.borderJoinStyle,n.borderJoinStyle),t.lineWidth=Zr(e.borderWidth,n.borderWidth),t.strokeStyle=Zr(e.borderColor,n.borderColor)}function Qfe(t,n,e){t.lineTo(e.x,e.y)}function wV(t,n,e={}){const i=t.length,{start:r=0,end:s=i-1}=e,{start:c,end:f}=n,y=Math.max(r,c),k=Math.min(s,f);return{count:i,start:y,loop:n.loop,ilen:k<y&&!(r<c&&s<c||r>f&&s>f)?i+k-y:k-y}}function eme(t,n,e,i){const{points:r,options:s}=n,{count:c,start:f,loop:y,ilen:k}=wV(r,e,i),E=function Jfe(t){return t.stepped?yue:t.tension||"monotone"===t.cubicInterpolationMode?vue:Qfe}(s);let W,re,he,{move:F=!0,reverse:$}=i||{};for(W=0;W<=k;++W)re=r[(f+($?k-W:W))%c],!re.skip&&(F?(t.moveTo(re.x,re.y),F=!1):E(t,he,re,$,s.stepped),he=re);return y&&(re=r[(f+($?k:0))%c],E(t,he,re,$,s.stepped)),!!y}function tme(t,n,e,i){const r=n.points,{count:s,start:c,ilen:f}=wV(r,e,i),{move:y=!0,reverse:k}=i||{};let $,W,re,he,me,Pe,E=0,F=0;const Re=ft=>(c+(k?f-ft:ft))%s,rt=()=>{he!==me&&(t.lineTo(E,me),t.lineTo(E,he),t.lineTo(E,Pe))};for(y&&(W=r[Re(0)],t.moveTo(W.x,W.y)),$=0;$<=f;++$){if(W=r[Re($)],W.skip)continue;const ft=W.x,Ct=W.y,Vt=0|ft;Vt===re?(Ct<he?he=Ct:Ct>me&&(me=Ct),E=(F*E+ft)/++F):(rt(),t.lineTo(ft,Ct),re=Vt,F=0,he=me=Ct),Pe=Ct}rt()}function yI(t){const n=t.options;return t._decimated||t._loop||n.tension||"monotone"===n.cubicInterpolationMode||n.stepped||n.borderDash&&n.borderDash.length?eme:tme}const ome="function"==typeof Path2D;let iS=(()=>class t extends fg{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,i){const r=this.options;!r.tension&&"monotone"!==r.cubicInterpolationMode||r.stepped||this._pointsUpdated||(Uue(this._points,r,e,r.spanGaps?this._loop:this._fullLoop,i),this._pointsUpdated=!0)}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function rpe(t,n){const e=t.points,i=t.options.spanGaps,r=e.length;if(!r)return[];const s=!!t._loop,{start:c,end:f}=function npe(t,n,e,i){let r=0,s=n-1;if(e&&!i)for(;r<n&&!t[r].skip;)r++;for(;r<n&&t[r].skip;)r++;for(r%=n,e&&(s+=r);s>r&&t[s%n].skip;)s--;return s%=n,{start:r,end:s}}(e,r,s,i);return function PB(t,n,e,i){return i&&i.setContext&&e?function ope(t,n,e,i){const r=t._chart.getContext(),s=IB(t.options),{_datasetIndex:c,options:{spanGaps:f}}=t,y=e.length,k=[];let E=s,F=n[0].start,$=F;function W(re,he,me,Pe){const Re=f?-1:1;if(re!==he){for(re+=y;e[re%y].skip;)re-=Re;for(;e[he%y].skip;)he+=Re;re%y!=he%y&&(k.push({start:re%y,end:he%y,loop:me,style:Pe}),E=Pe,F=he%y)}}for(const re of n){F=f?F:re.start;let me,he=e[F%y];for($=F+1;$<=re.end;$++){const Pe=e[$%y];me=IB(i.setContext(Z1(r,{type:"segment",p0:he,p1:Pe,p0DataIndex:($-1)%y,p1DataIndex:$%y,datasetIndex:c}))),spe(me,E)&&W(F,$-1,re.loop,E),he=Pe,E=me}F<$-1&&W(F,$-1,re.loop,E)}return k}(t,n,e,i):n}(t,!0===i?[{start:c,end:f,loop:s}]:function ipe(t,n,e,i){const r=t.length,s=[];let y,c=n,f=t[n];for(y=n+1;y<=e;++y){const k=t[y%r];k.skip||k.stop?f.skip||(s.push({start:n%r,end:(y-1)%r,loop:i=!1}),n=c=k.stop?y:null):(c=y,f.skip&&(n=y)),f=k}return null!==c&&s.push({start:n%r,end:c%r,loop:i}),s}(e,c,f<c?f+r:f,!!t._fullLoop&&0===c&&f===r-1),e,n)}(this,this.options.segment))}first(){const e=this.segments;return e.length&&this.points[e[0].start]}last(){const e=this.segments,r=e.length;return r&&this.points[e[r-1].end]}interpolate(e,i){const r=this.options,s=e[i],c=this.points,f=AB(this,{property:i,start:s,end:s});if(!f.length)return;const y=[],k=function nme(t){return t.stepped?Kue:t.tension||"monotone"===t.cubicInterpolationMode?Que:py}(r);let E,F;for(E=0,F=f.length;E<F;++E){const{start:$,end:W}=f[E],re=c[$],he=c[W];if(re===he){y.push(re);continue}const Pe=k(re,he,Math.abs((s-re[i])/(he[i]-re[i])),r.stepped);Pe[i]=e[i],y.push(Pe)}return 1===y.length?y[0]:y}pathSegment(e,i,r){return yI(this)(e,this,i,r)}path(e,i,r){const s=this.segments,c=yI(this);let f=this._loop;i=i||0,r=r||this.points.length-i;for(const y of s)f&=c(e,this,y,{start:i,end:i+r-1});return!!f}draw(e,i,r,s){(this.points||[]).length&&(this.options||{}).borderWidth&&(e.save(),function sme(t,n,e,i){ome&&!n.options.segment?function ime(t,n,e,i){let r=n._path;r||(r=n._path=new Path2D,n.path(r,e,i)&&r.closePath()),xV(t,n.options),t.stroke(r)}(t,n,e,i):function rme(t,n,e,i){const{segments:r,options:s}=n,c=yI(n);for(const f of r)xV(t,s,f.style),t.beginPath(),c(t,n,f,{start:e,end:e+i-1})&&t.closePath(),t.stroke()}(t,n,e,i)}(e,this,r,s),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}})();function kV(t,n,e,i){const r=t.options,{[e]:s}=t.getProps([e],i);return Math.abs(n-s)<r.radius+r.hitRadius}let ame=(()=>class t extends fg{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,r){const s=this.options,{x:c,y:f}=this.getProps(["x","y"],r);return Math.pow(e-c,2)+Math.pow(i-f,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(e,i){return kV(this,e,"x",i)}inYRange(e,i){return kV(this,e,"y",i)}getCenterPoint(e){const{x:i,y:r}=this.getProps(["x","y"],e);return{x:i,y:r}}size(e){let i=(e=e||this.options||{}).radius||0;return i=Math.max(i,i&&e.hoverRadius||0),2*(i+(i&&e.borderWidth||0))}draw(e,i){const r=this.options;this.skip||r.radius<.1||!ug(this,i,this.size(r)/2)||(e.strokeStyle=r.borderColor,e.lineWidth=r.borderWidth,e.fillStyle=r.backgroundColor,eI(e,r,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}})();function MV(t,n){const{x:e,y:i,base:r,width:s,height:c}=t.getProps(["x","y","base","width","height"],n);let f,y,k,E,F;return t.horizontal?(F=c/2,f=Math.min(e,r),y=Math.max(e,r),k=i-F,E=i+F):(F=s/2,f=e-F,y=e+F,k=Math.min(i,r),E=Math.max(i,r)),{left:f,top:k,right:y,bottom:E}}function X1(t,n,e,i){return t?0:Rc(n,e,i)}function vI(t,n,e,i){const r=null===n,s=null===e,f=t&&!(r&&s)&&MV(t,i);return f&&(r||dg(n,f.left,f.right))&&(s||dg(e,f.top,f.bottom))}function ume(t,n){t.rect(n.x,n.y,n.w,n.h)}function bI(t,n,e={}){const i=t.x!==e.x?-n:0,r=t.y!==e.y?-n:0;return{x:t.x+i,y:t.y+r,w:t.w+((t.x+t.w!==e.x+e.w?n:0)-i),h:t.h+((t.y+t.h!==e.y+e.h?n:0)-r),radius:t.radius}}var fme=Object.freeze({__proto__:null,ArcElement:class Kfe extends fg{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:n=>"borderDash"!==n};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(n){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,e,i){const r=this.getProps(["x","y"],i),{angle:s,distance:c}=JN(r,{x:n,y:e}),{startAngle:f,endAngle:y,innerRadius:k,outerRadius:E,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),$=(this.options.spacing+this.options.borderWidth)/2,W=Zr(F,y-f),re=Vk(s,f,y)&&f!==y,he=W>=ga||re,me=dg(c,k+$,E+$);return he&&me}getCenterPoint(n){const{x:e,y:i,startAngle:r,endAngle:s,innerRadius:c,outerRadius:f}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:y,spacing:k}=this.options,E=(r+s)/2,F=(c+f+k+y)/2;return{x:e+Math.cos(E)*F,y:i+Math.sin(E)*F}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:e,circumference:i}=this,r=(e.offset||0)/4,s=(e.spacing||0)/2,c=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>ga?Math.floor(i/ga):0,0===i||this.innerRadius<0||this.outerRadius<0)return;n.save();const f=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(f)*r,Math.sin(f)*r);const k=r*(1-Math.sin(Math.min(ma,i||0)));n.fillStyle=e.backgroundColor,n.strokeStyle=e.borderColor,function Yfe(t,n,e,i,r){const{fullCircles:s,startAngle:c,circumference:f}=n;let y=n.endAngle;if(s){nS(t,n,e,i,y,r);for(let k=0;k<s;++k)t.fill();isNaN(f)||(y=c+(f%ga||ga))}nS(t,n,e,i,y,r),t.fill()}(n,this,k,s,c),function Xfe(t,n,e,i,r){const{fullCircles:s,startAngle:c,circumference:f,options:y}=n,{borderWidth:k,borderJoinStyle:E,borderDash:F,borderDashOffset:$}=y,W="inner"===y.borderAlign;if(!k)return;t.setLineDash(F||[]),t.lineDashOffset=$,W?(t.lineWidth=2*k,t.lineJoin=E||"round"):(t.lineWidth=k,t.lineJoin=E||"bevel");let re=n.endAngle;if(s){nS(t,n,e,i,re,r);for(let he=0;he<s;++he)t.stroke();isNaN(f)||(re=c+(f%ga||ga))}W&&function Gfe(t,n,e){const{startAngle:i,pixelMargin:r,x:s,y:c,outerRadius:f,innerRadius:y}=n;let k=r/f;t.beginPath(),t.arc(s,c,f,i-k,e+k),y>r?(k=r/y,t.arc(s,c,y,e+k,i-k,!0)):t.arc(s,c,r,e+Al,i-Al),t.closePath(),t.clip()}(t,n,re),s||(nS(t,n,e,i,re,r),t.stroke())}(n,this,k,s,c),n.restore()}},BarElement:class pme extends fg{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(n){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,n&&Object.assign(this,n)}draw(n){const{inflateAmount:e,options:{borderColor:i,backgroundColor:r}}=this,{inner:s,outer:c}=function dme(t){const n=MV(t),e=n.right-n.left,i=n.bottom-n.top,r=function lme(t,n,e){const r=t.borderSkipped,s=fB(t.options.borderWidth);return{t:X1(r.top,s.top,0,e),r:X1(r.right,s.right,0,n),b:X1(r.bottom,s.bottom,0,e),l:X1(r.left,s.left,0,n)}}(t,e/2,i/2),s=function cme(t,n,e){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,s=dy(r),c=Math.min(n,e),f=t.borderSkipped,y=i||Po(r);return{topLeft:X1(!y||f.top||f.left,s.topLeft,0,c),topRight:X1(!y||f.top||f.right,s.topRight,0,c),bottomLeft:X1(!y||f.bottom||f.left,s.bottomLeft,0,c),bottomRight:X1(!y||f.bottom||f.right,s.bottomRight,0,c)}}(t,e/2,i/2);return{outer:{x:n.left,y:n.top,w:e,h:i,radius:s},inner:{x:n.left+r.l,y:n.top+r.t,w:e-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,s.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(r.b,r.r))}}}}(this),f=function hme(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}(c.radius)?qk:ume;n.save(),(c.w!==s.w||c.h!==s.h)&&(n.beginPath(),f(n,bI(c,e,s)),n.clip(),f(n,bI(s,-e,c)),n.fillStyle=i,n.fill("evenodd")),n.beginPath(),f(n,bI(s,e)),n.fillStyle=r,n.fill(),n.restore()}inRange(n,e,i){return vI(this,n,e,i)}inXRange(n,e){return vI(this,n,null,e)}inYRange(n,e){return vI(this,null,n,e)}getCenterPoint(n){const{x:e,y:i,base:r,horizontal:s}=this.getProps(["x","y","base","horizontal"],n);return{x:s?(e+r)/2:e,y:s?i:(i+r)/2}}getRange(n){return"x"===n?this.width/2:this.height/2}},LineElement:iS,PointElement:ame});const xI=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],CV=xI.map(t=>t.replace("rgb(","rgba(").replace(")",", 0.5)"));function SV(t){return xI[t%xI.length]}function EV(t){return CV[t%CV.length]}function DV(t){let n;for(n in t)if(t[n].borderColor||t[n].backgroundColor)return!0;return!1}var xme={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,n,e){if(!e.enabled)return;const{data:{datasets:i},options:r}=t.config,{elements:s}=r,c=DV(i)||function vme(t){return t&&(t.borderColor||t.backgroundColor)}(r)||s&&DV(s)||function bme(){return"rgba(0,0,0,0.1)"!==_a.borderColor||"rgba(0,0,0,0.1)"!==_a.backgroundColor}();if(!e.forceOverride&&c)return;const f=function yme(t){let n=0;return(e,i)=>{const r=t.getDatasetMeta(i).controller;r instanceof hI?n=function gme(t,n){return t.backgroundColor=t.data.map(()=>SV(n++)),n}(e,n):r instanceof GB?n=function _me(t,n){return t.backgroundColor=t.data.map(()=>EV(n++)),n}(e,n):r&&(n=function mme(t,n){return t.borderColor=SV(n),t.backgroundColor=EV(n),++n}(e,n))}}(t);i.forEach(f)}};function TV(t){if(t._decimated){const n=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:n})}}function AV(t){t.data.datasets.forEach(n=>{TV(n)})}var Cme={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,n,e)=>{if(!e.enabled)return void AV(t);const i=t.width;t.data.datasets.forEach((r,s)=>{const{_data:c,indexAxis:f}=r,y=t.getDatasetMeta(s),k=c||r.data;if("y"===$k([f,t.options.indexAxis])||!y.controller.supportsDecimation)return;const E=t.scales[y.xAxisID];if("linear"!==E.type&&"time"!==E.type||t.options.parsing)return;let re,{start:F,count:$}=function Mme(t,n){const e=n.length;let r,i=0;const{iScale:s}=t,{min:c,max:f,minDefined:y,maxDefined:k}=s.getUserBounds();return y&&(i=Rc(hg(n,s.axis,c).lo,0,e-1)),r=k?Rc(hg(n,s.axis,f).hi+1,i,e)-i:e-i,{start:i,count:r}}(y,k);if($<=(e.threshold||4*i))TV(r);else{switch(Mo(c)&&(r._data=k,delete r.data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(he){this._data=he}})),e.algorithm){case"lttb":re=function wme(t,n,e,i,r){const s=r.samples||i;if(s>=e)return t.slice(n,n+e);const c=[],f=(e-2)/(s-2);let y=0;const k=n+e-1;let F,$,W,re,he,E=n;for(c[y++]=t[E],F=0;F<s-2;F++){let Re,me=0,Pe=0;const rt=Math.floor((F+1)*f)+1+n,ft=Math.min(Math.floor((F+2)*f)+1,e)+n,Ct=ft-rt;for(Re=rt;Re<ft;Re++)me+=t[Re].x,Pe+=t[Re].y;me/=Ct,Pe/=Ct;const Vt=Math.floor(F*f)+1+n,sn=Math.min(Math.floor((F+1)*f)+1,e)+n,{x:Qt,y:Vn}=t[E];for(W=re=-1,Re=Vt;Re<sn;Re++)re=.5*Math.abs((Qt-me)*(t[Re].y-Vn)-(Qt-t[Re].x)*(Pe-Vn)),re>W&&(W=re,$=t[Re],he=Re);c[y++]=$,E=he}return c[y++]=t[k],c}(k,F,$,i,e);break;case"min-max":re=function kme(t,n,e,i){let c,f,y,k,E,F,$,W,re,he,r=0,s=0;const me=[],Re=t[n].x,ft=t[n+e-1].x-Re;for(c=n;c<n+e;++c){f=t[c],y=(f.x-Re)/ft*i,k=f.y;const Ct=0|y;if(Ct===E)k<re?(re=k,F=c):k>he&&(he=k,$=c),r=(s*r+f.x)/++s;else{const Vt=c-1;if(!Mo(F)&&!Mo($)){const sn=Math.min(F,$),Qt=Math.max(F,$);sn!==W&&sn!==Vt&&me.push({...t[sn],x:r}),Qt!==W&&Qt!==Vt&&me.push({...t[Qt],x:r})}c>0&&Vt!==W&&me.push(t[Vt]),me.push(f),E=Ct,s=0,re=he=k,F=$=W=c}}return me}(k,F,$,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}r._decimated=re}})},destroy(t){AV(t)}};function wI(t,n,e,i){if(i)return;let r=n[t],s=e[t];return"angle"===t&&(r=Jh(r),s=Jh(s)),{property:t,start:r,end:s}}function kI(t,n,e){for(;n>t;n--){const i=e[n];if(!isNaN(i.x)&&!isNaN(i.y))break}return n}function PV(t,n,e,i){return t&&n?i(t[e],n[e]):t?t[e]:n?n[e]:0}function IV(t,n){let e=[],i=!1;return fa(t)?(i=!0,e=t):e=function Eme(t,n){const{x:e=null,y:i=null}=t||{},r=n.points,s=[];return n.segments.forEach(({start:c,end:f})=>{f=kI(c,f,r);const y=r[c],k=r[f];null!==i?(s.push({x:y.x,y:i}),s.push({x:k.x,y:i})):null!==e&&(s.push({x:e,y:y.y}),s.push({x:e,y:k.y}))}),s}(t,n),e.length?new iS({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function OV(t){return t&&!1!==t.fill}function Dme(t,n,e){let r=t[n].fill;const s=[n];let c;if(!e)return r;for(;!1!==r&&-1===s.indexOf(r);){if(!ul(r))return r;if(c=t[r],!c)return!1;if(c.visible)return r;s.push(r),r=c.fill}return!1}function Tme(t,n,e){const i=function Ome(t){const n=t.options,e=n.fill;let i=Zr(e&&e.target,e);return void 0===i&&(i=!!n.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(t);if(Po(i))return!isNaN(i.value)&&i;let r=parseFloat(i);return ul(r)&&Math.floor(r)===r?function Ame(t,n,e,i){return("-"===t||"+"===t)&&(e=n+e),!(e===n||e<0||e>=i)&&e}(i[0],n,r,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Fme(t,n,e){const i=[];for(let r=0;r<e.length;r++){const s=e[r],{first:c,last:f,point:y}=zme(s,n,"x");if(!(!y||c&&f))if(c)i.unshift(y);else if(t.push(y),!f)break}t.push(...i)}function zme(t,n,e){const i=t.interpolate(n,e);if(!i)return{};const r=i[e],s=t.segments,c=t.points;let f=!1,y=!1;for(let k=0;k<s.length;k++){const E=s[k],F=c[E.start][e],$=c[E.end][e];if(dg(r,F,$)){f=r===F,y=r===$;break}}return{first:f,last:y,point:i}}class RV{constructor(n){this.x=n.x,this.y=n.y,this.radius=n.radius}pathSegment(n,e,i){const{x:r,y:s,radius:c}=this;return n.arc(r,s,c,(e=e||{start:0,end:ga}).end,e.start,!0),!i.bounds}interpolate(n){const{x:e,y:i,radius:r}=this,s=n.angle;return{x:e+Math.cos(s)*r,y:i+Math.sin(s)*r,angle:s}}}function MI(t,n,e){const i=function Nme(t){const{chart:n,fill:e,line:i}=t;if(ul(e))return function Bme(t,n){const e=t.getDatasetMeta(n);return e&&t.isDatasetVisible(n)?e.dataset:null}(n,e);if("stack"===e)return function Rme(t){const{scale:n,index:e,line:i}=t,r=[],s=i.segments,c=i.points,f=function Lme(t,n){const e=[],i=t.getMatchingVisibleMetas("line");for(let r=0;r<i.length;r++){const s=i[r];if(s.index===n)break;s.hidden||e.unshift(s.dataset)}return e}(n,e);f.push(IV({x:null,y:n.bottom},i));for(let y=0;y<s.length;y++){const k=s[y];for(let E=k.start;E<=k.end;E++)Fme(r,c[E],f)}return new iS({points:r,options:{}})}(t);if("shape"===e)return!0;const r=function Vme(t){return(t.scale||{}).getPointPositionForValue?function Hme(t){const{scale:n,fill:e}=t,i=n.options,r=n.getLabels().length,s=i.reverse?n.max:n.min,c=function Ime(t,n,e){let i;return i="start"===t?e:"end"===t?n.options.reverse?n.min:n.max:Po(t)?t.value:n.getBaseValue(),i}(e,n,s),f=[];if(i.grid.circular){const y=n.getPointPositionForValue(0,s);return new RV({x:y.x,y:y.y,radius:n.getDistanceFromCenterForValue(c)})}for(let y=0;y<r;++y)f.push(n.getPointPositionForValue(y,c));return f}(t):function jme(t){const{scale:n={},fill:e}=t,i=function Pme(t,n){let e=null;return"start"===t?e=n.bottom:"end"===t?e=n.top:Po(t)?e=n.getPixelForValue(t.value):n.getBasePixel&&(e=n.getBasePixel()),e}(e,n);if(ul(i)){const r=n.isHorizontal();return{x:r?i:null,y:r?null:i}}return null}(t)}(t);return r instanceof RV?r:IV(r,i)}(n),{chart:r,index:s,line:c,scale:f,axis:y}=n,k=c.options,E=k.fill,F=k.backgroundColor,{above:$=F,below:W=F}=E||{},re=r.getDatasetMeta(s),he=OB(r,re);i&&c.points.length&&(j5(t,e),function Ume(t,n){const{line:e,target:i,above:r,below:s,area:c,scale:f,clip:y}=n,k=e._loop?"angle":n.axis;t.save(),"x"===k&&s!==r&&(LV(t,i,c.top),FV(t,{line:e,target:i,color:r,scale:f,property:k,clip:y}),t.restore(),t.save(),LV(t,i,c.bottom)),FV(t,{line:e,target:i,color:s,scale:f,property:k,clip:y}),t.restore()}(t,{line:c,target:i,above:$,below:W,area:e,scale:f,axis:y,clip:he}),H5(t))}function LV(t,n,e){const{segments:i,points:r}=n;let s=!0,c=!1;t.beginPath();for(const f of i){const{start:y,end:k}=f,E=r[y],F=r[kI(y,k,r)];s?(t.moveTo(E.x,E.y),s=!1):(t.lineTo(E.x,e),t.lineTo(E.x,E.y)),c=!!n.pathSegment(t,f,{move:c}),c?t.closePath():t.lineTo(F.x,e)}t.lineTo(n.first().x,e),t.closePath(),t.clip()}function FV(t,n){const{line:e,target:i,property:r,color:s,scale:c,clip:f}=n,y=function Sme(t,n,e){const i=t.segments,r=t.points,s=n.points,c=[];for(const f of i){let{start:y,end:k}=f;k=kI(y,k,r);const E=wI(e,r[y],r[k],f.loop);if(!n.segments){c.push({source:f,target:E,start:r[y],end:r[k]});continue}const F=AB(n,E);for(const $ of F){const W=wI(e,s[$.start],s[$.end],$.loop),re=TB(f,r,W);for(const he of re)c.push({source:he,target:$,start:{[e]:PV(E,W,"start",Math.max)},end:{[e]:PV(E,W,"end",Math.min)}})}}return c}(e,i,r);for(const{source:k,target:E,start:F,end:$}of y){const{style:{backgroundColor:W=s}={}}=k,re=!0!==i;t.save(),t.fillStyle=W,qme(t,c,f,re&&wI(r,F,$)),t.beginPath();const he=!!e.pathSegment(t,k);let me;if(re){he?t.closePath():zV(t,i,$,r);const Pe=!!i.pathSegment(t,E,{move:he,reverse:!0});me=he&&Pe,me||zV(t,i,F,r)}t.closePath(),t.fill(me?"evenodd":"nonzero"),t.restore()}}function qme(t,n,e,i){const r=n.chart.chartArea,{property:s,start:c,end:f}=i||{};if("x"===s||"y"===s){let y,k,E,F;"x"===s?(y=c,k=r.top,E=f,F=r.bottom):(y=r.left,k=c,E=r.right,F=f),t.beginPath(),e&&(y=Math.max(y,e.left),E=Math.min(E,e.right),k=Math.max(k,e.top),F=Math.min(F,e.bottom)),t.rect(y,k,E-y,F-k),t.clip()}}function zV(t,n,e,i){const r=n.interpolate(e,i);r&&t.lineTo(r.x,r.y)}var $me={id:"filler",afterDatasetsUpdate(t,n,e){const i=(t.data.datasets||[]).length,r=[];let s,c,f,y;for(c=0;c<i;++c)s=t.getDatasetMeta(c),f=s.dataset,y=null,f&&f.options&&f instanceof iS&&(y={visible:t.isDatasetVisible(c),index:c,fill:Tme(f,c,i),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:f}),s.$filler=y,r.push(y);for(c=0;c<i;++c)y=r[c],y&&!1!==y.fill&&(y.fill=Dme(r,c,e.propagate))},beforeDraw(t,n,e){const i="beforeDraw"===e.drawTime,r=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let c=r.length-1;c>=0;--c){const f=r[c].$filler;f&&(f.line.updateControlPoints(s,f.axis),i&&f.fill&&MI(t.ctx,f,s))}},beforeDatasetsDraw(t,n,e){if("beforeDatasetsDraw"!==e.drawTime)return;const i=t.getSortedVisibleDatasetMetas();for(let r=i.length-1;r>=0;--r){const s=i[r].$filler;OV(s)&&MI(t.ctx,s,t.chartArea)}},beforeDatasetDraw(t,n,e){const i=n.meta.$filler;!OV(i)||"beforeDatasetDraw"!==e.drawTime||MI(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const NV=(t,n)=>{let{boxHeight:e=n,boxWidth:i=n}=t;return t.usePointStyle&&(e=Math.min(e,n),i=t.pointStyleWidth||Math.min(i,n)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(n,e)}};class BV extends fg{constructor(n){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,e,i){this.maxWidth=n,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const n=this.options.labels||{};let e=ta(n.generateLabels,[this.chart],this)||[];n.filter&&(e=e.filter(i=>n.filter(i,this.chart.data))),n.sort&&(e=e.sort((i,r)=>n.sort(i,r,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:n,ctx:e}=this;if(!n.display)return void(this.width=this.height=0);const i=n.labels,r=lc(i.font),s=r.size,c=this._computeTitleHeight(),{boxWidth:f,itemHeight:y}=NV(i,s);let k,E;e.font=r.string,this.isHorizontal()?(k=this.maxWidth,E=this._fitRows(c,s,f,y)+10):(E=this.maxHeight,k=this._fitCols(c,r,f,y)+10),this.width=Math.min(k,n.maxWidth||this.maxWidth),this.height=Math.min(E,n.maxHeight||this.maxHeight)}_fitRows(n,e,i,r){const{ctx:s,maxWidth:c,options:{labels:{padding:f}}}=this,y=this.legendHitBoxes=[],k=this.lineWidths=[0],E=r+f;let F=n;s.textAlign="left",s.textBaseline="middle";let $=-1,W=-E;return this.legendItems.forEach((re,he)=>{const me=i+e/2+s.measureText(re.text).width;(0===he||k[k.length-1]+me+2*f>c)&&(F+=E,k[k.length-(he>0?0:1)]=0,W+=E,$++),y[he]={left:0,top:W,row:$,width:me,height:r},k[k.length-1]+=me+f}),F}_fitCols(n,e,i,r){const{ctx:s,maxHeight:c,options:{labels:{padding:f}}}=this,y=this.legendHitBoxes=[],k=this.columnSizes=[],E=c-n;let F=f,$=0,W=0,re=0,he=0;return this.legendItems.forEach((me,Pe)=>{const{itemWidth:Re,itemHeight:rt}=function Wme(t,n,e,i,r){const s=function Zme(t,n,e,i){let r=t.text;return r&&"string"!=typeof r&&(r=r.reduce((s,c)=>s.length>c.length?s:c)),n+e.size/2+i.measureText(r).width}(i,t,n,e),c=function Yme(t,n,e){let i=t;return"string"!=typeof n.text&&(i=VV(n,e)),i}(r,i,n.lineHeight);return{itemWidth:s,itemHeight:c}}(i,e,s,me,r);Pe>0&&W+rt+2*f>E&&(F+=$+f,k.push({width:$,height:W}),re+=$+f,he++,$=W=0),y[Pe]={left:re,top:W,col:he,width:Re,height:rt},$=Math.max($,Re),W+=rt+f}),F+=$,k.push({width:$,height:W}),F}adjustHitBoxes(){if(!this.options.display)return;const n=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:r},rtl:s}}=this,c=sb(s,this.left,this.width);if(this.isHorizontal()){let f=0,y=Ed(i,this.left+r,this.right-this.lineWidths[f]);for(const k of e)f!==k.row&&(f=k.row,y=Ed(i,this.left+r,this.right-this.lineWidths[f])),k.top+=this.top+n+r,k.left=c.leftForLtr(c.x(y),k.width),y+=k.width+r}else{let f=0,y=Ed(i,this.top+n+r,this.bottom-this.columnSizes[f].height);for(const k of e)k.col!==f&&(f=k.col,y=Ed(i,this.top+n+r,this.bottom-this.columnSizes[f].height)),k.top=y,k.left+=this.left+r,k.left=c.leftForLtr(c.x(k.left),k.width),y+=k.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const n=this.ctx;j5(n,this),this._draw(),H5(n)}}_draw(){const{options:n,columnSizes:e,lineWidths:i,ctx:r}=this,{align:s,labels:c}=n,f=_a.color,y=sb(n.rtl,this.left,this.width),k=lc(c.font),{padding:E}=c,F=k.size,$=F/2;let W;this.drawTitle(),r.textAlign=y.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=k.string;const{boxWidth:re,boxHeight:he,itemHeight:me}=NV(c,F),rt=this.isHorizontal(),ft=this._computeTitleHeight();W=rt?{x:Ed(s,this.left+E,this.right-i[0]),y:this.top+E+ft,line:0}:{x:this.left+E,y:Ed(s,this.top+ft+E,this.bottom-e[0].height),line:0},CB(this.ctx,n.textDirection);const Ct=me+E;this.legendItems.forEach((Vt,sn)=>{r.strokeStyle=Vt.fontColor,r.fillStyle=Vt.fontColor;const Qt=r.measureText(Vt.text).width,Vn=y.textAlign(Vt.textAlign||(Vt.textAlign=c.textAlign)),Hi=re+$+Qt;let fr=W.x,Or=W.y;y.setWidth(this.width),rt?sn>0&&fr+Hi+E>this.right&&(Or=W.y+=Ct,W.line++,fr=W.x=Ed(s,this.left+E,this.right-i[W.line])):sn>0&&Or+Ct>this.bottom&&(fr=W.x=fr+e[W.line].width+E,W.line++,Or=W.y=Ed(s,this.top+ft+E,this.bottom-e[W.line].height)),function(Vt,sn,Qt){if(isNaN(re)||re<=0||isNaN(he)||he<0)return;r.save();const Vn=Zr(Qt.lineWidth,1);if(r.fillStyle=Zr(Qt.fillStyle,f),r.lineCap=Zr(Qt.lineCap,"butt"),r.lineDashOffset=Zr(Qt.lineDashOffset,0),r.lineJoin=Zr(Qt.lineJoin,"miter"),r.lineWidth=Vn,r.strokeStyle=Zr(Qt.strokeStyle,f),r.setLineDash(Zr(Qt.lineDash,[])),c.usePointStyle){const Hi={radius:he*Math.SQRT2/2,pointStyle:Qt.pointStyle,rotation:Qt.rotation,borderWidth:Vn},fr=y.xPlus(Vt,re/2);pB(r,Hi,fr,sn+$,c.pointStyleWidth&&re)}else{const Hi=sn+Math.max((F-he)/2,0),fr=y.leftForLtr(Vt,re),Or=dy(Qt.borderRadius);r.beginPath(),Object.values(Or).some(va=>0!==va)?qk(r,{x:fr,y:Hi,w:re,h:he,radius:Or}):r.rect(fr,Hi,re,he),r.fill(),0!==Vn&&r.stroke()}r.restore()}(y.x(fr),Or,Vt),fr=((t,n,e,i)=>t===(i?"left":"right")?e:"center"===t?(n+e)/2:n)(Vn,fr+re+$,rt?fr+Hi:this.right,n.rtl),function(Vt,sn,Qt){cy(r,Qt.text,Vt,sn+me/2,k,{strikethrough:Qt.hidden,textAlign:y.textAlign(Qt.textAlign)})}(y.x(fr),Or,Vt),rt?W.x+=Hi+E:W.y+="string"!=typeof Vt.text?VV(Vt,k.lineHeight)+E:Ct}),SB(this.ctx,n.textDirection)}drawTitle(){const n=this.options,e=n.title,i=lc(e.font),r=Dd(e.padding);if(!e.display)return;const s=sb(n.rtl,this.left,this.width),c=this.ctx,f=e.position,k=r.top+i.size/2;let E,F=this.left,$=this.width;if(this.isHorizontal())$=Math.max(...this.lineWidths),E=this.top+k,F=Ed(n.align,F,this.right-$);else{const re=this.columnSizes.reduce((he,me)=>Math.max(he,me.height),0);E=k+Ed(n.align,this.top,this.bottom-re-n.labels.padding-this._computeTitleHeight())}const W=Ed(f,F,F+$);c.textAlign=s.textAlign(YP(f)),c.textBaseline="middle",c.strokeStyle=e.color,c.fillStyle=e.color,c.font=i.string,cy(c,e.text,W,E,i)}_computeTitleHeight(){const n=this.options.title,e=lc(n.font),i=Dd(n.padding);return n.display?e.lineHeight+i.height:0}_getLegendItemAt(n,e){let i,r,s;if(dg(n,this.left,this.right)&&dg(e,this.top,this.bottom))for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(r=s[i],dg(n,r.left,r.left+r.width)&&dg(e,r.top,r.top+r.height))return this.legendItems[i];return null}handleEvent(n){const e=this.options;if(!function Xme(t,n){return!(("mousemove"!==t&&"mouseout"!==t||!n.onHover&&!n.onLeave)&&(!n.onClick||"click"!==t&&"mouseup"!==t))}(n.type,e))return;const i=this._getLegendItemAt(n.x,n.y);if("mousemove"===n.type||"mouseout"===n.type){const r=this._hoveredItem,s=((t,n)=>null!==t&&null!==n&&t.datasetIndex===n.datasetIndex&&t.index===n.index)(r,i);r&&!s&&ta(e.onLeave,[n,r,this],this),this._hoveredItem=i,i&&!s&&ta(e.onHover,[n,i,this],this)}else i&&ta(e.onClick,[n,i,this],this)}}function VV(t,n){return n*(t.text?t.text.length:0)}var Kme={id:"legend",_element:BV,start(t,n,e){const i=t.legend=new BV({ctx:t.ctx,options:e,chart:t});Td.configure(t,i,e),Td.addBox(t,i)},stop(t){Td.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,n,e){const i=t.legend;Td.configure(t,i,e),i.options=e},afterUpdate(t){const n=t.legend;n.buildLabels(),n.adjustHitBoxes()},afterEvent(t,n){n.replay||t.legend.handleEvent(n.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,n,e){const i=n.datasetIndex,r=e.chart;r.isDatasetVisible(i)?(r.hide(i),n.hidden=!0):(r.show(i),n.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const n=t.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:r,color:s,useBorderRadius:c,borderRadius:f}}=t.legend.options;return t._getSortedDatasetMetas().map(y=>{const k=y.controller.getStyle(e?0:void 0),E=Dd(k.borderWidth);return{text:n[y.index].label,fillStyle:k.backgroundColor,fontColor:s,hidden:!y.visible,lineCap:k.borderCapStyle,lineDash:k.borderDash,lineDashOffset:k.borderDashOffset,lineJoin:k.borderJoinStyle,lineWidth:(E.width+E.height)/4,strokeStyle:k.borderColor,pointStyle:i||k.pointStyle,rotation:k.rotation,textAlign:r||k.textAlign,borderRadius:c&&(f||k.borderRadius),datasetIndex:y.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class CI extends fg{constructor(n){super(),this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=n,this.height=this.bottom=e;const r=fa(i.text)?i.text.length:1;this._padding=Dd(i.padding);const s=r*lc(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const n=this.options.position;return"top"===n||"bottom"===n}_drawArgs(n){const{top:e,left:i,bottom:r,right:s,options:c}=this,f=c.align;let k,E,F,y=0;return this.isHorizontal()?(E=Ed(f,i,s),F=e+n,k=s-i):("left"===c.position?(E=i+n,F=Ed(f,r,e),y=-.5*ma):(E=s-n,F=Ed(f,e,r),y=.5*ma),k=r-e),{titleX:E,titleY:F,maxWidth:k,rotation:y}}draw(){const n=this.ctx,e=this.options;if(!e.display)return;const i=lc(e.font),s=i.lineHeight/2+this._padding.top,{titleX:c,titleY:f,maxWidth:y,rotation:k}=this._drawArgs(s);cy(n,e.text,0,0,i,{color:e.color,maxWidth:y,rotation:k,textAlign:YP(e.align),textBaseline:"middle",translation:[c,f]})}}var Jme={id:"title",_element:CI,start(t,n,e){!function Qme(t,n){const e=new CI({ctx:t.ctx,options:n,chart:t});Td.configure(t,e,n),Td.addBox(t,e),t.titleBlock=e}(t,e)},stop(t){Td.removeBox(t,t.titleBlock),delete t.titleBlock},beforeUpdate(t,n,e){const i=t.titleBlock;Td.configure(t,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const rS=new WeakMap;var ege={id:"subtitle",start(t,n,e){const i=new CI({ctx:t.ctx,options:e,chart:t});Td.configure(t,i,e),Td.addBox(t,i),rS.set(t,i)},stop(t){Td.removeBox(t,rS.get(t)),rS.delete(t)},beforeUpdate(t,n,e){const i=rS.get(t);Td.configure(t,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const eM={average(t){if(!t.length)return!1;let n,e,i=new Set,r=0,s=0;for(n=0,e=t.length;n<e;++n){const f=t[n].element;if(f&&f.hasValue()){const y=f.tooltipPosition();i.add(y.x),r+=y.y,++s}}return 0!==s&&0!==i.size&&{x:[...i].reduce((f,y)=>f+y)/i.size,y:r/s}},nearest(t,n){if(!t.length)return!1;let s,c,f,e=n.x,i=n.y,r=Number.POSITIVE_INFINITY;for(s=0,c=t.length;s<c;++s){const y=t[s].element;if(y&&y.hasValue()){const E=WP(n,y.getCenterPoint());E<r&&(r=E,f=y)}}if(f){const y=f.tooltipPosition();e=y.x,i=y.y}return{x:e,y:i}}};function Uf(t,n){return n&&(fa(n)?Array.prototype.push.apply(t,n):t.push(n)),t}function mg(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function tge(t,n){const{element:e,datasetIndex:i,index:r}=n,s=t.getDatasetMeta(i).controller,{label:c,value:f}=s.getLabelAndValue(r);return{chart:t,label:c,parsed:s.getParsed(r),raw:t.data.datasets[i].data[r],formattedValue:f,dataset:s.getDataset(),dataIndex:r,datasetIndex:i,element:e}}function jV(t,n){const e=t.chart.ctx,{body:i,footer:r,title:s}=t,{boxWidth:c,boxHeight:f}=n,y=lc(n.bodyFont),k=lc(n.titleFont),E=lc(n.footerFont),F=s.length,$=r.length,W=i.length,re=Dd(n.padding);let he=re.height,me=0,Pe=i.reduce((ft,Ct)=>ft+Ct.before.length+Ct.lines.length+Ct.after.length,0);Pe+=t.beforeBody.length+t.afterBody.length,F&&(he+=F*k.lineHeight+(F-1)*n.titleSpacing+n.titleMarginBottom),Pe&&(he+=W*(n.displayColors?Math.max(f,y.lineHeight):y.lineHeight)+(Pe-W)*y.lineHeight+(Pe-1)*n.bodySpacing),$&&(he+=n.footerMarginTop+$*E.lineHeight+($-1)*n.footerSpacing);let Re=0;const rt=function(ft){me=Math.max(me,e.measureText(ft).width+Re)};return e.save(),e.font=k.string,Cs(t.title,rt),e.font=y.string,Cs(t.beforeBody.concat(t.afterBody),rt),Re=n.displayColors?c+2+n.boxPadding:0,Cs(i,ft=>{Cs(ft.before,rt),Cs(ft.lines,rt),Cs(ft.after,rt)}),Re=0,e.font=E.string,Cs(t.footer,rt),e.restore(),me+=re.width,{width:me,height:he}}function rge(t,n,e,i){const{x:r,width:s}=e,{width:c,chartArea:{left:f,right:y}}=t;let k="center";return"center"===i?k=r<=(f+y)/2?"left":"right":r<=s/2?k="left":r>=c-s/2&&(k="right"),function ige(t,n,e,i){const{x:r,width:s}=i,c=e.caretSize+e.caretPadding;if("left"===t&&r+s+c>n.width||"right"===t&&r-s-c<0)return!0}(k,t,n,e)&&(k="center"),k}function HV(t,n,e){const i=e.yAlign||n.yAlign||function nge(t,n){const{y:e,height:i}=n;return e<i/2?"top":e>t.height-i/2?"bottom":"center"}(t,e);return{xAlign:e.xAlign||n.xAlign||rge(t,n,e,i),yAlign:i}}function UV(t,n,e,i){const{caretSize:r,caretPadding:s,cornerRadius:c}=t,{xAlign:f,yAlign:y}=e,k=r+s,{topLeft:E,topRight:F,bottomLeft:$,bottomRight:W}=dy(c);let re=function oge(t,n){let{x:e,width:i}=t;return"right"===n?e-=i:"center"===n&&(e-=i/2),e}(n,f);const he=function sge(t,n,e){let{y:i,height:r}=t;return"top"===n?i+=e:i-="bottom"===n?r+e:r/2,i}(n,y,k);return"center"===y?"left"===f?re+=k:"right"===f&&(re-=k):"left"===f?re-=Math.max(E,$)+r:"right"===f&&(re+=Math.max(F,W)+r),{x:Rc(re,0,i.width-n.width),y:Rc(he,0,i.height-n.height)}}function oS(t,n,e){const i=Dd(e.padding);return"center"===n?t.x+t.width/2:"right"===n?t.x+t.width-i.right:t.x+i.left}function qV(t){return Uf([],mg(t))}function $V(t,n){const e=n&&n.dataset&&n.dataset.tooltip&&n.dataset.tooltip.callbacks;return e?t.override(e):t}const GV={beforeTitle:cg,title(t){if(t.length>0){const n=t[0],e=n.chart.data.labels,i=e?e.length:0;if(this&&this.options&&"dataset"===this.options.mode)return n.dataset.label||"";if(n.label)return n.label;if(i>0&&n.dataIndex<i)return e[n.dataIndex]}return""},afterTitle:cg,beforeBody:cg,beforeLabel:cg,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let n=t.dataset.label||"";n&&(n+=": ");const e=t.formattedValue;return Mo(e)||(n+=e),n},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:cg,afterBody:cg,beforeFooter:cg,footer:cg,afterFooter:cg};function Ch(t,n,e,i){const r=t[n].call(e,i);return typeof r>"u"?GV[n].call(e,i):r}let WV=(()=>class t extends fg{static positioners=eM;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const i=this.chart,r=this.options.setContext(this.getContext()),s=r.enabled&&i.options.animation&&r.animations,c=new LB(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(c)),c}getContext(){return this.$context||(this.$context=function age(t,n,e){return Z1(t,{tooltip:n,tooltipItems:e,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,i){const{callbacks:r}=i,s=Ch(r,"beforeTitle",this,e),c=Ch(r,"title",this,e),f=Ch(r,"afterTitle",this,e);let y=[];return y=Uf(y,mg(s)),y=Uf(y,mg(c)),y=Uf(y,mg(f)),y}getBeforeBody(e,i){return qV(Ch(i.callbacks,"beforeBody",this,e))}getBody(e,i){const{callbacks:r}=i,s=[];return Cs(e,c=>{const f={before:[],lines:[],after:[]},y=$V(r,c);Uf(f.before,mg(Ch(y,"beforeLabel",this,c))),Uf(f.lines,Ch(y,"label",this,c)),Uf(f.after,mg(Ch(y,"afterLabel",this,c))),s.push(f)}),s}getAfterBody(e,i){return qV(Ch(i.callbacks,"afterBody",this,e))}getFooter(e,i){const{callbacks:r}=i,s=Ch(r,"beforeFooter",this,e),c=Ch(r,"footer",this,e),f=Ch(r,"afterFooter",this,e);let y=[];return y=Uf(y,mg(s)),y=Uf(y,mg(c)),y=Uf(y,mg(f)),y}_createItems(e){const i=this._active,r=this.chart.data,s=[],c=[],f=[];let k,E,y=[];for(k=0,E=i.length;k<E;++k)y.push(tge(this.chart,i[k]));return e.filter&&(y=y.filter((F,$,W)=>e.filter(F,$,W,r))),e.itemSort&&(y=y.sort((F,$)=>e.itemSort(F,$,r))),Cs(y,F=>{const $=$V(e.callbacks,F);s.push(Ch($,"labelColor",this,F)),c.push(Ch($,"labelPointStyle",this,F)),f.push(Ch($,"labelTextColor",this,F))}),this.labelColors=s,this.labelPointStyles=c,this.labelTextColors=f,this.dataPoints=y,y}update(e,i){const r=this.options.setContext(this.getContext()),s=this._active;let c,f=[];if(s.length){const y=eM[r.position].call(this,s,this._eventPosition);f=this._createItems(r),this.title=this.getTitle(f,r),this.beforeBody=this.getBeforeBody(f,r),this.body=this.getBody(f,r),this.afterBody=this.getAfterBody(f,r),this.footer=this.getFooter(f,r);const k=this._size=jV(this,r),E=Object.assign({},y,k),F=HV(this.chart,r,E),$=UV(r,E,F,this.chart);this.xAlign=F.xAlign,this.yAlign=F.yAlign,c={opacity:1,x:$.x,y:$.y,width:k.width,height:k.height,caretX:y.x,caretY:y.y}}else 0!==this.opacity&&(c={opacity:0});this._tooltipItems=f,this.$context=void 0,c&&this._resolveAnimations().update(this,c),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:i})}drawCaret(e,i,r,s){const c=this.getCaretPosition(e,r,s);i.lineTo(c.x1,c.y1),i.lineTo(c.x2,c.y2),i.lineTo(c.x3,c.y3)}getCaretPosition(e,i,r){const{xAlign:s,yAlign:c}=this,{caretSize:f,cornerRadius:y}=r,{topLeft:k,topRight:E,bottomLeft:F,bottomRight:$}=dy(y),{x:W,y:re}=e,{width:he,height:me}=i;let Pe,Re,rt,ft,Ct,Vt;return"center"===c?(Ct=re+me/2,"left"===s?(Pe=W,Re=Pe-f,ft=Ct+f,Vt=Ct-f):(Pe=W+he,Re=Pe+f,ft=Ct-f,Vt=Ct+f),rt=Pe):(Re="left"===s?W+Math.max(k,F)+f:"right"===s?W+he-Math.max(E,$)-f:this.caretX,"top"===c?(ft=re,Ct=ft-f,Pe=Re-f,rt=Re+f):(ft=re+me,Ct=ft+f,Pe=Re+f,rt=Re-f),Vt=ft),{x1:Pe,x2:Re,x3:rt,y1:ft,y2:Ct,y3:Vt}}drawTitle(e,i,r){const s=this.title,c=s.length;let f,y,k;if(c){const E=sb(r.rtl,this.x,this.width);for(e.x=oS(this,r.titleAlign,r),i.textAlign=E.textAlign(r.titleAlign),i.textBaseline="middle",f=lc(r.titleFont),y=r.titleSpacing,i.fillStyle=r.titleColor,i.font=f.string,k=0;k<c;++k)i.fillText(s[k],E.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+y,k+1===c&&(e.y+=r.titleMarginBottom-y)}}_drawColorBox(e,i,r,s,c){const f=this.labelColors[r],y=this.labelPointStyles[r],{boxHeight:k,boxWidth:E}=c,F=lc(c.bodyFont),$=oS(this,"left",c),W=s.x($),he=i.y+(k<F.lineHeight?(F.lineHeight-k)/2:0);if(c.usePointStyle){const me={radius:Math.min(E,k)/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:1},Pe=s.leftForLtr(W,E)+E/2,Re=he+k/2;e.strokeStyle=c.multiKeyBackground,e.fillStyle=c.multiKeyBackground,eI(e,me,Pe,Re),e.strokeStyle=f.borderColor,e.fillStyle=f.backgroundColor,eI(e,me,Pe,Re)}else{e.lineWidth=Po(f.borderWidth)?Math.max(...Object.values(f.borderWidth)):f.borderWidth||1,e.strokeStyle=f.borderColor,e.setLineDash(f.borderDash||[]),e.lineDashOffset=f.borderDashOffset||0;const me=s.leftForLtr(W,E),Pe=s.leftForLtr(s.xPlus(W,1),E-2),Re=dy(f.borderRadius);Object.values(Re).some(rt=>0!==rt)?(e.beginPath(),e.fillStyle=c.multiKeyBackground,qk(e,{x:me,y:he,w:E,h:k,radius:Re}),e.fill(),e.stroke(),e.fillStyle=f.backgroundColor,e.beginPath(),qk(e,{x:Pe,y:he+1,w:E-2,h:k-2,radius:Re}),e.fill()):(e.fillStyle=c.multiKeyBackground,e.fillRect(me,he,E,k),e.strokeRect(me,he,E,k),e.fillStyle=f.backgroundColor,e.fillRect(Pe,he+1,E-2,k-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,i,r){const{body:s}=this,{bodySpacing:c,bodyAlign:f,displayColors:y,boxHeight:k,boxWidth:E,boxPadding:F}=r,$=lc(r.bodyFont);let W=$.lineHeight,re=0;const he=sb(r.rtl,this.x,this.width),me=function(Vn){i.fillText(Vn,he.x(e.x+re),e.y+W/2),e.y+=W+c},Pe=he.textAlign(f);let Re,rt,ft,Ct,Vt,sn,Qt;for(i.textAlign=f,i.textBaseline="middle",i.font=$.string,e.x=oS(this,Pe,r),i.fillStyle=r.bodyColor,Cs(this.beforeBody,me),re=y&&"right"!==Pe?"center"===f?E/2+F:E+2+F:0,Ct=0,sn=s.length;Ct<sn;++Ct){for(Re=s[Ct],rt=this.labelTextColors[Ct],i.fillStyle=rt,Cs(Re.before,me),ft=Re.lines,y&&ft.length&&(this._drawColorBox(i,e,Ct,he,r),W=Math.max($.lineHeight,k)),Vt=0,Qt=ft.length;Vt<Qt;++Vt)me(ft[Vt]),W=$.lineHeight;Cs(Re.after,me)}re=0,W=$.lineHeight,Cs(this.afterBody,me),e.y-=c}drawFooter(e,i,r){const s=this.footer,c=s.length;let f,y;if(c){const k=sb(r.rtl,this.x,this.width);for(e.x=oS(this,r.footerAlign,r),e.y+=r.footerMarginTop,i.textAlign=k.textAlign(r.footerAlign),i.textBaseline="middle",f=lc(r.footerFont),i.fillStyle=r.footerColor,i.font=f.string,y=0;y<c;++y)i.fillText(s[y],k.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+r.footerSpacing}}drawBackground(e,i,r,s){const{xAlign:c,yAlign:f}=this,{x:y,y:k}=e,{width:E,height:F}=r,{topLeft:$,topRight:W,bottomLeft:re,bottomRight:he}=dy(s.cornerRadius);i.fillStyle=s.backgroundColor,i.strokeStyle=s.borderColor,i.lineWidth=s.borderWidth,i.beginPath(),i.moveTo(y+$,k),"top"===f&&this.drawCaret(e,i,r,s),i.lineTo(y+E-W,k),i.quadraticCurveTo(y+E,k,y+E,k+W),"center"===f&&"right"===c&&this.drawCaret(e,i,r,s),i.lineTo(y+E,k+F-he),i.quadraticCurveTo(y+E,k+F,y+E-he,k+F),"bottom"===f&&this.drawCaret(e,i,r,s),i.lineTo(y+re,k+F),i.quadraticCurveTo(y,k+F,y,k+F-re),"center"===f&&"left"===c&&this.drawCaret(e,i,r,s),i.lineTo(y,k+$),i.quadraticCurveTo(y,k,y+$,k),i.closePath(),i.fill(),s.borderWidth>0&&i.stroke()}_updateAnimationTarget(e){const i=this.chart,r=this.$animations,s=r&&r.x,c=r&&r.y;if(s||c){const f=eM[e.position].call(this,this._active,this._eventPosition);if(!f)return;const y=this._size=jV(this,e),k=Object.assign({},f,this._size),E=HV(i,e,k),F=UV(e,k,E,i);(s._to!==F.x||c._to!==F.y)&&(this.xAlign=E.xAlign,this.yAlign=E.yAlign,this.width=y.width,this.height=y.height,this.caretX=f.x,this.caretY=f.y,this._resolveAnimations().update(this,F))}}_willRender(){return!!this.opacity}draw(e){const i=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(i);const s={width:this.width,height:this.height},c={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const f=Dd(i.padding);i.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(e.save(),e.globalAlpha=r,this.drawBackground(c,e,s,i),CB(e,i.textDirection),c.y+=f.top,this.drawTitle(c,e,i),this.drawBody(c,e,i),this.drawFooter(c,e,i),SB(e,i.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,i){const r=this._active,s=e.map(({datasetIndex:y,index:k})=>{const E=this.chart.getDatasetMeta(y);if(!E)throw new Error("Cannot find a dataset at index "+y);return{datasetIndex:y,element:E.data[k],index:k}}),c=!L5(r,s),f=this._positionChanged(s,i);(c||f)&&(this._active=s,this._eventPosition=i,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,i,r=!0){if(i&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,c=this._active||[],f=this._getActiveElements(e,c,i,r),y=this._positionChanged(f,e),k=i||!L5(f,c)||y;return k&&(this._active=f,(s.enabled||s.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,i))),k}_getActiveElements(e,i,r,s){const c=this.options;if("mouseout"===e.type)return[];if(!s)return i.filter(y=>this.chart.data.datasets[y.datasetIndex]&&void 0!==this.chart.getDatasetMeta(y.datasetIndex).controller.getParsed(y.index));const f=this.chart.getElementsAtEventForMode(e,c.mode,c,r);return c.reverse&&f.reverse(),f}_positionChanged(e,i){const{caretX:r,caretY:s,options:c}=this,f=eM[c.position].call(this,e,i);return!1!==f&&(r!==f.x||s!==f.y)}})();var lge={id:"tooltip",_element:WV,positioners:eM,afterInit(t,n,e){e&&(t.tooltip=new WV({chart:t,options:e}))},beforeUpdate(t,n,e){t.tooltip&&t.tooltip.initialize(e)},reset(t,n,e){t.tooltip&&t.tooltip.initialize(e)},afterDraw(t){const n=t.tooltip;if(n&&n._willRender()){const e={tooltip:n};if(!1===t.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0}))return;n.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",e)}},afterEvent(t,n){t.tooltip&&t.tooltip.handleEvent(n.event,n.replay,n.inChartArea)&&(n.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,n)=>n.bodyFont.size,boxWidth:(t,n)=>n.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:GV},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},cge=Object.freeze({__proto__:null,Colors:xme,Decimation:Cme,Filler:$me,Legend:Kme,SubTitle:ege,Title:Jme,Tooltip:lge});function ZV(t){const n=this.getLabels();return t>=0&&t<n.length?n[t]:t}let pge=(()=>class t extends my{static id="category";static defaults={ticks:{callback:ZV}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const i=this._addedLabels;if(i.length){const r=this.getLabels();for(const{index:s,label:c}of i)r[s]===c&&r.splice(s,1);this._addedLabels=[]}super.init(e)}parse(e,i){if(Mo(e))return null;const r=this.getLabels();return((t,n)=>null===t?null:Rc(Math.round(t),0,n))(i=isFinite(i)&&r[i]===e?i:function hge(t,n,e,i){const r=t.indexOf(n);return-1===r?((t,n,e,i)=>("string"==typeof n?(e=t.push(n)-1,i.unshift({index:e,label:n})):isNaN(n)&&(e=null),e))(t,n,e,i):r!==t.lastIndexOf(n)?e:r}(r,e,Zr(i,e),this._addedLabels),r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:r,max:s}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(r=0),i||(s=this.getLabels().length-1)),this.min=r,this.max=s}buildTicks(){const e=this.min,i=this.max,r=this.options.offset,s=[];let c=this.getLabels();c=0===e&&i===c.length-1?c:c.slice(e,i+1),this._valueRange=Math.max(c.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let f=e;f<=i;f++)s.push({value:f});return s}getLabelForValue(e){return ZV.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const i=this.ticks;return e<0||e>i.length-1?null:this.getPixelForValue(i[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}})();function YV(t,n,{horizontal:e,minRotation:i}){const r=Ap(i),s=(e?Math.sin(r):Math.cos(r))||.001;return Math.min(n/s,.75*n*(""+t).length)}class sS extends my{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(n,e){return Mo(n)||("number"==typeof n||n instanceof Number)&&!isFinite(+n)?null:+n}handleTickRangeOptions(){const{beginAtZero:n}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:r,max:s}=this;const c=y=>r=e?r:y,f=y=>s=i?s:y;if(n){const y=jf(r),k=jf(s);y<0&&k<0?f(0):y>0&&k>0&&c(0)}if(r===s){let y=0===s?1:Math.abs(.05*s);f(s+y),n||c(r-y)}this.min=r,this.max=s}getTickLimit(){const n=this.options.ticks;let r,{maxTicksLimit:e,stepSize:i}=n;return i?(r=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,r>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${r} ticks. Limiting to 1000.`),r=1e3)):(r=this.computeTickLimit(),e=e||11),e&&(r=Math.min(e,r)),r}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const n=this.options,e=n.ticks;let i=this.getTickLimit();i=Math.max(2,i);const c=function fge(t,n){const e=[],{bounds:r,step:s,min:c,max:f,precision:y,count:k,maxTicks:E,maxDigits:F,includeBounds:$}=t,W=s||1,re=E-1,{min:he,max:me}=n,Pe=!Mo(c),Re=!Mo(f),rt=!Mo(k),ft=(me-he)/(F+1);let Vt,sn,Qt,Vn,Ct=XN((me-he)/re/W)*W;if(Ct<1e-14&&!Pe&&!Re)return[{value:he},{value:me}];Vn=Math.ceil(me/Ct)-Math.floor(he/Ct),Vn>re&&(Ct=XN(Vn*Ct/re/W)*W),Mo(y)||(Vt=Math.pow(10,y),Ct=Math.ceil(Ct*Vt)/Vt),"ticks"===r?(sn=Math.floor(he/Ct)*Ct,Qt=Math.ceil(me/Ct)*Ct):(sn=he,Qt=me),Pe&&Re&&s&&function eue(t,n){const e=Math.round(t);return e-n<=t&&e+n>=t}((f-c)/s,Ct/1e3)?(Vn=Math.round(Math.min((f-c)/Ct,E)),Ct=(f-c)/Vn,sn=c,Qt=f):rt?(sn=Pe?c:sn,Qt=Re?f:Qt,Vn=k-1,Ct=(Qt-sn)/Vn):(Vn=(Qt-sn)/Ct,Vn=Bk(Vn,Math.round(Vn),Ct/1e3)?Math.round(Vn):Math.ceil(Vn));const Hi=Math.max(QN(Ct),QN(sn));Vt=Math.pow(10,Mo(y)?Hi:y),sn=Math.round(sn*Vt)/Vt,Qt=Math.round(Qt*Vt)/Vt;let fr=0;for(Pe&&($&&sn!==c?(e.push({value:c}),sn<c&&fr++,Bk(Math.round((sn+fr*Ct)*Vt)/Vt,c,YV(c,ft,t))&&fr++):sn<c&&fr++);fr<Vn;++fr){const Or=Math.round((sn+fr*Ct)*Vt)/Vt;if(Re&&Or>f)break;e.push({value:Or})}return Re&&$&&Qt!==f?e.length&&Bk(e[e.length-1].value,f,YV(f,ft,t))?e[e.length-1].value=f:e.push({value:f}):(!Re||Qt===f)&&e.push({value:Qt}),e}({maxTicks:i,bounds:n.bounds,min:n.min,max:n.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===n.bounds&&KN(c,this,"value"),n.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}configure(){const n=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&n.length){const r=(i-e)/Math.max(n.length-1,1)/2;e-=r,i+=r}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(n){return Hk(n,this.chart.options.locale,this.options.ticks.format)}}const tM=t=>Math.floor(W1(t)),gy=(t,n)=>Math.pow(10,tM(t)+n);function XV(t){return t/Math.pow(10,tM(t))==1}function KV(t,n,e){const i=Math.pow(10,e),r=Math.floor(t/i);return Math.ceil(n/i)-r}function SI(t){const n=t.ticks;if(n.display&&t.display){const e=Dd(n.backdropPadding);return Zr(n.font&&n.font.size,_a.font.size)+e.height}return 0}function vge(t,n,e){return e=fa(e)?e:[e],{w:_ue(t,n.string,e),h:e.length*n.lineHeight}}function QV(t,n,e,i,r){return t===i||t===r?{start:n-e/2,end:n+e/2}:t<i||t>r?{start:n-e,end:n}:{start:n,end:n+e}}function xge(t,n,e,i,r){const s=Math.abs(Math.sin(e)),c=Math.abs(Math.cos(e));let f=0,y=0;i.start<n.l?(f=(n.l-i.start)/s,t.l=Math.min(t.l,n.l-f)):i.end>n.r&&(f=(i.end-n.r)/s,t.r=Math.max(t.r,n.r+f)),r.start<n.t?(y=(n.t-r.start)/c,t.t=Math.min(t.t,n.t-y)):r.end>n.b&&(y=(r.end-n.b)/c,t.b=Math.max(t.b,n.b+y))}function wge(t,n,e){const i=t.drawingArea,{extra:r,additionalAngle:s,padding:c,size:f}=e,y=t.getPointPosition(n,i+r+c,s),k=Math.round(GP(Jh(y.angle+Al))),E=function Ege(t,n,e){return 90===e||270===e?t-=n/2:(e>270||e<90)&&(t-=n),t}(y.y,f.h,k),F=function Cge(t){return 0===t||180===t?"center":t<180?"left":"right"}(k),$=function Sge(t,n,e){return"right"===e?t-=n:"center"===e&&(t-=n/2),t}(y.x,f.w,F);return{visible:!0,x:y.x,y:E,textAlign:F,left:$,top:E,right:$+f.w,bottom:E+f.h}}function kge(t,n){if(!n)return!0;const{left:e,top:i,right:r,bottom:s}=t;return!(ug({x:e,y:i},n)||ug({x:e,y:s},n)||ug({x:r,y:i},n)||ug({x:r,y:s},n))}function Dge(t,n,e){const{left:i,top:r,right:s,bottom:c}=e,{backdropColor:f}=n;if(!Mo(f)){const y=dy(n.borderRadius),k=Dd(n.backdropPadding);t.fillStyle=f;const E=i-k.left,F=r-k.top,$=s-i+k.width,W=c-r+k.height;Object.values(y).some(re=>0!==re)?(t.beginPath(),qk(t,{x:E,y:F,w:$,h:W,radius:y}),t.fill()):t.fillRect(E,F,$,W)}}function JV(t,n,e,i){const{ctx:r}=t;if(e)r.arc(t.xCenter,t.yCenter,n,0,ga);else{let s=t.getPointPosition(0,n);r.moveTo(s.x,s.y);for(let c=1;c<i;c++)s=t.getPointPosition(c,n),r.lineTo(s.x,s.y)}}const aS={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Sh=Object.keys(aS);function ej(t,n){return t-n}function tj(t,n){if(Mo(n))return null;const e=t._adapter,{parser:i,round:r,isoWeekday:s}=t._parseOpts;let c=n;return"function"==typeof i&&(c=i(c)),ul(c)||(c="string"==typeof i?e.parse(c,i):e.parse(c)),null===c?null:(r&&(c="week"!==r||!ib(s)&&!0!==s?e.startOf(c,r):e.startOf(c,"isoWeek",s)),+c)}function nj(t,n,e,i){const r=Sh.length;for(let s=Sh.indexOf(t);s<r-1;++s){const c=aS[Sh[s]];if(c.common&&Math.ceil((e-n)/((c.steps?c.steps:Number.MAX_SAFE_INTEGER)*c.size))<=i)return Sh[s]}return Sh[r-1]}function ij(t,n,e){if(e){if(e.length){const{lo:i,hi:r}=ZP(e,n);t[e[i]>=n?e[i]:e[r]]=!0}}else t[n]=!0}function rj(t,n,e){const i=[],r={},s=n.length;let c,f;for(c=0;c<s;++c)f=n[c],r[f]=c,i.push({value:f,major:!1});return 0!==s&&e?function Lge(t,n,e,i){const r=t._adapter,s=+r.startOf(n[0].value,i),c=n[n.length-1].value;let f,y;for(f=s;f<=c;f=+r.add(f,1,i))y=e[f],y>=0&&(n[y].major=!0);return n}(t,i,r,e):i}let EI=(()=>class t extends my{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,i={}){const r=e.time||(e.time={}),s=this._adapter=new zpe__date(e.adapters.date);s.init(i),zk(r.displayFormats,s.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=i.normalized}parse(e,i){return void 0===e?null:tj(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,i=this._adapter,r=e.time.unit||"day";let{min:s,max:c,minDefined:f,maxDefined:y}=this.getUserBounds();function k(E){!f&&!isNaN(E.min)&&(s=Math.min(s,E.min)),!y&&!isNaN(E.max)&&(c=Math.max(c,E.max))}(!f||!y)&&(k(this._getLabelBounds()),("ticks"!==e.bounds||"labels"!==e.ticks.source)&&k(this.getMinMax(!1))),s=ul(s)&&!isNaN(s)?s:+i.startOf(Date.now(),r),c=ul(c)&&!isNaN(c)?c:+i.endOf(Date.now(),r)+1,this.min=Math.min(s,c-1),this.max=Math.max(s+1,c)}_getLabelBounds(){const e=this.getLabelTimestamps();let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(i=e[0],r=e[e.length-1]),{min:i,max:r}}buildTicks(){const e=this.options,i=e.time,r=e.ticks,s="labels"===r.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const c=this.min,y=function rue(t,n,e){let i=0,r=t.length;for(;i<r&&t[i]<n;)i++;for(;r>i&&t[r-1]>e;)r--;return i>0||r<t.length?t.slice(i,r):t}(s,c,this.max);return this._unit=i.unit||(r.autoSkip?nj(i.minUnit,this.min,this.max,this._getLabelCapacity(c)):function Oge(t,n,e,i,r){for(let s=Sh.length-1;s>=Sh.indexOf(e);s--){const c=Sh[s];if(aS[c].common&&t._adapter.diff(r,i,c)>=n-1)return c}return Sh[e?Sh.indexOf(e):0]}(this,y.length,i.minUnit,this.min,this.max)),this._majorUnit=r.major.enabled&&"year"!==this._unit?function Rge(t){for(let n=Sh.indexOf(t)+1,e=Sh.length;n<e;++n)if(aS[Sh[n]].common)return Sh[n]}(this._unit):void 0,this.initOffsets(s),e.reverse&&y.reverse(),rj(this,y,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let s,c,i=0,r=0;this.options.offset&&e.length&&(s=this.getDecimalForValue(e[0]),i=1===e.length?1-s:(this.getDecimalForValue(e[1])-s)/2,c=this.getDecimalForValue(e[e.length-1]),r=1===e.length?c:(c-this.getDecimalForValue(e[e.length-2]))/2);const f=e.length<3?.5:.25;i=Rc(i,0,f),r=Rc(r,0,f),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const e=this._adapter,i=this.min,r=this.max,s=this.options,c=s.time,f=c.unit||nj(c.minUnit,i,r,this._getLabelCapacity(i)),y=Zr(s.ticks.stepSize,1),k="week"===f&&c.isoWeekday,E=ib(k)||!0===k,F={};let W,re,$=i;if(E&&($=+e.startOf($,"isoWeek",k)),$=+e.startOf($,E?"day":f),e.diff(r,i,f)>1e5*y)throw new Error(i+" and "+r+" are too far apart with stepSize of "+y+" "+f);const he="data"===s.ticks.source&&this.getDataTimestamps();for(W=$,re=0;W<r;W=+e.add(W,y,f),re++)ij(F,W,he);return(W===r||"ticks"===s.bounds||1===re)&&ij(F,W,he),Object.keys(F).sort(ej).map(me=>+me)}getLabelForValue(e){const r=this.options.time;return this._adapter.format(e,r.tooltipFormat?r.tooltipFormat:r.displayFormats.datetime)}format(e,i){return this._adapter.format(e,i||this.options.time.displayFormats[this._unit])}_tickFormatFunction(e,i,r,s){const c=this.options,f=c.ticks.callback;if(f)return ta(f,[e,i,r],this);const y=c.time.displayFormats,k=this._unit,E=this._majorUnit,$=E&&y[E],W=r[i];return this._adapter.format(e,s||(E&&$&&W&&W.major?$:k&&y[k]))}generateTickLabels(e){let i,r,s;for(i=0,r=e.length;i<r;++i)s=e[i],s.label=this._tickFormatFunction(s.value,i,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const i=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((i.start+r)*i.factor)}getValueForPixel(e){const i=this._offsets,r=this.getDecimalForPixel(e)/i.factor-i.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const i=this.options.ticks,r=this.ctx.measureText(e).width,s=Ap(this.isHorizontal()?i.maxRotation:i.minRotation),c=Math.cos(s),f=Math.sin(s),y=this._resolveTickFontOptions(0).size;return{w:r*c+y*f,h:r*f+y*c}}_getLabelCapacity(e){const i=this.options.time,r=i.displayFormats,s=r[i.unit]||r.millisecond,c=this._tickFormatFunction(e,0,rj(this,[e],this._majorUnit),s),f=this._getLabelSize(c),y=Math.floor(this.isHorizontal()?this.width/f.w:this.height/f.h)-1;return y>0?y:1}getDataTimestamps(){let i,r,e=this._cache.data||[];if(e.length)return e;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(i=0,r=s.length;i<r;++i)e=e.concat(s[i].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let i,r;if(e.length)return e;const s=this.getLabels();for(i=0,r=s.length;i<r;++i)e.push(tj(this,s[i]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return nB(e.sort(ej))}})();function lS(t,n,e){let s,c,f,y,i=0,r=t.length-1;e?(n>=t[i].pos&&n<=t[r].pos&&({lo:i,hi:r}=hg(t,"pos",n)),({pos:s,time:f}=t[i]),({pos:c,time:y}=t[r])):(n>=t[i].time&&n<=t[r].time&&({lo:i,hi:r}=hg(t,"time",n)),({time:s,pos:f}=t[i]),({time:c,pos:y}=t[r]));const k=c-s;return k?f+(y-f)*(n-s)/k:f}var zge=Object.freeze({__proto__:null,CategoryScale:pge,LinearScale:class mge extends sS{static id="linear";static defaults={ticks:{callback:B5.formatters.numeric}};determineDataLimits(){const{min:n,max:e}=this.getMinMax(!0);this.min=ul(n)?n:0,this.max=ul(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const n=this.isHorizontal(),e=n?this.width:this.height,i=Ap(this.options.ticks.minRotation),r=(n?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/r))}getPixelForValue(n){return null===n?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getValueForPixel(n){return this._startValue+this.getDecimalForPixel(n)*this._valueRange}},LogarithmicScale:class yge extends my{static id="logarithmic";static defaults={ticks:{callback:B5.formatters.logarithmic,major:{enabled:!0}}};constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(n,e){const i=sS.prototype.parse.apply(this,[n,e]);if(0!==i)return ul(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:n,max:e}=this.getMinMax(!0);this.min=ul(n)?Math.max(0,n):null,this.max=ul(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ul(this._userMin)&&(this.min=n===gy(this.min,0)?gy(this.min,-1):gy(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:n,maxDefined:e}=this.getUserBounds();let i=this.min,r=this.max;const s=f=>i=n?i:f,c=f=>r=e?r:f;i===r&&(i<=0?(s(1),c(10)):(s(gy(i,-1)),c(gy(r,1)))),i<=0&&s(gy(r,-1)),r<=0&&c(gy(i,1)),this.min=i,this.max=r}buildTicks(){const n=this.options,i=function _ge(t,{min:n,max:e}){n=Qh(t.min,n);const i=[],r=tM(n);let s=function gge(t,n){let i=tM(n-t);for(;KV(t,n,i)>10;)i++;for(;KV(t,n,i)<10;)i--;return Math.min(i,tM(t))}(n,e),c=s<0?Math.pow(10,Math.abs(s)):1;const f=Math.pow(10,s),y=r>s?Math.pow(10,r):0,k=Math.round((n-y)*c)/c,E=Math.floor((n-y)/f/10)*f*10;let F=Math.floor((k-E)/Math.pow(10,s)),$=Qh(t.min,Math.round((y+E+F*Math.pow(10,s))*c)/c);for(;$<e;)i.push({value:$,major:XV($),significand:F}),F>=10?F=F<15?15:20:F++,F>=20&&(s++,F=2,c=s>=0?1:c),$=Math.round((y+E+F*Math.pow(10,s))*c)/c;const W=Qh(t.max,$);return i.push({value:W,major:XV(W),significand:F}),i}({min:this._userMin,max:this._userMax},this);return"ticks"===n.bounds&&KN(i,this,"value"),n.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(n){return void 0===n?"0":Hk(n,this.chart.options.locale,this.options.ticks.format)}configure(){const n=this.min;super.configure(),this._startValue=W1(n),this._valueRange=W1(this.max)-W1(n)}getPixelForValue(n){return(void 0===n||0===n)&&(n=this.min),null===n||isNaN(n)?NaN:this.getPixelForDecimal(n===this.min?0:(W1(n)-this._startValue)/this._valueRange)}getValueForPixel(n){const e=this.getDecimalForPixel(n);return Math.pow(10,this._startValue+e*this._valueRange)}},RadialLinearScale:class Ige extends sS{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:B5.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:n=>n,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(n){super(n),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const n=this._padding=Dd(SI(this.options)/2),e=this.width=this.maxWidth-n.width,i=this.height=this.maxHeight-n.height;this.xCenter=Math.floor(this.left+e/2+n.left),this.yCenter=Math.floor(this.top+i/2+n.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:n,max:e}=this.getMinMax(!1);this.min=ul(n)&&!isNaN(n)?n:0,this.max=ul(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/SI(this.options))}generateTickLabels(n){sS.prototype.generateTickLabels.call(this,n),this._pointLabels=this.getLabels().map((e,i)=>{const r=ta(this.options.pointLabels.callback,[e,i],this);return r||0===r?r:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const n=this.options;n.display&&n.pointLabels.display?function bge(t){const n={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},e=Object.assign({},n),i=[],r=[],s=t._pointLabels.length,c=t.options.pointLabels,f=c.centerPointLabels?ma/s:0;for(let y=0;y<s;y++){const k=c.setContext(t.getPointLabelContext(y));r[y]=k.padding;const E=t.getPointPosition(y,t.drawingArea+r[y],f),F=lc(k.font),$=vge(t.ctx,F,t._pointLabels[y]);i[y]=$;const W=Jh(t.getIndexAngle(y)+f),re=Math.round(GP(W));xge(e,n,W,QV(re,E.x,$.w,0,180),QV(re,E.y,$.h,90,270))}t.setCenterPoint(n.l-e.l,e.r-n.r,n.t-e.t,e.b-n.b),t._pointLabelItems=function Mge(t,n,e){const i=[],r=t._pointLabels.length,s=t.options,{centerPointLabels:c,display:f}=s.pointLabels,y={extra:SI(s)/2,additionalAngle:c?ma/r:0};let k;for(let E=0;E<r;E++){y.padding=e[E],y.size=n[E];const F=wge(t,E,y);i.push(F),"auto"===f&&(F.visible=kge(F,k),F.visible&&(k=F))}return i}(t,i,r)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(n,e,i,r){this.xCenter+=Math.floor((n-e)/2),this.yCenter+=Math.floor((i-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(n,e,i,r))}getIndexAngle(n){return Jh(n*(ga/(this._pointLabels.length||1))+Ap(this.options.startAngle||0))}getDistanceFromCenterForValue(n){if(Mo(n))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-n)*e:(n-this.min)*e}getValueForDistanceFromCenter(n){if(Mo(n))return NaN;const e=n/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(n){const e=this._pointLabels||[];if(n>=0&&n<e.length){const i=e[n];return function Pge(t,n,e){return Z1(t,{label:e,index:n,type:"pointLabel"})}(this.getContext(),n,i)}}getPointPosition(n,e,i=0){const r=this.getIndexAngle(n)-Al+i;return{x:Math.cos(r)*e+this.xCenter,y:Math.sin(r)*e+this.yCenter,angle:r}}getPointPositionForValue(n,e){return this.getPointPosition(n,this.getDistanceFromCenterForValue(e))}getBasePosition(n){return this.getPointPositionForValue(n||0,this.getBaseValue())}getPointLabelPosition(n){const{left:e,top:i,right:r,bottom:s}=this._pointLabelItems[n];return{left:e,top:i,right:r,bottom:s}}drawBackground(){const{backgroundColor:n,grid:{circular:e}}=this.options;if(n){const i=this.ctx;i.save(),i.beginPath(),JV(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=n,i.fill(),i.restore()}}drawGrid(){const n=this.ctx,e=this.options,{angleLines:i,grid:r,border:s}=e,c=this._pointLabels.length;let f,y,k;if(e.pointLabels.display&&function Tge(t,n){const{ctx:e,options:{pointLabels:i}}=t;for(let r=n-1;r>=0;r--){const s=t._pointLabelItems[r];if(!s.visible)continue;const c=i.setContext(t.getPointLabelContext(r));Dge(e,c,s);const f=lc(c.font),{x:y,y:k,textAlign:E}=s;cy(e,t._pointLabels[r],y,k+f.lineHeight/2,f,{color:c.color,textAlign:E,textBaseline:"middle"})}}(this,c),r.display&&this.ticks.forEach((E,F)=>{if(0!==F||0===F&&this.min<0){y=this.getDistanceFromCenterForValue(E.value);const $=this.getContext(F),W=r.setContext($),re=s.setContext($);!function Age(t,n,e,i,r){const s=t.ctx,c=n.circular,{color:f,lineWidth:y}=n;!c&&!i||!f||!y||e<0||(s.save(),s.strokeStyle=f,s.lineWidth=y,s.setLineDash(r.dash||[]),s.lineDashOffset=r.dashOffset,s.beginPath(),JV(t,e,c,i),s.closePath(),s.stroke(),s.restore())}(this,W,y,c,re)}}),i.display){for(n.save(),f=c-1;f>=0;f--){const E=i.setContext(this.getPointLabelContext(f)),{color:F,lineWidth:$}=E;!$||!F||(n.lineWidth=$,n.strokeStyle=F,n.setLineDash(E.borderDash),n.lineDashOffset=E.borderDashOffset,y=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),k=this.getPointPosition(f,y),n.beginPath(),n.moveTo(this.xCenter,this.yCenter),n.lineTo(k.x,k.y),n.stroke())}n.restore()}}drawBorder(){}drawLabels(){const n=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const r=this.getIndexAngle(0);let s,c;n.save(),n.translate(this.xCenter,this.yCenter),n.rotate(r),n.textAlign="center",n.textBaseline="middle",this.ticks.forEach((f,y)=>{if(0===y&&this.min>=0&&!e.reverse)return;const k=i.setContext(this.getContext(y)),E=lc(k.font);if(s=this.getDistanceFromCenterForValue(this.ticks[y].value),k.showLabelBackdrop){n.font=E.string,c=n.measureText(f.label).width,n.fillStyle=k.backdropColor;const F=Dd(k.backdropPadding);n.fillRect(-c/2-F.left,-s-E.size/2-F.top,c+F.width,E.size+F.height)}cy(n,f.label,0,-s,E,{color:k.color,strokeColor:k.textStrokeColor,strokeWidth:k.textStrokeWidth})}),n.restore()}drawTitle(){}},TimeScale:EI,TimeSeriesScale:class Fge extends EI{static id="timeseries";static defaults=EI.defaults;constructor(n){super(n),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const n=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(n);this._minPos=lS(e,this.min),this._tableRange=lS(e,this.max)-this._minPos,super.initOffsets(n)}buildLookupTable(n){const{min:e,max:i}=this,r=[],s=[];let c,f,y,k,E;for(c=0,f=n.length;c<f;++c)k=n[c],k>=e&&k<=i&&r.push(k);if(r.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(c=0,f=r.length;c<f;++c)E=r[c+1],y=r[c-1],k=r[c],Math.round((E+y)/2)!==k&&s.push({time:k,pos:c/(f-1)});return s}_generate(){const n=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(n)||!i.length)&&i.splice(0,0,n),(!i.includes(e)||1===i.length)&&i.push(e),i.sort((r,s)=>r-s)}_getTimestampsForTable(){let n=this._cache.all||[];if(n.length)return n;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return n=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,n=this._cache.all=n,n}getDecimalForValue(n){return(lS(this._table,n)-this._minPos)/this._tableRange}getValueForPixel(n){const e=this._offsets,i=this.getDecimalForPixel(n)/e.factor-e.end;return lS(this._table,i*this._tableRange+this._minPos,!0)}}});const Nge=[Fpe,fme,cge,zge],cS=function jge(t,n){return t===n||t!=t&&n!=n},dS=function Hge(t,n){for(var e=t.length;e--;)if(cS(t[e][0],n))return e;return-1};var qge=Array.prototype.splice;function lb(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var i=t[n];this.set(i[0],i[1])}}lb.prototype.clear=function Bge(){this.__data__=[],this.size=0},lb.prototype.delete=function $ge(t){var n=this.__data__,e=dS(n,t);return!(e<0||(e==n.length-1?n.pop():qge.call(n,e,1),--this.size,0))},lb.prototype.get=function Wge(t){var n=this.__data__,e=dS(n,t);return e<0?void 0:n[e][1]},lb.prototype.has=function Yge(t){return dS(this.__data__,t)>-1},lb.prototype.set=function Kge(t,n){var e=this.__data__,i=dS(e,t);return i<0?(++this.size,e.push([t,n])):e[i][1]=n,this};const hS=lb,oj="object"==typeof global&&global&&global.Object===Object&&global;var l1e="object"==typeof self&&self&&self.Object===Object&&self;const cb=oj||l1e||Function("return this")();var d1e=cb.Symbol,sj=Object.prototype,h1e=sj.hasOwnProperty,u1e=sj.toString,nM=d1e?d1e.toStringTag:void 0;var g1e=Object.prototype.toString;var aj=d1e?d1e.toStringTag:void 0;const pS=function x1e(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":aj&&aj in Object(t)?function p1e(t){var n=h1e.call(t,nM),e=t[nM];try{t[nM]=void 0;var i=!0}catch{}var r=u1e.call(t);return i&&(n?t[nM]=e:delete t[nM]),r}(t):function _1e(t){return g1e.call(t)}(t)},_y=function w1e(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)},DI=function E1e(t){if(!_y(t))return!1;var n=pS(t);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n};var t,D1e=cb["__core-js_shared__"],lj=(t=/[^.]+$/.exec(D1e&&D1e.keys&&D1e.keys.IE_PROTO||""))?"Symbol(src)_1."+t:"";var I1e=Function.prototype.toString;var F1e=/^\[object .+?Constructor\]$/,j1e=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const U1e=function H1e(t){return!(!_y(t)||function T1e(t){return!!lj&&lj in t}(t))&&(DI(t)?j1e:F1e).test(function O1e(t){if(null!=t){try{return I1e.call(t)}catch{}try{return t+""}catch{}}return""}(t))},AI=function G1e(t,n){var e=function q1e(t,n){return t?.[n]}(t,n);return U1e(e)?e:void 0},cj=AI(cb,"Map"),iM=AI(Object,"create");var t0e=Object.prototype.hasOwnProperty;var o0e=Object.prototype.hasOwnProperty;function db(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var i=t[n];this.set(i[0],i[1])}}db.prototype.clear=function Y1e(){this.__data__=iM?iM(null):{},this.size=0},db.prototype.delete=function K1e(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},db.prototype.get=function n0e(t){var n=this.__data__;if(iM){var e=n[t];return"__lodash_hash_undefined__"===e?void 0:e}return t0e.call(n,t)?n[t]:void 0},db.prototype.has=function s0e(t){var n=this.__data__;return iM?void 0!==n[t]:o0e.call(n,t)},db.prototype.set=function c0e(t,n){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=iM&&void 0===n?"__lodash_hash_undefined__":n,this};const dj=db,fS=function m0e(t,n){var e=t.__data__;return function p0e(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}(n)?e["string"==typeof n?"string":"hash"]:e.map};function hb(t){var n=-1,e=null==t?0:t.length;for(this.clear();++n<e;){var i=t[n];this.set(i[0],i[1])}}hb.prototype.clear=function h0e(){this.size=0,this.__data__={hash:new dj,map:new(cj||hS),string:new dj}},hb.prototype.delete=function g0e(t){var n=fS(this,t).delete(t);return this.size-=n?1:0,n},hb.prototype.get=function y0e(t){return fS(this,t).get(t)},hb.prototype.has=function b0e(t){return fS(this,t).has(t)},hb.prototype.set=function w0e(t,n){var e=fS(this,t),i=e.size;return e.set(t,n),this.size+=e.size==i?0:1,this};const M0e=hb;function ub(t){var n=this.__data__=new hS(t);this.size=n.size}ub.prototype.clear=function Jge(){this.__data__=new hS,this.size=0},ub.prototype.delete=function t1e(t){var n=this.__data__,e=n.delete(t);return this.size=n.size,e},ub.prototype.get=function i1e(t){return this.__data__.get(t)},ub.prototype.has=function o1e(t){return this.__data__.has(t)},ub.prototype.set=function S0e(t,n){var e=this.__data__;if(e instanceof hS){var i=e.__data__;if(!cj||i.length<199)return i.push([t,n]),this.size=++e.size,this;e=this.__data__=new M0e(i)}return e.set(t,n),this.size=e.size,this};const D0e=ub;var T0e=function(){try{var t=AI(Object,"defineProperty");return t({},"",{}),t}catch{}}();const mS=T0e,PI=function A0e(t,n,e){"__proto__"==n&&mS?mS(t,n,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[n]=e},II=function P0e(t,n,e){(void 0!==e&&!cS(t[n],e)||void 0===e&&!(n in t))&&PI(t,n,e)};var O0e=function I0e(t){return function(n,e,i){for(var r=-1,s=Object(n),c=i(n),f=c.length;f--;){var y=c[t?f:++r];if(!1===e(s[y],y,s))break}return n}}();const R0e=O0e;var hj="object"==typeof exports&&exports&&!exports.nodeType&&exports,uj=hj&&"object"==typeof module&&module&&!module.nodeType&&module,pj=uj&&uj.exports===hj?cb.Buffer:void 0,fj=pj?pj.allocUnsafe:void 0;const mj=cb.Uint8Array,H0e=function j0e(t,n){var e=n?function B0e(t){var n=new t.constructor(t.byteLength);return new mj(n).set(new mj(t)),n}(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)};var gj=Object.create,$0e=function(){function t(){}return function(n){if(!_y(n))return{};if(gj)return gj(n);t.prototype=n;var e=new t;return t.prototype=void 0,e}}();const G0e=$0e;var Z0e=function W0e(t,n){return function(e){return t(n(e))}}(Object.getPrototypeOf,Object);const _j=Z0e;var Y0e=Object.prototype;const yj=function X0e(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||Y0e)},rM=function J0e(t){return null!=t&&"object"==typeof t},vj=function t_e(t){return rM(t)&&"[object Arguments]"==pS(t)};var bj=Object.prototype,n_e=bj.hasOwnProperty,i_e=bj.propertyIsEnumerable,r_e=vj(function(){return arguments}())?vj:function(t){return rM(t)&&n_e.call(t,"callee")&&!i_e.call(t,"callee")};const OI=r_e,RI=Array.isArray,xj=function a_e(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},LI=function l_e(t){return null!=t&&xj(t.length)&&!DI(t)};var wj="object"==typeof exports&&exports&&!exports.nodeType&&exports,kj=wj&&"object"==typeof module&&module&&!module.nodeType&&module,Mj=kj&&kj.exports===wj?cb.Buffer:void 0;const Cj=(Mj?Mj.isBuffer:void 0)||function h_e(){return!1};var Sj=Function.prototype.toString,v_e=Object.prototype.hasOwnProperty,b_e=Sj.call(Object);var ya={};ya["[object Float32Array]"]=ya["[object Float64Array]"]=ya["[object Int8Array]"]=ya["[object Int16Array]"]=ya["[object Int32Array]"]=ya["[object Uint8Array]"]=ya["[object Uint8ClampedArray]"]=ya["[object Uint16Array]"]=ya["[object Uint32Array]"]=!0,ya["[object Arguments]"]=ya["[object Array]"]=ya["[object ArrayBuffer]"]=ya["[object Boolean]"]=ya["[object DataView]"]=ya["[object Date]"]=ya["[object Error]"]=ya["[object Function]"]=ya["[object Map]"]=ya["[object Number]"]=ya["[object Object]"]=ya["[object RegExp]"]=ya["[object Set]"]=ya["[object String]"]=ya["[object WeakMap]"]=!1;var Ej="object"==typeof exports&&exports&&!exports.nodeType&&exports,oM=Ej&&"object"==typeof module&&module&&!module.nodeType&&module,FI=oM&&oM.exports===Ej&&oj.process,Q_e=function(){try{return oM&&oM.require&&oM.require("util").types||FI&&FI.binding&&FI.binding("util")}catch{}}(),Tj=Q_e&&Q_e.isTypedArray;const Aj=Tj?function Y_e(t){return function(n){return t(n)}}(Tj):function W_e(t){return rM(t)&&xj(t.length)&&!!ya[pS(t)]},zI=function eye(t,n){if(("constructor"!==n||"function"!=typeof t[n])&&"__proto__"!=n)return t[n]};var nye=Object.prototype.hasOwnProperty;const rye=function iye(t,n,e){var i=t[n];(!nye.call(t,n)||!cS(i,e)||void 0===e&&!(n in t))&&PI(t,n,e)};var dye=/^(?:0|[1-9]\d*)$/;const Pj=function hye(t,n){var e=typeof t;return!!(n=n??9007199254740991)&&("number"==e||"symbol"!=e&&dye.test(t))&&t>-1&&t%1==0&&t<n};var pye=Object.prototype.hasOwnProperty;const mye=function fye(t,n){var e=RI(t),i=!e&&OI(t),r=!e&&!i&&Cj(t),s=!e&&!i&&!r&&Aj(t),c=e||i||r||s,f=c?function aye(t,n){for(var e=-1,i=Array(t);++e<t;)i[e]=n(e);return i}(t.length,String):[],y=f.length;for(var k in t)(n||pye.call(t,k))&&(!c||!("length"==k||r&&("offset"==k||"parent"==k)||s&&("buffer"==k||"byteLength"==k||"byteOffset"==k)||Pj(k,y)))&&f.push(k);return f};var vye=Object.prototype.hasOwnProperty;const xye=function bye(t){if(!_y(t))return function gye(t){var n=[];if(null!=t)for(var e in Object(t))n.push(e);return n}(t);var n=yj(t),e=[];for(var i in t)"constructor"==i&&(n||!vye.call(t,i))||e.push(i);return e},Ij=function wye(t){return LI(t)?mye(t,!0):xye(t)},Mye=function kye(t){return function oye(t,n,e,i){var r=!e;e||(e={});for(var s=-1,c=n.length;++s<c;){var f=n[s],y=i?i(e[f],t[f],f,e,t):void 0;void 0===y&&(y=t[f]),r?PI(e,f,y):rye(e,f,y)}return e}(t,Ij(t))},Sye=function Cye(t,n,e,i,r,s,c){var f=zI(t,e),y=zI(n,e),k=c.get(y);if(k)II(t,e,k);else{var E=s?s(f,y,e+"",t,n,c):void 0,F=void 0===E;if(F){var $=RI(y),W=!$&&Cj(y),re=!$&&!W&&Aj(y);E=y,$||W||re?RI(f)?E=f:function c_e(t){return rM(t)&&LI(t)}(f)?E=function U0e(t,n){var e=-1,i=t.length;for(n||(n=Array(i));++e<i;)n[e]=t[e];return n}(f):W?(F=!1,E=function F0e(t,n){if(n)return t.slice();var e=t.length,i=fj?fj(e):new t.constructor(e);return t.copy(i),i}(y,!0)):re?(F=!1,E=H0e(y,!0)):E=[]:function x_e(t){if(!rM(t)||"[object Object]"!=pS(t))return!1;var n=_j(t);if(null===n)return!0;var e=v_e.call(n,"constructor")&&n.constructor;return"function"==typeof e&&e instanceof e&&Sj.call(e)==b_e}(y)||OI(y)?(E=f,OI(f)?E=Mye(f):(!_y(f)||DI(f))&&(E=function K0e(t){return"function"!=typeof t.constructor||yj(t)?{}:G0e(_j(t))}(y))):F=!1}F&&(c.set(y,E),r(E,y,i,s,c),c.delete(y)),II(t,e,E)}},Eye=function Oj(t,n,e,i,r){t!==n&&R0e(n,function(s,c){if(r||(r=new D0e),_y(s))Sye(t,n,c,e,Oj,i,r);else{var f=i?i(zI(t,c),s,c+"",t,n,r):void 0;void 0===f&&(f=s),II(t,c,f)}},Ij)},Rj=function Dye(t){return t};var Lj=Math.max;const Rye=function Oye(t){return function(){return t}};var Lye=mS?function(t,n){return mS(t,"toString",{configurable:!0,enumerable:!1,value:Rye(n),writable:!0})}:Rj,Bye=Date.now,jye=function Vye(t){var n=0,e=0;return function(){var i=Bye(),r=16-(i-e);if(e=i,r>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}(Lye);const Hye=jye,qye=function Uye(t,n){return Hye(function Pye(t,n,e){return n=Lj(void 0===n?t.length-1:n,0),function(){for(var i=arguments,r=-1,s=Lj(i.length-n,0),c=Array(s);++r<s;)c[r]=i[n+r];r=-1;for(var f=Array(n+1);++r<n;)f[r]=i[r];return f[n]=e(c),function Tye(t,n,e){switch(e.length){case 0:return t.call(n);case 1:return t.call(n,e[0]);case 2:return t.call(n,e[0],e[1]);case 3:return t.call(n,e[0],e[1],e[2])}return t.apply(n,e)}(t,this,f)}}(t,n,Rj),t+"")};var Zye=function Wye(t){return qye(function(n,e){var i=-1,r=e.length,s=r>1?e[r-1]:void 0,c=r>2?e[2]:void 0;for(s=t.length>3&&"function"==typeof s?(r--,s):void 0,c&&function $ye(t,n,e){if(!_y(e))return!1;var i=typeof n;return!!("number"==i?LI(e)&&Pj(n,e.length):"string"==i&&n in e)&&cS(e[n],t)}(e[0],e[1],c)&&(s=r<3?void 0:s,r=1),n=Object(n);++i<r;){var f=e[i];f&&t(n,f,i,s)}return n})}(function(t,n,e){Eye(t,n,e)});const Fj=Zye;let Yye=(()=>{class t{constructor(){this.colorschemesOptions=new Is(void 0)}setColorschemesOptions(e){this.pColorschemesOptions=e,this.colorschemesOptions.next(e)}getColorschemesOptions(){return this.pColorschemesOptions}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),zj=(()=>{class t{constructor(e,i,r){this.zone=i,this.themeService=r,this.type="bar",this.plugins=[],this.chartClick=new Xi,this.chartHover=new Xi,this.subs=[],this.themeOverrides={},this.ctx=e.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(na()).subscribe(s=>this.themeChanged(s)))}ngOnChanges(e){const i=["type"],r=Object.getOwnPropertyNames(e);if(r.some(s=>i.includes(s))||r.every(s=>e[s].isFirstChange()))this.render();else{const s=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,s.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,s.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,s.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(e=>e.unsubscribe())}render(){return this.chart&&this.chart.destroy(),this.zone.runOutsideAngular(()=>this.chart=new tS(this.ctx,this.getChartConfiguration()))}update(e){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(e))}hideDataset(e,i){this.chart&&(this.chart.getDatasetMeta(e).hidden=i,this.update())}isDatasetHidden(e){return this.chart?.getDatasetMeta(e)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(e){this.themeOverrides=e,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return Fj({onHover:(e,i)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:e,active:i}))},onClick:(e,i)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:e,active:i}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions(),plugins:this.plugins}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}}return t.\u0275fac=function(e){return new(e||t)(st(ns),st(Mr),st(Yye))},t.\u0275dir=gi({type:t,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[ol]}),t})();const Xye=[[255,99,132],[54,162,235],[255,206,86],[231,233,237],[75,192,192],[151,187,205],[220,220,220],[247,70,74],[70,191,189],[253,180,92],[148,159,177],[77,83,96]],Kye={plugins:{colors:{enabled:!1}},datasets:{line:{backgroundColor:t=>K1(Q1(t.datasetIndex),.4),borderColor:t=>K1(Q1(t.datasetIndex),1),pointBackgroundColor:t=>K1(Q1(t.datasetIndex),1),pointBorderColor:"#fff"},bar:{backgroundColor:t=>K1(Q1(t.datasetIndex),.6),borderColor:t=>K1(Q1(t.datasetIndex),1)},get radar(){return this.line},doughnut:{backgroundColor:t=>K1(Q1(t.dataIndex),.6),borderColor:"#fff"},get pie(){return this.doughnut},polarArea:{backgroundColor:t=>K1(Q1(t.dataIndex),.6),borderColor:t=>K1(Q1(t.dataIndex),1)},get bubble(){return this.doughnut},get scatter(){return this.doughnut},get area(){return this.polarArea}}};function K1(t,n){return"rgba("+t.concat(n).join(",")+")"}function NI(t,n){return Math.floor(Math.random()*(n-t+1))+t}function Q1(t=0){return Xye[t]||function Qye(){return[NI(0,255),NI(0,255),NI(0,255)]}()}let Nj=(()=>{class t{constructor(){this.generateColors=!0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();tS.register(...Nge);let Jye=(()=>{class t{constructor(e){e?.plugins&&tS.register(...e?.plugins);const i=Fj(e?.generateColors?Kye:{},e?.defaults||{});_a.set(i)}static forRoot(e){return{ngModule:t,providers:[{provide:Nj,useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(Dt(Nj,8))},t.\u0275mod=Bi({type:t}),t.\u0275inj=Ii({}),t})();function eve(t,n){if(1&t&&(z(0,"div",27)(1,"div",28)(2,"span"),q(3),B()(),z(4,"div",29)(5,"div",30),q(6),B(),z(7,"div",31),q(8),ks(9,"date"),B(),z(10,"div",32),q(11),B(),z(12,"div",33),q(13),B()()()),2&t){const e=n.$implicit;ne(3),Yt("",e.name.charAt(0),"",e.lastName.charAt(0),""),ne(3),Yt("",e.name," ",e.lastName,""),ne(2),Qe(Xd(9,8,e.appointmentDate,"short")),ne(3),Qe(e.propertyTitle),ne(1),ye("ngClass","status-"+(null==e.status?null:e.status.toLocaleLowerCase)),ne(1),Ft(" ",e.status," ")}}function tve(t,n){if(1&t&&(z(0,"div",25),He(1,eve,14,11,"div",26),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.upcomingAppointments)}}function nve(t,n){1&t&&(z(0,"div",34)(1,"div",35),q(2,"\u{1f4c5}"),B(),z(3,"p",36),q(4,"No upcoming appointments"),B(),z(5,"p",37),q(6,"New appointments will appear here"),B()())}const Bj=function(t,n){return{labels:t,datasets:n}};let ive=(()=>{class t{constructor(e,i,r){this.propertyService=e,this.userService=i,this.router=r,this.properties=[],this.appointments=[],this.filteredProperties=[],this.isLoading=!0,this.error=null,this.totalViews=0,this.approvedPropertiesCount=0,this.pendingRequestsCount=0,this.newMessagesCount=0,this.upcomingAppointmentsCount=0,this.upcomingAppointments=[],this.allPropertiesCount=0,this.viewChartLabels=[],this.viewChartData=[],this.bookingChartLabels=[],this.bookingChartData=[],this.chartOptions={responsive:!0,scales:{y:{beginAtZero:!0}}},this.currentFilters={}}ngOnInit(){this.isLoading=!0,this.loadAllProperties(),this.loadappProperties(),this.loadpendingrequest(),this.loadAppointments(),this.loadUpcomingAppointments(),this.loadMessages(),this.loadMonthlyViews(),this.loadMonthlyBookings(),this.propertyService.getTotalViewsForOwner().subscribe({next:i=>{this.totalViews=i.totalViews,this.isLoading=!1}})}loadappProperties(){this.isLoading=!0,this.propertyService.getApprovedPropertiesCount().subscribe({next:e=>{this.approvedPropertiesCount=e.approvedProperties},error:e=>{console.error("Failed to fetch approved properties count:",e)}})}loadAppointments(){this.propertyService.getUserAppointments().subscribe({next:e=>{this.appointments=e,this.upcomingAppointmentsCount=e.filter(i=>"confirmed"===i.status).length},error:e=>{this.error="Failed to load appointments. Please try again."}})}loadUpcomingAppointments(){this.propertyService.getOwnerAppointments().subscribe({next:e=>{const i=new Date;this.upcomingAppointments=e.filter(r=>new Date(r.appointmentDate)>i)},error:e=>{console.error("Failed to fetch appointments",e)}})}loadAllProperties(){this.isLoading=!0,this.propertyService.getAllPropertiesCount().subscribe({next:e=>this.allPropertiesCount=e.allProperties,error:e=>console.error("Error fetching all properties count:",e)})}loadpendingrequest(){this.propertyService.getPendingAppointmentsCount().subscribe({next:e=>{this.pendingRequestsCount=e.pendingAppointmentsCount},error:e=>{console.error("Error fetching owner appointments:",e)}})}loadMessages(){this.propertyService.getUnreadMessageCount().subscribe({next:e=>{this.newMessagesCount=e},error:e=>{console.error("Error fetching unread messages count:",e)}})}loadMonthlyViews(){this.propertyService.getmonthlyviews().subscribe(e=>{const i=this.aggregateMonthly(e.views,"viewedAt");this.viewChartLabels=Object.keys(i),this.viewChartData=[{data:Object.values(i),label:"Views",backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:3,fill:!0}]})}loadMonthlyBookings(){this.propertyService.getUserBookings().subscribe(e=>{const i=this.aggregateMonthly(e,"startDate");this.bookingChartLabels=Object.keys(i),this.bookingChartData=[{data:Object.values(i),label:"Bookings",borderColor:"rgba(69, 197, 172, 1)",backgroundColor:" rgba(248, 255, 175, 0.5)",fill:!0,tension:.4,toolbar:{display:!0,position:"top",labels:{font:{size:12}}},pointRadius:5,pointBackgroundColor:"rgba(69, 197, 172, 1)",pointBorderColor:"rgba(69, 197, 172, 1)",pointHoverBackgroundColor:"rgba(69, 197, 172, 1)",borderWidth:3}]})}aggregateMonthly(e,i){const r={};return e.forEach(s=>{const c=new Date(s[i]).toLocaleString("default",{month:"short",year:"numeric"});r[c]=(r[c]||0)+1}),r}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(zf),st(Na))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-dash-dash"]],decls:86,vars:22,consts:[[1,"main-content"],[1,"dashboard-container"],[1,"stats-grid"],["routerLink","/owner/properties","routerLinkActive","active-link",1,"stat-card"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-title"],[1,"stat-number"],[1,"stat-description"],["routerLink","/owner/calendar","routerLinkActive","active-link",1,"stat-card"],[1,"stat-card"],[1,"dashboard-lower"],[1,"charts-section"],[1,"chart-card"],[1,"chart-header"],[1,"chart-title"],[1,"chart-container"],["baseChart","",1,"chart-canvas",3,"data","options","type","legend"],[1,"appointments-section"],[1,"appointments-card"],[1,"appointments-header"],[1,"appointments-title"],[1,"appointments-body"],["class","appointments-list",4,"ngIf","ngIfElse"],["noAppointments",""],[1,"appointments-list"],["class","appointment-item",4,"ngFor","ngForOf"],[1,"appointment-item"],[1,"appointment-avatar"],[1,"appointment-details"],[1,"appointment-name"],[1,"appointment-date"],[1,"appointment-property"],[1,"appointment-status",3,"ngClass"],[1,"empty-appointments"],[1,"empty-icon"],[1,"empty-text"],[1,"empty-subtext"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),q(5,"\u{1f3e0}"),B(),z(6,"div",5)(7,"h3",6),q(8,"Total Properties"),B(),z(9,"div",7),q(10),B(),z(11,"p",8),q(12,"Properties listed on platform"),B()()(),z(13,"div",9)(14,"div",4),q(15,"\u{1f4c5}"),B(),z(16,"div",5)(17,"h3",6),q(18,"Upcoming Appointments"),B(),z(19,"div",7),q(20),B(),z(21,"p",8),q(22,"Scheduled appointments"),B()()(),z(23,"div",10)(24,"div",4),q(25,"\u{1f440}"),B(),z(26,"div",5)(27,"h3",6),q(28,"Total Views"),B(),z(29,"div",7),q(30),B(),z(31,"p",8),q(32,"Views on your properties"),B()()(),z(33,"div",10)(34,"div",4),q(35,"\u{1f9fe}"),B(),z(36,"div",5)(37,"h3",6),q(38,"Pending Requests"),B(),z(39,"div",7),q(40),B(),z(41,"p",8),q(42,"Awaiting your response"),B()()(),z(43,"div",10)(44,"div",4),q(45,"\u{1f4ac}"),B(),z(46,"div",5)(47,"h3",6),q(48,"New Messages"),B(),z(49,"div",7),q(50),B(),z(51,"p",8),q(52,"Unread messages"),B()()(),z(53,"div",10)(54,"div",4),q(55,"\u2705"),B(),z(56,"div",5)(57,"h3",6),q(58,"Total Approved Properties"),B(),z(59,"div",7),q(60),B(),z(61,"p",8),q(62,"Approved properties"),B()()()(),z(63,"div",11)(64,"div",12)(65,"div",13)(66,"div",14)(67,"h3",15),q(68,"\u{1f4ca} Monthly Property Views"),B()(),z(69,"div",16),$e(70,"canvas",17),B()(),z(71,"div",13)(72,"div",14)(73,"h3",15),q(74,"\u{1f4ca} Monthly Property Bookings"),B()(),z(75,"div",16),$e(76,"canvas",17),B()()(),z(77,"div",18)(78,"div",19)(79,"div",20)(80,"h3",21),q(81,"\u{1f4cb} Upcoming Appointments"),B()(),z(82,"div",22),He(83,tve,2,1,"div",23),He(84,nve,7,0,"ng-template",null,24,Tf),B()()()()()()),2&i){const s=Fa(85);ne(10),Qe(r.allPropertiesCount),ne(10),Qe(r.upcomingAppointments.length),ne(10),Qe(r.totalViews),ne(10),Qe(r.pendingRequestsCount),ne(10),Qe(r.newMessagesCount),ne(10),Qe(r.approvedPropertiesCount),ne(10),ye("data",z_(16,Bj,r.viewChartLabels,r.viewChartData))("options",r.chartOptions)("type","bar")("legend",!0),ne(6),ye("data",z_(19,Bj,r.bookingChartLabels,r.bookingChartData))("options",r.chartOptions)("type","line")("legend",!0),ne(7),ye("ngIf",r.upcomingAppointments.length>0)("ngIfElse",s)}},dependencies:[ha,qs,wo,od,R2,zj,v2],styles:['body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;background:linear-gradient(135deg,#F8FFAF,#45C5AC);margin:0;padding:0;min-height:100vh}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;color:#1f2744;margin:0}.main-content[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}.dashboard-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(280px,1fr));gap:1.5rem;margin-bottom:1rem}.stat-card[_ngcontent-%COMP%]{background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:20px;padding:2rem;box-shadow:0 10px 30px #0000001a;border:1px solid rgba(255,255,255,.3);transition:all .3s cubic-bezier(.4,0,.2,1);cursor:pointer;position:relative;overflow:hidden}.stat-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(135deg,#F8FFAF,#45C5AC);transform:scaleX(0);transition:transform .3s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-8px);box-shadow:0 20px 40px #00000026}.stat-card[_ngcontent-%COMP%]:hover:before{transform:scaleX(1)}.stat-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem;display:block;filter:drop-shadow(0 2px 4px rgba(0,0,0,.1))}.stat-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.stat-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.05em}.stat-number[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#1f2744;line-height:1;background:linear-gradient(135deg,#4DB299,#81CDB7,#D9F3EC);-webkit-text-fill-color:transparent;-webkit-background-clip:text;background-clip:text}.stat-description[_ngcontent-%COMP%]{font-size:.9rem;color:#9ca3af;margin:0;font-weight:500}.dashboard-lower[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;align-items:start}.charts-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.chart-card[_ngcontent-%COMP%]{background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:20px;box-shadow:0 10px 30px #0000001a;border:1px solid rgba(255,255,255,.3);overflow:hidden}.chart-header[_ngcontent-%COMP%]{padding:1.5rem 2rem 1rem;border-bottom:1px solid rgba(0,0,0,.05);background:linear-gradient(135deg,rgba(102,126,234,.05),rgba(118,75,162,.05))}.chart-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1f2744;display:flex;align-items:center;gap:.5rem}.chart-container[_ngcontent-%COMP%]{padding:1.5rem;position:relative;height:350px}.chart-canvas[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:12px;background:white;box-shadow:0 2px 4px #0000000d}.appointments-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.appointments-card[_ngcontent-%COMP%]{background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:20px;box-shadow:0 10px 30px #0000001a;border:1px solid rgba(255,255,255,.3);overflow:hidden;height:-moz-fit-content;height:fit-content}.appointments-header[_ngcontent-%COMP%]{padding:1.5rem 2rem 1rem;border-bottom:1px solid rgba(0,0,0,.05);background:linear-gradient(135deg,rgba(102,126,234,.05),rgba(118,75,162,.05))}.appointments-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1f2744}.appointments-body[_ngcontent-%COMP%]{padding:1.5rem 2rem 2rem;max-height:600px;overflow-y:auto}.appointments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.appointment-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem;padding:1.25rem;background:rgba(248,250,252,.8);border-radius:16px;border:1px solid rgba(0,0,0,.05);transition:all .3s ease}.appointment-item[_ngcontent-%COMP%]:hover{background:rgba(102,126,234,.05);transform:translate(4px);border-color:#667eea33}.appointment-avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#F8FFAF,#45C5AC);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.9rem;flex-shrink:0}.appointment-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.appointment-name[_ngcontent-%COMP%]{font-weight:600;color:#1f2744;font-size:1rem}.appointment-date[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem;font-weight:500}.appointment-property[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;font-weight:500;margin-top:.25rem}.appointment-status[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:20px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.025em;margin-top:.5rem;width:-moz-fit-content;width:fit-content}.status-pending[_ngcontent-%COMP%]{background:rgba(245,158,11,.1);color:#d97706;border:1px solid rgba(245,158,11,.2)}.status-confirmed[_ngcontent-%COMP%]{background:rgba(16,185,129,.1);color:#059669;border:1px solid rgba(16,185,129,.2)}.status-cancelled[_ngcontent-%COMP%]{background:rgba(239,68,68,.1);color:#dc2626;border:1px solid rgba(239,68,68,.2)}.empty-appointments[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;text-align:center}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-text[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#374151;margin-bottom:.5rem}.empty-subtext[_ngcontent-%COMP%]{color:#9ca3af;font-size:.9rem;margin:0}@media (max-width: 1200px){.dashboard-lower[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:2rem}.charts-section[_ngcontent-%COMP%]{order:2}.appointments-section[_ngcontent-%COMP%]{order:1}}@media (max-width: 768px){.main-content[_ngcontent-%COMP%]{padding:1rem}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.stat-card[_ngcontent-%COMP%]{padding:1.5rem}.stat-number[_ngcontent-%COMP%]{font-size:2rem}.dashboard-lower[_ngcontent-%COMP%]{gap:1.5rem}.chart-container[_ngcontent-%COMP%]{padding:1rem;height:300px}.appointments-body[_ngcontent-%COMP%]{max-height:400px}}@media (max-width: 480px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.chart-container[_ngcontent-%COMP%]{height:250px}.appointment-item[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center;gap:.75rem}.appointment-details[_ngcontent-%COMP%]{align-items:center}}']})}}return t})();function rve(t,n){1&t&&(z(0,"div",7),$e(1,"i",8),z(2,"p"),q(3,"Loading your property history..."),B()())}function ove(t,n){1&t&&(z(0,"div",9),$e(1,"i",10),z(2,"p"),q(3,"You haven't viewed any properties yet. Start exploring to see your history here."),B()())}function sve(t,n){if(1&t&&(z(0,"span"),q(1),B()),2&t){const e=ht().$implicit;ne(1),Ft(" - ",e.propertySubCity,"")}}function ave(t,n){if(1&t&&(z(0,"div",31),$e(1,"img",32),B()),2&t){const e=ht().$implicit,i=ht();ne(1),R_("alt",e.propertyTitle),ye("src",i.getImageUrl(e.propertyImage),fs)}}function lve(t,n){if(1&t&&(z(0,"div",11)(1,"div",12),$e(2,"div",13),B(),z(3,"div",14)(4,"div",15)(5,"div",16)(6,"div",17)(7,"div")(8,"h5",18),q(9),B(),z(10,"div",19)(11,"span",20),$e(12,"i",21),q(13),He(14,sve,2,1,"span",22),B(),z(15,"span",23),q(16),B()()(),z(17,"span",24),q(18),B()(),z(19,"div",25)(20,"div",26),$e(21,"i",27),z(22,"span"),q(23),ks(24,"date"),B()(),z(25,"div",26),$e(26,"i",28),z(27,"span",29),q(28),ks(29,"currency"),B()(),He(30,ave,2,2,"div",30),B()()()()()),2&t){const e=n.$implicit;ne(9),Qe(e.propertyTitle),ne(4),Ft(" ",e.propertyCity," "),ne(1),ye("ngIf",e.propertySubCity),ne(2),Ft("ID: ",e.propertyId,""),ne(1),ye("ngClass","property-type-"+e.propertyType.toLowerCase()),ne(1),Ft(" ",e.propertyType," "),ne(5),Ft("Viewed on ",Xd(24,9,e.viewedAt,"medium"),""),ne(5),Qe(function RO(t,n,e,i,r,s){const c=t+Ar,f=cn(),y=np(f,c);return Ow(f,c)?IO(f,sl(),n,y.transform,e,i,r,s,y):y.transform(e,i,r,s)}(29,12,e.propertyPrice,"TND","symbol","1.0-0")),ne(2),ye("ngIf",e.propertyImage)}}let Vj=(()=>{class t{constructor(e){this.propertyService=e,this.views=[],this.isLoading=!0}ngOnInit(){this.propertyService.getUserViews().subscribe({next:e=>{this.views=(e?.views??[]).sort((r,s)=>new Date(s.viewedAt).getTime()-new Date(r.viewedAt).getTime()),this.isLoading=!1},error:()=>{this.isLoading=!1,console.error("Failed to load property views")}})}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default.jpg"}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-property-views"]],decls:9,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-9","col-lg-10","mt-4","px-4"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"property-views-container"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"loading-state"],[1,"bi","bi-hourglass-split"],[1,"empty-state"],[1,"bi","bi-house-heart"],[1,"timeline-item"],[1,"timeline-marker"],[1,"marker-confirmed"],[1,"timeline-content"],[1,"card"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-start","mb-2","mt-2"],[1,"card-title","mb-2"],[1,"property-meta","mb-2"],[1,"property-location"],[1,"bi","bi-geo-alt"],[4,"ngIf"],[1,"property-id"],[1,"badge",3,"ngClass"],[1,"appointment-details"],[1,"property-detail-row"],[1,"bi","bi-calendar-check"],[1,"bi","bi-cash-coin"],[1,"property-price"],["class","property-image",4,"ngIf"],[1,"property-image"],[1,"img-thumbnail",3,"src","alt"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),q(4,"Recently Viewed Properties"),B(),He(5,rve,4,0,"div",3),He(6,ove,4,0,"div",4),z(7,"div",5),He(8,lve,31,17,"div",6),B()()()()),2&i&&(ne(5),ye("ngIf",r.isLoading),ne(1),ye("ngIf",!r.isLoading&&0===(null==r.views?null:r.views.length)),ne(2),ye("ngForOf",r.views))},dependencies:[ha,qs,wo,Hw,v2],styles:['[_ngcontent-%COMP%]:root{--brand-color: #4DB299;--accent-color: #00A699;--text-primary:#1F2744 ;--text-secondary: #717171;--text-light: #999999;--border-color: #EBEBEB;--bg-light: #F7F7F7;--bg-white: #FFFFFF;--shadow-light: 0 6px 20px rgba(0, 0, 0, .05);--shadow-medium: 0 8px 28px rgba(0, 0, 0, .08);--shadow-hover: 0 14px 32px rgba(0, 0, 0, .12);--radius-card: 16px;--radius-button: 8px;--radius-pill: 100px;--space-unit: 8px}body[_ngcontent-%COMP%]{font-family:Circular,-apple-system,poppins,sans-serif;-webkit-font-smoothing:antialiased;color:#1f2744;background-color:#f5f5f5;margin:0;font-size:15px;line-height:1.5}.container-fluid[_ngcontent-%COMP%]{max-width:100rem;margin:2rem auto;padding:0}.col-md-9[_ngcontent-%COMP%], .col-lg-10[_ngcontent-%COMP%]{background-color:var(--bg-white);padding-bottom:60px}h2[_ngcontent-%COMP%]{font-size:32px;font-weight:700;letter-spacing:-.5px;margin-bottom:2rem;color:#1f2744}.property-views-container[_ngcontent-%COMP%]{margin-top:64}.timeline-item[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;display:flex;align-items:flex-start}.timeline-marker[_ngcontent-%COMP%]{position:relative;flex:0 0 40px;padding-right:1rem}.timeline-marker[_ngcontent-%COMP%]:after{content:"";position:absolute;top:36px;bottom:-40px;left:15px;width:2px;background:linear-gradient(180deg,#4DB299 0%,rgba(235,235,235,.5) 100%)}.timeline-item[_ngcontent-%COMP%]:last-child   .timeline-marker[_ngcontent-%COMP%]:after{display:none}.marker-confirmed[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,lightgreen 0%,#4DB299 100%);box-shadow:0 0 0 6px #ff385c1a;position:relative;z-index:5}.timeline-content[_ngcontent-%COMP%]{flex:1}.card[_ngcontent-%COMP%]{border:none;border-radius:1rem;background-color:#fff;box-shadow:0 6px 20px #0000000d;overflow:hidden;transition:all .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 14px 32px #0000001f}.card-body[_ngcontent-%COMP%]{padding:1rem}.card-title[_ngcontent-%COMP%]{font-weight:600;font-size:20px;margin-bottom:8;color:#1f2744;line-height:1.3}.property-meta[_ngcontent-%COMP%]{display:flex;align-items:center;color:#717171;font-size:14px;margin-bottom:16}.property-location[_ngcontent-%COMP%]{display:flex;align-items:center}.property-location[_ngcontent-%COMP%]:after{content:"\\2022";margin:0 8px;color:#999}.badge[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#717171;border-radius:100px;padding:6px 12px;font-size:13px;font-weight:500;letter-spacing:.2px;display:inline-flex;align-items:center}.badge.property-type-villa[_ngcontent-%COMP%]{background-color:#e8f0fe;color:#4285f4}.badge.property-type-house[_ngcontent-%COMP%]{background-color:#fdeee8;color:#ff5722}.badge.property-type-apartment[_ngcontent-%COMP%]{background-color:#e6f4ea;color:#0f9d58}.appointment-details[_ngcontent-%COMP%]{margin-top:48;padding-top:32;border-top:1px solid #EBEBEB}.property-detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24;color:#717171}.property-detail-row[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#999;margin-right:24;font-size:18px;width:22px;text-align:center}.property-price[_ngcontent-%COMP%]{font-weight:600;color:#1f2744}.property-image[_ngcontent-%COMP%]{margin-top:48;border-radius:var(--radius-button);overflow:hidden;position:relative}.img-thumbnail[_ngcontent-%COMP%]{width:100%;height:220px;object-fit:cover;border:none;border-radius:var(--radius-button);transition:transform .3s ease}.property-image[_ngcontent-%COMP%]:hover   .img-thumbnail[_ngcontent-%COMP%]{transform:scale(1.03)}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:128 0;color:#717171}.loading-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;margin-bottom:32;color:#999}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;max-width:300px;text-align:center;margin:0 auto}@media (max-width: 991px){.card-body[_ngcontent-%COMP%]{padding:40}.img-thumbnail[_ngcontent-%COMP%]{height:180px}}@media (max-width: 767px){h2[_ngcontent-%COMP%]{font-size:26px}.timeline-marker[_ngcontent-%COMP%]{flex:0 0 32px}.marker-confirmed[_ngcontent-%COMP%]{width:24px;height:24px;box-shadow:0 0 0 4px #ff385c1a}.timeline-marker[_ngcontent-%COMP%]:after{left:11px}.card-body[_ngcontent-%COMP%]{padding:32}.property-detail-row[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:16}.img-thumbnail[_ngcontent-%COMP%]{height:160px}}']})}}return t})(),jj=(()=>{class t{constructor(e){this.http=e,this.baseApiUrl="https://backend.ddev.site/api"}sendEmailToOwner(e){return this.http.post(`${this.baseApiUrl}/properties/${e.propertyId}/send-email`,e)}getEmailMessages(){return this.http.get(`${this.baseApiUrl}/owner/messages`)}sendOwnerReply(e,i){return this.http.post(`${this.baseApiUrl}/owner/messages/${e}/reply`,i)}markMessageAsRead(e){return this.http.put(`${this.baseApiUrl}/messages/${e}`,{})}getUnreadMessageCount(){return this.http.get(`${this.baseApiUrl}/messagescount`)}getUserMessages(){return this.http.get(`${this.baseApiUrl}/user/messages`)}sendUserReply(e,i){return this.http.post(`${this.baseApiUrl}/user/messages/${e}/reply`,i)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Ff))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function cve(t,n){if(1&t){const e=Ki();z(0,"button",16),qt("click",function(){return An(e),Mn(ht().clearSearch())}),$e(1,"i",17),B()}}function dve(t,n){if(1&t&&(z(0,"div",33),$e(1,"img",34),B()),2&t){const e=ht().$implicit;ne(1),ye("src","http://backend.ddev.site"+e.sender.profileImage,fs)}}function hve(t,n){if(1&t&&(z(0,"div",35),q(1),B()),2&t){const e=ht().$implicit,i=ht(2);ne(1),Ft(" ",i.getSenderInitials(e)," ")}}function uve(t,n){1&t&&$e(0,"span",36)}function pve(t,n){if(1&t){const e=Ki();z(0,"div",21),qt("click",function(){const s=An(e).$implicit;return Mn(ht(2).selectMessage(s))}),He(1,dve,2,1,"div",22),He(2,hve,2,1,"div",23),z(3,"div",24)(4,"div",25)(5,"div",26),q(6),B(),z(7,"div",27),q(8),B()(),z(9,"div",28),q(10),B(),z(11,"div",29)(12,"span",30),q(13),B(),q(14),ks(15,"slice"),B()(),z(16,"div",31),He(17,uve,1,0,"span",32),B()()}if(2&t){const e=n.$implicit,i=ht(2);Z("active",(null==i.selectedMessage?null:i.selectedMessage.id)===e.id)("unread",!e.isRead),ne(1),ye("ngIf",e.sender.profileImage.includes("uploads")),ne(1),ye("ngIf",!e.sender.profileImage.includes("uploads")),ne(4),Yt("",e.sender.name," ",e.sender.lastname,""),ne(2),Qe(i.formatMessageDate(e.createdAt)),ne(2),Qe(e.subject),ne(3),Qe(e.Property.generalinfo.title),ne(1),Yt(" ",xD(15,14,e.message,0,60),"",e.message.length>60?"...":""," "),ne(3),ye("ngIf",!e.isRead)}}function fve(t,n){1&t&&(z(0,"div",37),q(1," No messages found. "),B())}function mve(t,n){if(1&t&&(z(0,"div",18),He(1,pve,18,18,"div",19),He(2,fve,2,0,"div",20),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.paginatedMessages),ne(1),ye("ngIf",0===e.filteredMessages.length)}}function gve(t,n){1&t&&(z(0,"div",38),$e(1,"div",39),z(2,"p"),q(3,"Loading messages..."),B()())}function _ve(t,n){if(1&t){const e=Ki();z(0,"div",40)(1,"button",41),qt("click",function(){An(e);const r=ht();return Mn(r.changePage(r.currentPage-1))}),$e(2,"i",42),B(),z(3,"span"),q(4),B(),z(5,"button",41),qt("click",function(){An(e);const r=ht();return Mn(r.changePage(r.currentPage+1))}),$e(6,"i",43),B()()}if(2&t){const e=ht();ne(1),ye("disabled",1===e.currentPage),ne(3),Yt("",e.currentPage," of ",e.totalPages,""),ne(1),ye("disabled",e.currentPage===e.totalPages)}}function yve(t,n){if(1&t&&(z(0,"div",75),$e(1,"img",34),B()),2&t){const e=ht(2);ne(1),ye("src","http://backend.ddev.site"+e.selectedMessage.sender.profileImage,fs)}}function vve(t,n){if(1&t&&(z(0,"div",76),q(1),B()),2&t){const e=ht(2);ne(1),Ft(" ",e.getSenderInitials(e.selectedMessage)," ")}}function bve(t,n){if(1&t&&(z(0,"div",79)(1,"div",68)(2,"div",80),q(3),B(),z(4,"div",81),q(5),B()(),z(6,"div",82),q(7),B()()),2&t){const e=n.$implicit,i=ht(3);ne(3),Qe(e.sender),ne(2),Qe(i.formatMessageDate(e.createdAt)),ne(2),Ft(" ",e.message," ")}}function xve(t,n){if(1&t&&(z(0,"div",77),He(1,bve,8,3,"div",78),B()),2&t){const e=ht(2);ne(1),ye("ngForOf",e.selectedMessage.replies)}}function wve(t,n){if(1&t){const e=Ki();z(0,"div",44)(1,"div",45)(2,"button",46),qt("click",function(){return An(e),Mn(ht().closeMessage())}),$e(3,"i",47),B(),z(4,"div",48)(5,"button",5),$e(6,"i",49),B(),z(7,"button",5),$e(8,"i",50),B(),z(9,"button",5),$e(10,"i",51),B(),z(11,"button",5),$e(12,"i",52),B(),z(13,"button",5),$e(14,"i",7),B()()(),z(15,"div",53)(16,"h2"),q(17),B(),z(18,"div",54),q(19),B()(),z(20,"div",55),He(21,yve,2,1,"div",56),He(22,vve,2,1,"div",57),z(23,"div",58)(24,"div",59),q(25),z(26,"span",60),q(27),B()(),z(28,"div",61),q(29," to Property Admin "),B()()(),z(30,"div",62)(31,"span",63),q(32,"Property:"),B(),z(33,"span",64),q(34),B()(),z(35,"div",65),q(36),B(),He(37,xve,2,1,"div",66),z(38,"div",67)(39,"div",68)(40,"span"),q(41,"Reply"),B()(),z(42,"div",69)(43,"textarea",70),qt("ngModelChange",function(r){return An(e),Mn(ht().replyText=r)}),B()(),z(44,"div",71)(45,"button",72),$e(46,"i",73),B(),z(47,"button",74),qt("click",function(){return An(e),Mn(ht().sendReply())}),q(48," Reply "),B()()()()}if(2&t){const e=ht();ne(17),Qe(e.selectedMessage.subject),ne(2),Qe(e.formatMessageDate(e.selectedMessage.createdAt)),ne(2),ye("ngIf",e.selectedMessage.sender.profileImage.includes("uploads")),ne(1),ye("ngIf",!e.selectedMessage.sender.profileImage.includes("uploads")),ne(3),Yt(" ",e.selectedMessage.sender.name," ",e.selectedMessage.sender.lastname," "),ne(2),Qe(e.selectedMessage.sender.email),ne(7),Qe(e.selectedMessage.Property.generalinfo.title),ne(2),Ft(" ",e.selectedMessage.message," "),ne(1),ye("ngIf",e.selectedMessage.replies&&e.selectedMessage.replies.length>0),ne(6),ye("ngModel",e.replyText),ne(4),ye("disabled",!e.replyText.trim())}}function kve(t,n){1&t&&(z(0,"div",83)(1,"div",84),$e(2,"i",85),B(),z(3,"p"),q(4,"Select a message to view its contents"),B()())}let Mve=(()=>{class t{constructor(e,i){this.propertyService=e,this.messageService=i,this.messages=[],this.filteredMessages=[],this.selectedMessage=null,this.replyText="",this.currentPage=1,this.messagesPerPage=10,this.totalMessages=0,this.searchQuery="",this.loading=!0}ngOnInit(){this.fetchMessages()}fetchMessages(){this.loading=!0,this.messageService.getEmailMessages().subscribe(e=>{this.messages=e.sort((i,r)=>new Date(r.createdAt).getTime()-new Date(i.createdAt).getTime()),this.filteredMessages=[...this.messages],this.totalMessages=this.messages.length,this.loading=!1},e=>{console.error("Error fetching messages:",e),this.loading=!1})}selectMessage(e){this.selectedMessage=e,e.isRead||(e.isRead=!0,this.messageService.markMessageAsRead(e.id).subscribe())}closeMessage(){this.selectedMessage=null,this.replyText=""}sendReply(){this.selectedMessage&&this.replyText.trim()&&this.messageService.sendOwnerReply(this.selectedMessage.id,{message:this.replyText}).subscribe(()=>{this.selectedMessage&&(this.selectedMessage.replies||(this.selectedMessage.replies=[]),this.selectedMessage.replies.push({id:Math.floor(1e4*Math.random()),message:this.replyText,createdAt:(new Date).toISOString(),sender:"You"}),this.replyText="")},r=>{console.error("Error sending reply:",r),alert("Failed to send reply. Please try again.")})}searchMessages(){if(!this.searchQuery.trim())return void(this.filteredMessages=[...this.messages]);const e=this.searchQuery.toLowerCase();this.filteredMessages=this.messages.filter(i=>i.subject.toLowerCase().includes(e)||i.message.toLowerCase().includes(e)||i.sender.name.toLowerCase().includes(e)||i.sender.email.toLowerCase().includes(e)||i.Property.generalinfo.title.toLowerCase().includes(e))}clearSearch(){this.searchQuery="",this.filteredMessages=[...this.messages]}formatMessageDate(e){const i=new Date(e),r=new Date;return i.setHours(0,0,0,0)===r.setHours(0,0,0,0)?V_(e,"HH:mm","en-US"):i.getFullYear()===r.getFullYear()?V_(e,"MMM dd","en-US"):V_(e,"MMM dd, yyyy","en-US")}get paginatedMessages(){const e=(this.currentPage-1)*this.messagesPerPage;return this.filteredMessages.slice(e,e+this.messagesPerPage)}get totalPages(){return Math.ceil(this.filteredMessages.length/this.messagesPerPage)}changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}getUnreadCount(){return this.messages.filter(e=>!e.isRead).length}getSenderInitials(e){return(e.sender.name.charAt(0)+e.sender.lastname.charAt(0)).toUpperCase()}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(jj))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-owner-messages"]],decls:20,vars:7,consts:[[1,"messages-container"],[1,"messages-sidebar"],[1,"sidebar-header"],[1,"inbox-title"],[1,"inbox-actions"],[1,"icon-button"],[1,"fas","fa-bars"],[1,"fas","fa-ellipsis-v"],[1,"search-box"],["type","text","placeholder","Search messages...",3,"ngModel","ngModelChange","input"],["class","clear-search",3,"click",4,"ngIf"],["class","message-list",4,"ngIf","ngIfElse"],["loadingTemplate",""],["class","pagination",4,"ngIf"],["class","message-detail",4,"ngIf","ngIfElse"],["noMessageSelected",""],[1,"clear-search",3,"click"],[1,"fas","fa-times"],[1,"message-list"],["class","message-item",3,"active","unread","click",4,"ngFor","ngForOf"],["class","no-messages",4,"ngIf"],[1,"message-item",3,"click"],["class","message-avatar",4,"ngIf"],["class","message-avatar initial-avatar",4,"ngIf"],[1,"message-content"],[1,"message-header"],[1,"message-sender"],[1,"message-time"],[1,"message-subject"],[1,"message-preview"],[1,"property-tag"],[1,"message-flags"],["class","unread-indicator",4,"ngIf"],[1,"message-avatar"],["alt","Profile",3,"src"],[1,"message-avatar","initial-avatar"],[1,"unread-indicator"],[1,"no-messages"],[1,"loading-messages"],[1,"loading-spinner"],[1,"pagination"],[3,"disabled","click"],[1,"fas","fa-chevron-left"],[1,"fas","fa-chevron-right"],[1,"message-detail"],[1,"detail-header"],[1,"back-button",3,"click"],[1,"fas","fa-arrow-left"],[1,"header-actions"],[1,"fas","fa-edit"],[1,"fas","fa-star"],[1,"fas","fa-envelope"],[1,"fas","fa-folder"],[1,"message-subject-header"],[1,"message-date"],[1,"message-sender-info"],["class","sender-avatar",4,"ngIf"],["class","sender-avatar initial-avatar",4,"ngIf"],[1,"sender-details"],[1,"sender-name"],[1,"sender-email"],[1,"message-to"],[1,"property-reference"],[1,"property-label"],[1,"property-title"],[1,"message-body"],["class","previous-replies",4,"ngIf"],[1,"reply-form"],[1,"reply-header"],[1,"reply-input"],["placeholder","Type your reply here...","rows","4",3,"ngModel","ngModelChange"],[1,"reply-actions"],[1,"emoji-button"],[1,"far","fa-smile"],[1,"send-button",3,"disabled","click"],[1,"sender-avatar"],[1,"sender-avatar","initial-avatar"],[1,"previous-replies"],["class","reply-item",4,"ngFor","ngForOf"],[1,"reply-item"],[1,"reply-sender"],[1,"reply-date"],[1,"reply-content"],[1,"empty-detail"],[1,"empty-detail-icon"],[1,"far","fa-envelope"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),q(4,"Inbox"),B(),z(5,"div",4)(6,"button",5),$e(7,"i",6),B(),z(8,"button",5),$e(9,"i",7),B()()(),z(10,"div",8)(11,"input",9),qt("ngModelChange",function(c){return r.searchQuery=c})("input",function(){return r.searchMessages()}),B(),He(12,cve,2,0,"button",10),B(),He(13,mve,3,2,"div",11),He(14,gve,4,0,"ng-template",null,12,Tf),He(16,_ve,7,4,"div",13),B(),He(17,wve,49,12,"div",14),He(18,kve,5,0,"ng-template",null,15,Tf),B()),2&i){const s=Fa(15),c=Fa(19);ne(11),ye("ngModel",r.searchQuery),ne(1),ye("ngIf",r.searchQuery),ne(1),ye("ngIf",!r.loading)("ngIfElse",s),ne(3),ye("ngIf",r.totalPages>1),ne(1),ye("ngIf",r.selectedMessage)("ngIfElse",c)}},dependencies:[qs,wo,hl,Wl,Wm,hT],styles:[".messages-container[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 100px);background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001f;overflow:hidden;margin:15px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}.messages-sidebar[_ngcontent-%COMP%]{width:350px;border-right:1px solid #e0e0e0;display:flex;flex-direction:column;background-color:#f9f9f9}.sidebar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e0e0e0}.inbox-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0;color:#333}.inbox-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666;padding:6px;border-radius:50%}.icon-button[_ngcontent-%COMP%]:hover{background-color:#0000000d}.search-box[_ngcontent-%COMP%]{padding:12px 16px;position:relative}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:calc(100% - 16px);padding:8px 30px 8px 12px;border:1px solid #e0e0e0;border-radius:4px;font-size:14px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4285f4}.search-box[_ngcontent-%COMP%]   .clear-search[_ngcontent-%COMP%]{position:absolute;right:24px;top:50%;transform:translateY(-50%);background:none;border:none;color:#666;cursor:pointer}.message-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0}.message-item[_ngcontent-%COMP%]{display:flex;padding:12px 16px;border-bottom:1px solid #f0f0f0;cursor:pointer;transition:background-color .2s;position:relative;align-items:flex-start}.message-item[_ngcontent-%COMP%]:hover{background-color:#f1f3f4}.message-item.active[_ngcontent-%COMP%]{background-color:#e8f0fe}.message-item.unread[_ngcontent-%COMP%]{background-color:#fff;font-weight:600}.message-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;margin-right:12px;flex-shrink:0}.message-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.initial-avatar[_ngcontent-%COMP%]{background-color:#4285f4;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500;font-size:16px}.message-content[_ngcontent-%COMP%]{flex:1;min-width:0}.message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px}.message-sender[_ngcontent-%COMP%]{font-weight:500;color:#333;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.message-time[_ngcontent-%COMP%]{color:#777;font-size:12px;flex-shrink:0}.message-subject[_ngcontent-%COMP%]{font-size:14px;color:#333;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.message-preview[_ngcontent-%COMP%]{font-size:13px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.property-tag[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#333;padding:1px 5px;border-radius:3px;font-size:11px;margin-right:5px}.message-flags[_ngcontent-%COMP%]{margin-left:8px;display:flex;flex-direction:column;align-items:center}.unread-indicator[_ngcontent-%COMP%]{width:8px;height:8px;background-color:#1a73e8;border-radius:50%;margin-top:5px}.loading-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0}.loading-spinner[_ngcontent-%COMP%]{border:3px solid rgba(0,0,0,.1);border-top:3px solid #3498db;border-radius:50%;width:24px;height:24px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:12px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.no-messages[_ngcontent-%COMP%]{padding:40px 16px;text-align:center;color:#666}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:12px;gap:12px;border-top:1px solid #e0e0e0}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:4px 8px;cursor:pointer;color:#1a73e8}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{color:#ccc;cursor:not-allowed}.pagination[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;color:#666}.message-detail[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow-y:auto;background-color:#fff;position:relative}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:16px;border-bottom:1px solid #f0f0f0}.back-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666;padding:8px}.back-button[_ngcontent-%COMP%]:hover{color:#1a73e8}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.message-subject-header[_ngcontent-%COMP%]{padding:16px 20px 0}.message-subject-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;font-weight:500}.message-subject-header[_ngcontent-%COMP%]   .message-date[_ngcontent-%COMP%]{color:#777;font-size:13px}.message-sender-info[_ngcontent-%COMP%]{padding:16px 20px;display:flex;align-items:center}.sender-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;margin-right:12px}.sender-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.sender-details[_ngcontent-%COMP%]{flex:1}.sender-name[_ngcontent-%COMP%]{font-weight:500;font-size:15px}.sender-name[_ngcontent-%COMP%]   .sender-email[_ngcontent-%COMP%]{font-weight:400;color:#777;margin-left:8px}.message-to[_ngcontent-%COMP%]{font-size:13px;color:#666}.property-reference[_ngcontent-%COMP%]{padding:0 20px 12px;font-size:14px}.property-label[_ngcontent-%COMP%]{color:#777;margin-right:6px}.property-title[_ngcontent-%COMP%]{font-weight:500;color:#333}.message-body[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid #f0f0f0;line-height:1.6;font-size:14px;color:#333;white-space:pre-line}.previous-replies[_ngcontent-%COMP%]{padding:0 20px}.reply-item[_ngcontent-%COMP%]{padding:16px 0;border-bottom:1px solid #f0f0f0}.reply-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.reply-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.reply-sender[_ngcontent-%COMP%]{font-weight:500;color:#333}.reply-date[_ngcontent-%COMP%]{color:#777;font-size:13px}.reply-content[_ngcontent-%COMP%]{font-size:14px;color:#333;line-height:1.6;white-space:pre-line}.reply-form[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #f0f0f0;margin-top:auto}.reply-header[_ngcontent-%COMP%]{font-weight:500;margin-bottom:8px;color:#333}.reply-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #e0e0e0;border-radius:4px;padding:12px;font-family:inherit;font-size:14px;resize:vertical}.reply-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4285f4}.reply-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:12px}.emoji-button[_ngcontent-%COMP%]{background:none;border:none;color:#666;font-size:18px;cursor:pointer}.emoji-button[_ngcontent-%COMP%]:hover{color:#1a73e8}.send-button[_ngcontent-%COMP%]{background-color:#1a73e8;color:#fff;border:none;padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer;transition:background-color .2s}.send-button[_ngcontent-%COMP%]:hover{background-color:#0d65d9}.send-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.empty-detail[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#666;width:100%}.empty-detail-icon[_ngcontent-%COMP%]{font-size:64px;color:#ddd;margin-bottom:16px}.empty-detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.messages-container[_ngcontent-%COMP%]{flex-direction:column;height:auto;min-height:calc(100vh - 100px)}}"]})}}return t})();function Cve(t,n){if(1&t){const e=Ki();z(0,"button",16),qt("click",function(){return An(e),Mn(ht().clearSearch())}),$e(1,"i",17),B()}}function Sve(t,n){if(1&t&&(z(0,"div",33),$e(1,"img",34),B()),2&t){const e=ht().$implicit;ne(1),ye("src","http://backend.ddev.site"+e.sender.profileImage,fs)}}function Eve(t,n){if(1&t&&(z(0,"div",35),q(1),B()),2&t){const e=ht().$implicit,i=ht(2);ne(1),Ft(" ",i.getSenderInitials(e)," ")}}function Dve(t,n){1&t&&$e(0,"span",36)}function Tve(t,n){if(1&t){const e=Ki();z(0,"div",21),qt("click",function(){const s=An(e).$implicit;return Mn(ht(2).selectMessage(s))}),He(1,Sve,2,1,"div",22),He(2,Eve,2,1,"div",23),z(3,"div",24)(4,"div",25)(5,"div",26),q(6),B(),z(7,"div",27),q(8),B()(),z(9,"div",28),q(10),B(),z(11,"div",29)(12,"span",30),q(13),B(),q(14),ks(15,"slice"),B()(),z(16,"div",31),He(17,Dve,1,0,"span",32),B()()}if(2&t){const e=n.$implicit,i=ht(2);Z("active",(null==i.selectedMessage?null:i.selectedMessage.id)===e.id)("unread",!e.isRead),ne(1),ye("ngIf",e.sender.profileImage.includes("uploads")),ne(1),ye("ngIf",!e.sender.profileImage.includes("uploads")),ne(4),Yt("",e.sender.name," ",e.sender.lastname,""),ne(2),Qe(i.formatMessageDate(e.createdAt)),ne(2),Qe(e.subject),ne(3),Qe(e.Property.generalinfo.title),ne(1),Yt(" ",xD(15,14,e.message,0,60),"",e.message.length>60?"...":""," "),ne(3),ye("ngIf",!e.isRead)}}function Ave(t,n){1&t&&(z(0,"div",37),q(1," No messages found. "),B())}function Pve(t,n){if(1&t&&(z(0,"div",18),He(1,Tve,18,18,"div",19),He(2,Ave,2,0,"div",20),B()),2&t){const e=ht();ne(1),ye("ngForOf",e.paginatedMessages),ne(1),ye("ngIf",0===e.filteredMessages.length)}}function Ive(t,n){1&t&&(z(0,"div",38),$e(1,"div",39),z(2,"p"),q(3,"Loading messages..."),B()())}function Ove(t,n){if(1&t){const e=Ki();z(0,"div",40)(1,"button",41),qt("click",function(){An(e);const r=ht();return Mn(r.changePage(r.currentPage-1))}),$e(2,"i",42),B(),z(3,"span"),q(4),B(),z(5,"button",41),qt("click",function(){An(e);const r=ht();return Mn(r.changePage(r.currentPage+1))}),$e(6,"i",43),B()()}if(2&t){const e=ht();ne(1),ye("disabled",1===e.currentPage),ne(3),Yt("",e.currentPage," of ",e.totalPages,""),ne(1),ye("disabled",e.currentPage===e.totalPages)}}function Rve(t,n){if(1&t&&(z(0,"div",75),$e(1,"img",34),B()),2&t){const e=ht(2);ne(1),ye("src","http://backend.ddev.site"+e.selectedMessage.sender.profileImage,fs)}}function Lve(t,n){if(1&t&&(z(0,"div",76),q(1),B()),2&t){const e=ht(2);ne(1),Ft(" ",e.getSenderInitials(e.selectedMessage)," ")}}function Fve(t,n){if(1&t&&(z(0,"div",79)(1,"div",68)(2,"div",80),q(3),B(),z(4,"div",81),q(5),B()(),z(6,"div",82),q(7),B()()),2&t){const e=n.$implicit,i=ht(3);ne(3),Qe(e.sender),ne(2),Qe(i.formatMessageDate(e.createdAt)),ne(2),Ft(" ",e.message," ")}}function zve(t,n){if(1&t&&(z(0,"div",77),He(1,Fve,8,3,"div",78),B()),2&t){const e=ht(2);ne(1),ye("ngForOf",e.selectedMessage.replies)}}function Nve(t,n){if(1&t){const e=Ki();z(0,"div",44)(1,"div",45)(2,"button",46),qt("click",function(){return An(e),Mn(ht().closeMessage())}),$e(3,"i",47),B(),z(4,"div",48)(5,"button",5),$e(6,"i",49),B(),z(7,"button",5),$e(8,"i",50),B(),z(9,"button",5),$e(10,"i",51),B(),z(11,"button",5),$e(12,"i",52),B(),z(13,"button",5),$e(14,"i",7),B()()(),z(15,"div",53)(16,"h2"),q(17),B(),z(18,"div",54),q(19),B()(),z(20,"div",55),He(21,Rve,2,1,"div",56),He(22,Lve,2,1,"div",57),z(23,"div",58)(24,"div",59),q(25),z(26,"span",60),q(27),B()(),z(28,"div",61),q(29,"to Me"),B()()(),z(30,"div",62)(31,"span",63),q(32,"Property:"),B(),z(33,"span",64),q(34),B()(),z(35,"div",65),q(36),B(),He(37,zve,2,1,"div",66),z(38,"div",67)(39,"div",68)(40,"span"),q(41,"Reply"),B()(),z(42,"div",69)(43,"textarea",70),qt("ngModelChange",function(r){return An(e),Mn(ht().replyText=r)}),B()(),z(44,"div",71)(45,"button",72),$e(46,"i",73),B(),z(47,"button",74),qt("click",function(){return An(e),Mn(ht().sendReply())}),q(48," Reply "),B()()()()}if(2&t){const e=ht();ne(17),Qe(e.selectedMessage.subject),ne(2),Qe(e.formatMessageDate(e.selectedMessage.createdAt)),ne(2),ye("ngIf",e.selectedMessage.sender.profileImage.includes("uploads")),ne(1),ye("ngIf",!e.selectedMessage.sender.profileImage.includes("uploads")),ne(3),Yt(" ",e.selectedMessage.sender.name," ",e.selectedMessage.sender.lastname," "),ne(2),Qe(e.selectedMessage.sender.email),ne(7),Qe(e.selectedMessage.Property.generalinfo.title),ne(2),Ft(" ",e.selectedMessage.message," "),ne(1),ye("ngIf",e.selectedMessage.replies&&e.selectedMessage.replies.length>0),ne(6),ye("ngModel",e.replyText),ne(4),ye("disabled",!e.replyText.trim())}}function Bve(t,n){1&t&&(z(0,"div",83)(1,"div",84),$e(2,"i",85),B(),z(3,"p"),q(4,"Select a message to view its contents"),B()())}let Vve=(()=>{class t{constructor(e){this.messageService=e,this.messages=[],this.filteredMessages=[],this.selectedMessage=null,this.replyText="",this.currentPage=1,this.messagesPerPage=10,this.totalMessages=0,this.searchQuery="",this.loading=!0}ngOnInit(){this.fetchMessages()}fetchMessages(){this.loading=!0,this.messageService.getUserMessages().subscribe(e=>{this.messages=e.sort((i,r)=>new Date(r.createdAt).getTime()-new Date(i.createdAt).getTime()),this.filteredMessages=[...this.messages],this.totalMessages=this.messages.length,this.loading=!1},e=>{console.error("Error fetching user messages:",e),this.loading=!1})}selectMessage(e){this.selectedMessage=e,e.isRead||(e.isRead=!0,this.messageService.markMessageAsRead(e.id).subscribe())}closeMessage(){this.selectedMessage=null,this.replyText=""}sendReply(){this.selectedMessage&&this.replyText.trim()&&this.messageService.sendUserReply(this.selectedMessage.id,{message:this.replyText}).subscribe(()=>{this.selectedMessage&&(this.selectedMessage.replies||(this.selectedMessage.replies=[]),this.selectedMessage.replies.push({id:Math.floor(1e4*Math.random()),message:this.replyText,createdAt:(new Date).toISOString(),sender:"You"}),this.replyText="")},r=>{console.error("Error sending reply:",r),alert("Failed to send reply. Please try again.")})}searchMessages(){if(!this.searchQuery.trim())return void(this.filteredMessages=[...this.messages]);const e=this.searchQuery.toLowerCase();this.filteredMessages=this.messages.filter(i=>i.subject.toLowerCase().includes(e)||i.message.toLowerCase().includes(e)||i.sender.name.toLowerCase().includes(e)||i.sender.email.toLowerCase().includes(e)||i.Property.generalinfo.title.toLowerCase().includes(e))}clearSearch(){this.searchQuery="",this.filteredMessages=[...this.messages]}formatMessageDate(e){const i=new Date(e),r=new Date;return i.setHours(0,0,0,0)===r.setHours(0,0,0,0)?V_(e,"HH:mm","en-US"):i.getFullYear()===r.getFullYear()?V_(e,"MMM dd","en-US"):V_(e,"MMM dd, yyyy","en-US")}get paginatedMessages(){const e=(this.currentPage-1)*this.messagesPerPage;return this.filteredMessages.slice(e,e+this.messagesPerPage)}get totalPages(){return Math.ceil(this.filteredMessages.length/this.messagesPerPage)}changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}getUnreadCount(){return this.messages.filter(e=>!e.isRead).length}getSenderInitials(e){return(e.sender.name.charAt(0)+e.sender.lastname.charAt(0)).toUpperCase()}static{this.\u0275fac=function(i){return new(i||t)(st(jj))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-user-messages"]],decls:20,vars:7,consts:[[1,"messages-container"],[1,"messages-sidebar"],[1,"sidebar-header"],[1,"inbox-title"],[1,"inbox-actions"],[1,"icon-button"],[1,"fas","fa-bars"],[1,"fas","fa-ellipsis-v"],[1,"search-box"],["type","text","placeholder","Search messages...",3,"ngModel","ngModelChange","input"],["class","clear-search",3,"click",4,"ngIf"],["class","message-list",4,"ngIf","ngIfElse"],["loadingTemplate",""],["class","pagination",4,"ngIf"],["class","message-detail",4,"ngIf","ngIfElse"],["noMessageSelected",""],[1,"clear-search",3,"click"],[1,"fas","fa-times"],[1,"message-list"],["class","message-item",3,"active","unread","click",4,"ngFor","ngForOf"],["class","no-messages",4,"ngIf"],[1,"message-item",3,"click"],["class","message-avatar",4,"ngIf"],["class","message-avatar initial-avatar",4,"ngIf"],[1,"message-content"],[1,"message-header"],[1,"message-sender"],[1,"message-time"],[1,"message-subject"],[1,"message-preview"],[1,"property-tag"],[1,"message-flags"],["class","unread-indicator",4,"ngIf"],[1,"message-avatar"],["alt","Profile",3,"src"],[1,"message-avatar","initial-avatar"],[1,"unread-indicator"],[1,"no-messages"],[1,"loading-messages"],[1,"loading-spinner"],[1,"pagination"],[3,"disabled","click"],[1,"fas","fa-chevron-left"],[1,"fas","fa-chevron-right"],[1,"message-detail"],[1,"detail-header"],[1,"back-button",3,"click"],[1,"fas","fa-arrow-left"],[1,"header-actions"],[1,"fas","fa-edit"],[1,"fas","fa-star"],[1,"fas","fa-envelope"],[1,"fas","fa-folder"],[1,"message-subject-header"],[1,"message-date"],[1,"message-sender-info"],["class","sender-avatar",4,"ngIf"],["class","sender-avatar initial-avatar",4,"ngIf"],[1,"sender-details"],[1,"sender-name"],[1,"sender-email"],[1,"message-to"],[1,"property-reference"],[1,"property-label"],[1,"property-title"],[1,"message-body"],["class","previous-replies",4,"ngIf"],[1,"reply-form"],[1,"reply-header"],[1,"reply-input"],["placeholder","Type your reply here...","rows","4",3,"ngModel","ngModelChange"],[1,"reply-actions"],[1,"emoji-button"],[1,"far","fa-smile"],[1,"send-button",3,"disabled","click"],[1,"sender-avatar"],[1,"sender-avatar","initial-avatar"],[1,"previous-replies"],["class","reply-item",4,"ngFor","ngForOf"],[1,"reply-item"],[1,"reply-sender"],[1,"reply-date"],[1,"reply-content"],[1,"empty-detail"],[1,"empty-detail-icon"],[1,"far","fa-envelope"]],template:function(i,r){if(1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),q(4,"Inbox"),B(),z(5,"div",4)(6,"button",5),$e(7,"i",6),B(),z(8,"button",5),$e(9,"i",7),B()()(),z(10,"div",8)(11,"input",9),qt("ngModelChange",function(c){return r.searchQuery=c})("input",function(){return r.searchMessages()}),B(),He(12,Cve,2,0,"button",10),B(),He(13,Pve,3,2,"div",11),He(14,Ive,4,0,"ng-template",null,12,Tf),He(16,Ove,7,4,"div",13),B(),He(17,Nve,49,12,"div",14),He(18,Bve,5,0,"ng-template",null,15,Tf),B()),2&i){const s=Fa(15),c=Fa(19);ne(11),ye("ngModel",r.searchQuery),ne(1),ye("ngIf",r.searchQuery),ne(1),ye("ngIf",!r.loading)("ngIfElse",s),ne(3),ye("ngIf",r.totalPages>1),ne(1),ye("ngIf",r.selectedMessage)("ngIfElse",c)}},dependencies:[qs,wo,hl,Wl,Wm,hT],styles:[".messages-container[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 100px);background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001f;overflow:hidden;margin:15px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}.messages-sidebar[_ngcontent-%COMP%]{width:350px;border-right:1px solid #e0e0e0;display:flex;flex-direction:column;background-color:#f9f9f9}.sidebar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e0e0e0}.inbox-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0;color:#333}.inbox-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666;padding:6px;border-radius:50%}.icon-button[_ngcontent-%COMP%]:hover{background-color:#0000000d}.search-box[_ngcontent-%COMP%]{padding:12px 16px;position:relative}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:calc(100% - 16px);padding:8px 30px 8px 12px;border:1px solid #e0e0e0;border-radius:4px;font-size:14px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4285f4}.search-box[_ngcontent-%COMP%]   .clear-search[_ngcontent-%COMP%]{position:absolute;right:24px;top:50%;transform:translateY(-50%);background:none;border:none;color:#666;cursor:pointer}.message-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0}.message-item[_ngcontent-%COMP%]{display:flex;padding:12px 16px;border-bottom:1px solid #f0f0f0;cursor:pointer;transition:background-color .2s;position:relative;align-items:flex-start}.message-item[_ngcontent-%COMP%]:hover{background-color:#f1f3f4}.message-item.active[_ngcontent-%COMP%]{background-color:#e8f0fe}.message-item.unread[_ngcontent-%COMP%]{background-color:#fff;font-weight:600}.message-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;margin-right:12px;flex-shrink:0}.message-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.initial-avatar[_ngcontent-%COMP%]{background-color:#4285f4;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500;font-size:16px}.message-content[_ngcontent-%COMP%]{flex:1;min-width:0}.message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px}.message-sender[_ngcontent-%COMP%]{font-weight:500;color:#333;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.message-time[_ngcontent-%COMP%]{color:#777;font-size:12px;flex-shrink:0}.message-subject[_ngcontent-%COMP%]{font-size:14px;color:#333;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.message-preview[_ngcontent-%COMP%]{font-size:13px;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.property-tag[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#333;padding:1px 5px;border-radius:3px;font-size:11px;margin-right:5px}.message-flags[_ngcontent-%COMP%]{margin-left:8px;display:flex;flex-direction:column;align-items:center}.unread-indicator[_ngcontent-%COMP%]{width:8px;height:8px;background-color:#1a73e8;border-radius:50%;margin-top:5px}.loading-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 0}.loading-spinner[_ngcontent-%COMP%]{border:3px solid rgba(0,0,0,.1);border-top:3px solid #3498db;border-radius:50%;width:24px;height:24px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:12px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.no-messages[_ngcontent-%COMP%]{padding:40px 16px;text-align:center;color:#666}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:12px;gap:12px;border-top:1px solid #e0e0e0}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:4px 8px;cursor:pointer;color:#1a73e8}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{color:#ccc;cursor:not-allowed}.pagination[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;color:#666}.message-detail[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow-y:auto;background-color:#fff;position:relative}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:16px;border-bottom:1px solid #f0f0f0}.back-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#666;padding:8px}.back-button[_ngcontent-%COMP%]:hover{color:#1a73e8}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.message-subject-header[_ngcontent-%COMP%]{padding:16px 20px 0}.message-subject-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;font-weight:500}.message-subject-header[_ngcontent-%COMP%]   .message-date[_ngcontent-%COMP%]{color:#777;font-size:13px}.message-sender-info[_ngcontent-%COMP%]{padding:16px 20px;display:flex;align-items:center}.sender-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;margin-right:12px}.sender-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.sender-details[_ngcontent-%COMP%]{flex:1}.sender-name[_ngcontent-%COMP%]{font-weight:500;font-size:15px}.sender-name[_ngcontent-%COMP%]   .sender-email[_ngcontent-%COMP%]{font-weight:400;color:#777;margin-left:8px}.message-to[_ngcontent-%COMP%]{font-size:13px;color:#666}.property-reference[_ngcontent-%COMP%]{padding:0 20px 12px;font-size:14px}.property-label[_ngcontent-%COMP%]{color:#777;margin-right:6px}.property-title[_ngcontent-%COMP%]{font-weight:500;color:#333}.message-body[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid #f0f0f0;line-height:1.6;font-size:14px;color:#333;white-space:pre-line}.previous-replies[_ngcontent-%COMP%]{padding:0 20px}.reply-item[_ngcontent-%COMP%]{padding:16px 0;border-bottom:1px solid #f0f0f0}.reply-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.reply-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.reply-sender[_ngcontent-%COMP%]{font-weight:500;color:#333}.reply-date[_ngcontent-%COMP%]{color:#777;font-size:13px}.reply-content[_ngcontent-%COMP%]{font-size:14px;color:#333;line-height:1.6;white-space:pre-line}.reply-form[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #f0f0f0;margin-top:auto}.reply-header[_ngcontent-%COMP%]{font-weight:500;margin-bottom:8px;color:#333}.reply-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #e0e0e0;border-radius:4px;padding:12px;font-family:inherit;font-size:14px;resize:vertical}.reply-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4285f4}.reply-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:12px}.emoji-button[_ngcontent-%COMP%]{background:none;border:none;color:#666;font-size:18px;cursor:pointer}.emoji-button[_ngcontent-%COMP%]:hover{color:#1a73e8}.send-button[_ngcontent-%COMP%]{background-color:#1a73e8;color:#fff;border:none;padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer;transition:background-color .2s}.send-button[_ngcontent-%COMP%]:hover{background-color:#0d65d9}.send-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.empty-detail[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#666;width:100%}.empty-detail-icon[_ngcontent-%COMP%]{font-size:64px;color:#ddd;margin-bottom:16px}.empty-detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.messages-container[_ngcontent-%COMP%]{flex-direction:column;height:auto;min-height:calc(100vh - 100px)}}"]})}}return t})();function jve(t,n){1&t&&(z(0,"div",35)(1,"span",36),q(2,"Welcome Back"),B()())}function Hve(t,n){1&t&&(z(0,"span"),q(1,"Your Account"),B())}function Uve(t,n){1&t&&(z(0,"div",37),q(1,"AC"),B())}function qve(t,n){1&t&&(z(0,"span",38),q(1,"Profile"),B())}function $ve(t,n){1&t&&(z(0,"div",39),q(1,"Profile"),B())}function Gve(t,n){1&t&&(z(0,"span",38),q(1,"Profile Settings"),B())}function Wve(t,n){1&t&&(z(0,"div",39),q(1,"Profile Settings"),B())}function Zve(t,n){1&t&&(z(0,"span",38),q(1,"Messages"),B())}function Yve(t,n){1&t&&(z(0,"div",39),q(1,"Messages"),B())}function Xve(t,n){1&t&&(z(0,"span",38),q(1,"My Appointments"),B())}function Kve(t,n){1&t&&(z(0,"div",39),q(1,"My Appointments"),B())}function Qve(t,n){1&t&&(z(0,"span",38),q(1,"My Bookings"),B())}function Jve(t,n){1&t&&(z(0,"div",39),q(1,"My Bookings"),B())}function e2e(t,n){1&t&&(z(0,"span"),q(1,"Quick Links"),B())}function t2e(t,n){1&t&&(z(0,"div",37),q(1,"QL"),B())}function n2e(t,n){1&t&&(z(0,"span",38),q(1,"My History"),B())}function i2e(t,n){1&t&&(z(0,"div",39),q(1,"My History"),B())}function r2e(t,n){1&t&&(z(0,"span",38),q(1,"Home"),B())}function o2e(t,n){1&t&&(z(0,"div",39),q(1,"Home"),B())}function s2e(t,n){1&t&&(z(0,"span",38),q(1,"Groups"),B())}function a2e(t,n){1&t&&(z(0,"div",39),q(1,"Groups"),B())}function l2e(t,n){1&t&&(z(0,"span",38),q(1,"Phone Numbers"),B())}function c2e(t,n){1&t&&(z(0,"div",39),q(1,"Phone Numbers"),B())}function d2e(t,n){1&t&&(z(0,"span",38),q(1,"Integrations"),B())}function h2e(t,n){1&t&&(z(0,"div",39),q(1,"Integrations"),B())}function u2e(t,n){1&t&&(z(0,"span",38),q(1,"Plan & Billing"),B())}function p2e(t,n){1&t&&(z(0,"div",39),q(1,"Plan & Billing"),B())}function f2e(t,n){1&t&&(z(0,"span",38),q(1,"Contacts"),B())}function m2e(t,n){1&t&&(z(0,"div",39),q(1,"Contacts"),B())}let g2e=(()=>{class t{constructor(){this.activePage="profile",this.isCollapsed=!1,this.screenWidth=window.innerWidth,this.checkScreenWidth()}ngOnInit(){const e=localStorage.getItem("sidebarState");e&&(this.isCollapsed="collapsed"===e)}onResize(e){this.screenWidth=window.innerWidth,this.checkScreenWidth()}checkScreenWidth(){this.screenWidth<=768&&(this.isCollapsed=!0)}toggleSidebar(){this.isCollapsed=!this.isCollapsed,localStorage.setItem("sidebarState",this.isCollapsed?"collapsed":"expanded")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-sidebar"]],hostBindings:function(i,r){1&i&&qt("resize",function(c){return r.onResize(c)},0,Tv)},inputs:{activePage:"activePage"},decls:77,vars:36,consts:[[1,"sidebar-wrapper"],[1,"sidebar-container"],[1,"sidebar-header"],["class","logo-area",4,"ngIf"],[1,"toggle-button",3,"click"],[1,"toggle-icon",3,"ngClass"],[1,"sidebar-content"],[1,"sidebar-section"],[1,"section-title"],[4,"ngIf"],["class","mini-title",4,"ngIf"],[1,"menu-list"],["routerLinkActive","active","routerLink","/user/profile",1,"menu-item"],[1,"icon-container"],[1,"menu-icon","user-icon"],["class","menu-text",4,"ngIf"],["class","tooltip",4,"ngIf"],["routerLinkActive","active","routerLink","/user/settings",1,"menu-item"],[1,"menu-icon","preferences-icon"],["routerLinkActive","active","routerLink","/user/messages",1,"menu-item"],[1,"menu-icon","notifications-icon"],["routerLinkActive","active","routerLink","/user/my-appointments",1,"menu-item"],[1,"menu-icon","calendar-icon"],["routerLinkActive","active","routerLink","/user/my-bookings",1,"menu-item"],[1,"menu-icon","booking-icon"],["routerLinkActive","active","routerLink","/user/history",1,"menu-item"],[1,"menu-icon","history-icon"],["routerLinkActive","active","routerLink","/home",1,"menu-item"],[1,"menu-icon","home-icon"],[1,"menu-item"],[1,"menu-icon","groups-icon"],[1,"menu-icon","phone-icon"],[1,"menu-icon","integrations-icon"],[1,"menu-icon","plan-icon"],[1,"menu-icon","contacts-icon"],[1,"logo-area"],[1,"app-name"],[1,"mini-title"],[1,"menu-text"],[1,"tooltip"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2),He(3,jve,3,0,"div",3),z(4,"button",4),qt("click",function(){return r.toggleSidebar()}),$e(5,"i",5),B()(),z(6,"div",6)(7,"div",7)(8,"div",8),He(9,Hve,2,0,"span",9),He(10,Uve,2,0,"div",10),B(),z(11,"ul",11)(12,"li",12)(13,"div",13),$e(14,"i",14),B(),He(15,qve,2,0,"span",15),He(16,$ve,2,0,"div",16),B(),z(17,"li",17)(18,"div",13),$e(19,"i",18),B(),He(20,Gve,2,0,"span",15),He(21,Wve,2,0,"div",16),B(),z(22,"li",19)(23,"div",13),$e(24,"i",20),B(),He(25,Zve,2,0,"span",15),He(26,Yve,2,0,"div",16),B(),z(27,"li",21)(28,"div",13),$e(29,"i",22),B(),He(30,Xve,2,0,"span",15),He(31,Kve,2,0,"div",16),B(),z(32,"li",23)(33,"div",13),$e(34,"i",24),B(),He(35,Qve,2,0,"span",15),He(36,Jve,2,0,"div",16),B()()(),z(37,"div",7)(38,"div",8),He(39,e2e,2,0,"span",9),He(40,t2e,2,0,"div",10),B(),z(41,"ul",11)(42,"li",25)(43,"div",13),$e(44,"i",26),B(),He(45,n2e,2,0,"span",15),He(46,i2e,2,0,"div",16),B(),z(47,"li",27)(48,"div",13),$e(49,"i",28),B(),He(50,r2e,2,0,"span",15),He(51,o2e,2,0,"div",16),B(),z(52,"li",29)(53,"div",13),$e(54,"i",30),B(),He(55,s2e,2,0,"span",15),He(56,a2e,2,0,"div",16),B(),z(57,"li",29)(58,"div",13),$e(59,"i",31),B(),He(60,l2e,2,0,"span",15),He(61,c2e,2,0,"div",16),B(),z(62,"li",29)(63,"div",13),$e(64,"i",32),B(),He(65,d2e,2,0,"span",15),He(66,h2e,2,0,"div",16),B(),z(67,"li",29)(68,"div",13),$e(69,"i",33),B(),He(70,u2e,2,0,"span",15),He(71,p2e,2,0,"div",16),B(),z(72,"li",29)(73,"div",13),$e(74,"i",34),B(),He(75,f2e,2,0,"span",15),He(76,m2e,2,0,"div",16),B()()()()()()),2&i&&(ne(1),Z("collapsed",r.isCollapsed),ne(2),ye("ngIf",!r.isCollapsed),ne(2),ye("ngClass",r.isCollapsed?"chevron-right":"chevron-left"),ne(3),Z("collapsed-title",r.isCollapsed),ne(1),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(5),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(2),Z("collapsed-title",r.isCollapsed),ne(1),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(5),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed))},dependencies:[ha,wo,od,R2],styles:["[_nghost-%COMP%]{display:contents}.sidebar-wrapper[_ngcontent-%COMP%]{height:100%;display:flex;position:relative}.sidebar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-right:lightgray 1px solid;border-radius:12px;width:260px;height:100vh;background:whitesmoke;color:#1f2744;box-shadow:0 0 16px #0000001a;transition:all .3s cubic-bezier(.4,0,.2,1);overflow-y:auto;overflow-x:hidden;position:sticky;left:0;top:0;z-index:999}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:64px}.sidebar-header[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1);min-height:60px}.logo-area[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px}.app-name[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;white-space:nowrap}.toggle-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border:none;cursor:pointer;color:#1f2744;transition:all .2s ease}.toggle-button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#4DB299,#4D90B2,#B24D9E)}.toggle-icon[_ngcontent-%COMP%]{width:16px;height:16px;background-size:contain;background-repeat:no-repeat;background-position:center}.toggle-icon.chevron-left[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='18px' height='18px'%3E%3Cpath d='M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z'/%3E%3C/svg%3E\")}.toggle-icon.chevron-right[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='18px' height='18px'%3E%3Cpath d='M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z'/%3E%3C/svg%3E\")}.sidebar-content[_ngcontent-%COMP%]{flex:1;padding:.5rem 0;overflow-y:auto}.sidebar-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-title[_ngcontent-%COMP%]{color:#1f2744;padding:.5rem 1rem;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:1px}.collapsed-title[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:.5rem 0}.mini-title[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border-radius:4px;font-size:.6rem;font-weight:700}.menu-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.6rem 1rem;cursor:pointer;transition:all .2s ease;position:relative;margin:.2rem .5rem;border-radius:8px}.menu-item[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#AEE3D6,#4DB299)}.menu-item.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4DB299,#2A7B68);position:relative}.menu-item.active[_ngcontent-%COMP%]:before{content:\"\";position:absolute;left:0;top:0;height:100%;width:3px;background-color:#4db299;border-radius:0 3px 3px 0}.icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;height:24px;position:relative;margin-right:12px}.menu-icon[_ngcontent-%COMP%]{width:20px;height:20px;opacity:.7;color:#1f2744;transition:opacity .2s ease;background-size:contain;background-repeat:no-repeat;background-position:center}.user-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E\")}.preferences-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z'/%3E%3C/svg%3E\")}.notifications-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z'/%3E%3C/svg%3E\")}.calendar-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E\")}.booking-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E\")}.history-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z'/%3E%3C/svg%3E\")}.home-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E\")}.groups-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z'/%3E%3C/svg%3E\")}.phone-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z'/%3E%3C/svg%3E\")}.integrations-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z'/%3E%3C/svg%3E\")}.plan-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z'/%3E%3C/svg%3E\")}.contacts-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M20 0H4v2h16V0zM4 24h16v-2H4v2zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75zM17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5V17z'/%3E%3C/svg%3E\")}.menu-item[_ngcontent-%COMP%]:hover   .menu-icon[_ngcontent-%COMP%]{opacity:1}.menu-text[_ngcontent-%COMP%]{white-space:nowrap;font-size:.9rem}.tooltip[_ngcontent-%COMP%]{position:absolute;left:100%;top:50%;transform:translateY(-50%);background-color:#000c;color:#1f2744;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .3s ease,transform .3s ease;margin-left:10px;z-index:1000}.menu-item[_ngcontent-%COMP%]:hover   .tooltip[_ngcontent-%COMP%]{opacity:1;transform:translateY(-50%)}.sidebar-footer[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid rgba(255,255,255,.1);margin-top:auto}.user-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-weight:600;margin:0;font-size:.9rem}.user-email[_ngcontent-%COMP%]{color:#fff9;margin:0;font-size:.8rem}.user-mini-profile[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:17px;z-index:1000;cursor:pointer}.mini-avatar[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;border:2px solid rgba(255,255,255,.2);transition:all .2s ease}.mini-avatar[_ngcontent-%COMP%]:hover{border-color:#ffffff80}@media (max-width: 768px){.sidebar-container[_ngcontent-%COMP%]{width:240px}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:0;padding:0;visibility:hidden}.user-mini-profile[_ngcontent-%COMP%]{display:none}}"]})}}return t})(),_2e=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-user-layout"]],decls:6,vars:0,consts:[[1,"page-layout"],[1,"page-layout__content"],[1,"left-sidebar"],[1,"main-content"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2),$e(3,"app-sidebar"),B(),z(4,"div",3),$e(5,"router-outlet"),B()()())},dependencies:[T2,g2e],styles:[".page-layout__content[_ngcontent-%COMP%]{display:flex;gap:2rem}.main-content[_ngcontent-%COMP%]{flex:1}.page-layout[_ngcontent-%COMP%]{background-color:#f9f9f9}"]})}}return t})();function y2e(t,n){1&t&&(z(0,"div",27)(1,"span",28),q(2,"Admin Controle Center"),B()())}function v2e(t,n){1&t&&(z(0,"span"),q(1,"Management Center "),B())}function b2e(t,n){1&t&&(z(0,"div",29),q(1,"MC"),B())}function x2e(t,n){1&t&&(z(0,"span",30),q(1,"Dashboard"),B())}function w2e(t,n){1&t&&(z(0,"div",31),q(1,"Dashboard"),B())}function k2e(t,n){1&t&&(z(0,"span",30),q(1,"Users List"),B())}function M2e(t,n){1&t&&(z(0,"div",31),q(1,"Users List"),B())}function C2e(t,n){1&t&&(z(0,"span",30),q(1,"Contacts"),B())}function S2e(t,n){1&t&&(z(0,"div",31),q(1,"Contacts"),B())}function E2e(t,n){1&t&&(z(0,"span",30),q(1,"Pending Requests"),B())}function D2e(t,n){1&t&&(z(0,"div",31),q(1,"Pending Requests"),B())}function T2e(t,n){1&t&&(z(0,"span",30),q(1,"Properties List"),B())}function A2e(t,n){1&t&&(z(0,"div",31),q(1,"Properties List"),B())}function P2e(t,n){1&t&&(z(0,"span"),q(1,"Quick Links"),B())}function I2e(t,n){1&t&&(z(0,"div",29),q(1,"QL"),B())}function O2e(t,n){1&t&&(z(0,"span",30),q(1,"Home"),B())}function R2e(t,n){1&t&&(z(0,"div",31),q(1,"Home"),B())}let L2e=(()=>{class t{constructor(){this.isCollapsed=!1,this.screenWidth=window.innerWidth,this.checkScreenWidth()}ngOnInit(){const e=localStorage.getItem("sidebarState");e&&(this.isCollapsed="collapsed"===e)}onResize(e){this.screenWidth=window.innerWidth,this.checkScreenWidth()}checkScreenWidth(){this.screenWidth<=768&&(this.isCollapsed=!0)}toggleSidebar(){this.isCollapsed=!this.isCollapsed,localStorage.setItem("sidebarState",this.isCollapsed?"collapsed":"expanded")}shouldShowTooltip(){return this.isCollapsed&&this.screenWidth>768}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-sidebar"]],hostBindings:function(i,r){1&i&&qt("resize",function(c){return r.onResize(c)},0,Tv)},decls:47,vars:24,consts:[[1,"sidebar-wrapper"],[1,"sidebar-container"],[1,"sidebar-header"],["class","logo-area",4,"ngIf"],[1,"toggle-button",3,"click"],[1,"toggle-icon",3,"ngClass"],[1,"sidebar-content"],[1,"sidebar-section"],[1,"section-title"],[4,"ngIf"],["class","mini-title",4,"ngIf"],[1,"menu-list"],["routerLinkActive","active","routerLink","/admin/dashboard",1,"menu-item"],[1,"icon-container"],[1,"menu-icon","user-icon"],["class","menu-text",4,"ngIf"],["class","tooltip",4,"ngIf"],["routerLinkActive","active","routerLink","/admin/users",1,"menu-item"],[1,"fa-solid","fa-users"],[1,"menu-item"],[1,"menu-icon","contacts-icon"],["routerLinkActive","active","routerLink","/admin/properties-list",1,"menu-item"],[1,"menu-icon","calendar-icon"],["routerLinkActive","active","routerLink","/admin/properties",1,"menu-item"],[1,"menu-icon","booking-icon"],["routerLinkActive","active","routerLink","/home",1,"menu-item"],[1,"menu-icon","home-icon"],[1,"logo-area"],[1,"app-name"],[1,"mini-title"],[1,"menu-text"],[1,"tooltip"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2),He(3,y2e,3,0,"div",3),z(4,"button",4),qt("click",function(){return r.toggleSidebar()}),$e(5,"i",5),B()(),z(6,"div",6)(7,"div",7)(8,"div",8),He(9,v2e,2,0,"span",9),He(10,b2e,2,0,"div",10),B(),z(11,"ul",11)(12,"li",12)(13,"div",13),$e(14,"i",14),B(),He(15,x2e,2,0,"span",15),He(16,w2e,2,0,"div",16),B(),z(17,"li",17)(18,"div",13),$e(19,"i",18),B(),He(20,k2e,2,0,"span",15),He(21,M2e,2,0,"div",16),B(),z(22,"li",19)(23,"div",13),$e(24,"i",20),B(),He(25,C2e,2,0,"span",15),He(26,S2e,2,0,"div",16),B(),z(27,"li",21)(28,"div",13),$e(29,"i",22),B(),He(30,E2e,2,0,"span",15),He(31,D2e,2,0,"div",16),B(),z(32,"li",23)(33,"div",13),$e(34,"i",24),B(),He(35,T2e,2,0,"span",15),He(36,A2e,2,0,"div",16),B()()(),z(37,"div",7)(38,"div",8),He(39,P2e,2,0,"span",9),He(40,I2e,2,0,"div",10),B(),z(41,"ul",11)(42,"li",25)(43,"div",13),$e(44,"i",26),B(),He(45,O2e,2,0,"span",15),He(46,R2e,2,0,"div",16),B()()()()()()),2&i&&(ne(1),Z("collapsed",r.isCollapsed),ne(2),ye("ngIf",!r.isCollapsed),ne(2),ye("ngClass",r.isCollapsed?"chevron-right":"chevron-left"),ne(3),Z("collapsed-title",r.isCollapsed),ne(1),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(5),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.shouldShowTooltip()),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.shouldShowTooltip()),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.shouldShowTooltip()),ne(4),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.shouldShowTooltip()),ne(2),Z("collapsed-title",r.isCollapsed),ne(1),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed),ne(5),ye("ngIf",!r.isCollapsed),ne(1),ye("ngIf",r.isCollapsed))},dependencies:[ha,wo,od,R2],styles:["[_nghost-%COMP%]{display:contents}.sidebar-wrapper[_ngcontent-%COMP%]{height:100%;display:flex;position:relative}.sidebar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-right:lightgray 1px solid;border-radius:12px;width:260px;height:100vh;background:whitesmoke;color:#1f2744;box-shadow:0 0 16px #0000001a;transition:all .3s cubic-bezier(.4,0,.2,1);overflow-y:auto;overflow-x:hidden;position:sticky;left:0;top:0;z-index:999}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:64px}.sidebar-header[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1);min-height:60px}.logo-area[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px}.app-name[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;white-space:nowrap}.toggle-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border:none;cursor:pointer;color:#1f2744;transition:all .2s ease}.toggle-button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#4DB299,#4D90B2,#B24D9E)}.toggle-icon[_ngcontent-%COMP%]{width:16px;height:16px;background-size:contain;background-repeat:no-repeat;background-position:center}.toggle-icon.chevron-left[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='18px' height='18px'%3E%3Cpath d='M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z'/%3E%3C/svg%3E\")}.toggle-icon.chevron-right[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='18px' height='18px'%3E%3Cpath d='M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z'/%3E%3C/svg%3E\")}.sidebar-content[_ngcontent-%COMP%]{flex:1;padding:.5rem 0}.sidebar-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-title[_ngcontent-%COMP%]{color:#1f2744;padding:.5rem 1rem;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:1px}.collapsed-title[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:.5rem 0}.mini-title[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#81CDB7,#4DB299,#2F7C6A);border-radius:4px;font-size:.6rem;font-weight:700}.menu-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.6rem 1rem;cursor:pointer;transition:all .2s ease;position:relative;margin:.2rem .5rem;border-radius:8px}.menu-item[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#AEE3D6,#4DB299)}.menu-item.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4DB299,#2A7B68);position:relative}.menu-item.active[_ngcontent-%COMP%]:before{content:\"\";position:absolute;left:0;top:0;height:100%;width:3px;background-color:#4db299;border-radius:0 3px 3px 0}.icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;height:24px;position:relative;margin-right:12px}.menu-icon[_ngcontent-%COMP%]{width:20px;height:20px;opacity:.7;color:#1f2744;transition:opacity .2s ease;background-size:contain;background-repeat:no-repeat;background-position:center}.user-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E\")}.preferences-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z'/%3E%3C/svg%3E\")}.notifications-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z'/%3E%3C/svg%3E\")}.calendar-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E\")}.booking-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E\")}.history-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z'/%3E%3C/svg%3E\")}.home-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E\")}.groups-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z'/%3E%3C/svg%3E\")}.phone-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z'/%3E%3C/svg%3E\")}.integrations-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z'/%3E%3C/svg%3E\")}.plan-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z'/%3E%3C/svg%3E\")}.contacts-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black' width='24px' height='24px'%3E%3Cpath d='M20 0H4v2h16V0zM4 24h16v-2H4v2zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75zM17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5V17z'/%3E%3C/svg%3E\")}.menu-item[_ngcontent-%COMP%]:hover   .menu-icon[_ngcontent-%COMP%]{opacity:1}.menu-text[_ngcontent-%COMP%]{white-space:nowrap;font-size:.9rem}.badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background-color:#e74c3c;color:#1f2744;border-radius:50%;width:16px;height:16px;font-size:10px;display:flex;align-items:center;justify-content:center}.tooltip[_ngcontent-%COMP%]{position:absolute;left:100%;top:50%;transform:translateY(-50%);background-color:#000c;color:#1f2744;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .3s ease,transform .3s ease;margin-left:10px;z-index:1000}.menu-item[_ngcontent-%COMP%]:hover   .tooltip[_ngcontent-%COMP%]{opacity:1;transform:translateY(-50%)}.sidebar-footer[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid rgba(255,255,255,.1);margin-top:auto}.user-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-weight:600;margin:0;font-size:.9rem}.user-email[_ngcontent-%COMP%]{color:#fff9;margin:0;font-size:.8rem}.user-mini-profile[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:17px;z-index:1000;cursor:pointer}.mini-avatar[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;border:2px solid rgba(255,255,255,.2);transition:all .2s ease}.mini-avatar[_ngcontent-%COMP%]:hover{border-color:#ffffff80}@media (max-width: 768px){.sidebar-container[_ngcontent-%COMP%]{width:240px}.sidebar-container.collapsed[_ngcontent-%COMP%]{width:0;padding:0;visibility:hidden}.user-mini-profile[_ngcontent-%COMP%]{display:none}}"]})}}return t})(),F2e=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-dash-layout"]],decls:5,vars:0,consts:[[1,"page-body"],[1,"left-sidebar"],[1,"main-content"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1),$e(2,"app-admin-sidebar"),B(),z(3,"div",2),$e(4,"router-outlet"),B()())},dependencies:[T2,L2e],styles:[".page-body[_ngcontent-%COMP%]{display:flex;min-height:100vh}.main-content[_ngcontent-%COMP%]{flex:1;padding:20px;overflow-y:auto}"]})}}return t})();const z2e=["propertyChart"],N2e=["userChart"];function B2e(t,n){if(1&t&&(z(0,"div",29)(1,"div",18)(2,"h3"),q(3,"Users Distribution"),B(),$e(4,"canvas",30),B()()),2&t){const e=ht();ne(4),ye("data",e.pieChartData)("options",e.pieChartOptions)}}function V2e(t,n){if(1&t&&$e(0,"canvas",31,32),2&t){const e=ht();ye("data",e.userGrowthData)("options",e.lineChartOptions)}}function j2e(t,n){1&t&&(z(0,"div",33),q(1," Loading user growth data... "),B())}function H2e(t,n){if(1&t&&$e(0,"canvas",31,34),2&t){const e=ht();ye("data",e.propertyGrowthData)("options",e.lineChartOptions)}}function U2e(t,n){1&t&&(z(0,"div",33),q(1," Loading property growth data... "),B())}function q2e(t,n){if(1&t&&(z(0,"span",41),q(1),B()),2&t){const e=n.$implicit;ye("ngClass",ht(2).getRoleBadgeClass(e)),ne(1),Ft(" ",e.replace("ROLE_",""),"\n")}}function $2e(t,n){if(1&t&&(z(0,"tr",35)(1,"td",36),q(2),B(),z(3,"td"),$e(4,"img",37),B(),z(5,"td",38),q(6),B(),z(7,"td",39),q(8),B(),z(9,"td",39),q(10),B(),z(11,"td"),He(12,q2e,2,2,"span",40),B()()),2&t){const e=n.$implicit,i=ht();ne(2),Ft("USR ",e.id,""),ne(2),ye("src",e.profileImage?i.getFullImageUrl(e.profileImage):"/assets/default-avatar.png",fs),ne(2),Yt(" ",e.name," ",e.lastname," "),ne(2),Qe(e.email),ne(2),Qe(e.phoneNumber),ne(2),ye("ngForOf",e.roles)}}let G2e=(()=>{class t{constructor(e,i){this.propertyService=e,this.cdr=i,this.users=[],this.totalUsers=0,this.totalOwners=0,this.totalProperties=0,this.pendingProperties=0,this.showUserChart=!1,this.userGrowthLoaded=!1,this.propertyGrowthLoaded=!1,this.pieChartType="doughnut",this.pieChartData={labels:["Owners","Users"],datasets:[{data:[10,40],backgroundColor:["#4F46E5","#06B6D4"],hoverBackgroundColor:["#6366F1","#22D3EE"],borderWidth:2,borderColor:"#ffffff"}]},this.pieChartOptions={responsive:!0,cutout:"60%",plugins:{legend:{position:"top",labels:{color:"#333",font:{size:14,weight:"bold"}}},tooltip:{callbacks:{label:r=>{const c=r.raw;return`${r.label||""}: ${c} (${(c/r.dataset.data.reduce((k,E)=>k+E,0)*100).toFixed(1)}%)`}}},title:{display:!0,text:"Users vs Owners Distribution",font:{size:16},color:"#333"}}},this.userGrowthData={labels:[],datasets:[{data:[],label:"User Registrations",borderColor:"#4F46E5",backgroundColor:"rgba(79, 70, 229, 0.3)",fill:!0,tension:.3}]},this.propertyGrowthData={labels:[],datasets:[{data:[],label:"Property Listings",borderColor:"#06B6D4",backgroundColor:"rgba(6, 182, 212, 0.3)",fill:!0,tension:.3}]},this.lineChartOptions={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"top"}},animation:{onComplete:()=>{this.cdr.detectChanges()}}},this.lineChartType="line"}ngOnInit(){this.loadDashboardData(),this.propertyService.getallusers().subscribe(e=>{this.users=e})}ngAfterViewInit(){setTimeout(()=>{this.loadUserGrowth(),this.loadPropertyGrowth()},100)}loadDashboardData(){this.propertyService.getallusers().subscribe(e=>{this.totalUsers=e.length,this.totalOwners=e.filter(r=>r.roles.includes("ROLE_OWNER")).length,this.pieChartData.datasets[0].data=[this.totalOwners,this.totalUsers-this.totalOwners]}),this.propertyService.getAllProperties().subscribe(e=>{this.totalProperties=e.length}),this.propertyService.getAdminProperties().subscribe(e=>{this.pendingProperties=e.filter(i=>"pending"===i.approval).length})}loadUserGrowth(){this.propertyService.getUserGrowthOverTime().subscribe(e=>{this.userGrowthData.labels=e.map(i=>i.date),this.userGrowthData.datasets[0].data=e.map(i=>i.count),this.userGrowthLoaded=!0,setTimeout(()=>{this.userChart?.update(),this.cdr.detectChanges()},50)})}loadPropertyGrowth(){this.propertyService.getPropertyGrowthOverTime().subscribe(e=>{this.propertyGrowthData.labels=e.map(i=>i.date),this.propertyGrowthData.datasets[0].data=e.map(i=>i.count),this.propertyGrowthLoaded=!0,setTimeout(()=>{this.propertyChart?.update(),this.cdr.detectChanges()},50)})}getImageUrl(e){return e?e.startsWith("http")?e:`http://backend.ddev.site${e.startsWith("/")?e:"/"+e}`:"/assets/default-avatar.png"}getFullImageUrl(e){return`http://backend.ddev.site${e}`}getRoleBadgeClass(e){switch(e){case"ROLE_USER":return"bg-success";case"ROLE_OWNER":return"bg-warning text-dark";case"ROLE_ADMIN":return"bg-danger";default:return"bg-secondary"}}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(Pf))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-dashboard"]],viewQuery:function(i,r){if(1&i&&(Df(z2e,5),Df(N2e,5)),2&i){let s;js(s=Hs())&&(r.propertyChart=s.first),js(s=Hs())&&(r.userChart=s.first)}},decls:82,vars:10,consts:[[1,"page-body"],[1,"dashboard-header"],[1,"dashboard-title"],[1,"subtitle"],[1,"dashboard-content"],[1,"parent"],[1,"hover-wrapper",3,"mouseenter","mouseleave"],[1,"div1","stats-card","hoverable"],[1,"stats-header"],[1,"fa-solid","fa-arrow-right"],[1,"stats-body"],[1,"stats-value"],[1,"description"],["class","div7 chart-hover",4,"ngIf"],[1,"div2","stats-card","hoverable"],[1,"div3","stats-card","hoverable"],[1,"div4","stats-card","hoverable"],[1,"div5"],[1,"chart-container"],["baseChart","","type","line",3,"data","options",4,"ngIf"],["class","loading-placeholder",4,"ngIf"],[1,"div6","property-growth"],[1,"div8"],[1,"table-responsive","shadow-sm","rounded","overflow-hidden"],[1,"table","align-middle","mb-0","bg-white"],[1,"bg-light","text-center","table","mb-2","dark","text-white","fw-bold"],["scope","col"],[1,"text-center"],["class","border-bottom",4,"ngFor","ngForOf"],[1,"div7","chart-hover"],["baseChart","","type","doughnut",3,"data","options"],["baseChart","","type","line",3,"data","options"],["userChart",""],[1,"loading-placeholder"],["propertyChart",""],[1,"border-bottom"],[1,"fw-semibold"],["alt","Profile","width","45","height","45",1,"rounded-circle","shadow-sm",3,"src"],[1,"fw-semibold","text-capitalize"],[1,"text-muted"],["class","badge me-1",3,"ngClass",4,"ngFor","ngForOf"],[1,"badge","me-1",3,"ngClass"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"header")(3,"h2",2),q(4,"Dashboard"),B(),z(5,"p",3),q(6,"Here is today's report and performances"),B()()(),z(7,"div",4)(8,"div",5)(9,"div",6),qt("mouseenter",function(){return r.showUserChart=!0})("mouseleave",function(){return r.showUserChart=!1}),z(10,"div",7)(11,"div",8)(12,"h6"),q(13,"Total Users"),B(),$e(14,"i",9),B(),z(15,"div",10)(16,"span",11),q(17),B()(),z(18,"p",12),q(19,"Total users registered on the platform"),B()(),He(20,B2e,5,2,"div",13),B(),z(21,"div",14)(22,"div",8)(23,"h6"),q(24,"Total owners"),B(),$e(25,"i",9),B(),z(26,"div",10)(27,"span",11),q(28),B()(),z(29,"p",12),q(30,"Total owners registred in the platform"),B()(),z(31,"div",15)(32,"div",8)(33,"h6"),q(34,"Total Properties listed"),B(),$e(35,"i",9),B(),z(36,"div",10)(37,"span",11),q(38),B()(),z(39,"p",12),q(40,"Total properties listed in the platform"),B()(),z(41,"div",16)(42,"div",8)(43,"h6"),q(44,"Pending Properties"),B(),$e(45,"i",9),B(),z(46,"div",10)(47,"span",11),q(48),B()(),z(49,"p",12),q(50,"Total properties pending in the platform"),B()(),z(51,"div",17)(52,"div",18)(53,"h5"),q(54,"User Growth Over Time"),B(),He(55,V2e,2,2,"canvas",19),He(56,j2e,2,0,"div",20),B()(),z(57,"div",21)(58,"div",18)(59,"h5"),q(60,"Property Growth Over Time"),B(),He(61,H2e,2,2,"canvas",19),He(62,U2e,2,0,"div",20),B()(),z(63,"div",22)(64,"div",23)(65,"table",24)(66,"thead",25)(67,"tr")(68,"th",26),q(69,"ID"),B(),z(70,"th",26),q(71,"Profile"),B(),z(72,"th",26),q(73,"Name"),B(),z(74,"th",26),q(75,"Email"),B(),z(76,"th",26),q(77,"Phone"),B(),z(78,"th",26),q(79,"Roles"),B()()(),z(80,"tbody",27),He(81,$2e,13,7,"tr",28),B()()()()()()()),2&i&&(ne(17),Qe(r.totalUsers),ne(3),ye("ngIf",r.showUserChart),ne(8),Qe(r.totalOwners),ne(10),Qe(r.totalProperties),ne(10),Qe(r.pendingProperties),ne(7),ye("ngIf",r.userGrowthLoaded),ne(1),ye("ngIf",!r.userGrowthLoaded),ne(5),ye("ngIf",r.propertyGrowthLoaded),ne(1),ye("ngIf",!r.propertyGrowthLoaded),ne(19),ye("ngForOf",r.users))},dependencies:[ha,qs,wo,zj],styles:['.page-body[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:1rem;border:1px solid #E0E0E0;border-radius:8px;width:100%}.dashboard-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}.dashboard-title[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;font-weight:600;color:#1f2744}.subtitle[_ngcontent-%COMP%]{margin:4px 0 0;font-size:1rem;color:#789}.stats-card[_ngcontent-%COMP%]{padding:1.5rem;background:linear-gradient(135deg,#4DB299,#3baa90);border-radius:16px;height:auto;min-height:160px;box-shadow:0 6px 18px #0000001a;color:#fff;transition:transform .3s ease,box-shadow .3s ease;position:relative;overflow:hidden;display:flex;flex-direction:column;justify-content:space-between}.hoverable[_ngcontent-%COMP%]:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 12px 24px #00000026}.stats-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.stats-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:0;color:#fffd}.icon-hover[_ngcontent-%COMP%]{transition:transform .3s ease;color:#fffc}.hoverable[_ngcontent-%COMP%]:hover   .icon-hover[_ngcontent-%COMP%]{transform:rotate(90deg)}.stats-value[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#fff}.description[_ngcontent-%COMP%]{margin-top:1rem;font-size:.95rem;color:#fffc;font-weight:500}.parent[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;width:100%}.chart-container[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:10px;box-shadow:0 2px 4px #0000001a;padding:20px;margin-bottom:20px;width:100%;box-sizing:border-box}.div5[_ngcontent-%COMP%], .div6[_ngcontent-%COMP%]{grid-column:span 2}.div7[_ngcontent-%COMP%]{grid-column:span 1}.div8[_ngcontent-%COMP%]{grid-column:span 4;max-height:80vh;overflow-y:auto;box-sizing:border-box}.table-responsive[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}th[_ngcontent-%COMP%]{color:#fff;font-size:1.1rem;font-weight:600;background-color:#4db299;padding:.8rem;position:sticky;top:0;z-index:10}.table[_ngcontent-%COMP%]   img.rounded-circle[_ngcontent-%COMP%]{width:45px;height:45px;object-fit:cover;border:3px solid white;box-shadow:0 2px 8px #0000001f;transition:transform .2s}.table[_ngcontent-%COMP%]   img.rounded-circle[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.table[_ngcontent-%COMP%]   .fw-semibold[_ngcontent-%COMP%]{font-weight:600;color:#344767}.table[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#64748b!important}.table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:6px 10px;font-weight:500;border-radius:6px;font-size:.75rem;box-shadow:0 2px 5px #0000000f;display:inline-block;margin-bottom:3px}.role-admin-badge[_ngcontent-%COMP%]{background-color:#ff6384;color:#fff}.role-user-badge[_ngcontent-%COMP%]{background-color:#36a2eb;color:#fff}.role-manager-badge[_ngcontent-%COMP%]{background-color:#4bc0c0;color:#fff}.role-editor-badge[_ngcontent-%COMP%]{background-color:#ffcd56;color:#333}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.empty-state[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:#64748b}.table-loading[_ngcontent-%COMP%]{position:relative}.table-loading[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:rgba(255,255,255,.7);display:flex;align-items:center;justify-content:center}.hover-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.chart-hover[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:300px;background-color:#fff;box-shadow:0 4px 10px #0000001a;z-index:10;padding:1rem;border-radius:8px;transition:opacity .3s ease}.chart-hover[_ngcontent-%COMP%]{opacity:0;pointer-events:none;transition:opacity .3s ease}.hover-wrapper[_ngcontent-%COMP%]:hover   .chart-hover[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}@media (min-width: 1400px){.stats-value[_ngcontent-%COMP%]{font-size:3rem}.dashboard-title[_ngcontent-%COMP%]{font-size:2.2rem}.page-body[_ngcontent-%COMP%]{padding:1.5rem}}@media (max-width: 1200px){.parent[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.div5[_ngcontent-%COMP%], .div6[_ngcontent-%COMP%], .div7[_ngcontent-%COMP%], .div8[_ngcontent-%COMP%]{grid-column:span 2}}@media (max-width: 992px){.dashboard-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.stats-value[_ngcontent-%COMP%]{font-size:2.2rem}.chart-container[_ngcontent-%COMP%]{padding:15px}th[_ngcontent-%COMP%]{font-size:1rem;padding:.7rem}}@media (max-width: 768px){.parent[_ngcontent-%COMP%]{grid-template-columns:1fr}.div5[_ngcontent-%COMP%], .div6[_ngcontent-%COMP%], .div7[_ngcontent-%COMP%], .div8[_ngcontent-%COMP%]{grid-column:span 1}.dashboard-title[_ngcontent-%COMP%]{font-size:1.5rem}.subtitle[_ngcontent-%COMP%]{font-size:.9rem}.stats-card[_ngcontent-%COMP%]{min-height:140px;padding:1.2rem}.stats-value[_ngcontent-%COMP%]{font-size:2rem}.description[_ngcontent-%COMP%]{font-size:.85rem}.page-body[_ngcontent-%COMP%]{padding:.75rem}.table[_ngcontent-%COMP%]{font-size:.85rem}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.6rem;font-size:.8rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.6rem}.table[_ngcontent-%COMP%]   img.rounded-circle[_ngcontent-%COMP%]{width:35px;height:35px}.table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:4px 8px}}@media (max-width: 480px){.stats-card[_ngcontent-%COMP%]{min-height:120px;padding:1rem}.stats-value[_ngcontent-%COMP%]{font-size:1.8rem}.stats-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:.9rem}.description[_ngcontent-%COMP%]{font-size:.8rem;margin-top:.7rem}th[_ngcontent-%COMP%]{font-size:.8rem;padding:.5rem}.table[_ngcontent-%COMP%]   img.rounded-circle[_ngcontent-%COMP%]{width:30px;height:30px}}.loading-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:200px;color:#666;font-style:italic}']})}}return t})();const W2e=function(t,n,e){return{"bg-success":t,"bg-warning text-dark":n,"bg-danger":e}};function Z2e(t,n){if(1&t&&(z(0,"span",11),q(1),B()),2&t){const e=n.$implicit;ye("ngClass",Pw(2,W2e,"ROLE_USER"===e,"ROLE_OWNER"===e,"ROLE_ADMIN"===e)),ne(1),Ft(" ",e.replace("ROLE_","")," ")}}function Y2e(t,n){if(1&t){const e=Ki();z(0,"tr")(1,"td"),q(2),B(),z(3,"td"),$e(4,"img",8),B(),z(5,"td"),q(6),B(),z(7,"td"),q(8),B(),z(9,"td"),q(10),B(),z(11,"td"),He(12,Z2e,2,6,"span",9),B(),z(13,"td")(14,"button",10),qt("click",function(){const s=An(e).$implicit;return Mn(ht().deleteUser(s.id))}),q(15," Delete "),B()()()}if(2&t){const e=n.$implicit,i=ht();ne(2),Qe(e.id),ne(2),ye("src",e.profileImage?i.getFullImageUrl(e.profileImage):"/assets/default-avatar.png",fs),ne(2),Yt("",e.name," ",e.lastname,""),ne(2),Qe(e.email),ne(2),Qe(e.phoneNumber),ne(2),ye("ngForOf",e.roles)}}let X2e=(()=>{class t{constructor(e){this.propertyService=e,this.users=[],this.searchText=""}ngOnInit(){this.propertyService.getallusers().subscribe(e=>{this.users=e})}filteredUsers(){const e=this.searchText.toLowerCase();return this.users.filter(i=>i.name.toLowerCase().includes(e)||i.lastName?.toLowerCase().includes(e)||i.email.toLowerCase().includes(e))}deleteUser(e){confirm("Are you sure you want to delete this user?")&&this.propertyService.deleteUser(e).subscribe(()=>{this.users=this.users.filter(i=>i.id!==e)})}getFullImageUrl(e){return"http://backend.ddev.site"+e}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-user-list"]],decls:24,vars:2,consts:[[1,"container","my-4"],[1,"mb-3"],["type","text","placeholder","Search by name or email",1,"form-control","mb-3",3,"ngModel","ngModelChange"],[1,"table-responsive","rounded","shadow"],[1,"table","table-bordered","table-hover","table-striped","align-middle"],[1,"table-dark","text-center"],[1,"text-center"],[4,"ngFor","ngForOf"],["alt","Profile","width","40","height","40",1,"rounded-circle",3,"src"],["class","badge me-1",3,"ngClass",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"badge","me-1",3,"ngClass"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"h3",1),q(2,"User Management"),B(),z(3,"input",2),qt("ngModelChange",function(c){return r.searchText=c}),B(),z(4,"div",3)(5,"table",4)(6,"thead",5)(7,"tr")(8,"th"),q(9,"ID"),B(),z(10,"th"),q(11,"Profile"),B(),z(12,"th"),q(13,"Name"),B(),z(14,"th"),q(15,"Email"),B(),z(16,"th"),q(17,"Phone"),B(),z(18,"th"),q(19,"Roles"),B(),z(20,"th"),q(21,"Actions"),B()()(),z(22,"tbody",6),He(23,Y2e,16,7,"tr",7),B()()()()),2&i&&(ne(3),ye("ngModel",r.searchText),ne(20),ye("ngForOf",r.filteredUsers()))},dependencies:[ha,qs,hl,Wl,Wm]})}}return t})();function K2e(t,n){if(1&t){const e=Ki();z(0,"a",12),qt("keyup.enter",function(){return An(e),ht(3),Mn(Fa(1).previous())})("click",function(){return An(e),ht(3),Mn(Fa(1).previous())}),q(1),z(2,"span",13),q(3),B()()}if(2&t){const e=ht(3);ne(1),Ft(" ",e.previousLabel," "),ne(2),Qe(e.screenReaderPageLabel)}}function Q2e(t,n){if(1&t&&(z(0,"span",14),q(1),z(2,"span",13),q(3),B()()),2&t){const e=ht(3);ne(1),Ft(" ",e.previousLabel," "),ne(2),Qe(e.screenReaderPageLabel)}}function J2e(t,n){if(1&t&&(z(0,"li",9),He(1,K2e,4,2,"a",10),He(2,Q2e,4,2,"span",11),B()),2&t){ht(2);const e=Fa(1);Z("disabled",e.isFirstPage()),ne(1),ye("ngIf",1<e.getCurrent()),ne(1),ye("ngIf",e.isFirstPage())}}function ebe(t,n){if(1&t){const e=Ki();z(0,"a",12),qt("keyup.enter",function(){An(e);const r=ht().$implicit;return ht(2),Mn(Fa(1).setCurrent(r.value))})("click",function(){An(e);const r=ht().$implicit;return ht(2),Mn(Fa(1).setCurrent(r.value))}),z(1,"span",13),q(2),B(),z(3,"span"),q(4),ks(5,"number"),B()()}if(2&t){const e=ht().$implicit,i=ht(2);ne(2),Ft("",i.screenReaderPageLabel," "),ne(2),Qe("..."===e.label?e.label:Xd(5,2,e.label,""))}}function tbe(t,n){if(1&t&&(kp(0),z(1,"span",16)(2,"span",13),q(3),B(),z(4,"span"),q(5),ks(6,"number"),B()(),Vm()),2&t){const e=ht().$implicit,i=ht(2);ne(3),Ft("",i.screenReaderCurrentLabel," "),ne(2),Qe("..."===e.label?e.label:Xd(6,2,e.label,""))}}function nbe(t,n){if(1&t&&(z(0,"li"),He(1,ebe,6,5,"a",10),He(2,tbe,7,5,"ng-container",15),B()),2&t){const e=n.$implicit;ht(2);const i=Fa(1);Z("current",i.getCurrent()===e.value)("ellipsis","..."===e.label),ne(1),ye("ngIf",i.getCurrent()!==e.value),ne(1),ye("ngIf",i.getCurrent()===e.value)}}function ibe(t,n){if(1&t){const e=Ki();z(0,"a",12),qt("keyup.enter",function(){return An(e),ht(3),Mn(Fa(1).next())})("click",function(){return An(e),ht(3),Mn(Fa(1).next())}),q(1),z(2,"span",13),q(3),B()()}if(2&t){const e=ht(3);ne(1),Ft(" ",e.nextLabel," "),ne(2),Qe(e.screenReaderPageLabel)}}function rbe(t,n){if(1&t&&(z(0,"span",14),q(1),z(2,"span",13),q(3),B()()),2&t){const e=ht(3);ne(1),Ft(" ",e.nextLabel," "),ne(2),Qe(e.screenReaderPageLabel)}}function obe(t,n){if(1&t&&(z(0,"li",17),He(1,ibe,4,2,"a",10),He(2,rbe,4,2,"span",11),B()),2&t){ht(2);const e=Fa(1);Z("disabled",e.isLastPage()),ne(1),ye("ngIf",!e.isLastPage()),ne(1),ye("ngIf",e.isLastPage())}}function sbe(t,n){if(1&t&&(z(0,"ul",4),He(1,J2e,3,4,"li",5),z(2,"li",6),q(3),B(),He(4,nbe,3,6,"li",7),He(5,obe,3,4,"li",8),B()),2&t){const e=ht(),i=Fa(1);Z("responsive",e.responsive),ne(1),ye("ngIf",e.directionLinks),ne(2),Yt(" ",i.getCurrent()," / ",i.getLastPage()," "),ne(1),ye("ngForOf",i.pages)("ngForTrackBy",e.trackByIndex),ne(1),ye("ngIf",e.directionLinks)}}class BI{constructor(){this.change=new Xi,this.instances={},this.DEFAULT_ID="DEFAULT_PAGINATION_ID"}defaultId(){return this.DEFAULT_ID}register(n){return null==n.id&&(n.id=this.DEFAULT_ID),this.instances[n.id]?this.updateInstance(n):(this.instances[n.id]=n,!0)}updateInstance(n){let e=!1;for(let i in this.instances[n.id])n[i]!==this.instances[n.id][i]&&(this.instances[n.id][i]=n[i],e=!0);return e}getCurrentPage(n){return this.instances[n]?this.instances[n].currentPage:1}setCurrentPage(n,e){if(this.instances[n]){let i=this.instances[n];e<=Math.ceil(i.totalItems/i.itemsPerPage)&&1<=e&&(this.instances[n].currentPage=e,this.change.emit(n))}}setTotalItems(n,e){this.instances[n]&&0<=e&&(this.instances[n].totalItems=e,this.change.emit(n))}setItemsPerPage(n,e){this.instances[n]&&(this.instances[n].itemsPerPage=e,this.change.emit(n))}getInstance(n=this.DEFAULT_ID){return this.instances[n]?this.clone(this.instances[n]):{}}clone(n){var e={};for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);return e}}const abe=Number.MAX_SAFE_INTEGER;let lbe=(()=>{class t{constructor(e){this.service=e,this.state={}}transform(e,i){if(!(e instanceof Array)){let F=i.id||this.service.defaultId();return this.state[F]?this.state[F].slice:e}let f,y,r=i.totalItems&&i.totalItems!==e.length,s=this.createInstance(e,i),c=s.id,k=s.itemsPerPage,E=this.service.register(s);if(!r&&e instanceof Array){if(k=+k||abe,f=(s.currentPage-1)*k,y=f+k,this.stateIsIdentical(c,e,f,y))return this.state[c].slice;{let $=e.slice(f,y);return this.saveState(c,e,$,f,y),this.service.change.emit(c),$}}return E&&this.service.change.emit(c),this.saveState(c,e,e,f,y),e}createInstance(e,i){return this.checkConfig(i),{id:null!=i.id?i.id:this.service.defaultId(),itemsPerPage:+i.itemsPerPage||0,currentPage:+i.currentPage||1,totalItems:+i.totalItems||e.length}}checkConfig(e){const r=["itemsPerPage","currentPage"].filter(s=>!(s in e));if(0<r.length)throw new Error(`PaginatePipe: Argument is missing the following required properties: ${r.join(", ")}`)}saveState(e,i,r,s,c){this.state[e]={collection:i,size:i.length,slice:r,start:s,end:c}}stateIsIdentical(e,i,r,s){let c=this.state[e];return!(!c||c.size!==i.length||c.start!==r||c.end!==s)&&c.slice.every((y,k)=>y===i[r+k])}}return t.\u0275fac=function(e){return new(e||t)(st(BI,16))},t.\u0275pipe=$n({name:"paginate",type:t,pure:!1}),t})(),cbe=(()=>{class t{constructor(e,i){this.service=e,this.changeDetectorRef=i,this.maxSize=7,this.pageChange=new Xi,this.pageBoundsCorrection=new Xi,this.pages=[],this.changeSub=this.service.change.subscribe(r=>{this.id===r&&(this.updatePageLinks(),this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges())})}ngOnInit(){void 0===this.id&&(this.id=this.service.defaultId()),this.updatePageLinks()}ngOnChanges(e){this.updatePageLinks()}ngOnDestroy(){this.changeSub.unsubscribe()}previous(){this.checkValidId(),this.setCurrent(this.getCurrent()-1)}next(){this.checkValidId(),this.setCurrent(this.getCurrent()+1)}isFirstPage(){return 1===this.getCurrent()}isLastPage(){return this.getLastPage()===this.getCurrent()}setCurrent(e){this.pageChange.emit(e)}getCurrent(){return this.service.getCurrentPage(this.id)}getLastPage(){let e=this.service.getInstance(this.id);return e.totalItems<1?1:Math.ceil(e.totalItems/e.itemsPerPage)}getTotalItems(){return this.service.getInstance(this.id).totalItems}checkValidId(){null==this.service.getInstance(this.id).id&&console.warn(`PaginationControlsDirective: the specified id "${this.id}" does not match any registered PaginationInstance`)}updatePageLinks(){let e=this.service.getInstance(this.id);const i=this.outOfBoundCorrection(e);i!==e.currentPage?setTimeout(()=>{this.pageBoundsCorrection.emit(i),this.pages=this.createPageArray(e.currentPage,e.itemsPerPage,e.totalItems,this.maxSize)}):this.pages=this.createPageArray(e.currentPage,e.itemsPerPage,e.totalItems,this.maxSize)}outOfBoundCorrection(e){const i=Math.ceil(e.totalItems/e.itemsPerPage);return i<e.currentPage&&0<i?i:e.currentPage<1?1:e.currentPage}createPageArray(e,i,r,s){s=+s;let c=[];const f=Math.max(Math.ceil(r/i),1),y=Math.ceil(s/2),k=e<=y,E=f-y<e,F=!k&&!E;let $=s<f,W=1;for(;W<=f&&W<=s;){let re,he=this.calculatePageNumber(W,e,s,f);re=$&&(2===W&&(F||E)||W===s-1&&(F||k))?"...":he,c.push({label:re,value:he}),W++}return c}calculatePageNumber(e,i,r,s){let c=Math.ceil(r/2);return e===r?s:1===e?e:r<s?s-c<i?s-r+e:c<i?i-c+e:e:e}}return t.\u0275fac=function(e){return new(e||t)(st(BI),st(Pf))},t.\u0275dir=gi({type:t,selectors:[["pagination-template"],["","pagination-template",""]],inputs:{id:"id",maxSize:"maxSize"},outputs:{pageChange:"pageChange",pageBoundsCorrection:"pageBoundsCorrection"},exportAs:["paginationApi"],features:[ol]}),t})();function VI(t){return!!t&&"false"!==t}let dbe=(()=>{class t{constructor(){this.maxSize=7,this.previousLabel="Previous",this.nextLabel="Next",this.screenReaderPaginationLabel="Pagination",this.screenReaderPageLabel="page",this.screenReaderCurrentLabel="You're on page",this.pageChange=new Xi,this.pageBoundsCorrection=new Xi,this._directionLinks=!0,this._autoHide=!1,this._responsive=!1}get directionLinks(){return this._directionLinks}set directionLinks(e){this._directionLinks=VI(e)}get autoHide(){return this._autoHide}set autoHide(e){this._autoHide=VI(e)}get responsive(){return this._responsive}set responsive(e){this._responsive=VI(e)}trackByIndex(e){return e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Xn({type:t,selectors:[["pagination-controls"]],inputs:{id:"id",maxSize:"maxSize",directionLinks:"directionLinks",autoHide:"autoHide",responsive:"responsive",previousLabel:"previousLabel",nextLabel:"nextLabel",screenReaderPaginationLabel:"screenReaderPaginationLabel",screenReaderPageLabel:"screenReaderPageLabel",screenReaderCurrentLabel:"screenReaderCurrentLabel"},outputs:{pageChange:"pageChange",pageBoundsCorrection:"pageBoundsCorrection"},decls:4,vars:4,consts:[[3,"id","maxSize","pageChange","pageBoundsCorrection"],["p","paginationApi"],["role","navigation"],["class","ngx-pagination",3,"responsive",4,"ngIf"],[1,"ngx-pagination"],["class","pagination-previous",3,"disabled",4,"ngIf"],[1,"small-screen"],[3,"current","ellipsis",4,"ngFor","ngForOf","ngForTrackBy"],["class","pagination-next",3,"disabled",4,"ngIf"],[1,"pagination-previous"],["tabindex","0",3,"keyup.enter","click",4,"ngIf"],["aria-disabled","true",4,"ngIf"],["tabindex","0",3,"keyup.enter","click"],[1,"show-for-sr"],["aria-disabled","true"],[4,"ngIf"],["aria-live","polite"],[1,"pagination-next"]],template:function(e,i){if(1&e&&(z(0,"pagination-template",0,1),qt("pageChange",function(s){return i.pageChange.emit(s)})("pageBoundsCorrection",function(s){return i.pageBoundsCorrection.emit(s)}),z(2,"nav",2),He(3,sbe,6,8,"ul",3),B()()),2&e){const r=Fa(1);ye("id",i.id)("maxSize",i.maxSize),ne(2),La("aria-label",i.screenReaderPaginationLabel),ne(1),ye("ngIf",!(i.autoHide&&r.pages.length<=1))}},dependencies:[cbe,wo,qs,X3],styles:['.ngx-pagination{margin-left:0;margin-bottom:1rem}.ngx-pagination:before,.ngx-pagination:after{content:" ";display:table}.ngx-pagination:after{clear:both}.ngx-pagination li{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;margin-right:.0625rem;border-radius:0}.ngx-pagination li{display:inline-block}.ngx-pagination a,.ngx-pagination button{color:#0a0a0a;display:block;padding:.1875rem .625rem;border-radius:0}.ngx-pagination a:hover,.ngx-pagination button:hover{background:#e6e6e6}.ngx-pagination .current{padding:.1875rem .625rem;background:#2199e8;color:#fefefe;cursor:default}.ngx-pagination .disabled{padding:.1875rem .625rem;color:#cacaca;cursor:default}.ngx-pagination .disabled:hover{background:transparent}.ngx-pagination a,.ngx-pagination button{cursor:pointer}.ngx-pagination .pagination-previous a:before,.ngx-pagination .pagination-previous.disabled:before{content:"\\ab";display:inline-block;margin-right:.5rem}.ngx-pagination .pagination-next a:after,.ngx-pagination .pagination-next.disabled:after{content:"\\bb";display:inline-block;margin-left:.5rem}.ngx-pagination .show-for-sr{position:absolute!important;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)}.ngx-pagination .small-screen{display:none}@media screen and (max-width: 601px){.ngx-pagination.responsive .small-screen{display:inline-block}.ngx-pagination.responsive li:not(.small-screen):not(.pagination-previous):not(.pagination-next){display:none}}\n'],encapsulation:2,changeDetection:0}),t})(),hbe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Bi({type:t}),t.\u0275inj=Ii({providers:[BI],imports:[[Gm]]}),t})();function ube(t,n){if(1&t&&(z(0,"div",40),$e(1,"img",41),B()),2&t){const e=n.$implicit;Z("active",0===n.index),ne(1),ye("src","http://backend.ddev.site"+e.imageName,fs)}}function pbe(t,n){if(1&t&&(z(0,"li",42),q(1),B()),2&t){const e=n.$implicit;ne(1),Ft(" ",e," ")}}const fbe=function(t,n,e){return{"bg-warning text-dark":t,"bg-success":n,"bg-danger":e}};function mbe(t,n){if(1&t){const e=Ki();z(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14)(5,"div",15),He(6,ube,2,3,"div",16),B(),z(7,"button",17),$e(8,"span",18),B(),z(9,"button",19),$e(10,"span",20),B()()(),z(11,"div",21)(12,"div",22)(13,"div",23)(14,"h5",24),q(15),z(16,"small",25),q(17),ks(18,"titlecase"),B()(),z(19,"span",26),q(20),B()(),z(21,"p",27)(22,"strong"),q(23,"Deal Type:"),B(),q(24),ks(25,"titlecase"),$e(26,"br"),z(27,"strong"),q(28,"Location:"),B(),q(29),ks(30,"titlecase"),ks(31,"titlecase"),B(),z(32,"p",27)(33,"strong"),q(34,"Price:"),B(),q(35),ks(36,"number"),$e(37,"br"),z(38,"strong"),q(39,"Size:"),B(),q(40),z(41,"strong"),q(42,"Bedrooms:"),B(),q(43),z(44,"strong"),q(45,"Bathrooms:"),B(),q(46),B(),z(47,"p",28)(48,"strong"),q(49,"Description:"),B(),$e(50,"br"),q(51),B(),z(52,"button",29),q(53," Show Amenities & Contact Info "),B(),z(54,"div",30)(55,"div",28)(56,"strong"),q(57,"Amenities:"),B(),z(58,"ul",31),He(59,pbe,2,1,"li",32),B()(),z(60,"div")(61,"strong"),q(62,"Contact:"),B(),$e(63,"br")(64,"i",33),q(65),$e(66,"br")(67,"i",34),q(68),B()(),z(69,"div",35)(70,"button",36),qt("click",function(){const s=An(e).$implicit;return Mn(ht().confirmAction(s,"approved"))}),$e(71,"i",37),q(72," Approve "),B(),z(73,"button",38),qt("click",function(){const s=An(e).$implicit;return Mn(ht().confirmAction(s,"rejected"))}),$e(74,"i",39),q(75," Reject "),B()()()()()()()}if(2&t){const e=n.$implicit,i=ht();ne(4),ye("id","carousel"+e.id),ne(2),ye("ngForOf",e.Media.photos),ne(1),La("data-bs-target","#carousel"+e.id),ne(2),La("data-bs-target","#carousel"+e.id),ne(6),Ft(" ",e.generalinfo.title," - "),ne(2),Qe(Iu(18,23,e.generalinfo.propertyType)),ne(2),ye("ngClass",Pw(33,fbe,"pending"===e.approval,"approved"===e.approval,"rejected"===e.approval)),ne(1),Ft(" ",e.approval," "),ne(4),Ft(" ",Iu(25,25,e.generalinfo.dealType),""),ne(5),Yt(" ",Iu(30,27,e.location.city),", ",Iu(31,29,e.location.subcity)," "),ne(6),Ft(" ",Iu(36,31,e.price.price)," TND"),ne(5),Ft(" ",e.Specification.size," m\xb2 | "),ne(3),Ft(" ",e.Specification.bedrooms," | "),ne(3),Ft(" ",e.Specification.bathrooms," "),ne(5),Ft(" ",e.generalinfo.description," "),ne(1),La("data-bs-target","#collapse"+e.id),ne(2),ye("id","collapse"+e.id),ne(5),ye("ngForOf",i.getTrueAmenities(e.Amenities)),ne(6),Ft(" ",e.contacts.email,""),ne(3),Ft(" ",e.contacts.phone," "),ne(2),ye("disabled","approved"===e.approval),ne(3),ye("disabled","rejected"===e.approval)}}const gbe=function(t){return{itemsPerPage:5,currentPage:t}};let _be=(()=>{class t{constructor(e){this.propertyService=e,this.properties=[],this.filteredProperties=[],this.searchTerm="",this.p=1}ngOnInit(){this.loadProperties()}loadProperties(){this.propertyService.getAdminProperties().subscribe(e=>{this.properties=e,this.filteredProperties=e})}filterProperties(){const e=this.searchTerm.toLowerCase();this.filteredProperties=this.properties.filter(i=>i.generalinfo.title.toLowerCase().includes(e))}confirmAction(e,i){confirm(`Are you sure you want to ${i} this property?`)&&this.propertyService.updatePropertyApproval(e.id,i).subscribe(()=>{this.loadProperties()})}getTrueAmenities(e){return Object.entries(e).filter(([i,r])=>!0===r).map(([i])=>i.replace(/([A-Z])/g," $1").replace(/^./,r=>r.toUpperCase()))}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-property-list"]],decls:12,vars:7,consts:[[1,"page-body"],[1,"page-header"],[1,"page-title"],[1,"container","py-4"],[1,"mb-4"],["type","text","placeholder","Search by title, city, or subcity...",1,"form-control",3,"ngModel","ngModelChange"],[1,"row","gy-4"],["class","col-12",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-4"],[3,"pageChange"],[1,"col-12"],[1,"card","shadow-sm","rounded","border-0"],[1,"row","g-0"],[1,"col-md-4"],["data-bs-ride","carousel",1,"carousel","slide","h-100",3,"id"],[1,"carousel-inner","h-100"],["class","carousel-item",3,"active",4,"ngFor","ngForOf"],["type","button","data-bs-slide","prev",1,"carousel-control-prev"],[1,"carousel-control-prev-icon"],["type","button","data-bs-slide","next",1,"carousel-control-next"],[1,"carousel-control-next-icon"],[1,"col-md-8"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"card-title","mb-0"],[1,"text-muted"],[1,"badge","rounded-pill","px-3","py-2","fs-6",3,"ngClass"],[1,"mb-1"],[1,"mb-2"],["type","button","data-bs-toggle","collapse",1,"btn","btn-link","p-0","mb-2"],[1,"collapse",3,"id"],[1,"list-inline","mt-1"],["class","list-inline-item badge bg-light text-dark border",4,"ngFor","ngForOf"],[1,"bi","bi-envelope"],[1,"bi","bi-telephone"],[1,"d-flex","gap-2","mt-3"],[1,"btn","btn-outline-success","btn-sm",3,"disabled","click"],[1,"bi","bi-check-circle","me-1"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","click"],[1,"bi","bi-x-circle","me-1"],[1,"carousel-item"],[1,"d-block","w-100","h-100","object-fit-cover",3,"src"],[1,"list-inline-item","badge","bg-light","text-dark","border"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"h4",2),q(3,"Pending Requests"),B()(),z(4,"div",3)(5,"div",4)(6,"input",5),qt("ngModelChange",function(c){return r.searchTerm=c}),B()(),z(7,"div",6),He(8,mbe,76,37,"div",7),ks(9,"paginate"),B(),z(10,"div",8)(11,"pagination-controls",9),qt("pageChange",function(c){return r.p=c}),B()()()()),2&i&&(ne(6),ye("ngModel",r.searchTerm),ne(2),ye("ngForOf",Xd(9,2,r.filteredProperties,Gr(5,gbe,r.p))))},dependencies:[ha,qs,hl,Wl,Wm,dbe,X3,jw,lbe]})}}return t})();function ybe(t,n){1&t&&$e(0,"img",23),2&t&&ye("src","http://backend.ddev.site"+n.$implicit.imageName,fs)}function vbe(t,n){if(1&t){const e=Ki();z(0,"div",14)(1,"div",15)(2,"h5",16),q(3),B(),z(4,"p",17),q(5),B(),z(6,"div",18)(7,"strong"),q(8,"City:"),B(),q(9),z(10,"strong"),q(11,"Price:"),B(),q(12),z(13,"strong"),q(14,"Status:"),B(),z(15,"span",19),q(16),B()(),z(17,"div",18)(18,"strong"),q(19,"Photos:"),B(),z(20,"div",20),He(21,ybe,1,1,"img",21),B()(),z(22,"button",22),qt("click",function(){const s=An(e).$implicit;return Mn(ht().openConfirmModal(s))}),q(23,"Delete"),B()()()}if(2&t){const e=n.$implicit;ne(3),Qe(e.generalinfo.title),ne(2),Qe(e.generalinfo.description),ne(4),Ft(" ",e.location.city," | "),ne(3),Ft(" ",e.price.price," | "),ne(4),Qe(e.approval),ne(5),ye("ngForOf",e.Media.photos)}}let bbe=(()=>{class t{constructor(e,i){this.propertyService=e,this.http=i,this.properties=[],this.filteredProperties=[],this.searchTerm="",this.selectedProperty=null}ngOnInit(){this.loadProperties()}loadProperties(){this.propertyService.getAllProperties().subscribe({next:e=>{this.properties=e,this.filteredProperties=[...e]},error:e=>{console.error("Failed to load properties",e)}})}filterProperties(){this.filteredProperties=this.properties.filter(e=>e.generalinfo.title.toLowerCase().includes(this.searchTerm.toLowerCase()))}openConfirmModal(e){this.selectedProperty=e;const i=document.getElementById("confirmModal");i&&new window.bootstrap.Modal(i).show()}AdminDeleteProperty(){this.selectedProperty&&this.propertyService.AdminDeleteProperty(this.selectedProperty.id).subscribe({next:()=>{this.properties=this.properties.filter(i=>i.id!==this.selectedProperty.id),this.filterProperties();const e=document.getElementById("confirmModal");e&&window.bootstrap.Modal.getInstance(e).hide()},error:e=>{console.error("Deletion failed",e)}})}static{this.\u0275fac=function(i){return new(i||t)(st(ac),st(Ff))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-admin-property-delete-list"]],decls:22,vars:3,consts:[[1,"container","py-4"],[1,"mb-4"],["type","text","placeholder","Search by title",1,"form-control","mb-3",3,"ngModel","ngModelChange","input"],["class","card shadow-sm mb-3",4,"ngFor","ngForOf"],["id","confirmModal","tabindex","-1","aria-labelledby","confirmModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header","bg-danger","text-white"],["id","confirmModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-danger",3,"click"],[1,"card","shadow-sm","mb-3"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"mb-2"],[1,"badge","bg-secondary"],[1,"d-flex","flex-wrap","gap-2"],["class","rounded","style","height: 100px; object-fit: cover;",3,"src",4,"ngFor","ngForOf"],[1,"btn","btn-danger","mt-3",3,"click"],[1,"rounded",2,"height","100px","object-fit","cover",3,"src"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"h2",1),q(2,"Delete Properties"),B(),z(3,"input",2),qt("ngModelChange",function(c){return r.searchTerm=c})("input",function(){return r.filterProperties()}),B(),He(4,vbe,24,6,"div",3),z(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"h5",8),q(10,"Confirm Deletion"),B(),$e(11,"button",9),B(),z(12,"div",10),q(13," Are you sure you want to delete "),z(14,"strong"),q(15),B(),q(16,"? "),B(),z(17,"div",11)(18,"button",12),q(19,"Cancel"),B(),z(20,"button",13),qt("click",function(){return r.AdminDeleteProperty()}),q(21,"Delete"),B()()()()()()),2&i&&(ne(3),ye("ngModel",r.searchTerm),ne(1),ye("ngForOf",r.filteredProperties),ne(11),Qe(null==r.selectedProperty?null:r.selectedProperty.generalinfo.title))},dependencies:[qs,hl,Wl,Wm]})}}return t})();function xbe(t,n){if(1&t){const e=Ki();z(0,"button",14),qt("click",function(){An(e);const r=ht().$implicit;return Mn(ht(2).approve(r.id))}),q(1," Approve "),B()}}function wbe(t,n){if(1&t){const e=Ki();z(0,"button",15),qt("click",function(){An(e);const r=ht().$implicit;return Mn(ht(2).reject(r.id))}),q(1," Reject "),B()}}const kbe=function(t,n,e){return{"status-pending":t,"status-approved":n,"status-rejected":e}};function Mbe(t,n){if(1&t&&(z(0,"tr")(1,"td")(2,"div",8),q(3),B()(),z(4,"td"),q(5),B(),z(6,"td"),q(7),B(),z(8,"td")(9,"div",9),q(10),ks(11,"date"),ks(12,"date"),B()(),z(13,"td")(14,"span",10),q(15),B()(),z(16,"td")(17,"div",11),He(18,xbe,2,0,"button",12),He(19,wbe,2,0,"button",13),B()()()),2&t){const e=n.$implicit;ne(3),Qe(e.propertyTitle),ne(2),Ft(" ",e.name," "),ne(2),Ft(" ",e.phone," "),ne(3),Yt(" ",Iu(11,9,e.startDate)," - ",Iu(12,11,e.endDate)," "),ne(4),ye("ngClass",Pw(13,kbe,"pending"===e.status,"approved"===e.status,"rejected"===e.status)),ne(1),Ft(" ",e.status," "),ne(3),ye("ngIf","pending"===e.status),ne(1),ye("ngIf","pending"===e.status)}}function Cbe(t,n){if(1&t&&(z(0,"table",6)(1,"thead")(2,"tr")(3,"th"),q(4,"Property"),B(),z(5,"th"),q(6,"Name"),B(),z(7,"th"),q(8,"Phone"),B(),z(9,"th"),q(10,"Dates"),B(),z(11,"th"),q(12,"Status"),B(),z(13,"th"),q(14,"Actions"),B()()(),z(15,"tbody"),He(16,Mbe,20,17,"tr",7),B()()),2&t){const e=ht();ne(16),ye("ngForOf",e.bookings)}}function Sbe(t,n){1&t&&(z(0,"div",16)(1,"div",17),q(2,"\u{1f4cb}"),B(),z(3,"div",18),q(4,"No bookings yet"),B(),z(5,"div",19),q(6,"Your property bookings will appear here once guests start making reservations."),B()())}const Ebe=[{path:"login",component:cJ},{path:"register",component:_J},{path:"forgot-password",component:wJ},{path:"verify-email/:token",component:kJ},{path:"property/new",component:_F},{path:"reset-password",component:Zee},{path:"home",component:bte},{path:"property-list",component:Pte},{path:"property/:id",component:Pne},{path:"contact",component:Ine},{path:"about-us",component:One},{path:"service",component:Rne},{path:"owner-dashboard",component:SF},{path:"propertyview",component:Vj},{path:"property/edit/:id",component:_F},{path:"user",component:_2e,canActivate:[EF],children:[{path:"profile",component:Bne},{path:"settings",component:Jne},{path:"my-appointments",component:aie},{path:"my-bookings",component:uie},{path:"messages",component:Vve},{path:"history",component:Vj},{path:"",redirectTo:"profile",pathMatch:"full"}]},{path:"owner",component:SF,canActivate:[EF],children:[{path:"owner-dash",component:ive},{path:"",redirectTo:"owner-dash",pathMatch:"full"},{path:"properties",component:Oie},{path:"calendar",component:bhe},{path:"messages",component:Mve},{path:"bookings",component:(()=>{class t{constructor(e){this.propertyservice=e,this.bookings=[]}ngOnInit(){this.loadBookings()}loadBookings(){this.propertyservice.getownerBookings().subscribe(e=>{this.bookings=e})}approve(e){X_().fire({title:"Approve Booking?",text:"Are you sure you want to approve this booking?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, approve it!",cancelButtonText:"Cancel"}).then(i=>{i.isConfirmed&&this.propertyservice.approveBooking(e).subscribe(()=>{this.loadBookings(),X_().fire("Approved!","The booking has been approved.","success")})})}reject(e){X_().fire({title:"Reject Booking?",text:"Are you sure you want to reject this booking?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, reject it!",cancelButtonText:"Cancel"}).then(i=>{i.isConfirmed&&this.propertyservice.rejectBooking(e).subscribe(()=>{this.loadBookings(),X_().fire("Rejected!","The booking has been rejected.","success")})})}static{this.\u0275fac=function(i){return new(i||t)(st(ac))}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-owner-booking"]],decls:7,vars:2,consts:[[1,"booking-container"],[1,"table-wrapper"],[1,"table-header"],[1,"table-title"],["class","table",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"property-title"],[1,"booking-dates"],[1,"status-badge",3,"ngClass"],[1,"action-buttons"],["class","btn btn-success","type","button",3,"click",4,"ngIf"],["class","btn btn-danger","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"empty-state"],[1,"empty-state-icon"],[1,"empty-state-text"],[1,"empty-state-subtext"]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),q(4,"Property Bookings"),B()(),He(5,Cbe,17,1,"table",4),He(6,Sbe,7,0,"div",5),B()()),2&i&&(ne(5),ye("ngIf",r.bookings&&r.bookings.length>0),ne(1),ye("ngIf",!r.bookings||0===r.bookings.length))},dependencies:[ha,qs,wo,v2],styles:['.booking-container[_ngcontent-%COMP%]{margin:1rem;padding:2rem;font-family:popppins,sans-serif;background:linear-gradient(135deg,#4DB299,#276358);border-radius:1rem;min-height:100vh}.table-wrapper[_ngcontent-%COMP%]{background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:24px;padding:2rem;box-shadow:0 25px 50px -12px #00000040;border:1px solid rgba(255,255,255,.2)}.table-header[_ngcontent-%COMP%]{margin-bottom:2rem}.table-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#1f2937;margin:0;background:linear-gradient(135deg,#4DB299,#3AAFBF);-webkit-text-fill-color:transparent;-webkit-background-clip:text;background-clip:text}.table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;background:transparent;margin:0}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fafc,#e2e8f0)}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1.5rem 1.25rem;font-weight:600;font-size:.875rem;color:#475569;text-transform:uppercase;letter-spacing:.05em;border:none;text-align:left;position:relative}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{border-top-left-radius:16px;border-bottom-left-radius:16px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{border-top-right-radius:16px;border-bottom-right-radius:16px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1);border-bottom:1px solid rgba(226,232,240,.5)}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,rgba(99,102,241,.05),rgba(168,85,247,.05));transform:translateY(-1px);box-shadow:0 10px 25px -5px #0000001a}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1.25rem;vertical-align:middle;border:none;font-size:.95rem;color:#374151;font-weight:500}.property-title[_ngcontent-%COMP%]{font-weight:600;color:#1f2937;font-size:1rem}.booking-dates[_ngcontent-%COMP%]{color:#6b7280;font-size:.9rem;display:flex;align-items:center;gap:.5rem}.booking-dates[_ngcontent-%COMP%]:before{content:"\\1f4c5";font-size:.875rem}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.5rem 1rem;border-radius:50px;font-size:.8rem;font-weight:600;text-transform:capitalize;letter-spacing:.025em;min-width:80px;justify-content:center}.status-pending[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#f59e0b);color:#92400e;box-shadow:0 4px 12px #f59e0b40}.status-approved[_ngcontent-%COMP%]{background:linear-gradient(135deg,#d1fae5,#10b981);color:#065f46;box-shadow:0 4px 12px #10b98140}.status-rejected[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fee2e2,#ef4444);color:#991b1b;box-shadow:0 4px 12px #ef444440}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.btn[_ngcontent-%COMP%]{padding:.625rem 1.25rem;border-radius:12px;border:none;font-weight:600;font-size:.875rem;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);display:inline-flex;align-items:center;justify-content:center;text-decoration:none;position:relative;overflow:hidden}.btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .5s ease}.btn[_ngcontent-%COMP%]:hover:before{left:100%}.btn-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;box-shadow:0 4px 15px #10b98166}.btn-success[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#059669,#047857);transform:translateY(-2px);box-shadow:0 8px 25px #10b98180}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;box-shadow:0 4px 15px #ef444466}.btn-danger[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#dc2626,#b91c1c);transform:translateY(-2px);box-shadow:0 8px 25px #ef444480}.btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#6b7280}.empty-state-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state-text[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:500;margin-bottom:.5rem}.empty-state-subtext[_ngcontent-%COMP%]{font-size:.95rem;opacity:.7}@media (max-width: 768px){.booking-container[_ngcontent-%COMP%]{padding:1rem}.table-wrapper[_ngcontent-%COMP%]{padding:1rem;border-radius:16px}.table-title[_ngcontent-%COMP%]{font-size:2rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem .75rem}.action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.btn[_ngcontent-%COMP%]{width:100%;min-width:unset}}@media (max-width: 640px){.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.table[_ngcontent-%COMP%]{min-width:600px}}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:-200px 0}to{background-position:calc(200px + 100%) 0}}.loading-row[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200px 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite}.btn[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:2px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:focus, .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:-2px}']})}}return t})()}]},{path:"admin",component:F2e,children:[{path:"dashboard",component:G2e},{path:"users",component:X2e},{path:"properties-list",component:_be},{path:"properties",component:bbe},{path:"",redirectTo:"dashboard",pathMatch:"full"}]},{path:"",redirectTo:"/home",pathMatch:"full"}];let jI,Dbe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[XL.forRoot(Ebe),XL]})}}return t})(),Tbe=(()=>{class t{constructor(){this.title="pfe_new"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Xn({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(i,r){1&i&&$e(0,"router-outlet")},dependencies:[T2]})}}return t})();try{jI=typeof Intl<"u"&&Intl.v8BreakIterator}catch{jI=!1}let sM,yy,HI,Bu=(()=>{class t{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function hZ(t){return t===gR}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!jI)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(i){return new(i||t)(Dt(mh))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function J1(t){return function Abe(){if(null==sM&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>sM=!0}))}finally{sM=sM||!1}return sM}()?t:!!t.capture}function Pbe(){if(null==yy){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return yy=!1,yy;if("scrollBehavior"in document.documentElement.style)yy=!0;else{const t=Element.prototype.scrollTo;yy=!!t&&!/\{\s*\[native code\]\s*\}/.test(t.toString())}}return yy}function UI(){let t=typeof document<"u"&&document?document.activeElement:null;for(;t&&t.shadowRoot;){const n=t.shadowRoot.activeElement;if(n===t)break;t=n}return t}function e0(t){return t.composedPath?t.composedPath()[0]:t.target}function qI(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function aM(t,...n){return n.length?n.some(e=>t[e]):t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}function Gj(t){return rd((n,e)=>t<=e)}function Wj(t,n=0){return function Kbe(t){return!isNaN(parseFloat(t))&&!isNaN(Number(t))}(t)?Number(t):n}function _S(t){return Array.isArray(t)?t:[t]}function Zl(t){return null==t?"":"string"==typeof t?t:`${t}px`}function fb(t){return t instanceof ns?t.nativeElement:t}let Qbe=(()=>{class t{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Zj=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[Qbe]})}}return t})();const Yj=new Set;let by,Jbe=(()=>{class t{constructor(e,i){this._platform=e,this._nonce=i,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):txe}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function exe(t,n){if(!Yj.has(t))try{by||(by=document.createElement("style"),n&&(by.nonce=n),by.setAttribute("type","text/css"),document.head.appendChild(by)),by.sheet&&(by.sheet.insertRule(`@media ${t} {body{ }}`,0),Yj.add(t))}catch(e){console.error(e)}}(e,this._nonce),this._matchMedia(e)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Bu),Dt(yx,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function txe(t){return{matches:"all"===t||""===t,media:t,addListener:()=>{},removeListener:()=>{}}}let nxe=(()=>{class t{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new Sn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return Xj(_S(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=f4(Xj(_S(e)).map(c=>this._registerQuery(c).observable));return s=g4(s.pipe(Fu(1)),s.pipe(Gj(1),function $j(t,n=U4){return Lr((e,i)=>{let r=null,s=null,c=null;const f=()=>{if(r){r.unsubscribe(),r=null;const k=s;s=null,i.next(k)}};function y(){const k=c+t,E=n.now();if(E<k)return r=this.schedule(void 0,k-E),void i.add(r);f()}e.subscribe(ui(i,k=>{s=k,c=n.now(),r||(r=n.schedule(y,t),i.add(r))},()=>{f(),i.complete()},void 0,()=>{s=r=null}))})}(0))),s.pipe(zi(c=>{const f={matches:!1,breakpoints:{}};return c.forEach(({matches:y,query:k})=>{f.matches=f.matches||y,f.breakpoints[k]=y}),f}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new Jn(c=>{const f=y=>this._zone.run(()=>c.next(y));return i.addListener(f),()=>{i.removeListener(f)}}).pipe(y4(i),zi(({matches:c})=>({query:e,matches:c})),b4(this._destroySubject)),mql:i};return this._queries.set(e,s),s}static{this.\u0275fac=function(i){return new(i||t)(Dt(Jbe),Dt(Mr))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Xj(t){return t.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}let yS=(()=>{class t{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function axe(t){return!!(t.offsetWidth||t.offsetHeight||"function"==typeof t.getClientRects&&t.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function sxe(t){try{return t.frameElement}catch{return null}}(function mxe(t){return t.ownerDocument&&t.ownerDocument.defaultView||window}(e));if(i&&(-1===eH(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=eH(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function pxe(t){let n=t.nodeName.toLowerCase(),e="input"===n&&t.type;return"text"===e||"password"===e||"select"===n||"textarea"===n}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function fxe(t){return!function cxe(t){return function hxe(t){return"input"==t.nodeName.toLowerCase()}(t)&&"hidden"==t.type}(t)&&(function lxe(t){let n=t.nodeName.toLowerCase();return"input"===n||"select"===n||"button"===n||"textarea"===n}(t)||function dxe(t){return function uxe(t){return"a"==t.nodeName.toLowerCase()}(t)&&t.hasAttribute("href")}(t)||t.hasAttribute("contenteditable")||Jj(t))}(e)&&!this.isDisabled(e)&&(i?.ignoreVisibility||this.isVisible(e))}static{this.\u0275fac=function(i){return new(i||t)(Dt(Bu))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Jj(t){if(!t.hasAttribute("tabindex")||void 0===t.tabIndex)return!1;let n=t.getAttribute("tabindex");return!(!n||isNaN(parseInt(n,10)))}function eH(t){if(!Jj(t))return null;const n=parseInt(t.getAttribute("tabindex")||"",10);return isNaN(n)?-1:n}class tH{get enabled(){return this._enabled}set enabled(n){this._enabled=n,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}constructor(n,e,i,r,s=!1){this._element=n,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}destroy(){const n=this._startAnchor,e=this._endAnchor;n&&(n.removeEventListener("focus",this.startAnchorListener),n.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(n)))})}focusFirstTabbableElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(n)))})}focusLastTabbableElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(n)))})}_getRegionBoundary(n){const e=this._element.querySelectorAll(`[cdk-focus-region-${n}], [cdkFocusRegion${n}], [cdk-focus-${n}]`);return"start"==n?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(n){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return i?.focus(n),!!i}return e.focus(n),!0}return this.focusFirstTabbableElement(n)}focusFirstTabbableElement(n){const e=this._getRegionBoundary("start");return e&&e.focus(n),!!e}focusLastTabbableElement(n){const e=this._getRegionBoundary("end");return e&&e.focus(n),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;const e=n.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;const e=n.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const n=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,n),n.classList.add("cdk-visually-hidden"),n.classList.add("cdk-focus-trap-anchor"),n.setAttribute("aria-hidden","true"),n}_toggleAnchorTabIndex(n,e){n?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(n){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}_executeOnStable(n){this._ngZone.isStable?n():this._ngZone.onStable.pipe(Fu(1)).subscribe(n)}}let $I=(()=>{class t{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new tH(e,this._checker,this._ngZone,this._document,i)}static{this.\u0275fac=function(i){return new(i||t)(Dt(yS),Dt(Mr),Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function nH(t){return 0===t.buttons||0===t.detail}function iH(t){const n=t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}const gxe=new tn("cdk-input-modality-detector-options"),_xe={ignoreKeys:[18,17,224,91,16]},mb=J1({passive:!0,capture:!0});let yxe=(()=>{class t{get mostRecentModality(){return this._modality.value}constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new Is(null),this._lastTouchMs=0,this._onKeydown=c=>{this._options?.ignoreKeys?.some(f=>f===c.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=e0(c))},this._onMousedown=c=>{Date.now()-this._lastTouchMs<650||(this._modality.next(nH(c)?"keyboard":"mouse"),this._mostRecentTarget=e0(c))},this._onTouchstart=c=>{iH(c)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=e0(c))},this._options={..._xe,...s},this.modalityDetected=this._modality.pipe(Gj(1)),this.modalityChanged=this.modalityDetected.pipe(na()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,mb),r.addEventListener("mousedown",this._onMousedown,mb),r.addEventListener("touchstart",this._onTouchstart,mb)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,mb),document.removeEventListener("mousedown",this._onMousedown,mb),document.removeEventListener("touchstart",this._onTouchstart,mb))}static{this.\u0275fac=function(i){return new(i||t)(Dt(Bu),Dt(Mr),Dt(lo),Dt(gxe,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const bxe=new tn("cdk-focus-monitor-default-options"),vS=J1({passive:!0,capture:!0});let bS=(()=>{class t{constructor(e,i,r,s,c){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Sn,this._rootNodeFocusAndBlurListener=f=>{for(let k=e0(f);k;k=k.parentElement)"focus"===f.type?this._onFocus(f,k):this._onBlur(f,k)},this._document=s,this._detectionMode=c?.detectionMode||0}monitor(e,i=!1){const r=fb(e);if(!this._platform.isBrowser||1!==r.nodeType)return Un();const s=function Obe(t){if(function Ibe(){if(null==HI){const t=typeof document<"u"?document.head:null;HI=!(!t||!t.createShadowRoot&&!t.attachShadow)}return HI}()){const n=t.getRootNode?t.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(r)||this._getDocument(),c=this._elementInfo.get(r);if(c)return i&&(c.checkChildren=!0),c.subject;const f={checkChildren:i,subject:new Sn,rootNode:s};return this._elementInfo.set(r,f),this._registerGlobalListeners(f),f.subject}stopMonitoring(e){const i=fb(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=fb(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([f,y])=>this._originChanged(f,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=e0(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,vS),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,vS)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(b4(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,vS),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,vS),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let c=0;c<s.length;c++)if(s[c].contains(i))return!0;return!1}static{this.\u0275fac=function(i){return new(i||t)(Dt(Mr),Dt(Bu),Dt(yxe),Dt(lo,8),Dt(bxe,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const oH="cdk-high-contrast-black-on-white",sH="cdk-high-contrast-white-on-black",GI="cdk-high-contrast-active";let aH=(()=>{class t{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Rn(nxe).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(GI,oH,sH),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(GI,oH):2===i&&e.add(GI,sH)}}static{this.\u0275fac=function(i){return new(i||t)(Dt(Bu),Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),lH=(()=>{class t{constructor(e){e._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(i){return new(i||t)(Dt(aH))}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[Zj]})}}return t})();const xxe=["addListener","removeListener"],wxe=["addEventListener","removeEventListener"],kxe=["on","off"];function WI(t,n,e,i){if(Qi(e)&&(i=e,e=void 0),i)return WI(t,n,e).pipe(MT(i));const[r,s]=function Sxe(t){return Qi(t.addEventListener)&&Qi(t.removeEventListener)}(t)?wxe.map(c=>f=>t[c](n,f,e)):function Mxe(t){return Qi(t.addListener)&&Qi(t.removeListener)}(t)?xxe.map(cH(t,n)):function Cxe(t){return Qi(t.on)&&Qi(t.off)}(t)?kxe.map(cH(t,n)):[];if(!r&&ae(t))return fi(c=>WI(c,n,e))(tt(t));if(!r)throw new TypeError("Invalid event target");return new Jn(c=>{const f=(...y)=>c.next(1<y.length?y:y[0]);return r(f),()=>s(f)})}function cH(t,n){return e=>i=>t[e](n,i)}const lM={schedule(t){let n=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=lM;i&&(n=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=n(s=>{e=void 0,t(s)});return new En(()=>e?.(r))},requestAnimationFrame(...t){const{delegate:n}=lM;return(n?.requestAnimationFrame||requestAnimationFrame)(...t)},cancelAnimationFrame(...t){const{delegate:n}=lM;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...t)},delegate:void 0};new class Dxe extends gA{flush(n){let e;this._active=!0,n?e=n.id:(e=this._scheduled,this._scheduled=void 0);const{actions:i}=this;let r;n=n||i.shift();do{if(r=n.execute(n.state,n.delay))break}while((n=i[0])&&n.id===e&&i.shift());if(this._active=!1,r){for(;(n=i[0])&&n.id===e&&i.shift();)n.unsubscribe();throw r}}}(class Exe extends mA{constructor(n,e){super(n,e),this.scheduler=n,this.work=e}requestAsyncId(n,e,i=0){return null!==i&&i>0?super.requestAsyncId(n,e,i):(n.actions.push(this),n._scheduled||(n._scheduled=lM.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(n,e,i);const{actions:s}=n;null!=e&&e===n._scheduled&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(lM.cancelAnimationFrame(e),n._scheduled=void 0)}});let ZI,Axe=1;const xS={};function dH(t){return t in xS&&(delete xS[t],!0)}const Pxe={setImmediate(t){const n=Axe++;return xS[n]=!0,ZI||(ZI=Promise.resolve()),ZI.then(()=>dH(n)&&t()),n},clearImmediate(t){dH(t)}},{setImmediate:Ixe,clearImmediate:Oxe}=Pxe,wS={setImmediate(...t){const{delegate:n}=wS;return(n?.setImmediate||Ixe)(...t)},clearImmediate(t){const{delegate:n}=wS;return(n?.clearImmediate||Oxe)(t)},delegate:void 0};new class Lxe extends gA{flush(n){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;n=n||i.shift();do{if(r=n.execute(n.state,n.delay))break}while((n=i[0])&&n.id===e&&i.shift());if(this._active=!1,r){for(;(n=i[0])&&n.id===e&&i.shift();)n.unsubscribe();throw r}}}(class Rxe extends mA{constructor(n,e){super(n,e),this.scheduler=n,this.work=e}requestAsyncId(n,e,i=0){return null!==i&&i>0?super.requestAsyncId(n,e,i):(n.actions.push(this),n._scheduled||(n._scheduled=wS.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(n,e,i);const{actions:s}=n;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(wS.clearImmediate(e),n._scheduled===e&&(n._scheduled=void 0))}});function hH(t,n=U4){return function zxe(t){return Lr((n,e)=>{let i=!1,r=null,s=null,c=!1;const f=()=>{if(s?.unsubscribe(),s=null,i){i=!1;const k=r;r=null,e.next(k)}c&&e.complete()},y=()=>{s=null,c&&e.complete()};n.subscribe(ui(e,k=>{i=!0,r=k,s||tt(t(k)).subscribe(s=ui(e,f,y))},()=>{c=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>bF(t,n))}const Nxe=new tn("cdk-dir-doc",{providedIn:"root",factory:function Bxe(){return Rn(lo)}}),Vxe=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let YI=(()=>{class t{constructor(e){this.value="ltr",this.change=new Xi,e&&(this.value=function jxe(t){const n=t?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?Vxe.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((e.body?e.body.dir:null)||(e.documentElement?e.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(i){return new(i||t)(Dt(Nxe,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),cM=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})(),Uxe=(()=>{class t{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new Sn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Jn(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(hH(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Un()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(rd(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=fb(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>WI(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Mr),Dt(Bu),Dt(lo,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),uH=(()=>{class t{constructor(e,i,r){this._platform=e,this._change=new Sn,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(hH(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(i){return new(i||t)(Dt(Bu),Dt(Mr),Dt(lo,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),kS=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})(),pH=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[cM,kS,cM,kS]})}}return t})();class XI{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class KI extends XI{constructor(n,e,i,r,s){super(),this.component=n,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r,this.projectableNodes=s}}class fH extends XI{constructor(n,e,i,r){super(),this.templateRef=n,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(n,e=this.context){return this.context=e,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class $xe extends XI{constructor(n){super(),this.element=n instanceof ns?n.nativeElement:n}}class QI{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof KI?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof fH?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof $xe?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Gxe extends QI{constructor(n,e,i,r,s){super(),this.outletElement=n,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=c=>{const f=c.element,y=this._document.createComment("dom-portal");f.parentNode.insertBefore(y,f),this.outletElement.appendChild(f),this._attachedPortal=c,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(f,y)})},this._document=s}attachComponentPortal(n){const i=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component);let r;return n.viewContainerRef?(r=n.viewContainerRef.createComponent(i,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=i.create(n.injector||this._defaultInjector||ws.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=n,r}attachTemplatePortal(n){let e=n.viewContainerRef,i=e.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=n,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let JI=(()=>{class t extends QI{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Xi,this.attachDomPortal=s=>{const c=s.element,f=this._document.createComment("dom-portal");s.setAttachedHost(this),c.parentNode.insertBefore(f,c),this._getRootNode().appendChild(c),this._attachedPortal=s,super.setDisposeFn(()=>{f.parentNode&&f.parentNode.replaceChild(c,f)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),c=i.createComponent(s,i.length,e.injector||i.injector,e.projectableNodes||void 0);return i!==this._viewContainerRef&&this._getRootNode().appendChild(c.hostView.rootNodes[0]),super.setDisposeFn(()=>c.destroy()),this._attachedPortal=e,this._attachedRef=c,this.attached.emit(c),c}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static{this.\u0275fac=function(i){return new(i||t)(st(wm),st(Ou),st(lo))}}static{this.\u0275dir=gi({type:t,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Kr]})}}return t})(),gb=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})();const mH=Pbe();class Wxe{constructor(n,e){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Zl(-this._previousScrollPosition.left),n.style.top=Zl(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,i=n.style,r=this._document.body.style,s=i.scrollBehavior||"",c=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),mH&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),mH&&(i.scrollBehavior=s,r.scrollBehavior=c)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class Zxe{constructor(n,e,i,r){this._scrollDispatcher=n,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(rd(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class gH{enable(){}disable(){}attach(){}}function e6(t,n){return n.some(e=>t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}function _H(t,n){return n.some(e=>t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)}class Yxe{constructor(n,e,i,r){this._scrollDispatcher=n,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();e6(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Xxe=(()=>{class t{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new gH,this.close=c=>new Zxe(this._scrollDispatcher,this._ngZone,this._viewportRuler,c),this.block=()=>new Wxe(this._viewportRuler,this._document),this.reposition=c=>new Yxe(this._scrollDispatcher,this._viewportRuler,this._ngZone,c),this._document=s}static{this.\u0275fac=function(i){return new(i||t)(Dt(Uxe),Dt(uH),Dt(Mr),Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class yH{constructor(n){if(this.scrollStrategy=new gH,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){const e=Object.keys(n);for(const i of e)void 0!==n[i]&&(this[i]=n[i])}}}class Kxe{constructor(n,e){this.connectionPair=n,this.scrollableViewProperties=e}}let vH=(()=>{class t{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Qxe=(()=>{class t extends vH{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let c=s.length-1;c>-1;c--)if(s[c]._keydownEvents.observers.length>0){const f=s[c]._keydownEvents;this._ngZone?this._ngZone.run(()=>f.next(r)):f.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(Mr,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Jxe=(()=>{class t extends vH{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=e0(s)},this._clickListener=s=>{const c=e0(s),f="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:c;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let k=y.length-1;k>-1;k--){const E=y[k];if(E._outsidePointerEvents.observers.length<1||!E.hasAttached())continue;if(E.overlayElement.contains(c)||E.overlayElement.contains(f))break;const F=E._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>F.next(s)):F.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(Bu),Dt(Mr,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),MS=(()=>{class t{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||qI()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),qI()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(Bu))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class dM{constructor(n,e,i,r,s,c,f,y,k,E=!1){this._portalOutlet=n,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=c,this._document=f,this._location=y,this._outsideClickDispatcher=k,this._animationsDisabled=E,this._backdropElement=null,this._backdropClick=new Sn,this._attachments=new Sn,this._detachments=new Sn,this._locationChanges=En.EMPTY,this._backdropClickHandler=F=>this._backdropClick.next(F),this._backdropTransitionendHandler=F=>{this._disposeBackdrop(F.target)},this._keydownEvents=new Sn,this._outsidePointerEvents=new Sn,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Fu(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof e?.onDestroy&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=Zl(this._config.width),n.height=Zl(this._config.height),n.minWidth=Zl(this._config.minWidth),n.minHeight=Zl(this._config.minHeight),n.maxWidth=Zl(this._config.maxWidth),n.maxHeight=Zl(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const n=this._backdropElement;if(n){if(this._animationsDisabled)return void this._disposeBackdrop(n);n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,e,i){const r=_S(e||[]).filter(s=>!!s);r.length&&(i?n.classList.add(...r):n.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const n=this._ngZone.onStable.pipe(b4(Oo(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const bH="cdk-overlay-connected-position-bounding-box",ewe=/([A-Za-z%]+)$/;class twe{get positions(){return this._preferredPositions}constructor(n,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Sn,this._resizeSubscription=En.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(bH),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let c;for(let f of this._preferredPositions){let y=this._getOriginPoint(n,r,f),k=this._getOverlayPoint(y,e,f),E=this._getOverlayFit(k,e,i,f);if(E.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(f,y);this._canFitWithFlexibleDimensions(E,k,i)?s.push({position:f,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,f)}):(!c||c.overlayFit.visibleArea<E.visibleArea)&&(c={overlayFit:E,overlayPoint:k,originPoint:y,position:f,overlayRect:e})}if(s.length){let f=null,y=-1;for(const k of s){const E=k.boundingBoxRect.width*k.boundingBoxRect.height*(k.position.weight||1);E>y&&(y=E,f=k)}return this._isPushed=!1,void this._applyPosition(f.position,f.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(c.position,c.originPoint);this._applyPosition(c.position,c.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&xy(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(bH),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,e)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,e,i){let r,s;if("center"==i.originX)r=n.left+n.width/2;else{const c=this._isRtl()?n.right:n.left,f=this._isRtl()?n.left:n.right;r="start"==i.originX?c:f}return e.left<0&&(r-=e.left),s="center"==i.originY?n.top+n.height/2:"top"==i.originY?n.top:n.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(n,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:n.x+r,y:n.y+s}}_getOverlayFit(n,e,i,r){const s=wH(e);let{x:c,y:f}=n,y=this._getOffset(r,"x"),k=this._getOffset(r,"y");y&&(c+=y),k&&(f+=k);let $=0-f,W=f+s.height-i.height,re=this._subtractOverflows(s.width,0-c,c+s.width-i.width),he=this._subtractOverflows(s.height,$,W),me=re*he;return{visibleArea:me,isCompletelyWithinViewport:s.width*s.height===me,fitsInViewportVertically:he===s.height,fitsInViewportHorizontally:re==s.width}}_canFitWithFlexibleDimensions(n,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,c=xH(this._overlayRef.getConfig().minHeight),f=xH(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=c&&c<=r)&&(n.fitsInViewportHorizontally||null!=f&&f<=s)}return!1}_pushOverlayOnScreen(n,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const r=wH(e),s=this._viewportRect,c=Math.max(n.x+r.width-s.width,0),f=Math.max(n.y+r.height-s.height,0),y=Math.max(s.top-i.top-n.y,0),k=Math.max(s.left-i.left-n.x,0);let E=0,F=0;return E=r.width<=s.width?k||-c:n.x<this._viewportMargin?s.left-i.left-n.x:0,F=r.height<=s.height?y||-f:n.y<this._viewportMargin?s.top-i.top-n.y:0,this._previousPushAmount={x:E,y:F},{x:n.x+E,y:n.y+F}}_applyPosition(n,e){if(this._setTransformOrigin(n),this._setOverlayElementStyles(e,n),this._setBoundingBoxStyles(e,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._lastPosition=n,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new Kxe(n,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=n.overlayY;i="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(n,e){const i=this._viewportRect,r=this._isRtl();let s,c,f,E,F,$;if("top"===e.overlayY)c=n.y,s=i.height-c+this._viewportMargin;else if("bottom"===e.overlayY)f=i.height-n.y+2*this._viewportMargin,s=i.height-f+this._viewportMargin;else{const W=Math.min(i.bottom-n.y+i.top,n.y),re=this._lastBoundingBoxSize.height;s=2*W,c=n.y-W,s>re&&!this._isInitialRender&&!this._growAfterOpen&&(c=n.y-re/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)$=i.width-n.x+this._viewportMargin,E=n.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)F=n.x,E=i.right-n.x;else{const W=Math.min(i.right-n.x+i.left,n.x),re=this._lastBoundingBoxSize.width;E=2*W,F=n.x-W,E>re&&!this._isInitialRender&&!this._growAfterOpen&&(F=n.x-re/2)}return{top:c,left:F,bottom:f,right:$,width:E,height:s}}_setBoundingBoxStyles(n,e){const i=this._calculateBoundingBoxRect(n,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,c=this._overlayRef.getConfig().maxWidth;r.height=Zl(i.height),r.top=Zl(i.top),r.bottom=Zl(i.bottom),r.width=Zl(i.width),r.left=Zl(i.left),r.right=Zl(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Zl(s)),c&&(r.maxWidth=Zl(c))}this._lastBoundingBoxSize=i,xy(this._boundingBox.style,r)}_resetBoundingBoxStyles(){xy(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){xy(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,c=this._overlayRef.getConfig();if(r){const E=this._viewportRuler.getViewportScrollPosition();xy(i,this._getExactOverlayY(e,n,E)),xy(i,this._getExactOverlayX(e,n,E))}else i.position="static";let f="",y=this._getOffset(e,"x"),k=this._getOffset(e,"y");y&&(f+=`translateX(${y}px) `),k&&(f+=`translateY(${k}px)`),i.transform=f.trim(),c.maxHeight&&(r?i.maxHeight=Zl(c.maxHeight):s&&(i.maxHeight="")),c.maxWidth&&(r?i.maxWidth=Zl(c.maxWidth):s&&(i.maxWidth="")),xy(this._pane.style,i)}_getExactOverlayY(n,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,n);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===n.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Zl(s.y),r}_getExactOverlayX(n,e,i){let c,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,n);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),c=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===c?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Zl(s.x),r}_getScrollVisibility(){const n=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:_H(n,i),isOriginOutsideView:e6(n,i),isOverlayClipped:_H(e,i),isOverlayOutsideView:e6(e,i)}}_subtractOverflows(n,...e){return e.reduce((i,r)=>i-Math.max(r,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+n-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:n-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,e){return"x"===e?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&_S(n).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof ns)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const e=n.width||0,i=n.height||0;return{top:n.y,bottom:n.y+i,left:n.x,right:n.x+e,height:i,width:e}}}function xy(t,n){for(let e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function xH(t){if("number"!=typeof t&&null!=t){const[n,e]=t.split(ewe);return e&&"px"!==e?null:parseFloat(n)}return t||null}function wH(t){return{top:Math.floor(t.top),right:Math.floor(t.right),bottom:Math.floor(t.bottom),left:Math.floor(t.left),width:Math.floor(t.width),height:Math.floor(t.height)}}const kH="cdk-global-overlay-wrapper";class nwe{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){const e=n.getConfig();this._overlayRef=n,this._width&&!e.width&&n.updateSize({width:this._width}),this._height&&!e.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(kH),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:c,maxHeight:f}=i,y=!("100%"!==r&&"100vw"!==r||c&&"100%"!==c&&"100vw"!==c),k=!("100%"!==s&&"100vh"!==s||f&&"100%"!==f&&"100vh"!==f),E=this._xPosition,F=this._xOffset,$="rtl"===this._overlayRef.getConfig().direction;let W="",re="",he="";y?he="flex-start":"center"===E?(he="center",$?re=F:W=F):$?"left"===E||"end"===E?(he="flex-end",W=F):("right"===E||"start"===E)&&(he="flex-start",re=F):"left"===E||"start"===E?(he="flex-start",W=F):("right"===E||"end"===E)&&(he="flex-end",re=F),n.position=this._cssPosition,n.marginLeft=y?"0":W,n.marginTop=k?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=y?"0":re,e.justifyContent=he,e.alignItems=k?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(kH),i.justifyContent=i.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let iwe=(()=>{class t{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new nwe}flexibleConnectedTo(e){return new twe(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static{this.\u0275fac=function(i){return new(i||t)(Dt(uH),Dt(lo),Dt(Bu),Dt(MS))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),rwe=0,t0=(()=>{class t{constructor(e,i,r,s,c,f,y,k,E,F,$,W){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=c,this._injector=f,this._ngZone=y,this._document=k,this._directionality=E,this._location=F,this._outsideClickDispatcher=$,this._animationsModuleType=W}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),c=new yH(e);return c.direction=c.direction||this._directionality.value,new dM(s,i,r,c,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+rwe++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(k1)),new Gxe(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static{this.\u0275fac=function(i){return new(i||t)(Dt(Xxe),Dt(MS),Dt(wm),Dt(iwe),Dt(Qxe),Dt(ws),Dt(Mr),Dt(lo),Dt(YI),Dt(Nw),Dt(Jxe),Dt(r1,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const awe={provide:new tn("cdk-connected-overlay-scroll-strategy"),deps:[t0],useFactory:function swe(t){return()=>t.scrollStrategies.reposition()}};let hM=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[t0,awe],imports:[cM,gb,pH,pH]})}}return t})();const cwe=new tn("mat-sanity-checks",{providedIn:"root",factory:function lwe(){return!0}});let pl=(()=>{class t{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,e._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!qI()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}static{this.\u0275fac=function(i){return new(i||t)(Dt(aH),Dt(cwe,8),Dt(lo))}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[cM,cM]})}}return t})();const hwe=new tn("MAT_DATE_LOCALE",{providedIn:"root",factory:function uwe(){return Rn(Af)}});class qf{constructor(){this._localeChanges=new Sn,this.localeChanges=this._localeChanges}getValidDateOrNull(n){return this.isDateInstance(n)&&this.isValid(n)?n:null}deserialize(n){return null==n||this.isDateInstance(n)&&this.isValid(n)?n:this.invalid()}setLocale(n){this.locale=n,this._localeChanges.next()}compareDate(n,e){return this.getYear(n)-this.getYear(e)||this.getMonth(n)-this.getMonth(e)||this.getDate(n)-this.getDate(e)}sameDate(n,e){if(n&&e){let i=this.isValid(n),r=this.isValid(e);return i&&r?!this.compareDate(n,e):i==r}return n==e}clampDate(n,e,i){return e&&this.compareDate(n,e)<0?e:i&&this.compareDate(n,i)>0?i:n}}const t6=new tn("mat-date-formats"),pwe=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function n6(t,n){const e=Array(t);for(let i=0;i<t;i++)e[i]=n(i);return e}let fwe=(()=>{class t extends qf{constructor(e,i){super(),this.useUtcForDisplay=!1,super.setLocale(e)}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthNames(e){const i=new Intl.DateTimeFormat(this.locale,{month:e,timeZone:"utc"});return n6(12,r=>this._format(i,new Date(2017,r,1)))}getDateNames(){const e=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return n6(31,i=>this._format(e,new Date(2017,0,i+1)))}getDayOfWeekNames(e){const i=new Intl.DateTimeFormat(this.locale,{weekday:e,timeZone:"utc"});return n6(7,r=>this._format(i,new Date(2017,0,r+1)))}getYearName(e){const i=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(i,e)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(e){return this.getDate(this._createDateWithOverflow(this.getYear(e),this.getMonth(e)+1,0))}clone(e){return new Date(e.getTime())}createDate(e,i,r){let s=this._createDateWithOverflow(e,i,r);return s.getMonth(),s}today(){return new Date}parse(e,i){return"number"==typeof e?new Date(e):e?new Date(Date.parse(e)):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");const r=new Intl.DateTimeFormat(this.locale,{...i,timeZone:"utc"});return this._format(r,e)}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){let r=this._createDateWithOverflow(this.getYear(e),this.getMonth(e)+i,this.getDate(e));return this.getMonth(r)!=((this.getMonth(e)+i)%12+12)%12&&(r=this._createDateWithOverflow(this.getYear(r),this.getMonth(r),0)),r}addCalendarDays(e,i){return this._createDateWithOverflow(this.getYear(e),this.getMonth(e),this.getDate(e)+i)}toIso8601(e){return[e.getUTCFullYear(),this._2digit(e.getUTCMonth()+1),this._2digit(e.getUTCDate())].join("-")}deserialize(e){if("string"==typeof e){if(!e)return null;if(pwe.test(e)){let i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(e,i,r){const s=new Date;return s.setFullYear(e,i,r),s.setHours(0,0,0,0),s}_2digit(e){return("00"+e).slice(-2)}_format(e,i){const r=new Date;return r.setUTCFullYear(i.getFullYear(),i.getMonth(),i.getDate()),r.setUTCHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()),e.format(r)}static{this.\u0275fac=function(i){return new(i||t)(Dt(hwe,8),Dt(Bu))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const mwe={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};let gwe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[{provide:qf,useClass:fwe}]})}}return t})(),_we=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[{provide:t6,useValue:mwe}],imports:[gwe]})}}return t})();const SH=J1({passive:!0,capture:!0});class vwe{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const e=e0(n);e&&this._events.get(n.type)?.forEach((i,r)=>{(r===e||r.contains(e))&&i.forEach(s=>s.handleEvent(n))})}}addHandler(n,e,i,r){const s=this._events.get(e);if(s){const c=s.get(i);c?c.add(r):s.set(i,new Set([r]))}else this._events.set(e,new Map([[i,new Set([r])]])),n.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,SH)})}removeHandler(n,e,i){const r=this._events.get(n);if(!r)return;const s=r.get(e);s&&(s.delete(i),0===s.size&&r.delete(e),0===r.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,SH)))}}class CS{static{this._eventManager=new vwe}constructor(n,e,i,r){this._target=n,this._ngZone=e,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=fb(i))}fadeInRipple(n,e,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...EH,...i.animation},c=i.radius||function xwe(t,n,e){const i=Math.max(Math.abs(t-e.left),Math.abs(t-e.right)),r=Math.max(Math.abs(n-e.top),Math.abs(n-e.bottom));return Math.sqrt(i*i+r*r)}(n,e,r),f=n-r.left,y=e-r.top,k=s.enterDuration,E=document.createElement("div");E.classList.add("mat-ripple-element"),E.style.left=f-c+"px",E.style.top=y-c+"px",E.style.height=2*c+"px",E.style.width=2*c+"px",null!=i.color&&(E.style.backgroundColor=i.color),E.style.transitionDuration=`${k}ms`,this._containerElement.appendChild(E);const F=window.getComputedStyle(E),W=F.transitionDuration,re="none"===F.transitionProperty||"0s"===W||"0s, 0s"===W||0===r.width&&0===r.height,he=new ywe(this,E,i,re);E.style.transform="scale3d(1, 1, 1)",he.state=0,i.persistent||(this._mostRecentTransientRipple=he);return!re&&(k||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Pe=()=>this._finishRippleTransition(he),Re=()=>this._destroyRipple(he);E.addEventListener("transitionend",Pe),E.addEventListener("transitioncancel",Re)}),this._activeRipples.set(he,null),(re||!k)&&this._finishRippleTransition(he),he}fadeOutRipple(n){if(2===n.state||3===n.state)return;const e=n.element,i={...EH,...n.config.animation};e.style.transitionDuration=`${i.exitDuration}ms`,e.style.opacity="0",n.state=2,(n._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const e=fb(n);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,TH.forEach(i=>{CS._eventManager.addHandler(this._ngZone,i,e,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{AH.forEach(e=>{this._triggerElement.addEventListener(e,this,DH)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){0===n.state?this._startFadeOutTransition(n):2===n.state&&this._destroyRipple(n)}_startFadeOutTransition(n){const e=n===this._mostRecentTransientRipple,{persistent:i}=n.config;n.state=1,!i&&(!e||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const e=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=3,null!==e&&(n.element.removeEventListener("transitionend",e.onTransitionEnd),n.element.removeEventListener("transitioncancel",e.onTransitionCancel)),n.element.remove()}_onMousedown(n){const e=nH(n),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!i&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!iH(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=n.changedTouches;if(e)for(let i=0;i<e.length;i++)this.fadeInRipple(e[i].clientX,e[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(1===n.state||n.config.terminateOnPointerUp&&0===n.state)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(TH.forEach(e=>CS._eventManager.removeHandler(e,n,this)),this._pointerUpEventsRegistered&&AH.forEach(e=>n.removeEventListener(e,this,DH)))}}let r6=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,pl]})}}return t})(),Mwe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl]})}}return t})(),PH=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[r6,Gm,pl,Mwe]})}}return t})(),o6=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,r6,pl]})}}return t})(),SS=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,Gm,Zj,pl]})}}return t})(),Rwe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({})}}return t})(),Fwe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,SS,SS,Rwe,pl]})}}return t})(),Bwe=(()=>{class t{constructor(){this.changes=new Sn,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(e,i){return`${e} \u2013 ${i}`}formatYearRangeLabel(e,i){return`${e} to ${i}`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const Ywe={provide:new tn("mat-datepicker-scroll-strategy"),deps:[t0],useFactory:function Zwe(t){return()=>t.scrollStrategies.reposition()}};let nke=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[Bwe,Ywe],imports:[Gm,o6,hM,lH,gb,pl,kS]})}}return t})();function FH(t){return new Ht(3e3,!1)}function n0(t){switch(t.length){case 0:return new bk;case 1:return t[0];default:return new CF(t)}}function zH(t,n,e=new Map,i=new Map){const r=[],s=[];let c=-1,f=null;if(n.forEach(y=>{const k=y.get("offset"),E=k==c,F=E&&f||new Map;y.forEach(($,W)=>{let re=W,he=$;if("offset"!==W)switch(re=t.normalizePropertyName(re,r),he){case"!":he=e.get(W);break;case Qm:he=i.get(W);break;default:he=t.normalizeStyleValue(W,re,he,r)}F.set(re,he)}),E||s.push(F),f=F,c=k}),r.length)throw function Cke(t){return new Ht(3502,!1)}();return s}function l6(t,n,e,i){switch(n){case"start":t.onStart(()=>i(e&&c6(e,"start",t)));break;case"done":t.onDone(()=>i(e&&c6(e,"done",t)));break;case"destroy":t.onDestroy(()=>i(e&&c6(e,"destroy",t)))}}function c6(t,n,e){const s=d6(t.element,t.triggerName,t.fromState,t.toState,n||t.phaseName,e.totalTime??t.totalTime,!!e.disabled),c=t._data;return null!=c&&(s._data=c),s}function d6(t,n,e,i,r="",s=0,c){return{element:t,triggerName:n,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!c}}function eu(t,n,e){let i=t.get(n);return i||t.set(n,i=e),i}function NH(t){const n=t.indexOf(":");return[t.substring(1,n),t.slice(n+1)]}const zke=(()=>typeof document>"u"?null:document.documentElement)();function h6(t){const n=t.parentNode||t.host||null;return n===zke?null:n}let wy=null,BH=!1;function VH(t,n){for(;n;){if(n===t)return!0;n=h6(n)}return!1}function jH(t,n,e){if(e)return Array.from(t.querySelectorAll(n));const i=t.querySelector(n);return i?[i]:[]}let HH=(()=>{class t{validateStyleProperty(e){return function Bke(t){wy||(wy=function Vke(){return typeof document<"u"?document.body:null}()||{},BH=!!wy.style&&"WebkitAppearance"in wy.style);let n=!0;return wy.style&&!function Nke(t){return"ebkit"==t.substring(1,6)}(t)&&(n=t in wy.style,!n&&BH&&(n="Webkit"+t.charAt(0).toUpperCase()+t.slice(1)in wy.style)),n}(e)}matchesElement(e,i){return!1}containsElement(e,i){return VH(e,i)}getParentElement(e){return h6(e)}query(e,i,r){return jH(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,c,f=[],y){return new bk(r,s)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})(),u6=(()=>{class t{static{this.NOOP=new HH}}return t})();const jke=1e3,p6="ng-enter",TS="ng-leave",AS="ng-trigger",PS=".ng-trigger",qH="ng-animating",f6=".ng-animating";function gg(t){if("number"==typeof t)return t;const n=t.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:m6(parseFloat(n[1]),n[2])}function m6(t,n){return"s"===n?t*jke:t}function IS(t,n,e){return t.hasOwnProperty("duration")?t:function Uke(t,n,e){let r,s=0,c="";if("string"==typeof t){const f=t.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===f)return n.push(FH()),{duration:0,delay:0,easing:""};r=m6(parseFloat(f[1]),f[2]);const y=f[3];null!=y&&(s=m6(parseFloat(y),f[4]));const k=f[5];k&&(c=k)}else r=t;if(!e){let f=!1,y=n.length;r<0&&(n.push(function ike(){return new Ht(3100,!1)}()),f=!0),s<0&&(n.push(function rke(){return new Ht(3101,!1)}()),f=!0),f&&n.splice(y,0,FH())}return{duration:r,delay:s,easing:c}}(t,n,e)}function fM(t,n={}){return Object.keys(t).forEach(e=>{n[e]=t[e]}),n}function $H(t){const n=new Map;return Object.keys(t).forEach(e=>{n.set(e,t[e])}),n}function r0(t,n=new Map,e){if(e)for(let[i,r]of e)n.set(i,r);for(let[i,r]of t)n.set(i,r);return n}function $f(t,n,e){n.forEach((i,r)=>{const s=_6(r);e&&!e.has(r)&&e.set(r,t.style[s]),t.style[s]=i})}function ky(t,n){n.forEach((e,i)=>{const r=_6(i);t.style[r]=""})}function mM(t){return Array.isArray(t)?1==t.length?t[0]:kF(t):t}const g6=new RegExp("{{\\s*(.+?)\\s*}}","g");function WH(t){let n=[];if("string"==typeof t){let e;for(;e=g6.exec(t);)n.push(e[1]);g6.lastIndex=0}return n}function gM(t,n,e){const i=t.toString(),r=i.replace(g6,(s,c)=>{let f=n[c];return null==f&&(e.push(function ske(t){return new Ht(3003,!1)}()),f=""),f.toString()});return r==i?t:r}function OS(t){const n=[];let e=t.next();for(;!e.done;)n.push(e.value),e=t.next();return n}const Gke=/-+([a-z0-9])/g;function _6(t){return t.replace(Gke,(...n)=>n[1].toUpperCase())}function tu(t,n,e){switch(n.type){case 7:return t.visitTrigger(n,e);case 0:return t.visitState(n,e);case 1:return t.visitTransition(n,e);case 2:return t.visitSequence(n,e);case 3:return t.visitGroup(n,e);case 4:return t.visitAnimate(n,e);case 5:return t.visitKeyframes(n,e);case 6:return t.visitStyle(n,e);case 8:return t.visitReference(n,e);case 9:return t.visitAnimateChild(n,e);case 10:return t.visitAnimateRef(n,e);case 11:return t.visitQuery(n,e);case 12:return t.visitStagger(n,e);default:throw function ake(t){return new Ht(3004,!1)}()}}function ZH(t,n){return window.getComputedStyle(t)[n]}const RS="*";function Yke(t,n){const e=[];return"string"==typeof t?t.split(/\s*,\s*/).forEach(i=>function Xke(t,n,e){if(":"==t[0]){const y=function Kke(t,n){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return n.push(function xke(t){return new Ht(3016,!1)}()),"* => *"}}(t,e);if("function"==typeof y)return void n.push(y);t=y}const i=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function bke(t){return new Ht(3015,!1)}()),n;const r=i[1],s=i[2],c=i[3];n.push(YH(r,c));"<"==s[0]&&!(r==RS&&c==RS)&&n.push(YH(c,r))}(i,e,n)):e.push(t),e}const LS=new Set(["true","1"]),FS=new Set(["false","0"]);function YH(t,n){const e=LS.has(t)||FS.has(t),i=LS.has(n)||FS.has(n);return(r,s)=>{let c=t==RS||t==r,f=n==RS||n==s;return!c&&e&&"boolean"==typeof r&&(c=r?LS.has(t):FS.has(t)),!f&&i&&"boolean"==typeof s&&(f=s?LS.has(n):FS.has(n)),c&&f}}const Qke=new RegExp("s*:selfs*,?","g");function y6(t,n,e,i){return new Jke(t).build(n,e,i)}class Jke{constructor(n){this._driver=n}build(n,e,i){const r=new nMe(e);return this._resetContextStyleTimingState(r),tu(this,mM(n),r)}_resetContextStyleTimingState(n){n.currentQuerySelector="",n.collectedStyles=new Map,n.collectedStyles.set("",new Map),n.currentTime=0}visitTrigger(n,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],c=[];return"@"==n.name.charAt(0)&&e.errors.push(function cke(){return new Ht(3006,!1)}()),n.definitions.forEach(f=>{if(this._resetContextStyleTimingState(e),0==f.type){const y=f,k=y.name;k.toString().split(/\s*,\s*/).forEach(E=>{y.name=E,s.push(this.visitState(y,e))}),y.name=k}else if(1==f.type){const y=this.visitTransition(f,e);i+=y.queryCount,r+=y.depCount,c.push(y)}else e.errors.push(function dke(){return new Ht(3007,!1)}())}),{type:7,name:n.name,states:s,transitions:c,queryCount:i,depCount:r,options:null}}visitState(n,e){const i=this.visitStyle(n.styles,e),r=n.options&&n.options.params||null;if(i.containsDynamicStyles){const s=new Set,c=r||{};i.styles.forEach(f=>{f instanceof Map&&f.forEach(y=>{WH(y).forEach(k=>{c.hasOwnProperty(k)||s.add(k)})})}),s.size&&(OS(s.values()),e.errors.push(function hke(t,n){return new Ht(3008,!1)}()))}return{type:0,name:n.name,style:i,options:r?{params:r}:null}}visitTransition(n,e){e.queryCount=0,e.depCount=0;const i=tu(this,mM(n.animation),e);return{type:1,matchers:Yke(n.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:My(n.options)}}visitSequence(n,e){return{type:2,steps:n.steps.map(i=>tu(this,i,e)),options:My(n.options)}}visitGroup(n,e){const i=e.currentTime;let r=0;const s=n.steps.map(c=>{e.currentTime=i;const f=tu(this,c,e);return r=Math.max(r,e.currentTime),f});return e.currentTime=r,{type:3,steps:s,options:My(n.options)}}visitAnimate(n,e){const i=function rMe(t,n){if(t.hasOwnProperty("duration"))return t;if("number"==typeof t)return v6(IS(t,n).duration,0,"");const e=t;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=v6(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=IS(e,n);return v6(r.duration,r.delay,r.easing)}(n.timings,e.errors);e.currentAnimateTimings=i;let r,s=n.styles?n.styles:Za({});if(5==s.type)r=this.visitKeyframes(s,e);else{let c=n.styles,f=!1;if(!c){f=!0;const k={};i.easing&&(k.easing=i.easing),c=Za(k)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(c,e);y.isEmptyStep=f,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(n,e){const i=this._makeStyleAst(n,e);return this._validateStyleAst(i,e),i}_makeStyleAst(n,e){const i=[],r=Array.isArray(n.styles)?n.styles:[n.styles];for(let f of r)"string"==typeof f?f===Qm?i.push(f):e.errors.push(new Ht(3002,!1)):i.push($H(f));let s=!1,c=null;return i.forEach(f=>{if(f instanceof Map&&(f.has("easing")&&(c=f.get("easing"),f.delete("easing")),!s))for(let y of f.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:c,offset:n.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(n,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),n.styles.forEach(c=>{"string"!=typeof c&&c.forEach((f,y)=>{const k=e.collectedStyles.get(e.currentQuerySelector),E=k.get(y);let F=!0;E&&(s!=r&&s>=E.startTime&&r<=E.endTime&&(e.errors.push(function pke(t,n,e,i,r){return new Ht(3010,!1)}()),F=!1),s=E.startTime),F&&k.set(y,{startTime:s,endTime:r}),e.options&&function $ke(t,n,e){const i=n.params||{},r=WH(t);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function oke(t){return new Ht(3001,!1)}())})}(f,e.options,e.errors)})})}visitKeyframes(n,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function fke(){return new Ht(3011,!1)}()),i;let s=0;const c=[];let f=!1,y=!1,k=0;const E=n.steps.map(Pe=>{const Re=this._makeStyleAst(Pe,e);let rt=null!=Re.offset?Re.offset:function iMe(t){if("string"==typeof t)return null;let n=null;if(Array.isArray(t))t.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;n=parseFloat(i.get("offset")),i.delete("offset")}});else if(t instanceof Map&&t.has("offset")){const e=t;n=parseFloat(e.get("offset")),e.delete("offset")}return n}(Re.styles),ft=0;return null!=rt&&(s++,ft=Re.offset=rt),y=y||ft<0||ft>1,f=f||ft<k,k=ft,c.push(ft),Re});y&&e.errors.push(function mke(){return new Ht(3012,!1)}()),f&&e.errors.push(function gke(){return new Ht(3200,!1)}());const F=n.steps.length;let $=0;s>0&&s<F?e.errors.push(function _ke(){return new Ht(3202,!1)}()):0==s&&($=1/(F-1));const W=F-1,re=e.currentTime,he=e.currentAnimateTimings,me=he.duration;return E.forEach((Pe,Re)=>{const rt=$>0?Re==W?1:$*Re:c[Re],ft=rt*me;e.currentTime=re+he.delay+ft,he.duration=ft,this._validateStyleAst(Pe,e),Pe.offset=rt,i.styles.push(Pe)}),i}visitReference(n,e){return{type:8,animation:tu(this,mM(n.animation),e),options:My(n.options)}}visitAnimateChild(n,e){return e.depCount++,{type:9,options:My(n.options)}}visitAnimateRef(n,e){return{type:10,animation:this.visitReference(n.animation,e),options:My(n.options)}}visitQuery(n,e){const i=e.currentQuerySelector,r=n.options||{};e.queryCount++,e.currentQuery=n;const[s,c]=function eMe(t){const n=!!t.split(/\s*,\s*/).find(e=>":self"==e);return n&&(t=t.replace(Qke,"")),t=t.replace(/@\*/g,PS).replace(/@\w+/g,e=>PS+"-"+e.slice(1)).replace(/:animating/g,f6),[t,n]}(n.selector);e.currentQuerySelector=i.length?i+" "+s:s,eu(e.collectedStyles,e.currentQuerySelector,new Map);const f=tu(this,mM(n.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:c,animation:f,originalSelector:n.selector,options:My(n.options)}}visitStagger(n,e){e.currentQuery||e.errors.push(function yke(){return new Ht(3013,!1)}());const i="full"===n.timings?{duration:0,delay:0,easing:"full"}:IS(n.timings,e.errors,!0);return{type:12,animation:tu(this,mM(n.animation),e),timings:i,options:null}}}class nMe{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function My(t){return t?(t=fM(t)).params&&(t.params=function tMe(t){return t?fM(t):null}(t.params)):t={},t}function v6(t,n,e){return{duration:t,delay:n,easing:e}}function b6(t,n,e,i,r,s,c=null,f=!1){return{type:1,element:t,keyframes:n,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:c,subTimeline:f}}class zS{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,e){let i=this._map.get(n);i||this._map.set(n,i=[]),i.push(...e)}has(n){return this._map.has(n)}clear(){this._map.clear()}}const aMe=new RegExp(":enter","g"),cMe=new RegExp(":leave","g");function x6(t,n,e,i,r,s=new Map,c=new Map,f,y,k=[]){return(new dMe).buildKeyframes(t,n,e,i,r,s,c,f,y,k)}class dMe{buildKeyframes(n,e,i,r,s,c,f,y,k,E=[]){k=k||new zS;const F=new w6(n,e,k,r,s,E,[]);F.options=y;const $=y.delay?gg(y.delay):0;F.currentTimeline.delayNextStep($),F.currentTimeline.setStyles([c],null,F.errors,y),tu(this,i,F);const W=F.timelines.filter(re=>re.containsAnimation());if(W.length&&f.size){let re;for(let he=W.length-1;he>=0;he--){const me=W[he];if(me.element===e){re=me;break}}re&&!re.allowOnlyTimelineStyles()&&re.setStyles([f],null,F.errors,y)}return W.length?W.map(re=>re.buildKeyframes()):[b6(e,[],[],[],0,$,"",!1)]}visitTrigger(n,e){}visitState(n,e){}visitTransition(n,e){}visitAnimateChild(n,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(n.options),s=e.currentTimeline.currentTime,c=this._visitSubInstructions(i,r,r.options);s!=c&&e.transformIntoNewTimeline(c)}e.previousNode=n}visitAnimateRef(n,e){const i=e.createSubContext(n.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],e,i),this.visitReference(n.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=n}_applyAnimationRefDelays(n,e,i){for(const r of n){const s=r?.delay;if(s){const c="number"==typeof s?s:gg(gM(s,r?.params??{},e.errors));i.delayNextStep(c)}}}_visitSubInstructions(n,e,i){let s=e.currentTimeline.currentTime;const c=null!=i.duration?gg(i.duration):null,f=null!=i.delay?gg(i.delay):null;return 0!==c&&n.forEach(y=>{const k=e.appendInstructionToTimeline(y,c,f);s=Math.max(s,k.duration+k.delay)}),s}visitReference(n,e){e.updateOptions(n.options,!0),tu(this,n.animation,e),e.previousNode=n}visitSequence(n,e){const i=e.subContextCount;let r=e;const s=n.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=NS);const c=gg(s.delay);r.delayNextStep(c)}n.steps.length&&(n.steps.forEach(c=>tu(this,c,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=n}visitGroup(n,e){const i=[];let r=e.currentTimeline.currentTime;const s=n.options&&n.options.delay?gg(n.options.delay):0;n.steps.forEach(c=>{const f=e.createSubContext(n.options);s&&f.delayNextStep(s),tu(this,c,f),r=Math.max(r,f.currentTimeline.currentTime),i.push(f.currentTimeline)}),i.forEach(c=>e.currentTimeline.mergeTimelineCollectedStyles(c)),e.transformIntoNewTimeline(r),e.previousNode=n}_visitTiming(n,e){if(n.dynamic){const i=n.strValue;return IS(e.params?gM(i,e.params,e.errors):i,e.errors)}return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,e){const i=e.currentAnimateTimings=this._visitTiming(n.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=n.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=n}visitStyle(n,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||n.easing;n.isEmptyStep?i.applyEmptyStep(s):i.setStyles(n.styles,s,e.errors,e.options),e.previousNode=n}visitKeyframes(n,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,f=e.createSubContext().currentTimeline;f.easing=i.easing,n.styles.forEach(y=>{f.forwardTime((y.offset||0)*s),f.setStyles(y.styles,y.easing,e.errors,e.options),f.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(f),e.transformIntoNewTimeline(r+s),e.previousNode=n}visitQuery(n,e){const i=e.currentTimeline.currentTime,r=n.options||{},s=r.delay?gg(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=NS);let c=i;const f=e.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=f.length;let y=null;f.forEach((k,E)=>{e.currentQueryIndex=E;const F=e.createSubContext(n.options,k);s&&F.delayNextStep(s),k===e.element&&(y=F.currentTimeline),tu(this,n.animation,F),F.currentTimeline.applyStylesToKeyframe(),c=Math.max(c,F.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(c),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=n}visitStagger(n,e){const i=e.parentContext,r=e.currentTimeline,s=n.timings,c=Math.abs(s.duration),f=c*(e.currentQueryTotal-1);let y=c*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=f-y;break;case"full":y=i.currentStaggerTime}const E=e.currentTimeline;y&&E.delayNextStep(y);const F=E.currentTime;tu(this,n.animation,e),e.previousNode=n,i.currentStaggerTime=r.currentTime-F+(r.startTime-i.currentTimeline.startTime)}}const NS={};class w6{constructor(n,e,i,r,s,c,f,y){this._driver=n,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=c,this.timelines=f,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=NS,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new BS(this._driver,e,0),f.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,e){if(!n)return;const i=n;let r=this.options;null!=i.duration&&(r.duration=gg(i.duration)),null!=i.delay&&(r.delay=gg(i.delay));const s=i.params;if(s){let c=r.params;c||(c=this.options.params={}),Object.keys(s).forEach(f=>{(!e||!c.hasOwnProperty(f))&&(c[f]=gM(s[f],c,this.errors))})}}_copyOptions(){const n={};if(this.options){const e=this.options.params;if(e){const i=n.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return n}createSubContext(n=null,e,i){const r=e||this.element,s=new w6(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(n),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(n){return this.previousNode=NS,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,e,i){const r={duration:e??n.duration,delay:this.currentTimeline.currentTime+(i??0)+n.delay,easing:""},s=new hMe(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,r,n.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,e,i,r,s,c){let f=[];if(r&&f.push(this.element),n.length>0){n=(n=n.replace(aMe,"."+this._enterClassName)).replace(cMe,"."+this._leaveClassName);let k=this._driver.query(this.element,n,1!=i);0!==i&&(k=i<0?k.slice(k.length+i,k.length):k.slice(0,i)),f.push(...k)}return!s&&0==f.length&&c.push(function vke(t){return new Ht(3014,!1)}()),f}}class BS{constructor(n,e,i,r){this._driver=n,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+n),e&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,e){return this.applyStylesToKeyframe(),new BS(this._driver,n,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,e){this._localTimelineStyles.set(n,e),this._globalTimelineStyles.set(n,e),this._styleSummary.set(n,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Qm),this._currentKeyframe.set(e,Qm);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,e,i,r){e&&this._previousKeyframe.set("easing",e);const s=r&&r.params||{},c=function uMe(t,n){const e=new Map;let i;return t.forEach(r=>{if("*"===r){i=i||n.keys();for(let s of i)e.set(s,Qm)}else r0(r,e)}),e}(n,this._globalTimelineStyles);for(let[f,y]of c){const k=gM(y,s,i);this._pendingStyles.set(f,k),this._localTimelineStyles.has(f)||this._backFill.set(f,this._globalTimelineStyles.get(f)??Qm),this._updateStyle(f,k)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((n,e)=>{this._currentKeyframe.set(e,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,n)}))}snapshotCurrentStyles(){for(let[n,e]of this._localTimelineStyles)this._pendingStyles.set(n,e),this._updateStyle(n,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const n=[];for(let e in this._currentKeyframe)n.push(e);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const n=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((f,y)=>{const k=r0(f,new Map,this._backFill);k.forEach((E,F)=>{"!"===E?n.add(F):E===Qm&&e.add(F)}),i||k.set("offset",y/this.duration),r.push(k)});const s=n.size?OS(n.values()):[],c=e.size?OS(e.values()):[];if(i){const f=r[0],y=new Map(f);f.set("offset",0),y.set("offset",1),r=[f,y]}return b6(this.element,r,s,c,this.duration,this.startTime,this.easing,!1)}}class hMe extends BS{constructor(n,e,i,r,s,c,f=!1){super(n,e,c.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=f,this.timings={duration:c.duration,delay:c.delay,easing:c.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],c=i+e,f=e/c,y=r0(n[0]);y.set("offset",0),s.push(y);const k=r0(n[0]);k.set("offset",QH(f)),s.push(k);const E=n.length-1;for(let F=1;F<=E;F++){let $=r0(n[F]);const W=$.get("offset");$.set("offset",QH((e+W*i)/c)),s.push($)}i=c,e=0,r="",n=s}return b6(this.element,n,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function QH(t,n=3){const e=Math.pow(10,n-1);return Math.round(t*e)/e}class k6{}const pMe=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class fMe extends k6{normalizePropertyName(n,e){return _6(n)}normalizeStyleValue(n,e,i,r){let s="";const c=i.toString().trim();if(pMe.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const f=i.match(/^[+-]?[\d\.]+([a-z]*)$/);f&&0==f[1].length&&r.push(function lke(t,n){return new Ht(3005,!1)}())}return c+s}}function JH(t,n,e,i,r,s,c,f,y,k,E,F,$){return{type:0,element:t,triggerName:n,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:c,timelines:f,queriedElements:y,preStyleProps:k,postStyleProps:E,totalTime:F,errors:$}}const M6={};class eU{constructor(n,e,i){this._triggerName=n,this.ast=e,this._stateStyles=i}match(n,e,i,r){return function mMe(t,n,e,i,r){return t.some(s=>s(n,e,i,r))}(this.ast.matchers,n,e,i,r)}buildStyles(n,e,i){let r=this._stateStyles.get("*");return void 0!==n&&(r=this._stateStyles.get(n?.toString())||r),r?r.buildStyles(e,i):new Map}build(n,e,i,r,s,c,f,y,k,E){const F=[],$=this.ast.options&&this.ast.options.params||M6,re=this.buildStyles(i,f&&f.params||M6,F),he=y&&y.params||M6,me=this.buildStyles(r,he,F),Pe=new Set,Re=new Map,rt=new Map,ft="void"===r,Ct={params:gMe(he,$),delay:this.ast.options?.delay},Vt=E?[]:x6(n,e,this.ast.animation,s,c,re,me,Ct,k,F);let sn=0;if(Vt.forEach(Vn=>{sn=Math.max(Vn.duration+Vn.delay,sn)}),F.length)return JH(e,this._triggerName,i,r,ft,re,me,[],[],Re,rt,sn,F);Vt.forEach(Vn=>{const Hi=Vn.element,fr=eu(Re,Hi,new Set);Vn.preStyleProps.forEach(va=>fr.add(va));const Or=eu(rt,Hi,new Set);Vn.postStyleProps.forEach(va=>Or.add(va)),Hi!==e&&Pe.add(Hi)});const Qt=OS(Pe.values());return JH(e,this._triggerName,i,r,ft,re,me,Vt,Qt,Re,rt,sn)}}function gMe(t,n){const e=fM(n);for(const i in t)t.hasOwnProperty(i)&&null!=t[i]&&(e[i]=t[i]);return e}class _Me{constructor(n,e,i){this.styles=n,this.defaultParams=e,this.normalizer=i}buildStyles(n,e){const i=new Map,r=fM(this.defaultParams);return Object.keys(n).forEach(s=>{const c=n[s];null!==c&&(r[s]=c)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((c,f)=>{c&&(c=gM(c,r,e));const y=this.normalizer.normalizePropertyName(f,e);c=this.normalizer.normalizeStyleValue(f,y,c,e),i.set(f,c)})}),i}}class vMe{constructor(n,e,i){this.name=n,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new _Me(r.style,r.options&&r.options.params||{},i))}),tU(this.states,"true","1"),tU(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new eU(n,r,this.states))}),this.fallbackTransition=function bMe(t,n,e){return new eU(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[(c,f)=>!0],options:null,queryCount:0,depCount:0},n)}(n,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,e,i,r){return this.transitionFactories.find(c=>c.match(n,e,i,r))||null}matchStyles(n,e,i){return this.fallbackTransition.buildStyles(n,e,i)}}function tU(t,n,e){t.has(n)?t.has(e)||t.set(e,t.get(n)):t.has(e)&&t.set(n,t.get(e))}const xMe=new zS;class wMe{constructor(n,e,i){this.bodyNode=n,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,e){const i=[],s=y6(this._driver,e,i,[]);if(i.length)throw function Ske(t){return new Ht(3503,!1)}();this._animations.set(n,s)}_buildPlayer(n,e,i){const r=n.element,s=zH(this._normalizer,n.keyframes,e,i);return this._driver.animate(r,s,n.duration,n.delay,n.easing,[],!0)}create(n,e,i={}){const r=[],s=this._animations.get(n);let c;const f=new Map;if(s?(c=x6(this._driver,e,s,p6,TS,new Map,new Map,i,xMe,r),c.forEach(E=>{const F=eu(f,E.element,new Map);E.postStyleProps.forEach($=>F.set($,null))})):(r.push(function Eke(){return new Ht(3300,!1)}()),c=[]),r.length)throw function Dke(t){return new Ht(3504,!1)}();f.forEach((E,F)=>{E.forEach(($,W)=>{E.set(W,this._driver.computeStyle(F,W,Qm))})});const k=n0(c.map(E=>{const F=f.get(E.element);return this._buildPlayer(E,new Map,F)}));return this._playersById.set(n,k),k.onDestroy(()=>this.destroy(n)),this.players.push(k),k}destroy(n){const e=this._getPlayer(n);e.destroy(),this._playersById.delete(n);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(n){const e=this._playersById.get(n);if(!e)throw function Tke(t){return new Ht(3301,!1)}();return e}listen(n,e,i,r){const s=d6(e,"","","");return l6(this._getPlayer(n),i,s,r),()=>{}}command(n,e,i,r){if("register"==i)return void this.register(n,r[0]);if("create"==i)return void this.create(n,e,r[0]||{});const s=this._getPlayer(n);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(n)}}}const nU="ng-animate-queued",C6="ng-animate-disabled",EMe=[],iU={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},DMe={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Pp="__ng_removed";class S6{get params(){return this.options.params}constructor(n,e=""){this.namespaceId=e;const i=n&&n.hasOwnProperty("value");if(this.value=function IMe(t){return t??null}(i?n.value:n),i){const s=fM(n);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){const e=n.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const _M="void",E6=new S6(_M);class TMe{constructor(n,e,i){this.id=n,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,Vu(e,this._hostClassName)}listen(n,e,i,r){if(!this._triggers.has(e))throw function Ake(t,n){return new Ht(3302,!1)}();if(null==i||0==i.length)throw function Pke(t){return new Ht(3303,!1)}();if(!function OMe(t){return"start"==t||"done"==t}(i))throw function Ike(t,n){return new Ht(3400,!1)}();const s=eu(this._elementListeners,n,[]),c={name:e,phase:i,callback:r};s.push(c);const f=eu(this._engine.statesByElement,n,new Map);return f.has(e)||(Vu(n,AS),Vu(n,AS+"-"+e),f.set(e,E6)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(c);y>=0&&s.splice(y,1),this._triggers.has(e)||f.delete(e)})}}register(n,e){return!this._triggers.has(n)&&(this._triggers.set(n,e),!0)}_getTrigger(n){const e=this._triggers.get(n);if(!e)throw function Oke(t){return new Ht(3401,!1)}();return e}trigger(n,e,i,r=!0){const s=this._getTrigger(e),c=new D6(this.id,e,n);let f=this._engine.statesByElement.get(n);f||(Vu(n,AS),Vu(n,AS+"-"+e),this._engine.statesByElement.set(n,f=new Map));let y=f.get(e);const k=new S6(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&k.absorbOptions(y.options),f.set(e,k),y||(y=E6),k.value!==_M&&y.value===k.value){if(!function FMe(t,n){const e=Object.keys(t),i=Object.keys(n);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!n.hasOwnProperty(s)||t[s]!==n[s])return!1}return!0}(y.params,k.params)){const he=[],me=s.matchStyles(y.value,y.params,he),Pe=s.matchStyles(k.value,k.params,he);he.length?this._engine.reportError(he):this._engine.afterFlush(()=>{ky(n,me),$f(n,Pe)})}return}const $=eu(this._engine.playersByElement,n,[]);$.forEach(he=>{he.namespaceId==this.id&&he.triggerName==e&&he.queued&&he.destroy()});let W=s.matchTransition(y.value,k.value,n,k.params),re=!1;if(!W){if(!r)return;W=s.fallbackTransition,re=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:e,transition:W,fromState:y,toState:k,player:c,isFallbackTransition:re}),re||(Vu(n,nU),c.onStart(()=>{yb(n,nU)})),c.onDone(()=>{let he=this.players.indexOf(c);he>=0&&this.players.splice(he,1);const me=this._engine.playersByElement.get(n);if(me){let Pe=me.indexOf(c);Pe>=0&&me.splice(Pe,1)}}),this.players.push(c),$.push(c),c}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(e=>e.delete(n)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);const e=this._engine.playersByElement.get(n);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,e){const i=this._engine.driver.query(n,PS,!0);i.forEach(r=>{if(r[Pp])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(c=>c.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(n,e,i,r){const s=this._engine.statesByElement.get(n),c=new Map;if(s){const f=[];if(s.forEach((y,k)=>{if(c.set(k,y.value),this._triggers.has(k)){const E=this.trigger(n,k,_M,r);E&&f.push(E)}}),f.length)return this._engine.markElementAsRemoved(this.id,n,!0,e,c),i&&n0(f).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){const e=this._elementListeners.get(n),i=this._engine.statesByElement.get(n);if(e&&i){const r=new Set;e.forEach(s=>{const c=s.name;if(r.has(c))return;r.add(c);const y=this._triggers.get(c).fallbackTransition,k=i.get(c)||E6,E=new S6(_M),F=new D6(this.id,c,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:c,transition:y,fromState:k,toState:E,player:F,isFallbackTransition:!0})})}}removeNode(n,e){const i=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,e),this.triggerLeaveAnimation(n,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(n):[];if(s&&s.length)r=!0;else{let c=n;for(;c=c.parentNode;)if(i.statesByElement.get(c)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(n),r)i.markElementAsRemoved(this.id,n,!1,e);else{const s=n[Pp];(!s||s===iU)&&(i.afterFlush(()=>this.clearElementCache(n)),i.destroyInnerAnimations(n),i._onRemovalComplete(n,e))}}insertNode(n,e){Vu(n,this._hostClassName)}drainQueuedTransitions(n){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,c=this._elementListeners.get(s);c&&c.forEach(f=>{if(f.name==i.triggerName){const y=d6(s,i.triggerName,i.fromState.value,i.toState.value);y._data=n,l6(i.player,f.phase,y,f.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,c=r.transition.ast.depCount;return 0==s||0==c?s-c:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(n){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}}class AMe{_onRemovalComplete(n,e){this.onRemovalComplete(n,e)}constructor(n,e,i){this.bodyNode=n,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){const n=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&n.push(i)})}),n}createNamespace(n,e){const i=new TMe(n,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[n]=i}_balanceNamespaceList(n,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let c=!1,f=this.driver.getParentElement(e);for(;f;){const y=r.get(f);if(y){const k=i.indexOf(y);i.splice(k+1,0,n),c=!0;break}f=this.driver.getParentElement(f)}c||i.unshift(n)}else i.push(n);return r.set(e,n),n}register(n,e){let i=this._namespaceLookup[n];return i||(i=this.createNamespace(n,e)),i}registerTrigger(n,e,i){let r=this._namespaceLookup[n];r&&r.register(e,i)&&this.totalAnimations++}destroy(n,e){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const i=this._fetchNamespace(n);this.namespacesByHostElement.delete(i.hostElement);const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(e),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){const e=new Set,i=this.statesByElement.get(n);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(n,e,i,r){if(VS(e)){const s=this._fetchNamespace(n);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(n,e,i,r){if(!VS(e))return;const s=e[Pp];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const c=this.collectedLeaveElements.indexOf(e);c>=0&&this.collectedLeaveElements.splice(c,1)}if(n){const c=this._fetchNamespace(n);c&&c.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,e){e?this.disabledNodes.has(n)||(this.disabledNodes.add(n),Vu(n,C6)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),yb(n,C6))}removeNode(n,e,i){if(VS(e)){const r=n?this._fetchNamespace(n):null;r?r.removeNode(e,i):this.markElementAsRemoved(n,e,!1,i);const s=this.namespacesByHostElement.get(e);s&&s.id!==n&&s.removeNode(e,i)}else this._onRemovalComplete(e,i)}markElementAsRemoved(n,e,i,r,s){this.collectedLeaveElements.push(e),e[Pp]={namespaceId:n,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(n,e,i,r,s){return VS(e)?this._fetchNamespace(n).listen(e,i,r,s):()=>{}}_buildInstruction(n,e,i,r,s){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,i,r,n.fromState.options,n.toState.options,e,s)}destroyInnerAnimations(n){let e=this.driver.query(n,PS,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(n,f6,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(n){const e=this.playersByElement.get(n);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(n){const e=this.playersByQueriedElement.get(n);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return n0(this.players).onDone(()=>n());n()})}processLeaveNode(n){const e=n[Pp];if(e&&e.setForRemoval){if(n[Pp]=iU,e.namespaceId){this.destroyInnerAnimations(n);const i=this._fetchNamespace(e.namespaceId);i&&i.clearElementCache(n)}this._onRemovalComplete(n,e.setForRemoval)}n.classList?.contains(C6)&&this.markElementAsDisabled(n,!1),this.driver.query(n,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(n=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Vu(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,n)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?n0(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(n){throw function Rke(t){return new Ht(3402,!1)}()}_flushAnimations(n,e){const i=new zS,r=[],s=new Map,c=[],f=new Map,y=new Map,k=new Map,E=new Set;this.disabledNodes.forEach(zn=>{E.add(zn);const Zn=this.driver.query(zn,".ng-animate-queued",!0);for(let Oi=0;Oi<Zn.length;Oi++)E.add(Zn[Oi])});const F=this.bodyNode,$=Array.from(this.statesByElement.keys()),W=sU($,this.collectedEnterElements),re=new Map;let he=0;W.forEach((zn,Zn)=>{const Oi=p6+he++;re.set(Zn,Oi),zn.forEach(sr=>Vu(sr,Oi))});const me=[],Pe=new Set,Re=new Set;for(let zn=0;zn<this.collectedLeaveElements.length;zn++){const Zn=this.collectedLeaveElements[zn],Oi=Zn[Pp];Oi&&Oi.setForRemoval&&(me.push(Zn),Pe.add(Zn),Oi.hasAnimation?this.driver.query(Zn,".ng-star-inserted",!0).forEach(sr=>Pe.add(sr)):Re.add(Zn))}const rt=new Map,ft=sU($,Array.from(Pe));ft.forEach((zn,Zn)=>{const Oi=TS+he++;rt.set(Zn,Oi),zn.forEach(sr=>Vu(sr,Oi))}),n.push(()=>{W.forEach((zn,Zn)=>{const Oi=re.get(Zn);zn.forEach(sr=>yb(sr,Oi))}),ft.forEach((zn,Zn)=>{const Oi=rt.get(Zn);zn.forEach(sr=>yb(sr,Oi))}),me.forEach(zn=>{this.processLeaveNode(zn)})});const Ct=[],Vt=[];for(let zn=this._namespaceList.length-1;zn>=0;zn--)this._namespaceList[zn].drainQueuedTransitions(e).forEach(Oi=>{const sr=Oi.player,ba=Oi.element;if(Ct.push(sr),this.collectedEnterElements.length){const Pd=ba[Pp];if(Pd&&Pd.setForMove){if(Pd.previousTriggersValues&&Pd.previousTriggersValues.has(Oi.triggerName)){const Sy=Pd.previousTriggersValues.get(Oi.triggerName),ju=this.statesByElement.get(Oi.element);if(ju&&ju.has(Oi.triggerName)){const WS=ju.get(Oi.triggerName);WS.value=Sy,ju.set(Oi.triggerName,WS)}}return void sr.destroy()}}const th=!F||!this.driver.containsElement(F,ba),Yl=rt.get(ba),Eh=re.get(ba),as=this._buildInstruction(Oi,i,Eh,Yl,th);if(as.errors&&as.errors.length)return void Vt.push(as);if(th)return sr.onStart(()=>ky(ba,as.fromStyles)),sr.onDestroy(()=>$f(ba,as.toStyles)),void r.push(sr);if(Oi.isFallbackTransition)return sr.onStart(()=>ky(ba,as.fromStyles)),sr.onDestroy(()=>$f(ba,as.toStyles)),void r.push(sr);const o0=[];as.timelines.forEach(Pd=>{Pd.stretchStartingKeyframe=!0,this.disabledNodes.has(Pd.element)||o0.push(Pd)}),as.timelines=o0,i.append(ba,as.timelines),c.push({instruction:as,player:sr,element:ba}),as.queriedElements.forEach(Pd=>eu(f,Pd,[]).push(sr)),as.preStyleProps.forEach((Pd,Sy)=>{if(Pd.size){let ju=y.get(Sy);ju||y.set(Sy,ju=new Set),Pd.forEach((WS,F6)=>ju.add(F6))}}),as.postStyleProps.forEach((Pd,Sy)=>{let ju=k.get(Sy);ju||k.set(Sy,ju=new Set),Pd.forEach((WS,F6)=>ju.add(F6))})});if(Vt.length){const zn=[];Vt.forEach(Zn=>{zn.push(function Lke(t,n){return new Ht(3505,!1)}())}),Ct.forEach(Zn=>Zn.destroy()),this.reportError(zn)}const sn=new Map,Qt=new Map;c.forEach(zn=>{const Zn=zn.element;i.has(Zn)&&(Qt.set(Zn,Zn),this._beforeAnimationBuild(zn.player.namespaceId,zn.instruction,sn))}),r.forEach(zn=>{const Zn=zn.element;this._getPreviousPlayers(Zn,!1,zn.namespaceId,zn.triggerName,null).forEach(sr=>{eu(sn,Zn,[]).push(sr),sr.destroy()})});const Vn=me.filter(zn=>lU(zn,y,k)),Hi=new Map;oU(Hi,this.driver,Re,k,Qm).forEach(zn=>{lU(zn,y,k)&&Vn.push(zn)});const Or=new Map;W.forEach((zn,Zn)=>{oU(Or,this.driver,new Set(zn),y,"!")}),Vn.forEach(zn=>{const Zn=Hi.get(zn),Oi=Or.get(zn);Hi.set(zn,new Map([...Zn?.entries()??[],...Oi?.entries()??[]]))});const va=[],Ad=[],ss={};c.forEach(zn=>{const{element:Zn,player:Oi,instruction:sr}=zn;if(i.has(Zn)){if(E.has(Zn))return Oi.onDestroy(()=>$f(Zn,sr.toStyles)),Oi.disabled=!0,Oi.overrideTotalTime(sr.totalTime),void r.push(Oi);let ba=ss;if(Qt.size>1){let Yl=Zn;const Eh=[];for(;Yl=Yl.parentNode;){const as=Qt.get(Yl);if(as){ba=as;break}Eh.push(Yl)}Eh.forEach(as=>Qt.set(as,ba))}const th=this._buildAnimation(Oi.namespaceId,sr,sn,s,Or,Hi);if(Oi.setRealPlayer(th),ba===ss)va.push(Oi);else{const Yl=this.playersByElement.get(ba);Yl&&Yl.length&&(Oi.parentPlayer=n0(Yl)),r.push(Oi)}}else ky(Zn,sr.fromStyles),Oi.onDestroy(()=>$f(Zn,sr.toStyles)),Ad.push(Oi),E.has(Zn)&&r.push(Oi)}),Ad.forEach(zn=>{const Zn=s.get(zn.element);if(Zn&&Zn.length){const Oi=n0(Zn);zn.setRealPlayer(Oi)}}),r.forEach(zn=>{zn.parentPlayer?zn.syncPlayerEvents(zn.parentPlayer):zn.destroy()});for(let zn=0;zn<me.length;zn++){const Zn=me[zn],Oi=Zn[Pp];if(yb(Zn,TS),Oi&&Oi.hasAnimation)continue;let sr=[];if(f.size){let th=f.get(Zn);th&&th.length&&sr.push(...th);let Yl=this.driver.query(Zn,f6,!0);for(let Eh=0;Eh<Yl.length;Eh++){let as=f.get(Yl[Eh]);as&&as.length&&sr.push(...as)}}const ba=sr.filter(th=>!th.destroyed);ba.length?RMe(this,Zn,ba):this.processLeaveNode(Zn)}return me.length=0,va.forEach(zn=>{this.players.push(zn),zn.onDone(()=>{zn.destroy();const Zn=this.players.indexOf(zn);this.players.splice(Zn,1)}),zn.play()}),va}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,e,i,r,s){let c=[];if(e){const f=this.playersByQueriedElement.get(n);f&&(c=f)}else{const f=this.playersByElement.get(n);if(f){const y=!s||s==_M;f.forEach(k=>{k.queued||!y&&k.triggerName!=r||c.push(k)})}}return(i||r)&&(c=c.filter(f=>!(i&&i!=f.namespaceId||r&&r!=f.triggerName))),c}_beforeAnimationBuild(n,e,i){const s=e.element,c=e.isRemovalTransition?void 0:n,f=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const k=y.element,E=k!==s,F=eu(i,k,[]);this._getPreviousPlayers(k,E,c,f,e.toState).forEach(W=>{const re=W.getRealPlayer();re.beforeDestroy&&re.beforeDestroy(),W.destroy(),F.push(W)})}ky(s,e.fromStyles)}_buildAnimation(n,e,i,r,s,c){const f=e.triggerName,y=e.element,k=[],E=new Set,F=new Set,$=e.timelines.map(re=>{const he=re.element;E.add(he);const me=he[Pp];if(me&&me.removedBeforeQueried)return new bk(re.duration,re.delay);const Pe=he!==y,Re=function LMe(t){const n=[];return aU(t,n),n}((i.get(he)||EMe).map(sn=>sn.getRealPlayer())).filter(sn=>!!sn.element&&sn.element===he),rt=s.get(he),ft=c.get(he),Ct=zH(this._normalizer,re.keyframes,rt,ft),Vt=this._buildPlayer(re,Ct,Re);if(re.subTimeline&&r&&F.add(he),Pe){const sn=new D6(n,f,he);sn.setRealPlayer(Vt),k.push(sn)}return Vt});k.forEach(re=>{eu(this.playersByQueriedElement,re.element,[]).push(re),re.onDone(()=>function PMe(t,n,e){let i=t.get(n);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&t.delete(n)}return i}(this.playersByQueriedElement,re.element,re))}),E.forEach(re=>Vu(re,qH));const W=n0($);return W.onDestroy(()=>{E.forEach(re=>yb(re,qH)),$f(y,e.toStyles)}),F.forEach(re=>{eu(r,re,[]).push(W)}),W}_buildPlayer(n,e,i){return e.length>0?this.driver.animate(n.element,e,n.duration,n.delay,n.easing,i):new bk(n.duration,n.delay)}}class D6{constructor(n,e,i){this.namespaceId=n,this.triggerName=e,this.element=i,this._player=new bk,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>l6(n,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){const e=this._player;e.triggerCallback&&n.onStart(()=>e.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,e){eu(this._queuedCallbacks,n,[]).push(e)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){const e=this._player;e.triggerCallback&&e.triggerCallback(n)}}function VS(t){return t&&1===t.nodeType}function rU(t,n){const e=t.style.display;return t.style.display=n??"none",e}function oU(t,n,e,i,r){const s=[];e.forEach(y=>s.push(rU(y)));const c=[];i.forEach((y,k)=>{const E=new Map;y.forEach(F=>{const $=n.computeStyle(k,F,r);E.set(F,$),(!$||0==$.length)&&(k[Pp]=DMe,c.push(k))}),t.set(k,E)});let f=0;return e.forEach(y=>rU(y,s[f++])),c}function sU(t,n){const e=new Map;if(t.forEach(f=>e.set(f,[])),0==n.length)return e;const r=new Set(n),s=new Map;function c(f){if(!f)return 1;let y=s.get(f);if(y)return y;const k=f.parentNode;return y=e.has(k)?k:r.has(k)?1:c(k),s.set(f,y),y}return n.forEach(f=>{const y=c(f);1!==y&&e.get(y).push(f)}),e}function Vu(t,n){t.classList?.add(n)}function yb(t,n){t.classList?.remove(n)}function RMe(t,n,e){n0(e).onDone(()=>t.processLeaveNode(n))}function aU(t,n){for(let e=0;e<t.length;e++){const i=t[e];i instanceof CF?aU(i.players,n):n.push(i)}}function lU(t,n,e){const i=e.get(t);if(!i)return!1;let r=n.get(t);return r?i.forEach(s=>r.add(s)):n.set(t,i),e.delete(t),!0}class jS{constructor(n,e,i){this.bodyNode=n,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new AMe(n,e,i),this._timelineEngine=new wMe(n,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(n,e,i,r,s){const c=n+"-"+r;let f=this._triggerCache[c];if(!f){const y=[],E=y6(this._driver,s,y,[]);if(y.length)throw function Mke(t,n){return new Ht(3404,!1)}();f=function yMe(t,n,e){return new vMe(t,n,e)}(r,E,this._normalizer),this._triggerCache[c]=f}this._transitionEngine.registerTrigger(e,r,f)}register(n,e){this._transitionEngine.register(n,e)}destroy(n,e){this._transitionEngine.destroy(n,e)}onInsert(n,e,i,r){this._transitionEngine.insertNode(n,e,i,r)}onRemove(n,e,i){this._transitionEngine.removeNode(n,e,i)}disableAnimations(n,e){this._transitionEngine.markElementAsDisabled(n,e)}process(n,e,i,r){if("@"==i.charAt(0)){const[s,c]=NH(i);this._timelineEngine.command(s,e,c,r)}else this._transitionEngine.trigger(n,e,i,r)}listen(n,e,i,r,s){if("@"==i.charAt(0)){const[c,f]=NH(i);return this._timelineEngine.listen(c,e,f,s)}return this._transitionEngine.listen(n,e,i,r,s)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}}let NMe=(()=>{class t{static{this.initialStylesByElement=new WeakMap}constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=t.initialStylesByElement.get(e);s||t.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&$f(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&($f(this._element,this._initialStyles),this._endStyles&&($f(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(ky(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ky(this._element,this._endStyles),this._endStyles=null),$f(this._element,this._initialStyles),this._state=3)}}return t})();function T6(t){let n=null;return t.forEach((e,i)=>{(function BMe(t){return"display"===t||"position"===t})(i)&&(n=n||new Map,n.set(i,e))}),n}class cU{constructor(n,e,i,r){this.element=n,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;const e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){const e=[];return n.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(n,e,i){return n.animate(this._convertKeyframesToObject(e),i)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&n.set(r,this._finished?i:ZH(this.element,r))}),this.currentSnapshot=n}triggerCallback(n){const e="start"===n?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class VMe{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}matchesElement(n,e){return!1}containsElement(n,e){return VH(n,e)}getParentElement(n){return h6(n)}query(n,e,i){return jH(n,e,i)}computeStyle(n,e,i){return window.getComputedStyle(n)[e]}animate(n,e,i,r,s,c=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const k=new Map,E=c.filter(W=>W instanceof cU);(function Wke(t,n){return 0===t||0===n})(i,r)&&E.forEach(W=>{W.currentSnapshot.forEach((re,he)=>k.set(he,re))});let F=function qke(t){return t.length?t[0]instanceof Map?t:t.map(n=>$H(n)):[]}(e).map(W=>r0(W));F=function Zke(t,n,e){if(e.size&&n.length){let i=n[0],r=[];if(e.forEach((s,c)=>{i.has(c)||r.push(c),i.set(c,s)}),r.length)for(let s=1;s<n.length;s++){let c=n[s];r.forEach(f=>c.set(f,ZH(t,f)))}}return n}(n,F,k);const $=function zMe(t,n){let e=null,i=null;return Array.isArray(n)&&n.length?(e=T6(n[0]),n.length>1&&(i=T6(n[n.length-1]))):n instanceof Map&&(e=T6(n)),e||i?new NMe(t,e,i):null}(n,F);return new cU(n,F,y,$)}}let jMe=(()=>{class t extends xF{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:Go.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?kF(e):e;return dU(this._renderer,null,i,"register",[r]),new HMe(i,this._renderer)}static{this.\u0275fac=function(i){return new(i||t)(Dt(_p),Dt(lo))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();class HMe extends eie{constructor(n,e){super(),this._id=n,this._renderer=e}create(n,e){return new UMe(this._id,n,e||{},this._renderer)}}class UMe{constructor(n,e,i,r){this.id=n,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(n,e){return this._renderer.listen(this.element,`@@${this.id}:${n}`,e)}_command(n,...e){return dU(this._renderer,this.element,this.id,n,e)}onDone(n){this._listen("done",n)}onStart(n){this._listen("start",n)}onDestroy(n){this._listen("destroy",n)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(n){this._command("setPosition",n)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function dU(t,n,e,i,r){return t.setProperty(n,`@@${e}:${i}`,r)}const hU="@.disabled";let qMe=(()=>{class t{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,i.onRemovalComplete=(s,c)=>{const f=c?.parentNode(s);f&&c.removeChild(f,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let E=this._rendererCache.get(s);return E||(E=new uU("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,E)),E}const c=i.id,f=i.id+"-"+this._currentId;this._currentId++,this.engine.register(f,e);const y=E=>{Array.isArray(E)?E.forEach(y):this.engine.registerTrigger(c,f,e,E.name,E)};return i.data.animation.forEach(y),new $Me(this,f,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[c,f]=s;c(f)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static{this.\u0275fac=function(i){return new(i||t)(Dt(_p),Dt(jS),Dt(Mr))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();class uU{constructor(n,e,i,r){this.namespaceId=n,this.delegate=e,this.engine=i,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,e){return this.delegate.createElement(n,e)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,e){this.delegate.appendChild(n,e),this.engine.onInsert(this.namespaceId,e,n,!1)}insertBefore(n,e,i,r=!0){this.delegate.insertBefore(n,e,i),this.engine.onInsert(this.namespaceId,e,n,r)}removeChild(n,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(n,e){return this.delegate.selectRootElement(n,e)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,e,i,r){this.delegate.setAttribute(n,e,i,r)}removeAttribute(n,e,i){this.delegate.removeAttribute(n,e,i)}addClass(n,e){this.delegate.addClass(n,e)}removeClass(n,e){this.delegate.removeClass(n,e)}setStyle(n,e,i,r){this.delegate.setStyle(n,e,i,r)}removeStyle(n,e,i){this.delegate.removeStyle(n,e,i)}setProperty(n,e,i){"@"==e.charAt(0)&&e==hU?this.disableAnimations(n,!!i):this.delegate.setProperty(n,e,i)}setValue(n,e){this.delegate.setValue(n,e)}listen(n,e,i){return this.delegate.listen(n,e,i)}disableAnimations(n,e){this.engine.disableAnimations(n,e)}}class $Me extends uU{constructor(n,e,i,r,s){super(e,i,r,s),this.factory=n,this.namespaceId=e}setProperty(n,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==hU?this.disableAnimations(n,i=void 0===i||!!i):this.engine.process(this.namespaceId,n,e.slice(1),i):this.delegate.setProperty(n,e,i)}listen(n,e,i){if("@"==e.charAt(0)){const r=function GMe(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}(n);let s=e.slice(1),c="";return"@"!=s.charAt(0)&&([s,c]=function WMe(t){const n=t.indexOf(".");return[t.substring(0,n),t.slice(n+1)]}(s)),this.engine.listen(this.namespaceId,r,s,c,f=>{this.factory.scheduleListenerCallback(f._data||-1,i,f)})}return this.delegate.listen(n,e,i)}}let ZMe=(()=>{class t extends jS{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(i){return new(i||t)(Dt(lo),Dt(u6),Dt(k6),Dt(k1))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const pU=[{provide:xF,useClass:jMe},{provide:k6,useFactory:function YMe(){return new fMe}},{provide:jS,useClass:ZMe},{provide:_p,useFactory:function XMe(t,n,e){return new qMe(t,n,e)},deps:[vT,jS,Mr]}],A6=[{provide:u6,useFactory:()=>new VMe},{provide:r1,useValue:"BrowserAnimations"},...pU],fU=[{provide:u6,useClass:HH},{provide:r1,useValue:"NoopAnimations"},...pU];let KMe=(()=>{class t{static withConfig(e){return{ngModule:t,providers:e.disableAnimations?fU:A6}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:A6,imports:[LR]})}}return t})();const nCe={provide:new tn("mat-select-scroll-strategy"),deps:[t0],useFactory:function tCe(t){return()=>t.scrollStrategies.reposition()}};let iCe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[nCe],imports:[Gm,hM,PH,pl,kS,SS,PH,pl]})}}return t})(),cCe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,pl]})}}return t})(),dCe=(()=>{class t{constructor(e,i){this.authService=e,this.router=i}intercept(e,i){const r=this.authService.getToken();return r&&(e=e.clone({setHeaders:{Authorization:`Bearer ${r}`}})),i.handle(e).pipe(Zm(s=>(401===s.status&&(this.authService.logout(),this.router.navigate(["/login"])),q_(s))))}static{this.\u0275fac=function(i){return new(i||t)(Dt(Km),Dt(Na))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();const vU=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],bU=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xU=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],wU=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],kU=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],MU=new tn("LucideIcons",{factory:()=>new I6({})});class I6{constructor(n){this.icons=n}getIcon(n){return this.hasIcon(n)?this.icons[n]:null}hasIcon(n){return"object"==typeof this.icons&&n in this.icons}}class UGe{constructor(n){this.icons=n}}const qGe=t=>new I6(t??{});let $Ge=(()=>{class t{static pick(e){return{ngModule:t,providers:[{provide:MU,multi:!0,useValue:new I6(e)},{provide:MU,multi:!0,useFactory:qGe,deps:[[new oo,UGe]]}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Bi({type:t}),t.\u0275inj=Ii({imports:[[]]}),t})(),eWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[pl,r6,pl]})}}return t})(),iWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[Gm,pl]})}}return t})();function rWe(t,n){}class $S{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}}let TU=(()=>{class t extends QI{constructor(e,i,r,s,c,f,y,k){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=c,this._ngZone=f,this._overlayRef=y,this._focusMonitor=k,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this.attachDomPortal=E=>{this._portalOutlet.hasAttached();const F=this._portalOutlet.attachDomPortal(E);return this._contentAttached(),F},this._document=r,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=UI(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=UI();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=UI())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st($I),st(lo,8),st($S),st(yS),st(Mr),st(dM),st(bS))}}static{this.\u0275cmp=Xn({type:t,selectors:[["cdk-dialog-container"]],viewQuery:function(i,r){if(1&i&&Df(JI,7),2&i){let s;js(s=Hs())&&(r._portalOutlet=s.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(i,r){2&i&&La("id",r._config.id||null)("role",r._config.role)("aria-modal",r._config.ariaModal)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null)},features:[Kr],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,r){1&i&&He(0,rWe,0,0,"ng-template",0)},dependencies:[JI],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}}return t})();class O6{constructor(n,e){this.overlayRef=n,this.config=e,this.closed=new Sn,this.disableClose=e.disableClose,this.backdropClick=n.backdropClick(),this.keydownEvents=n.keydownEvents(),this.outsidePointerEvents=n.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!aM(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=n.detachments().subscribe(()=>{!1!==e.closeOnOverlayDetachments&&this.close()})}close(n,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(n),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(n="",e=""){return this.overlayRef.updateSize({width:n,height:e}),this}addPanelClass(n){return this.overlayRef.addPanelClass(n),this}removePanelClass(n){return this.overlayRef.removePanelClass(n),this}}const AU=new tn("DialogScrollStrategy"),oWe=new tn("DialogData"),sWe=new tn("DefaultDialogConfig"),lWe={provide:AU,deps:[t0],useFactory:function aWe(t){return()=>t.scrollStrategies.block()}};let cWe=0,PU=(()=>{class t{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(e,i,r,s,c,f){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=c,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Sn,this._afterOpenedAtThisLevel=new Sn,this._ariaHiddenElements=new Map,this.afterAllClosed=_4(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(y4(void 0))),this._scrollStrategy=f}open(e,i){(i={...this._defaultOptions||new $S,...i}).id=i.id||"cdk-dialog-"+cWe++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),c=this._overlay.create(s),f=new O6(c,i),y=this._attachContainer(c,f,i);return f.containerInstance=y,this._attachDialogContent(e,f,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(f),f.closed.subscribe(()=>this._removeOpenDialog(f,!0)),this.afterOpened.next(f),f}closeAll(){R6(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){R6(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),R6(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new yH({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){const s=r.injector||r.viewContainerRef?.injector,c=[{provide:$S,useValue:r},{provide:O6,useValue:i},{provide:dM,useValue:e}];let f;r.container?"function"==typeof r.container?f=r.container:(f=r.container.type,c.push(...r.container.providers(r))):f=TU;const y=new KI(f,r.viewContainerRef,ws.create({parent:s||this._injector,providers:c}),r.componentFactoryResolver);return e.attach(y).instance}_attachDialogContent(e,i,r,s){if(e instanceof Ef){const c=this._createInjector(s,i,r,void 0);let f={$implicit:s.data,dialogRef:i};s.templateContext&&(f={...f,..."function"==typeof s.templateContext?s.templateContext():s.templateContext}),r.attachTemplatePortal(new fH(e,null,f,c))}else{const c=this._createInjector(s,i,r,this._injector),f=r.attachComponentPortal(new KI(e,s.viewContainerRef,c,s.componentFactoryResolver));i.componentRef=f,i.componentInstance=f.instance}}_createInjector(e,i,r,s){const c=e.injector||e.viewContainerRef?.injector,f=[{provide:oWe,useValue:e.data},{provide:O6,useValue:i}];return e.providers&&("function"==typeof e.providers?f.push(...e.providers(i,e,r)):f.push(...e.providers)),e.direction&&(!c||!c.get(YI,null,{optional:!0}))&&f.push({provide:YI,useValue:{value:e.direction,change:Un()}}),ws.create({parent:c||s,providers:f})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,c)=>{s?c.setAttribute("aria-hidden",s):c.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static{this.\u0275fac=function(i){return new(i||t)(Dt(t0),Dt(ws),Dt(sWe,8),Dt(t,12),Dt(MS),Dt(AU))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})();function R6(t,n){let e=t.length;for(;e--;)n(t[e])}let dWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[PU,lWe],imports:[hM,gb,lH,gb]})}}return t})();function hWe(t,n){}class GS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const L6="mdc-dialog--open",IU="mdc-dialog--opening",OU="mdc-dialog--closing";let fWe=(()=>{class t extends TU{constructor(e,i,r,s,c,f,y,k){super(e,i,r,s,c,f,y,k),this._animationStateChanged=new Xi}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st($I),st(lo,8),st(GS),st(yS),st(Mr),st(dM),st(bS))}}static{this.\u0275cmp=Xn({type:t,selectors:[["ng-component"]],features:[Kr],decls:0,vars:0,template:function(i,r){},encapsulation:2})}}return t})();const RU="--mat-dialog-transition-duration";function LU(t){return null==t?null:"number"==typeof t?t:t.endsWith("ms")?Wj(t.substring(0,t.length-2)):t.endsWith("s")?1e3*Wj(t.substring(0,t.length-1)):"0"===t?0:null}let mWe=(()=>{class t extends fWe{constructor(e,i,r,s,c,f,y,k,E){super(e,i,r,s,c,f,y,E),this._animationMode=k,this._animationsEnabled="NoopAnimations"!==this._animationMode,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?LU(this._config.enterAnimationDuration)??150:0,this._exitAnimationDuration=this._animationsEnabled?LU(this._config.exitAnimationDuration)??75:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(RU,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(IU,L6)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(L6),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(L6),this._animationsEnabled?(this._hostElement.style.setProperty(RU,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(OU)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_clearAnimationClasses(){this._hostElement.classList.remove(IU,OU)}_waitForAnimationToComplete(e,i){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(i,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(e):e()})}static{this.\u0275fac=function(i){return new(i||t)(st(ns),st($I),st(lo,8),st(GS),st(yS),st(Mr),st(dM),st(r1,8),st(bS))}}static{this.\u0275cmp=Xn({type:t,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:8,hostBindings:function(i,r){2&i&&(In("id",r._config.id),La("aria-modal",r._config.ariaModal)("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),Z("_mat-animation-noopable",!r._animationsEnabled))},features:[Kr],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(i,r){1&i&&(z(0,"div",0)(1,"div",1),He(2,hWe,0,0,"ng-template",2),B()())},dependencies:[JI],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;transform:scale(0.8);opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{transform:none;opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{display:block;width:100%;height:100%}.mat-mdc-dialog-container{--mdc-dialog-container-elevation-shadow:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);--mdc-dialog-container-shadow-color:#000;--mdc-dialog-container-shape:4px;--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition-duration:var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container{transition:none}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-actions{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2})}}return t})();class gWe{constructor(n,e,i){this._ref=n,this._containerInstance=i,this._afterOpened=new Sn,this._beforeClosed=new Sn,this._state=0,this.disableClose=e.disableClose,this.id=n.id,i._animationStateChanged.pipe(rd(r=>"opened"===r.state),Fu(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(rd(r=>"closed"===r.state),Fu(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),n.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Oo(this.backdropClick(),this.keydownEvents().pipe(rd(r=>27===r.keyCode&&!this.disableClose&&!aM(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),function _We(t,n,e){t._closeInteractionType=n,t.close(e)}(this,"keydown"===r.type?"keyboard":"mouse"))})}close(n){this._result=n,this._containerInstance._animationStateChanged.pipe(rd(e=>"closing"===e.state),Fu(1)).subscribe(e=>{this._beforeClosed.next(n),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(n){let e=this._ref.config.positionStrategy;return n&&(n.left||n.right)?n.left?e.left(n.left):e.right(n.right):e.centerHorizontally(),n&&(n.top||n.bottom)?n.top?e.top(n.top):e.bottom(n.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(n="",e=""){return this._ref.updateSize(n,e),this}addPanelClass(n){return this._ref.addPanelClass(n),this}removePanelClass(n){return this._ref.removePanelClass(n),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}const yWe=new tn("MatMdcDialogData"),vWe=new tn("mat-mdc-dialog-default-options"),FU=new tn("mat-mdc-dialog-scroll-strategy"),xWe={provide:FU,deps:[t0],useFactory:function bWe(t){return()=>t.scrollStrategies.block()}};let wWe=0,kWe=(()=>{class t{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(e,i,r,s,c,f,y,k,E,F){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=k,this._dialogDataToken=E,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Sn,this._afterOpenedAtThisLevel=new Sn,this._idPrefix="mat-dialog-",this.dialogConfigClass=GS,this.afterAllClosed=_4(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(y4(void 0))),this._scrollStrategy=f,this._dialog=i.get(PU)}open(e,i){let r;(i={...this._defaultOptions||new GS,...i}).id=i.id||`${this._idPrefix}${wWe++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();const s=this._dialog.open(e,{...i,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:i},{provide:$S,useValue:i}]},templateContext:()=>({dialogRef:r}),providers:(c,f,y)=>(r=new this._dialogRefConstructor(c,i,y),r.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:f.data},{provide:this._dialogRefConstructor,useValue:r}])});return r.componentRef=s.componentRef,r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const c=this.openDialogs.indexOf(r);c>-1&&(this.openDialogs.splice(c,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}static{this.\u0275fac=function(i){p1()}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})(),MWe=(()=>{class t extends kWe{constructor(e,i,r,s,c,f,y,k){super(e,i,s,f,y,c,gWe,mWe,yWe,k),this._idPrefix="mat-mdc-dialog-"}static{this.\u0275fac=function(i){return new(i||t)(Dt(t0),Dt(ws),Dt(Nw,8),Dt(vWe,8),Dt(FU),Dt(t,12),Dt(MS),Dt(r1,8))}}static{this.\u0275prov=vn({token:t,factory:t.\u0275fac})}}return t})(),CWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({providers:[MWe,xWe],imports:[dWe,hM,gb,pl,pl]})}}return t})(),DWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t})}static{this.\u0275inj=Ii({imports:[hM,gb,Gm,o6,pl,pl]})}}return t})(),AWe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Bi({type:t,bootstrap:[Tbe]})}static{this.\u0275inj=Ii({providers:[{provide:sF,useClass:dCe,multi:!0}],imports:[LR,Dbe,$7,q7,JQ,$7,q7,nke,Fwe,_we,SS,KMe,iCe,cCe,o6,eWe,iWe,yhe,CWe,DWe,$Ge.pick({Home:xU,Building2:vU,Calendar:bU,MessageSquare:wU,Wallet:kU}),Jye,hbe]})}}return t})();iY().bootstrapModule(AWe).catch(t=>console.error(t))},244:function(yg,Lc){!function(wn){"use strict";function co(x){var T,H,ee,pe;for(H=1,ee=arguments.length;H<ee;H++)for(T in pe=arguments[H])x[T]=pe[T];return x}var nu=Object.create||function(){function x(){}return function(T){return x.prototype=T,new x}}();function p(x,T){var H=Array.prototype.slice;if(x.bind)return x.bind.apply(x,H.call(arguments,1));var ee=H.call(arguments,2);return function(){return x.apply(T,ee.length?ee.concat(H.call(arguments)):arguments)}}var En=0;function oi(x){return"_leaflet_id"in x||(x._leaflet_id=++En),x._leaflet_id}function Xl(x,T,H){var ee,pe,Ee,nt;return nt=function(){ee=!1,pe&&(Ee.apply(H,pe),pe=!1)},Ee=function(){ee?pe=arguments:(x.apply(H,arguments),setTimeout(nt,T),ee=!0)},Ee}function cc(x,T,H){var ee=T[1],pe=T[0],Ee=ee-pe;return x===ee&&H?x:((x-pe)%Ee+Ee)%Ee+pe}function Qr(){return!1}function zt(x,T){if(!1===T)return x;var H=Math.pow(10,void 0===T?6:T);return Math.round(x*H)/H}function Fc(x){return x.trim?x.trim():x.replace(/^\s+|\s+$/g,"")}function Gn(x){return Fc(x).split(/\s+/)}function mr(x,T){for(var H in Object.prototype.hasOwnProperty.call(x,"options")||(x.options=x.options?nu(x.options):{}),T)x.options[H]=T[H];return x.options}function Rr(x,T,H){var ee=[];for(var pe in x)ee.push(encodeURIComponent(H?pe.toUpperCase():pe)+"="+encodeURIComponent(x[pe]));return(T&&-1!==T.indexOf("?")?"&":"?")+ee.join("&")}var ho=/\{ *([\w_ -]+) *\}/g;function No(x,T){return x.replace(ho,function(H,ee){var pe=T[ee];if(void 0===pe)throw new Error("No value provided for variable "+H);return"function"==typeof pe&&(pe=pe(T)),pe})}var Uo=Array.isArray||function(x){return"[object Array]"===Object.prototype.toString.call(x)};function Ya(x,T){for(var H=0;H<x.length;H++)if(x[H]===T)return H;return-1}var Pl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function xa(x){return window["webkit"+x]||window["moz"+x]||window["ms"+x]}var Il=0;function Xa(x){var T=+new Date,H=Math.max(0,16-(T-Il));return Il=T+H,window.setTimeout(x,H)}var zc=window.requestAnimationFrame||xa("RequestAnimationFrame")||Xa,Ji=window.cancelAnimationFrame||xa("CancelAnimationFrame")||xa("CancelRequestAnimationFrame")||function(x){window.clearTimeout(x)};function Co(x,T,H){if(!H||zc!==Xa)return zc.call(window,p(x,T));x.call(T)}function gr(x){x&&Ji.call(window,x)}var Qn={__proto__:null,extend:co,create:nu,bind:p,get lastId(){return En},stamp:oi,throttle:Xl,wrapNum:cc,falseFn:Qr,formatNum:zt,trim:Fc,splitWords:Gn,setOptions:mr,getParamString:Rr,template:No,isArray:Uo,indexOf:Ya,emptyImageUrl:Pl,requestFn:zc,cancelFn:Ji,requestAnimFrame:Co,cancelAnimFrame:gr};function Cr(){}Cr.extend=function(x){var T=function(){mr(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},H=T.__super__=this.prototype,ee=nu(H);for(var pe in ee.constructor=T,T.prototype=ee,this)Object.prototype.hasOwnProperty.call(this,pe)&&"prototype"!==pe&&"__super__"!==pe&&(T[pe]=this[pe]);return x.statics&&co(T,x.statics),x.includes&&(function gs(x){if(!(typeof L>"u")&&L&&L.Mixin){x=Uo(x)?x:[x];for(var T=0;T<x.length;T++)x[T]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(x.includes),co.apply(null,[ee].concat(x.includes))),co(ee,x),delete ee.statics,delete ee.includes,ee.options&&(ee.options=H.options?nu(H.options):{},co(ee.options,x.options)),ee._initHooks=[],ee.callInitHooks=function(){if(!this._initHooksCalled){H.callInitHooks&&H.callInitHooks.call(this),this._initHooksCalled=!0;for(var Ee=0,nt=ee._initHooks.length;Ee<nt;Ee++)ee._initHooks[Ee].call(this)}},T},Cr.include=function(x){var T=this.prototype.options;return co(this.prototype,x),x.options&&(this.prototype.options=T,this.mergeOptions(x.options)),this},Cr.mergeOptions=function(x){return co(this.prototype.options,x),this},Cr.addInitHook=function(x){var T=Array.prototype.slice.call(arguments,1),H="function"==typeof x?x:function(){this[x].apply(this,T)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(H),this};var no={on:function(x,T,H){if("object"==typeof x)for(var ee in x)this._on(ee,x[ee],T);else for(var pe=0,Ee=(x=Gn(x)).length;pe<Ee;pe++)this._on(x[pe],T,H);return this},off:function(x,T,H){if(arguments.length)if("object"==typeof x)for(var ee in x)this._off(ee,x[ee],T);else{x=Gn(x);for(var pe=1===arguments.length,Ee=0,nt=x.length;Ee<nt;Ee++)pe?this._off(x[Ee]):this._off(x[Ee],T,H)}else delete this._events;return this},_on:function(x,T,H,ee){if("function"==typeof T){if(!1===this._listens(x,T,H)){H===this&&(H=void 0);var pe={fn:T,ctx:H};ee&&(pe.once=!0),this._events=this._events||{},this._events[x]=this._events[x]||[],this._events[x].push(pe)}}else console.warn("wrong listener type: "+typeof T)},_off:function(x,T,H){var ee,pe,Ee;if(this._events&&(ee=this._events[x])){if(1===arguments.length){if(this._firingCount)for(pe=0,Ee=ee.length;pe<Ee;pe++)ee[pe].fn=Qr;return void delete this._events[x]}if("function"!=typeof T)return void console.warn("wrong listener type: "+typeof T);var nt=this._listens(x,T,H);!1!==nt&&(this._firingCount&&(ee[nt].fn=Qr,this._events[x]=ee=ee.slice()),ee.splice(nt,1))}},fire:function(x,T,H){if(!this.listens(x,H))return this;var ee=co({},T,{type:x,target:this,sourceTarget:T&&T.sourceTarget||this});if(this._events){var pe=this._events[x];if(pe){this._firingCount=this._firingCount+1||1;for(var Ee=0,nt=pe.length;Ee<nt;Ee++){var St=pe[Ee],yt=St.fn;St.once&&this.off(x,yt,St.ctx),yt.call(St.ctx||this,ee)}this._firingCount--}}return H&&this._propagateEvent(ee),this},listens:function(x,T,H,ee){"string"!=typeof x&&console.warn('"string" type argument expected');var pe=T;"function"!=typeof T&&(ee=!!T,pe=void 0,H=void 0);var Ee=this._events&&this._events[x];if(Ee&&Ee.length&&!1!==this._listens(x,pe,H))return!0;if(ee)for(var nt in this._eventParents)if(this._eventParents[nt].listens(x,T,H,ee))return!0;return!1},_listens:function(x,T,H){if(!this._events)return!1;var ee=this._events[x]||[];if(!T)return!!ee.length;H===this&&(H=void 0);for(var pe=0,Ee=ee.length;pe<Ee;pe++)if(ee[pe].fn===T&&ee[pe].ctx===H)return pe;return!1},once:function(x,T,H){if("object"==typeof x)for(var ee in x)this._on(ee,x[ee],T,!0);else for(var pe=0,Ee=(x=Gn(x)).length;pe<Ee;pe++)this._on(x[pe],T,H,!0);return this},addEventParent:function(x){return this._eventParents=this._eventParents||{},this._eventParents[oi(x)]=x,this},removeEventParent:function(x){return this._eventParents&&delete this._eventParents[oi(x)],this},_propagateEvent:function(x){for(var T in this._eventParents)this._eventParents[T].fire(x.type,co({layer:x.target,propagatedFrom:x.target},x),!0)}};no.addEventListener=no.on,no.removeEventListener=no.clearAllEventListeners=no.off,no.addOneTimeEventListener=no.once,no.fireEvent=no.fire,no.hasEventListeners=no.listens;var wa=Cr.extend(no);function Pi(x,T,H){this.x=H?Math.round(x):x,this.y=H?Math.round(T):T}var Jn=Math.trunc||function(x){return x>0?Math.floor(x):Math.ceil(x)};function yi(x,T,H){return x instanceof Pi?x:Uo(x)?new Pi(x[0],x[1]):null==x?x:"object"==typeof x&&"x"in x&&"y"in x?new Pi(x.x,x.y):new Pi(x,T,H)}function Sr(x,T){if(x)for(var H=T?[x,T]:x,ee=0,pe=H.length;ee<pe;ee++)this.extend(H[ee])}function Yo(x,T){return!x||x instanceof Sr?x:new Sr(x,T)}function Bo(x,T){if(x)for(var H=T?[x,T]:x,ee=0,pe=H.length;ee<pe;ee++)this.extend(H[ee])}function Sn(x,T){return x instanceof Bo?x:new Bo(x,T)}function ei(x,T,H){if(isNaN(x)||isNaN(T))throw new Error("Invalid LatLng object: ("+x+", "+T+")");this.lat=+x,this.lng=+T,void 0!==H&&(this.alt=+H)}function si(x,T,H){return x instanceof ei?x:Uo(x)&&"object"!=typeof x[0]?3===x.length?new ei(x[0],x[1],x[2]):2===x.length?new ei(x[0],x[1]):null:null==x?x:"object"==typeof x&&"lat"in x?new ei(x.lat,"lng"in x?x.lng:x.lon,x.alt):void 0===T?null:new ei(x,T,H)}Pi.prototype={clone:function(){return new Pi(this.x,this.y)},add:function(x){return this.clone()._add(yi(x))},_add:function(x){return this.x+=x.x,this.y+=x.y,this},subtract:function(x){return this.clone()._subtract(yi(x))},_subtract:function(x){return this.x-=x.x,this.y-=x.y,this},divideBy:function(x){return this.clone()._divideBy(x)},_divideBy:function(x){return this.x/=x,this.y/=x,this},multiplyBy:function(x){return this.clone()._multiplyBy(x)},_multiplyBy:function(x){return this.x*=x,this.y*=x,this},scaleBy:function(x){return new Pi(this.x*x.x,this.y*x.y)},unscaleBy:function(x){return new Pi(this.x/x.x,this.y/x.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Jn(this.x),this.y=Jn(this.y),this},distanceTo:function(x){var T=(x=yi(x)).x-this.x,H=x.y-this.y;return Math.sqrt(T*T+H*H)},equals:function(x){return(x=yi(x)).x===this.x&&x.y===this.y},contains:function(x){return x=yi(x),Math.abs(x.x)<=Math.abs(this.x)&&Math.abs(x.y)<=Math.abs(this.y)},toString:function(){return"Point("+zt(this.x)+", "+zt(this.y)+")"}},Sr.prototype={extend:function(x){var T,H;if(!x)return this;if(x instanceof Pi||"number"==typeof x[0]||"x"in x)T=H=yi(x);else if(H=(x=Yo(x)).max,!(T=x.min)||!H)return this;return this.min||this.max?(this.min.x=Math.min(T.x,this.min.x),this.max.x=Math.max(H.x,this.max.x),this.min.y=Math.min(T.y,this.min.y),this.max.y=Math.max(H.y,this.max.y)):(this.min=T.clone(),this.max=H.clone()),this},getCenter:function(x){return yi((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,x)},getBottomLeft:function(){return yi(this.min.x,this.max.y)},getTopRight:function(){return yi(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(x){var T,H;return(x="number"==typeof x[0]||x instanceof Pi?yi(x):Yo(x))instanceof Sr?(T=x.min,H=x.max):T=H=x,T.x>=this.min.x&&H.x<=this.max.x&&T.y>=this.min.y&&H.y<=this.max.y},intersects:function(x){x=Yo(x);var T=this.min,H=this.max,ee=x.min,pe=x.max;return pe.x>=T.x&&ee.x<=H.x&&pe.y>=T.y&&ee.y<=H.y},overlaps:function(x){x=Yo(x);var T=this.min,H=this.max,ee=x.min,pe=x.max;return pe.x>T.x&&ee.x<H.x&&pe.y>T.y&&ee.y<H.y},isValid:function(){return!(!this.min||!this.max)},pad:function(x){var T=this.min,H=this.max,ee=Math.abs(T.x-H.x)*x,pe=Math.abs(T.y-H.y)*x;return Yo(yi(T.x-ee,T.y-pe),yi(H.x+ee,H.y+pe))},equals:function(x){return!!x&&(x=Yo(x),this.min.equals(x.getTopLeft())&&this.max.equals(x.getBottomRight()))}},Bo.prototype={extend:function(x){var ee,pe,T=this._southWest,H=this._northEast;if(x instanceof ei)ee=x,pe=x;else{if(!(x instanceof Bo))return x?this.extend(si(x)||Sn(x)):this;if(pe=x._northEast,!(ee=x._southWest)||!pe)return this}return T||H?(T.lat=Math.min(ee.lat,T.lat),T.lng=Math.min(ee.lng,T.lng),H.lat=Math.max(pe.lat,H.lat),H.lng=Math.max(pe.lng,H.lng)):(this._southWest=new ei(ee.lat,ee.lng),this._northEast=new ei(pe.lat,pe.lng)),this},pad:function(x){var T=this._southWest,H=this._northEast,ee=Math.abs(T.lat-H.lat)*x,pe=Math.abs(T.lng-H.lng)*x;return new Bo(new ei(T.lat-ee,T.lng-pe),new ei(H.lat+ee,H.lng+pe))},getCenter:function(){return new ei((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ei(this.getNorth(),this.getWest())},getSouthEast:function(){return new ei(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(x){x="number"==typeof x[0]||x instanceof ei||"lat"in x?si(x):Sn(x);var ee,pe,T=this._southWest,H=this._northEast;return x instanceof Bo?(ee=x.getSouthWest(),pe=x.getNorthEast()):ee=pe=x,ee.lat>=T.lat&&pe.lat<=H.lat&&ee.lng>=T.lng&&pe.lng<=H.lng},intersects:function(x){x=Sn(x);var T=this._southWest,H=this._northEast,ee=x.getSouthWest(),pe=x.getNorthEast();return pe.lat>=T.lat&&ee.lat<=H.lat&&pe.lng>=T.lng&&ee.lng<=H.lng},overlaps:function(x){x=Sn(x);var T=this._southWest,H=this._northEast,ee=x.getSouthWest(),pe=x.getNorthEast();return pe.lat>T.lat&&ee.lat<H.lat&&pe.lng>T.lng&&ee.lng<H.lng},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(x,T){return!!x&&(x=Sn(x),this._southWest.equals(x.getSouthWest(),T)&&this._northEast.equals(x.getNorthEast(),T))},isValid:function(){return!(!this._southWest||!this._northEast)}},ei.prototype={equals:function(x,T){return!!x&&(x=si(x),Math.max(Math.abs(this.lat-x.lat),Math.abs(this.lng-x.lng))<=(void 0===T?1e-9:T))},toString:function(x){return"LatLng("+zt(this.lat,x)+", "+zt(this.lng,x)+")"},distanceTo:function(x){return ui.distance(this,si(x))},wrap:function(){return ui.wrapLatLng(this)},toBounds:function(x){var T=180*x/40075017,H=T/Math.cos(Math.PI/180*this.lat);return Sn([this.lat-T,this.lng-H],[this.lat+T,this.lng+H])},clone:function(){return new ei(this.lat,this.lng,this.alt)}};var x,Lr={latLngToPoint:function(x,T){var H=this.projection.project(x),ee=this.scale(T);return this.transformation._transform(H,ee)},pointToLatLng:function(x,T){var H=this.scale(T),ee=this.transformation.untransform(x,H);return this.projection.unproject(ee)},project:function(x){return this.projection.project(x)},unproject:function(x){return this.projection.unproject(x)},scale:function(x){return 256*Math.pow(2,x)},zoom:function(x){return Math.log(x/256)/Math.LN2},getProjectedBounds:function(x){if(this.infinite)return null;var T=this.projection.bounds,H=this.scale(x);return new Sr(this.transformation.transform(T.min,H),this.transformation.transform(T.max,H))},infinite:!1,wrapLatLng:function(x){var T=this.wrapLng?cc(x.lng,this.wrapLng,!0):x.lng;return new ei(this.wrapLat?cc(x.lat,this.wrapLat,!0):x.lat,T,x.alt)},wrapLatLngBounds:function(x){var T=x.getCenter(),H=this.wrapLatLng(T),ee=T.lat-H.lat,pe=T.lng-H.lng;if(0===ee&&0===pe)return x;var Ee=x.getSouthWest(),nt=x.getNorthEast();return new Bo(new ei(Ee.lat-ee,Ee.lng-pe),new ei(nt.lat-ee,nt.lng-pe))}},ui=co({},Lr,{wrapLng:[-180,180],R:6371e3,distance:function(x,T){var H=Math.PI/180,ee=x.lat*H,pe=T.lat*H,Ee=Math.sin((T.lat-x.lat)*H/2),nt=Math.sin((T.lng-x.lng)*H/2),St=Ee*Ee+Math.cos(ee)*Math.cos(pe)*nt*nt,yt=2*Math.atan2(Math.sqrt(St),Math.sqrt(1-St));return this.R*yt}}),zi={R:6378137,MAX_LATITUDE:85.0511287798,project:function(x){var T=Math.PI/180,H=this.MAX_LATITUDE,ee=Math.max(Math.min(H,x.lat),-H),pe=Math.sin(ee*T);return new Pi(this.R*x.lng*T,this.R*Math.log((1+pe)/(1-pe))/2)},unproject:function(x){var T=180/Math.PI;return new ei((2*Math.atan(Math.exp(x.y/this.R))-Math.PI/2)*T,x.x*T/this.R)},bounds:(x=6378137*Math.PI,new Sr([-x,-x],[x,x]))};function As(x,T,H,ee){if(Uo(x))return this._a=x[0],this._b=x[1],this._c=x[2],void(this._d=x[3]);this._a=x,this._b=T,this._c=H,this._d=ee}function Vr(x,T,H,ee){return new As(x,T,H,ee)}As.prototype={transform:function(x,T){return this._transform(x.clone(),T)},_transform:function(x,T){return x.x=(T=T||1)*(this._a*x.x+this._b),x.y=T*(this._c*x.y+this._d),x},untransform:function(x,T){return new Pi((x.x/(T=T||1)-this._b)/this._a,(x.y/T-this._d)/this._c)}};var dc=co({},ui,{code:"EPSG:3857",projection:zi,transformation:function(){var x=.5/(Math.PI*zi.R);return Vr(x,.5,-x,.5)}()}),Id=co({},dc,{code:"EPSG:900913"});function go(x){return document.createElementNS("http://www.w3.org/2000/svg",x)}function Gs(x,T){var ee,pe,Ee,nt,St,yt,H="";for(ee=0,Ee=x.length;ee<Ee;ee++){for(pe=0,nt=(St=x[ee]).length;pe<nt;pe++)H+=(pe?"L":"M")+(yt=St[pe]).x+" "+yt.y;H+=T?Ne.svg?"z":"x":""}return H||"M0 0"}var hc=document.documentElement.style,_o="ActiveXObject"in window,Ka=_o&&!document.addEventListener,uc="msLaunchUri"in navigator&&!("documentMode"in document),Ol=Ge("webkit"),_r=Ge("android"),Io=Ge("android 2")||Ge("android 3"),ls=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Kl=_r&&Ge("Google")&&ls<537&&!("AudioNode"in window),So=!!window.opera,Ko=!uc&&Ge("chrome"),fl=Ge("gecko")&&!Ol&&!So&&!_o,pc=!Ko&&Ge("safari"),Ss=Ge("phantom"),Eo="OTransition"in hc,Bc=0===navigator.platform.indexOf("Win"),ml=_o&&"transition"in hc,fc="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Io,Vc="MozPerspective"in hc,Od=!window.L_DISABLE_3D&&(ml||fc||Vc)&&!Eo&&!Ss,lr=typeof orientation<"u"||Ge("mobile"),mc=lr&&Ol,nh=lr&&fc,gl=!window.PointerEvent&&window.MSPointerEvent,Rl=!(!window.PointerEvent&&!gl),Dh="ontouchstart"in window||!!window.TouchEvent,Th=!window.L_NO_TOUCH&&(Dh||Rl),Wt=lr&&So,jc=lr&&fl,iu=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,mt=function(){var x=!1;try{var T=Object.defineProperty({},"passive",{get:function(){x=!0}});window.addEventListener("testPassiveEventSupport",Qr,T),window.removeEventListener("testPassiveEventSupport",Qr,T)}catch{}return x}(),ae=!!document.createElement("canvas").getContext,ge=!(!document.createElementNS||!go("svg").createSVGRect),Ae=!!ge&&function(){var x=document.createElement("div");return x.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(x.firstChild&&x.firstChild.namespaceURI)}(),je=!ge&&function(){try{var x=document.createElement("div");x.innerHTML='<v:shape adj="1"/>';var T=x.firstChild;return T.style.behavior="url(#default#VML)",T&&"object"==typeof T.adj}catch{return!1}}();function Ge(x){return navigator.userAgent.toLowerCase().indexOf(x)>=0}var Ne={ie:_o,ielt9:Ka,edge:uc,webkit:Ol,android:_r,android23:Io,androidStock:Kl,opera:So,chrome:Ko,gecko:fl,safari:pc,phantom:Ss,opera12:Eo,win:Bc,ie3d:ml,webkit3d:fc,gecko3d:Vc,any3d:Od,mobile:lr,mobileWebkit:mc,mobileWebkit3d:nh,msPointer:gl,pointer:Rl,touch:Th,touchNative:Dh,mobileOpera:Wt,mobileGecko:jc,retina:iu,passiveEvents:mt,canvas:ae,svg:ge,vml:je,inlineSvg:Ae,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},at=Ne.msPointer?"MSPointerDown":"pointerdown",bt=Ne.msPointer?"MSPointerMove":"pointermove",tt=Ne.msPointer?"MSPointerUp":"pointerup",Zt=Ne.msPointer?"MSPointerCancel":"pointercancel",jt={touchstart:at,touchmove:bt,touchend:tt,touchcancel:Zt},pn={touchstart:function wi(x,T){T.MSPOINTER_TYPE_TOUCH&&T.pointerType===T.MSPOINTER_TYPE_TOUCH&&Ws(T),Si(x,T)},touchmove:Si,touchend:Si,touchcancel:Si},Nn={},Wn=!1;function ii(x,T,H){return"touchstart"===T&&function ki(){Wn||(document.addEventListener(at,cr,!0),document.addEventListener(bt,ci,!0),document.addEventListener(tt,fi,!0),document.addEventListener(Zt,fi,!0),Wn=!0)}(),pn[T]?(H=pn[T].bind(this,H),x.addEventListener(jt[T],H,!1),H):(console.warn("wrong event specified:",T),Qr)}function cr(x){Nn[x.pointerId]=x}function ci(x){Nn[x.pointerId]&&(Nn[x.pointerId]=x)}function fi(x){delete Nn[x.pointerId]}function Si(x,T){if(T.pointerType!==(T.MSPOINTER_TYPE_MOUSE||"mouse")){for(var H in T.touches=[],Nn)T.touches.push(Nn[H]);T.changedTouches=[T],x(T)}}var qo=200;var Ls,Ro,Rd,yc,Es,ka=$o(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ys=$o(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ps="webkitTransition"===ys||"OTransition"===ys?ys+"End":"transitionend";function Jo(x){return"string"==typeof x?document.getElementById(x):x}function cs(x,T){var H=x.style[T]||x.currentStyle&&x.currentStyle[T];if((!H||"auto"===H)&&document.defaultView){var ee=document.defaultView.getComputedStyle(x,null);H=ee?ee[T]:null}return"auto"===H?null:H}function rr(x,T,H){var ee=document.createElement(x);return ee.className=T||"",H&&H.appendChild(ee),ee}function yo(x){var T=x.parentNode;T&&T.removeChild(x)}function gc(x){for(;x.firstChild;)x.removeChild(x.firstChild)}function _l(x){var T=x.parentNode;T&&T.lastChild!==x&&T.appendChild(x)}function _c(x){var T=x.parentNode;T&&T.firstChild!==x&&T.insertBefore(x,T.firstChild)}function sd(x,T){if(void 0!==x.classList)return x.classList.contains(T);var H=Un(x);return H.length>0&&new RegExp("(^|\\s)"+T+"(\\s|$)").test(H)}function ti(x,T){if(void 0!==x.classList)for(var H=Gn(T),ee=0,pe=H.length;ee<pe;ee++)x.classList.add(H[ee]);else if(!sd(x,T)){var Ee=Un(x);Is(x,(Ee?Ee+" ":"")+T)}}function Oo(x,T){void 0!==x.classList?x.classList.remove(T):Is(x,Fc((" "+Un(x)+" ").replace(" "+T+" "," ")))}function Is(x,T){void 0===x.className.baseVal?x.className=T:x.className.baseVal=T}function Un(x){return x.correspondingElement&&(x=x.correspondingElement),void 0===x.className.baseVal?x.className:x.className.baseVal}function Os(x,T){"opacity"in x.style?x.style.opacity=T:"filter"in x.style&&function Rs(x,T){var H=!1,ee="DXImageTransform.Microsoft.Alpha";try{H=x.filters.item(ee)}catch{if(1===T)return}T=Math.round(100*T),H?(H.Enabled=100!==T,H.Opacity=T):x.style.filter+=" progid:"+ee+"(opacity="+T+")"}(x,T)}function $o(x){for(var T=document.documentElement.style,H=0;H<x.length;H++)if(x[H]in T)return x[H];return!1}function na(x,T,H){var ee=T||new Pi(0,0);x.style[ka]=(Ne.ie3d?"translate("+ee.x+"px,"+ee.y+"px)":"translate3d("+ee.x+"px,"+ee.y+"px,0)")+(H?" scale("+H+")":"")}function uo(x,T){x._leaflet_pos=T,Ne.any3d?na(x,T):(x.style.left=T.x+"px",x.style.top=T.y+"px")}function tr(x){return x._leaflet_pos||new Pi(0,0)}if("onselectstart"in document)Ls=function(){jn(window,"selectstart",Ws)},Ro=function(){po(window,"selectstart",Ws)};else{var Qa=$o(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ls=function(){if(Qa){var x=document.documentElement.style;Rd=x[Qa],x[Qa]="none"}},Ro=function(){Qa&&(document.documentElement.style[Qa]=Rd,Rd=void 0)}}function Tr(){jn(window,"dragstart",Ws)}function Ri(){po(window,"dragstart",Ws)}function vc(x){for(;-1===x.tabIndex;)x=x.parentNode;x.style&&(Hc(),yc=x,Es=x.style.outlineStyle,x.style.outlineStyle="none",jn(window,"keydown",Hc))}function Hc(){yc&&(yc.style.outlineStyle=Es,yc=void 0,Es=void 0,po(window,"keydown",Hc))}function Ht(x){do{x=x.parentNode}while(!(x.offsetWidth&&x.offsetHeight||x===document.body));return x}function Uc(x){var T=x.getBoundingClientRect();return{x:T.width/x.offsetWidth||1,y:T.height/x.offsetHeight||1,boundingClientRect:T}}var Ui={__proto__:null,TRANSFORM:ka,TRANSITION:ys,TRANSITION_END:Ps,get:Jo,getStyle:cs,create:rr,remove:yo,empty:gc,toFront:_l,toBack:_c,hasClass:sd,addClass:ti,removeClass:Oo,setClass:Is,getClass:Un,setOpacity:Os,testProp:$o,setTransform:na,setPosition:uo,getPosition:tr,get disableTextSelection(){return Ls},get enableTextSelection(){return Ro},disableImageDrag:Tr,enableImageDrag:Ri,preventOutline:vc,restoreOutline:Hc,getSizedParentNode:Ht,getScale:Uc};function jn(x,T,H,ee){if(T&&"object"==typeof T)for(var pe in T)Ma(x,pe,T[pe],H);else for(var Ee=0,nt=(T=Gn(T)).length;Ee<nt;Ee++)Ma(x,T[Ee],H,ee);return this}var vi="_leaflet_events";function po(x,T,H,ee){if(1===arguments.length)Ld(x),delete x[vi];else if(T&&"object"==typeof T)for(var pe in T)yl(x,pe,T[pe],H);else if(T=Gn(T),2===arguments.length)Ld(x,function(St){return-1!==Ya(T,St)});else for(var Ee=0,nt=T.length;Ee<nt;Ee++)yl(x,T[Ee],H,ee);return this}function Ld(x,T){for(var H in x[vi]){var ee=H.split(/\d/)[0];(!T||T(ee))&&yl(x,ee,null,null,H)}}var Ah={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ma(x,T,H,ee){var pe=T+oi(H)+(ee?"_"+oi(ee):"");if(x[vi]&&x[vi][pe])return this;var Ee=function(St){return H.call(ee||x,St||window.event)},nt=Ee;!Ne.touchNative&&Ne.pointer&&0===T.indexOf("touch")?Ee=ii(x,T,Ee):Ne.touch&&"dblclick"===T?Ee=function Qo(x,T){x.addEventListener("dblclick",T);var ee,H=0;function pe(Ee){if(1===Ee.detail){if("mouse"!==Ee.pointerType&&(!Ee.sourceCapabilities||Ee.sourceCapabilities.firesTouchEvents)){var nt=Ph(Ee);if(!nt.some(function(yt){return yt instanceof HTMLLabelElement&&yt.attributes.for})||nt.some(function(yt){return yt instanceof HTMLInputElement||yt instanceof HTMLSelectElement})){var St=Date.now();St-H<=qo?2==++ee&&T(function Do(x){var H,ee,T={};for(ee in x)T[ee]=(H=x[ee])&&H.bind?H.bind(x):H;return x=T,T.type="dblclick",T.detail=2,T.isTrusted=!1,T._simulated=!0,T}(Ee)):ee=1,H=St}}}else ee=Ee.detail}return x.addEventListener("click",pe),{dblclick:T,simDblclick:pe}}(x,Ee):"addEventListener"in x?"touchstart"===T||"touchmove"===T||"wheel"===T||"mousewheel"===T?x.addEventListener(Ah[T]||T,Ee,!!Ne.passiveEvents&&{passive:!1}):"mouseenter"===T||"mouseleave"===T?x.addEventListener(Ah[T],Ee=function(St){St=St||window.event,Ca(x,St)&&nt(St)},!1):x.addEventListener(T,nt,!1):x.attachEvent("on"+T,Ee),x[vi]=x[vi]||{},x[vi][pe]=Ee}function yl(x,T,H,ee,pe){pe=pe||T+oi(H)+(ee?"_"+oi(ee):"");var Ee=x[vi]&&x[vi][pe];if(!Ee)return this;!Ne.touchNative&&Ne.pointer&&0===T.indexOf("touch")?function pi(x,T,H){jt[T]?x.removeEventListener(jt[T],H,!1):console.warn("wrong event specified:",T)}(x,T,Ee):Ne.touch&&"dblclick"===T?function _s(x,T){x.removeEventListener("dblclick",T.dblclick),x.removeEventListener("click",T.simDblclick)}(x,Ee):"removeEventListener"in x?x.removeEventListener(Ah[T]||T,Ee,!1):x.detachEvent("on"+T,Ee),x[vi][pe]=null}function Ja(x){return x.stopPropagation?x.stopPropagation():x.originalEvent?x.originalEvent._stopped=!0:x.cancelBubble=!0,this}function ad(x){return Ma(x,"wheel",Ja),this}function vl(x){return jn(x,"mousedown touchstart dblclick contextmenu",Ja),x._leaflet_disable_click=!0,this}function Ws(x){return x.preventDefault?x.preventDefault():x.returnValue=!1,this}function Ll(x){return Ws(x),Ja(x),this}function Ph(x){if(x.composedPath)return x.composedPath();for(var T=[],H=x.target;H;)T.push(H),H=H.parentNode;return T}function ih(x,T){if(!T)return new Pi(x.clientX,x.clientY);var H=Uc(T),ee=H.boundingClientRect;return new Pi((x.clientX-ee.left)/H.x-T.clientLeft,(x.clientY-ee.top)/H.y-T.clientTop)}var ru=Ne.linux&&Ne.chrome?window.devicePixelRatio:Ne.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Hu(x){return Ne.edge?x.wheelDeltaY/2:x.deltaY&&0===x.deltaMode?-x.deltaY/ru:x.deltaY&&1===x.deltaMode?20*-x.deltaY:x.deltaY&&2===x.deltaMode?60*-x.deltaY:x.deltaX||x.deltaZ?0:x.wheelDelta?(x.wheelDeltaY||x.wheelDelta)/2:x.detail&&Math.abs(x.detail)<32765?20*-x.detail:x.detail?x.detail/-32765*60:0}function Ca(x,T){var H=T.relatedTarget;if(!H)return!0;try{for(;H&&H!==x;)H=H.parentNode}catch{return!1}return H!==x}var Fl={__proto__:null,on:jn,off:po,stopPropagation:Ja,disableScrollPropagation:ad,disableClickPropagation:vl,preventDefault:Ws,stop:Ll,getPropagationPath:Ph,getMousePosition:ih,getWheelDelta:Hu,isExternalTarget:Ca,addListener:jn,removeListener:po},Va=wa.extend({run:function(x,T,H,ee){this.stop(),this._el=x,this._inProgress=!0,this._duration=H||.25,this._easeOutPower=1/Math.max(ee||.5,.2),this._startPos=tr(x),this._offset=T.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Co(this._animate,this),this._step()},_step:function(x){var T=+new Date-this._startTime,H=1e3*this._duration;T<H?this._runFrame(this._easeOut(T/H),x):(this._runFrame(1),this._complete())},_runFrame:function(x,T){var H=this._startPos.add(this._offset.multiplyBy(x));T&&H._round(),uo(this._el,H),this.fire("step")},_complete:function(){gr(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(x){return 1-Math.pow(1-x,this._easeOutPower)}}),On=wa.extend({options:{crs:dc,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(x,T){T=mr(this,T),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(x),this._initLayout(),this._onResize=p(this._onResize,this),this._initEvents(),T.maxBounds&&this.setMaxBounds(T.maxBounds),void 0!==T.zoom&&(this._zoom=this._limitZoom(T.zoom)),T.center&&void 0!==T.zoom&&this.setView(si(T.center),T.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ys&&Ne.any3d&&!Ne.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),jn(this._proxy,Ps,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(x,T,H){return T=void 0===T?this._zoom:this._limitZoom(T),x=this._limitCenter(si(x),T,this.options.maxBounds),H=H||{},this._stop(),this._loaded&&!H.reset&&!0!==H&&(void 0!==H.animate&&(H.zoom=co({animate:H.animate},H.zoom),H.pan=co({animate:H.animate,duration:H.duration},H.pan)),this._zoom!==T?this._tryAnimatedZoom&&this._tryAnimatedZoom(x,T,H.zoom):this._tryAnimatedPan(x,H.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(x,T,H.pan&&H.pan.noMoveStart),this)},setZoom:function(x,T){return this._loaded?this.setView(this.getCenter(),x,{zoom:T}):(this._zoom=x,this)},zoomIn:function(x,T){return this.setZoom(this._zoom+(x=x||(Ne.any3d?this.options.zoomDelta:1)),T)},zoomOut:function(x,T){return this.setZoom(this._zoom-(x=x||(Ne.any3d?this.options.zoomDelta:1)),T)},setZoomAround:function(x,T,H){var ee=this.getZoomScale(T),pe=this.getSize().divideBy(2),nt=(x instanceof Pi?x:this.latLngToContainerPoint(x)).subtract(pe).multiplyBy(1-1/ee),St=this.containerPointToLatLng(pe.add(nt));return this.setView(St,T,{zoom:H})},_getBoundsCenterZoom:function(x,T){T=T||{},x=x.getBounds?x.getBounds():Sn(x);var H=yi(T.paddingTopLeft||T.padding||[0,0]),ee=yi(T.paddingBottomRight||T.padding||[0,0]),pe=this.getBoundsZoom(x,!1,H.add(ee));if((pe="number"==typeof T.maxZoom?Math.min(T.maxZoom,pe):pe)===1/0)return{center:x.getCenter(),zoom:pe};var Ee=ee.subtract(H).divideBy(2),nt=this.project(x.getSouthWest(),pe),St=this.project(x.getNorthEast(),pe);return{center:this.unproject(nt.add(St).divideBy(2).add(Ee),pe),zoom:pe}},fitBounds:function(x,T){if(!(x=Sn(x)).isValid())throw new Error("Bounds are not valid.");var H=this._getBoundsCenterZoom(x,T);return this.setView(H.center,H.zoom,T)},fitWorld:function(x){return this.fitBounds([[-90,-180],[90,180]],x)},panTo:function(x,T){return this.setView(x,this._zoom,{pan:T})},panBy:function(x,T){if(T=T||{},!(x=yi(x).round()).x&&!x.y)return this.fire("moveend");if(!0!==T.animate&&!this.getSize().contains(x))return this._resetView(this.unproject(this.project(this.getCenter()).add(x)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Va,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),T.noMoveStart||this.fire("movestart"),!1!==T.animate){ti(this._mapPane,"leaflet-pan-anim");var H=this._getMapPanePos().subtract(x).round();this._panAnim.run(this._mapPane,H,T.duration||.25,T.easeLinearity)}else this._rawPanBy(x),this.fire("move").fire("moveend");return this},flyTo:function(x,T,H){if(!1===(H=H||{}).animate||!Ne.any3d)return this.setView(x,T,H);this._stop();var ee=this.project(this.getCenter()),pe=this.project(x),Ee=this.getSize(),nt=this._zoom;x=si(x),T=void 0===T?nt:T;var St=Math.max(Ee.x,Ee.y),yt=St*this.getZoomScale(nt,T),on=pe.distanceTo(ee)||1,Y=1.42,J=Y*Y;function fe(hs){var $d=(yt*yt-St*St+(hs?-1:1)*J*J*on*on)/(2*(hs?yt:St)*J*on),Ks=Math.sqrt($d*$d+1)-$d;return Ks<1e-9?-18:Math.log(Ks)}function Ue(hs){return(Math.exp(hs)-Math.exp(-hs))/2}function At(hs){return(Math.exp(hs)+Math.exp(-hs))/2}var Mi=fe(0);function io(hs){return St*(At(Mi)*function xn(hs){return Ue(hs)/At(hs)}(Mi+Y*hs)-Ue(Mi))/J}var fd=Date.now(),Wc=(fe(1)-Mi)/Y,Ar=H.duration?1e3*H.duration:1e3*Wc*.8;return this._moveStart(!0,H.noMoveStart),function s0(){var hs=(Date.now()-fd)/Ar,Yu=function Ua(hs){return 1-Math.pow(1-hs,1.5)}(hs)*Wc;hs<=1?(this._flyToFrame=Co(s0,this),this._move(this.unproject(ee.add(pe.subtract(ee).multiplyBy(io(Yu)/on)),nt),this.getScaleZoom(St/function yr(hs){return St*(At(Mi)/At(Mi+Y*hs))}(Yu),nt),{flyTo:!0})):this._move(x,T)._moveEnd(!0)}.call(this),this},flyToBounds:function(x,T){var H=this._getBoundsCenterZoom(x,T);return this.flyTo(H.center,H.zoom,T)},setMaxBounds:function(x){return x=Sn(x),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),x.isValid()?(this.options.maxBounds=x,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(x){var T=this.options.minZoom;return this.options.minZoom=x,this._loaded&&T!==x&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(x):this},setMaxZoom:function(x){var T=this.options.maxZoom;return this.options.maxZoom=x,this._loaded&&T!==x&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(x):this},panInsideBounds:function(x,T){this._enforcingBounds=!0;var H=this.getCenter(),ee=this._limitCenter(H,this._zoom,Sn(x));return H.equals(ee)||this.panTo(ee,T),this._enforcingBounds=!1,this},panInside:function(x,T){var H=yi((T=T||{}).paddingTopLeft||T.padding||[0,0]),ee=yi(T.paddingBottomRight||T.padding||[0,0]),pe=this.project(this.getCenter()),Ee=this.project(x),nt=this.getPixelBounds(),St=Yo([nt.min.add(H),nt.max.subtract(ee)]),yt=St.getSize();if(!St.contains(Ee)){this._enforcingBounds=!0;var on=Ee.subtract(St.getCenter()),Y=St.extend(Ee).getSize().subtract(yt);pe.x+=on.x<0?-Y.x:Y.x,pe.y+=on.y<0?-Y.y:Y.y,this.panTo(this.unproject(pe),T),this._enforcingBounds=!1}return this},invalidateSize:function(x){if(!this._loaded)return this;x=co({animate:!1,pan:!0},!0===x?{animate:!0}:x);var T=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var H=this.getSize(),ee=T.divideBy(2).round(),pe=H.divideBy(2).round(),Ee=ee.subtract(pe);return Ee.x||Ee.y?(x.animate&&x.pan?this.panBy(Ee):(x.pan&&this._rawPanBy(Ee),this.fire("move"),x.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(p(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:T,newSize:H})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(x){if(x=this._locateOptions=co({timeout:1e4,watch:!1},x),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var T=p(this._handleGeolocationResponse,this),H=p(this._handleGeolocationError,this);return x.watch?this._locationWatchId=navigator.geolocation.watchPosition(T,H,x):navigator.geolocation.getCurrentPosition(T,H,x),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(x){if(this._container._leaflet_id){var T=x.code,H=x.message||(1===T?"permission denied":2===T?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:T,message:"Geolocation error: "+H+"."})}},_handleGeolocationResponse:function(x){if(this._container._leaflet_id){var ee=new ei(x.coords.latitude,x.coords.longitude),pe=ee.toBounds(2*x.coords.accuracy),Ee=this._locateOptions;if(Ee.setView){var nt=this.getBoundsZoom(pe);this.setView(ee,Ee.maxZoom?Math.min(nt,Ee.maxZoom):nt)}var St={latlng:ee,bounds:pe,timestamp:x.timestamp};for(var yt in x.coords)"number"==typeof x.coords[yt]&&(St[yt]=x.coords[yt]);this.fire("locationfound",St)}},addHandler:function(x,T){if(!T)return this;var H=this[x]=new T(this);return this._handlers.push(H),this.options[x]&&H.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}var x;for(x in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),yo(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(gr(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[x].remove();for(x in this._panes)yo(this._panes[x]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(x,T){var ee=rr("div","leaflet-pane"+(x?" leaflet-"+x.replace("Pane","")+"-pane":""),T||this._mapPane);return x&&(this._panes[x]=ee),ee},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var x=this.getPixelBounds();return new Bo(this.unproject(x.getBottomLeft()),this.unproject(x.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(x,T,H){x=Sn(x),H=yi(H||[0,0]);var ee=this.getZoom()||0,pe=this.getMinZoom(),Ee=this.getMaxZoom(),nt=x.getNorthWest(),St=x.getSouthEast(),yt=this.getSize().subtract(H),on=Yo(this.project(St,ee),this.project(nt,ee)).getSize(),Y=Ne.any3d?this.options.zoomSnap:1,J=yt.x/on.x,fe=yt.y/on.y,Ue=T?Math.max(J,fe):Math.min(J,fe);return ee=this.getScaleZoom(Ue,ee),Y&&(ee=Math.round(ee/(Y/100))*(Y/100),ee=T?Math.ceil(ee/Y)*Y:Math.floor(ee/Y)*Y),Math.max(pe,Math.min(Ee,ee))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Pi(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(x,T){var H=this._getTopLeftPoint(x,T);return new Sr(H,H.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(x){return this.options.crs.getProjectedBounds(void 0===x?this.getZoom():x)},getPane:function(x){return"string"==typeof x?this._panes[x]:x},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(x,T){var H=this.options.crs;return T=void 0===T?this._zoom:T,H.scale(x)/H.scale(T)},getScaleZoom:function(x,T){var H=this.options.crs,ee=H.zoom(x*H.scale(T=void 0===T?this._zoom:T));return isNaN(ee)?1/0:ee},project:function(x,T){return T=void 0===T?this._zoom:T,this.options.crs.latLngToPoint(si(x),T)},unproject:function(x,T){return T=void 0===T?this._zoom:T,this.options.crs.pointToLatLng(yi(x),T)},layerPointToLatLng:function(x){var T=yi(x).add(this.getPixelOrigin());return this.unproject(T)},latLngToLayerPoint:function(x){return this.project(si(x))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(x){return this.options.crs.wrapLatLng(si(x))},wrapLatLngBounds:function(x){return this.options.crs.wrapLatLngBounds(Sn(x))},distance:function(x,T){return this.options.crs.distance(si(x),si(T))},containerPointToLayerPoint:function(x){return yi(x).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(x){return yi(x).add(this._getMapPanePos())},containerPointToLatLng:function(x){var T=this.containerPointToLayerPoint(yi(x));return this.layerPointToLatLng(T)},latLngToContainerPoint:function(x){return this.layerPointToContainerPoint(this.latLngToLayerPoint(si(x)))},mouseEventToContainerPoint:function(x){return ih(x,this._container)},mouseEventToLayerPoint:function(x){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(x))},mouseEventToLatLng:function(x){return this.layerPointToLatLng(this.mouseEventToLayerPoint(x))},_initContainer:function(x){var T=this._container=Jo(x);if(!T)throw new Error("Map container not found.");if(T._leaflet_id)throw new Error("Map container is already initialized.");jn(T,"scroll",this._onScroll,this),this._containerId=oi(T)},_initLayout:function(){var x=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ne.any3d,ti(x,"leaflet-container"+(Ne.touch?" leaflet-touch":"")+(Ne.retina?" leaflet-retina":"")+(Ne.ielt9?" leaflet-oldie":"")+(Ne.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var T=cs(x,"position");"absolute"!==T&&"relative"!==T&&"fixed"!==T&&"sticky"!==T&&(x.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var x=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),uo(this._mapPane,new Pi(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ti(x.markerPane,"leaflet-zoom-hide"),ti(x.shadowPane,"leaflet-zoom-hide"))},_resetView:function(x,T,H){uo(this._mapPane,new Pi(0,0));var ee=!this._loaded;this._loaded=!0,T=this._limitZoom(T),this.fire("viewprereset");var pe=this._zoom!==T;this._moveStart(pe,H)._move(x,T)._moveEnd(pe),this.fire("viewreset"),ee&&this.fire("load")},_moveStart:function(x,T){return x&&this.fire("zoomstart"),T||this.fire("movestart"),this},_move:function(x,T,H,ee){void 0===T&&(T=this._zoom);var pe=this._zoom!==T;return this._zoom=T,this._lastCenter=x,this._pixelOrigin=this._getNewPixelOrigin(x),ee?H&&H.pinch&&this.fire("zoom",H):((pe||H&&H.pinch)&&this.fire("zoom",H),this.fire("move",H)),this},_moveEnd:function(x){return x&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return gr(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(x){uo(this._mapPane,this._getMapPanePos().subtract(x))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(x){this._targets={},this._targets[oi(this._container)]=this;var T=x?po:jn;T(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&T(window,"resize",this._onResize,this),Ne.any3d&&this.options.transform3DLimit&&(x?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){gr(this._resizeRequest),this._resizeRequest=Co(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var x=this._getMapPanePos();Math.max(Math.abs(x.x),Math.abs(x.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(x,T){for(var ee,H=[],pe="mouseout"===T||"mouseover"===T,Ee=x.target||x.srcElement,nt=!1;Ee;){if((ee=this._targets[oi(Ee)])&&("click"===T||"preclick"===T)&&this._draggableMoved(ee)){nt=!0;break}if(ee&&ee.listens(T,!0)&&(pe&&!Ca(Ee,x)||(H.push(ee),pe))||Ee===this._container)break;Ee=Ee.parentNode}return!H.length&&!nt&&!pe&&this.listens(T,!0)&&(H=[this]),H},_isClickDisabled:function(x){for(;x&&x!==this._container;){if(x._leaflet_disable_click)return!0;x=x.parentNode}},_handleDOMEvent:function(x){var T=x.target||x.srcElement;if(!(!this._loaded||T._leaflet_disable_events||"click"===x.type&&this._isClickDisabled(T))){var H=x.type;"mousedown"===H&&vc(T),this._fireDOMEvent(x,H)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(x,T,H){if("click"===x.type){var ee=co({},x);ee.type="preclick",this._fireDOMEvent(ee,ee.type,H)}var pe=this._findEventTargets(x,T);if(H){for(var Ee=[],nt=0;nt<H.length;nt++)H[nt].listens(T,!0)&&Ee.push(H[nt]);pe=Ee.concat(pe)}if(pe.length){"contextmenu"===T&&Ws(x);var St=pe[0],yt={originalEvent:x};if("keypress"!==x.type&&"keydown"!==x.type&&"keyup"!==x.type){var on=St.getLatLng&&(!St._radius||St._radius<=10);yt.containerPoint=on?this.latLngToContainerPoint(St.getLatLng()):this.mouseEventToContainerPoint(x),yt.layerPoint=this.containerPointToLayerPoint(yt.containerPoint),yt.latlng=on?St.getLatLng():this.layerPointToLatLng(yt.layerPoint)}for(nt=0;nt<pe.length;nt++)if(pe[nt].fire(T,yt,!0),yt.originalEvent._stopped||!1===pe[nt].options.bubblingMouseEvents&&-1!==Ya(this._mouseEvents,T))return}},_draggableMoved:function(x){return(x=x.dragging&&x.dragging.enabled()?x:this).dragging&&x.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var x=0,T=this._handlers.length;x<T;x++)this._handlers[x].disable()},whenReady:function(x,T){return this._loaded?x.call(T||this,{target:this}):this.on("load",x,T),this},_getMapPanePos:function(){return tr(this._mapPane)||new Pi(0,0)},_moved:function(){var x=this._getMapPanePos();return x&&!x.equals([0,0])},_getTopLeftPoint:function(x,T){return(x&&void 0!==T?this._getNewPixelOrigin(x,T):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(x,T){var H=this.getSize()._divideBy(2);return this.project(x,T)._subtract(H)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(x,T,H){var ee=this._getNewPixelOrigin(H,T);return this.project(x,T)._subtract(ee)},_latLngBoundsToNewLayerBounds:function(x,T,H){var ee=this._getNewPixelOrigin(H,T);return Yo([this.project(x.getSouthWest(),T)._subtract(ee),this.project(x.getNorthWest(),T)._subtract(ee),this.project(x.getSouthEast(),T)._subtract(ee),this.project(x.getNorthEast(),T)._subtract(ee)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(x){return this.latLngToLayerPoint(x).subtract(this._getCenterLayerPoint())},_limitCenter:function(x,T,H){if(!H)return x;var ee=this.project(x,T),pe=this.getSize().divideBy(2),Ee=new Sr(ee.subtract(pe),ee.add(pe)),nt=this._getBoundsOffset(Ee,H,T);return Math.abs(nt.x)<=1&&Math.abs(nt.y)<=1?x:this.unproject(ee.add(nt),T)},_limitOffset:function(x,T){if(!T)return x;var H=this.getPixelBounds(),ee=new Sr(H.min.add(x),H.max.add(x));return x.add(this._getBoundsOffset(ee,T))},_getBoundsOffset:function(x,T,H){var ee=Yo(this.project(T.getNorthEast(),H),this.project(T.getSouthWest(),H)),pe=ee.min.subtract(x.min),Ee=ee.max.subtract(x.max);return new Pi(this._rebound(pe.x,-Ee.x),this._rebound(pe.y,-Ee.y))},_rebound:function(x,T){return x+T>0?Math.round(x-T)/2:Math.max(0,Math.ceil(x))-Math.max(0,Math.floor(T))},_limitZoom:function(x){var T=this.getMinZoom(),H=this.getMaxZoom(),ee=Ne.any3d?this.options.zoomSnap:1;return ee&&(x=Math.round(x/ee)*ee),Math.max(T,Math.min(H,x))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Oo(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(x,T){var H=this._getCenterOffset(x)._trunc();return!(!0!==(T&&T.animate)&&!this.getSize().contains(H)||(this.panBy(H,T),0))},_createAnimProxy:function(){var x=this._proxy=rr("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(x),this.on("zoomanim",function(T){var H=ka,ee=this._proxy.style[H];na(this._proxy,this.project(T.center,T.zoom),this.getZoomScale(T.zoom,1)),ee===this._proxy.style[H]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){yo(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var x=this.getCenter(),T=this.getZoom();na(this._proxy,this.project(x,T),this.getZoomScale(T,1))},_catchTransitionEnd:function(x){this._animatingZoom&&x.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(x,T,H){if(this._animatingZoom)return!0;if(H=H||{},!this._zoomAnimated||!1===H.animate||this._nothingToAnimate()||Math.abs(T-this._zoom)>this.options.zoomAnimationThreshold)return!1;var ee=this.getZoomScale(T),pe=this._getCenterOffset(x)._divideBy(1-1/ee);return!(!0!==H.animate&&!this.getSize().contains(pe)||(Co(function(){this._moveStart(!0,H.noMoveStart||!1)._animateZoom(x,T,!0)},this),0))},_animateZoom:function(x,T,H,ee){this._mapPane&&(H&&(this._animatingZoom=!0,this._animateToCenter=x,this._animateToZoom=T,ti(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:x,zoom:T,noUpdate:ee}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(p(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Oo(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var Sa=Cr.extend({options:{position:"topright"},initialize:function(x){mr(this,x)},getPosition:function(){return this.options.position},setPosition:function(x){var T=this._map;return T&&T.removeControl(this),this.options.position=x,T&&T.addControl(this),this},getContainer:function(){return this._container},addTo:function(x){this.remove(),this._map=x;var T=this._container=this.onAdd(x),H=this.getPosition(),ee=x._controlCorners[H];return ti(T,"leaflet-control"),-1!==H.indexOf("bottom")?ee.insertBefore(T,ee.firstChild):ee.appendChild(T),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(yo(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(x){this._map&&x&&x.screenX>0&&x.screenY>0&&this._map.getContainer().focus()}}),Xo=function(x){return new Sa(x)};On.include({addControl:function(x){return x.addTo(this),this},removeControl:function(x){return x.remove(),this},_initControlPos:function(){var x=this._controlCorners={},T="leaflet-",H=this._controlContainer=rr("div",T+"control-container",this._container);function ee(pe,Ee){x[pe+Ee]=rr("div",T+pe+" "+T+Ee,H)}ee("top","left"),ee("top","right"),ee("bottom","left"),ee("bottom","right")},_clearControlPos:function(){for(var x in this._controlCorners)yo(this._controlCorners[x]);yo(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var vn=Sa.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(x,T,H,ee){return H<ee?-1:ee<H?1:0}},initialize:function(x,T,H){for(var ee in mr(this,H),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,x)this._addLayer(x[ee],ee);for(ee in T)this._addLayer(T[ee],ee,!0)},onAdd:function(x){this._initLayout(),this._update(),this._map=x,x.on("zoomend",this._checkDisabledLayers,this);for(var T=0;T<this._layers.length;T++)this._layers[T].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(x){return Sa.prototype.addTo.call(this,x),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(x,T){return this._addLayer(x,T),this._map?this._update():this},addOverlay:function(x,T){return this._addLayer(x,T,!0),this._map?this._update():this},removeLayer:function(x){x.off("add remove",this._onLayerChange,this);var T=this._getLayer(oi(x));return T&&this._layers.splice(this._layers.indexOf(T),1),this._map?this._update():this},expand:function(){ti(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var x=this._map.getSize().y-(this._container.offsetTop+50);return x<this._section.clientHeight?(ti(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=x+"px"):Oo(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Oo(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var x="leaflet-control-layers",T=this._container=rr("div",x),H=this.options.collapsed;T.setAttribute("aria-haspopup",!0),vl(T),ad(T);var ee=this._section=rr("section",x+"-list");H&&(this._map.on("click",this.collapse,this),jn(T,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var pe=this._layersLink=rr("a",x+"-toggle",T);pe.href="#",pe.title="Layers",pe.setAttribute("role","button"),jn(pe,{keydown:function(Ee){13===Ee.keyCode&&this._expandSafely()},click:function(Ee){Ws(Ee),this._expandSafely()}},this),H||this.expand(),this._baseLayersList=rr("div",x+"-base",ee),this._separator=rr("div",x+"-separator",ee),this._overlaysList=rr("div",x+"-overlays",ee),T.appendChild(ee)},_getLayer:function(x){for(var T=0;T<this._layers.length;T++)if(this._layers[T]&&oi(this._layers[T].layer)===x)return this._layers[T]},_addLayer:function(x,T,H){this._map&&x.on("add remove",this._onLayerChange,this),this._layers.push({layer:x,name:T,overlay:H}),this.options.sortLayers&&this._layers.sort(p(function(ee,pe){return this.options.sortFunction(ee.layer,pe.layer,ee.name,pe.name)},this)),this.options.autoZIndex&&x.setZIndex&&(this._lastZIndex++,x.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;gc(this._baseLayersList),gc(this._overlaysList),this._layerControlInputs=[];var x,T,H,ee,pe=0;for(H=0;H<this._layers.length;H++)this._addItem(ee=this._layers[H]),T=T||ee.overlay,x=x||!ee.overlay,pe+=ee.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(x=x&&pe>1)?"":"none"),this._separator.style.display=T&&x?"":"none",this},_onLayerChange:function(x){this._handlingClick||this._update();var T=this._getLayer(oi(x.target)),H=T.overlay?"add"===x.type?"overlayadd":"overlayremove":"add"===x.type?"baselayerchange":null;H&&this._map.fire(H,T)},_createRadioElement:function(x,T){var H='<input type="radio" class="leaflet-control-layers-selector" name="'+x+'"'+(T?' checked="checked"':"")+"/>",ee=document.createElement("div");return ee.innerHTML=H,ee.firstChild},_addItem:function(x){var ee,T=document.createElement("label"),H=this._map.hasLayer(x.layer);x.overlay?((ee=document.createElement("input")).type="checkbox",ee.className="leaflet-control-layers-selector",ee.defaultChecked=H):ee=this._createRadioElement("leaflet-base-layers_"+oi(this),H),this._layerControlInputs.push(ee),ee.layerId=oi(x.layer),jn(ee,"click",this._onInputClick,this);var pe=document.createElement("span");pe.innerHTML=" "+x.name;var Ee=document.createElement("span");return T.appendChild(Ee),Ee.appendChild(ee),Ee.appendChild(pe),(x.overlay?this._overlaysList:this._baseLayersList).appendChild(T),this._checkDisabledLayers(),T},_onInputClick:function(){if(!this._preventClick){var T,H,x=this._layerControlInputs,ee=[],pe=[];this._handlingClick=!0;for(var Ee=x.length-1;Ee>=0;Ee--)H=this._getLayer((T=x[Ee]).layerId).layer,T.checked?ee.push(H):T.checked||pe.push(H);for(Ee=0;Ee<pe.length;Ee++)this._map.hasLayer(pe[Ee])&&this._map.removeLayer(pe[Ee]);for(Ee=0;Ee<ee.length;Ee++)this._map.hasLayer(ee[Ee])||this._map.addLayer(ee[Ee]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var T,H,x=this._layerControlInputs,ee=this._map.getZoom(),pe=x.length-1;pe>=0;pe--)H=this._getLayer((T=x[pe]).layerId).layer,T.disabled=void 0!==H.options.minZoom&&ee<H.options.minZoom||void 0!==H.options.maxZoom&&ee>H.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var x=this._section;this._preventClick=!0,jn(x,"click",Ws),this.expand();var T=this;setTimeout(function(){po(x,"click",Ws),T._preventClick=!1})}}),Ii=Sa.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(x){var T="leaflet-control-zoom",H=rr("div",T+" leaflet-bar"),ee=this.options;return this._zoomInButton=this._createButton(ee.zoomInText,ee.zoomInTitle,T+"-in",H,this._zoomIn),this._zoomOutButton=this._createButton(ee.zoomOutText,ee.zoomOutTitle,T+"-out",H,this._zoomOut),this._updateDisabled(),x.on("zoomend zoomlevelschange",this._updateDisabled,this),H},onRemove:function(x){x.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(x){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(x.shiftKey?3:1))},_zoomOut:function(x){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(x.shiftKey?3:1))},_createButton:function(x,T,H,ee,pe){var Ee=rr("a",H,ee);return Ee.innerHTML=x,Ee.href="#",Ee.title=T,Ee.setAttribute("role","button"),Ee.setAttribute("aria-label",T),vl(Ee),jn(Ee,"click",Ll),jn(Ee,"click",pe,this),jn(Ee,"click",this._refocusOnMap,this),Ee},_updateDisabled:function(){var x=this._map,T="leaflet-disabled";Oo(this._zoomInButton,T),Oo(this._zoomOutButton,T),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||x._zoom===x.getMinZoom())&&(ti(this._zoomOutButton,T),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||x._zoom===x.getMaxZoom())&&(ti(this._zoomInButton,T),this._zoomInButton.setAttribute("aria-disabled","true"))}});On.mergeOptions({zoomControl:!0}),On.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ii,this.addControl(this.zoomControl))});var Uu=Sa.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(x){var T="leaflet-control-scale",H=rr("div",T),ee=this.options;return this._addScales(ee,T+"-line",H),x.on(ee.updateWhenIdle?"moveend":"move",this._update,this),x.whenReady(this._update,this),H},onRemove:function(x){x.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(x,T,H){x.metric&&(this._mScale=rr("div",T,H)),x.imperial&&(this._iScale=rr("div",T,H))},_update:function(){var x=this._map,T=x.getSize().y/2,H=x.distance(x.containerPointToLatLng([0,T]),x.containerPointToLatLng([this.options.maxWidth,T]));this._updateScales(H)},_updateScales:function(x){this.options.metric&&x&&this._updateMetric(x),this.options.imperial&&x&&this._updateImperial(x)},_updateMetric:function(x){var T=this._getRoundNum(x);this._updateScale(this._mScale,T<1e3?T+" m":T/1e3+" km",T/x)},_updateImperial:function(x){var H,ee,pe,T=3.2808399*x;T>5280?(ee=this._getRoundNum(H=T/5280),this._updateScale(this._iScale,ee+" mi",ee/H)):(pe=this._getRoundNum(T),this._updateScale(this._iScale,pe+" ft",pe/T))},_updateScale:function(x,T,H){x.style.width=Math.round(this.options.maxWidth*H)+"px",x.innerHTML=T},_getRoundNum:function(x){var T=Math.pow(10,(Math.floor(x)+"").length-1),H=x/T;return T*(H>=10?10:H>=5?5:H>=3?3:H>=2?2:1)}}),el=Sa.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ne.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(x){mr(this,x),this._attributions={}},onAdd:function(x){for(var T in x.attributionControl=this,this._container=rr("div","leaflet-control-attribution"),vl(this._container),x._layers)x._layers[T].getAttribution&&this.addAttribution(x._layers[T].getAttribution());return this._update(),x.on("layeradd",this._addAttribution,this),this._container},onRemove:function(x){x.off("layeradd",this._addAttribution,this)},_addAttribution:function(x){x.layer.getAttribution&&(this.addAttribution(x.layer.getAttribution()),x.layer.once("remove",function(){this.removeAttribution(x.layer.getAttribution())},this))},setPrefix:function(x){return this.options.prefix=x,this._update(),this},addAttribution:function(x){return x?(this._attributions[x]||(this._attributions[x]=0),this._attributions[x]++,this._update(),this):this},removeAttribution:function(x){return x?(this._attributions[x]&&(this._attributions[x]--,this._update()),this):this},_update:function(){if(this._map){var x=[];for(var T in this._attributions)this._attributions[T]&&x.push(T);var H=[];this.options.prefix&&H.push(this.options.prefix),x.length&&H.push(x.join(", ")),this._container.innerHTML=H.join(' <span aria-hidden="true">|</span> ')}}});On.mergeOptions({attributionControl:!0}),On.addInitHook(function(){this.options.attributionControl&&(new el).addTo(this)});Sa.Layers=vn,Sa.Zoom=Ii,Sa.Scale=Uu,Sa.Attribution=el,Xo.layers=function(x,T,H){return new vn(x,T,H)},Xo.zoom=function(x){return new Ii(x)},Xo.scale=function(x){return new Uu(x)},Xo.attribution=function(x){return new el(x)};var Ea=Cr.extend({initialize:function(x){this._map=x},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ea.addTo=function(x,T){return x.addHandler(T,this),this};var bl={Events:no},ld=Ne.touch?"touchstart mousedown":"mousedown",Fi=wa.extend({options:{clickTolerance:3},initialize:function(x,T,H,ee){mr(this,ee),this._element=x,this._dragStartTarget=T||x,this._preventOutline=H},enable:function(){this._enabled||(jn(this._dragStartTarget,ld,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Fi._dragging===this&&this.finishDrag(!0),po(this._dragStartTarget,ld,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(x){if(this._enabled&&(this._moved=!1,!sd(this._element,"leaflet-zoom-anim"))){if(x.touches&&1!==x.touches.length)return void(Fi._dragging===this&&this.finishDrag());if(!(Fi._dragging||x.shiftKey||1!==x.which&&1!==x.button&&!x.touches||(Fi._dragging=this,this._preventOutline&&vc(this._element),Tr(),Ls(),this._moving))){this.fire("down");var T=x.touches?x.touches[0]:x,H=Ht(this._element);this._startPoint=new Pi(T.clientX,T.clientY),this._startPos=tr(this._element),this._parentScale=Uc(H);var ee="mousedown"===x.type;jn(document,ee?"mousemove":"touchmove",this._onMove,this),jn(document,ee?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(x){if(this._enabled){if(x.touches&&x.touches.length>1)return void(this._moved=!0);var T=x.touches&&1===x.touches.length?x.touches[0]:x,H=new Pi(T.clientX,T.clientY)._subtract(this._startPoint);!H.x&&!H.y||Math.abs(H.x)+Math.abs(H.y)<this.options.clickTolerance||(H.x/=this._parentScale.x,H.y/=this._parentScale.y,Ws(x),this._moved||(this.fire("dragstart"),this._moved=!0,ti(document.body,"leaflet-dragging"),this._lastTarget=x.target||x.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ti(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(H),this._moving=!0,this._lastEvent=x,this._updatePosition())}},_updatePosition:function(){var x={originalEvent:this._lastEvent};this.fire("predrag",x),uo(this._element,this._newPos),this.fire("drag",x)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(x){Oo(document.body,"leaflet-dragging"),this._lastTarget&&(Oo(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),po(document,"mousemove touchmove",this._onMove,this),po(document,"mouseup touchend touchcancel",this._onUp,this),Ri(),Ro();var T=this._moved&&this._moving;this._moving=!1,Fi._dragging=!1,T&&this.fire("dragend",{noInertia:x,distance:this._newPos.distanceTo(this._startPos)})}});function yn(x,T,H){var ee,Ee,nt,St,yt,on,Y,J,fe,pe=[1,4,2,8];for(Ee=0,Y=x.length;Ee<Y;Ee++)x[Ee]._code=bc(x[Ee],T);for(St=0;St<4;St++){for(J=pe[St],ee=[],Ee=0,nt=(Y=x.length)-1;Ee<Y;nt=Ee++)on=x[nt],(yt=x[Ee])._code&J?on._code&J||((fe=zl(on,yt,J,T,H))._code=bc(fe,T),ee.push(fe)):(on._code&J&&((fe=zl(on,yt,J,T,H))._code=bc(fe,T),ee.push(fe)),ee.push(yt));x=ee}return x}function nr(x,T){var H,ee,pe,Ee,nt,St,yt,on;if(!x||0===x.length)throw new Error("latlngs not passed");ia(x)||(console.warn("latlngs are not flat! Only the first ring will be used"),x=x[0]);var J=si([0,0]),fe=Sn(x);fe.getNorthWest().distanceTo(fe.getSouthWest())*fe.getNorthEast().distanceTo(fe.getNorthWest())<1700&&(J=bi(x));var At=x.length,xn=[];for(H=0;H<At;H++){var Mi=si(x[H]);xn.push(T.project(si([Mi.lat-J.lat,Mi.lng-J.lng])))}for(St=yt=on=0,H=0,ee=At-1;H<At;ee=H++)yt+=((pe=xn[H]).x+(Ee=xn[ee]).x)*(nt=pe.y*Ee.x-Ee.y*pe.x),on+=(pe.y+Ee.y)*nt,St+=3*nt;var yr=T.unproject(yi(0===St?xn[0]:[yt/St,on/St]));return si([yr.lat+J.lat,yr.lng+J.lng])}function bi(x){for(var T=0,H=0,ee=0,pe=0;pe<x.length;pe++){var Ee=si(x[pe]);T+=Ee.lat,H+=Ee.lng,ee++}return si([T/ee,H/ee])}var To,Da={__proto__:null,clipPolygon:yn,polygonCenter:nr,centroid:bi};function cd(x,T){if(!T||!x.length)return x.slice();var H=T*T;return function au(x,T){var H=x.length,pe=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(H);pe[0]=pe[H-1]=1,tn(x,pe,T,0,H-1);var Ee,nt=[];for(Ee=0;Ee<H;Ee++)pe[Ee]&&nt.push(x[Ee]);return nt}(x=function Zs(x,T){for(var H=[x[0]],ee=1,pe=0,Ee=x.length;ee<Ee;ee++)qc(x[ee],x[pe])>T&&(H.push(x[ee]),pe=ee);return pe<Ee-1&&H.push(x[Ee-1]),H}(x,H),H)}function Hn(x,T,H){return Math.sqrt(xl(x,T,H,!0))}function tn(x,T,H,ee,pe){var nt,St,yt,Ee=0;for(St=ee+1;St<=pe-1;St++)(yt=xl(x[St],x[ee],x[pe],!0))>Ee&&(nt=St,Ee=yt);Ee>H&&(T[nt]=1,tn(x,T,H,ee,nt),tn(x,T,H,nt,pe))}function $u(x,T,H,ee,pe){var St,yt,on,Ee=ee?To:bc(x,H),nt=bc(T,H);for(To=nt;;){if(!(Ee|nt))return[x,T];if(Ee&nt)return!1;on=bc(yt=zl(x,T,St=Ee||nt,H,pe),H),St===Ee?(x=yt,Ee=on):(T=yt,nt=on)}}function zl(x,T,H,ee,pe){var on,Y,Ee=T.x-x.x,nt=T.y-x.y,St=ee.min,yt=ee.max;return 8&H?(on=x.x+Ee*(yt.y-x.y)/nt,Y=yt.y):4&H?(on=x.x+Ee*(St.y-x.y)/nt,Y=St.y):2&H?(on=yt.x,Y=x.y+nt*(yt.x-x.x)/Ee):1&H&&(on=St.x,Y=x.y+nt*(St.x-x.x)/Ee),new Pi(on,Y,pe)}function bc(x,T){var H=0;return x.x<T.min.x?H|=1:x.x>T.max.x&&(H|=2),x.y<T.min.y?H|=4:x.y>T.max.y&&(H|=8),H}function qc(x,T){var H=T.x-x.x,ee=T.y-x.y;return H*H+ee*ee}function xl(x,T,H,ee){var on,pe=T.x,Ee=T.y,nt=H.x-pe,St=H.y-Ee,yt=nt*nt+St*St;return yt>0&&((on=((x.x-pe)*nt+(x.y-Ee)*St)/yt)>1?(pe=H.x,Ee=H.y):on>0&&(pe+=nt*on,Ee+=St*on)),nt=x.x-pe,St=x.y-Ee,ee?nt*nt+St*St:new Pi(pe,Ee)}function ia(x){return!Uo(x[0])||"object"!=typeof x[0][0]&&typeof x[0][0]<"u"}function Ta(x){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ia(x)}function Nl(x,T){var H,ee,pe,Ee,nt,St,yt,on;if(!x||0===x.length)throw new Error("latlngs not passed");ia(x)||(console.warn("latlngs are not flat! Only the first ring will be used"),x=x[0]);var Y=si([0,0]),J=Sn(x);J.getNorthWest().distanceTo(J.getSouthWest())*J.getNorthEast().distanceTo(J.getNorthWest())<1700&&(Y=bi(x));var Ue=x.length,At=[];for(H=0;H<Ue;H++){var xn=si(x[H]);At.push(T.project(si([xn.lat-Y.lat,xn.lng-Y.lng])))}for(H=0,ee=0;H<Ue-1;H++)ee+=At[H].distanceTo(At[H+1])/2;if(0===ee)on=At[0];else for(H=0,Ee=0;H<Ue-1;H++)if((Ee+=pe=(nt=At[H]).distanceTo(St=At[H+1]))>ee){on=[St.x-(yt=(Ee-ee)/pe)*(St.x-nt.x),St.y-yt*(St.y-nt.y)];break}var Mi=T.unproject(yi(on));return si([Mi.lat+Y.lat,Mi.lng+Y.lng])}var ja={__proto__:null,simplify:cd,pointToSegmentDistance:Hn,closestPointOnSegment:function zd(x,T,H){return xl(x,T,H)},clipSegment:$u,_getEdgeIntersection:zl,_getBitCode:bc,_sqClosestPointOnSegment:xl,isFlat:ia,_flat:Ta,polylineCenter:Nl},$c={project:function(x){return new Pi(x.lng,x.lat)},unproject:function(x){return new ei(x.y,x.x)},bounds:new Sr([-180,-90],[180,90])},Ql={R:6378137,R_MINOR:6356752.314245179,bounds:new Sr([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(x){var T=Math.PI/180,H=this.R,ee=x.lat*T,pe=this.R_MINOR/H,Ee=Math.sqrt(1-pe*pe),nt=Ee*Math.sin(ee),St=Math.tan(Math.PI/4-ee/2)/Math.pow((1-nt)/(1+nt),Ee/2);return ee=-H*Math.log(Math.max(St,1e-10)),new Pi(x.lng*T*H,ee)},unproject:function(x){for(var on,T=180/Math.PI,H=this.R,ee=this.R_MINOR/H,pe=Math.sqrt(1-ee*ee),Ee=Math.exp(-x.y/H),nt=Math.PI/2-2*Math.atan(Ee),St=0,yt=.1;St<15&&Math.abs(yt)>1e-7;St++)on=pe*Math.sin(nt),on=Math.pow((1-on)/(1+on),pe/2),nt+=yt=Math.PI/2-2*Math.atan(Ee*on)-nt;return new ei(nt*T,x.x*T/H)}},Vo={__proto__:null,LonLat:$c,Mercator:Ql,SphericalMercator:zi},ra=co({},ui,{code:"EPSG:3395",projection:Ql,transformation:function(){var x=.5/(Math.PI*Ql.R);return Vr(x,.5,-x,.5)}()}),Yn=co({},ui,{code:"EPSG:4326",projection:$c,transformation:Vr(1/180,1,-1/180,.5)}),rn=co({},Lr,{projection:$c,transformation:Vr(1,0,-1,0),scale:function(x){return Math.pow(2,x)},zoom:function(x){return Math.log(x)/Math.LN2},distance:function(x,T){var H=T.lng-x.lng,ee=T.lat-x.lat;return Math.sqrt(H*H+ee*ee)},infinite:!0});Lr.Earth=ui,Lr.EPSG3395=ra,Lr.EPSG3857=dc,Lr.EPSG900913=Id,Lr.EPSG4326=Yn,Lr.Simple=rn;var oa=wa.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(x){return x.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(x){return x&&x.removeLayer(this),this},getPane:function(x){return this._map.getPane(x?this.options[x]||x:this.options.pane)},addInteractiveTarget:function(x){return this._map._targets[oi(x)]=this,this},removeInteractiveTarget:function(x){return delete this._map._targets[oi(x)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(x){var T=x.target;if(T.hasLayer(this)){if(this._map=T,this._zoomAnimated=T._zoomAnimated,this.getEvents){var H=this.getEvents();T.on(H,this),this.once("remove",function(){T.off(H,this)},this)}this.onAdd(T),this.fire("add"),T.fire("layeradd",{layer:this})}}});On.include({addLayer:function(x){if(!x._layerAdd)throw new Error("The provided object is not a Layer.");var T=oi(x);return this._layers[T]||(this._layers[T]=x,x._mapToAdd=this,x.beforeAdd&&x.beforeAdd(this),this.whenReady(x._layerAdd,x)),this},removeLayer:function(x){var T=oi(x);return this._layers[T]?(this._loaded&&x.onRemove(this),delete this._layers[T],this._loaded&&(this.fire("layerremove",{layer:x}),x.fire("remove")),x._map=x._mapToAdd=null,this):this},hasLayer:function(x){return oi(x)in this._layers},eachLayer:function(x,T){for(var H in this._layers)x.call(T,this._layers[H]);return this},_addLayers:function(x){for(var T=0,H=(x=x?Uo(x)?x:[x]:[]).length;T<H;T++)this.addLayer(x[T])},_addZoomLimit:function(x){(!isNaN(x.options.maxZoom)||!isNaN(x.options.minZoom))&&(this._zoomBoundLayers[oi(x)]=x,this._updateZoomLevels())},_removeZoomLimit:function(x){var T=oi(x);this._zoomBoundLayers[T]&&(delete this._zoomBoundLayers[T],this._updateZoomLevels())},_updateZoomLevels:function(){var x=1/0,T=-1/0,H=this._getZoomSpan();for(var ee in this._zoomBoundLayers){var pe=this._zoomBoundLayers[ee].options;x=void 0===pe.minZoom?x:Math.min(x,pe.minZoom),T=void 0===pe.maxZoom?T:Math.max(T,pe.maxZoom)}this._layersMaxZoom=T===-1/0?void 0:T,this._layersMinZoom=x===1/0?void 0:x,H!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var kn=oa.extend({initialize:function(x,T){var H,ee;if(mr(this,T),this._layers={},x)for(H=0,ee=x.length;H<ee;H++)this.addLayer(x[H])},addLayer:function(x){var T=this.getLayerId(x);return this._layers[T]=x,this._map&&this._map.addLayer(x),this},removeLayer:function(x){var T=x in this._layers?x:this.getLayerId(x);return this._map&&this._layers[T]&&this._map.removeLayer(this._layers[T]),delete this._layers[T],this},hasLayer:function(x){return("number"==typeof x?x:this.getLayerId(x))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(x){var H,ee,T=Array.prototype.slice.call(arguments,1);for(H in this._layers)(ee=this._layers[H])[x]&&ee[x].apply(ee,T);return this},onAdd:function(x){this.eachLayer(x.addLayer,x)},onRemove:function(x){this.eachLayer(x.removeLayer,x)},eachLayer:function(x,T){for(var H in this._layers)x.call(T,this._layers[H]);return this},getLayer:function(x){return this._layers[x]},getLayers:function(){var x=[];return this.eachLayer(x.push,x),x},setZIndex:function(x){return this.invoke("setZIndex",x)},getLayerId:function(x){return oi(x)}}),vs=kn.extend({addLayer:function(x){return this.hasLayer(x)?this:(x.addEventParent(this),kn.prototype.addLayer.call(this,x),this.fire("layeradd",{layer:x}))},removeLayer:function(x){return this.hasLayer(x)?(x in this._layers&&(x=this._layers[x]),x.removeEventParent(this),kn.prototype.removeLayer.call(this,x),this.fire("layerremove",{layer:x})):this},setStyle:function(x){return this.invoke("setStyle",x)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var x=new Bo;for(var T in this._layers){var H=this._layers[T];x.extend(H.getBounds?H.getBounds():H.getLatLng())}return x}}),Dt=Cr.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(x){mr(this,x)},createIcon:function(x){return this._createIcon("icon",x)},createShadow:function(x){return this._createIcon("shadow",x)},_createIcon:function(x,T){var H=this._getIconUrl(x);if(!H){if("icon"===x)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var ee=this._createImg(H,T&&"IMG"===T.tagName?T:null);return this._setIconStyles(ee,x),(this.options.crossOrigin||""===this.options.crossOrigin)&&(ee.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),ee},_setIconStyles:function(x,T){var H=this.options,ee=H[T+"Size"];"number"==typeof ee&&(ee=[ee,ee]);var pe=yi(ee),Ee=yi("shadow"===T&&H.shadowAnchor||H.iconAnchor||pe&&pe.divideBy(2,!0));x.className="leaflet-marker-"+T+" "+(H.className||""),Ee&&(x.style.marginLeft=-Ee.x+"px",x.style.marginTop=-Ee.y+"px"),pe&&(x.style.width=pe.x+"px",x.style.height=pe.y+"px")},_createImg:function(x,T){return(T=T||document.createElement("img")).src=x,T},_getIconUrl:function(x){return Ne.retina&&this.options[x+"RetinaUrl"]||this.options[x+"Url"]}});var Rn=Dt.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(x){return"string"!=typeof Rn.imagePath&&(Rn.imagePath=this._detectIconPath()),(this.options.imagePath||Rn.imagePath)+Dt.prototype._getIconUrl.call(this,x)},_stripUrl:function(x){var T=function(H,ee,pe){var Ee=ee.exec(H);return Ee&&Ee[pe]};return(x=T(x,/^url\((['"])?(.+)\1\)$/,2))&&T(x,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var x=rr("div","leaflet-default-icon-path",document.body),T=cs(x,"background-image")||cs(x,"backgroundImage");if(document.body.removeChild(x),T=this._stripUrl(T))return T;var H=document.querySelector('link[href$="leaflet.css"]');return H?H.href.substring(0,H.href.length-11-1):""}}),dd=Ea.extend({initialize:function(x){this._marker=x},addHooks:function(){var x=this._marker._icon;this._draggable||(this._draggable=new Fi(x,x,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ti(x,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Oo(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(x){var T=this._marker,H=T._map,ee=this._marker.options.autoPanSpeed,pe=this._marker.options.autoPanPadding,Ee=tr(T._icon),nt=H.getPixelBounds(),St=H.getPixelOrigin(),yt=Yo(nt.min._subtract(St).add(pe),nt.max._subtract(St).subtract(pe));if(!yt.contains(Ee)){var on=yi((Math.max(yt.max.x,Ee.x)-yt.max.x)/(nt.max.x-yt.max.x)-(Math.min(yt.min.x,Ee.x)-yt.min.x)/(nt.min.x-yt.min.x),(Math.max(yt.max.y,Ee.y)-yt.max.y)/(nt.max.y-yt.max.y)-(Math.min(yt.min.y,Ee.y)-yt.min.y)/(nt.min.y-yt.min.y)).multiplyBy(ee);H.panBy(on,{animate:!1}),this._draggable._newPos._add(on),this._draggable._startPos._add(on),uo(T._icon,this._draggable._newPos),this._onDrag(x),this._panRequest=Co(this._adjustPan.bind(this,x))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(x){this._marker.options.autoPan&&(gr(this._panRequest),this._panRequest=Co(this._adjustPan.bind(this,x)))},_onDrag:function(x){var T=this._marker,H=T._shadow,ee=tr(T._icon),pe=T._map.layerPointToLatLng(ee);H&&uo(H,ee),T._latlng=pe,x.latlng=pe,x.oldLatLng=this._oldLatLng,T.fire("move",x).fire("drag",x)},_onDragEnd:function(x){gr(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",x)}}),ds=oa.extend({options:{icon:new Rn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(x,T){mr(this,T),this._latlng=si(x)},onAdd:function(x){this._zoomAnimated=this._zoomAnimated&&x.options.markerZoomAnimation,this._zoomAnimated&&x.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(x){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&x.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(x){var T=this._latlng;return this._latlng=si(x),this.update(),this.fire("move",{oldLatLng:T,latlng:this._latlng})},setZIndexOffset:function(x){return this.options.zIndexOffset=x,this.update()},getIcon:function(){return this.options.icon},setIcon:function(x){return this.options.icon=x,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var x=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(x)}return this},_initIcon:function(){var x=this.options,T="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),H=x.icon.createIcon(this._icon),ee=!1;H!==this._icon&&(this._icon&&this._removeIcon(),ee=!0,x.title&&(H.title=x.title),"IMG"===H.tagName&&(H.alt=x.alt||"")),ti(H,T),x.keyboard&&(H.tabIndex="0",H.setAttribute("role","button")),this._icon=H,x.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&jn(H,"focus",this._panOnFocus,this);var pe=x.icon.createShadow(this._shadow),Ee=!1;pe!==this._shadow&&(this._removeShadow(),Ee=!0),pe&&(ti(pe,T),pe.alt=""),this._shadow=pe,x.opacity<1&&this._updateOpacity(),ee&&this.getPane().appendChild(this._icon),this._initInteraction(),pe&&Ee&&this.getPane(x.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&po(this._icon,"focus",this._panOnFocus,this),yo(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&yo(this._shadow),this._shadow=null},_setPos:function(x){this._icon&&uo(this._icon,x),this._shadow&&uo(this._shadow,x),this._zIndex=x.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(x){this._icon&&(this._icon.style.zIndex=this._zIndex+x)},_animateZoom:function(x){var T=this._map._latLngToNewLayerPoint(this._latlng,x.zoom,x.center).round();this._setPos(T)},_initInteraction:function(){if(this.options.interactive&&(ti(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),dd)){var x=this.options.draggable;this.dragging&&(x=this.dragging.enabled(),this.dragging.disable()),this.dragging=new dd(this),x&&this.dragging.enable()}},setOpacity:function(x){return this.options.opacity=x,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var x=this.options.opacity;this._icon&&Os(this._icon,x),this._shadow&&Os(this._shadow,x)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var x=this._map;if(x){var T=this.options.icon.options,H=T.iconSize?yi(T.iconSize):yi(0,0),ee=T.iconAnchor?yi(T.iconAnchor):yi(0,0);x.panInside(this._latlng,{paddingTopLeft:ee,paddingBottomRight:H.subtract(ee)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var tl=oa.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(x){this._renderer=x.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(x){return mr(this,x),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&x&&Object.prototype.hasOwnProperty.call(x,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Bl=tl.extend({options:{fill:!0,radius:10},initialize:function(x,T){mr(this,T),this._latlng=si(x),this._radius=this.options.radius},setLatLng:function(x){var T=this._latlng;return this._latlng=si(x),this.redraw(),this.fire("move",{oldLatLng:T,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(x){return this.options.radius=this._radius=x,this.redraw()},getRadius:function(){return this._radius},setStyle:function(x){var T=x&&x.radius||this._radius;return tl.prototype.setStyle.call(this,x),this.setRadius(T),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var x=this._radius,T=this._radiusY||x,H=this._clickTolerance(),ee=[x+H,T+H];this._pxBounds=new Sr(this._point.subtract(ee),this._point.add(ee))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(x){return x.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Ys=Bl.extend({initialize:function(x,T,H){if("number"==typeof T&&(T=co({},H,{radius:T})),mr(this,T),this._latlng=si(x),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(x){return this._mRadius=x,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var x=[this._radius,this._radiusY||this._radius];return new Bo(this._map.layerPointToLatLng(this._point.subtract(x)),this._map.layerPointToLatLng(this._point.add(x)))},setStyle:tl.prototype.setStyle,_project:function(){var x=this._latlng.lng,T=this._latlng.lat,H=this._map,ee=H.options.crs;if(ee.distance===ui.distance){var pe=Math.PI/180,Ee=this._mRadius/ui.R/pe,nt=H.project([T+Ee,x]),St=H.project([T-Ee,x]),yt=nt.add(St).divideBy(2),on=H.unproject(yt).lat,Y=Math.acos((Math.cos(Ee*pe)-Math.sin(T*pe)*Math.sin(on*pe))/(Math.cos(T*pe)*Math.cos(on*pe)))/pe;(isNaN(Y)||0===Y)&&(Y=Ee/Math.cos(Math.PI/180*T)),this._point=yt.subtract(H.getPixelOrigin()),this._radius=isNaN(Y)?0:yt.x-H.project([on,x-Y]).x,this._radiusY=yt.y-nt.y}else{var J=ee.unproject(ee.project(this._latlng).subtract([this._mRadius,0]));this._point=H.latLngToLayerPoint(this._latlng),this._radius=this._point.x-H.latLngToLayerPoint(J).x}this._updateBounds()}});var Go=tl.extend({options:{smoothFactor:1,noClip:!1},initialize:function(x,T){mr(this,T),this._setLatLngs(x)},getLatLngs:function(){return this._latlngs},setLatLngs:function(x){return this._setLatLngs(x),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(x){for(var pe,Ee,T=1/0,H=null,ee=xl,nt=0,St=this._parts.length;nt<St;nt++)for(var yt=this._parts[nt],on=1,Y=yt.length;on<Y;on++){var J=ee(x,pe=yt[on-1],Ee=yt[on],!0);J<T&&(T=J,H=ee(x,pe,Ee))}return H&&(H.distance=Math.sqrt(T)),H},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Nl(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(x,T){return T=T||this._defaultShape(),x=si(x),T.push(x),this._bounds.extend(x),this.redraw()},_setLatLngs:function(x){this._bounds=new Bo,this._latlngs=this._convertLatLngs(x)},_defaultShape:function(){return ia(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(x){for(var T=[],H=ia(x),ee=0,pe=x.length;ee<pe;ee++)H?(T[ee]=si(x[ee]),this._bounds.extend(T[ee])):T[ee]=this._convertLatLngs(x[ee]);return T},_project:function(){var x=new Sr;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,x),this._bounds.isValid()&&x.isValid()&&(this._rawPxBounds=x,this._updateBounds())},_updateBounds:function(){var x=this._clickTolerance(),T=new Pi(x,x);this._rawPxBounds&&(this._pxBounds=new Sr([this._rawPxBounds.min.subtract(T),this._rawPxBounds.max.add(T)]))},_projectLatlngs:function(x,T,H){var Ee,nt,pe=x.length;if(x[0]instanceof ei){for(nt=[],Ee=0;Ee<pe;Ee++)nt[Ee]=this._map.latLngToLayerPoint(x[Ee]),H.extend(nt[Ee]);T.push(nt)}else for(Ee=0;Ee<pe;Ee++)this._projectLatlngs(x[Ee],T,H)},_clipPoints:function(){var x=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(x)){if(this.options.noClip)return void(this._parts=this._rings);var H,ee,pe,Ee,nt,St,yt,T=this._parts;for(H=0,pe=0,Ee=this._rings.length;H<Ee;H++)for(ee=0,nt=(yt=this._rings[H]).length;ee<nt-1;ee++)(St=$u(yt[ee],yt[ee+1],x,ee,!0))&&(T[pe]=T[pe]||[],T[pe].push(St[0]),(St[1]!==yt[ee+1]||ee===nt-2)&&(T[pe].push(St[1]),pe++))}},_simplifyPoints:function(){for(var x=this._parts,T=this.options.smoothFactor,H=0,ee=x.length;H<ee;H++)x[H]=cd(x[H],T)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(x,T){var H,ee,pe,Ee,nt,St,yt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(x))return!1;for(H=0,Ee=this._parts.length;H<Ee;H++)for(ee=0,pe=(nt=(St=this._parts[H]).length)-1;ee<nt;pe=ee++)if((T||0!==ee)&&Hn(x,St[pe],St[ee])<=yt)return!0;return!1}});Go._flat=Ta;var Er=Go.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return nr(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(x){var T=Go.prototype._convertLatLngs.call(this,x),H=T.length;return H>=2&&T[0]instanceof ei&&T[0].equals(T[H-1])&&T.pop(),T},_setLatLngs:function(x){Go.prototype._setLatLngs.call(this,x),ia(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ia(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var x=this._renderer._bounds,T=this.options.weight,H=new Pi(T,T);if(x=new Sr(x.min.subtract(H),x.max.add(H)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(x)){if(this.options.noClip)return void(this._parts=this._rings);for(var Ee,ee=0,pe=this._rings.length;ee<pe;ee++)(Ee=yn(this._rings[ee],x,!0)).length&&this._parts.push(Ee)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(x){var H,ee,pe,Ee,nt,St,yt,on,T=!1;if(!this._pxBounds||!this._pxBounds.contains(x))return!1;for(Ee=0,yt=this._parts.length;Ee<yt;Ee++)for(nt=0,St=(on=(H=this._parts[Ee]).length)-1;nt<on;St=nt++)(ee=H[nt]).y>x.y!=(pe=H[St]).y>x.y&&x.x<(pe.x-ee.x)*(x.y-ee.y)/(pe.y-ee.y)+ee.x&&(T=!T);return T||Go.prototype._containsPoint.call(this,x,!0)}});var kl=vs.extend({initialize:function(x,T){mr(this,T),this._layers={},x&&this.addData(x)},addData:function(x){var H,ee,pe,T=Uo(x)?x:x.features;if(T){for(H=0,ee=T.length;H<ee;H++)((pe=T[H]).geometries||pe.geometry||pe.features||pe.coordinates)&&this.addData(pe);return this}var Ee=this.options;if(Ee.filter&&!Ee.filter(x))return this;var nt=Ha(x,Ee);return nt?(nt.feature=Ih(x),nt.defaultOptions=nt.options,this.resetStyle(nt),Ee.onEachFeature&&Ee.onEachFeature(x,nt),this.addLayer(nt)):this},resetStyle:function(x){return void 0===x?this.eachLayer(this.resetStyle,this):(x.options=co({},x.defaultOptions),this._setLayerStyle(x,this.options.style),this)},setStyle:function(x){return this.eachLayer(function(T){this._setLayerStyle(T,x)},this)},_setLayerStyle:function(x,T){x.setStyle&&("function"==typeof T&&(T=T(x.feature)),x.setStyle(T))}});function Ha(x,T){var St,yt,on,Y,H="Feature"===x.type?x.geometry:x,ee=H?H.coordinates:null,pe=[],Ee=T&&T.pointToLayer,nt=T&&T.coordsToLatLng||Xs;if(!ee&&!H)return null;switch(H.type){case"Point":return hd(Ee,x,St=nt(ee),T);case"MultiPoint":for(on=0,Y=ee.length;on<Y;on++)St=nt(ee[on]),pe.push(hd(Ee,x,St,T));return new vs(pe);case"LineString":case"MultiLineString":return yt=ud(ee,"LineString"===H.type?0:1,nt),new Go(yt,T);case"Polygon":case"MultiPolygon":return yt=ud(ee,"Polygon"===H.type?1:2,nt),new Er(yt,T);case"GeometryCollection":for(on=0,Y=H.geometries.length;on<Y;on++){var J=Ha({geometry:H.geometries[on],type:"Feature",properties:x.properties},T);J&&pe.push(J)}return new vs(pe);case"FeatureCollection":for(on=0,Y=H.features.length;on<Y;on++){var fe=Ha(H.features[on],T);fe&&pe.push(fe)}return new vs(pe);default:throw new Error("Invalid GeoJSON object.")}}function hd(x,T,H,ee){return x?x(T,H):new ds(H,ee&&ee.markersInheritOptions&&ee)}function Xs(x){return new ei(x[1],x[0],x[2])}function ud(x,T,H){for(var nt,ee=[],pe=0,Ee=x.length;pe<Ee;pe++)nt=T?ud(x[pe],T-1,H):(H||Xs)(x[pe]),ee.push(nt);return ee}function lu(x,T){return void 0!==(x=si(x)).alt?[zt(x.lng,T),zt(x.lat,T),zt(x.alt,T)]:[zt(x.lng,T),zt(x.lat,T)]}function rh(x,T,H,ee){for(var pe=[],Ee=0,nt=x.length;Ee<nt;Ee++)pe.push(T?rh(x[Ee],ia(x[Ee])?0:T-1,H,ee):lu(x[Ee],ee));return!T&&H&&pe.length>0&&pe.push(pe[0].slice()),pe}function xc(x,T){return x.feature?co({},x.feature,{geometry:T}):Ih(T)}function Ih(x){return"Feature"===x.type||"FeatureCollection"===x.type?x:{type:"Feature",properties:{},geometry:x}}var Vd={toGeoJSON:function(x){return xc(this,{type:"Point",coordinates:lu(this.getLatLng(),x)})}};function jd(x,T){return new kl(x,T)}ds.include(Vd),Ys.include(Vd),Bl.include(Vd),Go.include({toGeoJSON:function(x){var T=!ia(this._latlngs);return xc(this,{type:(T?"Multi":"")+"LineString",coordinates:rh(this._latlngs,T?1:0,!1,x)})}}),Er.include({toGeoJSON:function(x){var T=!ia(this._latlngs),H=T&&!ia(this._latlngs[0]),ee=rh(this._latlngs,H?2:T?1:0,!0,x);return T||(ee=[ee]),xc(this,{type:(H?"Multi":"")+"Polygon",coordinates:ee})}}),kn.include({toMultiPoint:function(x){var T=[];return this.eachLayer(function(H){T.push(H.toGeoJSON(x).geometry.coordinates)}),xc(this,{type:"MultiPoint",coordinates:T})},toGeoJSON:function(x){var T=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===T)return this.toMultiPoint(x);var H="GeometryCollection"===T,ee=[];return this.eachLayer(function(pe){if(pe.toGeoJSON){var Ee=pe.toGeoJSON(x);if(H)ee.push(Ee.geometry);else{var nt=Ih(Ee);"FeatureCollection"===nt.type?ee.push.apply(ee,nt.features):ee.push(nt)}}}),H?xc(this,{geometries:ee,type:"GeometryCollection"}):{type:"FeatureCollection",features:ee}}});var Gc=jd,Hd=oa.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(x,T,H){this._url=x,this._bounds=Sn(T),mr(this,H)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ti(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){yo(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(x){return this.options.opacity=x,this._image&&this._updateOpacity(),this},setStyle:function(x){return x.opacity&&this.setOpacity(x.opacity),this},bringToFront:function(){return this._map&&_l(this._image),this},bringToBack:function(){return this._map&&_c(this._image),this},setUrl:function(x){return this._url=x,this._image&&(this._image.src=x),this},setBounds:function(x){return this._bounds=Sn(x),this._map&&this._reset(),this},getEvents:function(){var x={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(x.zoomanim=this._animateZoom),x},setZIndex:function(x){return this.options.zIndex=x,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var x="IMG"===this._url.tagName,T=this._image=x?this._url:rr("img");ti(T,"leaflet-image-layer"),this._zoomAnimated&&ti(T,"leaflet-zoom-animated"),this.options.className&&ti(T,this.options.className),T.onselectstart=Qr,T.onmousemove=Qr,T.onload=p(this.fire,this,"load"),T.onerror=p(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(T.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),x?this._url=T.src:(T.src=this._url,T.alt=this.options.alt)},_animateZoom:function(x){var T=this._map.getZoomScale(x.zoom),H=this._map._latLngBoundsToNewLayerBounds(this._bounds,x.zoom,x.center).min;na(this._image,H,T)},_reset:function(){var x=this._image,T=new Sr(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),H=T.getSize();uo(x,T.min),x.style.width=H.x+"px",x.style.height=H.y+"px"},_updateOpacity:function(){Os(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&null!=this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var x=this.options.errorOverlayUrl;x&&this._url!==x&&(this._url=x,this._image.src=x)},getCenter:function(){return this._bounds.getCenter()}}),Jl=Hd.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var x="VIDEO"===this._url.tagName,T=this._image=x?this._url:rr("video");if(ti(T,"leaflet-image-layer"),this._zoomAnimated&&ti(T,"leaflet-zoom-animated"),this.options.className&&ti(T,this.options.className),T.onselectstart=Qr,T.onmousemove=Qr,T.onloadeddata=p(this.fire,this,"load"),x){for(var H=T.getElementsByTagName("source"),ee=[],pe=0;pe<H.length;pe++)ee.push(H[pe].src);this._url=H.length>0?ee:[T.src]}else{Uo(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(T.style,"objectFit")&&(T.style.objectFit="fill"),T.autoplay=!!this.options.autoplay,T.loop=!!this.options.loop,T.muted=!!this.options.muted,T.playsInline=!!this.options.playsInline;for(var Ee=0;Ee<this._url.length;Ee++){var nt=rr("source");nt.src=this._url[Ee],T.appendChild(nt)}}}});var cu=Hd.extend({_initImage:function(){var x=this._image=this._url;ti(x,"leaflet-image-layer"),this._zoomAnimated&&ti(x,"leaflet-zoom-animated"),this.options.className&&ti(x,this.options.className),x.onselectstart=Qr,x.onmousemove=Qr}});var sa=oa.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(x,T){x&&(x instanceof ei||Uo(x))?(this._latlng=si(x),mr(this,T)):(mr(this,x),this._source=T),this.options.content&&(this._content=this.options.content)},openOn:function(x){return(x=arguments.length?x:this._source._map).hasLayer(this)||x.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(x){return this._map?this.close():(arguments.length?this._source=x:x=this._source,this._prepareOpen(),this.openOn(x._map)),this},onAdd:function(x){this._zoomAnimated=x._zoomAnimated,this._container||this._initLayout(),x._fadeAnimated&&Os(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),x._fadeAnimated&&Os(this._container,1),this.bringToFront(),this.options.interactive&&(ti(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(x){x._fadeAnimated?(Os(this._container,0),this._removeTimeout=setTimeout(p(yo,void 0,this._container),200)):yo(this._container),this.options.interactive&&(Oo(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(x){return this._latlng=si(x),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(x){return this._content=x,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var x={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(x.zoomanim=this._animateZoom),x},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_l(this._container),this},bringToBack:function(){return this._map&&_c(this._container),this},_prepareOpen:function(x){var T=this._source;if(!T._map)return!1;if(T instanceof vs){T=null;var H=this._source._layers;for(var ee in H)if(H[ee]._map){T=H[ee];break}if(!T)return!1;this._source=T}if(!x)if(T.getCenter)x=T.getCenter();else if(T.getLatLng)x=T.getLatLng();else{if(!T.getBounds)throw new Error("Unable to get source layer LatLng.");x=T.getBounds().getCenter()}return this.setLatLng(x),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var x=this._contentNode,T="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof T)x.innerHTML=T;else{for(;x.hasChildNodes();)x.removeChild(x.firstChild);x.appendChild(T)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var x=this._map.latLngToLayerPoint(this._latlng),T=yi(this.options.offset),H=this._getAnchor();this._zoomAnimated?uo(this._container,x.add(H)):T=T.add(x).add(H);var ee=this._containerBottom=-T.y,pe=this._containerLeft=-Math.round(this._containerWidth/2)+T.x;this._container.style.bottom=ee+"px",this._container.style.left=pe+"px"}},_getAnchor:function(){return[0,0]}});On.include({_initOverlay:function(x,T,H,ee){var pe=T;return pe instanceof x||(pe=new x(ee).setContent(T)),H&&pe.setLatLng(H),pe}}),oa.include({_initOverlay:function(x,T,H,ee){var pe=H;return pe instanceof x?(mr(pe,ee),pe._source=this):(pe=T&&!ee?T:new x(ee,this)).setContent(H),pe}});var wc=sa.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(x){return!(x=arguments.length?x:this._source._map).hasLayer(this)&&x._popup&&x._popup.options.autoClose&&x.removeLayer(x._popup),x._popup=this,sa.prototype.openOn.call(this,x)},onAdd:function(x){sa.prototype.onAdd.call(this,x),x.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof tl||this._source.on("preclick",Ja))},onRemove:function(x){sa.prototype.onRemove.call(this,x),x.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof tl||this._source.off("preclick",Ja))},getEvents:function(){var x=sa.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(x.preclick=this.close),this.options.keepInView&&(x.moveend=this._adjustPan),x},_initLayout:function(){var x="leaflet-popup",T=this._container=rr("div",x+" "+(this.options.className||"")+" leaflet-zoom-animated"),H=this._wrapper=rr("div",x+"-content-wrapper",T);if(this._contentNode=rr("div",x+"-content",H),vl(T),ad(this._contentNode),jn(T,"contextmenu",Ja),this._tipContainer=rr("div",x+"-tip-container",T),this._tip=rr("div",x+"-tip",this._tipContainer),this.options.closeButton){var ee=this._closeButton=rr("a",x+"-close-button",T);ee.setAttribute("role","button"),ee.setAttribute("aria-label","Close popup"),ee.href="#close",ee.innerHTML='<span aria-hidden="true">&#215;</span>',jn(ee,"click",function(pe){Ws(pe),this.close()},this)}},_updateLayout:function(){var x=this._contentNode,T=x.style;T.width="",T.whiteSpace="nowrap";var H=x.offsetWidth;H=Math.min(H,this.options.maxWidth),H=Math.max(H,this.options.minWidth),T.width=H+1+"px",T.whiteSpace="",T.height="";var pe=this.options.maxHeight,Ee="leaflet-popup-scrolled";pe&&x.offsetHeight>pe?(T.height=pe+"px",ti(x,Ee)):Oo(x,Ee),this._containerWidth=this._container.offsetWidth},_animateZoom:function(x){var T=this._map._latLngToNewLayerPoint(this._latlng,x.zoom,x.center),H=this._getAnchor();uo(this._container,T.add(H))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)return void(this._autopanning=!1);var x=this._map,T=parseInt(cs(this._container,"marginBottom"),10)||0,H=this._container.offsetHeight+T,ee=this._containerWidth,pe=new Pi(this._containerLeft,-H-this._containerBottom);pe._add(tr(this._container));var Ee=x.layerPointToContainerPoint(pe),nt=yi(this.options.autoPanPadding),St=yi(this.options.autoPanPaddingTopLeft||nt),yt=yi(this.options.autoPanPaddingBottomRight||nt),on=x.getSize(),Y=0,J=0;Ee.x+ee+yt.x>on.x&&(Y=Ee.x+ee-on.x+yt.x),Ee.x-Y-St.x<0&&(Y=Ee.x-St.x),Ee.y+H+yt.y>on.y&&(J=Ee.y+H-on.y+yt.y),Ee.y-J-St.y<0&&(J=Ee.y-St.y),(Y||J)&&(this.options.keepInView&&(this._autopanning=!0),x.fire("autopanstart").panBy([Y,J]))}},_getAnchor:function(){return yi(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});On.mergeOptions({closePopupOnClick:!0}),On.include({openPopup:function(x,T,H){return this._initOverlay(wc,x,T,H).openOn(this),this},closePopup:function(x){return(x=arguments.length?x:this._popup)&&x.close(),this}}),oa.include({bindPopup:function(x,T){return this._popup=this._initOverlay(wc,this._popup,x,T),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(x){return this._popup&&(this instanceof vs||(this._popup._source=this),this._popup._prepareOpen(x||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(x){return this._popup&&this._popup.setContent(x),this},getPopup:function(){return this._popup},_openPopup:function(x){if(this._popup&&this._map){Ll(x);var T=x.layer||x.target;if(this._popup._source===T&&!(T instanceof tl))return void(this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(x.latlng));this._popup._source=T,this.openPopup(x.latlng)}},_movePopup:function(x){this._popup.setLatLng(x.latlng)},_onKeyPress:function(x){13===x.originalEvent.keyCode&&this._openPopup(x)}});var Ud=sa.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(x){sa.prototype.onAdd.call(this,x),this.setOpacity(this.options.opacity),x.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(x){sa.prototype.onRemove.call(this,x),x.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var x=sa.prototype.getEvents.call(this);return this.options.permanent||(x.preclick=this.close),x},_initLayout:function(){this._contentNode=this._container=rr("div","leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide")),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+oi(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(x){var T,H,ee=this._map,pe=this._container,Ee=ee.latLngToContainerPoint(ee.getCenter()),nt=ee.layerPointToContainerPoint(x),St=this.options.direction,yt=pe.offsetWidth,on=pe.offsetHeight,Y=yi(this.options.offset),J=this._getAnchor();"top"===St?(T=yt/2,H=on):"bottom"===St?(T=yt/2,H=0):"center"===St?(T=yt/2,H=on/2):"right"===St?(T=0,H=on/2):"left"===St?(T=yt,H=on/2):nt.x<Ee.x?(St="right",T=0,H=on/2):(St="left",T=yt+2*(Y.x+J.x),H=on/2),x=x.subtract(yi(T,H,!0)).add(Y).add(J),Oo(pe,"leaflet-tooltip-right"),Oo(pe,"leaflet-tooltip-left"),Oo(pe,"leaflet-tooltip-top"),Oo(pe,"leaflet-tooltip-bottom"),ti(pe,"leaflet-tooltip-"+St),uo(pe,x)},_updatePosition:function(){var x=this._map.latLngToLayerPoint(this._latlng);this._setPosition(x)},setOpacity:function(x){this.options.opacity=x,this._container&&Os(this._container,x)},_animateZoom:function(x){var T=this._map._latLngToNewLayerPoint(this._latlng,x.zoom,x.center);this._setPosition(T)},_getAnchor:function(){return yi(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});On.include({openTooltip:function(x,T,H){return this._initOverlay(Ud,x,T,H).openOn(this),this},closeTooltip:function(x){return x.close(),this}}),oa.include({bindTooltip:function(x,T){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ud,this._tooltip,x,T),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(x){if(x||!this._tooltipHandlersAdded){var T=x?"off":"on",H={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?H.add=this._openTooltip:(H.mouseover=this._openTooltip,H.mouseout=this.closeTooltip,H.click=this._openTooltip,this._map?this._addFocusListeners():H.add=this._addFocusListeners),this._tooltip.options.sticky&&(H.mousemove=this._moveTooltip),this[T](H),this._tooltipHandlersAdded=!x}},openTooltip:function(x){return this._tooltip&&(this instanceof vs||(this._tooltip._source=this),this._tooltip._prepareOpen(x)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(x){return this._tooltip&&this._tooltip.setContent(x),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(x){var T="function"==typeof x.getElement&&x.getElement();T&&(jn(T,"focus",function(){this._tooltip._source=x,this.openTooltip()},this),jn(T,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(x){var T="function"==typeof x.getElement&&x.getElement();T&&T.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(x){if(this._tooltip&&this._map){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var T=this;return void this._map.once("moveend",function(){T._openOnceFlag=!1,T._openTooltip(x)})}this._tooltip._source=x.layer||x.target,this.openTooltip(this._tooltip.options.sticky?x.latlng:void 0)}},_moveTooltip:function(x){var H,ee,T=x.latlng;this._tooltip.options.sticky&&x.originalEvent&&(H=this._map.mouseEventToContainerPoint(x.originalEvent),ee=this._map.containerPointToLayerPoint(H),T=this._map.layerPointToLatLng(ee)),this._tooltip.setLatLng(T)}});var du=Dt.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(x){var T=x&&"DIV"===x.tagName?x:document.createElement("div"),H=this.options;if(H.html instanceof Element?(gc(T),T.appendChild(H.html)):T.innerHTML=!1!==H.html?H.html:"",H.bgPos){var ee=yi(H.bgPos);T.style.backgroundPosition=-ee.x+"px "+-ee.y+"px"}return this._setIconStyles(T,"icon"),T},createShadow:function(){return null}});Dt.Default=Rn;var qd=oa.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ne.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(x){mr(this,x)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(x){x._addZoomLimit(this)},onRemove:function(x){this._removeAllTiles(),yo(this._container),x._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_l(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(_c(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(x){return this.options.opacity=x,this._updateOpacity(),this},setZIndex:function(x){return this.options.zIndex=x,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var x=this._clampZoom(this._map.getZoom());x!==this._tileZoom&&(this._tileZoom=x,this._updateLevels()),this._update()}return this},getEvents:function(){var x={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Xl(this._onMoveEnd,this.options.updateInterval,this)),x.move=this._onMove),this._zoomAnimated&&(x.zoomanim=this._animateZoom),x},createTile:function(){return document.createElement("div")},getTileSize:function(){var x=this.options.tileSize;return x instanceof Pi?x:new Pi(x,x)},_updateZIndex:function(){this._container&&null!=this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(x){for(var Ee,T=this.getPane().children,H=-x(-1/0,1/0),ee=0,pe=T.length;ee<pe;ee++)Ee=T[ee].style.zIndex,T[ee]!==this._container&&Ee&&(H=x(H,+Ee));isFinite(H)&&(this.options.zIndex=H+x(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ne.ielt9){Os(this._container,this.options.opacity);var x=+new Date,T=!1,H=!1;for(var ee in this._tiles){var pe=this._tiles[ee];if(pe.current&&pe.loaded){var Ee=Math.min(1,(x-pe.loaded)/200);Os(pe.el,Ee),Ee<1?T=!0:(pe.active?H=!0:this._onOpaqueTile(pe),pe.active=!0)}}H&&!this._noPrune&&this._pruneTiles(),T&&(gr(this._fadeFrame),this._fadeFrame=Co(this._updateOpacity,this))}},_onOpaqueTile:Qr,_initContainer:function(){this._container||(this._container=rr("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var x=this._tileZoom,T=this.options.maxZoom;if(void 0!==x){for(var H in this._levels)H=Number(H),this._levels[H].el.children.length||H===x?(this._levels[H].el.style.zIndex=T-Math.abs(x-H),this._onUpdateLevel(H)):(yo(this._levels[H].el),this._removeTilesAtZoom(H),this._onRemoveLevel(H),delete this._levels[H]);var ee=this._levels[x],pe=this._map;return ee||((ee=this._levels[x]={}).el=rr("div","leaflet-tile-container leaflet-zoom-animated",this._container),ee.el.style.zIndex=T,ee.origin=pe.project(pe.unproject(pe.getPixelOrigin()),x).round(),ee.zoom=x,this._setZoomTransform(ee,pe.getCenter(),pe.getZoom()),this._onCreateLevel(ee)),this._level=ee,ee}},_onUpdateLevel:Qr,_onRemoveLevel:Qr,_onCreateLevel:Qr,_pruneTiles:function(){if(this._map){var x,T,H=this._map.getZoom();if(H>this.options.maxZoom||H<this.options.minZoom)return void this._removeAllTiles();for(x in this._tiles)(T=this._tiles[x]).retain=T.current;for(x in this._tiles)if((T=this._tiles[x]).current&&!T.active){var ee=T.coords;this._retainParent(ee.x,ee.y,ee.z,ee.z-5)||this._retainChildren(ee.x,ee.y,ee.z,ee.z+2)}for(x in this._tiles)this._tiles[x].retain||this._removeTile(x)}},_removeTilesAtZoom:function(x){for(var T in this._tiles)this._tiles[T].coords.z===x&&this._removeTile(T)},_removeAllTiles:function(){for(var x in this._tiles)this._removeTile(x)},_invalidateAll:function(){for(var x in this._levels)yo(this._levels[x].el),this._onRemoveLevel(Number(x)),delete this._levels[x];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(x,T,H,ee){var pe=Math.floor(x/2),Ee=Math.floor(T/2),nt=H-1,St=new Pi(+pe,+Ee);St.z=+nt;var yt=this._tileCoordsToKey(St),on=this._tiles[yt];return on&&on.active?(on.retain=!0,!0):(on&&on.loaded&&(on.retain=!0),nt>ee&&this._retainParent(pe,Ee,nt,ee))},_retainChildren:function(x,T,H,ee){for(var pe=2*x;pe<2*x+2;pe++)for(var Ee=2*T;Ee<2*T+2;Ee++){var nt=new Pi(pe,Ee);nt.z=H+1;var St=this._tileCoordsToKey(nt),yt=this._tiles[St];yt&&yt.active?yt.retain=!0:(yt&&yt.loaded&&(yt.retain=!0),H+1<ee&&this._retainChildren(pe,Ee,H+1,ee))}},_resetView:function(x){var T=x&&(x.pinch||x.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),T,T)},_animateZoom:function(x){this._setView(x.center,x.zoom,!0,x.noUpdate)},_clampZoom:function(x){var T=this.options;return void 0!==T.minNativeZoom&&x<T.minNativeZoom?T.minNativeZoom:void 0!==T.maxNativeZoom&&T.maxNativeZoom<x?T.maxNativeZoom:x},_setView:function(x,T,H,ee){var pe=Math.round(T);pe=void 0!==this.options.maxZoom&&pe>this.options.maxZoom||void 0!==this.options.minZoom&&pe<this.options.minZoom?void 0:this._clampZoom(pe),(!ee||this.options.updateWhenZooming&&pe!==this._tileZoom)&&(this._tileZoom=pe,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==pe&&this._update(x),H||this._pruneTiles(),this._noPrune=!!H),this._setZoomTransforms(x,T)},_setZoomTransforms:function(x,T){for(var H in this._levels)this._setZoomTransform(this._levels[H],x,T)},_setZoomTransform:function(x,T,H){var ee=this._map.getZoomScale(H,x.zoom),pe=x.origin.multiplyBy(ee).subtract(this._map._getNewPixelOrigin(T,H)).round();Ne.any3d?na(x.el,pe,ee):uo(x.el,pe)},_resetGrid:function(){var x=this._map,T=x.options.crs,H=this._tileSize=this.getTileSize(),ee=this._tileZoom,pe=this._map.getPixelWorldBounds(this._tileZoom);pe&&(this._globalTileRange=this._pxBoundsToTileRange(pe)),this._wrapX=T.wrapLng&&!this.options.noWrap&&[Math.floor(x.project([0,T.wrapLng[0]],ee).x/H.x),Math.ceil(x.project([0,T.wrapLng[1]],ee).x/H.y)],this._wrapY=T.wrapLat&&!this.options.noWrap&&[Math.floor(x.project([T.wrapLat[0],0],ee).y/H.x),Math.ceil(x.project([T.wrapLat[1],0],ee).y/H.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(x){var T=this._map,H=T._animatingZoom?Math.max(T._animateToZoom,T.getZoom()):T.getZoom(),ee=T.getZoomScale(H,this._tileZoom),pe=T.project(x,this._tileZoom).floor(),Ee=T.getSize().divideBy(2*ee);return new Sr(pe.subtract(Ee),pe.add(Ee))},_update:function(x){var T=this._map;if(T){var H=this._clampZoom(T.getZoom());if(void 0===x&&(x=T.getCenter()),void 0!==this._tileZoom){var ee=this._getTiledPixelBounds(x),pe=this._pxBoundsToTileRange(ee),Ee=pe.getCenter(),nt=[],St=this.options.keepBuffer,yt=new Sr(pe.getBottomLeft().subtract([St,-St]),pe.getTopRight().add([St,-St]));if(!(isFinite(pe.min.x)&&isFinite(pe.min.y)&&isFinite(pe.max.x)&&isFinite(pe.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var on in this._tiles){var Y=this._tiles[on].coords;(Y.z!==this._tileZoom||!yt.contains(new Pi(Y.x,Y.y)))&&(this._tiles[on].current=!1)}if(Math.abs(H-this._tileZoom)>1)return void this._setView(x,H);for(var J=pe.min.y;J<=pe.max.y;J++)for(var fe=pe.min.x;fe<=pe.max.x;fe++){var Ue=new Pi(fe,J);if(Ue.z=this._tileZoom,this._isValidTile(Ue)){var At=this._tiles[this._tileCoordsToKey(Ue)];At?At.current=!0:nt.push(Ue)}}if(nt.sort(function(Mi,yr){return Mi.distanceTo(Ee)-yr.distanceTo(Ee)}),0!==nt.length){this._loading||(this._loading=!0,this.fire("loading"));var xn=document.createDocumentFragment();for(fe=0;fe<nt.length;fe++)this._addTile(nt[fe],xn);this._level.el.appendChild(xn)}}}},_isValidTile:function(x){var T=this._map.options.crs;if(!T.infinite){var H=this._globalTileRange;if(!T.wrapLng&&(x.x<H.min.x||x.x>H.max.x)||!T.wrapLat&&(x.y<H.min.y||x.y>H.max.y))return!1}if(!this.options.bounds)return!0;var ee=this._tileCoordsToBounds(x);return Sn(this.options.bounds).overlaps(ee)},_keyToBounds:function(x){return this._tileCoordsToBounds(this._keyToTileCoords(x))},_tileCoordsToNwSe:function(x){var T=this._map,H=this.getTileSize(),ee=x.scaleBy(H),pe=ee.add(H);return[T.unproject(ee,x.z),T.unproject(pe,x.z)]},_tileCoordsToBounds:function(x){var T=this._tileCoordsToNwSe(x),H=new Bo(T[0],T[1]);return this.options.noWrap||(H=this._map.wrapLatLngBounds(H)),H},_tileCoordsToKey:function(x){return x.x+":"+x.y+":"+x.z},_keyToTileCoords:function(x){var T=x.split(":"),H=new Pi(+T[0],+T[1]);return H.z=+T[2],H},_removeTile:function(x){var T=this._tiles[x];T&&(yo(T.el),delete this._tiles[x],this.fire("tileunload",{tile:T.el,coords:this._keyToTileCoords(x)}))},_initTile:function(x){ti(x,"leaflet-tile");var T=this.getTileSize();x.style.width=T.x+"px",x.style.height=T.y+"px",x.onselectstart=Qr,x.onmousemove=Qr,Ne.ielt9&&this.options.opacity<1&&Os(x,this.options.opacity)},_addTile:function(x,T){var H=this._getTilePos(x),ee=this._tileCoordsToKey(x),pe=this.createTile(this._wrapCoords(x),p(this._tileReady,this,x));this._initTile(pe),this.createTile.length<2&&Co(p(this._tileReady,this,x,null,pe)),uo(pe,H),this._tiles[ee]={el:pe,coords:x,current:!0},T.appendChild(pe),this.fire("tileloadstart",{tile:pe,coords:x})},_tileReady:function(x,T,H){T&&this.fire("tileerror",{error:T,tile:H,coords:x});var ee=this._tileCoordsToKey(x);(H=this._tiles[ee])&&(H.loaded=+new Date,this._map._fadeAnimated?(Os(H.el,0),gr(this._fadeFrame),this._fadeFrame=Co(this._updateOpacity,this)):(H.active=!0,this._pruneTiles()),T||(ti(H.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:H.el,coords:x})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ne.ielt9||!this._map._fadeAnimated?Co(this._pruneTiles,this):setTimeout(p(this._pruneTiles,this),250)))},_getTilePos:function(x){return x.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(x){var T=new Pi(this._wrapX?cc(x.x,this._wrapX):x.x,this._wrapY?cc(x.y,this._wrapY):x.y);return T.z=x.z,T},_pxBoundsToTileRange:function(x){var T=this.getTileSize();return new Sr(x.min.unscaleBy(T).floor(),x.max.unscaleBy(T).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var x in this._tiles)if(!this._tiles[x].loaded)return!1;return!0}});var kc=qd.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(x,T){this._url=x,(T=mr(this,T)).detectRetina&&Ne.retina&&T.maxZoom>0?(T.tileSize=Math.floor(T.tileSize/2),T.zoomReverse?(T.zoomOffset--,T.minZoom=Math.min(T.maxZoom,T.minZoom+1)):(T.zoomOffset++,T.maxZoom=Math.max(T.minZoom,T.maxZoom-1)),T.minZoom=Math.max(0,T.minZoom)):T.zoomReverse?T.minZoom=Math.min(T.maxZoom,T.minZoom):T.maxZoom=Math.max(T.minZoom,T.maxZoom),"string"==typeof T.subdomains&&(T.subdomains=T.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(x,T){return this._url===x&&void 0===T&&(T=!0),this._url=x,T||this.redraw(),this},createTile:function(x,T){var H=document.createElement("img");return jn(H,"load",p(this._tileOnLoad,this,T,H)),jn(H,"error",p(this._tileOnError,this,T,H)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(H.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(H.referrerPolicy=this.options.referrerPolicy),H.alt="",H.src=this.getTileUrl(x),H},getTileUrl:function(x){var T={r:Ne.retina?"@2x":"",s:this._getSubdomain(x),x:x.x,y:x.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var H=this._globalTileRange.max.y-x.y;this.options.tms&&(T.y=H),T["-y"]=H}return No(this._url,co(T,this.options))},_tileOnLoad:function(x,T){Ne.ielt9?setTimeout(p(x,this,null,T),0):x(null,T)},_tileOnError:function(x,T,H){var ee=this.options.errorTileUrl;ee&&T.getAttribute("src")!==ee&&(T.src=ee),x(H,T)},_onTileRemove:function(x){x.tile.onload=null},_getZoomForUrl:function(){var x=this._tileZoom;return this.options.zoomReverse&&(x=this.options.maxZoom-x),x+this.options.zoomOffset},_getSubdomain:function(x){var T=Math.abs(x.x+x.y)%this.options.subdomains.length;return this.options.subdomains[T]},_abortLoading:function(){var x,T;for(x in this._tiles)if(this._tiles[x].coords.z!==this._tileZoom&&((T=this._tiles[x].el).onload=Qr,T.onerror=Qr,!T.complete)){T.src=Pl;var H=this._tiles[x].coords;yo(T),delete this._tiles[x],this.fire("tileabort",{tile:T,coords:H})}},_removeTile:function(x){var T=this._tiles[x];if(T)return T.el.setAttribute("src",Pl),qd.prototype._removeTile.call(this,x)},_tileReady:function(x,T,H){if(this._map&&(!H||H.getAttribute("src")!==Pl))return qd.prototype._tileReady.call(this,x,T,H)}});function Xn(x,T){return new kc(x,T)}var pd=kc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(x,T){this._url=x;var H=co({},this.defaultWmsParams);for(var ee in T)ee in this.options||(H[ee]=T[ee]);var pe=(T=mr(this,T)).detectRetina&&Ne.retina?2:1,Ee=this.getTileSize();H.width=Ee.x*pe,H.height=Ee.y*pe,this.wmsParams=H},onAdd:function(x){this._crs=this.options.crs||x.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version),this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=this._crs.code,kc.prototype.onAdd.call(this,x)},getTileUrl:function(x){var T=this._tileCoordsToNwSe(x),H=this._crs,ee=Yo(H.project(T[0]),H.project(T[1])),pe=ee.min,Ee=ee.max,nt=(this._wmsVersion>=1.3&&this._crs===Yn?[pe.y,pe.x,Ee.y,Ee.x]:[pe.x,pe.y,Ee.x,Ee.y]).join(","),St=kc.prototype.getTileUrl.call(this,x);return St+Rr(this.wmsParams,St,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+nt},setParams:function(x,T){return co(this.wmsParams,x),T||this.redraw(),this}});kc.WMS=pd,Xn.wms=function Hl(x,T){return new pd(x,T)};var nl=oa.extend({options:{padding:.1},initialize:function(x){mr(this,x),oi(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ti(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var x={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(x.zoomanim=this._onAnimZoom),x},_onAnimZoom:function(x){this._updateTransform(x.center,x.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(x,T){var H=this._map.getZoomScale(T,this._zoom),ee=this._map.getSize().multiplyBy(.5+this.options.padding),pe=this._map.project(this._center,T),Ee=ee.multiplyBy(-H).add(pe).subtract(this._map._getNewPixelOrigin(x,T));Ne.any3d?na(this._container,Ee,H):uo(this._container,Ee)},_reset:function(){for(var x in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[x]._reset()},_onZoomEnd:function(){for(var x in this._layers)this._layers[x]._project()},_updatePaths:function(){for(var x in this._layers)this._layers[x]._update()},_update:function(){var x=this.options.padding,T=this._map.getSize(),H=this._map.containerPointToLayerPoint(T.multiplyBy(-x)).round();this._bounds=new Sr(H,H.add(T.multiplyBy(1+2*x)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Bi=nl.extend({options:{tolerance:0},getEvents:function(){var x=nl.prototype.getEvents.call(this);return x.viewprereset=this._onViewPreReset,x},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){nl.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var x=this._container=document.createElement("canvas");jn(x,"mousemove",this._onMouseMove,this),jn(x,"click dblclick mousedown mouseup contextmenu",this._onClick,this),jn(x,"mouseout",this._handleMouseOut,this),x._leaflet_disable_events=!0,this._ctx=x.getContext("2d")},_destroyContainer:function(){gr(this._redrawRequest),delete this._ctx,yo(this._container),po(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var T in this._redrawBounds=null,this._layers)this._layers[T]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){nl.prototype._update.call(this);var x=this._bounds,T=this._container,H=x.getSize(),ee=Ne.retina?2:1;uo(T,x.min),T.width=ee*H.x,T.height=ee*H.y,T.style.width=H.x+"px",T.style.height=H.y+"px",Ne.retina&&this._ctx.scale(2,2),this._ctx.translate(-x.min.x,-x.min.y),this.fire("update")}},_reset:function(){nl.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(x){this._updateDashArray(x),this._layers[oi(x)]=x;var T=x._order={layer:x,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=T),this._drawLast=T,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(x){this._requestRedraw(x)},_removePath:function(x){var T=x._order,H=T.next,ee=T.prev;H?H.prev=ee:this._drawLast=ee,ee?ee.next=H:this._drawFirst=H,delete x._order,delete this._layers[oi(x)],this._requestRedraw(x)},_updatePath:function(x){this._extendRedrawBounds(x),x._project(),x._update(),this._requestRedraw(x)},_updateStyle:function(x){this._updateDashArray(x),this._requestRedraw(x)},_updateDashArray:function(x){if("string"==typeof x.options.dashArray){var ee,pe,T=x.options.dashArray.split(/[, ]+/),H=[];for(pe=0;pe<T.length;pe++){if(ee=Number(T[pe]),isNaN(ee))return;H.push(ee)}x.options._dashArray=H}else x.options._dashArray=x.options.dashArray},_requestRedraw:function(x){this._map&&(this._extendRedrawBounds(x),this._redrawRequest=this._redrawRequest||Co(this._redraw,this))},_extendRedrawBounds:function(x){if(x._pxBounds){var T=(x.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Sr,this._redrawBounds.extend(x._pxBounds.min.subtract([T,T])),this._redrawBounds.extend(x._pxBounds.max.add([T,T]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var x=this._redrawBounds;if(x){var T=x.getSize();this._ctx.clearRect(x.min.x,x.min.y,T.x,T.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var x,T=this._redrawBounds;if(this._ctx.save(),T){var H=T.getSize();this._ctx.beginPath(),this._ctx.rect(T.min.x,T.min.y,H.x,H.y),this._ctx.clip()}this._drawing=!0;for(var ee=this._drawFirst;ee;ee=ee.next)x=ee.layer,(!T||x._pxBounds&&x._pxBounds.intersects(T))&&x._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(x,T){if(this._drawing){var H,ee,pe,Ee,nt=x._parts,St=nt.length,yt=this._ctx;if(St){for(yt.beginPath(),H=0;H<St;H++){for(ee=0,pe=nt[H].length;ee<pe;ee++)yt[ee?"lineTo":"moveTo"]((Ee=nt[H][ee]).x,Ee.y);T&&yt.closePath()}this._fillStroke(yt,x)}}},_updateCircle:function(x){if(this._drawing&&!x._empty()){var T=x._point,H=this._ctx,ee=Math.max(Math.round(x._radius),1),pe=(Math.max(Math.round(x._radiusY),1)||ee)/ee;1!==pe&&(H.save(),H.scale(1,pe)),H.beginPath(),H.arc(T.x,T.y/pe,ee,0,2*Math.PI,!1),1!==pe&&H.restore(),this._fillStroke(H,x)}},_fillStroke:function(x,T){var H=T.options;H.fill&&(x.globalAlpha=H.fillOpacity,x.fillStyle=H.fillColor||H.color,x.fill(H.fillRule||"evenodd")),H.stroke&&0!==H.weight&&(x.setLineDash&&x.setLineDash(T.options&&T.options._dashArray||[]),x.globalAlpha=H.opacity,x.lineWidth=H.weight,x.strokeStyle=H.color,x.lineCap=H.lineCap,x.lineJoin=H.lineJoin,x.stroke())},_onClick:function(x){for(var H,ee,T=this._map.mouseEventToLayerPoint(x),pe=this._drawFirst;pe;pe=pe.next)(H=pe.layer).options.interactive&&H._containsPoint(T)&&("click"!==x.type&&"preclick"!==x.type||!this._map._draggableMoved(H))&&(ee=H);this._fireEvent(!!ee&&[ee],x)},_onMouseMove:function(x){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var T=this._map.mouseEventToLayerPoint(x);this._handleMouseHover(x,T)}},_handleMouseOut:function(x){var T=this._hoveredLayer;T&&(Oo(this._container,"leaflet-interactive"),this._fireEvent([T],x,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(x,T){if(!this._mouseHoverThrottled){for(var H,ee,pe=this._drawFirst;pe;pe=pe.next)(H=pe.layer).options.interactive&&H._containsPoint(T)&&(ee=H);ee!==this._hoveredLayer&&(this._handleMouseOut(x),ee&&(ti(this._container,"leaflet-interactive"),this._fireEvent([ee],x,"mouseover"),this._hoveredLayer=ee)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],x),this._mouseHoverThrottled=!0,setTimeout(p(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(x,T,H){this._map._fireDOMEvent(T,H||T.type,x)},_bringToFront:function(x){var T=x._order;if(T){var H=T.next,ee=T.prev;if(!H)return;H.prev=ee,ee?ee.next=H:H&&(this._drawFirst=H),T.prev=this._drawLast,this._drawLast.next=T,T.next=null,this._drawLast=T,this._requestRedraw(x)}},_bringToBack:function(x){var T=x._order;if(T){var H=T.next,ee=T.prev;if(!ee)return;ee.next=H,H?H.prev=ee:ee&&(this._drawLast=ee),T.prev=null,T.next=this._drawFirst,this._drawFirst.prev=T,this._drawFirst=T,this._requestRedraw(x)}}});function oh(x){return Ne.canvas?new Bi(x):null}var Ul=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(x){return document.createElement("<lvml:"+x+' class="lvml">')}}catch{}return function(x){return document.createElement("<"+x+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),gi={_initContainer:function(){this._container=rr("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(nl.prototype._update.call(this),this.fire("update"))},_initPath:function(x){var T=x._container=Ul("shape");ti(T,"leaflet-vml-shape "+(this.options.className||"")),T.coordsize="1 1",x._path=Ul("path"),T.appendChild(x._path),this._updateStyle(x),this._layers[oi(x)]=x},_addPath:function(x){var T=x._container;this._container.appendChild(T),x.options.interactive&&x.addInteractiveTarget(T)},_removePath:function(x){var T=x._container;yo(T),x.removeInteractiveTarget(T),delete this._layers[oi(x)]},_updateStyle:function(x){var T=x._stroke,H=x._fill,ee=x.options,pe=x._container;pe.stroked=!!ee.stroke,pe.filled=!!ee.fill,ee.stroke?(T||(T=x._stroke=Ul("stroke")),pe.appendChild(T),T.weight=ee.weight+"px",T.color=ee.color,T.opacity=ee.opacity,T.dashStyle=ee.dashArray?Uo(ee.dashArray)?ee.dashArray.join(" "):ee.dashArray.replace(/( *, *)/g," "):"",T.endcap=ee.lineCap.replace("butt","flat"),T.joinstyle=ee.lineJoin):T&&(pe.removeChild(T),x._stroke=null),ee.fill?(H||(H=x._fill=Ul("fill")),pe.appendChild(H),H.color=ee.fillColor||ee.color,H.opacity=ee.fillOpacity):H&&(pe.removeChild(H),x._fill=null)},_updateCircle:function(x){var T=x._point.round(),H=Math.round(x._radius),ee=Math.round(x._radiusY||H);this._setPath(x,x._empty()?"M0 0":"AL "+T.x+","+T.y+" "+H+","+ee+" 0,23592600")},_setPath:function(x,T){x._path.v=T},_bringToFront:function(x){_l(x._container)},_bringToBack:function(x){_c(x._container)}},$n=Ne.vml?Ul:go,Wi=nl.extend({_initContainer:function(){this._container=$n("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=$n("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){yo(this._container),po(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){nl.prototype._update.call(this);var x=this._bounds,T=x.getSize(),H=this._container;(!this._svgSize||!this._svgSize.equals(T))&&(this._svgSize=T,H.setAttribute("width",T.x),H.setAttribute("height",T.y)),uo(H,x.min),H.setAttribute("viewBox",[x.min.x,x.min.y,T.x,T.y].join(" ")),this.fire("update")}},_initPath:function(x){var T=x._path=$n("path");x.options.className&&ti(T,x.options.className),x.options.interactive&&ti(T,"leaflet-interactive"),this._updateStyle(x),this._layers[oi(x)]=x},_addPath:function(x){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(x._path),x.addInteractiveTarget(x._path)},_removePath:function(x){yo(x._path),x.removeInteractiveTarget(x._path),delete this._layers[oi(x)]},_updatePath:function(x){x._project(),x._update()},_updateStyle:function(x){var T=x._path,H=x.options;T&&(H.stroke?(T.setAttribute("stroke",H.color),T.setAttribute("stroke-opacity",H.opacity),T.setAttribute("stroke-width",H.weight),T.setAttribute("stroke-linecap",H.lineCap),T.setAttribute("stroke-linejoin",H.lineJoin),H.dashArray?T.setAttribute("stroke-dasharray",H.dashArray):T.removeAttribute("stroke-dasharray"),H.dashOffset?T.setAttribute("stroke-dashoffset",H.dashOffset):T.removeAttribute("stroke-dashoffset")):T.setAttribute("stroke","none"),H.fill?(T.setAttribute("fill",H.fillColor||H.color),T.setAttribute("fill-opacity",H.fillOpacity),T.setAttribute("fill-rule",H.fillRule||"evenodd")):T.setAttribute("fill","none"))},_updatePoly:function(x,T){this._setPath(x,Gs(x._parts,T))},_updateCircle:function(x){var T=x._point,H=Math.max(Math.round(x._radius),1),pe="a"+H+","+(Math.max(Math.round(x._radiusY),1)||H)+" 0 1,0 ",Ee=x._empty()?"M0 0":"M"+(T.x-H)+","+T.y+pe+2*H+",0 "+pe+2*-H+",0 ";this._setPath(x,Ee)},_setPath:function(x,T){x._path.setAttribute("d",T)},_bringToFront:function(x){_l(x._path)},_bringToBack:function(x){_c(x._path)}});function zs(x){return Ne.svg||Ne.vml?new Wi(x):null}Ne.vml&&Wi.include(gi),On.include({getRenderer:function(x){var T=x.options.renderer||this._getPaneRenderer(x.options.pane)||this.options.renderer||this._renderer;return T||(T=this._renderer=this._createRenderer()),this.hasLayer(T)||this.addLayer(T),T},_getPaneRenderer:function(x){if("overlayPane"===x||void 0===x)return!1;var T=this._paneRenderers[x];return void 0===T&&(T=this._createRenderer({pane:x}),this._paneRenderers[x]=T),T},_createRenderer:function(x){return this.options.preferCanvas&&oh(x)||zs(x)}});var aa=Er.extend({initialize:function(x,T){Er.prototype.initialize.call(this,this._boundsToLatLngs(x),T)},setBounds:function(x){return this.setLatLngs(this._boundsToLatLngs(x))},_boundsToLatLngs:function(x){return[(x=Sn(x)).getSouthWest(),x.getNorthWest(),x.getNorthEast(),x.getSouthEast()]}});Wi.create=$n,Wi.pointsToPath=Gs,kl.geometryToLayer=Ha,kl.coordsToLatLng=Xs,kl.coordsToLatLngs=ud,kl.latLngToCoords=lu,kl.latLngsToCoords=rh,kl.getFeature=xc,kl.asFeature=Ih,On.mergeOptions({boxZoom:!0});var Pa=Ea.extend({initialize:function(x){this._map=x,this._container=x._container,this._pane=x._panes.overlayPane,this._resetStateTimeout=0,x.on("unload",this._destroy,this)},addHooks:function(){jn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){po(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){yo(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(x){if(!x.shiftKey||1!==x.which&&1!==x.button)return!1;this._clearDeferredResetState(),this._resetState(),Ls(),Tr(),this._startPoint=this._map.mouseEventToContainerPoint(x),jn(document,{contextmenu:Ll,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(x){this._moved||(this._moved=!0,this._box=rr("div","leaflet-zoom-box",this._container),ti(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(x);var T=new Sr(this._point,this._startPoint),H=T.getSize();uo(this._box,T.min),this._box.style.width=H.x+"px",this._box.style.height=H.y+"px"},_finish:function(){this._moved&&(yo(this._box),Oo(this._container,"leaflet-crosshair")),Ro(),Ri(),po(document,{contextmenu:Ll,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(x){if((1===x.which||1===x.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(p(this._resetState,this),0);var T=new Bo(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(T).fire("boxzoomend",{boxZoomBounds:T})}},_onKeyDown:function(x){27===x.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});On.addInitHook("addHandler","boxZoom",Pa),On.mergeOptions({doubleClickZoom:!0});var jr=Ea.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(x){var T=this._map,H=T.getZoom(),ee=T.options.zoomDelta,pe=x.originalEvent.shiftKey?H-ee:H+ee;"center"===T.options.doubleClickZoom?T.setZoom(pe):T.setZoomAround(x.containerPoint,pe)}});On.addInitHook("addHandler","doubleClickZoom",jr),On.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Zu=Ea.extend({addHooks:function(){if(!this._draggable){var x=this._map;this._draggable=new Fi(x._mapPane,x._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),x.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),x.on("zoomend",this._onZoomEnd,this),x.whenReady(this._onZoomEnd,this))}ti(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Oo(this._map._container,"leaflet-grab"),Oo(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var x=this._map;if(x._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var T=Sn(this._map.options.maxBounds);this._offsetLimit=Yo(this._map.latLngToContainerPoint(T.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(T.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;x.fire("movestart").fire("dragstart"),x.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(x){if(this._map.options.inertia){var T=this._lastTime=+new Date,H=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(H),this._times.push(T),this._prunePositions(T)}this._map.fire("move",x).fire("drag",x)},_prunePositions:function(x){for(;this._positions.length>1&&x-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var x=this._map.getSize().divideBy(2),T=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=T.subtract(x).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(x,T){return x-(x-T)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var x=this._draggable._newPos.subtract(this._draggable._startPos),T=this._offsetLimit;x.x<T.min.x&&(x.x=this._viscousLimit(x.x,T.min.x)),x.y<T.min.y&&(x.y=this._viscousLimit(x.y,T.min.y)),x.x>T.max.x&&(x.x=this._viscousLimit(x.x,T.max.x)),x.y>T.max.y&&(x.y=this._viscousLimit(x.y,T.max.y)),this._draggable._newPos=this._draggable._startPos.add(x)}},_onPreDragWrap:function(){var x=this._worldWidth,T=Math.round(x/2),H=this._initialWorldOffset,ee=this._draggable._newPos.x,pe=(ee-T+H)%x+T-H,Ee=(ee+T+H)%x-T-H,nt=Math.abs(pe+H)<Math.abs(Ee+H)?pe:Ee;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=nt},_onDragEnd:function(x){var T=this._map,H=T.options,ee=!H.inertia||x.noInertia||this._times.length<2;if(T.fire("dragend",x),ee)T.fire("moveend");else{this._prunePositions(+new Date);var pe=this._lastPos.subtract(this._positions[0]),nt=H.easeLinearity,St=pe.multiplyBy(nt/((this._lastTime-this._times[0])/1e3)),yt=St.distanceTo([0,0]),on=Math.min(H.inertiaMaxSpeed,yt),Y=St.multiplyBy(on/yt),J=on/(H.inertiaDeceleration*nt),fe=Y.multiplyBy(-J/2).round();fe.x||fe.y?(fe=T._limitOffset(fe,T.options.maxBounds),Co(function(){T.panBy(fe,{duration:J,easeLinearity:nt,noMoveStart:!0,animate:!0})})):T.fire("moveend")}}});On.addInitHook("addHandler","dragging",Zu),On.mergeOptions({keyboard:!0,keyboardPanDelta:80});var sh=Ea.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(x){this._map=x,this._setPanDelta(x.options.keyboardPanDelta),this._setZoomDelta(x.options.zoomDelta)},addHooks:function(){var x=this._map._container;x.tabIndex<=0&&(x.tabIndex="0"),jn(x,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),po(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var x=document.body,T=document.documentElement,H=x.scrollTop||T.scrollTop,ee=x.scrollLeft||T.scrollLeft;this._map._container.focus(),window.scrollTo(ee,H)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(x){var ee,pe,T=this._panKeys={},H=this.keyCodes;for(ee=0,pe=H.left.length;ee<pe;ee++)T[H.left[ee]]=[-1*x,0];for(ee=0,pe=H.right.length;ee<pe;ee++)T[H.right[ee]]=[x,0];for(ee=0,pe=H.down.length;ee<pe;ee++)T[H.down[ee]]=[0,x];for(ee=0,pe=H.up.length;ee<pe;ee++)T[H.up[ee]]=[0,-1*x]},_setZoomDelta:function(x){var ee,pe,T=this._zoomKeys={},H=this.keyCodes;for(ee=0,pe=H.zoomIn.length;ee<pe;ee++)T[H.zoomIn[ee]]=x;for(ee=0,pe=H.zoomOut.length;ee<pe;ee++)T[H.zoomOut[ee]]=-x},_addHooks:function(){jn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){po(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(x){if(!(x.altKey||x.ctrlKey||x.metaKey)){var ee,T=x.keyCode,H=this._map;if(T in this._panKeys){if(!H._panAnim||!H._panAnim._inProgress)if(ee=this._panKeys[T],x.shiftKey&&(ee=yi(ee).multiplyBy(3)),H.options.maxBounds&&(ee=H._limitOffset(yi(ee),H.options.maxBounds)),H.options.worldCopyJump){var pe=H.wrapLatLng(H.unproject(H.project(H.getCenter()).add(ee)));H.panTo(pe)}else H.panBy(ee)}else if(T in this._zoomKeys)H.setZoom(H.getZoom()+(x.shiftKey?3:1)*this._zoomKeys[T]);else{if(27!==T||!H._popup||!H._popup.options.closeOnEscapeKey)return;H.closePopup()}Ll(x)}}});On.addInitHook("addHandler","keyboard",sh),On.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ip=Ea.extend({addHooks:function(){jn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){po(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(x){var T=Hu(x),H=this._map.options.wheelDebounceTime;this._delta+=T,this._lastMousePos=this._map.mouseEventToContainerPoint(x),this._startTime||(this._startTime=+new Date);var ee=Math.max(H-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(p(this._performZoom,this),ee),Ll(x)},_performZoom:function(){var x=this._map,T=x.getZoom(),H=this._map.options.zoomSnap||0;x._stop();var pe=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,Ee=H?Math.ceil(pe/H)*H:pe,nt=x._limitZoom(T+(this._delta>0?Ee:-Ee))-T;this._delta=0,this._startTime=null,nt&&("center"===x.options.scrollWheelZoom?x.setZoom(T+nt):x.setZoomAround(this._lastMousePos,T+nt))}});On.addInitHook("addHandler","scrollWheelZoom",Ip);On.mergeOptions({tapHold:Ne.touchNative&&Ne.safari&&Ne.mobile,tapTolerance:15});var ts=Ea.extend({addHooks:function(){jn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){po(this._map._container,"touchstart",this._onDown,this)},_onDown:function(x){if(clearTimeout(this._holdTimeout),1===x.touches.length){var T=x.touches[0];this._startPos=this._newPos=new Pi(T.clientX,T.clientY),this._holdTimeout=setTimeout(p(function(){this._cancel(),this._isTapValid()&&(jn(document,"touchend",Ws),jn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",T))},this),600),jn(document,"touchend touchcancel contextmenu",this._cancel,this),jn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function x(){po(document,"touchend",Ws),po(document,"touchend touchcancel",x)},_cancel:function(){clearTimeout(this._holdTimeout),po(document,"touchend touchcancel contextmenu",this._cancel,this),po(document,"touchmove",this._onMove,this)},_onMove:function(x){var T=x.touches[0];this._newPos=new Pi(T.clientX,T.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(x,T){var H=new MouseEvent(x,{bubbles:!0,cancelable:!0,view:window,screenX:T.screenX,screenY:T.screenY,clientX:T.clientX,clientY:T.clientY});H._simulated=!0,T.target.dispatchEvent(H)}});On.addInitHook("addHandler","tapHold",ts),On.mergeOptions({touchZoom:Ne.touch,bounceAtZoomLimits:!0});var Tn=Ea.extend({addHooks:function(){ti(this._map._container,"leaflet-touch-zoom"),jn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Oo(this._map._container,"leaflet-touch-zoom"),po(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(x){var T=this._map;if(x.touches&&2===x.touches.length&&!T._animatingZoom&&!this._zooming){var H=T.mouseEventToContainerPoint(x.touches[0]),ee=T.mouseEventToContainerPoint(x.touches[1]);this._centerPoint=T.getSize()._divideBy(2),this._startLatLng=T.containerPointToLatLng(this._centerPoint),"center"!==T.options.touchZoom&&(this._pinchStartLatLng=T.containerPointToLatLng(H.add(ee)._divideBy(2))),this._startDist=H.distanceTo(ee),this._startZoom=T.getZoom(),this._moved=!1,this._zooming=!0,T._stop(),jn(document,"touchmove",this._onTouchMove,this),jn(document,"touchend touchcancel",this._onTouchEnd,this),Ws(x)}},_onTouchMove:function(x){if(x.touches&&2===x.touches.length&&this._zooming){var T=this._map,H=T.mouseEventToContainerPoint(x.touches[0]),ee=T.mouseEventToContainerPoint(x.touches[1]),pe=H.distanceTo(ee)/this._startDist;if(this._zoom=T.getScaleZoom(pe,this._startZoom),!T.options.bounceAtZoomLimits&&(this._zoom<T.getMinZoom()&&pe<1||this._zoom>T.getMaxZoom()&&pe>1)&&(this._zoom=T._limitZoom(this._zoom)),"center"===T.options.touchZoom){if(this._center=this._startLatLng,1===pe)return}else{var Ee=H._add(ee)._divideBy(2)._subtract(this._centerPoint);if(1===pe&&0===Ee.x&&0===Ee.y)return;this._center=T.unproject(T.project(this._pinchStartLatLng,this._zoom).subtract(Ee),this._zoom)}this._moved||(T._moveStart(!0,!1),this._moved=!0),gr(this._animRequest);var nt=p(T._move,T,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Co(nt,this,!0),Ws(x)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,gr(this._animRequest),po(document,"touchmove",this._onTouchMove,this),po(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});On.addInitHook("addHandler","touchZoom",Tn),On.BoxZoom=Pa,On.DoubleClickZoom=jr,On.Drag=Zu,On.Keyboard=sh,On.ScrollWheelZoom=Ip,On.TapHold=ts,On.TouchZoom=Tn,wn.Bounds=Sr,wn.Browser=Ne,wn.CRS=Lr,wn.Canvas=Bi,wn.Circle=Ys,wn.CircleMarker=Bl,wn.Class=Cr,wn.Control=Sa,wn.DivIcon=du,wn.DivOverlay=sa,wn.DomEvent=Fl,wn.DomUtil=Ui,wn.Draggable=Fi,wn.Evented=wa,wn.FeatureGroup=vs,wn.GeoJSON=kl,wn.GridLayer=qd,wn.Handler=Ea,wn.Icon=Dt,wn.ImageOverlay=Hd,wn.LatLng=ei,wn.LatLngBounds=Bo,wn.Layer=oa,wn.LayerGroup=kn,wn.LineUtil=ja,wn.Map=On,wn.Marker=ds,wn.Mixin=bl,wn.Path=tl,wn.Point=Pi,wn.PolyUtil=Da,wn.Polygon=Er,wn.Polyline=Go,wn.Popup=wc,wn.PosAnimation=Va,wn.Projection=Vo,wn.Rectangle=aa,wn.Renderer=nl,wn.SVG=Wi,wn.SVGOverlay=cu,wn.TileLayer=kc,wn.Tooltip=Ud,wn.Transformation=As,wn.Util=Qn,wn.VideoOverlay=Jl,wn.bind=p,wn.bounds=Yo,wn.canvas=oh,wn.circle=function Fs(x,T,H){return new Ys(x,T,H)},wn.circleMarker=function Bd(x,T){return new Bl(x,T)},wn.control=Xo,wn.divIcon=function Xt(x){return new du(x)},wn.extend=co,wn.featureGroup=function(x,T){return new vs(x,T)},wn.geoJSON=jd,wn.geoJson=Gc,wn.gridLayer=function hu(x){return new qd(x)},wn.icon=function wl(x){return new Dt(x)},wn.imageOverlay=function(x,T,H){return new Hd(x,T,H)},wn.latLng=si,wn.latLngBounds=Sn,wn.layerGroup=function(x,T){return new kn(x,T)},wn.map=function ou(x,T){return new On(x,T)},wn.marker=function Ds(x,T){return new ds(x,T)},wn.point=yi,wn.polygon=function Vl(x,T){return new Er(x,T)},wn.polyline=function Aa(x,T){return new Go(x,T)},wn.popup=function(x,T){return new wc(x,T)},wn.rectangle=function ec(x,T){return new aa(x,T)},wn.setOptions=mr,wn.stamp=oi,wn.svg=zs,wn.svgOverlay=function es(x,T,H){return new cu(x,T,H)},wn.tileLayer=Xn,wn.tooltip=function(x,T){return new Ud(x,T)},wn.transformation=Vr,wn.version="1.9.4",wn.videoOverlay=function Oh(x,T,H){return new Jl(x,T,H)};var Zi=window.L;wn.noConflict=function(){return window.L=Zi,this},window.L=wn}(Lc)},247:function(yg){yg.exports=function(){"use strict";var Lc,wn,Qi;function co(p,En){if(Lc)if(wn){var oi="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Lc+")(sharedChunk); ("+wn+")(sharedChunk); self.onerror = null;",Xl={};Lc(Xl),Qi=En(Xl),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Qi.workerUrl=window.URL.createObjectURL(new Blob([oi],{type:"text/javascript"})))}else wn=En;else Lc=En}return co(0,function(p){var En=1e-6,oi=typeof Float32Array<"u"?Float32Array:Array;function Xl(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=l*v-m*u;return b?(d[0]=v*(b=1/b),d[1]=-u*b,d[2]=-m*b,d[3]=l*b,d):null}function cc(){var d=new oi(9);return oi!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d}function Qr(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=o[4],C=o[5],D=o[6],I=o[7],R=o[8];return d[0]=b*R-C*I,d[1]=m*I-u*R,d[2]=u*C-m*b,d[3]=C*D-v*R,d[4]=l*R-m*D,d[5]=m*v-l*C,d[6]=v*I-b*D,d[7]=u*D-l*I,d[8]=l*b-u*v,d}function zt(d,o,l){var u=o[0],m=o[1],v=o[2],b=o[3],C=o[4],D=o[5],I=o[6],R=o[7],N=o[8],j=l[0],K=l[1],Z=l[2],te=l[3],ce=l[4],ue=l[5],xe=l[6],ve=l[7],ie=l[8];return d[0]=j*u+K*b+Z*I,d[1]=j*m+K*C+Z*R,d[2]=j*v+K*D+Z*N,d[3]=te*u+ce*b+ue*I,d[4]=te*m+ce*C+ue*R,d[5]=te*v+ce*D+ue*N,d[6]=xe*u+ve*b+ie*I,d[7]=xe*m+ve*C+ie*R,d[8]=xe*v+ve*D+ie*N,d}function Fc(){var d=new oi(16);return oi!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d}function Gn(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function mr(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=o[4],C=o[5],D=o[6],I=o[7],R=o[8],N=o[9],j=o[10],K=o[11],Z=o[12],te=o[13],ce=o[14],ue=o[15],xe=l*C-u*b,ve=l*D-m*b,ie=l*I-v*b,_e=u*D-m*C,we=u*I-v*C,Ce=m*I-v*D,ze=R*te-N*Z,qe=R*ce-j*Z,Ze=R*ue-K*Z,Xe=N*ce-j*te,pt=N*ue-K*te,Rt=j*ue-K*ce,Mt=xe*Rt-ve*pt+ie*Xe+_e*Ze-we*qe+Ce*ze;return Mt?(d[0]=(C*Rt-D*pt+I*Xe)*(Mt=1/Mt),d[1]=(m*pt-u*Rt-v*Xe)*Mt,d[2]=(te*Ce-ce*we+ue*_e)*Mt,d[3]=(j*we-N*Ce-K*_e)*Mt,d[4]=(D*Ze-b*Rt-I*qe)*Mt,d[5]=(l*Rt-m*Ze+v*qe)*Mt,d[6]=(ce*ie-Z*Ce-ue*ve)*Mt,d[7]=(R*Ce-j*ie+K*ve)*Mt,d[8]=(b*pt-C*Ze+I*ze)*Mt,d[9]=(u*Ze-l*pt-v*ze)*Mt,d[10]=(Z*we-te*ie+ue*xe)*Mt,d[11]=(N*ie-R*we-K*xe)*Mt,d[12]=(C*qe-b*Xe-D*ze)*Mt,d[13]=(l*Xe-u*qe+m*ze)*Mt,d[14]=(te*ve-Z*_e-ce*xe)*Mt,d[15]=(R*_e-N*ve+j*xe)*Mt,d):null}function Rr(d,o,l){var u=o[0],m=o[1],v=o[2],b=o[3],C=o[4],D=o[5],I=o[6],R=o[7],N=o[8],j=o[9],K=o[10],Z=o[11],te=o[12],ce=o[13],ue=o[14],xe=o[15],ve=l[0],ie=l[1],_e=l[2],we=l[3];return d[0]=ve*u+ie*C+_e*N+we*te,d[1]=ve*m+ie*D+_e*j+we*ce,d[2]=ve*v+ie*I+_e*K+we*ue,d[3]=ve*b+ie*R+_e*Z+we*xe,d[4]=(ve=l[4])*u+(ie=l[5])*C+(_e=l[6])*N+(we=l[7])*te,d[5]=ve*m+ie*D+_e*j+we*ce,d[6]=ve*v+ie*I+_e*K+we*ue,d[7]=ve*b+ie*R+_e*Z+we*xe,d[8]=(ve=l[8])*u+(ie=l[9])*C+(_e=l[10])*N+(we=l[11])*te,d[9]=ve*m+ie*D+_e*j+we*ce,d[10]=ve*v+ie*I+_e*K+we*ue,d[11]=ve*b+ie*R+_e*Z+we*xe,d[12]=(ve=l[12])*u+(ie=l[13])*C+(_e=l[14])*N+(we=l[15])*te,d[13]=ve*m+ie*D+_e*j+we*ce,d[14]=ve*v+ie*I+_e*K+we*ue,d[15]=ve*b+ie*R+_e*Z+we*xe,d}function ho(d,o,l){var u,m,v,b,C,D,I,R,N,j,K,Z,te=l[0],ce=l[1],ue=l[2];return o===d?(d[12]=o[0]*te+o[4]*ce+o[8]*ue+o[12],d[13]=o[1]*te+o[5]*ce+o[9]*ue+o[13],d[14]=o[2]*te+o[6]*ce+o[10]*ue+o[14],d[15]=o[3]*te+o[7]*ce+o[11]*ue+o[15]):(m=o[1],v=o[2],b=o[3],C=o[4],D=o[5],I=o[6],R=o[7],N=o[8],j=o[9],K=o[10],Z=o[11],d[0]=u=o[0],d[1]=m,d[2]=v,d[3]=b,d[4]=C,d[5]=D,d[6]=I,d[7]=R,d[8]=N,d[9]=j,d[10]=K,d[11]=Z,d[12]=u*te+C*ce+N*ue+o[12],d[13]=m*te+D*ce+j*ue+o[13],d[14]=v*te+I*ce+K*ue+o[14],d[15]=b*te+R*ce+Z*ue+o[15]),d}function No(d,o,l){var u=l[0],m=l[1],v=l[2];return d[0]=o[0]*u,d[1]=o[1]*u,d[2]=o[2]*u,d[3]=o[3]*u,d[4]=o[4]*m,d[5]=o[5]*m,d[6]=o[6]*m,d[7]=o[7]*m,d[8]=o[8]*v,d[9]=o[9]*v,d[10]=o[10]*v,d[11]=o[11]*v,d[12]=o[12],d[13]=o[13],d[14]=o[14],d[15]=o[15],d}function Uo(d,o,l){var u=Math.sin(l),m=Math.cos(l),v=o[4],b=o[5],C=o[6],D=o[7],I=o[8],R=o[9],N=o[10],j=o[11];return o!==d&&(d[0]=o[0],d[1]=o[1],d[2]=o[2],d[3]=o[3],d[12]=o[12],d[13]=o[13],d[14]=o[14],d[15]=o[15]),d[4]=v*m+I*u,d[5]=b*m+R*u,d[6]=C*m+N*u,d[7]=D*m+j*u,d[8]=I*m-v*u,d[9]=R*m-b*u,d[10]=N*m-C*u,d[11]=j*m-D*u,d}function Ya(d,o,l){var u=Math.sin(l),m=Math.cos(l),v=o[0],b=o[1],C=o[2],D=o[3],I=o[8],R=o[9],N=o[10],j=o[11];return o!==d&&(d[4]=o[4],d[5]=o[5],d[6]=o[6],d[7]=o[7],d[12]=o[12],d[13]=o[13],d[14]=o[14],d[15]=o[15]),d[0]=v*m-I*u,d[1]=b*m-R*u,d[2]=C*m-N*u,d[3]=D*m-j*u,d[8]=v*u+I*m,d[9]=b*u+R*m,d[10]=C*u+N*m,d[11]=D*u+j*m,d}function Pl(d,o,l){var u=Math.sin(l),m=Math.cos(l),v=o[0],b=o[1],C=o[2],D=o[3],I=o[4],R=o[5],N=o[6],j=o[7];return o!==d&&(d[8]=o[8],d[9]=o[9],d[10]=o[10],d[11]=o[11],d[12]=o[12],d[13]=o[13],d[14]=o[14],d[15]=o[15]),d[0]=v*m+I*u,d[1]=b*m+R*u,d[2]=C*m+N*u,d[3]=D*m+j*u,d[4]=I*m-v*u,d[5]=R*m-b*u,d[6]=N*m-C*u,d[7]=j*m-D*u,d}function xa(d,o){return d[0]=o[0],d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=o[1],d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=o[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function Il(d,o,l){var u,m,v,b=l[0],C=l[1],D=l[2],I=Math.hypot(b,C,D);return I<En?null:(b*=I=1/I,C*=I,D*=I,u=Math.sin(o),m=Math.cos(o),d[0]=b*b*(v=1-m)+m,d[1]=C*b*v+D*u,d[2]=D*b*v-C*u,d[3]=0,d[4]=b*C*v-D*u,d[5]=C*C*v+m,d[6]=D*C*v+b*u,d[7]=0,d[8]=b*D*v+C*u,d[9]=C*D*v-b*u,d[10]=D*D*v+m,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d)}function Xa(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=l+l,C=u+u,D=m+m,I=l*b,R=u*b,N=u*C,j=m*b,K=m*C,Z=m*D,te=v*b,ce=v*C,ue=v*D;return d[0]=1-N-Z,d[1]=R+ue,d[2]=j-ce,d[3]=0,d[4]=R-ue,d[5]=1-I-Z,d[6]=K+te,d[7]=0,d[8]=j+ce,d[9]=K-te,d[10]=1-I-N,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}Math.hypot||(Math.hypot=function(){for(var d=0,o=arguments.length;o--;)d+=arguments[o]*arguments[o];return Math.sqrt(d)});var zc=Rr;function Ji(){var d=new oi(3);return oi!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d}function Co(d){var o=new oi(3);return o[0]=d[0],o[1]=d[1],o[2]=d[2],o}function gr(d){return Math.hypot(d[0],d[1],d[2])}function Qn(d,o,l){var u=new oi(3);return u[0]=d,u[1]=o,u[2]=l,u}function Cr(d,o,l){return d[0]=o[0]+l[0],d[1]=o[1]+l[1],d[2]=o[2]+l[2],d}function gs(d,o,l){return d[0]=o[0]-l[0],d[1]=o[1]-l[1],d[2]=o[2]-l[2],d}function no(d,o,l){return d[0]=o[0]*l[0],d[1]=o[1]*l[1],d[2]=o[2]*l[2],d}function wa(d,o,l){return d[0]=Math.min(o[0],l[0]),d[1]=Math.min(o[1],l[1]),d[2]=Math.min(o[2],l[2]),d}function Pi(d,o,l){return d[0]=Math.max(o[0],l[0]),d[1]=Math.max(o[1],l[1]),d[2]=Math.max(o[2],l[2]),d}function Jn(d,o,l){return d[0]=o[0]*l,d[1]=o[1]*l,d[2]=o[2]*l,d}function yi(d,o,l,u){return d[0]=o[0]+l[0]*u,d[1]=o[1]+l[1]*u,d[2]=o[2]+l[2]*u,d}function Sr(d,o){var l=o[0]-d[0],u=o[1]-d[1],m=o[2]-d[2];return l*l+u*u+m*m}function Yo(d){var o=d[0],l=d[1],u=d[2];return o*o+l*l+u*u}function Bo(d,o){return d[0]=-o[0],d[1]=-o[1],d[2]=-o[2],d}function Sn(d,o){var l=o[0],u=o[1],m=o[2],v=l*l+u*u+m*m;return v>0&&(v=1/Math.sqrt(v)),d[0]=o[0]*v,d[1]=o[1]*v,d[2]=o[2]*v,d}function ei(d,o){return d[0]*o[0]+d[1]*o[1]+d[2]*o[2]}function si(d,o,l){var u=o[0],m=o[1],v=o[2],b=l[0],C=l[1],D=l[2];return d[0]=m*D-v*C,d[1]=v*b-u*D,d[2]=u*C-m*b,d}function Lr(d,o,l,u){var m=o[0],v=o[1],b=o[2];return d[0]=m+u*(l[0]-m),d[1]=v+u*(l[1]-v),d[2]=b+u*(l[2]-b),d}function ui(d,o,l){var u=o[0],m=o[1],v=o[2],b=l[3]*u+l[7]*m+l[11]*v+l[15];return d[0]=(l[0]*u+l[4]*m+l[8]*v+l[12])/(b=b||1),d[1]=(l[1]*u+l[5]*m+l[9]*v+l[13])/b,d[2]=(l[2]*u+l[6]*m+l[10]*v+l[14])/b,d}function Nc(d,o,l){var u=o[0],m=o[1],v=o[2];return d[0]=u*l[0]+m*l[3]+v*l[6],d[1]=u*l[1]+m*l[4]+v*l[7],d[2]=u*l[2]+m*l[5]+v*l[8],d}function zi(d,o,l){var u=l[0],m=l[1],v=l[2],b=o[0],C=o[1],D=o[2],I=m*D-v*C,R=v*b-u*D,N=u*C-m*b,j=m*N-v*R,K=v*I-u*N,Z=u*R-m*I,te=2*l[3];return R*=te,N*=te,K*=2,Z*=2,d[0]=b+(I*=te)+(j*=2),d[1]=C+R+K,d[2]=D+N+Z,d}function As(d,o){return d[0]===o[0]&&d[1]===o[1]&&d[2]===o[2]}var Vr=gs,dc=no,Id=gr;function go(){var d=new oi(4);return oi!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0,d[3]=0),d}function Gs(d,o,l){return d[0]=o[0]*l,d[1]=o[1]*l,d[2]=o[2]*l,d[3]=o[3]*l,d}function hc(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=l*l+u*u+m*m+v*v;return b>0&&(b=1/Math.sqrt(b)),d[0]=l*b,d[1]=u*b,d[2]=m*b,d[3]=v*b,d}function _o(d,o,l){var u=o[0],m=o[1],v=o[2],b=o[3];return d[0]=l[0]*u+l[4]*m+l[8]*v+l[12]*b,d[1]=l[1]*u+l[5]*m+l[9]*v+l[13]*b,d[2]=l[2]*u+l[6]*m+l[10]*v+l[14]*b,d[3]=l[3]*u+l[7]*m+l[11]*v+l[15]*b,d}function Ka(){var d=new oi(4);return oi!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function uc(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d}function Ol(d,o,l){l*=.5;var u=o[0],m=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return d[0]=u*D+b*C,d[1]=m*D+v*C,d[2]=v*D-m*C,d[3]=b*D-u*C,d}function _r(d,o,l){l*=.5;var u=o[0],m=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return d[0]=u*D-v*C,d[1]=m*D+b*C,d[2]=v*D+u*C,d[3]=b*D-m*C,d}Ji(),go();var Io,ls,Kl,So,Ko,fl=hc,pc=(Io=Ji(),ls=Qn(1,0,0),Kl=Qn(0,1,0),function(d,o,l){var u=ei(o,l);return u<-.999999?(si(Io,ls,o),Id(Io)<1e-6&&si(Io,Kl,o),Sn(Io,Io),function(m,v,b){b*=.5;var C=Math.sin(b);m[0]=C*v[0],m[1]=C*v[1],m[2]=C*v[2],m[3]=Math.cos(b)}(d,Io,Math.PI),d):u>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(si(Io,o,l),d[0]=Io[0],d[1]=Io[1],d[2]=Io[2],d[3]=1+u,fl(d,d))});function Ss(){var d=new oi(2);return oi!=Float32Array&&(d[0]=0,d[1]=0),d}function Eo(d,o){var l=new oi(2);return l[0]=d,l[1]=o,l}function Bc(d,o,l){return d[0]=o[0]+l[0],d[1]=o[1]+l[1],d}function ml(d,o,l){return d[0]=o[0]-l[0],d[1]=o[1]-l[1],d}function fc(d,o,l){return d[0]=o[0]*l,d[1]=o[1]*l,d}function Vc(d){return Math.hypot(d[0],d[1])}function Od(d,o){var l=o[0],u=o[1],m=l*l+u*u;return m>0&&(m=1/Math.sqrt(m)),d[0]=o[0]*m,d[1]=o[1]*m,d}function lr(d,o){return d[0]*o[0]+d[1]*o[1]}function mc(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}Ka(),Ka(),cc(),Ss();var nh,gl,Dh=mc(function(){if(Ko)return So;function d(o,l,u,m){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=u,this.p2y=m}return Ko=1,So=d,d.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,l){if(void 0===l&&(l=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,m=0;m<8;m++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<l)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=v/b}var C=0,D=1;for(u=o,m=0;m<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<l));m++)o>v?C=u:D=u,u=.5*(D-C)+C;return u},solve:function(o,l){return this.sampleCurveY(this.solveCurveX(o,l))}},So}());function Th(){if(gl)return nh;function d(o,l){this.x=o,this.y=l}return gl=1,nh=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,l){return this.clone()._rotateAround(o,l)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var l=o.x-this.x,u=o.y-this.y;return l*l+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,l){return Math.atan2(this.x*l-this.y*o,this.x*o+this.y*l)},_matMult:function(o){var l=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=l,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var l=Math.cos(o),u=Math.sin(o),m=u*this.x+l*this.y;return this.x=l*this.x-u*this.y,this.y=m,this},_rotateAround:function(o,l){var u=Math.cos(o),m=Math.sin(o),v=l.y+m*(this.x-l.x)+u*(this.y-l.y);return this.x=l.x+u*(this.x-l.x)-m*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(o){return o instanceof d?o:Array.isArray(o)?new d(o[0],o[1]):o},nh}var Wt=mc(Th());function jc(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let l=0;l<d.length;l++)if(!jc(d[l],o[l]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==o){if("object"!=typeof o||Object.keys(d).length!==Object.keys(o).length)return!1;for(const l in d)if(!jc(d[l],o[l]))return!1;return!0}return d===o}const iu=Math.PI/180,mt=180/Math.PI;function ae(d){return d*iu}function ge(d){return d*mt}const Ae=[[0,0],[1,0],[1,1],[0,1]];function je(d){if(d<=0)return 0;if(d>=1)return 1;const o=d*d,l=o*d;return 4*(d<.5?l:3*(d-o)+l-.75)}function Fe(d,o,l,u){const m=new Dh(d,o,l,u);return function(v){return m.solve(v)}}const We=Fe(.25,.1,.25,1);function Ge(d,o,l){return Math.min(l,Math.max(o,d))}function Ne(d,o,l){return(l=Ge((l-d)/(o-d),0,1))*l*(3-2*l)}function at(d,o,l){const u=l-o,m=((d-o)%u+u)%u+o;return m===o?l:m}function bt(d,o,l){if(!d.length)return l(null,[]);let u=d.length;const m=new Array(d.length);let v=null;d.forEach((b,C)=>{o(b,(D,I)=>{D&&(v=D),m[C]=I,0==--u&&l(v,m)})})}function tt(d,...o){for(const l of o)for(const u in l)d[u]=l[u];return d}let Zt=1;function jt(){return Zt++}function pn(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))}function Nn(d,o){d.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Wn(d,o,l){const u={};for(const m in d)u[m]=o.call(this,d[m],m,d);return u}function ii(d,o,l){const u={};for(const m in d)o.call(this,d[m],m,d)&&(u[m]=d[m]);return u}function pi(d){return Array.isArray(d)?d.map(pi):"object"==typeof d&&d?Wn(d,pi):d}const cr={};function ci(d){cr[d]||(typeof console<"u"&&console.warn(d),cr[d]=!0)}function fi(d,o,l){return(l.y-d.y)*(o.x-d.x)>(o.y-d.y)*(l.x-d.x)}function ki(d){let o=0;for(let l,u,m=0,v=d.length,b=v-1;m<v;b=m++)l=d[m],u=d[b],o+=(u.x-l.x)*(l.y+u.y);return o}function Si([d,o,l]){const u=ae(o+90),m=ae(l);return{x:d*Math.cos(u)*Math.sin(m),y:d*Math.sin(u)*Math.sin(m),z:d*Math.cos(m),azimuthal:o,polar:l}}function wi(d){return(typeof self<"u"||void 0!==d)&&typeof WorkerGlobalScope<"u"&&(void 0!==d?d:self)instanceof WorkerGlobalScope}function Do(d){const o={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,m,v)=>{const b=m||v;return o[u]=!b||b.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let qo=null;function Qo(d,o){return[d[4*o],d[4*o+1],d[4*o+2],d[4*o+3]]}function _s(d,o,l,u){for(;o<l;){const m=o+l>>1;d[m]<u?o=m+1:l=m}return o}function ka(d,o,l,u){for(;o<l;){const m=o+l>>1;d[m]<=u?o=m+1:l=m}return o}function ys(d){return d>0?1/(1.001-d):1+d}function Ps(d){return d>0?1-1/(1.001-d):-d}function Jo(d,o,l){return(d-o.min)*(l.max-l.min)/(o.max-o.min)+l.min}const cs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!cs.API_URL)return null;try{const d=new URL(cs.API_URL);return"api.mapbox.cn"===d.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===d.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function rr(d){return cs.API_URL_REGEX.test(d)}function yo(d){return cs.API_SPRITE_REGEX.test(d)}let gc,_l,_c,sd,ti,Oo;function Is(){return null==gc&&(gc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),gc}const Un={now:()=>void 0!==sd?sd:performance.now(),setNow(d){sd=d},restoreNow(){sd=void 0},frame(d){const o=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(d,o=0){const{width:l,height:u}=d;ti||(ti=document.createElement("canvas"));const m=ti.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>ti.width||u>ti.height)&&(ti.width=l,ti.height=u),m.clearRect(-o,-o,l+2*o,u+2*o),m.drawImage(d,0,0,l,u),m.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:d=>(_l||(_l=document.createElement("a")),_l.href=d,_l.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==_c&&(_c=window.matchMedia("(prefers-reduced-motion: reduce)")),_c.matches)},hasCanvasFingerprintNoise(){if(void 0!==Oo)return Oo;if(!Is())return Oo=!1,!1;const d=new OffscreenCanvas(85,1),o=d.getContext("2d",{willReadFrequently:!0});let l=0;for(let m=0;m<d.width;++m)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(m,0,1,1);const u=o.getImageData(0,0,d.width,d.height);l=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&l++!==u.data[m])return Oo=!0,!0;return Oo=!1,!1}};function Os(d,o){const l=d.indexOf("?");if(l<0)return`${d}?${new URLSearchParams(o).toString()}`;const u=new URLSearchParams(d.slice(l));for(const m in o)u.set(m,o[m]);return`${d.slice(0,l)}?${u.toString()}`}function Rs(d,o={persistentParams:[]}){const l=d.indexOf("?");if(l<0)return d;const u=new URLSearchParams,m=new URLSearchParams(d.slice(l));for(const b of o.persistentParams){const C=m.get(b);C&&u.set(b,C)}const v=u.toString();return`${d.slice(0,l)}${v.length>0?`?${v}`:""}`}const $o="mapbox-tiles";let na=500,uo=50;const tr=["language","worldview","jobid"];let Ls,Ro;function Rd(){try{return caches}catch{}}function Qa(){const d=Rd();d&&null==Ls&&(Ls=d.open($o))}let Tr=1/0;const Ri={supported:!1,testSupport:function(d){!vc&&Es&&(Hc?Uc(d):yc=d)}};let yc,Es,vc=!1,Hc=!1;const Ht=typeof self<"u"?self:{};function Uc(d){const o=d.createTexture();d.bindTexture(d.TEXTURE_2D,o);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Es),d.isContextLost())return;Ri.supported=!0}catch{}d.deleteTexture(o),vc=!0}Ht.document&&(Es=Ht.document.createElement("img"),Es.onload=function(){yc&&Uc(yc),yc=null,Hc=!0},Es.onerror=function(){vc=!0,yc=null},Es.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ui={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Ui);class jn extends Error{constructor(o,l,u){401===l&&rr(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const vi=wi()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,po=function(d,o){if(!(/^file:/.test(l=d.url)||/^file:/.test(vi())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const v=new AbortController,b=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:vi(),referrerPolicy:u.referrerPolicy,signal:v.signal});let C=!1,D=!1;const I=(R=b.url).indexOf("sku=")>0&&rr(R);var R;"json"===u.type&&b.headers.set("Accept","application/json");const N=(K,Z,te)=>{if(D)return;if(K&&"SecurityError"!==K.message&&ci(K.toString()),Z&&te)return j(Z);const ce=Date.now();fetch(b).then(ue=>{if(ue.ok){const xe=I?ue.clone():null;return j(ue,xe,ce)}return m(new jn(ue.statusText,ue.status,u.url))}).catch(ue=>{"AbortError"!==ue.name&&m(new Error(`${ue.message} ${u.url}`))})},j=(K,Z,te)=>{("arrayBuffer"===u.type?K.arrayBuffer():"json"===u.type?K.json():K.text()).then(ce=>{D||(Z&&te&&function(ue,xe,ve){if(Qa(),null==Ls)return;const ie=Do(xe.headers.get("Cache-Control")||"");if(ie["no-store"])return;const _e={status:xe.status,statusText:xe.statusText,headers:new Headers};xe.headers.forEach((ze,qe)=>_e.headers.set(qe,ze)),ie["max-age"]&&_e.headers.set("Expires",new Date(ve+1e3*ie["max-age"]).toUTCString());const we=_e.headers.get("Expires");if(!we||new Date(we).getTime()-ve<42e4)return;let Ce=Rs(ue.url,{persistentParams:tr});if(206===xe.status){const ze=ue.headers.get("Range");if(!ze)return;_e.status=200,Ce=Os(Ce,{range:ze})}!function(ze,qe){if(void 0===Ro)try{new Response(new ReadableStream),Ro=!0}catch{Ro=!1}Ro?qe(ze.body):ze.blob().then(qe).catch(Ze=>ci(Ze.message))}(xe,ze=>{const qe=new Response(200!==(Ze=xe.status)&&404!==Ze&&[101,103,204,205,304].includes(Ze)?null:ze,_e);var Ze;Qa(),Ls?.then(Xe=>Xe.put(Ce,qe)).catch(Xe=>ci(Xe.message))})}(b,Z,te),C=!0,m(null,ce,K.headers.get("Cache-Control"),K.headers.get("Expires")))}).catch(ce=>{D||m(new Error(ce.message))})};return I?function(K,Z){if(Qa(),null==Ls)return Z(null);Ls.then(te=>{let ce=Rs(K.url,{persistentParams:tr});const ue=K.headers.get("Range");ue&&(ce=Os(ce,{range:ue})),te.match(ce).then(xe=>{const ve=function(ie){if(!ie)return!1;const _e=new Date(ie.headers.get("Expires")||0),we=Do(ie.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!we["no-cache"]}(xe);te.delete(ce).catch(Z),ve&&te.put(ce,xe.clone()).catch(Z),Z(null,xe,ve)}).catch(Z)}).catch(Z)}(b,N):N(null,null),{cancel:()=>{D=!0,C||v.abort()}}}(d,o);if(wi(self)&&self.worker.actor)return self.worker.actor.send("getResource",d,o,void 0,!0)}var l;return function(u,m){const v=new XMLHttpRequest;v.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(v.responseType="arraybuffer");for(const b in u.headers)v.setRequestHeader(b,u.headers[b]);return"json"===u.type&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials="include"===u.credentials,v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||0===v.status)&&null!==v.response){let b=v.response;if("json"===u.type)try{b=JSON.parse(v.response)}catch(C){return m(C)}m(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else m(new jn(v.statusText,v.status,u.url))},v.send(u.body),{cancel:()=>v.abort()}}(d,o)},Ld=function(d,o){return po(tt(d,{type:"arrayBuffer"}),o)};function Ah(d){const o=document.createElement("a");return o.href=d,o.protocol===location.protocol&&o.host===location.host}const Ma="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let yl,Ja;yl=[],Ja=0;const ad=function(d,o){if(Ri.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),Ja>=cs.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:d,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return yl.push(v),v}Ja++;let l=!1;const u=()=>{if(!l)for(l=!0,Ja--;yl.length&&Ja<cs.MAX_PARALLEL_IMAGE_REQUESTS;){const v=yl.shift(),{requestParameters:b,callback:C,cancelled:D}=v;D||(v.cancel=ad(b,C).cancel)}},m=Ld(d,(v,b,C,D)=>{u(),v?o(v):b&&(self.createImageBitmap?function(I,R){const N=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(N).then(j=>{R(null,j)}).catch(j=>{R(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(I,R)=>o(I,R,C,D)):function(I,R){const N=new Image;N.onload=()=>{R(null,N),URL.revokeObjectURL(N.src),N.onload=null,requestAnimationFrame(()=>{N.src=Ma})},N.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(I)],{type:"image/png"});N.src=I.byteLength?URL.createObjectURL(j):Ma}(b,(I,R)=>o(I,R,C,D)))});return{cancel:()=>{m.cancel(),u()}}};var vl,Ws,Ll,Ph={exports:{}},ih={exports:{}},ru={exports:{}},Ca=mc(function(){if(Ll)return Ph.exports;Ll=1;var d=(vl||(vl=1,ih.exports=function(l,u){var m,v,b,C,D,I,R,N;for(v=l.length-(m=3&l.length),b=u,D=3432918353,I=461845907,N=0;N<v;)R=255&l.charCodeAt(N)|(255&l.charCodeAt(++N))<<8|(255&l.charCodeAt(++N))<<16|(255&l.charCodeAt(++N))<<24,++N,b=27492+(65535&(C=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*D+(((R>>>16)*D&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(R=0,m){case 3:R^=(255&l.charCodeAt(N+2))<<16;case 2:R^=(255&l.charCodeAt(N+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&l.charCodeAt(N)))*D+(((R>>>16)*D&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295}return b^=l.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),ih.exports),o=(Ws||(Ws=1,ru.exports=function(l,u){for(var m,v=l.length,b=u^v,C=0;v>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(C)|(255&l.charCodeAt(++C))<<8|(255&l.charCodeAt(++C))<<16|(255&l.charCodeAt(++C))<<24))+((1540483477*(m>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),v-=4,++C;switch(v){case 3:b^=(255&l.charCodeAt(C+2))<<16;case 2:b^=(255&l.charCodeAt(C+1))<<8;case 1:b=1540483477*(65535&(b^=255&l.charCodeAt(C)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),ru.exports);return Ph.exports=d,Ph.exports.murmur3=d,Ph.exports.murmur2=o,Ph.exports}());class Fl{constructor(o,...l){tt(this,l[0]||{}),this.type=o}}class Va extends Fl{constructor(o,l={}){super("error",tt({error:o},l))}}function On(d,o,l){l[d]&&-1!==l[d].indexOf(o)||(l[d]=l[d]||[],l[d].push(o))}function ou(d,o,l){if(l&&l[d]){const u=l[d].indexOf(o);-1!==u&&l[d].splice(u,1)}}class Sa{on(o,l){return this._listeners=this._listeners||{},On(o,l,this._listeners),this}off(o,l){return ou(o,l,this._listeners),ou(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},On(o,l,this._oneTimeListeners),this):new Promise(u=>{this.once(o,u)})}fire(o,l){const u="string"==typeof o?new Fl(o,l):o,m=u.type;if(this.listens(m)){u.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const D of v)D.call(this,u);const b=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const D of b)ou(m,D,this._oneTimeListeners),D.call(this,u);const C=this._eventedParent;C&&(tt(u,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),C.fire(u))}else u instanceof Va&&console.error(u.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}class Xo{constructor(o){"string"==typeof o?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new Xo(o)}static toString(o){return o.iconsetId?`${o.name}\x1f${o.iconsetId}`:o.name}static parse(o){const[l,u]=o.split("\x1f");return new Xo({name:l,iconsetId:u})}static isEqual(o,l){return o.name===l.name&&o.iconsetId===l.iconsetId}toString(){return Xo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var vn,su={},Ii=function(){if(vn)return su;vn=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(v){return(v=Math.round(v))<0?0:v>255?255:v}function l(v){return o("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function u(v){return(b="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:b>1?1:b;var b}function m(v,b,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?v+(b-v)*C*6:2*C<1?b:3*C<2?v+(b-v)*(2/3-C)*6:v}try{su.parseCSSColor=function(v){var b,C=v.replace(/ /g,"").toLowerCase();if(C in d)return d[C].slice();if("#"===C[0])return 4===C.length?(b=parseInt(C.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===C.length&&(b=parseInt(C.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var D=C.indexOf("("),I=C.indexOf(")");if(-1!==D&&I+1===C.length){var R=C.substr(0,D),N=C.substr(D+1,I-(D+1)).split(","),j=1;switch(R){case"rgba":if(4!==N.length)return null;j=u(N.pop());case"rgb":return 3!==N.length?null:[l(N[0]),l(N[1]),l(N[2]),j];case"hsla":if(4!==N.length)return null;j=u(N.pop());case"hsl":if(3!==N.length)return null;var K=(parseFloat(N[0])%360+360)%360/360,Z=u(N[1]),te=u(N[2]),ce=te<=.5?te*(Z+1):te+Z-te*Z,ue=2*te-ce;return[o(255*m(ue,ce,K+1/3)),o(255*m(ue,ce,K)),o(255*m(ue,ce,K-1/3)),j];default:return null}}return null}}catch{}return su}();class Ni{constructor(o,l,u,m=1){this.r=o,this.g=l,this.b=u,this.a=m}static parse(o){if(!o)return;if(o instanceof Ni)return o;if("string"!=typeof o)return;const l=Ii.parseCSSColor(o);return l?new Ni(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toStringPremultipliedAlpha(){const[o,l,u,m]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${m})`}toString(){const[o,l,u,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*l)},${Math.round(255*u)},${m})`}toRenderColor(o){const{r:l,g:u,b:m,a:v}=this;return new Uu(o,l,u,m,v)}clone(){return new Ni(this.r,this.g,this.b,this.a)}}class Uu{constructor(o,l,u,m,v){if(o){const b=o.image.height,C=b*b;l=0===v?0:l/v*(b-1),u=0===v?0:u/v*(b-1),m=0===v?0:m/v*(b-1);const D=Math.floor(l),I=Math.floor(u),R=Math.floor(m),N=Math.ceil(l),j=Math.ceil(u),K=Math.ceil(m),Z=l-D,te=u-I,ce=m-R,ue=o.image.data,xe=4*(D+I*C+R*b),ve=4*(D+I*C+K*b),ie=4*(D+j*C+R*b),_e=4*(D+j*C+K*b),we=4*(N+I*C+R*b),Ce=4*(N+I*C+K*b),ze=4*(N+j*C+R*b),qe=4*(N+j*C+K*b);if(xe<0||qe>=ue.length)throw new Error("out of range");this.r=Cn(Cn(Cn(ue[xe],ue[ve],ce),Cn(ue[ie],ue[_e],ce),te),Cn(Cn(ue[we],ue[Ce],ce),Cn(ue[ze],ue[qe],ce),te),Z)/255*v,this.g=Cn(Cn(Cn(ue[xe+1],ue[ve+1],ce),Cn(ue[ie+1],ue[_e+1],ce),te),Cn(Cn(ue[we+1],ue[Ce+1],ce),Cn(ue[ze+1],ue[qe+1],ce),te),Z)/255*v,this.b=Cn(Cn(Cn(ue[xe+2],ue[ve+2],ce),Cn(ue[ie+2],ue[_e+2],ce),te),Cn(Cn(ue[we+2],ue[Ce+2],ce),Cn(ue[ze+2],ue[qe+2],ce),te),Z)/255*v,this.a=v}else this.r=l,this.g=u,this.b=m,this.a=v}toArray(){const{r:o,g:l,b:u,a:m}=this;return 0===m?[0,0,0,0]:[255*o/m,255*l/m,255*u/m,m]}toHslaArray(){if(0===this.a)return[0,0,0,0];const{r:o,g:l,b:u,a:m}=this,v=Math.min(Math.max(o/m,0),1),b=Math.min(Math.max(l/m,0),1),C=Math.min(Math.max(u/m,0),1),D=Math.min(v,b,C),I=Math.max(v,b,C),R=(D+I)/2;if(D===I)return[0,0,100*R,m];const N=I-D,j=R>.5?N/(2-I-D):N/(I+D);let K=0;return I===v?K=(b-C)/N+(b<C?6:0):I===b?K=(C-v)/N+2:I===C&&(K=(v-b)/N+4),K*=60,[Math.min(Math.max(K,0),360),Math.min(Math.max(100*j,0),100),Math.min(Math.max(100*R,0),100),m]}toArray01(){const{r:o,g:l,b:u,a:m}=this;return 0===m?[0,0,0,0]:[o/m,l/m,u/m,m]}toArray01Scaled(o){const{r:l,g:u,b:m,a:v}=this;return 0===v?[0,0,0]:[l/v*o,u/v*o,m/v*o]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:m}=this;return[o,l,u,m]}toArray01Linear(){const{r:o,g:l,b:u,a:m}=this;return 0===m?[0,0,0,0]:[Math.pow(o/m,2.2),Math.pow(l/m,2.2),Math.pow(u/m,2.2),m]}}function Cn(d,o,l){return d*(1-l)+o*l}function qu(d,o,l){return d.map((u,m)=>Cn(u,o[m],l))}function el(d){return d*d*d*d*d}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1),Ni.blue=new Ni(0,0,1,1);var Fd=Object.freeze({__proto__:null,array:qu,color:function(d,o,l){return new Ni(Cn(d.r,o.r,l),Cn(d.g,o.g,l),Cn(d.b,o.b,l),Cn(d.a,o.a,l))},easeIn:el,number:Cn});function Ea(d,...o){for(const l of o)for(const u in l)d[u]=l[u];return d}class bl extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class ld{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,m]of l)this.bindings[u]=m}concat(o){return new ld(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Fi={kind:"null"},yn={kind:"number"},nr={kind:"string"},bi={kind:"boolean"},Da={kind:"color"},cd={kind:"object"},Hn={kind:"value"},zd={kind:"collator"},au={kind:"formatted"},tn={kind:"resolvedImage"};function Zs(d,o){return{kind:"array",itemType:d,N:o}}function To(d){if("array"===d.kind){const o=To(d.itemType);return"number"==typeof d.N?`array<${o}, ${d.N}>`:"value"===d.itemType.kind?"array":`array<${o}>`}return d.kind}const $u=[Fi,yn,nr,bi,Da,au,cd,Zs(Hn),tn];function zl(d,o){if("error"===o.kind)return null;if("array"===d.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!zl(d.itemType,o.itemType))&&("number"!=typeof d.N||d.N===o.N))return null}else{if(d.kind===o.kind)return null;if("value"===d.kind)for(const l of $u)if(!zl(l,o))return null}return`Expected ${To(d)} but found ${To(o)} instead.`}function bc(d,o){return o.some(l=>l.kind===d.kind)}function qc(d,o){return o.some(l=>"null"===l?null===d:"array"===l?Array.isArray(d):"object"===l?d&&!Array.isArray(d)&&"object"==typeof d:l===typeof d)}class xl{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ia{constructor(o,l,u,m,v){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=m,this.textColor=v}}class Ta{constructor(o){this.sections=o}static fromString(o){return new Ta([new ia(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Ta?o:Ta.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){const m=l.image.getPrimary().id.toString();o.push(["image",m]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(u)}return o}}class Nl{constructor(o,l={}){if(this.id=Xo.from(o),this.options=Object.assign({},l),l.transform){const{a:u,b:m,c:v,d:b,e:C,f:D}=l.transform;this.options.transform=new DOMMatrix([u,m,v,b,C,D])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:o,b:l,c:u,d:m,e:v,f:b}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:o,b:l,c:u,d:m,e:v,f:b}})}static parse(o){let l,u,m,v;try{({name:l,iconsetId:u,params:m,transform:v}=JSON.parse(o)||{})}catch{return null}if(!l)return null;const{a:b,b:C,c:D,d:I,e:R,f:N}=v||{};return new Nl({name:l,iconsetId:u},{params:m,transform:new DOMMatrix([b,C,D,I,R,N])})}scaleSelf(o,l){return this.options.transform.scaleSelf(o,l),this}}class ja{constructor(o,l,u,m,v=!1){this.primaryId=Xo.from(o),this.primaryOptions=l,u&&(this.secondaryId=Xo.from(u)),this.secondaryOptions=m,this.available=v}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Nl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Nl(this.secondaryId,this.secondaryOptions):null}static from(o){return"string"==typeof o?ja.build({name:o}):o}static build(o,l,u,m){return!o||"object"==typeof o&&!("name"in o)?null:new ja(o,u,l,m)}}function $c(d,o,l,u){return"number"==typeof d&&d>=0&&d<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[d,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[d,o,l,u]:[d,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ql(d){if(null===d||"string"==typeof d||"boolean"==typeof d||"number"==typeof d||d instanceof Ni||d instanceof xl||d instanceof Ta||d instanceof ja)return!0;if(Array.isArray(d)){for(const o of d)if(!Ql(o))return!1;return!0}if("object"==typeof d){for(const o in d)if(!Ql(d[o]))return!1;return!0}return!1}function Vo(d){if(null===d)return Fi;if("string"==typeof d)return nr;if("boolean"==typeof d)return bi;if("number"==typeof d)return yn;if(d instanceof Ni)return Da;if(d instanceof xl)return zd;if(d instanceof Ta)return au;if(d instanceof ja)return tn;if(Array.isArray(d)){const o=d.length;let l;for(const u of d){const m=Vo(u);if(l){if(l===m)continue;l=Hn;break}l=m}return Zs(l||Hn,o)}return cd}function ra(d){const o=typeof d;return null===d?"":"string"===o||"number"===o||"boolean"===o?String(d):d instanceof Ni?d.toStringPremultipliedAlpha():d instanceof Ta||d instanceof ja?d.toString():JSON.stringify(d)}class Yn{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Ql(o[1]))return l.error("invalid value");const u=o[1];let m=Vo(u);const v=l.expectedType;return"array"!==m.kind||0!==m.N||!v||"array"!==v.kind||"number"==typeof v.N&&0!==v.N||(m=v),new Yn(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ta?this.value.serialize():this.value}}class rn{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const oa={string:nr,number:yn,boolean:bi,object:cd};class kn{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,m=1;const v=o[0];if("array"===v){let C,D;if(o.length>2){const I=o[1];if("string"!=typeof I||!(I in oa)||"object"===I)return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=oa[I],m++}else C=Hn;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=o[2],m++}u=Zs(C,D)}else u=oa[v];const b=[];for(;m<o.length;m++){const C=l.parse(o[m],m,Hn);if(!C)return null;b.push(C)}return new kn(u,b)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!zl(this.type,Vo(u)))return u;if(l===this.args.length-1)throw new rn(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${To(Vo(u))} but was expected to be of type ${To(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const m=o.N;("number"==typeof m||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(u=>u.serialize()))}}class Nd{constructor(o){this.type=au,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const m=[];let v=!1;for(let b=1;b<=o.length-1;++b){const C=o[b];if(v&&"object"==typeof C&&!Array.isArray(C)){v=!1;let D=null;if(C["font-scale"]&&(D=l.parseObjectValue(C["font-scale"],b,"font-scale",yn),!D))return null;let I=null;if(C["text-font"]&&(I=l.parseObjectValue(C["text-font"],b,"text-font",Zs(nr)),!I))return null;let R=null;if(C["text-color"]&&(R=l.parseObjectValue(C["text-color"],b,"text-color",Da),!R))return null;const N=m[m.length-1];N.scale=D,N.font=I,N.textColor=R}else{const D=l.parse(o[b],b,Hn);if(!D)return null;const I=D.type.kind;if("string"!==I&&"value"!==I&&"null"!==I&&"resolvedImage"!==I)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:D,scale:null,font:null,textColor:null})}}return new Nd(m)}evaluate(o){return new Ta(this.sections.map(l=>{const u=l.content.evaluate(o);return Vo(u)===tn?new ia("",u,null,null,null):new ia(ra(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class vs{constructor(o,l,u,m){this._imageWarnHistory={},this.type=tn,this.namePrimary=o,this.nameSecondary=l,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");let u=1;const m=[];function v(){if(u<o.length){const C=l.parse(o[u],u++,nr);return C?(m.push({image:C,options:{}}),!0):(l.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function b(){if(u<o.length){const D=o[u];if(null===(C=D)||"object"!=typeof C||Array.isArray(C))return!0;const I=D.params,R=D.iconset,N=l.concat(u);if(!I&&!R)return u++,!0;if(I){if("object"!=typeof I||I.constructor!==Object)return N.error('Image options "params" should be an object'),!1;const j={},K=N.concat(void 0,"params");for(const Z in I){if(!Z)return K.error("Image parameter name should be non-empty"),!1;const te=K.concat(void 0,Z).parse(I[Z],void 0,Da,void 0,{typeAnnotation:"coerce"});if(!te)return!1;j[Z]=te}m[m.length-1].options.params=j}if(R){if("object"!=typeof R||R.constructor!==Object)return N.error('Image options "iconset" should be an object'),!1;if(!R.id)return N.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=R}return u++,!0}var C;return!0}for(let C=0;C<2;C++)if(!v()||!b())return;return new vs(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(o,l){const u={};if(l){for(const m in l)if(l[m])try{u[m]=l[m].evaluate(o)}catch{continue}if(0!==Object.keys(u).length)return{params:u}}}evaluate(o){const l={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,m=ja.build(l,u,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(m&&o.availableImages){const v=m.getPrimary().id;if(m.available=o.availableImages.some(b=>Xo.isEqual(b,v)),m.available){const b=m.getSecondary()?m.getSecondary().id:null;b&&(m.available=o.availableImages.some(C=>Xo.isEqual(C,b)))}}return m}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&o(this.paramsPrimary[l]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&o(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(o,l){const u={};if(l&&(u.iconset={id:l}),o){u.params={};for(const m in o)o[m]&&(u.params[m]=o[m].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&o.push(l)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&o.push(l)}return o}}function Ln(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":null===d?"null":typeof d}const Dt={"to-boolean":bi,"to-color":Da,"to-number":yn,"to-string":nr};class wl{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0],m=[];let v=Fi;if("to-array"===u){if(!Array.isArray(o[1]))return null;const b=o[1].length;if(l.expectedType){if("array"!==l.expectedType.kind)return l.error(`Expected ${l.expectedType.kind} but found array.`);v=Zs(l.expectedType.itemType,b)}else{if(!(b>0&&Ql(o[1][0])))return null;v=Zs(Vo(o[1][0]),b)}for(let C=0;C<b;C++){const D=o[1][C];let I;if("array"===Ln(D))I=l.parse(D,void 0,v.itemType);else{const R=Ln(D);if(R!==v.itemType.kind)return l.error(`Expected ${v.itemType.kind} but found ${R}.`);I=l.registry.literal.parse(["literal",void 0===D?null:D],l)}if(!I)return null;m.push(I)}}else{if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");v=Dt[u];for(let b=1;b<o.length;b++){const C=l.parse(o[b],b,Hn);if(!C)return null;m.push(C)}}return new wl(v,m)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let l,u;for(const m of this.args){if(l=m.evaluate(o),u=null,l instanceof Ni)return l;if("string"==typeof l){const v=o.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:$c(l[0],l[1],l[2],l[3]),!u))return new Ni(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new rn(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const m=Number(l);if(!isNaN(m))return m}throw new rn(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Ta.fromString(ra(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?ja.build(ra(this.args[0].evaluate(o))):"array"===this.type.kind?this.args.map(l=>l.evaluate(o)):ra(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Nd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vs(this.args[0]).serialize();const o="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Rn=["Unknown","Point","LineString","Polygon"];class dd{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Rn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*l-o[0])+this.featureDistanceData.bearing[1]*(m*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=Ni.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class ds{constructor(o,l,u,m,v){this.name=o,this.type=l,this._evaluate=u,this.args=m,this._overloadIndex=v}evaluate(o){if(!this._evaluate){const l=ds.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],m=ds.definitions[u];if(!m)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,b=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,C=[];let D=null,I=-1;for(const[R,N]of b){if(Array.isArray(R)&&R.length!==o.length-1)continue;C.push(R),I++,D=new At(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const j=[];let K=!1;for(let Z=1;Z<o.length;Z++){const te=o[Z],ce=Array.isArray(R)?R[Z-1]:R.type,ue=D.parse(te,1+j.length,ce);if(!ue){K=!0;break}j.push(ue)}if(!K)if(Array.isArray(R)&&R.length!==j.length)D.error(`Expected ${R.length} arguments, but found ${j.length} instead.`);else{for(let Z=0;Z<j.length;Z++){const te=Array.isArray(R)?R[Z]:R.type,ce=j[Z];D.concat(Z+1).checkSubtype(te,ce.type)}if(0===D.errors.length)return new ds(u,v,N,j,I)}}if(1===C.length)l.errors.push(...D.errors);else{const R=(C.length?C:b.map(([j])=>j)).map(Ds).join(" | "),N=[];for(let j=1;j<o.length;j++){const K=l.parse(o[j],1+N.length);if(!K)return null;N.push(To(K.type))}l.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(o,l){ds.definitions=l;for(const u in l)o[u]=ds}}function Ds(d){return Array.isArray(d)?`(${d.map(To).join(", ")})`:`(${To(d.type)}...)`}class tl{constructor(o,l,u){this.type=zd,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const m=void 0===u["case-sensitive"]?l.parse(!1,1,bi):l.parseObjectValue(u["case-sensitive"],1,"case-sensitive",bi);if(!m)return null;const v=void 0===u["diacritic-sensitive"]?l.parse(!1,1,bi):l.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",bi);if(!v)return null;let b=null;return u.locale&&(b=l.parseObjectValue(u.locale,1,"locale",nr),!b)?null:new tl(m,v,b)}evaluate(o){return new xl(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function Bl(d,o,l=0,u=d.length-1,m=Ys){for(;u>l;){if(u-l>600){const D=u-l+1,I=o-l+1,R=Math.log(D),N=.5*Math.exp(2*R/3),j=.5*Math.sqrt(R*N*(D-N)/D)*(I-D/2<0?-1:1);Bl(d,o,Math.max(l,Math.floor(o-I*N/D+j)),Math.min(u,Math.floor(o+(D-I)*N/D+j)),m)}const v=d[o];let b=l,C=u;for(Bd(d,l,o),m(d[u],v)>0&&Bd(d,l,u);b<C;){for(Bd(d,b,C),b++,C--;m(d[b],v)<0;)b++;for(;m(d[C],v)>0;)C--}0===m(d[l],v)?Bd(d,l,C):(C++,Bd(d,C,u)),C<=o&&(l=C+1),o<=C&&(u=C-1)}}function Bd(d,o,l){const u=d[o];d[o]=d[l],d[l]=u}function Ys(d,o){return d<o?-1:d>o?1:0}function Fs(d){let o=0;for(let l,u,m=0,v=d.length,b=v-1;m<v;b=m++)l=d[m],u=d[b],o+=(u.x-l.x)*(l.y+u.y);return o}function Go(d,o){d[0]=Math.min(d[0],o[0]),d[1]=Math.min(d[1],o[1]),d[2]=Math.max(d[2],o[0]),d[3]=Math.max(d[3],o[1])}function Aa(d,o){return!(d[0]<=o[0]||d[2]>=o[2]||d[1]<=o[1]||d[3]>=o[3])}function Er(d,o,l){const u=d[0]-o[0],m=d[1]-o[1],v=d[0]-l[0],b=d[1]-l[1];return u*b-v*m==0&&u*v<=0&&m*b<=0}function Vl(d,o,l=!1){let u=!1;for(let C=0,D=o.length;C<D;C++){const I=o[C];for(let R=0,N=I.length,j=N-1;R<N;j=R++){const K=I[j],Z=I[R];if(Er(d,K,Z))return l;(v=K)[1]>(m=d)[1]!=(b=Z)[1]>m[1]&&m[0]<(b[0]-v[0])*(m[1]-v[1])/(b[1]-v[1])+v[0]&&(u=!u)}}var m,v,b;return u}function kl(d,o,l,u){const m=u[0]-l[0],v=u[1]-l[1],b=(d[0]-l[0])*v-m*(d[1]-l[1]),C=(o[0]-l[0])*v-m*(o[1]-l[1]);return b>0&&C<0||b<0&&C>0}function Ha(d,o,l,u){return(m=[u[0]-l[0],u[1]-l[1]])[0]*(v=[o[0]-d[0],o[1]-d[1]])[1]-m[1]*v[0]!=0&&!(!kl(d,o,l,u)||!kl(l,u,d,o));var m,v}function hd(d){const o=new Wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new Wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of d[0])o.x>u.x&&(o.x=u.x),o.y>u.y&&(o.y=u.y),l.x<u.x&&(l.x=u.x),l.y<u.y&&(l.y=u.y);return{min:o,max:l}}const Xs=8192;function ud(d,o){const l=(180+d[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(l*m*Xs),Math.round(u*m*Xs)]}function lu(d,o){for(let l=0;l<o.length;l++)if(Vl(d,o[l]))return!0;return!1}function rh(d,o,l){for(const u of l)for(let m=0,v=u.length,b=v-1;m<v;b=m++)if(Ha(d,o,u[b],u[m]))return!0;return!1}function xc(d,o){for(let l=0;l<d.length;++l)if(!Vl(d[l],o))return!1;for(let l=0;l<d.length-1;++l)if(rh(d[l],d[l+1],o))return!1;return!0}function Ih(d,o){for(let l=0;l<o.length;l++)if(xc(d,o[l]))return!0;return!1}function Vd(d,o,l){const u=[];for(let m=0;m<d.length;m++){const v=[];for(let b=0;b<d[m].length;b++){const C=ud(d[m][b],l);Go(o,C),v.push(C)}u.push(v)}return u}function jd(d,o,l){const u=[];for(let m=0;m<d.length;m++){const v=Vd(d[m],o,l);u.push(v)}return u}function Gc(d,o,l,u){if(d[0]<l[0]||d[0]>l[2]){const m=.5*u;let v=d[0]-l[0]>m?-u:l[0]-d[0]>m?u:0;0===v&&(v=d[0]-l[2]>m?-u:l[2]-d[0]>m?u:0),d[0]+=v}Go(o,d)}function Hd(d,o,l,u){const m=Math.pow(2,u.z)*Xs,v=[u.x*Xs,u.y*Xs],b=[];if(!d)return b;for(const C of d)for(const D of C){const I=[D.x+v[0],D.y+v[1]];Gc(I,o,l,m),b.push(I)}return b}function Gu(d,o,l,u){const m=Math.pow(2,u.z)*Xs,v=[u.x*Xs,u.y*Xs],b=[];if(!d)return b;for(const D of d){const I=[];for(const R of D){const N=[R.x+v[0],R.y+v[1]];Go(o,N),I.push(N)}b.push(I)}if(o[2]-o[0]<=m/2){(C=o)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const D of b)for(const I of D)Gc(I,o,l,m)}var C;return b}class Jl{constructor(o,l){this.type=bi,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ql(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let m=0;m<u.features.length;++m){const v=u.features[m].geometry.type;if("Polygon"===v||"MultiPolygon"===v)return new Jl(u,u.features[m].geometry)}else if("Feature"===u.type){const m=u.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Jl(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Jl(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===u.type){const C=Vd(u.coordinates,v,b),D=Hd(l.geometry(),m,v,b);if(!Aa(m,v))return!1;for(const I of D)if(!Vl(I,C))return!1}if("MultiPolygon"===u.type){const C=jd(u.coordinates,v,b),D=Hd(l.geometry(),m,v,b);if(!Aa(m,v))return!1;for(const I of D)if(!lu(I,C))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===u.type){const C=Vd(u.coordinates,v,b),D=Gu(l.geometry(),m,v,b);if(!Aa(m,v))return!1;for(const I of D)if(!xc(I,C))return!1}if("MultiPolygon"===u.type){const C=jd(u.coordinates,v,b),D=Gu(l.geometry(),m,v,b);if(!Aa(m,v))return!1;for(const I of D)if(!Ih(I,C))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Oh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},cu=1/298.257223563,es=cu*(2-cu),sa=Math.PI/180;class wc{static fromTile(o,l,u){const m=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),v=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/sa;return new wc(v,u)}static get units(){return Oh}constructor(o,l){if(void 0===o)throw new Error("No latitude given.");if(l&&!Oh[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Oh).join(", ")}`);const u=6378.137*sa*(l?Oh[l]:1),m=Math.cos(o*sa),v=1/(1-es*(1-m*m)),b=Math.sqrt(v);this.kx=u*b*m,this.ky=u*b*v*(1-es)}distance(o,l){const u=jl(o[0]-l[0])*this.kx,m=(o[1]-l[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(o,l){const u=jl(l[0]-o[0])*this.kx;return Math.atan2(u,(l[1]-o[1])*this.ky)/sa}destination(o,l,u){const m=u*sa;return this.offset(o,Math.sin(m)*l,Math.cos(m)*l)}offset(o,l,u){return[o[0]+l/this.kx,o[1]+u/this.ky]}lineDistance(o){let l=0;for(let u=0;u<o.length-1;u++)l+=this.distance(o[u],o[u+1]);return l}area(o){let l=0;for(let u=0;u<o.length;u++){const m=o[u];for(let v=0,b=m.length,C=b-1;v<b;C=v++)l+=jl(m[v][0]-m[C][0])*(m[v][1]+m[C][1])*(u?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let u=0;if(l<=0)return o[0];for(let m=0;m<o.length-1;m++){const v=o[m],b=o[m+1],C=this.distance(v,b);if(u+=C,u>l)return Ud(v,b,(l-(u-C))/C)}return o[o.length-1]}pointToSegmentDistance(o,l,u){let[m,v]=l,b=jl(u[0]-m)*this.kx,C=(u[1]-v)*this.ky;if(0!==b||0!==C){const D=(jl(o[0]-m)*this.kx*b+(o[1]-v)*this.ky*C)/(b*b+C*C);D>1?(m=u[0],v=u[1]):D>0&&(m+=b/this.kx*D,v+=C/this.ky*D)}return b=jl(o[0]-m)*this.kx,C=(o[1]-v)*this.ky,Math.sqrt(b*b+C*C)}pointOnLine(o,l){let u=1/0,m=o[0][0],v=o[0][1],b=0,C=0;for(let D=0;D<o.length-1;D++){let I=o[D][0],R=o[D][1],N=jl(o[D+1][0]-I)*this.kx,j=(o[D+1][1]-R)*this.ky,K=0;0===N&&0===j||(K=(jl(l[0]-I)*this.kx*N+(l[1]-R)*this.ky*j)/(N*N+j*j),K>1?(I=o[D+1][0],R=o[D+1][1]):K>0&&(I+=N/this.kx*K,R+=j/this.ky*K)),N=jl(l[0]-I)*this.kx,j=(l[1]-R)*this.ky;const Z=N*N+j*j;Z<u&&(u=Z,m=I,v=R,b=D,C=K)}return{point:[m,v],index:b,t:Math.max(0,Math.min(1,C))}}lineSlice(o,l,u){let m=this.pointOnLine(u,o),v=this.pointOnLine(u,l);if(m.index>v.index||m.index===v.index&&m.t>v.t){const I=m;m=v,v=I}const b=[m.point],C=m.index+1,D=v.index;!Wu(u[C],b[0])&&C<=D&&b.push(u[C]);for(let I=C+1;I<=D;I++)b.push(u[I]);return Wu(u[D],v.point)||b.push(v.point),b}lineSliceAlong(o,l,u){let m=0;const v=[];for(let b=0;b<u.length-1;b++){const C=u[b],D=u[b+1],I=this.distance(C,D);if(m+=I,m>o&&0===v.length&&v.push(Ud(C,D,(o-(m-I))/I)),m>=l)return v.push(Ud(C,D,(l-(m-I))/I)),v;m>o&&v.push(D)}return v}bufferPoint(o,l){const u=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-u,o[0]+m,o[1]+u]}bufferBBox(o,l){const u=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-u,o[2]+m,o[3]+u]}insideBBox(o,l){return jl(o[0]-l[0])>=0&&jl(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function Wu(d,o){return d[0]===o[0]&&d[1]===o[1]}function Ud(d,o,l){const u=jl(o[0]-d[0]);return[d[0]+u*l,d[1]+(o[1]-d[1])*l]}function jl(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class du{constructor(o=[],l=((u,m)=>u<m?-1:u>m?1:0)){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,m=l[o];for(;o>0;){const v=o-1>>1,b=l[v];if(u(m,b)>=0)break;l[o]=b,o=v}l[o]=m}_down(o){const{data:l,compare:u}=this,m=this.length>>1,v=l[o];for(;o<m;){let b=1+(o<<1);const C=b+1;if(C<this.length&&u(l[C],l[b])<0&&(b=C),u(l[b],v)>=0)break;l[o]=l[b],o=b}l[o]=v}}var Xt=8192;function qd(d,o){return o.dist-d.dist}const hu=100,kc=50;function Xn(d){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==d.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==d[l])return!1;return!0}function pd(d){return d[1]-d[0]+1}function Hl(d,o){const l=d[1]>=d[0]&&d[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function nl(d,o){if(d[0]>d[1])return[null,null];const l=pd(d);if(o){if(2===l)return[d,null];const u=Math.floor(l/2);return[[d[0],d[0]+u],[d[0]+u,d[1]]]}{if(1===l)return[d,null];const u=Math.floor(l/2)-1;return[[d[0],d[0]+u],[d[0]+u+1,d[1]]]}}function Bi(d,o){const l=[1/0,1/0,-1/0,-1/0];if(!Hl(o,d.length))return l;for(let u=o[0];u<=o[1];++u)Go(l,d[u]);return l}function oh(d){const o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<d.length;++l)for(let u=0;u<d[l].length;++u)Go(o,d[l][u]);return o}function Ul(d,o,l){if(Xn(d)||Xn(o))return NaN;let u=0,m=0;return d[2]<o[0]&&(u=o[0]-d[2]),d[0]>o[2]&&(u=d[0]-o[2]),d[1]>o[3]&&(m=d[1]-o[3]),d[3]<o[1]&&(m=o[1]-d[3]),l.distance([0,0],[u,m])}function gi(d){return 360*d-180}function $n(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Wi(d,o){const l=Math.pow(2,o.z),u=(d.y/Xt+o.y)/l;return[gi((d.x/Xt+o.x)/l),$n(u)]}function zs(d,o){const l=[];for(let u=0;u<d.length;++u)l.push(Wi(d[u],o));return l}function aa(d,o,l){const u=l.pointOnLine(o,d).point;return l.distance(d,u)}function ec(d,o,l,u,m){const v=l.slice(u[0],u[1]+1);let b=1/0;for(let C=o[0];C<=o[1];++C)if(0===(b=Math.min(b,aa(d[C],v,m))))return 0;return b}function Pa(d,o,l,u,m){const v=Math.min(m.pointToSegmentDistance(d,l,u),m.pointToSegmentDistance(o,l,u)),b=Math.min(m.pointToSegmentDistance(l,d,o),m.pointToSegmentDistance(u,d,o));return Math.min(v,b)}function jr(d,o,l,u,m){if(!Hl(o,d.length)||!Hl(u,l.length))return NaN;let v=1/0;for(let b=o[0];b<o[1];++b)for(let C=u[0];C<u[1];++C){if(Ha(d[b],d[b+1],l[C],l[C+1]))return 0;v=Math.min(v,Pa(d[b],d[b+1],l[C],l[C+1],m))}return v}function Zu(d,o,l,u,m){if(!Hl(o,d.length)||!Hl(u,l.length))return NaN;let v=1/0;for(let b=o[0];b<=o[1];++b)for(let C=u[0];C<=u[1];++C)if(0===(v=Math.min(v,m.distance(d[b],l[C]))))return v;return v}function sh(d,o,l){if(Vl(d,o,!0))return 0;let u=1/0;for(const m of o){const v=m.length;if(v<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[v-1]&&0===(u=Math.min(u,l.pointToSegmentDistance(d,m[v-1],m[0])))||0===(u=Math.min(u,aa(d,m,l))))return u}return u}function Ip(d,o,l,u){if(!Hl(o,d.length))return NaN;for(let v=o[0];v<=o[1];++v)if(Vl(d[v],l,!0))return 0;let m=1/0;for(let v=o[0];v<o[1];++v)for(const b of l)for(let C=0,D=b.length,I=D-1;C<D;I=C++){if(Ha(d[v],d[v+1],b[I],b[C]))return 0;m=Math.min(m,Pa(d[v],d[v+1],b[I],b[C],u))}return m}function Op(d,o){for(const l of d)for(let u=0;u<=l.length-1;++u)if(Vl(l[u],o,!0))return!0;return!1}function ts(d,o,l,u=1/0){const m=oh(d),v=oh(o);if(u!==1/0&&Ul(m,v,l)>=u)return u;if(Aa(m,v)){if(Op(d,o))return 0}else if(Op(o,d))return 0;let b=u;for(const C of d)for(let D=0,I=C.length,R=I-1;D<I;R=D++)for(const N of o)for(let j=0,K=N.length,Z=K-1;j<K;Z=j++){if(Ha(C[R],C[D],N[Z],N[j]))return 0;b=Math.min(b,Pa(C[R],C[D],N[Z],N[j],l))}return b}function Tn(d,o,l,u,m,v,b){if(null===v||null===b)return;const C=Ul(Bi(u,v),Bi(m,b),l);C<o&&d.push({dist:C,range1:v,range2:b})}function Zi(d,o,l,u,m=1/0){let v=Math.min(u.distance(d[0],l[0][0]),m);if(0===v)return v;const b=new du([{dist:0,range1:[0,d.length-1],range2:[0,0]}],qd),C=o?kc:hu,D=oh(l);for(;b.length;){const I=b.pop();if(I.dist>=v)continue;const R=I.range1;if(pd(R)<=C){if(!Hl(R,d.length))return NaN;if(o){const N=Ip(d,R,l,u);if(0===(v=Math.min(v,N)))return v}else for(let N=R[0];N<=R[1];++N){const j=sh(d[N],l,u);if(0===(v=Math.min(v,j)))return v}}else{const N=nl(R,o);if(null!==N[0]){const j=Ul(Bi(d,N[0]),D,u);j<v&&b.push({dist:j,range1:N[0],range2:[0,0]})}if(null!==N[1]){const j=Ul(Bi(d,N[1]),D,u);j<v&&b.push({dist:j,range1:N[1],range2:[0,0]})}}}return v}function x(d,o,l,u,m,v=1/0){let b=Math.min(v,m.distance(d[0],l[0]));if(0===b)return b;const C=new du([{dist:0,range1:[0,d.length-1],range2:[0,l.length-1]}],qd),D=o?kc:hu,I=u?kc:hu;for(;C.length;){const R=C.pop();if(R.dist>=b)continue;const N=R.range1,j=R.range2;if(pd(N)<=D&&pd(j)<=I){if(!Hl(N,d.length)||!Hl(j,l.length))return NaN;if(o&&u?b=Math.min(b,jr(d,N,l,j,m)):o||u?o&&!u?b=Math.min(b,ec(l,j,d,N,m)):!o&&u&&(b=Math.min(b,ec(d,N,l,j,m))):b=Math.min(b,Zu(d,N,l,j,m)),0===b)return b}else{const K=nl(N,o),Z=nl(j,u);Tn(C,b,m,d,l,K[0],Z[0]),Tn(C,b,m,d,l,K[0],Z[1]),Tn(C,b,m,d,l,K[1],Z[0]),Tn(C,b,m,d,l,K[1],Z[1])}}return b}function T(d,o,l,u,m=1/0){let v=m;const b=Bi(d,[0,d.length-1]);for(const C of l)if(!(v!==1/0&&Ul(b,Bi(C,[0,C.length-1]),u)>=v)&&(v=Math.min(v,x(d,o,C,!0,u,v)),0===v))return v;return v}function H(d,o,l,u,m=1/0){let v=m;const b=Bi(d,[0,d.length-1]);for(const C of l){if(v!==1/0&&Ul(b,oh(C),u)>=v)continue;const D=Zi(d,o,C,u,v);if(isNaN(D))return D;if(0===(v=Math.min(v,D)))return v}return v}function ee(d){return"Point"===d||"MultiPoint"===d||"LineString"===d||"MultiLineString"===d||"Polygon"===d||"MultiPolygon"===d}class pe{constructor(o,l){this.type=yn,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Ql(o[1])){const u=o[1];if("FeatureCollection"===u.type){for(let m=0;m<u.features.length;++m)if(ee(u.features[m].geometry.type))return new pe(u,u.features[m].geometry)}else if("Feature"===u.type){if(ee(u.geometry.type))return new pe(u,u.geometry)}else if(ee(u.type))return new pe(u,u)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const l=o.geometry(),u=o.canonicalID();if(null!=l&&null!=u){if("Point"===o.geometryType())return function(m,v,b){const C=[];for(const I of m)for(const R of I)C.push(Wi(R,v));const D=new wc(C[0][1],"meters");return"Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type?x(C,!1,"Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,D):"MultiLineString"===b.type?T(C,!1,b.coordinates,D):"Polygon"===b.type||"MultiPolygon"===b.type?H(C,!1,"Polygon"===b.type?[b.coordinates]:b.coordinates,D):null}(l,u,this.geometries);if("LineString"===o.geometryType())return function(m,v,b){const C=[];for(const I of m){const R=[];for(const N of I)R.push(Wi(N,v));C.push(R)}const D=new wc(C[0][0][1],"meters");if("Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type)return T("Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,C,D);if("MultiLineString"===b.type){let I=1/0;for(let R=0;R<b.coordinates.length;R++){const N=T(b.coordinates[R],!0,C,D,I);if(isNaN(N))return N;if(0===(I=Math.min(I,N)))return I}return I}if("Polygon"===b.type||"MultiPolygon"===b.type){let I=1/0;for(let R=0;R<C.length;R++){const N=H(C[R],!0,"Polygon"===b.type?[b.coordinates]:b.coordinates,D,I);if(isNaN(N))return N;if(0===(I=Math.min(I,N)))return I}return I}return null}(l,u,this.geometries);if("Polygon"===o.geometryType())return function(m,v,b){const C=[];for(const I of function(R,N){const j=R.length;if(j<=1)return[R];const K=[];let Z,te;for(let ce=0;ce<j;ce++){const ue=Fs(R[ce]);0!==ue&&(R[ce].area=Math.abs(ue),void 0===te&&(te=ue<0),te===ue<0?(Z&&K.push(Z),Z=[R[ce]]):Z.push(R[ce]))}return Z&&K.push(Z),K}(m)){const R=[];for(let N=0;N<I.length;++N)R.push(zs(I[N],v));C.push(R)}const D=new wc(C[0][0][0][1],"meters");if("Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type)return H("Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,C,D);if("MultiLineString"===b.type){let I=1/0;for(let R=0;R<b.coordinates.length;R++){const N=H(b.coordinates[R],!0,C,D,I);if(isNaN(N))return N;if(0===(I=Math.min(I,N)))return I}return I}return"Polygon"===b.type||"MultiPolygon"===b.type?function(I,R,N){let j=1/0;for(const K of I)for(const Z of R){const te=ts(K,Z,N,j);if(isNaN(te))return te;if(0===(j=Math.min(j,te)))return j}return j}("Polygon"===b.type?[b.coordinates]:b.coordinates,C,D):null}(l,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ee(d,o){switch(d){case"string":return ra(o);case"number":return+o;case"boolean":return!!o;case"color":return Ni.parse(o);case"formatted":return Ta.fromString(ra(o));case"resolvedImage":return ja.build(ra(o))}return o}function nt(d,o,l,u){return void 0!==u&&(d=u*Math.round(d/u)),void 0!==o&&d<o&&(d=o),void 0!==l&&d>l&&(d=l),d}class St{constructor(o,l,u){this.type=o,this.key=l,this.scope=u}static parse(o,l){let u=l.expectedType;if(null==u&&(u=Hn),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");const m=l.parse(o[1],1);if(!(m instanceof Yn))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const v=l.parse(o[2],2);return v instanceof Yn?new St(u,ra(m.value),ra(v.value)):l.error("Scope of 'config' expression must be a string literal.")}return new St(u,ra(m.value))}evaluate(o){const l=[this.key,this.scope,o.scope].filter(Boolean).join("\x1f"),u=o.getConfig(l);if(!u)return null;const{type:m,value:v,values:b,minValue:C,maxValue:D,stepValue:I}=u,R=u.default.evaluate(o);let N=R;if(v){const j=o.scope;o.scope=(j||"").split("\x1f").slice(1).join("\x1f"),N=v.evaluate(o),o.scope=j}return m&&(N=Ee(m,N)),void 0===N||void 0===C&&void 0===D&&void 0===I||("number"==typeof N?N=nt(N,C,D,I):Array.isArray(N)&&(N=N.map(j=>"number"==typeof j?nt(j,C,D,I):j))),void 0!==v&&void 0!==N&&b&&!b.includes(N)&&(N=R,m&&(N=Ee(m,N))),(m&&m!==this.type||void 0!==N&&Vo(N)!==this.type)&&(N=Ee(this.type.kind,N)),N}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function yt(d){if(d instanceof ds&&("get"===d.name&&1===d.args.length||"feature-state"===d.name||"has"===d.name&&1===d.args.length||"properties"===d.name||"geometry-type"===d.name||"id"===d.name||/^filter-/.test(d.name))||d instanceof Jl||d instanceof pe)return!1;let o=!0;return d.eachChild(l=>{o&&!yt(l)&&(o=!1)}),o}function on(d){if(d instanceof ds&&"feature-state"===d.name)return!1;let o=!0;return d.eachChild(l=>{o&&!on(l)&&(o=!1)}),o}function Y(d){if(d instanceof St)return new Set([d.key]);let o=new Set;return d.eachChild(l=>{o=new Set([...o,...Y(l)])}),o}function J(d,o){if(d instanceof ds&&o.indexOf(d.name)>=0)return!1;let l=!0;return d.eachChild(u=>{l&&!J(u,o)&&(l=!1)}),l}class fe{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new fe(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ue{constructor(o,l=[],u,m=new ld,v=[],b,C){this.registry=o,this.path=l,this.key=l.map(D=>"string"==typeof D?`['${D}']`:`[${D}]`).join(""),this.scope=m,this.errors=v,this.expectedType=u,this._scope=b,this.options=C}parse(o,l,u,m,v={}){return l||u?this.concat(l,null,u,m)._parse(o,v):this._parse(o,v)}parseObjectValue(o,l,u,m,v,b={}){return this.concat(l,u,m,v)._parse(o,b)}_parse(o,l){function u(m,v,b){return"assert"===b?new kn(v,[m]):"coerce"===b?new wl(v,[m]):m}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m="string"==typeof o[0]?this.registry[o[0]]:void 0;if(m){let v=m.parse(o,this);if(!v)return null;if(this.expectedType){const b=this.expectedType,C=v.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==C.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(b,C))return null}else v=u(v,b,l.typeAnnotation||"coerce");else v=u(v,b,l.typeAnnotation||"assert")}if(!(v instanceof Yn)&&"resolvedImage"!==v.type.kind&&xn(v)){const b=new dd(this._scope,this.options);try{v=new Yn(v.type,v.evaluate(b))}catch(C){return this.error(C.message),null}}return v}return wl.parse(["to-array",o],this)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u,m){let v="number"==typeof o?this.path.concat(o):this.path;v="string"==typeof l?v.concat(l):v;const b=m?this.scope.concat(m):this.scope;return new Ue(this.registry,v,u||null,b,this.errors,this._scope,this.options)}error(o,...l){const u=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new bl(u,o))}checkSubtype(o,l){const u=zl(o,l);return u&&this.error(u),u}}var At=Ue;function xn(d){if(d instanceof fe)return xn(d.boundExpression);if(d instanceof ds&&"error"===d.name||d instanceof tl||d instanceof Jl||d instanceof pe||d instanceof St)return!1;const o=d instanceof wl||d instanceof kn;let l=!0;return d.eachChild(u=>{l=o?l&&xn(u):l&&u instanceof Yn}),!!l&&yt(d)&&J(d,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Mi(d,o){const l=d.length-1;let u,m,v=0,b=l,C=0;for(;v<=b;)if(C=Math.floor((v+b)/2),u=d[C],m=d[C+1],u<=o){if(C===l||o<m)return C;v=C+1}else{if(!(u>o))throw new rn("Input is not a number.");b=C-1}return 0}class yr{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[m,v]of u)this.labels.push(m),this.outputs.push(v)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,yn);if(!u)return null;const m=[];let v=null;l.expectedType&&"value"!==l.expectedType.kind&&(v=l.expectedType);for(let b=1;b<o.length;b+=2){const C=1===b?-1/0:o[b],D=o[b+1],I=b,R=b+1;if("number"!=typeof C)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const N=l.parse(D,R,v);if(!N)return null;v=v||N.type,m.push([C,N])}return new yr(v,u,m)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const m=this.input.evaluate(o);if(m<=l[0])return u[0].evaluate(o);const v=l.length;return m>=l[v-1]?u[v-1].evaluate(o):u[Mi(l,m)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}const fd=4/29,Wc=6/29,Ar=3*Wc*Wc,s0=Wc*Wc*Wc,hs=Math.PI/180,Yu=180/Math.PI;function tc(d){return d>s0?Math.pow(d,1/3):d/Ar+fd}function uu(d){return d>Wc?d*d*d:Ar*(d-fd)}function ah(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function $d(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function Ks(d){const o=$d(d.r),l=$d(d.g),u=$d(d.b),m=tc((.4124564*o+.3575761*l+.1804375*u)/.95047),v=tc((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*v-16,a:500*(m-v),b:200*(v-tc((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:d.a}}function vg(d){let o=(d.l+16)/116,l=isNaN(d.a)?o:o+d.a/500,u=isNaN(d.b)?o:o-d.b/200;return o=1*uu(o),l=.95047*uu(l),u=1.08883*uu(u),new Ni(ah(3.2404542*l-1.5371385*o-.4985314*u),ah(-.969266*l+1.8760108*o+.041556*u),ah(.0556434*l-.2040259*o+1.0572252*u),d.alpha)}function qa(d,o,l){const u=o-d;return d+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ia={forward:Ks,reverse:vg,interpolate:function(d,o,l){return{l:Cn(d.l,o.l,l),a:Cn(d.a,o.a,l),b:Cn(d.b,o.b,l),alpha:Cn(d.alpha,o.alpha,l)}}},pu={forward:function(d){const{l:o,a:l,b:u}=Ks(d),m=Math.atan2(u,l)*Yu;return{h:m<0?m+360:m,c:Math.sqrt(l*l+u*u),l:o,alpha:d.a}},reverse:function(d){const o=d.h*hs,l=d.c;return vg({l:d.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:d.alpha})},interpolate:function(d,o,l){return{h:qa(d.h,o.h,l),c:Cn(d.c,o.c,l),l:Cn(d.l,o.l,l),alpha:Cn(d.alpha,o.alpha,l)}}};var fu=Object.freeze({__proto__:null,hcl:pu,lab:Ia});class il{constructor(o,l,u,m,v){this.type=o,this.operator=l,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[b,C]of v)this.labels.push(b),this.outputs.push(C)}static interpolationFactor(o,l,u,m){let v=0;if("exponential"===o.name)v=nc(l,o.base,u,m);else if("linear"===o.name)v=nc(l,1,u,m);else if("cubic-bezier"===o.name){const b=o.controlPoints;v=new Dh(b[0],b[1],b[2],b[3]).solve(nc(l,1,u,m))}return v}static parse(o,l){let[u,m,v,...b]=o;if(!Array.isArray(m)||0===m.length)return l.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const I=m[1];if("number"!=typeof I)return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:I}}else{if("cubic-bezier"!==m[0])return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const I=m.slice(1);if(4!==I.length||I.some(R=>"number"!=typeof R||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,yn),!v)return null;const C=[];let D=null;"interpolate-hcl"===u||"interpolate-lab"===u?D=Da:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let I=0;I<b.length;I+=2){const R=b[I],N=b[I+1],j=I+3,K=I+4;if("number"!=typeof R)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(C.length&&C[C.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Z=l.parse(N,K,D);if(!Z)return null;D=D||Z.type,C.push([R,Z])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new il(D,u,m,v,C):l.error(`Type ${To(D)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const m=this.input.evaluate(o);if(m<=l[0])return u[0].evaluate(o);const v=l.length;if(m>=l[v-1])return u[v-1].evaluate(o);const b=Mi(l,m),C=il.interpolationFactor(this.interpolation,m,l[b],l[b+1]),D=u[b].evaluate(o),I=u[b+1].evaluate(o);return"interpolate"===this.operator?Fd[this.type.kind.toLowerCase()](D,I,C):"interpolate-hcl"===this.operator?pu.reverse(pu.interpolate(pu.forward(D),pu.forward(I),C)):Ia.reverse(Ia.interpolate(Ia.forward(D),Ia.forward(I),C))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function nc(d,o,l,u){const m=u-l,v=d-l;return 0===m?0:1===o?v/m:(Math.pow(o,v)-1)/(Math.pow(o,m)-1)}class Rp{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const m=l.expectedType;m&&"value"!==m.kind&&(u=m);const v=[];for(const C of o.slice(1)){const D=l.parse(C,1+v.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,v.push(D)}const b=m&&v.some(C=>zl(m,C.type));return new Rp(b?Hn:u,v)}evaluate(o){let l,u=null,m=0;for(const v of this.args){if(m++,u=v.evaluate(o),u&&u instanceof ja&&!u.available&&(l||(l=u),u=null,m===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class bg{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let v=1;v<o.length-1;v+=2){const b=o[v];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const C=l.parse(o[v+1],v+1);if(!C)return null;u.push([b,C])}const m=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return m?new bg(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}class xg{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,yn),m=l.parse(o[2],2,Zs(l.expectedType||Hn));return u&&m?new xg(m.type.itemType,u,m):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new rn(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new rn(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new rn(`Array index must be an integer, but found ${l} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class a0{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,yn),m=l.parse(o[2],2,Zs(l.expectedType||Hn));return u&&m?new a0(m.type.itemType,u,m):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new rn(`Array index out of bounds: ${l} < 0.`);if(l>u.length-1)throw new rn(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l===Math.floor(l))return u[l];const m=Math.floor(l),v=Math.ceil(l),b=u[m],C=u[v];if("number"!=typeof b||"number"!=typeof C)throw new rn(`Cannot interpolate between non-number values at index ${l}.`);const D=l-m;return b*(1-D)+C*D}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class l0{constructor(o,l){this.type=bi,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Hn),m=l.parse(o[2],2,Hn);return u&&m?bc(u.type,[bi,nr,yn,Fi,Hn])?new l0(u,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${To(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!qc(l,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${To(Vo(l))} instead.`);if(!qc(u,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${To(Vo(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wg{constructor(o,l,u){this.type=yn,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Hn),m=l.parse(o[2],2,Hn);if(!u||!m)return null;if(!bc(u.type,[bi,nr,yn,Fi,Hn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${To(u.type)} instead`);if(4===o.length){const v=l.parse(o[3],3,yn);return v?new wg(u,m,v):null}return new wg(u,m)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!qc(l,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${To(Vo(l))} instead.`);if(!qc(u,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${To(Vo(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return u.indexOf(l,m)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ey{constructor(o,l,u,m,v,b){this.inputType=o,this.type=l,this.input=u,this.cases=m,this.outputs=v,this.otherwise=b}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,m;l.expectedType&&"value"!==l.expectedType.kind&&(m=l.expectedType);const v={},b=[];for(let I=2;I<o.length-1;I+=2){let R=o[I];const N=o[I+1];Array.isArray(R)||(R=[R]);const j=l.concat(I);if(0===R.length)return j.error("Expected at least one branch label.");for(const Z of R){if("number"!=typeof Z&&"string"!=typeof Z)return j.error("Branch labels must be numbers or strings.");if("number"==typeof Z&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof Z&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,Vo(Z)))return null}else u=Vo(Z);if(void 0!==v[String(Z)])return j.error("Branch labels must be unique.");v[String(Z)]=b.length}const K=l.parse(N,I,m);if(!K)return null;m=m||K.type,b.push(K)}const C=l.parse(o[1],1,Hn);if(!C)return null;const D=l.parse(o[o.length-1],o.length-1,m);return D?"value"!==C.type.kind&&l.concat(1).checkSubtype(u,C.type)?null:new Ey(u,m,C,v,b,D):null}evaluate(o){const l=this.input.evaluate(o);return(Vo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],m={};for(const b of l){const C=m[this.cases[b]];void 0===C?(m[this.cases[b]]=u.length,u.push([this.cases[b],[b]])):u[C][1].push(b)}const v=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,C]of u)o.push(1===C.length?v(C[0]):C.map(v)),o.push(this.outputs[b].serialize());return o.push(this.otherwise.serialize()),o}}class c0{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const m=[];for(let b=1;b<o.length-1;b+=2){const C=l.parse(o[b],b,bi);if(!C)return null;const D=l.parse(o[b+1],b+1,u);if(!D)return null;m.push([C,D]),u=u||D.type}const v=l.parse(o[o.length-1],o.length-1,u);return v?new c0(u,m,v):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class kg{constructor(o,l,u,m){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=m}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Hn),m=l.parse(o[2],2,yn);if(!u||!m)return null;if(!bc(u.type,[Zs(Hn),nr,Hn]))return l.error(`Expected first argument to be of type array or string, but found ${To(u.type)} instead`);if(4===o.length){const v=l.parse(o[3],3,yn);return v?new kg(u.type,u,m,v):null}return new kg(u.type,u,m)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!qc(l,["string","array"]))throw new rn(`Expected first argument to be of type array or string, but found ${To(Vo(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return l.slice(u,m)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Mg(d,o){return"=="===d||"!="===d?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function vb(d,o,l,u){return 0===u.compare(o,l)}function Lp(d,o,l){const u="=="!==d&&"!="!==d;return class NU{constructor(v,b,C){this.type=bi,this.lhs=v,this.rhs=b,this.collator=C,this.hasUntypedArgument="value"===v.type.kind||"value"===b.type.kind}static parse(v,b){if(3!==v.length&&4!==v.length)return b.error("Expected two or three arguments.");const C=v[0];let D=b.parse(v[1],1,Hn);if(!D)return null;if(!Mg(C,D.type))return b.concat(1).error(`"${C}" comparisons are not supported for type '${To(D.type)}'.`);let I=b.parse(v[2],2,Hn);if(!I)return null;if(!Mg(C,I.type))return b.concat(2).error(`"${C}" comparisons are not supported for type '${To(I.type)}'.`);if(D.type.kind!==I.type.kind&&"value"!==D.type.kind&&"value"!==I.type.kind)return b.error(`Cannot compare types '${To(D.type)}' and '${To(I.type)}'.`);u&&("value"===D.type.kind&&"value"!==I.type.kind?D=new kn(I.type,[D]):"value"!==D.type.kind&&"value"===I.type.kind&&(I=new kn(D.type,[I])));let R=null;if(4===v.length){if("string"!==D.type.kind&&"string"!==I.type.kind&&"value"!==D.type.kind&&"value"!==I.type.kind)return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(v[3],3,zd),!R)return null}return new NU(D,I,R)}evaluate(v){const b=this.lhs.evaluate(v),C=this.rhs.evaluate(v);if(u&&this.hasUntypedArgument){const D=Vo(b),I=Vo(C);if(D.kind!==I.kind||"string"!==D.kind&&"number"!==D.kind)throw new rn(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${D.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=Vo(b),I=Vo(C);if("string"!==D.kind||"string"!==I.kind)return o(v,b,C)}return this.collator?l(v,b,C,this.collator.evaluate(v)):o(v,b,C)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[d];return this.eachChild(b=>{v.push(b.serialize())}),v}}}const vM=Lp("==",function(d,o,l){return o===l},vb),bM=Lp("!=",function(d,o,l){return o!==l},function(d,o,l,u){return!vb(0,o,l,u)}),bb=Lp("<",function(d,o,l){return o<l},function(d,o,l,u){return u.compare(o,l)<0}),xb=Lp(">",function(d,o,l){return o>l},function(d,o,l,u){return u.compare(o,l)>0}),xM=Lp("<=",function(d,o,l){return o<=l},function(d,o,l,u){return u.compare(o,l)<=0}),wM=Lp(">=",function(d,o,l){return o>=l},function(d,o,l,u){return u.compare(o,l)>=0});class Cg{constructor(o,l,u,m,v,b){this.type=nr,this.number=o,this.locale=l,this.currency=u,this.unit=m,this.minFractionDigits=v,this.maxFractionDigits=b}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,yn);if(!u)return null;const m=o[2];if("object"!=typeof m||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=l.parseObjectValue(m.locale,2,"locale",nr),!v))return null;let b=null;if(m.currency&&(b=l.parseObjectValue(m.currency,2,"currency",nr),!b))return null;let C=null;if(m.unit&&(C=l.parseObjectValue(m.unit,2,"unit",nr),!C))return null;let D=null;if(m["min-fraction-digits"]&&(D=l.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",yn),!D))return null;let I=null;return m["max-fraction-digits"]&&(I=l.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",yn),!I)?null:new Cg(u,v,b,C,D,I)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Fp{constructor(o){this.type=yn,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${To(u.type)} instead.`):new Fp(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new rn(`Expected value to be of type string or array, but found ${To(Vo(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function wb(d){return function(){d=1831565813+(d|=0)|0;let o=Math.imul(d^d>>>15,1|d);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const zp={"==":vM,"!=":bM,">":xb,"<":bb,">=":wM,"<=":xM,array:kn,at:xg,"at-interpolated":a0,boolean:kn,case:c0,coalesce:Rp,collator:tl,format:Nd,image:vs,in:l0,"index-of":wg,interpolate:il,"interpolate-hcl":il,"interpolate-lab":il,length:Fp,let:bg,literal:Yn,match:Ey,number:kn,"number-format":Cg,object:kn,slice:kg,step:yr,string:kn,"to-boolean":wl,"to-color":wl,"to-number":wl,"to-string":wl,var:fe,within:Jl,distance:pe,config:St};function kb(d,[o,l,u,m]){o=o.evaluate(d),l=l.evaluate(d),u=u.evaluate(d);const v=m?m.evaluate(d):1,b=$c(o,l,u,v);if(b)throw new rn(b);return new Ni(o/255*v,l/255*v,u/255*v,v)}function mu(d,[o,l,u,m]){o=o.evaluate(d),l=l.evaluate(d),u=u.evaluate(d);const v=m?m.evaluate(d):1,b=(R=l,N=u,j=v,"number"==typeof(I=o)&&I>=0&&I<=360?"number"==typeof R&&R>=0&&R<=100&&"number"==typeof N&&N>=0&&N<=100?void 0===j||"number"==typeof j&&j>=0&&j<=1?null:`Invalid hsla value [${[I,R,N,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof j?[I,R,N,j]:[I,R,N]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof j?[I,R,N,j]:[I,R,N]).join(", ")}]: 'h' must be between 0 and 360.`);var I,R,N,j;if(b)throw new rn(b);const C=`hsla(${o}, ${l}%, ${u}%, ${v})`,D=Ni.parse(C);if(!D)throw new rn(`Failed to parse HSLA color: ${C}`);return D}function lh(d,o){return d in o}function d0(d,o){const l=o[d];return void 0===l?null:l}function Xu(d){return{type:d}}function rl(d){return{result:"success",value:d}}function ql(d){return{result:"error",value:d}}function Mc(d,o){return!!d&&!!d.parameters&&d.parameters.indexOf(o)>-1}function Gf(d){return"data-driven"===d["property-type"]}function h0(d){return Mc(d.expression,"measure-light")}function Sg(d){return Mc(d.expression,"zoom")}function Wf(d){return!!d.expression&&d.expression.interpolated}function Np(d){return"object"==typeof d&&null!==d&&!Array.isArray(d)}function u0(d){return d}function Bp(d,o){const l="color"===o.type,u=d.stops&&"object"==typeof d.stops[0][0],m=u||!(u||void 0!==d.property),v=d.type||(Wf(o)?"exponential":"interval");if(l&&((d=Ea({},d)).stops&&(d.stops=d.stops.map(I=>[I[0],Ni.parse(I[1])])),d.default=Ni.parse(d.default?d.default:o.default)),d.colorSpace&&"rgb"!==d.colorSpace&&!fu[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let b,C,D;if("exponential"===v)b=Eg;else if("interval"===v)b=Dy;else if("categorical"===v){b=p0,C=Object.create(null);for(const I of d.stops)C[I[0]]=I[1];D=typeof d.stops[0][0]}else{if("identity"!==v)throw new Error(`Unknown function type "${v}"`);b=Dg}if(u){const I={},R=[];for(let K=0;K<d.stops.length;K++){const Z=d.stops[K],te=Z[0].zoom;void 0===I[te]&&(I[te]={zoom:te,type:d.type,property:d.property,default:d.default,stops:[]},R.push(te)),I[te].stops.push([Z[0].value,Z[1]])}const N=[];for(const K of R)N.push([I[K].zoom,Bp(I[K],o)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:il.interpolationFactor.bind(void 0,j),zoomStops:N.map(K=>K[0]),evaluate:({zoom:K},Z)=>Eg({stops:N,base:d.base},o,K).evaluate(K,Z)}}if(m){const I="exponential"===v?{name:"exponential",base:void 0!==d.base?d.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:il.interpolationFactor.bind(void 0,I),zoomStops:d.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(d,o,R,C,D)}}return{kind:"source",evaluate(I,R){const N=R&&R.properties?R.properties[d.property]:void 0;return void 0===N?Rh(d.default,o.default):b(d,o,N,C,D)}}}function Rh(d,o,l){return void 0!==d?d:void 0!==o?o:void 0!==l?l:void 0}function p0(d,o,l,u,m){return Rh(typeof l===m?u[l]:void 0,d.default,o.default)}function Dy(d,o,l){if("number"!==Ln(l))return Rh(d.default,o.default);const u=d.stops.length;if(1===u||l<=d.stops[0][0])return d.stops[0][1];if(l>=d.stops[u-1][0])return d.stops[u-1][1];const m=Mi(d.stops.map(v=>v[0]),l);return d.stops[m][1]}function Eg(d,o,l){const u=void 0!==d.base?d.base:1;if("number"!==Ln(l))return Rh(d.default,o.default);const m=d.stops.length;if(1===m||l<=d.stops[0][0])return d.stops[0][1];if(l>=d.stops[m-1][0])return d.stops[m-1][1];const v=Mi(d.stops.map(R=>R[0]),l),b=function(R,N,j,K){const Z=K-j,te=R-j;return 0===Z?0:1===N?te/Z:(Math.pow(N,te)-1)/(Math.pow(N,Z)-1)}(l,u,d.stops[v][0],d.stops[v+1][0]),C=d.stops[v][1],D=d.stops[v+1][1];let I=Fd[o.type]||u0;if(d.colorSpace&&"rgb"!==d.colorSpace){const R=fu[d.colorSpace];I=(N,j)=>R.reverse(R.interpolate(R.forward(N),R.forward(j),b))}return"function"==typeof C.evaluate?{evaluate(...R){const N=C.evaluate.apply(void 0,R),j=D.evaluate.apply(void 0,R);if(void 0!==N&&void 0!==j)return I(N,j,b)}}:I(C,D,b)}function Dg(d,o,l){return"color"===o.type?l=Ni.parse(l):"formatted"===o.type?l=Ta.fromString(l.toString()):"resolvedImage"===o.type?l=ja.build(l.toString()):Ln(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Rh(l,d.default,o.default)}ds.register(zp,{error:[{kind:"error"},[nr],(d,[o])=>{throw new rn(o.evaluate(d))}],typeof:[nr,[Hn],(d,[o])=>To(Vo(o.evaluate(d)))],"to-rgba":[Zs(yn,4),[Da],(d,[o])=>o.evaluate(d).toRenderColor(null).toArray()],"to-hsla":[Zs(yn,4),[Da],(d,[o])=>o.evaluate(d).toRenderColor(null).toHslaArray()],rgb:[Da,[yn,yn,yn],kb],rgba:[Da,[yn,yn,yn,yn],kb],hsl:[Da,[yn,yn,yn],mu],hsla:[Da,[yn,yn,yn,yn],mu],has:{type:bi,overloads:[[[nr],(d,[o])=>lh(o.evaluate(d),d.properties())],[[nr,cd],(d,[o,l])=>lh(o.evaluate(d),l.evaluate(d))]]},get:{type:Hn,overloads:[[[nr],(d,[o])=>d0(o.evaluate(d),d.properties())],[[nr,cd],(d,[o,l])=>d0(o.evaluate(d),l.evaluate(d))]]},"feature-state":[Hn,[nr],(d,[o])=>d0(o.evaluate(d),d.featureState||{})],properties:[cd,[],d=>d.properties()],"geometry-type":[nr,[],d=>d.geometryType()],id:[Hn,[],d=>d.id()],zoom:[yn,[],d=>d.globals.zoom],pitch:[yn,[],d=>d.globals.pitch||0],"distance-from-center":[yn,[],d=>d.distanceFromCenter()],"measure-light":[yn,[nr],(d,[o])=>d.measureLight(o.evaluate(d))],"heatmap-density":[yn,[],d=>d.globals.heatmapDensity||0],"line-progress":[yn,[],d=>d.globals.lineProgress||0],"raster-value":[yn,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[yn,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[yn,[],d=>d.globals.skyRadialProgress||0],accumulated:[Hn,[],d=>void 0===d.globals.accumulated?null:d.globals.accumulated],"+":[yn,Xu(yn),(d,o)=>{let l=0;for(const u of o)l+=u.evaluate(d);return l}],"*":[yn,Xu(yn),(d,o)=>{let l=1;for(const u of o)l*=u.evaluate(d);return l}],"-":{type:yn,overloads:[[[yn,yn],(d,[o,l])=>o.evaluate(d)-l.evaluate(d)],[[yn],(d,[o])=>-o.evaluate(d)]]},"/":[yn,[yn,yn],(d,[o,l])=>o.evaluate(d)/l.evaluate(d)],"%":[yn,[yn,yn],(d,[o,l])=>o.evaluate(d)%l.evaluate(d)],ln2:[yn,[],()=>Math.LN2],pi:[yn,[],()=>Math.PI],e:[yn,[],()=>Math.E],"^":[yn,[yn,yn],(d,[o,l])=>Math.pow(o.evaluate(d),l.evaluate(d))],sqrt:[yn,[yn],(d,[o])=>Math.sqrt(o.evaluate(d))],log10:[yn,[yn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN10],ln:[yn,[yn],(d,[o])=>Math.log(o.evaluate(d))],log2:[yn,[yn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN2],sin:[yn,[yn],(d,[o])=>Math.sin(o.evaluate(d))],cos:[yn,[yn],(d,[o])=>Math.cos(o.evaluate(d))],tan:[yn,[yn],(d,[o])=>Math.tan(o.evaluate(d))],asin:[yn,[yn],(d,[o])=>Math.asin(o.evaluate(d))],acos:[yn,[yn],(d,[o])=>Math.acos(o.evaluate(d))],atan:[yn,[yn],(d,[o])=>Math.atan(o.evaluate(d))],min:[yn,Xu(yn),(d,o)=>Math.min(...o.map(l=>l.evaluate(d)))],max:[yn,Xu(yn),(d,o)=>Math.max(...o.map(l=>l.evaluate(d)))],abs:[yn,[yn],(d,[o])=>Math.abs(o.evaluate(d))],round:[yn,[yn],(d,[o])=>{const l=o.evaluate(d);return l<0?-Math.round(-l):Math.round(l)}],floor:[yn,[yn],(d,[o])=>Math.floor(o.evaluate(d))],ceil:[yn,[yn],(d,[o])=>Math.ceil(o.evaluate(d))],"filter-==":[bi,[nr,Hn],(d,[o,l])=>d.properties()[o.value]===l.value],"filter-id-==":[bi,[Hn],(d,[o])=>d.id()===o.value],"filter-type-==":[bi,[nr],(d,[o])=>d.geometryType()===o.value],"filter-<":[bi,[nr,Hn],(d,[o,l])=>{const u=d.properties()[o.value],m=l.value;return typeof u==typeof m&&u<m}],"filter-id-<":[bi,[Hn],(d,[o])=>{const l=d.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[bi,[nr,Hn],(d,[o,l])=>{const u=d.properties()[o.value],m=l.value;return typeof u==typeof m&&u>m}],"filter-id->":[bi,[Hn],(d,[o])=>{const l=d.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[bi,[nr,Hn],(d,[o,l])=>{const u=d.properties()[o.value],m=l.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[bi,[Hn],(d,[o])=>{const l=d.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[bi,[nr,Hn],(d,[o,l])=>{const u=d.properties()[o.value],m=l.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[bi,[Hn],(d,[o])=>{const l=d.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[bi,[Hn],(d,[o])=>o.value in d.properties()],"filter-has-id":[bi,[],d=>null!==d.id()&&void 0!==d.id()],"filter-type-in":[bi,[Zs(nr)],(d,[o])=>o.value.indexOf(d.geometryType())>=0],"filter-id-in":[bi,[Zs(Hn)],(d,[o])=>o.value.indexOf(d.id())>=0],"filter-in-small":[bi,[nr,Zs(Hn)],(d,[o,l])=>l.value.indexOf(d.properties()[o.value])>=0],"filter-in-large":[bi,[nr,Zs(Hn)],(d,[o,l])=>function(u,m,v,b){for(;v<=b;){const C=v+b>>1;if(m[C]===u)return!0;m[C]>u?b=C-1:v=C+1}return!1}(d.properties()[o.value],l.value,0,l.value.length-1)],all:{type:bi,overloads:[[[bi,bi],(d,[o,l])=>o.evaluate(d)&&l.evaluate(d)],[Xu(bi),(d,o)=>{for(const l of o)if(!l.evaluate(d))return!1;return!0}]]},any:{type:bi,overloads:[[[bi,bi],(d,[o,l])=>o.evaluate(d)||l.evaluate(d)],[Xu(bi),(d,o)=>{for(const l of o)if(l.evaluate(d))return!0;return!1}]]},"!":[bi,[bi],(d,[o])=>!o.evaluate(d)],"is-supported-script":[bi,[nr],(d,[o])=>{const l=d.globals&&d.globals.isSupportedScript;return!l||l(o.evaluate(d))}],upcase:[nr,[nr],(d,[o])=>o.evaluate(d).toUpperCase()],downcase:[nr,[nr],(d,[o])=>o.evaluate(d).toLowerCase()],concat:[nr,Xu(Hn),(d,o)=>o.map(l=>ra(l.evaluate(d))).join("")],"resolved-locale":[nr,[zd],(d,[o])=>o.evaluate(d).resolvedLocale()],random:[yn,[yn,yn,Hn],(d,o)=>{const[l,u,m]=o.map(b=>b.evaluate(d));if(l>u||l===u)return l;let v;if("string"==typeof m)v=function(b){let C=0;if(0===b.length)return C;for(let D=0;D<b.length;D++)C=(C<<5)-C+b.charCodeAt(D),C|=0;return C}(m);else{if("number"!=typeof m)throw new rn(`Invalid seed input: ${m}`);v=m}return l+wb(v)()*(u-l)}]});class Ku{constructor(o,l,u,m){var v;this.expression=o,this._warningHistory={},this._evaluator=new dd(u,m),this._defaultValue=l?"color"===(v=l).type&&(Np(v.default)||Array.isArray(v.default))?new Ni(0,0,0,0):"color"===v.type?Ni.parse(v.default)||null:void 0===v.default?null:v.default:null,this._enumValues=l&&"enum"===l.type?l.values:null,this.configDependencies=Y(o)}evaluateWithoutErrorHandling(o,l,u,m,v,b,C,D){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,m,v,b,C,D){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null;try{const I=this.expression.evaluate(this._evaluator);if(null==I||"number"==typeof I&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new rn(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Lh(d){return Array.isArray(d)&&d.length>0&&"string"==typeof d[0]&&d[0]in zp}function Qu(d,o,l,u){const m=new At(zp,[],o?function(b){const C={color:Da,string:nr,number:yn,enum:nr,boolean:bi,formatted:au,resolvedImage:tn};return"array"===b.type?Zs(C[b.value]||Hn,b.length):C[b.type]}(o):void 0,void 0,void 0,l,u),v=m.parse(d,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return v?rl(new Ku(v,o,l,u)):ql(m.errors)}class Vp{constructor(o,l,u,m){this.kind=o,this._styleExpression=l,this.isLightConstant=u,this.isLineProgressConstant=m,this.isStateDependent="constant"!==o&&!on(l.expression),this.configDependencies=Y(l.expression)}evaluateWithoutErrorHandling(o,l,u,m,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,m,v,b)}evaluate(o,l,u,m,v,b){return this._styleExpression.evaluate(o,l,u,m,v,b)}}class Zf{constructor(o,l,u,m,v,b){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!on(l.expression),this.isLightConstant=v,this.isLineProgressConstant=b,this.configDependencies=Y(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,l,u,m,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,m,v,b)}evaluate(o,l,u,m,v,b){return this._styleExpression.evaluate(o,l,u,m,v,b)}interpolationFactor(o,l,u){return this.interpolationType?il.interpolationFactor(this.interpolationType,o,l,u):0}}function Tg(d,o,l,u){if("error"===(d=Qu(d,o,l,u)).result)return d;const m=d.value.expression,v=yt(m);if(!v&&!Gf(o))return ql([new bl("","data expressions not supported")]);const b=J(m,["zoom","pitch","distance-from-center"]);if(!b&&!Sg(o))return ql([new bl("","zoom expressions not supported")]);const C=J(m,["measure-light"]);if(!C&&!h0(o))return ql([new bl("","measure-light expression not supported")]);const D=J(m,["line-progress"]);if(!D&&!Mc(o.expression,"line-progress"))return ql([new bl("","line-progress expression not supported")]);const I=o.expression&&o.expression.relaxZoomRestriction,R=Ag(m);return R||b||I?R instanceof bl?ql([R]):R instanceof il&&!Wf(o)?ql([new bl("",'"interpolate" expressions cannot be used with this property')]):rl(R?new Zf(v&&D?"camera":"composite",d.value,R.labels,R instanceof il?R.interpolation:void 0,C,D):new Vp(v&&D?"constant":"source",d.value,C,D)):ql([new bl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Yf{constructor(o,l){this._parameters=o,this._specification=l,Ea(this,Bp(this._parameters,this._specification))}static deserialize(o){return new Yf(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Ag(d){let o=null;if(d instanceof bg)o=Ag(d.result);else if(d instanceof Rp){for(const l of d.args)if(o=Ag(l),o)break}else(d instanceof yr||d instanceof il)&&d.input instanceof ds&&"zoom"===d.input.name&&(o=d);return o instanceof bl||d.eachChild(l=>{const u=Ag(l);u instanceof bl?o=u:o&&u&&o!==u&&(o=new bl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Ty,Xf,jp=mc(function(){if(Xf)return Ty;Xf=1,Ty=o;var d=3;function o(l,u,m){var v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var b=new Int32Array(this.arrayBuffer);l=b[0],this.d=(u=b[1])+2*(m=b[2]);for(var C=0;C<this.d*this.d;C++){var D=b[d+C],I=b[d+C+1];v.push(D===I?null:b.subarray(D,I))}var R=b[d+v.length+1];this.keys=b.subarray(b[d+v.length],R),this.bboxes=b.subarray(R),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var N=0;N<this.d*this.d;N++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=l,this.padding=m,this.scale=u/l,this.uid=0;var j=m/u*l;this.min=-j,this.max=l+j}return o.prototype.insert=function(l,u,m,v,b){this._forEachCell(u,m,v,b,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(l,u,m,v,b,C){this.cells[b].push(C)},o.prototype.query=function(l,u,m,v,b){var C=this.min,D=this.max;if(l<=C&&u<=C&&D<=m&&D<=v&&!b)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(l,u,m,v,this._queryCell,I,{},b),I},o.prototype._queryCell=function(l,u,m,v,b,C,D,I){var R=this.cells[b];if(null!==R)for(var N=this.keys,j=this.bboxes,K=0;K<R.length;K++){var Z=R[K];if(void 0===D[Z]){var te=4*Z;(I?I(j[te+0],j[te+1],j[te+2],j[te+3]):l<=j[te+2]&&u<=j[te+3]&&m>=j[te+0]&&v>=j[te+1])?(D[Z]=!0,C.push(N[Z])):D[Z]=!1}}},o.prototype._forEachCell=function(l,u,m,v,b,C,D,I){for(var R=this._convertToCellCoord(l),N=this._convertToCellCoord(u),j=this._convertToCellCoord(m),K=this._convertToCellCoord(v),Z=R;Z<=j;Z++)for(var te=N;te<=K;te++){var ce=this.d*te+Z;if((!I||I(this._convertFromCellCoord(Z),this._convertFromCellCoord(te),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(te+1)))&&b.call(this,l,u,m,v,ce,C,D,I))return}},o.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},o.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,u=d+this.cells.length+1+1,m=0,v=0;v<this.cells.length;v++)m+=this.cells[v].length;var b=new Int32Array(u+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var C=u,D=0;D<l.length;D++){var I=l[D];b[d+D]=C,b.set(I,C),C+=I.length}return b[d+l.length]=C,b.set(this.keys,C),b[d+l.length+1]=C+=this.keys.length,b.set(this.bboxes,C),C+=this.bboxes.length,b.buffer},Ty}());const Ju={};function ln(d,o,l={}){Object.defineProperty(d,"_classRegistryKey",{value:o,writable:!1}),Ju[o]={klass:d,omit:l.omit||[]}}ln(Object,"Object"),jp.serialize=function(d,o){const l=d.toArrayBuffer();return o&&o.add(l),{buffer:l}},jp.deserialize=function(d){return new jp(d.buffer)},Object.defineProperty(jp,"name",{value:"Grid"}),ln(jp,"Grid"),typeof DOMMatrix<"u"&&ln(DOMMatrix,"DOMMatrix"),ln(Ni,"Color"),ln(Error,"Error"),ln(Ta,"Formatted"),ln(ia,"FormattedSection"),ln(jn,"AJAXError"),ln(ja,"ResolvedImage"),ln(Yf,"StylePropertyFunction"),ln(Ku,"StyleExpression",{omit:["_evaluator"]}),ln(Xo,"ImageId"),ln(Nl,"ImageVariant"),ln(Zf,"ZoomDependentExpression"),ln(Vp,"ZoomConstantExpression"),ln(ds,"CompoundExpression",{omit:["_evaluate"]});for(const d in zp)Ju[zp[d]._classRegistryKey]||ln(zp[d],`Expression${d}`);function Pg(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&"ArrayBuffer"===d.constructor.name)}function ep(d){return self.ImageBitmap&&d instanceof ImageBitmap}function Fh(d,o){if(null==d||"boolean"==typeof d||"number"==typeof d||"string"==typeof d||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(Pg(d)||ep(d))return o&&o.add(d),d;if(ArrayBuffer.isView(d))return o&&o.add(d.buffer),d;if(d instanceof ImageData)return o&&o.add(d.data.buffer),d;if(Array.isArray(d)){const l=[];for(const u of d)l.push(Fh(u,o));return l}if(d instanceof Map){const l={$name:"Map",entries:[]};for(const[u,m]of d.entries())l.entries.push(Fh(u),Fh(m,o));return l}if(d instanceof Set){const l={$name:"Set"};let u=0;for(const m of d.values())l[++u]=Fh(m);return l}if(d instanceof DOMMatrix){const l={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of u)l[m]=d[m];return l}if("bigint"==typeof d)return{$name:"BigInt",value:d.toString()};if("object"==typeof d){const l=d.constructor,u=l._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const m=l.serialize?l.serialize(d,o):{};if(!l.serialize){for(const v in d)d.hasOwnProperty(v)&&(Ju[u].omit.indexOf(v)>=0||(m[v]=Fh(d[v],o)));d instanceof Error&&(m.message=d.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof d)}function zh(d){if(null==d||"boolean"==typeof d||"number"==typeof d||"string"==typeof d||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||Pg(d)||ep(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(zh);if("object"==typeof d){const o=d.$name||"Object";if("Map"===o){const m=d.entries||[],v=new Map;for(let b=0;b<m.length;b+=2)v.set(zh(m[b]),zh(m[b+1]));return v}if("Set"===o){const m=new Set;for(const v of Object.keys(d))"$name"!==v&&m.add(zh(d[v]));return m}if("DOMMatrix"===o){let m;return m=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(m)}if("BigInt"===o)return BigInt(d.value);const{klass:l}=Ju[o];if(!l)throw new Error(`Can't deserialize unregistered class "${o}".`);if(l.deserialize)return l.deserialize(d);const u=Object.create(l.prototype);for(const m of Object.keys(d))"$name"!==m&&(u[m]=zh(d[m]));return u}throw new Error("can't deserialize object of type "+typeof d)}const Pn={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function f0(d){for(const o of d)if(Qf(o.charCodeAt(0)))return!0;return!1}function Mb(d){for(const o of d)if(!m0(o.charCodeAt(0)))return!1;return!0}function m0(d){return!(Pn.Arabic(d)||Pn["Arabic Supplement"](d)||Pn["Arabic Extended-A"](d)||Pn["Arabic Presentation Forms-A"](d)||Pn["Arabic Presentation Forms-B"](d))}function Qf(d){return!(746!==d&&747!==d&&(d<4352||!(Pn["Bopomofo Extended"](d)||Pn.Bopomofo(d)||Pn["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Pn["CJK Compatibility Ideographs"](d)||Pn["CJK Compatibility"](d)||Pn["CJK Radicals Supplement"](d)||Pn["CJK Strokes"](d)||!(!Pn["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||12336===d)||Pn["CJK Unified Ideographs Extension A"](d)||Pn["CJK Unified Ideographs"](d)||Pn["Enclosed CJK Letters and Months"](d)||Pn["Hangul Compatibility Jamo"](d)||Pn["Hangul Jamo Extended-A"](d)||Pn["Hangul Jamo Extended-B"](d)||Pn["Hangul Jamo"](d)||Pn["Hangul Syllables"](d)||Pn.Hiragana(d)||Pn["Ideographic Description Characters"](d)||Pn.Kanbun(d)||Pn["Kangxi Radicals"](d)||Pn["Katakana Phonetic Extensions"](d)||Pn.Katakana(d)&&12540!==d||!(!Pn["Halfwidth and Fullwidth Forms"](d)||65288===d||65289===d||65293===d||d>=65306&&d<=65310||65339===d||65341===d||65343===d||d>=65371&&d<=65503||65507===d||d>=65512&&d<=65519)||!(!Pn["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Pn["Unified Canadian Aboriginal Syllabics"](d)||Pn["Unified Canadian Aboriginal Syllabics Extended"](d)||Pn["Vertical Forms"](d)||Pn["Yijing Hexagram Symbols"](d)||Pn["Yi Syllables"](d)||Pn["Yi Radicals"](d))))}function g0(d){return!(Qf(d)||(o=d,Pn["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Pn["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Pn["Letterlike Symbols"](o)||Pn["Number Forms"](o)||Pn["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Pn["Control Pictures"](o)&&9251!==o||Pn["Optical Character Recognition"](o)||Pn["Enclosed Alphanumerics"](o)||Pn["Geometric Shapes"](o)||Pn["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Pn["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Pn["CJK Symbols and Punctuation"](o)||Pn.Katakana(o)||Pn["Private Use Area"](o)||Pn["CJK Compatibility Forms"](o)||Pn["Small Form Variants"](o)||Pn["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function Cb(d){return Pn.Arabic(d)||Pn["Arabic Supplement"](d)||Pn["Arabic Extended-A"](d)||Pn["Arabic Presentation Forms-A"](d)||Pn["Arabic Presentation Forms-B"](d)}function Sb(d){return d>=1424&&d<=2303||Pn["Arabic Presentation Forms-A"](d)||Pn["Arabic Presentation Forms-B"](d)}function Eb(d,o){return!(!o&&Sb(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Pn.Khmer(d))}function ol(d){for(const o of d)if(Sb(o.charCodeAt(0)))return!0;return!1}const Ig="deferred",_0="loading",y0="loaded";let Og=null,ic="unavailable",gu=null;const Nh=function(d){d&&"string"==typeof d&&d.indexOf("NetworkError")>-1&&(ic="error"),Og&&Og(d)};function Rg(){Zc.fire(new Fl("pluginStateChange",{pluginStatus:ic,pluginURL:gu}))}const Zc=new Sa,tp=function(){return ic},v0=function(){if(ic!==Ig||!gu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ic=_0,Rg(),gu&&Ld({url:gu},d=>{d?Nh(d):(ic=y0,Rg())})},Yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ic===y0||null!=Yr.applyArabicShaping,isLoading:()=>ic===_0,setState(d){ic=d.pluginStatus,gu=d.pluginURL},isParsed:()=>null!=Yr.applyArabicShaping&&null!=Yr.processBidirectionalText&&null!=Yr.processStyledBidirectionalText,getPluginURL:()=>gu};class dr{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,u){for(const m of l)if(!Eb(m.charCodeAt(0),u))return!1;return!0}(o,Yr.isLoaded())}}class _u{constructor(o,l,u,m){this.property=o,this.value=l,this.expression=function(v,b,C,D){if(Np(v))return new Yf(v,b);if(Lh(v)||Array.isArray(v)&&v.length>0){const I=Tg(v,b,C,D);if("error"===I.result)throw new Error(I.value.map(R=>`${R.key}: ${R.message}`).join(", "));return I.value}{let I=v;return"string"==typeof v&&"color"===b.type&&(I=Ni.parse(v)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(void 0===l?o.specification.default:l,o.specification,u,m)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class la{constructor(o,l,u){this.property=o,this.value=new _u(o,void 0,l,u)}transitioned(o,l){return new b0(this.property,this.value,l,tt({},o.transition,this.transition),o.now)}untransitioned(){return new b0(this.property,this.value,null,{},0)}}class Ay{constructor(o,l,u){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=u,this.configDependencies=new Set}getValue(o){return pi(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new la(this._values[o].property,this._scope,this._options)),this._values[o].value=new _u(this._values[o].property,null===l?void 0:pi(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);const u=this._properties.properties;if(o)for(const m in o){const v=o[m];if(m.endsWith("-transition")){const b=m.slice(0,-11);u[b]&&this.setTransition(b,v)}else u.hasOwnProperty(m)&&this.setValue(m,v)}}getTransition(o){return pi(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new la(this._values[o].property)),this._values[o].transition=pi(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const m=this.getTransition(l);void 0!==m&&(o[`${l}-transition`]=m)}return o}transitioned(o,l){const u=new np(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(o,l._values[m]);return u}untransitioned(){const o=new np(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class b0{constructor(o,l,u,m,v){const b=m.delay||0,C=m.duration||0;v=v||0,this.property=o,this.value=l,this.begin=v+b,this.end=this.begin+C,o.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const m=o.now||0,v=this.value.possiblyEvaluate(o,l,u),b=this.prior;if(b){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return b.possiblyEvaluate(o,l,u);{const C=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,l,u),v,je(C))}}return v}}class np{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const m=new ip(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,l,u);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Yc{constructor(o,l,u){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=u,this.configDependencies=new Set}getValue(o){return pi(this._values[o].value)}setValue(o,l){this._values[o]=new _u(this._values[o].property,null===l?void 0:pi(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const m=new ip(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,l,u);return m}}class Hp{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,m){return this.property.evaluate(this.value,this.parameters,o,l,u,m)}}class ip{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ut{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const m=Fd[this.specification.type];return m?m(o,l,u):o}}class nn{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,m){return new Hp(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,m)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new Hp(this,{kind:"constant",value:void 0},o.parameters);const m=Fd[this.specification.type];return m?new Hp(this,{kind:"constant",value:m(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,m,v,b){return"constant"===o.kind?o.value:o.evaluate(l,u,m,v,b)}}class yu{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,m){return!!o.expression.evaluate(l,null,{},u,m)}interpolate(){return!1}}class jo{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new dr(0,{});for(const u in o){const m=o[u];m.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new _u(m,void 0),b=this.defaultTransitionablePropertyValues[u]=new la(m);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate(l)}}}ln(nn,"DataDrivenProperty"),ln(Ut,"DataConstantProperty"),ln(yu,"ColorRampProperty");var it=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function md(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function Jf(d){if(Array.isArray(d))return d.map(Jf);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const o={};for(const l in d)o[l]=Jf(d[l]);return o}return md(d)}function Lg(d){if(!0===d||!1===d)return!0;if(!Array.isArray(d)||0===d.length)return!1;switch(d[0]){case"has":return d.length>=2&&"$id"!==d[1]&&"$type"!==d[1];case"in":return d.length>=3&&("string"!=typeof d[1]||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==d.length||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const o of d.slice(1))if(!Lg(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Yi(d,o="",l=null,u="fill"){if(null==d)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lg(d)||(d=Bh(d));const m=d;let v=!0;try{v=function(R){if(!Up(R))return R;let N=Jf(R);return Db(N),N=x0(N),N}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(m,null,2)}\n        `)}let b=null,C=null;if("background"!==u&&"sky"!==u&&"slot"!==u){C=it[`filter_${u}`];const R=Qu(v,C,o,l);if("error"===R.result)throw new Error(R.value.map(N=>`${N.key}: ${N.message}`).join(", "));b=(N,j,K)=>R.value.evaluate(N,j,{},K)}let D=null,I=null;if(v!==m){const R=Qu(m,C,o,l);if("error"===R.result)throw new Error(R.value.map(N=>`${N.key}: ${N.message}`).join(", "));D=(N,j,K,Z,te)=>R.value.evaluate(N,j,{},K,void 0,void 0,Z,te),I=!yt(R.value.expression)}return{filter:b,dynamicFilter:D||void 0,needGeometry:w0(v),needFeature:!!I}}function x0(d){if(!Array.isArray(d))return d;const o=function(l){if(Tb.has(l[0]))for(let u=1;u<l.length;u++)if(Up(l[u]))return!0;return l}(d);return!0===o?o:o.map(l=>x0(l))}function Db(d){let o=!1;const l=[];if("case"===d[0]){for(let u=1;u<d.length-1;u+=2)o=o||Up(d[u]),l.push(d[u+1]);l.push(d[d.length-1])}else if("match"===d[0]){o=o||Up(d[1]);for(let u=2;u<d.length-1;u+=2)l.push(d[u+1]);l.push(d[d.length-1])}else if("step"===d[0]){o=o||Up(d[1]);for(let u=1;u<d.length-1;u+=2)l.push(d[u+1])}o&&(d.length=0,d.push("any",...l));for(let u=1;u<d.length;u++)Db(d[u])}function Up(d){if(!Array.isArray(d))return!1;if("pitch"===(o=d[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<d.length;l++)if(Up(d[l]))return!0;return!1}const Tb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ab(d,o){return d<o?-1:d>o?1:0}function w0(d){if(!Array.isArray(d))return!1;if("within"===d[0]||"distance"===d[0])return!0;for(let o=1;o<d.length;o++)if(w0(d[o]))return!0;return!1}function Bh(d){if(!d)return!0;const o=d[0];return d.length<=1?"any"!==o:"=="===o?k0(d[1],d[2],"=="):"!="===o?Fg(k0(d[1],d[2],"==")):"<"===o||">"===o||"<="===o||">="===o?k0(d[1],d[2],o):"any"===o?(l=d.slice(1),["any"].concat(l.map(Bh))):"all"===o?["all"].concat(d.slice(1).map(Bh)):"none"===o?["all"].concat(d.slice(1).map(Bh).map(Fg)):"in"===o?M0(d[1],d.slice(2)):"!in"===o?Fg(M0(d[1],d.slice(2))):"has"===o?Py(d[1]):"!has"!==o||Fg(Py(d[1]));var l}function k0(d,o,l){switch(d){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,d,o]}}function M0(d,o){if(0===o.length)return!1;switch(d){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",d,["literal",o.sort(Ab)]]:["filter-in-small",d,["literal",o]]}}function Py(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function Fg(d){return["!",d]}function cn(d,o){return o?`${d}\x1f${o}`:d}const Jr="-transition",An=new Set(["fill","line","background","hillshade","raster"]);class Mn extends Sa{constructor(o,l,u,m,v){if(super(),this.id=o.id,this.fqid=cn(this.id,u),this.type=o.type,this.scope=u,this.lut=m,this.options=v,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==o.type){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&"background"!==o.type&&"sky"!==o.type&&"slot"!==o.type){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const b=Qu(this.filter,it[`filter_${o.type}`]);"error"!==b.result&&(this.configDependencies=new Set([...this.configDependencies,...b.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new Yc(l.layout,this.scope,v),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new Ay(l.paint,this.scope,v);for(const b in o.paint)this.setPaintProperty(b,o.paint[b]);for(const b in o.layout)this.setLayoutProperty(b,o.layout[b]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ip(l.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&An.has(this.type)}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if("custom"===this.type&&"visibility"===o)return void(this.visibility=l);const u=this._unevaluatedLayout;u._properties.properties[o]&&(u.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),"visibility"===o&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(Jr)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){const u=this._transitionablePaint,m=u._properties.properties;if(o.endsWith(Jr)){const N=o.slice(0,-11);return m[N]&&u.setTransition(N,l||void 0),!1}if(!m[o])return!1;const v=u._values[o],b=v.value.isDataDriven(),C=v.value;u.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const D=u._values[o].value,I=D.isDataDriven(),R=o.endsWith("pattern")||"line-dasharray"===o;return I||b||R||this._handleOverridablePaintPropertyUpdate(o,C,D)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,u){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return ii({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}is3D(o){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof Hp&&Gf(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=Yi(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&("shadow"===o.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,u,m,v,b,C,D,I){}}const Ml={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qp{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ei(d,o=1){let l=0,u=0;return{members:d.map(m=>{const v=Ml[m.type].BYTES_PER_ELEMENT,b=l=tm(l,Math.max(o,v)),C=m.components||1;return u=Math.max(u,v),l+=v*C,{name:m.name,type:m.type,components:C,offset:b}}),size:tm(l,Math.max(u,o)),alignment:o}}function tm(d,o){return Math.ceil(d/o)*o}class Gd extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const m=2*o;return this.int16[m+0]=l,this.int16[m+1]=u,o}}Gd.prototype.bytesPerElement=4,ln(Gd,"StructArrayLayout2i4");class zg extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,u)}emplace(o,l,u,m){const v=3*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=m,o}}zg.prototype.bytesPerElement=6,ln(zg,"StructArrayLayout3i6");class $p extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,m)}emplace(o,l,u,m,v){const b=4*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=m,this.int16[b+3]=v,o}}$p.prototype.bytesPerElement=8,ln($p,"StructArrayLayout4i8");class rp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}rp.prototype.bytesPerElement=4,ln(rp,"StructArrayLayout1f4");class sl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,u)}emplace(o,l,u,m){const v=4*o,b=2*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.float32[b+1]=m,o}}sl.prototype.bytesPerElement=8,ln(sl,"StructArrayLayout2i1f8");class Cc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,u)}emplace(o,l,u,m){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=m,o}}Cc.prototype.bytesPerElement=8,ln(Cc,"StructArrayLayout3i8");class Ng extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,m,v)}emplace(o,l,u,m,v,b){const C=5*o;return this.int16[C+0]=l,this.int16[C+1]=u,this.int16[C+2]=m,this.int16[C+3]=v,this.int16[C+4]=b,o}}Ng.prototype.bytesPerElement=10,ln(Ng,"StructArrayLayout5i10");class vu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,m,v,b,C)}emplace(o,l,u,m,v,b,C,D){const I=6*o,R=12*o,N=3*o;return this.int16[I+0]=l,this.int16[I+1]=u,this.uint8[R+4]=m,this.uint8[R+5]=v,this.uint8[R+6]=b,this.uint8[R+7]=C,this.float32[N+2]=D,o}}vu.prototype.bytesPerElement=12,ln(vu,"StructArrayLayout2i4ub1f12");class al extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,u)}emplace(o,l,u,m){const v=3*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=m,o}}al.prototype.bytesPerElement=12,ln(al,"StructArrayLayout3f12");class Vh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,m,v)}emplace(o,l,u,m,v,b){const C=6*o,D=3*o;return this.uint16[C+0]=l,this.uint16[C+1]=u,this.uint16[C+2]=m,this.uint16[C+3]=v,this.float32[D+2]=b,o}}Vh.prototype.bytesPerElement=12,ln(Vh,"StructArrayLayout4ui1f12");class nm extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,m)}emplace(o,l,u,m,v){const b=4*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=m,this.uint16[b+3]=v,o}}nm.prototype.bytesPerElement=8,ln(nm,"StructArrayLayout4ui8");class op extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,u,m,v,b)}emplace(o,l,u,m,v,b,C){const D=6*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=m,this.int16[D+3]=v,this.int16[D+4]=b,this.int16[D+5]=C,o}}op.prototype.bytesPerElement=12,ln(op,"StructArrayLayout6i12");class Gp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N,j){const K=this.length;return this.resize(K+1),this.emplace(K,o,l,u,m,v,b,C,D,I,R,N,j)}emplace(o,l,u,m,v,b,C,D,I,R,N,j,K){const Z=12*o;return this.int16[Z+0]=l,this.int16[Z+1]=u,this.int16[Z+2]=m,this.int16[Z+3]=v,this.uint16[Z+4]=b,this.uint16[Z+5]=C,this.uint16[Z+6]=D,this.uint16[Z+7]=I,this.int16[Z+8]=R,this.int16[Z+9]=N,this.int16[Z+10]=j,this.int16[Z+11]=K,o}}Gp.prototype.bytesPerElement=24,ln(Gp,"StructArrayLayout4i4ui4i24");class Cl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,u,m,v,b)}emplace(o,l,u,m,v,b,C){const D=10*o,I=5*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=m,this.float32[I+2]=v,this.float32[I+3]=b,this.float32[I+4]=C,o}}Cl.prototype.bytesPerElement=20,ln(Cl,"StructArrayLayout3i3f20");class gd extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,m)}emplace(o,l,u,m,v){const b=4*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=m,this.float32[b+3]=v,o}}gd.prototype.bytesPerElement=16,ln(gd,"StructArrayLayout4f16");class Bg extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Bg.prototype.bytesPerElement=4,ln(Bg,"StructArrayLayout1ul4");class ch extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const m=2*o;return this.uint16[m+0]=l,this.uint16[m+1]=u,o}}ch.prototype.bytesPerElement=4,ln(ch,"StructArrayLayout2ui4");class C0 extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N,j,K){const Z=this.length;return this.resize(Z+1),this.emplace(Z,o,l,u,m,v,b,C,D,I,R,N,j,K)}emplace(o,l,u,m,v,b,C,D,I,R,N,j,K,Z){const te=20*o,ce=10*o;return this.int16[te+0]=l,this.int16[te+1]=u,this.int16[te+2]=m,this.int16[te+3]=v,this.int16[te+4]=b,this.float32[ce+3]=C,this.float32[ce+4]=D,this.float32[ce+5]=I,this.float32[ce+6]=R,this.int16[te+14]=N,this.uint32[ce+8]=j,this.uint16[te+18]=K,this.uint16[te+19]=Z,o}}C0.prototype.bytesPerElement=40,ln(C0,"StructArrayLayout5i4f1i1ul2ui40");class im extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,m,v,b,C)}emplace(o,l,u,m,v,b,C,D){const I=8*o;return this.int16[I+0]=l,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+4]=v,this.int16[I+5]=b,this.int16[I+6]=C,this.int16[I+7]=D,o}}im.prototype.bytesPerElement=16,ln(im,"StructArrayLayout3i2i2i16");class sp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,m,v)}emplace(o,l,u,m,v,b){const C=4*o,D=8*o;return this.float32[C+0]=l,this.float32[C+1]=u,this.float32[C+2]=m,this.int16[D+6]=v,this.int16[D+7]=b,o}}sp.prototype.bytesPerElement=16,ln(sp,"StructArrayLayout2f1f2i16");class Vg extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,u,m,v,b)}emplace(o,l,u,m,v,b,C){const D=20*o,I=5*o;return this.uint8[D+0]=l,this.uint8[D+1]=u,this.float32[I+1]=m,this.float32[I+2]=v,this.float32[I+3]=b,this.float32[I+4]=C,o}}Vg.prototype.bytesPerElement=20,ln(Vg,"StructArrayLayout2ub4f20");class Qs extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,o,l,u)}emplace(o,l,u,m){const v=3*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=m,o}}Qs.prototype.bytesPerElement=6,ln(Qs,"StructArrayLayout3ui6");class jg extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e){const we=this.length;return this.resize(we+1),this.emplace(we,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e)}emplace(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e,we){const Ce=30*o,ze=15*o,qe=60*o;return this.int16[Ce+0]=l,this.int16[Ce+1]=u,this.int16[Ce+2]=m,this.float32[ze+2]=v,this.float32[ze+3]=b,this.uint16[Ce+8]=C,this.uint16[Ce+9]=D,this.uint32[ze+5]=I,this.uint32[ze+6]=R,this.uint32[ze+7]=N,this.uint16[Ce+16]=j,this.uint16[Ce+17]=K,this.uint16[Ce+18]=Z,this.float32[ze+10]=te,this.float32[ze+11]=ce,this.uint8[qe+48]=ue,this.uint8[qe+49]=xe,this.uint8[qe+50]=ve,this.uint32[ze+13]=ie,this.int16[Ce+28]=_e,this.uint8[qe+58]=we,o}}jg.prototype.bytesPerElement=60,ln(jg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hg extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt,Mt,Tt,Nt,ut){const Et=this.length;return this.resize(Et+1),this.emplace(Et,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt,Mt,Tt,Nt,ut)}emplace(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve,ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt,Mt,Tt,Nt,ut,Et){const lt=20*o,gt=40*o,Bt=80*o;return this.float32[lt+0]=l,this.float32[lt+1]=u,this.int16[gt+4]=m,this.int16[gt+5]=v,this.int16[gt+6]=b,this.int16[gt+7]=C,this.int16[gt+8]=D,this.int16[gt+9]=I,this.int16[gt+10]=R,this.int16[gt+11]=N,this.int16[gt+12]=j,this.uint16[gt+13]=K,this.uint16[gt+14]=Z,this.uint16[gt+15]=te,this.uint16[gt+16]=ce,this.uint16[gt+17]=ue,this.uint16[gt+18]=xe,this.uint16[gt+19]=ve,this.uint16[gt+20]=ie,this.uint16[gt+21]=_e,this.uint16[gt+22]=we,this.uint16[gt+23]=Ce,this.uint16[gt+24]=ze,this.uint16[gt+25]=qe,this.uint16[gt+26]=Ze,this.uint16[gt+27]=Xe,this.uint32[lt+14]=pt,this.float32[lt+15]=Rt,this.float32[lt+16]=Mt,this.float32[lt+17]=Tt,this.float32[lt+18]=Nt,this.uint8[Bt+76]=ut,this.uint16[gt+39]=Et,o}}Hg.prototype.bytesPerElement=80,ln(Hg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class dh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,m,v)}emplace(o,l,u,m,v,b){const C=5*o;return this.float32[C+0]=l,this.float32[C+1]=u,this.float32[C+2]=m,this.float32[C+3]=v,this.float32[C+4]=b,o}}dh.prototype.bytesPerElement=20,ln(dh,"StructArrayLayout5f20");class rm extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,m,v,b,C)}emplace(o,l,u,m,v,b,C,D){const I=7*o;return this.float32[I+0]=l,this.float32[I+1]=u,this.float32[I+2]=m,this.float32[I+3]=v,this.float32[I+4]=b,this.float32[I+5]=C,this.float32[I+6]=D,o}}rm.prototype.bytesPerElement=28,ln(rm,"StructArrayLayout7f28");class S0 extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N){const j=this.length;return this.resize(j+1),this.emplace(j,o,l,u,m,v,b,C,D,I,R,N)}emplace(o,l,u,m,v,b,C,D,I,R,N,j){const K=11*o;return this.float32[K+0]=l,this.float32[K+1]=u,this.float32[K+2]=m,this.float32[K+3]=v,this.float32[K+4]=b,this.float32[K+5]=C,this.float32[K+6]=D,this.float32[K+7]=I,this.float32[K+8]=R,this.float32[K+9]=N,this.float32[K+10]=j,o}}S0.prototype.bytesPerElement=44,ln(S0,"StructArrayLayout11f44");class ll extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I){const R=this.length;return this.resize(R+1),this.emplace(R,o,l,u,m,v,b,C,D,I)}emplace(o,l,u,m,v,b,C,D,I,R){const N=9*o;return this.float32[N+0]=l,this.float32[N+1]=u,this.float32[N+2]=m,this.float32[N+3]=v,this.float32[N+4]=b,this.float32[N+5]=C,this.float32[N+6]=D,this.float32[N+7]=I,this.float32[N+8]=R,o}}ll.prototype.bytesPerElement=36,ln(ll,"StructArrayLayout9f36");class Xc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const m=2*o;return this.float32[m+0]=l,this.float32[m+1]=u,o}}Xc.prototype.bytesPerElement=8,ln(Xc,"StructArrayLayout2f8");class bs extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,m)}emplace(o,l,u,m,v){const b=6*o;return this.uint32[3*o+0]=l,this.uint16[b+2]=u,this.uint16[b+3]=m,this.uint16[b+4]=v,o}}bs.prototype.bytesPerElement=12,ln(bs,"StructArrayLayout1ul3ui12");class Ao extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Ao.prototype.bytesPerElement=2,ln(Ao,"StructArrayLayout1ui2");class Wp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce){const ue=this.length;return this.resize(ue+1),this.emplace(ue,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce)}emplace(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue){const xe=16*o;return this.float32[xe+0]=l,this.float32[xe+1]=u,this.float32[xe+2]=m,this.float32[xe+3]=v,this.float32[xe+4]=b,this.float32[xe+5]=C,this.float32[xe+6]=D,this.float32[xe+7]=I,this.float32[xe+8]=R,this.float32[xe+9]=N,this.float32[xe+10]=j,this.float32[xe+11]=K,this.float32[xe+12]=Z,this.float32[xe+13]=te,this.float32[xe+14]=ce,this.float32[xe+15]=ue,o}}Wp.prototype.bytesPerElement=64,ln(Wp,"StructArrayLayout16f64");class Ns extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,m,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,m,v,b,C)}emplace(o,l,u,m,v,b,C,D){const I=10*o,R=5*o;return this.uint16[I+0]=l,this.uint16[I+1]=u,this.uint16[I+2]=m,this.uint16[I+3]=v,this.float32[R+2]=b,this.float32[R+3]=C,this.float32[R+4]=D,o}}Ns.prototype.bytesPerElement=20,ln(Ns,"StructArrayLayout4ui3f20");class E0 extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}E0.prototype.bytesPerElement=2,ln(E0,"StructArrayLayout1i2");class om extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}om.prototype.bytesPerElement=1,ln(om,"StructArrayLayout1ub1");class D0 extends qp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}D0.prototype.size=40;class ap extends C0{get(o){return new D0(this,o)}}ln(ap,"CollisionBoxArray");class jh extends qp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}jh.prototype.size=60;class Iy extends jg{get(o){return new jh(this,o)}}ln(Iy,"PlacedSymbolArray");class sm extends qp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}sm.prototype.size=80;class am extends Hg{get(o){return new sm(this,o)}}ln(am,"SymbolInstanceArray");class Zp extends rp{getoffsetX(o){return this.float32[1*o+0]}}ln(Zp,"GlyphOffsetArray");class Ug extends Gd{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}ln(Ug,"SymbolLineVertexArray");class T0 extends qp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}T0.prototype.size=12;class A0 extends bs{get(o){return new T0(this,o)}}ln(A0,"FeatureIndexArray");class Oy extends ch{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}ln(Oy,"FillExtrusionCentroidArray");class lp extends qp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}lp.prototype.size=6;class Yp extends zg{get(o){return new lp(this,o)}}ln(Yp,"FillExtrusionWallArray");const Pb=Ei([{name:"a_pos",components:2,type:"Int16"}],4),kM=Ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ro{constructor(o=[]){this.segments=o}_prepareSegment(o,l,u,m){let v=this.segments[this.segments.length-1];return o>ro.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${ro.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>ro.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:l,primitiveOffset:u,vertexLength:0,primitiveLength:0},void 0!==m&&(v.sortKey=m),this.segments.push(v)),v}prepareSegment(o,l,u,m){return this._prepareSegment(o,l.length,u.length,m)}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,m){return new ro([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Ib(d,o){return 256*(d=Ge(Math.floor(d),0,255))+Ge(Math.floor(o),0,255)}ro.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ln(ro,"SegmentVector");const Ob=Ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Xp=Ei([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),MM=Ei([{name:"a_dash",components:4,type:"Uint16"}]);class lm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,u,m){this.ids.push(qg(o)),this.positions.push(l,u,m)}eachPosition(o,l){const u=qg(o);let m=0,v=this.ids.length-1;for(;m<v;){const b=m+v>>1;this.ids[b]>=u?v=b:m=b+1}for(;this.ids[m]===u;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(o,l){const u=new Float64Array(o.ids),m=new Uint32Array(o.positions);return bu(u,m,0,u.length-1),l&&(l.add(u.buffer),l.add(m.buffer)),{ids:u,positions:m}}static deserialize(o){const l=new lm;let u;l.ids=o.ids,l.positions=o.positions;for(const m of l.ids)m!==u&&l.uniqueIds.push(m),u=m;return l.indexed=!0,l}}function qg(d){const o=+d;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Ca(String(d))}function bu(d,o,l,u){for(;l<u;){const m=d[l+u>>1];let v=l-1,b=u+1;for(;;){do{v++}while(d[v]<m);do{b--}while(d[b]>m);if(v>=b)break;cm(d,v,b),cm(o,3*v,3*b),cm(o,3*v+1,3*b+1),cm(o,3*v+2,3*b+2)}b-l<u-b?(bu(d,o,l,b),l=b+1):(bu(d,o,b+1,u),u=b)}}function cm(d,o,l){const u=d[o];d[o]=d[l],d[l]=u}ln(lm,"FeaturePositionMap");class Sc{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Kp extends Sc{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Wo extends Sc{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class hh extends Sc{constructor(o){super(o),this.current=[0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Qp extends Sc{constructor(o){super(o),this.current=[0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class dm extends Sc{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Ry extends Sc{constructor(o){super(o),this.current=Ni.transparent.toRenderColor(null)}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const uh=new Float32Array(16);class hm extends Sc{constructor(o){super(o),this.current=uh}set(o,l,u){if(this.fetchUniformLocation(o,l)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const um=new Float32Array(9),pm=new Float32Array(4);class Kc extends Sc{constructor(o){super(o),this.current=pm}set(o,l,u){if(this.fetchUniformLocation(o,l))for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}function xu(d){return[Ib(255*d.r,255*d.g),Ib(255*d.b,255*d.a)]}class cp{constructor(o,l,u,m){this.value=o,this.uniformNames=l.map(v=>`u_${v}`),this.type=u,this.context=m}setUniform(o,l,u,m,v){const b=m.constantOr(this.value);l.set(o,v,b instanceof Ni?b.toRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):b)}getBinding(o,l){return"color"===this.type?new Ry(o):new Wo(o)}}class Jp{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(o,l){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(o,l,u,m,v){let b=null;"u_pattern"!==v&&"u_dash"!==v||(b=this.pattern),"u_pattern_b"===v&&(b=this.patternTransition),"u_pixel_ratio"===v&&(b=this.pixelRatio),b&&l.set(o,v,b)}getBinding(o,l){return"u_pattern"===l||"u_pattern_b"===l||"u_dash"===l?new dm(o):new Wo(o)}}class ph{constructor(o,l,u,m){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,l,u,m,v,b,C){const D=this.paintVertexArray.length,I="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new dr(0,{brightness:b}),l,{},v,m,C):"constant"===this.expression.kind&&this.expression.value,R=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new dr(0,{brightness:b}),l,{},v,m,C):this.lutExpression.value);this.paintVertexArray.resize(o),this._setPaintValue(D,o,I,R?null:this.context.lut)}updatePaintArray(o,l,u,m,v,b,C){const D="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:C},u,m,void 0,v):"constant"===this.expression.kind&&this.expression.value,I=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new dr(0,{brightness:C}),u,m,void 0,v):this.lutExpression.value);this._setPaintValue(o,l,D,I?null:this.context.lut)}_setPaintValue(o,l,u,m){if("color"===this.type){const v=xu(u.toRenderColor(m));for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,v[0],v[1])}else{for(let v=o;v<l;v++)this.paintVertexArray.emplace(v,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _d{constructor(o,l,u,m,v,b){this.expression=o,this.uniformNames=l.map(C=>`u_${C}_t`),this.type=u,this.useIntegerZoom=m,this.context=v,this.maxValue=0,this.paintVertexAttributes=l.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,l,u,m,v,b,C){const D=this.expression.evaluate(new dr(this.context.zoom,{brightness:b}),l,{},v,m,C),I=this.expression.evaluate(new dr(this.context.zoom+1,{brightness:b}),l,{},v,m,C),R=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new dr(0,{brightness:b}),l,{},v,m,C):this.lutExpression.value),N=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(N,o,D,I,R?null:this.context.lut)}updatePaintArray(o,l,u,m,v,b,C){const D=this.expression.evaluate({zoom:this.context.zoom,brightness:C},u,m,void 0,v),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:C},u,m,void 0,v),R=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new dr(0,{brightness:C}),u,m,void 0,v):this.lutExpression.value);this._setPaintValue(o,l,D,I,R?null:this.context.lut)}_setPaintValue(o,l,u,m,v){if("color"===this.type){const b=xu(u.toRenderColor(v)),C=xu(u.toRenderColor(v));for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,b[0],b[1],C[0],C[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,m,v){const b=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,C=Ge(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);l.set(o,v,C)}getBinding(o,l){return new Wo(o)}}class yd{constructor(o,l,u,m,v){this.expression=o,this.layerId=v,this.paintVertexAttributes=("array"===u?MM:Ob).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new m,this.paintTransitionVertexArray=new Vh}populatePaintArray(o,l,u,m){const v=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(v,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,m,v,b,C){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],b)}_setPaintValues(o,l,u,m){if(!m||!u)return;const v=m[u[0]],b=m[u[1]];if(v){if(v){const{tl:C,br:D,pixelRatio:I}=v;for(let R=o;R<l;R++)this.paintVertexArray.emplace(R,C[0],C[1],D[0],D[1],I)}if(b){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:C,br:D,pixelRatio:I}=b;for(let R=o;R<l;R++)this.paintTransitionVertexArray.emplace(R,C[0],C[1],D[0],D[1],I)}}}upload(o){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=o.createVertexBuffer(this.paintTransitionVertexArray,Xp.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Hh{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[],this.context=l;const m=[];for(const v in o.paint._values){const b=o.paint.get(v);if(v.endsWith("-use-theme")||!u(v)||!(b instanceof Hp&&Gf(b.property.specification)))continue;const C=a(v,o.type),D=b.value,I=b.property.specification.type,R=!!b.property.useIntegerZoom,N="line-dasharray"===v||v.endsWith("pattern"),j=o.paint.get(`${v}-use-theme`),K="line-dasharray"===v&&"constant"!==o.layout.get("line-cap").value.kind||j&&"constant"!==j.value.kind;if("constant"!==D.kind||K)if("source"===D.kind||K||N){const Z=w(v,I,"source");this.binders[v]=N?new yd(D,C,I,Z,o.id):new ph(D,C,I,Z),m.push(`/a_${v}`)}else{const Z=w(v,I,"composite");this.binders[v]=new _d(D,C,I,R,l,Z),m.push(`/z_${v}`)}else this.binders[v]=N?new Jp(D.value,C):new cp(D.value,C,I,l),m.push(`/u_${v}`);j&&(this.binders[v].lutExpression=j.value)}this.cacheKey=m.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof ph||l instanceof _d?l.maxValue:0}populatePaintArrays(o,l,u,m,v,b,C){for(const D in this.binders){const I=this.binders[D];I.context=this.context,(I instanceof ph||I instanceof _d||I instanceof yd)&&I.populatePaintArray(o,l,u,m,v,b,C)}}setConstantPatternPositions(o,l){for(const u in this.binders){const m=this.binders[u];m instanceof Jp&&m.setConstantPatternPositions(o,l)}}getPatternTransitionVertexBuffer(o){const l=this.binders[o];return l instanceof yd?l.paintTransitionVertexBuffer:null}updatePaintArrays(o,l,u,m,v,b,C,D,I){let R=!1;const N=Object.keys(o),j=0!==N.length&&!D,K=j?N:l.uniqueIds;this.context.lut=v.lut;for(const Z in this.binders){const te=this.binders[Z];if(te.context=this.context,(te instanceof ph||te instanceof _d||te instanceof yd)&&te.expression&&te.expression.kind&&"constant"!==te.expression.kind&&(!0===te.expression.isStateDependent||!1===te.expression.isLightConstant)){const ce=v.paint.get(Z);te.expression=ce.value;for(const ue of K){const xe=o[ue.toString()];l.eachPosition(ue,(ve,ie,_e)=>{const we=m.feature(ve);te.updatePaintArray(ie,_e,we,xe,b,C,I)})}if(!j)for(const ue of u.uniqueIds){const xe=o[ue.toString()];u.eachPosition(ue,(ve,ie,_e)=>{const we=m.feature(ve);te.updatePaintArray(ie,_e,we,xe,b,C,I)})}R=!0}}return R}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof cp||u instanceof Jp)&&o.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof ph||u instanceof _d||u instanceof yd)for(let m=0;m<u.paintVertexAttributes.length;m++)o.push(u.paintVertexAttributes[m].name);if(u instanceof yd)for(let m=0;m<Xp.members.length;m++)o.push(Xp.members[m].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof cp||u instanceof Jp||u instanceof _d)for(const m of u.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof cp||m instanceof Jp||m instanceof _d)for(const v of m.uniformNames)l.push({name:v,property:u,binding:m.getBinding(o,v)})}return l}setUniforms(o,l,u,m,v){for(const{name:b,property:C,binding:D}of u)this.binders[C].setUniform(o,D,v,m.get(C),b)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof ph||l instanceof _d||l instanceof yd)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof yd&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof ph||u instanceof _d||u instanceof yd)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof ph||l instanceof _d||l instanceof yd)&&l.destroy()}}}class dp{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new Hh(m,l,u);this.needsUpload=!1,this._featureMap=new lm,this._featureMapWithoutIds=new lm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,u,m,v,b,C,D){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,l,m,v,b,C,D);void 0!==l.id?this._featureMap.add(l.id,u,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,m,v,b,C){for(const D of u)this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,D,m,v,b,C||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const g={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function a(d,o){return g[d]||[d.replace(`${o}-`,"").replace(/-/g,"_")]}const h={"line-pattern":{source:Vh,composite:Vh},"fill-pattern":{source:Vh,composite:Vh},"fill-extrusion-pattern":{source:Vh,composite:Vh},"line-dasharray":{source:nm,composite:nm}},_={color:{source:Xc,composite:gd},number:{source:rp,composite:Xc}};function w(d,o,l){const u=h[d];return u&&u[l]||_[o][l]}ln(cp,"ConstantBinder"),ln(Jp,"PatternConstantBinder"),ln(ph,"SourceExpressionBinder"),ln(yd,"PatternCompositeBinder"),ln(_d,"CompositeExpressionBinder"),ln(Hh,"ProgramConfiguration",{omit:["_buffers"]}),ln(dp,"ProgramConfigurationSet");const M=Xt/Math.PI/2,S=5,P=6,O=16383,V=64,U=[V,32,16],X=-M,G=M;function Q(d,o,l,u=M){return l=ae(l),[d*Math.sin(l)*u,-o*u,d*Math.cos(l)*u]}function se(d,o,l){return Q(Math.cos(ae(d)),Math.sin(ae(d)),o,l)}const oe=6371008.8,de=2*Math.PI*oe;class le{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new le(at(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,m=o.lat*l,v=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((o.lng-this.lng)*l);return oe*Math.acos(Math.min(v,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new be({lng:this.lng-u,lat:this.lat-l},{lng:this.lng+u,lat:this.lat+l})}toEcef(o){return se(this.lat,this.lng,M+o*M/oe)}static convert(o){if(o instanceof le)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new le(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new le(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class be{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(4===o.length){const u=o;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=o;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(o){return this._ne=o instanceof le?new le(o.lng,o.lat):le.convert(o),this}setSouthWest(o){return this._sw=o instanceof le?new le(o.lng,o.lat):le.convert(o),this}extend(o){const l=this._sw,u=this._ne;let m,v;if(o instanceof le)m=o,v=o;else{if(!(o instanceof be))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(be.convert(o)):this.extend(le.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(le.convert(o)):this;if(m=o._sw,v=o._ne,!m||!v)return this}return l||u?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),u.lng=Math.max(v.lng,u.lng),u.lat=Math.max(v.lat,u.lat)):(this._sw=new le(m.lng,m.lat),this._ne=new le(v.lng,v.lat)),this}getCenter(){return new le((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new le(this.getWest(),this.getNorth())}getSouthEast(){return new le(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=le.convert(o);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(o){if(o)return o instanceof be?o:new be(o)}}const Me=0,De=25.5;function Le(d){return de*Math.cos(d*Math.PI/180)}function Ie(d){return(180+d)/360}function Oe(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function Te(d,o){return d/Le(o)}function Be(d){return 360*d-180}function Ve(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function ct(d,o){return d*Le(Ve(o))}const Ye=85.051129;function kt(d){return Math.cos(ae(Ge(d,-Ye,Ye)))}function vt(d,o){const l=Ge(o,Me,De),u=Math.pow(2,l);return kt(d)*de/(512*u)}function Pt(d){return 1/Math.cos(d*Math.PI/180)}function Je(d,o=0){const l=Math.exp(Math.PI*(1-(d.y+o/Xt)/(1<<d.z)*2));return 80150034*l/(l*l+1)/Xt/(1<<d.z)}class ot{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=le.convert(o);return new ot(Ie(u.lng),Oe(u.lat),Te(l,u.lat))}toLngLat(){return new le(Be(this.x),Ve(this.y))}toAltitude(){return ct(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/de*Pt(Ve(this.y))}}function Ke(d,o,l,u,m,v,b,C,D){const I=(o+u)/2,R=(l+m)/2,N=new Wt(I,R);C(N),function(j,K,Z,te,ce,ue){const xe=Z-ce,ve=te-ue;return Math.abs((te-K)*xe-(Z-j)*ve)/Math.hypot(xe,ve)}(N.x,N.y,v.x,v.y,b.x,b.y)>=D?(Ke(d,o,l,I,R,v,N,C,D),Ke(d,I,R,u,m,N,b,C,D)):d.push(b)}function xt(d,o,l){let u=d[0],m=u.x,v=u.y;o(u);const b=[u];for(let C=1;C<d.length;C++){const D=d[C],{x:I,y:R}=D;o(D),Ke(b,m,v,I,R,u,D,o,l),m=I,v=R,u=D}return b}function dt(d,o,l,u){if(u(o,l)){const m=o.add(l)._mult(.5);dt(d,o,m,u),dt(d,m,l,u)}else d.push(l)}function Ot(d,o){let l=d[0];const u=[l];for(let m=1;m<d.length;m++){const v=d[m];dt(u,l,v,o),l=v}return u}const wt=Math.pow(2,14)-1,It=-wt-1;function Lt(d,o){const l=Math.round(d.x*o),u=Math.round(d.y*o);return d.x=Ge(l,It,wt),d.y=Ge(u,It,wt),(l<d.x||l>d.x+1||u<d.y||u>d.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function fn(d,o,l){const u=d.loadGeometry(),m=d.extent,v=Xt/m;if(o&&l&&l.projection.isReprojectedInTileSpace){const b=1<<o.z,{scale:C,x:D,y:I,projection:R}=l,N=j=>{const K=Be((o.x+j.x/m)/b),Z=Ve((o.y+j.y/m)/b),te=R.project(K,Z);j.x=(te.x*C-D)*m,j.y=(te.y*C-I)*m};for(let j=0;j<u.length;j++)if(1!==d.type)u[j]=xt(u[j],N,1);else{const K=[];for(const Z of u[j])Z.x<0||Z.x>=m||Z.y<0||Z.y>=m||(N(Z),K.push(Z));u[j]=K}}for(const b of u)for(const C of b)Lt(C,v);return u}function bn(d,o){return{type:d.type,id:d.id,properties:d.properties,geometry:o?fn(d):[]}}function dn(d,o,l,u,m){d.emplaceBack(2*o+(u+1)/2,2*l+(m+1)/2)}function an(d,o,l){d.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class mn{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Gd,this.indexArray=new Qs,this.segments=new ro,this.programConfigurations=new dp(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,u,m){const v=this.layers[0],b=[];let C=null;"circle"===v.type&&(C=v.layout.get("circle-sort-key"));for(const{feature:I,id:R,index:N,sourceLayerIndex:j}of o){const K=this.layers[0]._featureFilter.needGeometry,Z=bn(I,K);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),Z,u))continue;const te=C?C.evaluate(Z,{},u):void 0,ce={id:R,properties:I.properties,type:I.type,sourceLayerIndex:j,index:N,geometry:K?Z.geometry:fn(I,u,m),patterns:{},sortKey:te};b.push(ce)}C&&b.sort((I,R)=>I.sortKey-R.sortKey);let D=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new op,D=m.projection);for(const I of b){const{geometry:R,index:N,sourceLayerIndex:j}=I,K=o[N].feature;this.addFeature(I,R,N,l.availableImages,u,D,l.brightness),l.featureIndex.insert(K,R,N,j,this.index)}}update(o,l,u,m,v,b,C){this.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Pb.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,kM.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,m,v,b,C){for(const D of l)for(const I of D){const R=I.x,N=I.y;if(R<0||R>=Xt||N<0||N>=Xt)continue;if(b){const Z=b.projectTilePoint(R,N,v),te=b.upVector(v,R,N),ce=this.globeExtVertexArray;an(ce,Z,te),an(ce,Z,te),an(ce,Z,te),an(ce,Z,te)}const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),K=j.vertexLength;dn(this.layoutVertexArray,R,N,-1,-1),dn(this.layoutVertexArray,R,N,1,-1),dn(this.layoutVertexArray,R,N,1,1),dn(this.layoutVertexArray,R,N,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},m,v,C)}}function Dn(d,o){for(let l=0;l<d.length;l++)if(wr(o,d[l]))return!0;for(let l=0;l<o.length;l++)if(wr(d,o[l]))return!0;return!!hr(d,o)}function qn(d,o,l){return!!wr(d,o)||!!ni(o,d,l)}function xi(d,o){if(1===d.length)return qi(o,d[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let m=0;m<u.length;m++)if(wr(d,u[m]))return!0}for(let l=0;l<d.length;l++)if(qi(o,d[l]))return!0;for(let l=0;l<o.length;l++)if(hr(d,o[l]))return!0;return!1}function xr(d,o,l){if(d.length>1){if(hr(d,o))return!0;for(let u=0;u<o.length;u++)if(ni(o[u],d,l))return!0}for(let u=0;u<d.length;u++)if(ni(d[u],o,l))return!0;return!1}function hr(d,o){if(0===d.length||0===o.length)return!1;for(let l=0;l<d.length-1;l++){const u=d[l],m=d[l+1];for(let v=0;v<o.length-1;v++)if(Ci(u,m,o[v],o[v+1]))return!0}return!1}function Ci(d,o,l,u){return fi(d,l,u)!==fi(o,l,u)&&fi(d,o,l)!==fi(d,o,u)}function Lo(d,o,l){return(d.x-l.x)*(o.y-l.y)-(d.y-l.y)*(o.x-l.x)}function fo(d,o,l,u){const m=Lo(d,o,u),v=Lo(d,o,l);if(Math.sign(m)===Math.sign(v))return;const b=Lo(l,u,d),C=b+v-m;return Math.sign(b)!==Math.sign(C)?[b/(b-C),v/(v-m)]:void 0}function ni(d,o,l){const u=l*l;if(1===o.length)return d.distSqr(o[0])<u;for(let m=1;m<o.length;m++)if(Li(d,o[m-1],o[m])<u)return!0;return!1}function Li(d,o,l){const u=o.distSqr(l);if(0===u)return d.distSqr(o);const m=((d.x-o.x)*(l.x-o.x)+(d.y-o.y)*(l.y-o.y))/u;return d.distSqr(m<0?o:m>1?l:l.sub(o)._mult(m)._add(o))}function qi(d,o){let l,u,m,v=!1;for(let b=0;b<d.length;b++){l=d[b];for(let C=0,D=l.length-1;C<l.length;D=C++)u=l[C],m=l[D],u.y>o.y!=m.y>o.y&&o.x<(m.x-u.x)*(o.y-u.y)/(m.y-u.y)+u.x&&(v=!v)}return v}function wr(d,o){let l=!1;for(let u=0,m=d.length-1;u<d.length;m=u++){const v=d[u],b=d[m];v.y>o.y!=b.y>o.y&&o.x<(b.x-v.x)*(o.y-v.y)/(b.y-v.y)+v.x&&(l=!l)}return l}function oo(d,o,l,u,m){for(const b of d)if(o<=b.x&&l<=b.y&&u>=b.x&&m>=b.y)return!0;const v=[new Wt(o,l),new Wt(o,m),new Wt(u,m),new Wt(u,l)];if(d.length>2)for(const b of v)if(wr(d,b))return!0;for(let b=0;b<d.length-1;b++)if(Ho(d[b],d[b+1],v))return!0;return!1}function Ho(d,o,l){const u=l[0],m=l[2];if(d.x<u.x&&o.x<u.x||d.x>m.x&&o.x>m.x||d.y<u.y&&o.y<u.y||d.y>m.y&&o.y>m.y)return!1;const v=fi(d,o,l[0]);return v!==fi(d,o,l[1])||v!==fi(d,o,l[2])||v!==fi(d,o,l[3])}function vo(d,o,l,u,m,v){let b=o.y-d.y,C=d.x-o.x;if(v=v||0){const D=b*b+C*C;if(0===D)return!0;const I=Math.sqrt(D);b/=I,C/=I}return!((l.x-d.x)*b+(l.y-d.y)*C-v<0||(u.x-d.x)*b+(u.y-d.y)*C-v<0||(m.x-d.x)*b+(m.y-d.y)*C-v<0)}function so(d,o,l,u,m,v,b){return!(vo(d,o,u,m,v,b)||vo(o,l,u,m,v,b)||vo(l,d,u,m,v,b)||vo(u,m,d,o,l,b)||vo(m,v,d,o,l,b)||vo(v,u,d,o,l,b))}function ai(d,o,l){const u=o.paint.get(d).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(d)}function Hr(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function Vi(d,o,l,u,m){if(!o[0]&&!o[1])return d;const v=Wt.convert(o)._mult(m);"viewport"===l&&v._rotate(-u);const b=[];for(let C=0;C<d.length;C++)b.push(d[C].sub(v));return b}function Xr(d,o,l,u){const m=Wt.convert(d)._mult(u);return"viewport"===o&&m._rotate(-l),m}let ir,ao;function us(d,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[d*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}ln(mn,"CircleBucket",{omit:["layers"]});class kr{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=Ra(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(b=this.y,C=this.z,D=us(256*(v=this.x),256*(b=Math.pow(2,C)-b-1),C),I=us(256*(v+1),256*(b+1),C),D[0]+","+D[1]+","+I[0]+","+I[1]),m=function(v,b,C){let D,I="";for(let R=v;R>0;R--)D=1<<R-1,I+=(b&D?1:0)+(C&D?2:0);return I}(this.z,this.x,this.y);var v,b,C,D,I;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oa{constructor(o,l){this.wrap=o,this.canonical=l,this.key=Ra(o,l.z,l.z,l.x,l.y)}}class ps{constructor(o,l,u,m,v){this.overscaledZ=o,this.wrap=l,this.canonical=new kr(u,+m,+v),this.key=0===l&&o===u?this.canonical.key:Ra(l,o,u,m,v)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new ps(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ps(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return Ra(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return Ra(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new ps(l,this.wrap,l,u,m),new ps(l,this.wrap,l,u+1,m),new ps(l,this.wrap,l,u,m+1),new ps(l,this.wrap,l,u+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new ps(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oa(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ra(d,o,l,u,m){const v=1<<Math.min(l,22);let b=v*(m%v)+u%v;return d&&l<22&&(b+=v*v*((d<0?-2*d-1:2*d)%(1<<2*(22-l)))),16*(32*b+l)+(o-l)}const Wd=[d=>{let o=d.canonical.x-1,l=d.wrap;return o<0&&(o=(1<<d.canonical.z)-1,l--),new ps(d.overscaledZ,l,d.canonical.z,o,d.canonical.y)},d=>{let o=d.canonical.x+1,l=d.wrap;return o===1<<d.canonical.z&&(o=0,l++),new ps(d.overscaledZ,l,d.canonical.z,o,d.canonical.y)},d=>new ps(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(0===d.canonical.y?1<<d.canonical.z:d.canonical.y)-1),d=>new ps(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];ln(kr,"CanonicalTileID"),ln(ps,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const wu=Ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ec}=wu,vd=Ei([{name:"a_pos_3",components:3,type:"Int16"}]);var fh=Ei([{name:"a_pos",type:"Int16",components:2}]);class Qc{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const m=lr(l,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1])/m;return u[0]=this.pos[0]+this.dir[0]*v,u[1]=this.pos[1]+this.dir[1]*v,!0}}class bd{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const m=ei(l,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/m;return u[0]=this.pos[0]+this.dir[0]*v,u[1]=this.pos[1]+this.dir[1]*v,u[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(o,l,u){if(te=(K=this.pos)[0],ce=K[1],ue=K[2],xe=(Z=o)[0],ve=Z[1],ie=Z[2],Math.abs(te-xe)<=En*Math.max(1,Math.abs(te),Math.abs(xe))&&Math.abs(ce-ve)<=En*Math.max(1,Math.abs(ce),Math.abs(ve))&&Math.abs(ue-ie)<=En*Math.max(1,Math.abs(ue),Math.abs(ie))||0===l)return u[0]=u[1]=u[2]=0,!1;var K,Z,te,ce,ue,xe,ve,ie;const[m,v,b]=this.dir,C=this.pos[0]-o[0],D=this.pos[1]-o[1],I=this.pos[2]-o[2],R=m*m+v*v+b*b,N=2*(C*m+D*v+I*b),j=N*N-4*R*(C*C+D*D+I*I-l*l);if(j<0){const K=Math.max(-N/2,0),Z=C+m*K,te=D+v*K,ce=I+b*K,ue=Math.hypot(Z,te,ce);return u[0]=Z*l/ue,u[1]=te*l/ue,u[2]=ce*l/ue,!1}{const K=(-N-Math.sqrt(j))/(2*R);if(K<0){const Z=Math.hypot(C,D,I);return u[0]=C*l/Z,u[1]=D*l/Z,u[2]=I*l/Z,!1}return u[0]=C+m*K,u[1]=D+v*K,u[2]=I+b*K,!0}}}class ef{constructor(o,l,u,m,v){this.TL=o,this.TR=l,this.BR=u,this.BL=m,this.horizon=v}static fromInvProjectionMatrix(o,l,u){const m=[-1,1,1],v=[1,1,1],b=[1,-1,1],C=[-1,-1,1],D=ui(m,m,o),I=ui(v,v,o),R=ui(b,b,o),N=ui(C,C,o);return new ef(D,I,R,N,l/u)}}function ku(d,o,l){let u=1/0,m=-1/0;const v=[];for(const b of d){Vr(v,b,o);const C=ei(v,l);u=Math.min(u,C),m=Math.max(m,C)}return[u,m]}function P0(d,o){let l=!0;for(let u=0;u<d.planes.length;u++){const m=d.planes[u];let v=0;for(let b=0;b<o.length;b++)v+=ei(m,o[b])+m[3]>=0;if(0===v)return 0;v!==o.length&&(l=!1)}return l?2:1}function fm(d,o){for(const l of d.projections){const u=ku(o,d.points[0],l.axis);if(l.projection[1]<u[0]||l.projection[0]>u[1])return 0}return 1}function I0(d,o){let l=0;const u=[0,0,0,0];for(let b=0;b<d.length;b++)u[0]=d[b][0],u[1]=d[b][1],u[2]=d[b][2],u[3]=1,(m=u)[0]*(v=o)[0]+m[1]*v[1]+m[2]*v[2]+m[3]*v[3]>=0&&l++;var m,v;return l}class mm{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=eo.fromPoints(this.points),this.projections=[],this.frustumEdges=[Vr([],this.points[2],this.points[3]),Vr([],this.points[0],this.points[3]),Vr([],this.points[4],this.points[0]),Vr([],this.points[5],this.points[1]),Vr([],this.points[6],this.points[2]),Vr([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],v=[u[2],0,-u[0]];this.projections.push({axis:m,projection:ku(this.points,this.points[0],m)}),this.projections.push({axis:v,projection:ku(this.points,this.points[0],v)})}}static fromInvProjectionMatrix(o,l,u,m){const v=Math.pow(2,u),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const R=_o([],I,o),N=1/R[3]/l*v;return(j=R)[0]=(K=R)[0]*(Z=[N,N,m?1/R[3]:N,N])[0],j[1]=K[1]*Z[1],j[2]=K[2]*Z[2],j[3]=K[3]*Z[3],j;var j,K,Z}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const R=Sn([],si([],Vr([],b[I[0]],b[I[1]]),Vr([],b[I[2]],b[I[1]]))),N=-ei(R,b[I[1]]);return R.concat(N)}),D=[];for(let I=0;I<b.length;I++)D.push([b[I][0],b[I][1],b[I][2]]);return new mm(D,C)}intersectsPrecise(o,l,u){for(let m=0;m<l.length;m++)if(!I0(o,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!I0(o,this.planes[m]))return 0;for(const m of u)for(const v of this.frustumEdges){const b=si([],m,v),C=gr(b);if(0===C)continue;Jn(b,b,1/C);const D=ku(this.points,this.points[0],b),I=ku(o,this.points[0],b);if(D[0]>I[1]||I[0]>D[1])return 0}return 1}containsPoint(o){for(const l of this.planes){const u=l[3];if(ei([l[0],l[1],l[2]],o)+u<0)return!1}return!0}}class eo{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of o)wa(l,l,m),Pi(u,u,m);return new eo(l,u)}static fromTileIdAndHeight(o,l,u){const m=1<<o.canonical.z,v=o.canonical.x,b=o.canonical.y;return new eo([v/m,b/m,l],[(v+1)/m,(b+1)/m,u])}static applyTransform(o,l){const u=o.getCorners();for(let m=0;m<u.length;++m)ui(u[m],u[m],l);return eo.fromPoints(u)}static applyTransformFast(o,l){const u=[l[12],l[13],l[14]],m=[...u];for(let v=0;v<3;v++)for(let b=0;b<3;b++){const C=l[4*b+v],D=C*o.min[b],I=C*o.max[b];u[v]+=Math.min(D,I),m[v]+=Math.max(D,I)}return new eo(u,m)}static projectAabbCorners(o,l){const u=o.getCorners();for(let m=0;m<u.length;++m)ui(u[m],u[m],l);return u}constructor(o,l){this.min=o,this.max=l,this.center=Jn([],Cr([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=Co(this.min),m=Co(this.max);for(let v=0;v<l.length;v++)u[v]=l[v]?this.min[v]:this.center[v],m[v]=l[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new eo(u,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?P0(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?P0(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?fm(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?fm(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function Mu(d){return d*M/oe}ln(eo,"Aabb");const Ly=[new eo([X,X,X],[G,G,G]),new eo([X,X,X],[0,0,G]),new eo([0,X,X],[G,0,G]),new eo([X,0,X],[0,G,G]),new eo([0,0,X],[G,G,G])];function ZS(d,o,l,u=!0){const m=Jn([],d._camera.position,d.worldSize),v=[o,l,1,1];_o(v,v,d.pixelMatrixInverse),Gs(v,v,1/v[3]);const b=Sn([],Vr([],v,m)),C=d.globeMatrix,D=[C[12],C[13],C[14]],I=Vr([],D,m),R=gr(I),N=Sn([],I),j=d.worldSize/(2*Math.PI),K=ei(N,b),Z=Math.asin(j/R);if(Z<Math.acos(K)){if(!u)return null;const Ze=[],Xe=[];Jn(Ze,b,R/K),Sn(Xe,Vr(Xe,Ze,I)),Sn(b,Cr(b,I,Jn(b,Xe,Math.tan(Z)*R)))}const te=[];new bd(m,b).closestPointOnSphere(D,j,te);const ce=Sn([],Qo(C,0)),ue=Sn([],Qo(C,1)),xe=Sn([],Qo(C,2)),ve=ei(ce,te),ie=ei(ue,te),_e=ei(xe,te),we=ge(Math.asin(-ie/j));let Ce=ge(Math.atan2(ve,_e));Ce=d.center.lng+function(Ze,Xe){const pt=(Xe-Ze+180)%360-180;return pt<-180?pt+360:pt}(d.center.lng,Ce);const ze=Ie(Ce),qe=Ge(Oe(we),0,1);return new ot(ze,qe)}class Rb{constructor(o,l,u){this.a=Vr([],o,u),this.b=Vr([],l,u),this.center=u;const m=Sn([],this.a),v=Sn([],this.b);this.angle=Math.acos(ei(m,v))}}function CM(d,o){if(0===d.angle)return null;let l;return l=0===d.a[o]?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[o]/d.a[o]/Math.sin(d.angle)-1/Math.tan(d.angle)),l<0||l>1?null:function(u,m,v,b){const C=Math.sin(v);return u*(Math.sin((1-b)*v)/C)+m*(Math.sin(b*v)/C)}(d.a[o],d.b[o],d.angle,Ge(l,0,1))+d.center[o]}function hp(d){if(d.z<=1)return Ly[d.z+2*d.y+d.x];const o=$g(Fy(d));return eo.fromPoints(o)}function tf(d,o,l){return Jn(d,d,1-l),yi(d,d,o,l)}function YS(d,o,l){for(const u of d)ui(u,u,o),Jn(u,u,l)}function XS(d,o,l,u){const m=o/d.worldSize,v=d.globeMatrix;if(l.z<=1){const qe=hp(l).getCorners();return YS(qe,v,m),eo.fromPoints(qe)}const b=Fy(l,u),C=$g(b,M+Mu(d._tileCoverLift));YS(C,v,m);const D=Number.MAX_VALUE,I=[-D,-D,-D],R=[D,D,D];if(b.contains(d.center)){for(const Xe of C)wa(R,R,Xe),Pi(I,I,Xe);I[2]=0;const qe=d.point,Ze=[qe.x*m,qe.y*m,0];return wa(R,R,Ze),Pi(I,I,Ze),new eo(R,I)}if(d._tileCoverLift>0){for(const qe of C)wa(R,R,qe),Pi(I,I,qe);return new eo(R,I)}const N=[v[12]*m,v[13]*m,v[14]*m],j=b.getCenter(),K=Ge(d.center.lat,-Ye,Ye),Z=Ge(j.lat,-Ye,Ye),te=Ie(d.center.lng),ce=Oe(K);let ue=te-Ie(j.lng);const xe=ce-Oe(Z);ue>.5?ue-=1:ue<-.5&&(ue+=1);let ve=0;Math.abs(ue)>Math.abs(xe)?ve=ue>=0?1:3:(ve=xe>=0?0:2,yi(N,N,[v[4]*m,v[5]*m,v[6]*m],-Math.sin(ae(xe>=0?b.getSouth():b.getNorth()))*M));const ie=C[ve],_e=C[(ve+1)%4],we=new Rb(ie,_e,N),Ce=[CM(we,0)||ie[0],CM(we,1)||ie[1],CM(we,2)||ie[2]],ze=Uh(d.zoom);if(ze>0){const qe=function({x:Xe,y:pt,z:Rt},Mt,Tt,Nt,ut){const Et=1/(1<<Rt);let lt=Xe*Et,gt=lt+Et,Bt=pt*Et,q=Bt+Et,gn=0;const hn=(lt+gt)/2-Nt;return hn>.5?gn=-1:hn<-.5&&(gn=1),lt=((lt+gn)*Mt-(Nt*=Mt))*Tt+Nt,gt=((gt+gn)*Mt-Nt)*Tt+Nt,Bt=(Bt*Mt-(ut*=Mt))*Tt+ut,q=(q*Mt-ut)*Tt+ut,[[lt,q,0],[gt,q,0],[gt,Bt,0],[lt,Bt,0]]}(l,o,d._pixelsPerMercatorPixel,te,ce);for(let Xe=0;Xe<C.length;Xe++)tf(C[Xe],qe[Xe],ze);const Ze=Cr([],qe[ve],qe[(ve+1)%4]);Jn(Ze,Ze,.5),tf(Ce,Ze,ze)}for(const qe of C)wa(R,R,qe),Pi(I,I,qe);return R[2]=Math.min(ie[2],_e[2]),wa(R,R,Ce),Pi(I,I,Ce),new eo(R,I)}function Fy({x:d,y:o,z:l},u=!1){const m=1/(1<<l),v=new le(Be(d*m),o===(1<<l)-1&&u?-90:Ve((o+1)*m)),b=new le(Be((d+1)*m),0===o&&u?90:Ve(o*m));return new be(v,b)}function $g(d,o=M){const l=ae(d.getNorth()),u=ae(d.getSouth()),m=Math.cos(l),v=Math.cos(u),b=Math.sin(l),C=Math.sin(u),D=d.getWest(),I=d.getEast();return[Q(v,C,D,o),Q(v,C,I,o),Q(m,b,I,o),Q(m,b,D,o)]}function nf(d,o,l,u){const m=1<<l.z,v=(d/Xt+l.x)/m;return se(Ve((o/Xt+l.y)/m),Be(v),u)}function O0({min:d,max:o}){return O/Math.max(o[0]-d[0],o[1]-d[1],o[2]-d[2])}const Lb=new Float64Array(16);function R0(d){const o=O0(d),l=xa(Lb,[o,o,o]);return ho(l,l,Bo([],d.min))}function rf(d){const o=(u=d.min,(l=Lb)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const m=1/O0(d);return No(o,o,[m,m,m])}function zy(d){const o=Xt/(2*Math.PI);return d/(2*Math.PI)/o}function Fb(d,o){return Xt/(512*Math.pow(2,d))*O0(hp(o))}function L0(d,o,l,u,m){const v=zy(l),b=[d,o,-l/(2*Math.PI)],C=Gn(new Float64Array(16));return ho(C,C,b),No(C,C,[v,v,v]),Uo(C,C,ae(-m)),Ya(C,C,ae(-u)),C}function Uh(d){return Ne(S,P,d)}function up(d,o){const l=se(o.lat,o.lng);return b=(m=gs([],function(Z){const te=se(Z._center.lat,Z._center.lng);let ce=si([],Qn(0,1,0),te);const ue=Il([],-Z.angle,te);ce=ui(ce,ce,ue),Il(ue,-Z._pitch,ce);const xe=Sn([],te);return Jn(xe,xe,Mu(Z.cameraToCenterDistance/Z.pixelsPerMeter)),ui(xe,xe,ue),Cr([],te,xe)}(d),l))[0],C=m[1],D=m[2],I=(v=l)[0],R=v[1],N=v[2],K=(j=Math.sqrt(b*b+C*C+D*D)*Math.sqrt(I*I+R*R+N*N))&&ei(m,v)/j,Math.acos(Math.min(Math.max(K,-1),1));var m,v,b,C,D,I,R,N,j,K}function zb(d,o){return up(d,o)>Math.PI/2*1.01}const SM=ae(85),KS=Math.cos(SM),EM=Math.sin(SM),Nb=Fc(),DM=d=>{const o=[];return"map"===d.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o};function TM(d,o,l,u,m,v,b,C,D){if(v&&d.queryGeometry.isAboveHorizon)return!1;v&&(D*=d.pixelToTileUnitsFactor);const I=d.tileID.canonical,R=l.projection.upVectorScale(I,l.center.lat,l.worldSize).metersToTile;for(const N of o)for(const j of N){const K=j.add(C),Z=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(K.x,K.y,!0):0,te=l.projection.projectTilePoint(K.x,K.y,I);if(Z>0){const ve=l.projection.upVector(I,K.x,K.y);te.x+=ve[0]*R*Z,te.y+=ve[1]*R*Z,te.z+=ve[2]*R*Z}const ce=v?K:QS(te.x,te.y,te.z,u),ue=v?d.tilespaceRays.map(ve=>eE(ve,Z)):d.queryGeometry.screenGeometry,xe=_o([],[te.x,te.y,te.z,1],u);if(!b&&v?D*=xe[3]/l.cameraToCenterDistance:b&&!v&&(D*=l.cameraToCenterDistance/xe[3]),v){const ve=Ve((j.y/Xt+I.y)/(1<<I.z));D/=l.projection.pixelsPerMeter(ve,1)/Te(1,ve)}if(qn(ue,ce,D))return!0}return!1}function QS(d,o,l,u){const m=_o([],[d,o,l,1],u);return new Wt(m[0]/m[3],m[1]/m[3])}const Bb=Qn(0,0,0),JS=Qn(0,0,1);function eE(d,o){const l=Ji();return Bb[2]=o,d.intersectsPlane(Bb,JS,l),new Wt(l[0],l[1])}class Jc extends mn{}let Ny,Vb,By,rc;function Gg(d,{width:o,height:l},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*l*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(o*l*u);return d.width=o,d.height=l,d.data=m,d}function jb(d,o,l){const{width:u,height:m}=o;u===d.width&&m===d.height||(Vy(d,o,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,u),height:Math.min(d.height,m)},l,null),d.width=u,d.height=m,d.data=o.data)}function Vy(d,o,l,u,m,v,b,C){if(0===m.width||0===m.height)return o;if(m.width>d.width||m.height>d.height||l.x>d.width-m.width||l.y>d.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||u.x>o.width-m.width||u.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const D=d.data,I=o.data,R=4===v&&C;for(let N=0;N<m.height;N++){const j=((l.y+N)*d.width+l.x)*v,K=((u.y+N)*o.width+u.x)*v;if(R)for(let Z=0;Z<m.width;Z++){const te=j+Z*v+3,ce=K+Z*v;I[ce+0]=255,I[ce+1]=255,I[ce+2]=255,I[ce+3]=D[te]}else if(b)for(let Z=0;Z<m.width;Z++){const te=j+Z*v,ce=K+Z*v,ue=D[te+3],xe=new Ni(D[te+0]/255*ue,D[te+1]/255*ue,D[te+2]/255*ue,ue).toRenderColor(b).toArray();I[ce+0]=xe[0],I[ce+1]=xe[1],I[ce+2]=xe[2],I[ce+3]=xe[3]}else for(let Z=0;Z<m.width*v;Z++)I[K+Z]=D[j+Z]}return o}ln(Jc,"HeatmapBucket",{omit:["layers"]});class sf{constructor(o,l){Gg(this,o,1,l)}resize(o){jb(this,new sf(o),1)}clone(){return new sf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,m,v){Vy(o,l,u,m,v,1,null)}}class $a{constructor(o,l){Gg(this,o,4,l)}resize(o){jb(this,new $a(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,m,v,b,C){Vy(o,l,u,m,v,4,b,C)}}class AM{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function Wg(d){const o={},l=d.resolution||256,u=d.clips?d.clips.length:1,m=d.image||new $a({width:l,height:u}),v=(b,C,D)=>{o[d.evaluationKey]=D;const I=d.expression.evaluate(o);I&&(m.data[b+C+0]=Math.floor(255*I.r/I.a),m.data[b+C+1]=Math.floor(255*I.g/I.a),m.data[b+C+2]=Math.floor(255*I.b/I.a),m.data[b+C+3]=Math.floor(255*I.a))};if(d.clips)for(let b=0,C=0;b<u;++b,C+=4*l)for(let D=0,I=0;D<l;D++,I+=4){const R=D/(l-1),{start:N,end:j}=d.clips[b];v(C,I,N*(1-R)+j*R)}else for(let b=0,C=0;b<l;b++,C+=4)v(0,C,b/(l-1));return m}ln(sf,"AlphaImage"),ln($a,"RGBAImage");const tE=Ei([{name:"a_pos",components:2,type:"Int16"}],4),PM=Ei([{name:"a_road_z_offset",components:1,type:"Float32"}],4),nE=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),iE=Ei([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function gm(d,o,l=2){const u=o&&o.length,m=u?o[0]*l:d.length;let v=jy(d,0,m,l,!0);const b=[];if(!v||v.next===v.prev)return b;let C,D,I;if(u&&(v=function(R,N,j,K){const Z=[];for(let te=0,ce=N.length;te<ce;te++){const ue=jy(R,N[te]*K,te<ce-1?N[te+1]*K:R.length,K,!1);ue===ue.next&&(ue.steiner=!0),Z.push(Hb(ue))}Z.sort(RM);for(let te=0;te<Z.length;te++)j=Zg(Z[te],j);return j}(d,o,v,l)),d.length>80*l){C=1/0,D=1/0;let R=-1/0,N=-1/0;for(let j=l;j<m;j+=l){const K=d[j],Z=d[j+1];K<C&&(C=K),Z<D&&(D=Z),K>R&&(R=K),Z>N&&(N=Z)}I=Math.max(R-C,N-D),I=0!==I?32767/I:0}return pp(v,b,l,C,D,I,0),b}function jy(d,o,l,u,m){let v;if(m===function(b,C,D,I){let R=0;for(let N=C,j=D-I;N<D;N+=I)R+=(b[j]-b[N])*(b[N+1]+b[j+1]),j=N;return R}(d,o,l,u)>0)for(let b=o;b<l;b+=u)v=Gy(b/u|0,d[b],d[b+1],v);else for(let b=l-u;b>=o;b-=u)v=Gy(b/u|0,d[b],d[b+1],v);return v&&Yg(v,v.next)&&(B0(v),v=v.next),v}function _m(d,o){if(!d)return d;o||(o=d);let l,u=d;do{if(l=!1,u.steiner||!Yg(u,u.next)&&0!==ca(u.prev,u,u.next))u=u.next;else{if(B0(u),u=o=u.prev,u===u.next)break;l=!0}}while(l||u!==o);return o}function pp(d,o,l,u,m,v,b){if(!d)return;!b&&v&&function(D,I,R,N){let j=D;do{0===j.z&&(j.z=Uy(j.x,j.y,I,R,N)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==D);j.prevZ.nextZ=null,j.prevZ=null,function(K){let Z,te=1;do{let ce,ue=K;K=null;let xe=null;for(Z=0;ue;){Z++;let ve=ue,ie=0;for(let we=0;we<te&&(ie++,ve=ve.nextZ,ve);we++);let _e=te;for(;ie>0||_e>0&&ve;)0!==ie&&(0===_e||!ve||ue.z<=ve.z)?(ce=ue,ue=ue.nextZ,ie--):(ce=ve,ve=ve.nextZ,_e--),xe?xe.nextZ=ce:K=ce,ce.prevZ=xe,xe=ce;ue=ve}xe.nextZ=null,te*=2}while(Z>1)}(j)}(d,u,m,v);let C=d;for(;d.prev!==d.next;){const D=d.prev,I=d.next;if(v?oE(d,u,m,v):rE(d))o.push(D.i,d.i,I.i),B0(d),d=I.next,C=I.next;else if((d=I)===C){b?1===b?pp(d=IM(_m(d),o),o,l,u,m,v,2):2===b&&OM(d,o,l,u,m,v):pp(_m(d),o,l,u,m,v,1);break}}}function rE(d){const o=d.prev,l=d,u=d.next;if(ca(o,l,u)>=0)return!1;const m=o.x,v=l.x,b=u.x,C=o.y,D=l.y,I=u.y,R=Math.min(m,v,b),N=Math.min(C,D,I),j=Math.max(m,v,b),K=Math.max(C,D,I);let Z=u.next;for(;Z!==o;){if(Z.x>=R&&Z.x<=j&&Z.y>=N&&Z.y<=K&&z0(m,C,v,D,b,I,Z.x,Z.y)&&ca(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function oE(d,o,l,u){const m=d.prev,v=d,b=d.next;if(ca(m,v,b)>=0)return!1;const C=m.x,D=v.x,I=b.x,R=m.y,N=v.y,j=b.y,K=Math.min(C,D,I),Z=Math.min(R,N,j),te=Math.max(C,D,I),ce=Math.max(R,N,j),ue=Uy(K,Z,o,l,u),xe=Uy(te,ce,o,l,u);let ve=d.prevZ,ie=d.nextZ;for(;ve&&ve.z>=ue&&ie&&ie.z<=xe;){if(ve.x>=K&&ve.x<=te&&ve.y>=Z&&ve.y<=ce&&ve!==m&&ve!==b&&z0(C,R,D,N,I,j,ve.x,ve.y)&&ca(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,ie.x>=K&&ie.x<=te&&ie.y>=Z&&ie.y<=ce&&ie!==m&&ie!==b&&z0(C,R,D,N,I,j,ie.x,ie.y)&&ca(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;ve&&ve.z>=ue;){if(ve.x>=K&&ve.x<=te&&ve.y>=Z&&ve.y<=ce&&ve!==m&&ve!==b&&z0(C,R,D,N,I,j,ve.x,ve.y)&&ca(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;ie&&ie.z<=xe;){if(ie.x>=K&&ie.x<=te&&ie.y>=Z&&ie.y<=ce&&ie!==m&&ie!==b&&z0(C,R,D,N,I,j,ie.x,ie.y)&&ca(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function IM(d,o){let l=d;do{const u=l.prev,m=l.next.next;!Yg(u,m)&&LM(u,l,l.next,m)&&af(u,m)&&af(m,u)&&(o.push(u.i,l.i,m.i),B0(l),B0(l.next),l=d=m),l=l.next}while(l!==d);return _m(l)}function OM(d,o,l,u,m,v){let b=d;do{let C=b.next.next;for(;C!==b.prev;){if(b.i!==C.i&&sE(b,C)){let D=$y(b,C);return b=_m(b,b.next),D=_m(D,D.next),pp(b,o,l,u,m,v,0),void pp(D,o,l,u,m,v,0)}C=C.next}b=b.next}while(b!==d)}function RM(d,o){let l=d.x-o.x;return 0===l&&(l=d.y-o.y,0===l)&&(l=(d.next.y-d.y)/(d.next.x-d.x)-(o.next.y-o.y)/(o.next.x-o.x)),l}function Zg(d,o){const l=function(m,v){let b=v;const C=m.x,D=m.y;let I,R=-1/0;if(Yg(m,b))return b;do{if(Yg(m,b.next))return b.next;if(D<=b.y&&D>=b.next.y&&b.next.y!==b.y){const te=b.x+(D-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(te<=C&&te>R&&(R=te,I=b.x<b.next.x?b:b.next,te===C))return I}b=b.next}while(b!==v);if(!I)return null;const N=I,j=I.x,K=I.y;let Z=1/0;b=I;do{if(C>=b.x&&b.x>=j&&C!==b.x&&F0(D<K?C:R,D,j,K,D<K?R:C,D,b.x,b.y)){const te=Math.abs(D-b.y)/(C-b.x);af(b,m)&&(te<Z||te===Z&&(b.x>I.x||b.x===I.x&&Hy(I,b)))&&(I=b,Z=te)}b=b.next}while(b!==N);return I}(d,o);if(!l)return o;const u=$y(l,d);return _m(u,u.next),_m(l,l.next)}function Hy(d,o){return ca(d.prev,d,o.prev)<0&&ca(o.next,d,d.next)<0}function Uy(d,o,l,u,m){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-l)*m|0)|d<<8))|d<<4))|d<<2))|d<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Hb(d){let o=d,l=d;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==d);return l}function F0(d,o,l,u,m,v,b,C){return(m-b)*(o-C)>=(d-b)*(v-C)&&(d-b)*(u-C)>=(l-b)*(o-C)&&(l-b)*(v-C)>=(m-b)*(u-C)}function z0(d,o,l,u,m,v,b,C){return!(d===b&&o===C)&&F0(d,o,l,u,m,v,b,C)}function sE(d,o){return d.next.i!==o.i&&d.prev.i!==o.i&&!function(l,u){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==u.i&&m.next.i!==u.i&&LM(m,m.next,l,u))return!0;m=m.next}while(m!==l);return!1}(d,o)&&(af(d,o)&&af(o,d)&&function(l,u){let m=l,v=!1;const b=(l.x+u.x)/2,C=(l.y+u.y)/2;do{m.y>C!=m.next.y>C&&m.next.y!==m.y&&b<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next}while(m!==l);return v}(d,o)&&(ca(d.prev,d,o.prev)||ca(d,o.prev,o))||Yg(d,o)&&ca(d.prev,d,d.next)>0&&ca(o.prev,o,o.next)>0)}function ca(d,o,l){return(o.y-d.y)*(l.x-o.x)-(o.x-d.x)*(l.y-o.y)}function Yg(d,o){return d.x===o.x&&d.y===o.y}function LM(d,o,l,u){const m=N0(ca(d,o,l)),v=N0(ca(d,o,u)),b=N0(ca(l,u,d)),C=N0(ca(l,u,o));return m!==v&&b!==C||!(0!==m||!qy(d,l,o))||!(0!==v||!qy(d,u,o))||!(0!==b||!qy(l,d,u))||!(0!==C||!qy(l,o,u))}function qy(d,o,l){return o.x<=Math.max(d.x,l.x)&&o.x>=Math.min(d.x,l.x)&&o.y<=Math.max(d.y,l.y)&&o.y>=Math.min(d.y,l.y)}function N0(d){return d>0?1:d<0?-1:0}function af(d,o){return ca(d.prev,d,d.next)<0?ca(d,o,d.next)>=0&&ca(d,d.prev,o)>=0:ca(d,o,d.prev)<0||ca(d,d.next,o)<0}function $y(d,o){const l=Ub(d.i,d.x,d.y),u=Ub(o.i,o.x,o.y),m=d.next,v=o.prev;return d.next=o,o.prev=d,l.next=m,m.prev=l,u.next=l,l.prev=u,v.next=u,u.prev=v,u}function Gy(d,o,l,u){const m=Ub(d,o,l);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function B0(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function Ub(d,o,l){return{i:d,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Xg(d,o){const l=d.length;if(l<=1)return[d];const u=[];let m,v;for(let b=0;b<l;b++){const C=ki(d[b]);0!==C&&(d[b].area=Math.abs(C),void 0===v&&(v=C<0),v===C<0?(m&&u.push(m),m=[d[b]]):m.push(d[b]))}if(m&&u.push(m),o>1)for(let b=0;b<u.length;b++)u[b].length<=o||(Bl(u[b],o,1,u[b].length-1,FM),u[b]=u[b].slice(0,o));return u}function FM(d,o){return o.area-d.area}function lf(d,o,l=1){if(!d)return null;const u="string"==typeof d?ja.from(d).getPrimary():d.getPrimary(),m="string"==typeof d?null:d.getSecondary();for(const v of[u,m]){if(!v)continue;const b=v.id.toString();o.has(b)||o.set(b,[]),v.scaleSelf(l),o.get(b).push(v)}return{primary:u.toString(),secondary:m?m.toString():null}}function Wy(d,o,l,u){const m=u.patternDependencies;let v=!1;for(const b of o){const C=b.paint.get(`${d}-pattern`);C.isConstant()||(v=!0),lf(C.constantOr(null),m,l)&&(v=!0)}return v}function Zy(d,o,l,u,m,v){const b=v.patternDependencies;for(const C of o){const D=C.paint.get(`${d}-pattern`).value;if("constant"!==D.kind){let I=D.evaluate({zoom:u},l,{},v.availableImages);I=I&&I.name?I.name:I;const R=lf(I,b,m);if(!R)continue;const{primary:N,secondary:j}=R;N&&(l.patterns[C.id]=[N,j].filter(Boolean))}}return l}var qb,aE,Kg,zM,Yy,$b,Gb,Qg={};function Wb(){if(aE)return qb;aE=1;var d=Th();function o(m,v,b,C,D){this.properties={},this.extent=b,this.type=0,this._pbf=m,this._geometry=-1,this._keys=C,this._values=D,m.readFields(l,this,v)}function l(m,v,b){1==m?v.id=b.readVarint():2==m?function(C,D){for(var I=C.readVarint()+C.pos;C.pos<I;){var R=D._keys[C.readVarint()],N=D._values[C.readVarint()];D.properties[R]=N}}(b,v):3==m?v.type=b.readVarint():4==m&&(v._geometry=b.pos)}function u(m){for(var v,b,C=0,D=0,I=m.length,R=I-1;D<I;R=D++)C+=((b=m[R]).x-(v=m[D]).x)*(v.y+b.y);return C}return qb=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var v,b=m.readVarint()+m.pos,C=1,D=0,I=0,R=0,N=[];m.pos<b;){if(D<=0){var j=m.readVarint();C=7&j,D=j>>3}if(D--,1===C||2===C)I+=m.readSVarint(),R+=m.readSVarint(),1===C&&(v&&N.push(v),v=[]),v.push(new d(I,R));else{if(7!==C)throw new Error("unknown command "+C);v&&v.push(v[0].clone())}}return v&&N.push(v),N},o.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var v=m.readVarint()+m.pos,b=1,C=0,D=0,I=0,R=1/0,N=-1/0,j=1/0,K=-1/0;m.pos<v;){if(C<=0){var Z=m.readVarint();b=7&Z,C=Z>>3}if(C--,1===b||2===b)(D+=m.readSVarint())<R&&(R=D),D>N&&(N=D),(I+=m.readSVarint())<j&&(j=I),I>K&&(K=I);else if(7!==b)throw new Error("unknown command "+b)}return[R,j,N,K]},o.prototype.toGeoJSON=function(m,v,b){var C,D,I=this.extent*Math.pow(2,b),R=this.extent*m,N=this.extent*v,j=this.loadGeometry(),K=o.types[this.type];function Z(ue){for(var xe=0;xe<ue.length;xe++){var ve=ue[xe];ue[xe]=[360*(ve.x+R)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+N)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(C=0;C<j.length;C++)te[C]=j[C][0];Z(j=te);break;case 2:for(C=0;C<j.length;C++)Z(j[C]);break;case 3:for(j=function(ue){var xe=ue.length;if(xe<=1)return[ue];for(var ve,ie,_e=[],we=0;we<xe;we++){var Ce=u(ue[we]);0!==Ce&&(void 0===ie&&(ie=Ce<0),ie===Ce<0?(ve&&_e.push(ve),ve=[ue[we]]):ve.push(ue[we]))}return ve&&_e.push(ve),_e}(j),C=0;C<j.length;C++)for(D=0;D<j[C].length;D++)Z(j[C][D])}1===j.length?j=j[0]:K="Multi"+K;var ce={type:"Feature",geometry:{type:K,coordinates:j},properties:this.properties};return"id"in this&&(ce.id=this.id),ce},qb}function V0(){if(zM)return Kg;zM=1;var d=Wb();function o(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(l,this,m),this.length=this._features.length}function l(u,m,v){15===u?m.version=v.readVarint():1===u?m.name=v.readString():5===u?m.extent=v.readVarint():2===u?m._features.push(v.pos):3===u?m._keys.push(v.readString()):4===u&&m._values.push(function(b){for(var C=null,D=b.readVarint()+b.pos;b.pos<D;){var I=b.readVarint()>>3;C=1===I?b.readString():2===I?b.readFloat():3===I?b.readDouble():4===I?b.readVarint64():5===I?b.readVarint():6===I?b.readSVarint():7===I?b.readBoolean():null}return C}(v))}return Kg=o,o.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new d(this._pbf,m,this.extent,this._keys,this._values)},Kg}function Jg(){return Gb||(Gb=1,Qg.VectorTile=function(){if($b)return Yy;$b=1;var d=V0();function o(l,u,m){if(3===l){var v=new d(m,m.readVarint()+m.pos);v.length&&(u[v.name]=v)}}return Yy=function(l,u){this.layers=l.readFields(o,{},u)}}(),Qg.VectorTileFeature=Wb(),Qg.VectorTileLayer=V0()),Qg}var fp=Jg();const mp="3d_elevation_id";class NM{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(o,l){return this._valid&&o(l(this._geometry)),this}require(o,l,u){return this.get(o,!0,l,u)}optional(o,l,u){return this.get(o,!1,l,u)}success(){return this._valid}get(o,l,u,m){const v=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&void 0!==v&&!Number.isNaN(v)?u(m?m(v):v):l&&(this._valid=!1),this}}class Xy{constructor(o,l){this.featureFunc=o,this.vertexFunc=l}parseFeature(o,l,u){return this.featureFunc(o,l,u)}parseVertex(o,l,u){return this.vertexFunc(o,l,u)}}const H0=new Xy((d,o,l)=>d.reset(o).require(mp,u=>{l.id=u}).optional("fixed_height_relative",u=>{l.constantHeight=u},cf.decodeRelativeHeight).geometry(u=>{l.bounds=u},hd).success(),(d,o,l)=>d.reset(o).require(mp,u=>{l.id=u}).require("elevation_idx",u=>{l.idx=u}).require("extent",u=>{l.extent=u}).require("height_relative",u=>{l.height=u},cf.decodeRelativeHeight).geometry(u=>{l.position=u},cf.getPoint).success()),lE=new Xy((d,o,l)=>d.reset(o).require(mp,u=>{l.id=u}).optional("fixed_height",u=>{l.constantHeight=u},cf.decodeMetricHeight).geometry(u=>{l.bounds=u},hd).success(),(d,o,l)=>d.reset(o).require(mp,u=>{l.id=u}).require("elevation_idx",u=>{l.idx=u}).require("extent",u=>{l.extent=u}).require("height",u=>{l.height=u},cf.decodeMetricHeight).geometry(u=>{l.position=u},cf.getPoint).success());class cf{static getPoint(o){return Eo(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static parse(o){const l=[],u=[],m=o.length,v=new NM;for(let C=0;C<m;C++){const D=o.feature(C),I=D.properties.hasOwnProperty("version")?String(D.properties.version):void 0,R=(b=I)?"1.0.1"===b?lE:void 0:H0;if(void 0===R){ci(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const N=D.properties.hasOwnProperty("type")?D.properties.type:void 0;if(N)if("Point"===fp.VectorTileFeature.types[D.type]&&"curve_point"===N){const j={};R.parseVertex(v,D,j)&&l.push(j)}else if("Polygon"===fp.VectorTileFeature.types[D.type]&&"curve_meta"===N){const j={};R.parseFeature(v,D,j)&&u.push(j)}}var b;return{vertices:l,features:u}}}class BM{constructor(o,l){this.feature=o,this.metersToTile=l,this.index=0}get(){const o=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,u=l[1],m=-l[0],v=(o.extent+1)*this.metersToTile;return[new Wt(Math.trunc(o.position[0]+u*v),Math.trunc(o.position[1]+m*v)),new Wt(Math.trunc(o.position[0]-u*v),Math.trunc(o.position[1]-m*v))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Zb{constructor(o,l,u,m,v,b){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=o,this.heightRange={min:u,max:u},this.safeArea=l,this.constantHeight=u,null==this.constantHeight&&(null!=this.constantHeight||0!==m.length)){this.vertices=m,this.edges=v,this.edges=this.edges.filter(C=>{return C.a<this.vertices.length&&C.b<this.vertices.length&&!((D=this.vertices[C.a].position)[0]===(I=this.vertices[C.b].position)[0]&&D[1]===I[1]);var D,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const C of this.vertices)this.vertexProps.push({dir:Eo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,C.height),this.heightRange.max=Math.max(this.heightRange.max,C.height);for(const C of this.edges){const D=this.vertices[C.a].position,I=this.vertices[C.b].position,R=ml(Ss(),I,D),N=Vc(R),j=fc(Ss(),R,1/N);this.edgeProps.push({vec:R,dir:j,len:N});const K=this.vertexProps[C.a].dir,Z=this.vertexProps[C.b].dir;Bc(K,K,j),Bc(Z,Z,j)}for(const C of this.vertexProps)0===C.dir[0]&&0===C.dir[1]||Od(C.dir,C.dir);this.tessellate(b)}}pointElevation(o){if(null!=this.constantHeight)return this.constantHeight;const l=this.getClosestEdge(o);if(null==l)return 0;const[u,m]=l;return(1-(C=m))*this.vertices[this.edges[u].a].height+C*this.vertices[this.edges[u].b].height;var C}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(0===this.edges.length)return;let l=0,u=Number.POSITIVE_INFINITY,m=0;const v=Eo(o.x,o.y);for(let b=0;b<this.edges.length;b++){const C=this.edges[b],D=this.edgeProps[b].dir,I=new Qc(v,this.edgeProps[b].dir),R=this.vertices[C.a].position,N=this.vertices[C.b].position,j=Ss(),K=Ss(),Z=I.intersectsPlane(R,this.vertexProps[C.a].dir,j),te=I.intersectsPlane(N,this.vertexProps[C.b].dir,K);if(!Z||!te)continue;const ce=ml(Ss(),K,j),ue=ml(Ss(),v,j),xe=lr(ce,ce),ve=xe>0?lr(ue,ce)/xe:0,ie=Ge(ve,0,1),_e=Math.abs((ve-ie)*this.edgeProps[b].len),we=ml(Ss(),v,R),Ce=_e+Math.abs(lr(we,Eo(D[1],-D[0])));Ce<u&&(l=b,u=Ce,m=ie)}return[l,m]}tessellate(o){for(let l=this.edges.length-1;l>=0;--l){const u=this.edges[l].a,m=this.edges[l].b,{position:v,height:b,extent:C}=this.vertices[u],{position:D,height:I,extent:R}=this.vertices[m],N=this.vertexProps[u].dir,j=this.vertexProps[m].dir,K=Qn(v[0]/o,v[1]/o,b),Z=Qn(D[0]/o,D[1]/o,I),te=Qn(N[1],-N[0],0);Jn(te,te,C);const ce=Qn(j[1],-j[0],0);if(Jn(ce,ce,R),this.distSqLines(Qn(K[0]+.5*te[0],K[1]+.5*te[1],K[2]+.5*te[2]),Qn(Z[0]-.5*ce[0],Z[1]-.5*ce[1],Z[2]-.5*ce[2]),Qn(K[0]-.5*te[0],K[1]-.5*te[1],K[2]-.5*te[2]),Qn(Z[0]+.5*ce[0],Z[1]+.5*ce[1],Z[2]+.5*ce[2]))<=.0025000000000000005)continue;const ue=this.vertices.length,xe=Bc(Ss(),v,D);this.vertices.push({position:fc(xe,xe,.5),height:.5*(b+I),extent:.5*(C+R)});const ve=Bc(Ss(),N,j);this.vertexProps.push({dir:Od(ve,ve)}),this.edges.splice(l,1),this.edgeProps.splice(l,1),this.edges.push({a:u,b:ue}),this.edges.push({a:ue,b:m});const ie=ml(Ss(),this.vertices[ue].position,v),_e=Vc(ie),we={vec:ie,dir:fc(Ss(),ie,1/_e),len:_e};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(o,l,u,m){const v=gs(Ji(),l,o),b=gs(Ji(),m,u),C=gs(Ji(),o,u),D=ei(v,v),I=ei(v,b),R=ei(v,C),N=ei(b,b),j=ei(b,C),K=D*N-I*I;if(0===K){const ce=ei(C,b)/ei(b,b);return Sr(Lr(Ji(),u,m,ce),o)}const Z=(I*j-R*N)/K,te=(D*j-I*R)/K;return Sr(Lr(Ji(),o,l,Z),Lr(Ji(),u,m,te))}}class Yb{static parseFrom(o,l){const u=cf.parse(o);if(!u)return[];let{vertices:m,features:v}=u;const b=1/Je(l);v.sort((R,N)=>R.id-N.id),m.sort((R,N)=>R.id-N.id||R.idx-N.idx),m=m.filter((R,N,j)=>N===j.findIndex(K=>K.id===R.id&&K.idx===R.idx));const C=new Array;let D=0;const I=m.length;for(const R of v){if(R.constantHeight){C.push(new Zb(R.id,R.bounds,R.constantHeight));continue}for(;D!==I&&m[D].id<R.id;)D++;if(D===I||m[D].id!==R.id)continue;const N=new Array,j=new Array,K=D;for(;D!==I&&m[D].id===R.id;){const Z=m[D];if(N.push({position:Z.position,height:Z.height,extent:Z.extent}),D!==K&&m[D-1].idx===Z.idx-1){const te=D-K;j.push({a:te-1,b:te})}D++}C.push(new Zb(R.id,R.bounds,void 0,N,j,b))}return C}static getElevationFeature(o,l){if(!l)return;const u=+o.properties[mp];return Number.isNaN(u)?void 0:l.find(m=>m.id===u)}}class Xb{constructor(o,l){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(l)||(this.zScale=Math.pow(2,l.z-o.z),this.xOffset=(o.x*this.zScale-l.x)*Xt,this.yOffset=(o.y*this.zScale-l.y)*Xt)}constantElevation(o,l){if(null!=o.constantHeight)return this.computeBiasedHeight(o.constantHeight,l)}pointElevation(o,l,u){return this.constantElevation(l,u)??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(o),u))}computeBiasedHeight(o,l){return l<=0?o:o+l*Ne(0,l,o>=0?o:Math.abs(.5*o))}}ln(Zb,"ElevationFeature");class Kb{constructor(){this.polygons=new Map}add(o,...l){this.polygons.has(o)?this.polygons.get(o).push(...l):this.polygons.set(o,l)}merge(o){for(const[l,u]of o.polygons)this.add(l,...u)}}class Cu{constructor(){this.portals=[]}static evaluate(o){if(0===o.length)return new Cu;let l=[];for(const I of o)l.push(...I.portals);if(0===l.length)return new Cu;const u=(I,R)=>I<=0&&R<=0||I>=Xt&&R>=Xt;for(const I of l){const R=I.va,N=I.vb;(u(R.x,N.x)||u(R.y,N.y))&&(I.type="border")}const m=l.filter(I=>"unevaluated"!==I.type),v=l.filter(I=>"unevaluated"===I.type);if(0===v.length)return new Cu;v.sort((I,R)=>I.hash===R.hash?I.isTunnel===R.isTunnel?0:I.isTunnel?-1:1:I.hash<R.hash?1:-1),l=m.concat(v);let b=m.length,C=b,D=b;do{if(C++,C===l.length||l[b].hash!==l[C].hash){if(C-b==2){D<b&&(l[D]=l[b],l[b]=null);const I=l[D],R=l[C-1];I.type=I.isTunnel!==R.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:R.connection.a},D++}b=C}}while(b!==l.length);return l.splice(D),l.sort((I,R)=>I.hash<R.hash?1:-1),{portals:l}}}ln(Cu,"ElevationPortalGraph"),ln(Kb,"ElevationPolygons");class Qb{constructor(o,l,u){this.outPositions=o,this.outNormals=l,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(o,l,u){let m=o[2];null!=u&&(m*=u);const v=this.getVec3Bits(o)<<96n|this.getVec3Bits(l),b=this.vertexLookup.get(v);if(null!=b)return b;const C=this.outPositions.length;this.vertexLookup.set(v,C);const D=Math.trunc(16384*l[0]),I=Math.trunc(16384*l[1]),R=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(o[0],o[1],m),this.outNormals.emplaceBack(D,I,R),C}addVertices(o,l,...u){const m=[];for(const v of u){const b=this.addVertex(v,o,l);m.push(b)}return m}addTriangles(o,l,u){if(l&&u){const m=1===u.length,v=Qn(0,0,0);for(let b=0;b<o.length;b+=3){const C=l[o[b+0]],D=l[o[b+1]],I=l[o[b+2]],R=m?u[0]:u[o[b+1]],N=m?u[0]:u[o[b+2]],j=this.addVertex(Qn(C.x,C.y,m?u[0]:u[o[b+0]]),v),K=this.addVertex(Qn(D.x,D.y,R),v),Z=this.addVertex(Qn(I.x,I.y,N),v);this.outIndices.emplaceBack(j,K,Z)}}else for(let m=0;m<o.length;m+=3)this.outIndices.emplaceBack(o[m+0],o[m+1],o[m+2])}addQuad(o,l){const u=this.addVertices(l,void 0,...o.map(D=>Qn(D.coord.x,D.coord.y,D.height))),[m,v,b,C]=u;this.addTriangles([m,v,b,b,C,m])}getBits(o){return this.view.setFloat32(0,o),BigInt(this.view.getUint32(0))}getVec3Bits(o){return this.getBits(o[0])<<64n|this.getBits(o[1])<<32n|this.getBits(o[2])}}class Sl{constructor(o){this.unevaluatedPortals=new Cu,this.portalPolygons=new Kb,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new sl,this.vertexNormals=new Cc,this.indexArray=new Qs,this.tileToMeters=Je(o)}addVertices(o,l){const u=this.unevalVertices.length;for(let m=0;m<o.length;m++)this.unevalVertices.push(o[m]),this.unevalHeights.push(l[m]);return u}addTriangles(o,l,u){const m=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const v of o)m.push(v+l)}addRenderableRing(o,l,u,m,v){const b=[new Wt(v.min.x,v.min.y),new Wt(v.max.x,v.min.y),new Wt(v.max.x,v.max.y),new Wt(v.min.x,v.max.y)];for(let C=0;C<u-1;C++){const D=l+C,I=D+1,R=this.unevalVertices[D],N=this.unevalVertices[I];if(!(R.x>=v.min.x&&R.x<=v.max.x&&R.y>=v.min.y&&R.y<=v.max.y||N.x>=v.min.x&&N.x<=v.max.x&&N.y>=v.min.y&&N.y<=v.max.y||Ho(R,N,b))||this.isOnBorder(R.x,N.x)||this.isOnBorder(R.y,N.y))continue;const j=Sl.computeEdgeHash(this.unevalVertices[D],this.unevalVertices[I]);let K,Z=this.vertexHashLookup.get(Sl.computePosHash(R));null!=Z?K=Z.next:(Z=this.vertexHashLookup.get(Sl.computePosHash(N)),K=null!=Z?Z.prev:j),this.unevalEdges.push({polygonIdx:o,a:D,b:I,hash:j,portalHash:K,isTunnel:m,type:"unevaluated"})}}addPortalCandidates(o,l,u,m,v){if(0===l.length)return;this.portalPolygons.add(o,{geometry:l,zLevel:v});const b=l[0];this.vertexHashLookup.clear();let C=Sl.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let D=0;D<b.length-1;D++){const I=b[D+0],R=b[D+1],N=Eo(R.x-I.x,R.y-I.y),j=Vc(N);if(0===j)continue;let K="unevaluated";const Z=m.pointElevation(I),te=m.pointElevation(R);Math.abs(Z)<.01&&Math.abs(te)<.01?K="entrance":(this.isOnBorder(I.x,R.x)||this.isOnBorder(I.y,R.y))&&(K="border");const ce=Sl.computeEdgeHash(I,R);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:I,vb:R,vab:N,length:j,hash:ce,isTunnel:u,type:K});const ue=Sl.computePosHash(I);this.vertexHashLookup.set(ue,{prev:C,next:ce}),C=ce}}construct(o){if(0===this.unevalVertices.length)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},m=new Qb(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const v=l(),b=l(),C=l(),D=(N,j)=>{N.sort((Z,te)=>Z.type===j&&te.type!==j?-1:Z.type!==j&&te.type===j?1:0);const K=N.findIndex(Z=>Z.type!==j);return K>=0?K:N.length};let I=0;this.unevalEdges.length>0&&(I=D(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters));const R=l();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(I),j=D(N,"tunnel")+I;this.unevalEdges.push(...N),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:j})}u(C),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(R),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(b),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(v),this.maskSegments=ro.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.depthSegments=ro.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableSegments=ro.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.shadowCasterSegments=ro.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength)}upload(o){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,nE.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,iE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(o,l,u,m,v){const b=new Map;for(let C=m;C<v;C++){const D=u[C],I=D.a,R=D.b,N=Sl.computePosHash(o[I]),j=Sl.computePosHash(o[R]);b.has(N)||b.set(N,{}),b.has(j)||b.set(j,{});const K=b.get(N),Z=b.get(j);l[I]<=0&&l[R]<=0||(K.to=R,Z.from=I)}return b}constructBridgeStructures(o,l,u,m,v,b){const C=this.computeVertexConnections(l,u,m,v.min,v.max),D=1/b,I=.5*D,R=j=>Qn(l[j].x,l[j].y,u[j]*D),N=j=>{const K=C.get(Sl.computePosHash(l[j])),Z=K.from,te=K.to;if(!Z||!te)return;const ce=R(Z),ue=R(j),xe=R(te),ve=Qn(0,0,0);if(!As(ce,ue)){const _e=Vr(Ji(),ue,ce);Cr(ve,ve,Sn(_e,_e))}if(!As(xe,ue)){const _e=Vr(Ji(),xe,ue);Cr(ve,ve,Sn(_e,_e))}const ie=Id(ve);return ie>0?Jn(ve,ve,1/ie):void 0};for(let j=v.min;j<v.max;j++){const K=m[j],Z=this.prepareEdgePoints(l,u,K,(Qe,Ft)=>Qe>Ft);if(null==Z)continue;const te=Z[0],ce=Z[1],ue=Qn(te.coord.x,te.coord.y,D*te.height),xe=Qn(ce.coord.x,ce.coord.y,D*ce.height);if(As(ue,xe))continue;const ve=Vr(Ji(),xe,ue);Sn(ve,ve);const ie=Qe=>Sn(Qe,Qe),_e=N(K.a)||ve,we=N(K.b)||ve,Ce=ie(Qn(_e[1],-_e[0],0)),ze=ie(Qn(we[1],-we[0],0)),qe=ie(si(Ji(),Ce,_e)),Ze=ie(si(Ji(),ze,we)),Xe=Ji(),pt=[Cr(Ji(),ue,Jn(Xe,Vr(Xe,Ce,qe),I)),Cr(Ji(),ue,Jn(Xe,Cr(Xe,Ce,qe),I)),Cr(Ji(),ue,Jn(Xe,qe,I)),ue],Rt=[Cr(Ji(),xe,Jn(Xe,Vr(Xe,ze,Ze),I)),Cr(Ji(),xe,Jn(Xe,Cr(Xe,ze,Ze),I)),Cr(Ji(),xe,Jn(Xe,Ze,I)),xe],[Mt,Tt]=o.addVertices(Ce,b,pt[0],pt[1]),[Nt,ut]=o.addVertices(ze,b,Rt[0],Rt[1]);o.addTriangles([Mt,Tt,Nt,Tt,ut,Nt]);const[Et,lt]=o.addVertices(qe,b,pt[1],pt[2]),[gt,Bt]=o.addVertices(Ze,b,Rt[1],Rt[2]);o.addTriangles([Et,lt,gt,lt,Bt,gt]);const[q,gn]=o.addVertices(Bo(Ce,Ce),b,pt[2],pt[3]),[hn,Kt]=o.addVertices(Bo(ze,ze),b,Rt[2],Rt[3]);o.addTriangles([q,gn,hn,gn,Kt,hn])}}constructTunnelStructures(o,l,u,m,v,b){const C=D=>Sn(D,D);for(let D=v.min;D<v.max;D++){const I=this.prepareEdgePoints(l,u,m[D],(K,Z)=>K<Z);if(null==I)continue;const[R,N]=I,j=C(Qn(N.coord.y-R.coord.y,-(N.coord.x-R.coord.x),0));o.addQuad([R,N,{coord:N.coord,height:m[D].isTunnel?-.1:0},{coord:R.coord,height:m[D].isTunnel?-.1:0}],j)}for(let D=b.min;D<b.max;D++){const I=m[D],R=l[I.a],N=l[I.b],j=C(Qn(N.y-R.y,-(N.x-R.x),0));o.addQuad([{coord:N,height:0},{coord:R,height:0},{coord:R,height:u[I.a]+4},{coord:N,height:u[I.b]+4}],j),o.addQuad([{coord:R,height:0},{coord:N,height:0},{coord:N,height:u[I.b]+4},{coord:R,height:u[I.a]+4}],j)}}prepareEdgePoints(o,l,u,m){let v=l[u.a],b=l[u.b];const C=m(v,0),D=m(b,0);if(C&&D)return[{coord:o[u.a],height:v},{coord:o[u.b],height:b}];if(!C&&!D)return;const I=o[u.a].clone(),R=o[u.b].clone();if(C){if(!D){const N=b/(b-v);R.x=Cn(R.x,I.x,N),R.y=Cn(R.y,I.y,N),b=Cn(b,v,N)}}else{const N=v/(v-b);I.x=Cn(I.x,R.x,N),I.y=Cn(I.y,R.y,N),v=Cn(v,b,N)}return[{coord:I,height:v},{coord:R,height:b}]}prepareEdges(o,l){if(0===l.length)return;l.sort((C,D)=>C.hash===D.hash?D.polygonIdx-C.polygonIdx:D.hash>C.hash?1:-1);let u=0,m=0,v=0,b=l[u].polygonIdx;do{m++,(m===l.length||l[u].hash!==l[m].hash)&&((m-u==1||l[m-1].polygonIdx!==b)&&(v<u&&(l[v]=l[u],l[u]=null),l[v].type="none",v++),u=m,u!==l.length&&(b=l[u].polygonIdx))}while(u!==l.length);if(l.splice(v),0!==l.length&&0!==o.length){l.sort((I,R)=>I.portalHash<R.portalHash?1:-1);let C=0,D=0;for(;C!==l.length&&D!==o.length;){const I=l[C],R=o[D];I.portalHash>R.hash?C++:R.hash>I.portalHash?D++:(I.type=R.type,C++)}}}isOnBorder(o,l){return o<=0&&l<=0||o>=Xt&&l>=Xt}static computeEdgeHash(o,l){return(o.y===l.y&&o.x>l.x||o.y>l.y)&&([o,l]=[l,o]),BigInt(Sl.computePosHash(o))<<32n|BigInt(Sl.computePosHash(l))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}var VM,jM={exports:{}},cE=(VM||(VM=1,function(l){function u(ke,Se){return ke>Se?1:ke<Se?-1:0}var m=function(ke,Se){void 0===ke&&(ke=u),void 0===Se&&(Se=!1),this._compare=ke,this._root=null,this._size=0,this._noDuplicates=!!Se},v={size:{configurable:!0}};function b(ke,Se,_t,$t,en){var Jt=en-$t;if(Jt>0){var _n=$t+Math.floor(Jt/2),Fn={key:Se[_n],data:_t[_n],parent:ke};return Fn.left=b(Fn,Se,_t,$t,_n),Fn.right=b(Fn,Se,_t,_n+1,en),Fn}return null}function C(ke,Se,_t,$t,en){if(!(_t>=$t)){for(var Jt=ke[_t+$t>>1],_n=_t-1,Fn=$t+1;;){do{_n++}while(en(ke[_n],Jt)<0);do{Fn--}while(en(ke[Fn],Jt)>0);if(_n>=Fn)break;var Di=ke[_n];ke[_n]=ke[Fn],ke[Fn]=Di,Di=Se[_n],Se[_n]=Se[Fn],Se[Fn]=Di}C(ke,Se,_t,Fn,en),C(ke,Se,Fn+1,$t,en)}}m.prototype.rotateLeft=function(ke){var Se=ke.right;Se&&(ke.right=Se.left,Se.left&&(Se.left.parent=ke),Se.parent=ke.parent),ke.parent?ke===ke.parent.left?ke.parent.left=Se:ke.parent.right=Se:this._root=Se,Se&&(Se.left=ke),ke.parent=Se},m.prototype.rotateRight=function(ke){var Se=ke.left;Se&&(ke.left=Se.right,Se.right&&(Se.right.parent=ke),Se.parent=ke.parent),ke.parent?ke===ke.parent.left?ke.parent.left=Se:ke.parent.right=Se:this._root=Se,Se&&(Se.right=ke),ke.parent=Se},m.prototype._splay=function(ke){for(;ke.parent;){var Se=ke.parent;Se.parent?Se.left===ke&&Se.parent.left===Se?(this.rotateRight(Se.parent),this.rotateRight(Se)):Se.right===ke&&Se.parent.right===Se?(this.rotateLeft(Se.parent),this.rotateLeft(Se)):Se.left===ke&&Se.parent.right===Se?(this.rotateRight(Se),this.rotateLeft(Se)):(this.rotateLeft(Se),this.rotateRight(Se)):Se.left===ke?this.rotateRight(Se):this.rotateLeft(Se)}},m.prototype.splay=function(ke){for(var Se,_t,$t,en,Jt;ke.parent;)(_t=(Se=ke.parent).parent)&&_t.parent?(($t=_t.parent).left===_t?$t.left=ke:$t.right=ke,ke.parent=$t):(ke.parent=null,this._root=ke),en=ke.left,Jt=ke.right,ke===Se.left?(_t&&(_t.left===Se?(Se.right?(_t.left=Se.right,_t.left.parent=_t):_t.left=null,Se.right=_t,_t.parent=Se):(en?(_t.right=en,en.parent=_t):_t.right=null,ke.left=_t,_t.parent=ke)),Jt?(Se.left=Jt,Jt.parent=Se):Se.left=null,ke.right=Se,Se.parent=ke):(_t&&(_t.right===Se?(Se.left?(_t.right=Se.left,_t.right.parent=_t):_t.right=null,Se.left=_t,_t.parent=Se):(Jt?(_t.left=Jt,Jt.parent=_t):_t.left=null,ke.right=_t,_t.parent=ke)),en?(Se.right=en,en.parent=Se):Se.right=null,ke.left=Se,Se.parent=ke)},m.prototype.replace=function(ke,Se){ke.parent?ke===ke.parent.left?ke.parent.left=Se:ke.parent.right=Se:this._root=Se,Se&&(Se.parent=ke.parent)},m.prototype.minNode=function(ke){if(void 0===ke&&(ke=this._root),ke)for(;ke.left;)ke=ke.left;return ke},m.prototype.maxNode=function(ke){if(void 0===ke&&(ke=this._root),ke)for(;ke.right;)ke=ke.right;return ke},m.prototype.insert=function(ke,Se){var _t=this._root,$t=null,en=this._compare;if(this._noDuplicates)for(;_t;){if($t=_t,0===en(_t.key,ke))return;_t=en(_t.key,ke)<0?_t.right:_t.left}else for(;_t;)$t=_t,_t=en(_t.key,ke)<0?_t.right:_t.left;return _t={key:ke,data:Se,left:null,right:null,parent:$t},$t?en($t.key,_t.key)<0?$t.right=_t:$t.left=_t:this._root=_t,this.splay(_t),this._size++,_t},m.prototype.find=function(ke){for(var Se=this._root,_t=this._compare;Se;){var $t=_t(Se.key,ke);if($t<0)Se=Se.right;else{if(!($t>0))return Se;Se=Se.left}}return null},m.prototype.contains=function(ke){for(var Se=this._root,_t=this._compare;Se;){var $t=_t(ke,Se.key);if(0===$t)return!0;Se=$t<0?Se.left:Se.right}return!1},m.prototype.remove=function(ke){var Se=this.find(ke);if(!Se)return!1;if(this.splay(Se),Se.left)if(Se.right){var _t=this.minNode(Se.right);_t.parent!==Se&&(this.replace(_t,_t.right),_t.right=Se.right,_t.right.parent=_t),this.replace(Se,_t),_t.left=Se.left,_t.left.parent=_t}else this.replace(Se,Se.left);else this.replace(Se,Se.right);return this._size--,!0},m.prototype.removeNode=function(ke){if(!ke)return!1;if(this.splay(ke),ke.left)if(ke.right){var Se=this.minNode(ke.right);Se.parent!==ke&&(this.replace(Se,Se.right),Se.right=ke.right,Se.right.parent=Se),this.replace(ke,Se),Se.left=ke.left,Se.left.parent=Se}else this.replace(ke,ke.left);else this.replace(ke,ke.right);return this._size--,!0},m.prototype.erase=function(ke){var Se=this.find(ke);if(Se){this.splay(Se);var _t=Se.left,$t=Se.right,en=null;_t&&(_t.parent=null,en=this.maxNode(_t),this.splay(en),this._root=en),$t&&(_t?en.right=$t:this._root=$t,$t.parent=en),this._size--}},m.prototype.pop=function(){var ke=this._root,Se=null;if(ke){for(;ke.left;)ke=ke.left;Se={key:ke.key,data:ke.data},this.remove(ke.key)}return Se},m.prototype.next=function(ke){var Se=ke;if(Se)if(Se.right)for(Se=Se.right;Se&&Se.left;)Se=Se.left;else for(Se=ke.parent;Se&&Se.right===ke;)ke=Se,Se=Se.parent;return Se},m.prototype.prev=function(ke){var Se=ke;if(Se)if(Se.left)for(Se=Se.left;Se&&Se.right;)Se=Se.right;else for(Se=ke.parent;Se&&Se.left===ke;)ke=Se,Se=Se.parent;return Se},m.prototype.forEach=function(ke){for(var Se=this._root,_t=[],$t=!1,en=0;!$t;)Se?(_t.push(Se),Se=Se.left):_t.length>0?(ke(Se=_t.pop(),en++),Se=Se.right):$t=!0;return this},m.prototype.range=function(ke,Se,_t,$t){for(var en=[],Jt=this._compare,_n=this._root;0!==en.length||_n;)if(_n)en.push(_n),_n=_n.left;else{if(Jt((_n=en.pop()).key,Se)>0)break;if(Jt(_n.key,ke)>=0&&_t.call($t,_n))return this;_n=_n.right}return this},m.prototype.keys=function(){for(var ke=this._root,Se=[],_t=[],$t=!1;!$t;)ke?(Se.push(ke),ke=ke.left):Se.length>0?(ke=Se.pop(),_t.push(ke.key),ke=ke.right):$t=!0;return _t},m.prototype.values=function(){for(var ke=this._root,Se=[],_t=[],$t=!1;!$t;)ke?(Se.push(ke),ke=ke.left):Se.length>0?(ke=Se.pop(),_t.push(ke.data),ke=ke.right):$t=!0;return _t},m.prototype.at=function(ke){for(var Se=this._root,_t=[],$t=!1,en=0;!$t;)if(Se)_t.push(Se),Se=Se.left;else if(_t.length>0){if(Se=_t.pop(),en===ke)return Se;en++,Se=Se.right}else $t=!0;return null},m.prototype.load=function(ke,Se,_t){if(void 0===ke&&(ke=[]),void 0===Se&&(Se=[]),void 0===_t&&(_t=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var $t=ke.length;return _t&&C(ke,Se,0,$t-1,this._compare),this._root=b(null,ke,Se,0,$t),this._size=$t,this},m.prototype.min=function(){var ke=this.minNode(this._root);return ke?ke.key:null},m.prototype.max=function(){var ke=this.maxNode(this._root);return ke?ke.key:null},m.prototype.isEmpty=function(){return null===this._root},v.size.get=function(){return this._size},m.createTree=function(ke,Se,_t,$t,en){return new m(_t,en).load(ke,Se,$t)},Object.defineProperties(m.prototype,v);var D=0,I=1,R=2,N=3,j=0,K=1,Z=2,te=3;function ce(ke,Se,_t){null===Se?(ke.inOut=!1,ke.otherInOut=!0):(ke.isSubject===Se.isSubject?(ke.inOut=!Se.inOut,ke.otherInOut=Se.otherInOut):(ke.inOut=!Se.otherInOut,ke.otherInOut=Se.isVertical()?!Se.inOut:Se.inOut),Se&&(ke.prevInResult=!ue(Se,_t)||Se.isVertical()?Se.prevInResult:Se));var $t=ue(ke,_t);ke.resultTransition=$t?function(en,Jt){var _n,Fn=!en.inOut,Di=!en.otherInOut;switch(Jt){case j:_n=Fn&&Di;break;case K:_n=Fn||Di;break;case te:_n=Fn^Di;break;case Z:_n=en.isSubject?Fn&&!Di:Di&&!Fn}return _n?1:-1}(ke,_t):0}function ue(ke,Se){switch(ke.type){case D:switch(Se){case j:return!ke.otherInOut;case K:return ke.otherInOut;case Z:return ke.isSubject&&ke.otherInOut||!ke.isSubject&&!ke.otherInOut;case te:return!0}break;case R:return Se===j||Se===K;case N:return Se===Z;case I:return!1}return!1}var xe=function(ke,Se,_t,$t,en){this.left=Se,this.point=ke,this.otherEvent=_t,this.isSubject=$t,this.type=en||D,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ve={inResult:{configurable:!0}};function ie(ke,Se){return ke[0]===Se[0]&&ke[1]===Se[1]}xe.prototype.isBelow=function(ke){var Se=this.point,_t=this.otherEvent.point;return this.left?(Se[0]-ke[0])*(_t[1]-ke[1])-(_t[0]-ke[0])*(Se[1]-ke[1])>0:(_t[0]-ke[0])*(Se[1]-ke[1])-(Se[0]-ke[0])*(_t[1]-ke[1])>0},xe.prototype.isAbove=function(ke){return!this.isBelow(ke)},xe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ve.inResult.get=function(){return 0!==this.resultTransition},xe.prototype.clone=function(){var ke=new xe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ke.contourId=this.contourId,ke.resultTransition=this.resultTransition,ke.prevInResult=this.prevInResult,ke.isExteriorRing=this.isExteriorRing,ke.inOut=this.inOut,ke.otherInOut=this.otherInOut,ke},Object.defineProperties(xe.prototype,ve);var _e=11102230246251565e-32,we=134217729,Ce=(3+8*_e)*_e;function ze(ke,Se,_t,$t,en){var Jt,_n,Fn,Di,Ti=Se[0],hi=$t[0],ur=0,zr=0;hi>Ti==hi>-Ti?(Jt=Ti,Ti=Se[++ur]):(Jt=hi,hi=$t[++zr]);var Ai=0;if(ur<ke&&zr<_t)for(hi>Ti==hi>-Ti?(Fn=Jt-((_n=Ti+Jt)-Ti),Ti=Se[++ur]):(Fn=Jt-((_n=hi+Jt)-hi),hi=$t[++zr]),Jt=_n,0!==Fn&&(en[Ai++]=Fn);ur<ke&&zr<_t;)hi>Ti==hi>-Ti?(Fn=Jt-((_n=Jt+Ti)-(Di=_n-Jt))+(Ti-Di),Ti=Se[++ur]):(Fn=Jt-((_n=Jt+hi)-(Di=_n-Jt))+(hi-Di),hi=$t[++zr]),Jt=_n,0!==Fn&&(en[Ai++]=Fn);for(;ur<ke;)Fn=Jt-((_n=Jt+Ti)-(Di=_n-Jt))+(Ti-Di),Ti=Se[++ur],Jt=_n,0!==Fn&&(en[Ai++]=Fn);for(;zr<_t;)Fn=Jt-((_n=Jt+hi)-(Di=_n-Jt))+(hi-Di),hi=$t[++zr],Jt=_n,0!==Fn&&(en[Ai++]=Fn);return 0===Jt&&0!==Ai||(en[Ai++]=Jt),Ai}function qe(ke){return new Float64Array(ke)}var Ze=33306690738754716e-32,Xe=22204460492503146e-32,pt=11093356479670487e-47,Rt=qe(4),Mt=qe(8),Tt=qe(12),Nt=qe(16),ut=qe(4);function Et(ke,Se,_t){var $t=function(en,Jt,_n,Fn,Di,Ti){var hi=(Jt-Ti)*(_n-Di),ur=(en-Di)*(Fn-Ti),zr=hi-ur;if(0===hi||0===ur||hi>0!=ur>0)return zr;var Ai=Math.abs(hi+ur);return Math.abs(zr)>=Ze*Ai?zr:-function(bo,qr,or,Fo,$r,Pr,Nr){var pr,mi,vr,mo,In,$i,br,zo,to,Zo,Ir,Br,td,Wa,za,nd,xo,Ts,Js=bo-$r,cl=or-$r,da=qr-Pr,El=Fo-Pr;Rt[0]=(za=(zo=Js-(br=($i=we*Js)-($i-Js)))*(Zo=El-(to=($i=we*El)-($i-El)))-((Wa=Js*El)-br*to-zo*to-br*Zo))-((Ir=za-(xo=(zo=da-(br=($i=we*da)-($i-da)))*(Zo=cl-(to=($i=we*cl)-($i-cl)))-((nd=da*cl)-br*to-zo*to-br*Zo)))+(In=za-Ir))+(In-xo),Rt[1]=(td=Wa-((Br=Wa+Ir)-(In=Br-Wa))+(Ir-In))-((Ir=td-nd)+(In=td-Ir))+(In-nd),Rt[2]=Br-((Ts=Br+Ir)-(In=Ts-Br))+(Ir-In),Rt[3]=Ts;var $h=function(dD,S3){for(var Cw=S3[0],f2=1;f2<4;f2++)Cw+=S3[f2];return Cw}(0,Rt),Sf=Xe*Nr;if($h>=Sf||-$h>=Sf||(pr=bo-(Js+(In=bo-Js))+(In-$r),vr=or-(cl+(In=or-cl))+(In-$r),mi=qr-(da+(In=qr-da))+(In-Pr),mo=Fo-(El+(In=Fo-El))+(In-Pr),0===pr&&0===mi&&0===vr&&0===mo)||(Sf=pt*Nr+Ce*Math.abs($h),($h+=Js*mo+El*pr-(da*vr+cl*mi))>=Sf||-$h>=Sf))return $h;ut[0]=(za=(zo=pr-(br=($i=we*pr)-($i-pr)))*(Zo=El-(to=($i=we*El)-($i-El)))-((Wa=pr*El)-br*to-zo*to-br*Zo))-((Ir=za-(xo=(zo=mi-(br=($i=we*mi)-($i-mi)))*(Zo=cl-(to=($i=we*cl)-($i-cl)))-((nd=mi*cl)-br*to-zo*to-br*Zo)))+(In=za-Ir))+(In-xo),ut[1]=(td=Wa-((Br=Wa+Ir)-(In=Br-Wa))+(Ir-In))-((Ir=td-nd)+(In=td-Ir))+(In-nd),ut[2]=Br-((Ts=Br+Ir)-(In=Ts-Br))+(Ir-In),ut[3]=Ts;var Md=ze(4,Rt,4,ut,Mt);ut[0]=(za=(zo=Js-(br=($i=we*Js)-($i-Js)))*(Zo=mo-(to=($i=we*mo)-($i-mo)))-((Wa=Js*mo)-br*to-zo*to-br*Zo))-((Ir=za-(xo=(zo=da-(br=($i=we*da)-($i-da)))*(Zo=vr-(to=($i=we*vr)-($i-vr)))-((nd=da*vr)-br*to-zo*to-br*Zo)))+(In=za-Ir))+(In-xo),ut[1]=(td=Wa-((Br=Wa+Ir)-(In=Br-Wa))+(Ir-In))-((Ir=td-nd)+(In=td-Ir))+(In-nd),ut[2]=Br-((Ts=Br+Ir)-(In=Ts-Br))+(Ir-In),ut[3]=Ts;var K6=ze(Md,Mt,4,ut,Tt);ut[0]=(za=(zo=pr-(br=($i=we*pr)-($i-pr)))*(Zo=mo-(to=($i=we*mo)-($i-mo)))-((Wa=pr*mo)-br*to-zo*to-br*Zo))-((Ir=za-(xo=(zo=mi-(br=($i=we*mi)-($i-mi)))*(Zo=vr-(to=($i=we*vr)-($i-vr)))-((nd=mi*vr)-br*to-zo*to-br*Zo)))+(In=za-Ir))+(In-xo),ut[1]=(td=Wa-((Br=Wa+Ir)-(In=Br-Wa))+(Ir-In))-((Ir=td-nd)+(In=td-Ir))+(In-nd),ut[2]=Br-((Ts=Br+Ir)-(In=Ts-Br))+(Ir-In),ut[3]=Ts;var C3=ze(K6,Tt,4,ut,Nt);return Nt[C3-1]}(en,Jt,_n,Fn,Di,Ti,Ai)}(ke[0],ke[1],Se[0],Se[1],_t[0],_t[1]);return $t>0?-1:$t<0?1:0}function lt(ke,Se){var en,Jt,_t=ke.point,$t=Se.point;return _t[0]>$t[0]?1:_t[0]<$t[0]?-1:_t[1]!==$t[1]?_t[1]>$t[1]?1:-1:(en=ke).left!==(Jt=Se).left?en.left?1:-1:0!==Et(_t,en.otherEvent.point,Jt.otherEvent.point)?en.isBelow(Jt.otherEvent.point)?-1:1:!en.isSubject&&Jt.isSubject?1:-1}function gt(ke,Se,_t){var $t=new xe(Se,!1,ke,ke.isSubject),en=new xe(Se,!0,ke.otherEvent,ke.isSubject);return ie(ke.point,ke.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ke),$t.contourId=en.contourId=ke.contourId,lt(en,ke.otherEvent)>0&&(ke.otherEvent.left=!0,en.left=!1),ke.otherEvent.otherEvent=en,ke.otherEvent=$t,_t.push(en),_t.push($t),_t}function Bt(ke,Se){return ke[0]*Se[1]-ke[1]*Se[0]}function q(ke,Se){return ke[0]*Se[0]+ke[1]*Se[1]}function gn(ke,Se,_t){var $t=function(Di,Ti,hi,ur,zr){var Ai=[Ti[0]-Di[0],Ti[1]-Di[1]],bo=[ur[0]-hi[0],ur[1]-hi[1]];function qr($i,br,zo){return[$i[0]+br*zo[0],$i[1]+br*zo[1]]}var or=[hi[0]-Di[0],hi[1]-Di[1]],Fo=Bt(Ai,bo),$r=Fo*Fo,Pr=q(Ai,Ai);if($r>0){var Nr=Bt(or,bo)/Fo;if(Nr<0||Nr>1)return null;var pr=Bt(or,Ai)/Fo;return pr<0||pr>1?null:0===Nr||1===Nr?[qr(Di,Nr,Ai)]:0===pr||1===pr?[qr(hi,pr,bo)]:[qr(Di,Nr,Ai)]}if(($r=(Fo=Bt(or,Ai))*Fo)>0)return null;var mi=q(Ai,or)/Pr,vr=mi+q(Ai,bo)/Pr,mo=Math.min(mi,vr),In=Math.max(mi,vr);return mo<=1&&In>=0?1===mo?[qr(Di,mo>0?mo:0,Ai)]:0===In?[qr(Di,In<1?In:1,Ai)]:[qr(Di,mo>0?mo:0,Ai),qr(Di,In<1?In:1,Ai)]:null}(ke.point,ke.otherEvent.point,Se.point,Se.otherEvent.point),en=$t?$t.length:0;if(0===en||1===en&&(ie(ke.point,Se.point)||ie(ke.otherEvent.point,Se.otherEvent.point))||2===en&&ke.isSubject===Se.isSubject)return 0;if(1===en)return ie(ke.point,$t[0])||ie(ke.otherEvent.point,$t[0])||gt(ke,$t[0],_t),ie(Se.point,$t[0])||ie(Se.otherEvent.point,$t[0])||gt(Se,$t[0],_t),1;var Jt=[],_n=!1,Fn=!1;return ie(ke.point,Se.point)?_n=!0:1===lt(ke,Se)?Jt.push(Se,ke):Jt.push(ke,Se),ie(ke.otherEvent.point,Se.otherEvent.point)?Fn=!0:1===lt(ke.otherEvent,Se.otherEvent)?Jt.push(Se.otherEvent,ke.otherEvent):Jt.push(ke.otherEvent,Se.otherEvent),_n&&Fn||_n?(Se.type=I,ke.type=Se.inOut===ke.inOut?R:N,_n&&!Fn&&gt(Jt[1].otherEvent,Jt[0].point,_t),2):Fn?(gt(Jt[0],Jt[1].point,_t),3):Jt[0]!==Jt[3].otherEvent?(gt(Jt[0],Jt[1].point,_t),gt(Jt[1],Jt[2].point,_t),3):(gt(Jt[0],Jt[1].point,_t),gt(Jt[3].otherEvent,Jt[2].point,_t),3)}function hn(ke,Se){if(ke===Se)return 0;if(0!==Et(ke.point,ke.otherEvent.point,Se.point)||0!==Et(ke.point,ke.otherEvent.point,Se.otherEvent.point))return ie(ke.point,Se.point)?ke.isBelow(Se.otherEvent.point)?-1:1:ke.point[0]===Se.point[0]?ke.point[1]<Se.point[1]?-1:1:1===lt(ke,Se)?Se.isAbove(ke.point)?-1:1:ke.isBelow(Se.point)?-1:1;if(ke.isSubject!==Se.isSubject)return ke.isSubject?-1:1;var _t=ke.point,$t=Se.point;return _t[0]===$t[0]&&_t[1]===$t[1]?(_t=ke.otherEvent.point)[0]===($t=Se.otherEvent.point)[0]&&_t[1]===$t[1]?0:ke.contourId>Se.contourId?1:-1:1===lt(ke,Se)?1:-1}var Kt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Qe(ke,Se,_t,$t){var en,Jt=ke+1,_n=Se[ke].point,Fn=Se.length;for(Jt<Fn&&(en=Se[Jt].point);Jt<Fn&&en[0]===_n[0]&&en[1]===_n[1];){if(!_t[Jt])return Jt;++Jt<Fn&&(en=Se[Jt].point)}for(Jt=ke-1;_t[Jt]&&Jt>$t;)Jt--;return Jt}Kt.prototype.isExterior=function(){return null==this.holeOf};var Ft=un,Yt=un;function un(ke,Se){if(!(this instanceof un))return new un(ke,Se);if(this.data=ke||[],this.length=this.data.length,this.compare=Se||Bn,this.length>0)for(var _t=(this.length>>1)-1;_t>=0;_t--)this._down(_t)}function Bn(ke,Se){return ke<Se?-1:ke>Se?1:0}un.prototype={push:function(ke){this.data.push(ke),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var ke=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ke}},peek:function(){return this.data[0]},_up:function(ke){for(var Se=this.data,_t=this.compare,$t=Se[ke];ke>0;){var en=ke-1>>1,Jt=Se[en];if(_t($t,Jt)>=0)break;Se[ke]=Jt,ke=en}Se[ke]=$t},_down:function(ke){for(var Se=this.data,_t=this.compare,$t=this.length>>1,en=Se[ke];ke<$t;){var Jt=1+(ke<<1),_n=Jt+1,Fn=Se[Jt];if(_n<this.length&&_t(Se[_n],Fn)<0&&(Jt=_n,Fn=Se[_n]),_t(Fn,en)>=0)break;Se[ke]=Fn,ke=Jt}Se[ke]=en}},Ft.default=Yt;var Kn=Math.max,ri=Math.min,_i=0;function di(ke,Se,_t,$t,en,Jt){var _n,Fn,Di,Ti,hi,ur;for(_n=0,Fn=ke.length-1;_n<Fn;_n++)if(Ti=ke[_n+1],hi=new xe(Di=ke[_n],!1,void 0,Se),ur=new xe(Ti,!1,hi,Se),hi.otherEvent=ur,Di[0]!==Ti[0]||Di[1]!==Ti[1]){hi.contourId=ur.contourId=_t,Jt||(hi.isExteriorRing=!1,ur.isExteriorRing=!1),lt(hi,ur)>0?ur.left=!0:hi.left=!0;var zr=Di[0],Ai=Di[1];en[0]=ri(en[0],zr),en[1]=ri(en[1],Ai),en[2]=Kn(en[2],zr),en[3]=Kn(en[3],Ai),$t.push(hi),$t.push(ur)}}var li=[];function Dr(ke,Se,_t){"number"==typeof ke[0][0][0]&&(ke=[ke]),"number"==typeof Se[0][0][0]&&(Se=[Se]);var Ai,bo,qr,or,$t=(qr=_t,or=null,(Ai=ke).length*(bo=Se).length==0&&(qr===j?or=li:qr===Z?or=Ai:qr!==K&&qr!==te||(or=0===Ai.length?bo:Ai)),or);if($t)return $t===li?null:$t;var en=[1/0,1/0,-1/0,-1/0],Jt=[1/0,1/0,-1/0,-1/0],_n=function(Ai,bo,qr,or,Fo){var $r,Pr,Nr,pr,mi,vr,mo=new Ft(null,lt);for(Nr=0,pr=Ai.length;Nr<pr;Nr++)for(mi=0,vr=($r=Ai[Nr]).length;mi<vr;mi++)(Pr=0===mi)&&_i++,di($r[mi],!0,_i,mo,qr,Pr);for(Nr=0,pr=bo.length;Nr<pr;Nr++)for(mi=0,vr=($r=bo[Nr]).length;mi<vr;mi++)Pr=0===mi,Fo===Z&&(Pr=!1),Pr&&_i++,di($r[mi],!1,_i,mo,or,Pr);return mo}(ke,Se,en,Jt,_t);if($t=function(Ai,bo,qr,or,Fo){var $r=null;return(qr[0]>or[2]||or[0]>qr[2]||qr[1]>or[3]||or[1]>qr[3])&&(Fo===j?$r=li:Fo===Z?$r=Ai:Fo!==K&&Fo!==te||($r=Ai.concat(bo))),$r}(ke,Se,en,Jt,_t))return $t===li?null:$t;for(var Fn=function(Ai){var bo,qr,or=function(Nr){var pr,mi,vr,mo,In=[];for(mi=0,vr=Nr.length;mi<vr;mi++)((pr=Nr[mi]).left&&pr.inResult||!pr.left&&pr.otherEvent.inResult)&&In.push(pr);for(var $i=!1;!$i;)for($i=!0,mi=0,vr=In.length;mi<vr;mi++)mi+1<vr&&1===lt(In[mi],In[mi+1])&&(mo=In[mi],In[mi]=In[mi+1],In[mi+1]=mo,$i=!1);for(mi=0,vr=In.length;mi<vr;mi++)(pr=In[mi]).otherPos=mi;for(mi=0,vr=In.length;mi<vr;mi++)(pr=In[mi]).left||(mo=pr.otherPos,pr.otherPos=pr.otherEvent.otherPos,pr.otherEvent.otherPos=mo);return In}(Ai),Fo={},$r=[],Pr=function(){if(!Fo[bo]){var Nr=$r.length,pr=function(In,$i,br){var zo=new Kt;if(null!=In.prevInResult){var to=In.prevInResult,Zo=to.outputContourId;if(to.resultTransition>0){var Ir=$i[Zo];if(null!=Ir.holeOf){var Br=Ir.holeOf;$i[Br].holeIds.push(br),zo.holeOf=Br,zo.depth=$i[Zo].depth}else $i[Zo].holeIds.push(br),zo.holeOf=Zo,zo.depth=$i[Zo].depth+1}else zo.holeOf=null,zo.depth=$i[Zo].depth}else zo.holeOf=null,zo.depth=0;return zo}(or[bo],$r,Nr),mi=function(In){Fo[In]=!0,In<or.length&&or[In]&&(or[In].outputContourId=Nr)},vr=bo,mo=bo;for(pr.points.push(or[bo].point);mi(vr),mi(vr=or[vr].otherPos),pr.points.push(or[vr].point),!((vr=Qe(vr,or,Fo,mo))==mo||vr>=or.length)&&or[vr];);$r.push(pr)}};for(bo=0,qr=or.length;bo<qr;bo++)Pr();return $r}(function(Ai,bo,qr,or,Fo,$r){for(var Pr,Nr,pr,mi=new m(hn),vr=[],mo=Math.min(or[2],Fo[2]);0!==Ai.length;){var In=Ai.pop();if(vr.push(In),$r===j&&In.point[0]>mo||$r===Z&&In.point[0]>or[2])break;if(In.left){Nr=Pr=mi.insert(In),Pr=Pr!==(pr=mi.minNode())?mi.prev(Pr):null,Nr=mi.next(Nr);var $i=Pr?Pr.key:null;if(ce(In,$i,$r),Nr&&2===gn(In,Nr.key,Ai)&&(ce(In,$i,$r),ce(Nr.key,In,$r)),Pr&&2===gn(Pr.key,In,Ai)){var br=Pr;ce($i,(br=br!==pr?mi.prev(br):null)?br.key:null,$r),ce(In,$i,$r)}}else Nr=Pr=mi.find(In=In.otherEvent),Pr&&Nr&&(Pr=Pr!==pr?mi.prev(Pr):null,Nr=mi.next(Nr),mi.remove(In),Nr&&Pr&&gn(Pr.key,Nr.key,Ai))}return vr}(_n,0,0,en,Jt,_t)),Di=[],Ti=0;Ti<Fn.length;Ti++){var hi=Fn[Ti];if(hi.isExterior()){for(var ur=[hi.points],zr=0;zr<hi.holeIds.length;zr++)ur.push(Fn[hi.holeIds[zr]].points);Di.push(ur)}}return Di}var Ur={UNION:K,DIFFERENCE:Z,INTERSECTION:j,XOR:te};l.diff=function(ke,Se){return Dr(ke,Se,Z)},l.intersection=function(ke,Se){return Dr(ke,Se,j)},l.operations=Ur,l.union=function(ke,Se){return Dr(ke,Se,K)},l.xor=function(ke,Se){return Dr(ke,Se,te)},Object.defineProperty(l,"__esModule",{value:!0})}(jM.exports)),jM.exports);function Ky(d,o,l,u){const m=[],v=0===u?(b,C,D,I,R,N)=>{b.push(new Wt(N,D+(N-C)/(I-C)*(R-D)))}:(b,C,D,I,R,N)=>{b.push(new Wt(C+(N-D)/(R-D)*(I-C),N))};for(const b of d){const C=[];for(const D of b){if(D.length<=2)continue;const I=[];for(let j=0;j<D.length-1;j++){const K=D[j].x,Z=D[j].y,te=D[j+1].x,ce=D[j+1].y,ue=0===u?K:Z,xe=0===u?te:ce;ue<o?xe>o&&v(I,K,Z,te,ce,o):ue>l?xe<l&&v(I,K,Z,te,ce,l):I.push(D[j]),xe<o&&ue>=o&&v(I,K,Z,te,ce,o),xe>l&&ue<=l&&v(I,K,Z,te,ce,l)}let R=D[D.length-1];const N=0===u?R.x:R.y;N>=o&&N<=l&&I.push(R),I.length&&(R=I[I.length-1],I[0].x===R.x&&I[0].y===R.y||I.push(I[0]),C.push(I))}C.length&&m.push(C)}return m}function Jb(d,o){const l=df(d),u=df([o]),m=cE.intersection(l,u);return null==m?[]:U0(m)}function dE(d,o){let u=df(d,65536);for(;o.valid();o.next()){const[m,v]=o.get(),b=65536*m.x,C=65536*m.y,D=65536*v.x,I=65536*v.y,R=D-b,N=I-C,j=Math.hypot(R,N),K=Math.trunc(N/j*3),Z=-Math.trunc(R/j*3);u=cE.diff(u,[[[b,C],[D,I],[D+K,I+Z],[b+K,C+Z],[b,C]]])}return U0(u,1/65536)}function df(d,o=1){return[d.map(l=>l.map(u=>[u.x*o,u.y*o]))]}function U0(d,o=1){return d.map(l=>l.map((u,m)=>{const v=u.map(b=>new Wt(b[0]*o,b[1]*o).round());return m>0&&v.reverse(),v}))}class q0{constructor(o,l){this.layoutVertexArray=new Gd,this.indexArray=new Qs,this.lineIndexArray=new ch,this.triangleSegments=new ro,this.lineSegments=new ro,this.programConfigurations=new dp(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new rp)}update(o,l,u,m,v,b,C){this.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,tE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,PM.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,l,u,m,v,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,l,u,m,v,b)}}class Qy{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new q0(o,!1),this.elevationBufferData=new q0(o,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(o,l){}populate(o,l,u,m){this.hasPattern=Wy("fill",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:C,id:D,index:I,sourceLayerIndex:R}of o){const N=this.layers[0]._featureFilter.needGeometry,j=bn(C,N);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),j,u))continue;const K=v?v.evaluate(j,{},u,l.availableImages):void 0,Z={id:D,properties:C.properties,type:C.type,sourceLayerIndex:R,index:I,geometry:N?j.geometry:fn(C,u,m),patterns:{},sortKey:K};b.push(Z)}v&&b.sort((C,D)=>C.sortKey-D.sortKey);for(const C of b){const{geometry:D,index:I,sourceLayerIndex:R}=C;if(this.hasPattern){const N=Zy("fill",this.layers,C,this.zoom,this.pixelRatio,l);this.patternFeatures.push(N)}else this.addFeature(C,D,I,u,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(o[I].feature,D,I,R,this.index)}}update(o,l,u,m,v,b,C){this.bufferData.update(o,l,u,m,v,b,C),this.elevationBufferData.update(o,l,u,m,v,b,C)}addFeatures(o,l,u,m,v,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,l,u,m,b,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,l,u,m,v,b=[],C,D){const I=Xg(l,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(o,I,m,u,D):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(o,u,v,b,m,C),this.elevationBufferData.populatePaintArrays(o,u,v,b,m,C)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o){this.elevatedStructures&&this.elevatedStructures.construct(o)}addElevatedRoadFeature(o,l,u,m,v){const b=new Array,C=Yb.getElevationFeature(o,v);if(C){{const D=this.clipPolygonsToTile(l,1);D.length>0&&b.push({polygons:D,elevationFeature:C,elevationTileID:u})}for(const D of b)if(D.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new Sl(D.elevationTileID));const R=D.elevationFeature.isTunnel();let N=0;o.properties.hasOwnProperty("level")&&(N=+o.properties.level);for(const j of D.polygons)this.elevatedStructures.addPortalCandidates(D.elevationFeature.id,j,R,D.elevationFeature,N)}null==D.elevationFeature.constantHeight&&(D.polygons=this.prepareElevatedPolygons(D.polygons,D.elevationFeature,D.elevationTileID));const I=new Xb(u,D.elevationTileID);this.addElevatedGeometry(D.polygons,I,D.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,m)}}else this.addGeometry(l,this.bufferData)}addElevatedGeometry(o,l,u,m,v){const b={elevation:u,elevationSampler:l,bias:m,index:v},[C,D]=this.addGeometry(o,this.elevationBufferData,b);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:C,max:D}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,D))}addGeometry(o,l,u){let m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,b=null;u&&(b=u.elevationSampler.constantElevation(u.elevation,u.bias),null!=b&&(m=b,v=b));const C=(D,I,R)=>{if(null!=u)if(I.push(D),null!=b)l.elevatedLayoutVertexArray.emplaceBack(b),R.push(b);else{const N=u.elevationSampler.pointElevation(D,u.elevation,u.bias);l.elevatedLayoutVertexArray.emplaceBack(N),R.push(N),m=Math.min(m,N),v=Math.max(v,N)}};for(const D of o){let I=0;for(const ve of D)I+=ve.length;const R=l.triangleSegments.prepareSegment(I,l.layoutVertexArray,l.indexArray),N=R.vertexLength,j=[],K=[],Z=[],te=[],ce=[],ue=l.layoutVertexArray.length;for(const ve of D){if(0===ve.length)continue;ve!==D[0]&&K.push(j.length/2);const ie=l.lineSegments.prepareSegment(ve.length,l.layoutVertexArray,l.lineIndexArray),_e=ie.vertexLength;u&&ce.push(l.layoutVertexArray.length-ue),C(ve[0],Z,te),l.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),l.lineIndexArray.emplaceBack(_e+ve.length-1,_e),j.push(ve[0].x),j.push(ve[0].y);for(let we=1;we<ve.length;we++)C(ve[we],Z,te),l.layoutVertexArray.emplaceBack(ve[we].x,ve[we].y),l.lineIndexArray.emplaceBack(_e+we-1,_e+we),j.push(ve[we].x),j.push(ve[we].y);ie.vertexLength+=ve.length,ie.primitiveLength+=ve.length}const xe=gm(j,K);for(let ve=0;ve<xe.length;ve+=3)l.indexArray.emplaceBack(N+xe[ve],N+xe[ve+1],N+xe[ve+2]);if(xe.length>0&&u&&"hd-road-base"===this.elevationMode){const ve=u.elevation.isTunnel(),ie=u.elevation.safeArea,_e=this.elevatedStructures.addVertices(Z,te);this.elevatedStructures.addTriangles(xe,_e,ve);const we=ce.length;if(we>0){for(let Ce=0;Ce<we-1;Ce++)this.elevatedStructures.addRenderableRing(u.index,ce[Ce]+_e,ce[Ce+1]-ce[Ce],ve,ie);this.elevatedStructures.addRenderableRing(u.index,ce[we-1]+_e,Z.length-ce[we-1],ve,ie)}}R.vertexLength+=I,R.primitiveLength+=xe.length/3}return[m,v]}prepareElevatedPolygons(o,l,u){const m=1/Je(u),v=[];for(const b of o){const C=dE(b,new BM(l,m));v.push(...C)}return v}clipPolygonsToTile(o,l){const u=-l,m=-l,v=Xt+l,b=Xt+l;let C=0;const D=[],I=[];for(;C<o.length;C++){const j=o[C],K=hd(j);(K.min.x>=u&&K.max.x<=v&&K.min.y>=m&&K.max.y<=b?D:I).push(j)}if(D.length===o.length)return o;const R=[new Wt(u,m),new Wt(v,m),new Wt(v,b),new Wt(u,b),new Wt(u,m)],N=D;for(const j of I)N.push(...Jb(j,R));return N}}let ex,tx,hf,HM;ln(Qy,"FillBucket",{omit:["layers","patternFeatures"]}),ln(q0,"FillBufferData"),ln(Sl,"ElevatedStructures");class nx{constructor(o,l,u,m){if(this.triangleCount=l.length/3,this.min=new Wt(0,0),this.max=new Wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===o.length)return;const[v,b]=[o[0].clone(),o[0].clone()];for(let N=1;N<o.length;++N){const j=o[N];v.x=Math.min(v.x,j.x),v.y=Math.min(v.y,j.y),b.x=Math.max(b.x,j.x),b.y=Math.max(b.y,j.y)}if(m){const N=Math.ceil(Math.max(b.x-v.x,b.y-v.y)/m);u=Math.max(u,N)}if(0===u)return;this.min=v,this.max=b;const C=this.max.sub(this.min);C.x=Math.max(C.x,1),C.y=Math.max(C.y,1);const D=Math.max(C.x,C.y)/u;this.cellsX=Math.max(1,Math.ceil(C.x/D)),this.cellsY=Math.max(1,Math.ceil(C.y/D)),this.xScale=1/D,this.yScale=1/D;const I=[];for(let N=0;N<this.triangleCount;N++){const j=o[l[3*N+0]].sub(this.min),K=o[l[3*N+1]].sub(this.min),Z=o[l[3*N+2]].sub(this.min),te=Su(Math.floor(Math.min(j.x,K.x,Z.x)),this.xScale,this.cellsX),ce=Su(Math.floor(Math.max(j.x,K.x,Z.x)),this.xScale,this.cellsX),ue=Su(Math.floor(Math.min(j.y,K.y,Z.y)),this.yScale,this.cellsY),xe=Su(Math.floor(Math.max(j.y,K.y,Z.y)),this.yScale,this.cellsY),ve=new Wt(0,0),ie=new Wt(0,0),_e=new Wt(0,0),we=new Wt(0,0);for(let Ce=ue;Ce<=xe;++Ce){ve.y=ie.y=Ce*D,_e.y=we.y=(Ce+1)*D;for(let ze=te;ze<=ce;++ze)ve.x=_e.x=ze*D,ie.x=we.x=(ze+1)*D,(so(j,K,Z,ve,ie,we)||so(j,K,Z,ve,we,_e))&&I.push({cellIdx:Ce*this.cellsX+ze,triIdx:N})}}if(0===I.length)return;I.sort((N,j)=>N.cellIdx-j.cellIdx||N.triIdx-j.triIdx);let R=0;for(;R<I.length;){const N=I[R].cellIdx,j={start:this.payload.length,len:0};for(;R<I.length&&I[R].cellIdx===N;)++j.len,this.payload.push(I[R++].triIdx);this.cells[N]=j}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const u=Su(o.x-this.min.x,this.xScale,this.cellsX),m=Su(o.y-this.min.y,this.yScale,this.cellsY),v=this.cells[m*this.cellsX+u];if(v){this._lazyInitLookup();for(let b=0;b<v.len;b++){const C=this.payload[v.start+b],D=Math.floor(C/8),I=1<<C%8;if(!(this.lookup[D]&I)&&(this.lookup[D]|=I,l.push(C),l.length===this.triangleCount))return}}}query(o,l,u){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const m=Su(o.x-this.min.x,this.xScale,this.cellsX),v=Su(l.x-this.min.x,this.xScale,this.cellsX),b=Su(o.y-this.min.y,this.yScale,this.cellsY),C=Su(l.y-this.min.y,this.yScale,this.cellsY);for(let D=b;D<=C;D++)for(let I=m;I<=v;I++){const R=this.cells[D*this.cellsX+I];if(R)for(let N=0;N<R.len;N++){const j=this.payload[R.start+N],K=Math.floor(j/8),Z=1<<j%8;if(!(this.lookup[K]&Z)&&(this.lookup[K]|=Z,u.push(j),u.length===this.triangleCount))return}}}}function Su(d,o,l){return Math.max(0,Math.min(l-1,Math.floor(d*o)))}ln(nx,"TriangleGridIndex");class UM{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(const u of this.footprints)l.push({footprint:u,id:o})}populate(o,l,u,m){const v=[];for(const{feature:b,id:C,index:D,sourceLayerIndex:I}of o){const R=this.layers[0]._featureFilter.needGeometry,N=bn(b,R);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),N,u))continue;const j={id:C,properties:b.properties,type:b.type,sourceLayerIndex:I,index:D,geometry:R?N.geometry:fn(b,u,m),patterns:{}};v.push(j)}for(const b of v){const{geometry:C,index:D,sourceLayerIndex:I}=b;this.addFeature(b,C,D,u,{},l.availableImages,l.brightness),l.featureIndex.insert(o[D].feature,C,D,I,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(o){}update(o,l,u,m,v,b,C){}destroy(){}addFeature(o,l,u,m,v,b=[],C){for(const D of Xg(l,2)){const I=[],R=[],N=[],j=new Wt(1/0,1/0),K=new Wt(-1/0,-1/0);for(const ce of D)if(0!==ce.length){ce!==D[0]&&N.push(R.length/2);for(let ue=0;ue<ce.length;ue++)R.push(ce[ue].x),R.push(ce[ue].y),I.push(ce[ue]),j.x=Math.min(j.x,ce[ue].x),j.y=Math.min(j.y,ce[ue].y),K.x=Math.max(K.x,ce[ue].x),K.y=Math.max(K.y,ce[ue].y)}const Z=gm(R,N),te=new nx(I,Z,8,256);this.footprints.push({vertices:I,indices:Z,grid:te,min:j,max:K})}}}ln(UM,"ClipBucket",{omit:["layers"]});const hE=Ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Zd=Ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Eu=Ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),uE=Ei([{name:"a_join_normal_inside",components:3,type:"Int16"}]),pE=Ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fE=Ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mE}=hE,Jy=Number.MAX_SAFE_INTEGER;function qM(d,o,l,u){return d.order<o||d.order===Jy||!(d.clipMask&l)||(m=u,0!==(v=d.clipScope).length&&void 0===v.find(b=>b===m));var m,v}function $0(d,o){return d.x-o.x||d.y-o.y}function $M(d,o){return 0===$0(d.min,o.min)&&0===$0(d.max,o.max)}function ix(d,o){return!(d.min.x>o.max.x||d.max.x<o.min.x||d.min.y>o.max.y||d.max.y<o.min.y)}function rx(d,o){if(d.length!==o.length)return!1;for(let l=0;l<d.length;l++)if(d[l].sourceId!==o[l].sourceId||!$M(d[l],o[l])||d[l].order!==o[l].order||d[l].clipMask!==o[l].clipMask||!jc(d[l].clipScope,o[l].clipScope))return!1;return!0}function GM(d,o,l){const u=1/Xt,m=1/(1<<l.canonical.z),v=(o.x*u+l.canonical.x)*m+l.wrap,b=(o.y*u+l.canonical.y)*m;return{min:new Wt((d.x*u+l.canonical.x)*m+l.wrap,(d.y*u+l.canonical.y)*m),max:new Wt(v,b)}}function ev(d,o,l){const u=1<<l.canonical.z,m=((o.x-l.wrap)*u-l.canonical.x)*Xt,v=(o.y*u-l.canonical.y)*Xt;return{min:new Wt(((d.x-l.wrap)*u-l.canonical.x)*Xt,(d.y*u-l.canonical.y)*Xt),max:new Wt(m,v)}}function Du(d,o,l,u,m,v,b){const C=d.indices,D=d.vertices,I=[];for(let R=u;R<u+m;R+=3){const N=o[l[R+0]+v],j=o[l[R+1]+v],K=o[l[R+2]+v],Z=Math.min(N.x,j.x,K.x),te=Math.max(N.x,j.x,K.x),ce=Math.min(N.y,j.y,K.y),ue=Math.max(N.y,j.y,K.y);I.length=0,d.grid.query(new Wt(Z,ce),new Wt(te,ue),I);for(let xe=0;xe<I.length;xe++){const ve=I[xe];if(so(D[C[3*ve+0]],D[C[3*ve+1]],D[C[3*ve+2]],N,j,K,b))return!0}}return!1}function e1(d,o,l,u){if(!d||!l)return!1;let m=d.vertices;if(!o.canonical.equals(u.canonical)||o.wrap!==u.wrap){if(l.vertices.length<d.vertices.length)return e1(l,u,d,o);const v=o.canonical,b=u.canonical,C=Math.pow(2,b.z-v.z);m=d.vertices.map(D=>new Wt((D.x+v.x*Xt)*C-b.x*Xt,(D.y+v.y*Xt)*C-b.y*Xt))}return Du(l,m,d.indices,0,d.indices.length,0,0)}function ox(d,o,l,u){const m=Math.pow(2,u.z-l.z);return new Wt((d+l.x*Xt)*m-u.x*Xt,(o+l.y*Xt)*m-u.y*Xt)}function sx(d,o){const l=[];o.grid.queryPoint(d,l);const u=o.indices,m=o.vertices;for(let v=0;v<l.length;v++){const b=l[v];if(wr([m[u[3*b+0]],m[u[3*b+1]],m[u[3*b+2]]],d))return!0}return!1}const tv=[new Wt(0,0),new Wt(Xt,0),new Wt(Xt,Xt),new Wt(0,Xt)];function gE(d,o){const l=[];let u=[];if(!o||d.length<2)return[d];if(2===d.length)return Ho(d[0],d[1],tv)?[d]:[];for(let m=0;m<d.length+2;m++){const v=d[m%d.length],b=d[(m+1)%d.length],C=Ho(0===m?d[d.length-1]:d[(m-1)%d.length],v,tv),D=Ho(v,b,tv),I=C||D;I&&u.push(v),I&&D||u.length>0&&(u.length>1&&l.push(u),u=[])}return u.length>1&&l.push(u),l}const WM=fp.VectorTileFeature.types,z6=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ax=["fill-extrusion-flood-light-ground-radius"],lx=Math.pow(2,13),N6=Math.pow(2,15)-1,_E=new Wt(0,1),gp=2147483648;function G0(d,o,l,u,m,v,b,C){d.emplaceBack((o<<1)+b,(l<<1)+v,(Math.floor(u*lx)<<1)+m,Math.round(C))}function W0(d,o,l){d.emplaceBack(o.x*Xt,o.y*Xt,l?1:0)}function nv(d,o,l,u,m,v){d.emplaceBack(o.x,o.y,(l.x<<1)+u,(l.y<<1)+m,v)}function Z0(d,o,l){d.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class cx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Y0{constructor(){this.centroidXY=new Wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class dx{constructor(){this.acc=new Wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,u){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<o.min.x?(o.min.x=l.x,m=!0):l.x>o.max.x&&(o.max.x=l.x,m=!0),l.y<o.min.y?(o.min.y=l.y,m=!0):l.y>o.max.y&&(o.max.y=l.y,m=!0),((0===l.x||l.x===Xt)&&l.x===u.x)!=((0===l.y||l.y===Xt)&&l.y===u.y)&&this.processBorderOverlap(l,u),m&&this.checkBorderIntersection(l,u)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,Cn(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Xt!=o.x>Xt&&this.addBorderIntersection(1,Cn(l.y,o.y,(Xt-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Cn(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Xt!=o.y>Xt&&this.addBorderIntersection(3,Cn(l.x,o.x,(Xt-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){return 0===this.accCount?new Wt(0,0):new Wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function iv(d,o){const l=d.add(o)._unit(),u=Ge(d.x*l.x+d.y*l.y,-1,1);var m,v,b;return m=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(m)))/4*N6*((v=d).x*(b=o).y-v.y*b.x<0?-1:1)}const yE=[d=>d.x<0,d=>d.x>Xt,d=>d.y<0,d=>d.y>Xt];function oc(d,o,l,u){const m=[4];if(0===u)return m;l._mult(u);const v=d.sub(l),b=o.sub(l),C=[d,o,v,b];for(let D=0;D<4;D++)for(const I of C)if(yE[D](I)){m.push(D);break}return m}class ZM{constructor(o){this.vertexArray=new Ng,this.indexArray=new Qs,this.programConfigurations=new dp(o.layers,{zoom:o.zoom,lut:o.lut},l=>ax.includes(l)),this._segments=new ro,this.hiddenByLandmarkVertexArray=new om,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ro}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(o,l,u,m=!1){const v=o.length;if(v>2){let b=Math.max(0,this._segments.get().length-1);const C=this._segments._prepareSegment(4*v,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let D;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const I=o[0],R=o[1];D=iv(I.sub(o[v-1])._perp()._unit(),R.sub(I)._perp()._unit())}for(let I=0;I<v;I++){const R=I===v-1?0:I+1,N=o[I],j=o[R],K=o[R===v-1?0:R+1],Z=j.sub(N)._perp()._unit(),te=iv(Z,K.sub(j)._perp()._unit()),ce=D,ue=te;if(hx(N,j,l)||m&&KM(N,l)&&KM(j,l)){D=te;continue}const xe=C.vertexLength;nv(this.vertexArray,N,j,1,1,ce),nv(this.vertexArray,N,j,1,0,ce),nv(this.vertexArray,N,j,0,1,ue),nv(this.vertexArray,N,j,0,0,ue),C.vertexLength+=4;const ve=oc(N,j,Z,u);for(const ie of ve)this._segmentToGroundQuads[b].push({id:xe,region:ie}),this._segmentToRegionTriCounts[b][ie]+=2,C.primitiveLength+=2;D=te}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),l=o.length;for(let u=0;u<l;u++)this._segmentToGroundQuads[u].sort((m,v)=>m.region-v.region);for(let u=0;u<l;u++){const m=this._segmentToGroundQuads[u],v=o[u],b=this._segmentToRegionTriCounts[u];b.reduce((D,I)=>D+I,0);let C=0;for(let D=0;D<=4;D++){const I=b[D];if(0!==I){let R=this.regionSegments[D];R||(R=this.regionSegments[D]=new ro);const N={vertexOffset:v.vertexOffset,primitiveOffset:v.primitiveOffset+C,vertexLength:v.vertexLength,primitiveLength:I};R.get().push(N)}C+=I}for(let D=0;D<m.length;D++){const I=m[D].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,u,m,v,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,u,m,v,b)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Zd.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,u,m,v,b,C){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,u,m,v,b,C)}updateHiddenByLandmark(o){if(!this.hasData())return;const l=o.groundVertexCount+o.groundVertexArrayOffset;if(0===o.groundVertexCount)return;const u=o.flags&gp?1:0;for(let m=o.groundVertexArrayOffset;m<l;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,pE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const l=this.regionSegments[o];l&&l.destroy()}}}}class rv{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qs,this.footprintVertices=new Gd,this.footprintSegments=[],this.layoutVertexArray=new $p,this.centroidVertexArray=new Oy,this.wallVertexArray=new Yp,this.indexArray=new Qs,this.programConfigurations=new dp(o.layers,{zoom:o.zoom,lut:o.lut},l=>z6.includes(l)),this.segments=new ro,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new ZM(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,u,m){this.features=[],this.hasPattern=Wy("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Je(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:v,id:b,index:C,sourceLayerIndex:D}of o){const I=this.layers[0]._featureFilter.needGeometry,R=bn(v,I);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),R,u))continue;const N={id:b,sourceLayerIndex:D,index:C,geometry:I?R.geometry:fn(v,u,m),properties:v.properties,type:v.type,patterns:{}},j=this.layoutVertexArray.length,K="Polygon"===WM[N.type];if(this.hasPattern)this.features.push(Zy("fill-extrusion",this.layers,N,this.zoom,this.pixelRatio,l));else if(this.wallMode)for(const Z of N.geometry)for(const te of gE(Z,K))this.addFeature(N,[te],C,u,{},l.availableImages,m,l.brightness);else this.addFeature(N,N.geometry,C,u,{},l.availableImages,m,l.brightness);l.featureIndex.insert(v,N.geometry,C,D,this.index,j)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,u,m,v,b){for(const C of this.features){const D="Polygon"===WM[C.type],{geometry:I}=C;if(this.wallMode)for(const R of I)for(const N of gE(R,D))this.addFeature(C,[N],C.index,l,u,m,v,b);else this.addFeature(C,I,C.index,l,u,m,v,b)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(o,l,u,m,v,b,C){this.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C),this.groundEffect.update(o,l,v,u,m,b,C)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,mE),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,uE.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,fE.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Eu.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,m,v,b,C,D){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,R=[new Wt(0,0),new Wt(Xt,Xt)],N=C.projection,j="globe"===N.name,K=this.wallMode||"Polygon"===WM[o.type],Z=new dx;Z.centroidDataIndex=this.centroidData.length;const te=new Y0,ce=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},m)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},m);let xe;if(te.height=ue,te.vertexArrayOffset=this.layoutVertexArray.length,te.groundVertexArrayOffset=this.groundEffect.vertexArray.length,j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new op),this.wallMode){if(j)return void ci("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==l.length)return;xe=function(Ze){const Xe=Ze[0].x===Ze[Ze.length-1].x&&Ze[0].y===Ze[Ze.length-1].y;(function(Kt){let Qe=0;const Ft=Kt.length;for(let Yt=0;Yt<Ft;Yt++)Qe+=(Kt[(Yt+1)%Ft].x-Kt[Yt].x)*(Kt[(Yt+1)%Ft].y+Kt[Yt].y);return Qe>=0})(Ze)||(Ze=Ze.reverse());const Rt={geometry:[],joinNormals:[],indices:[]},Mt=[],Tt=[],Nt=[];let ut=Ze.length;for(;ut>=2&&Ze[ut-1].equals(Ze[ut-2]);)ut--;if(ut<(Xe?3:2))return Rt;let Et,lt,gt,Bt,q,gn=0;for(;gn<ut-1&&Ze[gn].equals(Ze[gn+1]);)gn++;Xe&&(Et=Ze[ut-2],q=Ze[gn].sub(Et)._unit()._perp());for(let Kt=gn;Kt<ut;Kt++){if(gt=Kt===ut-1?Xe?Ze[gn+1]:void 0:Ze[Kt+1],gt&&Ze[Kt].equals(gt))continue;q&&(Bt=q),Et&&(lt=Et),Et=Ze[Kt],q=gt?gt.sub(Et)._unit()._perp():Bt,Bt=Bt||q;let Qe=Bt.add(q);0===Qe.x&&0===Qe.y||Qe._unit();const Ft=Qe.x*q.x+Qe.y*q.y,Yt=0!==Ft?1/Ft:1/0,un=Bt.x*q.y-Bt.y*q.x>0;let Bn="miter";const Kn=2;"miter"===Bn&&Yt>Kn&&(Bn="bevel"),"bevel"===Bn&&(Yt>100&&(Bn="flipbevel"),Yt<Kn&&(Bn="miter"));const ri=(_i,di,li,Dr)=>{const Ur=new Wt(_i.x,_i.y),ke=new Wt(_i.x,_i.y);Ur.x+=di.x*Dr,Ur.y+=di.y*Dr,ke.x-=di.x*Math.max(li,1),ke.y-=di.y*Math.max(li,1),Nt.push(di),Mt.push(Ur),Tt.push(ke)};if("miter"===Bn)Qe._mult(Yt),ri(Et,Qe,0,0);else if("flipbevel"===Bn)Qe=q.mult(-1),ri(Et,Qe,0,0),ri(Et,Qe.mult(-1),0,0);else{const _i=-Math.sqrt(Yt*Yt-1),di=un?_i:0,li=un?0:_i;lt&&ri(Et,Bt,di,li),gt&&ri(Et,q,di,li)}}Rt.geometry=[...Mt,...Tt.reverse(),Mt[0]],Rt.joinNormals=[...Nt,...Nt.reverse(),Nt[Nt.length-1]];const hn=Rt.geometry.length-1;for(let Kt=0;Kt<hn/2;Kt++)if(Kt+1<hn/2){let Qe=Kt,Ft=Kt+1,Yt=hn-1-Kt,un=hn-2-Kt;Qe=0===Qe?hn-1:Qe-1,Ft=0===Ft?hn-1:Ft-1,Yt=0===Yt?hn-1:Yt-1,un=0===un?hn-1:un-1,Rt.indices.push(Yt),Rt.indices.push(Ft),Rt.indices.push(Qe),Rt.indices.push(Yt),Rt.indices.push(un),Rt.indices.push(Ft)}return Rt}(l[0]),l=[xe.geometry]}const ve=(Ze,Xe)=>Ze<(Xe.length-1)/2||Ze===Xe.length-1,ie=this.wallMode?[l]:Xg(l,500);for(let Ze=ie.length-1;Ze>=0;Ze--){const Xe=ie[Ze];(0===Xe.length||(_e=Xe[0]).every(pt=>pt.x<=0)||_e.every(pt=>pt.x>=Xt)||_e.every(pt=>pt.y<=0)||_e.every(pt=>pt.y>=Xt))&&ie.splice(Ze,1)}var _e;let we;if(j)we=bE(ie,R,m);else{we=[];for(const Ze of ie)we.push({polygon:Ze,bounds:R})}const Ce=K?this.edgeRadius:0,ze=Ce>0&&this.zoom<17,qe=(Ze,Xe)=>{if(0===Ze.length)return!1;const pt=Ze[Ze.length-1];return Xe.x===pt.x&&Xe.y===pt.y};for(const{polygon:Ze,bounds:Xe}of we){let pt=0,Rt=0;for(const ut of Ze)K&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),Rt+=K?ut.length-1:ut.length;const Mt=this.segments.prepareSegment((K?5:4)*Rt,this.layoutVertexArray,this.indexArray);te.footprintSegIdx<0&&(te.footprintSegIdx=this.footprintSegments.length),te.polygonSegIdx<0&&(te.polygonSegIdx=this.polygonSegments.length);const Tt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Nt=new cx;if(Nt.vertexOffset=this.footprintVertices.length,Nt.indexOffset=3*this.footprintIndices.length,Nt.ringIndices=[],K){const ut=[],Et=[];pt=Mt.vertexLength;for(let gt=0;gt<Ze.length;gt++){const Bt=Ze[gt];Bt.length&&0!==gt&&Et.push(ut.length/2);const q=[];let gn,hn;gn=Bt[1].sub(Bt[0])._perp()._unit(),Nt.ringIndices.push(Bt.length-1);for(let Kt=1;Kt<Bt.length;Kt++){const Qe=Bt[Kt],Ft=Bt[Kt===Bt.length-1?1:Kt+1],Yt=Qe.clone();if(Ce){hn=Ft.sub(Qe)._perp()._unit();const un=gn.add(hn)._unit(),Bn=Ce*Math.min(4,1/(gn.x*un.x+gn.y*un.y));Yt.x+=Bn*un.x,Yt.y+=Bn*un.y,Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),gn=hn}if(!ce||0!==Ce&&!ze||qe(q,Yt)||q.push(Yt),G0(this.layoutVertexArray,Yt.x,Yt.y,0,0,1,1,0),this.wallMode){const un=ve(Kt,Bt);W0(this.wallVertexArray,xe.joinNormals[Kt],!un)}Mt.vertexLength++,this.footprintVertices.emplaceBack(Qe.x,Qe.y),ut.push(Qe.x,Qe.y),j&&Z0(this.layoutVertexExtArray,N.projectTilePoint(Yt.x,Yt.y,m),N.upVector(m,Yt.x,Yt.y))}ce&&(0===Ce||ze)&&(0!==q.length&&qe(q,q[0])&&q.pop(),this.groundEffect.addData(q,Xe,I))}const lt=this.wallMode?xe.indices:gm(ut,Et);for(let gt=0;gt<lt.length;gt+=3)this.footprintIndices.emplaceBack(Nt.vertexOffset+lt[gt+0],Nt.vertexOffset+lt[gt+1],Nt.vertexOffset+lt[gt+2]),this.indexArray.emplaceBack(pt+lt[gt],pt+lt[gt+2],pt+lt[gt+1]),Mt.primitiveLength++;Nt.indexCount+=lt.length,Nt.vertexCount+=this.footprintVertices.length-Nt.vertexOffset}for(let ut=0;ut<Ze.length;ut++){const Et=Ze[ut];Z.startRing(te,Et[0]);let lt=Et.length>4&&QM(Et[Et.length-2],Et[0],Et[1]),gt=Ce?YM(Et[Et.length-2],Et[0],Et[1],Ce):0;const Bt=[];let q,gn,hn;gn=Et[1].sub(Et[0])._perp()._unit();let Kt=!0;for(let Qe=1,Ft=0;Qe<Et.length;Qe++){let Yt=Et[Qe-1],un=Et[Qe];const Bn=Et[Qe===Et.length-1?1:Qe+1];if(Z.appendEdge(te,un,Yt),hx(un,Yt,Xe)){Ce&&(gn=Bn.sub(un)._perp()._unit(),Kt=!Kt);continue}const Kn=un.sub(Yt)._perp(),ri=Kn.x/(Math.abs(Kn.x)+Math.abs(Kn.y)),_i=Kn.y>0?1:0,di=Yt.dist(un);if(Ft+di>32768&&(Ft=0),Ce){hn=Bn.sub(un)._perp()._unit();let ke=XM(Yt,un,Bn,fs(gn,hn),Ce);isNaN(ke)&&(ke=0);const Se=un.sub(Yt)._unit();Yt=Yt.add(Se.mult(gt))._round(),un=un.add(Se.mult(-ke))._round(),gt=ke,gn=hn,ce&&this.zoom>=17&&(qe(Bt,Yt)||Bt.push(Yt),qe(Bt,un)||Bt.push(un))}const li=Mt.vertexLength,Dr=Et.length>4&&QM(Yt,un,Bn);let Ur=ux(Ft,lt,Kt);if(G0(this.layoutVertexArray,Yt.x,Yt.y,ri,_i,0,0,Ur),G0(this.layoutVertexArray,Yt.x,Yt.y,ri,_i,0,1,Ur),this.wallMode){const ke=ve(Qe-1,Et),Se=xe.joinNormals[Qe-1];W0(this.wallVertexArray,Se,ke),W0(this.wallVertexArray,Se,ke)}if(Ft+=di,Ur=ux(Ft,Dr,!Kt),lt=Dr,G0(this.layoutVertexArray,un.x,un.y,ri,_i,0,0,Ur),G0(this.layoutVertexArray,un.x,un.y,ri,_i,0,1,Ur),this.wallMode){const ke=ve(Qe,Et),Se=xe.joinNormals[Qe];W0(this.wallVertexArray,Se,ke),W0(this.wallVertexArray,Se,ke)}if(Mt.vertexLength+=4,this.indexArray.emplaceBack(li+0,li+1,li+2),this.indexArray.emplaceBack(li+1,li+3,li+2),Mt.primitiveLength+=2,Ce){const ke=pt+(1===Qe?Et.length-2:Qe-2),Se=1===Qe?pt:ke+1;if(this.indexArray.emplaceBack(li+1,ke,li+3),this.indexArray.emplaceBack(ke,Se,li+3),Mt.primitiveLength+=2,void 0===q&&(q=li),!hx(Bn,Et[Qe],Xe)){const _t=Qe===Et.length-1?q:Mt.vertexLength;this.indexArray.emplaceBack(li+2,li+3,_t),this.indexArray.emplaceBack(li+3,_t+1,_t),this.indexArray.emplaceBack(li+3,Se,_t+1),Mt.primitiveLength+=3}Kt=!Kt}if(j){const ke=this.layoutVertexExtArray,Se=N.projectTilePoint(Yt.x,Yt.y,m),_t=N.projectTilePoint(un.x,un.y,m),$t=N.upVector(m,Yt.x,Yt.y),en=N.upVector(m,un.x,un.y);Z0(ke,Se,$t),Z0(ke,Se,$t),Z0(ke,_t,en),Z0(ke,_t,en)}}K&&(pt+=Et.length-1),ce&&Ce&&this.zoom>=17&&(0!==Bt.length&&qe(Bt,Bt[0])&&Bt.pop(),this.groundEffect.addData(Bt,Xe,I,Ce>0))}this.footprintSegments.push(Nt),Tt.triangleCount=this.indexArray.length-Tt.triangleArrayOffset,this.polygonSegments.push(Tt),++te.footprintSegLen,++te.polygonSegLen}if(te.vertexCount=this.layoutVertexArray.length-te.vertexArrayOffset,te.groundVertexCount=this.groundEffect.vertexArray.length-te.groundVertexArrayOffset,0!==te.vertexCount){if(te.centroidXY=Z.borders?_E:this.encodeCentroid(Z,te),this.centroidData.push(te),Z.borders){this.featuresOnBorder.push(Z);const Ze=this.featuresOnBorder.length-1;for(let Xe=0;Xe<Z.borders.length;Xe++)Z.borders[Xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Xe].push(Ze)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,v,b,m,D),this.groundEffect.addPaintPropertiesData(o,u,v,b,m,D),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}splitToSubtiles(){const o=[];for(let C=0;C<this.centroidData.length;C++){const D=this.centroidData[C],I=+(D.min.y+D.max.y>Xt),R=2*I+(+(D.min.x+D.max.x>Xt)^I);for(let N=0;N<D.polygonSegLen;N++){const j=D.polygonSegIdx+N;o.push({centroidIdx:C,subtile:R,polygonSegmentIdx:j,triangleSegmentIdx:this.polygonSegments[j].triangleSegIdx})}}const l=new Qs;o.sort((C,D)=>C.triangleSegmentIdx===D.triangleSegmentIdx?C.subtile-D.subtile:C.triangleSegmentIdx-D.triangleSegmentIdx);let u=0,m=0,v=0;for(const C of o){if(C.triangleSegmentIdx!==u)break;v++}const b=o.length;for(;m!==o.length;){u=o[m].triangleSegmentIdx;let C=0,D=m,I=m;for(let R=D;R<v&&o[R].subtile===C;R++)I++;for(;D!==v;){const R=o[D];C=R.subtile;const N=this.centroidData[R.centroidIdx].min.clone(),j=this.centroidData[R.centroidIdx].max.clone(),K={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Z=D;Z<I;Z++){const te=o[Z],ce=this.polygonSegments[te.polygonSegmentIdx],ue=this.centroidData[te.centroidIdx].min,xe=this.centroidData[te.centroidIdx].max,ve=this.indexArray.uint16;for(let ie=ce.triangleArrayOffset;ie<ce.triangleArrayOffset+ce.triangleCount;ie++)l.emplaceBack(ve[3*ie],ve[3*ie+1],ve[3*ie+2]);K.primitiveLength+=ce.triangleCount,N.x=Math.min(N.x,ue.x),N.y=Math.min(N.y,ue.y),j.x=Math.max(j.x,xe.x),j.y=Math.max(j.y,xe.y)}K.primitiveLength>0&&this.triangleSubSegments.push({segment:K,min:N,max:j}),D=I;for(let Z=D;Z<v&&o[Z].subtile===o[D].subtile;Z++)I++}m=v;for(let R=m;R<b&&o[R].triangleSegmentIdx===o[m].triangleSegmentIdx;R++)v++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,u){const m=new ro;if(this.wallMode){for(const te of this.triangleSubSegments)m.segments.push(te.segment);return m}let v=0,b=0;const C=1<<o.canonical.z;if(l){const te=l.getMinMaxForTile(o);te&&(v=te.min,b=te.max)}b+=this.maxHeight;const D=o.toUnwrapped();let I;const R=[D.canonical.x/C+D.wrap,D.canonical.y/C],N=[(D.canonical.x+1)/C+D.wrap,(D.canonical.y+1)/C],j=(te,ce,ue)=>[te[0]*(1-ue[0])+ce[0]*ue[0],te[1]*(1-ue[1])+ce[1]*ue[1]],K=[],Z=[];for(const te of this.triangleSubSegments){K[0]=te.min.x/Xt,K[1]=te.min.y/Xt,Z[0]=te.max.x/Xt,Z[1]=te.max.y/Xt;const ce=j(R,N,K),ue=j(R,N,Z);if(0===new eo([ce[0],ce[1],v],[ue[0],ue[1],b]).intersectsPrecise(u)){I&&(m.segments.push(I),I=void 0);continue}const xe=te.segment;I&&I.vertexOffset!==xe.vertexOffset&&(m.segments.push(I),I=void 0),I?(I.vertexLength+=xe.vertexLength,I.primitiveLength+=xe.primitiveLength):I={vertexOffset:xe.vertexOffset,primitiveLength:xe.primitiveLength,vertexLength:xe.vertexLength,primitiveOffset:xe.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&m.segments.push(I),m}encodeCentroid(o,l){const u=o.centroid(),m=l.span(),v=Math.min(7,Math.round(m.x*this.tileToMeter/10)),b=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new Wt(Ge(u.x,1,Xt-1)<<3|v,Ge(u.y,1,Xt-1)<<3|b)}encodeBorderCentroid(o){if(!o.borders)return new Wt(0,0);const l=o.borders,u=Number.MAX_VALUE;if(l[0][0]!==u||l[1][0]!==u){const m=l[0][0]!==u?0:1;return new Wt(6|(l[0][0]!==u?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{const m=l[2][0]!==u?2:3;return new Wt((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==u?0:65528))}}showCentroid(o){const l=this.centroidData[o.centroidDataIndex];l.flags&=gp,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const l=o.vertexArrayOffset,u=o.vertexCount+o.vertexArrayOffset,m=o.flags&gp?_E:o.centroidXY,v=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||v!==m.x){for(let b=l;b<u;++b)this.centroidVertexArray.emplace(b,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,u){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(o.toUnwrapped());if(rx(this.activeReplacements,m))return;if(this.activeReplacements=m,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const v=[];for(const b of this.activeReplacements){if(b.order<u)continue;const C=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-o.canonical.z));for(const D of this.centroidData)if(!(D.flags&gp||b.min.x>D.max.x||D.min.x>b.max.x||b.min.y>D.max.y||D.min.y>b.max.y))for(let I=0;I<D.footprintSegLen;I++){const R=this.footprintSegments[D.footprintSegIdx+I];if(v.length=0,X0(this.footprintVertices,R.vertexOffset,R.vertexCount,b.footprintTileId.canonical,o.canonical,v),Du(b.footprint,v,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-C)){D.flags|=gp;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,u){let m=!1;for(let v=0;v<u.footprintSegLen;v++){const b=this.footprintSegments[u.footprintSegIdx+v];let C=0;for(const D of b.ringIndices){for(let I=C,R=D+C-1;I<D+C;R=I++){const N=this.footprintVertices.int16[2*(I+b.vertexOffset)+0],j=this.footprintVertices.int16[2*(I+b.vertexOffset)+1],K=this.footprintVertices.int16[2*(R+b.vertexOffset)+1];j>l!=K>l&&o<(this.footprintVertices.int16[2*(R+b.vertexOffset)+0]-N)*(l-j)/(K-j)+N&&(m=!m)}C=D}}return m}getHeightAtTileCoord(o,l){let u=Number.NEGATIVE_INFINITY,m=!0;const v=4*(o+Xt)*Xt+(l+Xt);if(this.partLookup.hasOwnProperty(v)){const b=this.partLookup[v];return b?{height:b.height,hidden:!!(b.flags&gp)}:void 0}for(const b of this.centroidData)o>b.max.x||b.min.x>o||l>b.max.y||b.min.y>l||this.footprintContainsPoint(o,l,b)&&b&&b.height>u&&(u=b.height,this.partLookup[v]=b,m=!!(b.flags&gp));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[v]=void 0}}function fs(d,o){const l=d.add(o)._unit();return d.x*l.x+d.y*l.y}function YM(d,o,l,u){const m=o.sub(d)._perp()._unit(),v=l.sub(o)._perp()._unit();return XM(d,o,l,fs(m,v),u)}function XM(d,o,l,u,m){const v=Math.sqrt(1-u*u);return Math.min(d.dist(o)/3,o.dist(l)/3,m*v/u)}function hx(d,o,l){return d.x<l[0].x&&o.x<l[0].x||d.x>l[1].x&&o.x>l[1].x||d.y<l[0].y&&o.y<l[0].y||d.y>l[1].y&&o.y>l[1].y}function KM(d,o){return d.x<o[0].x||d.x>o[1].x||d.y<o[0].y||d.y>o[1].y}function QM(d,o,l){if(d.x<0||d.x>=Xt||o.x<0||o.x>=Xt||l.x<0||l.x>=Xt)return!1;const u=l.sub(o),m=u.perp(),v=d.sub(o);return(u.x*v.x+u.y*v.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(v.x*v.x+v.y*v.y))>-.866&&m.x*v.x+m.y*v.y<0}function ux(d,o,l){const u=o?2|d:-3&d;return l?1|u:-2&u}function vE(){const d=Math.PI/32,o=Math.tan(d),l=oe;return l*Math.sqrt(1+2*o*o)-l}function bE(d,o,l){const u=1<<l.z,m=Be(l.x/u),v=Be((l.x+1)/u),b=Ve(l.y/u),C=Ve((l.y+1)/u);return function(D,I,R,N,j=0,K){const Z=[];if(!D.length||!R||!N)return Z;const te=(we,Ce)=>{for(const ze of we)Z.push({polygon:ze,bounds:Ce})},ce=Math.ceil(Math.log2(R)),ue=Math.ceil(Math.log2(N)),xe=ce-ue,ve=[];for(let we=0;we<Math.abs(xe);we++)ve.push(xe>0?0:1);for(let we=0;we<Math.min(ce,ue);we++)ve.push(0),ve.push(1);let ie=D;if(ie=Ky(ie,I[0].y-j,I[1].y+j,1),ie=Ky(ie,I[0].x-j,I[1].x+j,0),!ie.length)return Z;const _e=[];for(ve.length?_e.push({polygons:ie,bounds:I,depth:0}):te(ie,I);_e.length;){const we=_e.pop(),Ce=we.depth,ze=ve[Ce],qe=we.bounds[0],Ze=we.bounds[1],Xe=0===ze?qe.x:qe.y,pt=0===ze?Ze.x:Ze.y,Rt=K?K(ze,Xe,pt):.5*(Xe+pt),Mt=Ky(we.polygons,Xe-j,Rt+j,ze),Tt=Ky(we.polygons,Rt-j,pt+j,ze);if(Mt.length){const Nt=[qe,new Wt(0===ze?Rt:Ze.x,1===ze?Rt:Ze.y)];ve.length>Ce+1?_e.push({polygons:Mt,bounds:Nt,depth:Ce+1}):te(Mt,Nt)}if(Tt.length){const Nt=[new Wt(0===ze?Rt:qe.x,1===ze?Rt:qe.y),Ze];ve.length>Ce+1?_e.push({polygons:Tt,bounds:Nt,depth:Ce+1}):te(Tt,Nt)}}return Z}(d,o,Math.ceil((v-m)/11.25),Math.ceil((b-C)/11.25),1,(D,I,R)=>{if(0===D)return.5*(I+R);{const N=Ve((l.y+I/Xt)/u);return(Oe(.5*(Ve((l.y+R/Xt)/u)+N))*u-l.y)*Xt}})}function X0(d,o,l,u,m,v){const b=Math.pow(2,u.z-m.z);for(let C=0;C<l;C++){let D=d.int16[2*(C+o)+0],I=d.int16[2*(C+o)+1];D=(D+m.x*Xt)*b-u.x*Xt,I=(I+m.y*Xt)*b-u.y*Xt,v.push(new Wt(D,I))}}let t1,px;ln(rv,"FillExtrusionBucket",{omit:["layers","features"]}),ln(Y0,"PartData"),ln(cx,"FootprintSegment"),ln(dx,"BorderCentroidData"),ln(ZM,"GroundEffect");class uf extends Wt{constructor(o,l,u){super(o,l),this.z=u}}class ov extends uf{constructor(o,l,u,m){super(o,l,u),this.w=m}}function sv(d,o,l,u){const m="x"===l?"y":"x",v=(u-d[l])/(o[l]-d[l]);d[m]=Math.round(d[m]+(o[m]-d[m])*v),d[l]=u,d.hasOwnProperty("z")&&(d.z=Cn(d.z,o.z,v)),d.hasOwnProperty("w")&&(d.w=Cn(d.w,o.w,v))}function JM(d,o,l,u){const m=l,v=u;for(const b of["x","y"]){let C=d,D=o;C[b]>=D[b]&&(C=o,D=d),C[b]<m&&D[b]>m&&sv(C,D,b,m),C[b]<v&&D[b]>v&&sv(D,C,b,v)}}function K0(d,o,l,u,m,v){const b=[];for(let C=0;C<d.length;C++){const D=d[C];let I;const R=b.length;let N=0;for(let j=0;j<D.length-1;j++){let K=D[j],Z=D[j+1],te=0;const ce=N;let ue,xe;v&&(te=Math.hypot(Z.x-K.x,Z.y-K.y),N+=te,ue=K,xe=Z),K.x<o&&Z.x<o||(K.x<o?K=new Wt(o,K.y+(o-K.x)/(Z.x-K.x)*(Z.y-K.y))._round():Z.x<o&&(Z=new Wt(o,K.y+(o-K.x)/(Z.x-K.x)*(Z.y-K.y))._round()),K.y<l&&Z.y<l||(K.y<l?K=new Wt(K.x+(l-K.y)/(Z.y-K.y)*(Z.x-K.x),l)._round():Z.y<l&&(Z=new Wt(K.x+(l-K.y)/(Z.y-K.y)*(Z.x-K.x),l)._round()),K.x>=u&&Z.x>=u||(K.x>=u?K=new Wt(u,K.y+(u-K.x)/(Z.x-K.x)*(Z.y-K.y))._round():Z.x>=u&&(Z=new Wt(u,K.y+(u-K.x)/(Z.x-K.x)*(Z.y-K.y))._round()),K.y>=m&&Z.y>=m||(K.y>=m?K=new Wt(K.x+(m-K.y)/(Z.y-K.y)*(Z.x-K.x),m)._round():Z.y>=m&&(Z=new Wt(K.x+(m-K.y)/(Z.y-K.y)*(Z.x-K.x),m)._round()),I&&K.equals(I[I.length-1])||(I=[K],b.push(I),v&&v.push({progress:{min:ce+Q0(ue,xe,K)*te,max:1},parentIndex:C,prevPoint:ue,nextPoint:xe})),I.push(Z),v&&(v[v.length-1].progress.max=ce+Q0(ue,xe,Z)*te,v[v.length-1].nextPoint=xe)))))}if(v&&N>0)for(let j=R;j<b.length;j++)v[j].progress.min/=N,v[j].progress.max/=N}return b}function eC(d,o,l,u,m){if(d.length<2)return void u.push(d);const v=[];for(;o.valid();){const[I,R]=o.get();for(let N=0;N<d.length-1;N++){const j=d[N],K=d[N+1],Z=fo(j,K,I,R);if(Z){const[te]=Z,ce=new Wt(Cn(j.x,K.x,te),Cn(j.y,K.y,te));v.push({t:N+te,distance:0,point:ce})}}o.next()}if(0===v.length)return void u.push(d);v.sort((I,R)=>I.t-R.t);let b=0,C=0,D=[];for(u.push(D);b!==d.length;){if(C===v.length){for(;b!==d.length;)0!==D.length&&D[D.length-1].equals(d[b])||D.push(d[b]),b++;break}v[C].t<=b?(0!==D.length&&D[D.length-1].equals(v[C].point)||D.push(v[C].point),Math.trunc(v[C].t),C++):(0!==D.length&&D[D.length-1].equals(d[b])||D.push(d[b]),b++)}}function Q0(d,o,l){return d.x!==o.x?(l.x-d.x)/(o.x-d.x):d.y!==o.y?(l.y-d.y)/(o.y-d.y):0}function av(d,o){return d.x*o.x+d.y*o.y}function lv(d,o){if(1===d.length){let l=0;const u=o[l++];let m;for(;!m||u.equals(m);)if(m=o[l++],!m)return 1/0;for(;l<o.length;l++){const v=o[l],b=d[0],C=m.sub(u),D=v.sub(u),I=b.sub(u),R=av(C,C),N=av(C,D),j=av(D,D),K=av(I,C),Z=av(I,D),te=R*j-N*N,ce=(j*K-N*Z)/te,ue=(R*Z-N*K)/te,xe=u.z*(1-ce-ue)+m.z*ce+v.z*ue;if(isFinite(xe))return xe}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function tC(d,o,l,u,m,v,b,C){const D=b*m.getElevationAt(d,o,!0,!0),I=0!==v[0],R=I?0===v[1]?b*(v[0]/7-450):b*function(N,j,K){const Z=Math.floor(j[0]/8),te=Math.floor(j[1]/8),ce=10*(j[0]-8*Z),ue=10*(j[1]-8*te),xe=N.getElevationAt(Z,te,!0,!0),ve=N.getMeterToDEM(K),ie=Math.floor(.5*(ce*ve-1)),_e=Math.floor(.5*(ue*ve-1)),we=N.tileCoordToPixel(Z,te),Ce=2*ie+1,ze=2*_e+1,qe=(Et=Ce,lt=ze,[(Tt=N).getElevationAtPixel(Nt=we.x-ie,ut=we.y-_e,!0),Tt.getElevationAtPixel(Nt+lt,ut,!0),Tt.getElevationAtPixel(Nt,ut+lt,!0),Tt.getElevationAtPixel(Nt+Et,ut+lt,!0)]),Ze=Math.abs(qe[0]-qe[1]),Xe=Math.abs(qe[2]-qe[3]),pt=Math.abs(qe[0]-qe[2])+Math.abs(qe[1]-qe[3]),Rt=Math.min(.25,.5*ve*(Ze+Xe)/Ce),Mt=Math.min(.25,.5*ve*pt/ze);var Tt,Nt,ut,Et,lt;return xe+Math.max(Rt*ce,Mt*ue)}(m,v,C):D;return{base:D+(0===l?-1:l),top:I?Math.max(R+u,D+l+2):D+u}}const fx=Ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),nC=Ei([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:iC}=fx,ym=Ei([{name:"a_packed",components:3,type:"Float32"}]),{members:xE}=ym,mx=Ei([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:cv}=mx;class rC{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new sf({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=pn(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const m=[];let v=o.length%2==1?-o[o.length-1]*u:0,b=o[0]*u,C=!0;m.push({left:v,right:b,isDash:C,zeroLength:0===o[0]});let D=o[0];for(let I=1;I<o.length;I++){C=!C;const R=o[I];v=D*u,D+=R,b=D*u,m.push({left:v,right:b,isDash:C,zeroLength:0===R})}return m}addRoundDash(o,l,u){const m=l/2;for(let v=-u;v<=u;v++){const b=this.width*(this.nextRow+u+v);let C=0,D=o[C];for(let I=0;I<this.width;I++){I/D.right>1&&(D=o[++C]);const R=Math.abs(I-D.left),N=Math.abs(I-D.right),j=Math.min(R,N);let K;const Z=v/u*(m+1);if(D.isDash){const te=m-Math.abs(Z);K=Math.sqrt(j*j+te*te)}else K=m-Math.sqrt(j*j+Z*Z);this.image.data[b+I]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(o,l){for(let D=o.length-1;D>=0;--D){const I=o[D],R=o[D+1];I.zeroLength?o.splice(D,1):R&&R.isDash===I.isDash&&(R.left=I.left,o.splice(D,1))}const u=o[0],m=o[o.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const v=this.width*this.nextRow;let b=0,C=o[b];for(let D=0;D<this.width;D++){D/C.right>1&&(C=o[++b]);const I=Math.abs(D-C.left),R=Math.abs(D-C.right),N=Math.min(I,R);this.image.data[v+D]=Math.max(0,Math.min(255,(C.isDash?N:-N)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const m="round"===l,v=m?7:0,b=2*v+1;if(this.nextRow+b>this.height)return ci("LineAtlas out of space"),null;0===o.length&&o.push(1);let C=0;for(let R=0;R<o.length;R++)o[R]<0&&(ci("Negative value is found in line dasharray, replacing values with 0"),o[R]=0),C+=o[R];if(0!==C){const R=this.width/C,N=this.getDashRanges(o,this.width,R);m?this.addRoundDash(N,R,v):this.addRegularDash(N,"square"===l?.5*R:0)}const D=this.nextRow+v;this.nextRow+=b;const I={tl:[D,v],br:[C,0]};return this.positions[u]=I,I}}ln(rC,"LineAtlas");const gx=fp.VectorTileFeature.types,dv=Math.cos(Math.PI/180*37.5),Yd=Math.cos(Math.PI/180*5);class pf{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new vu,this.layoutVertexArray2=new al,this.patternVertexArray=new al,this.indexArray=new Qs,this.programConfigurations=new dp(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new ro,this.maxLineLength=0,this.zOffsetVertexArray=new al,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:Xt/64}updateFootprints(o,l){}populate(o,l,u,m){this.hasPattern=Wy("line",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Je(u);const b=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===b)this.elevationType="road";else{const j=this.layers[0].layout.get("line-z-offset"),K=j.isConstant()&&!j.constantOr(0);this.elevationType="sea"!==b&&"ground"!==b&&K?"none":"offset","offset"===this.elevationType&&"none"===b&&ci(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const C=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==C;const D=[];for(const{feature:j,id:K,index:Z,sourceLayerIndex:te}of o){const ce=this.layers[0]._featureFilter.needGeometry,ue=bn(j,ce);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),ue,u))continue;const xe=v?v.evaluate(ue,{},u):void 0,ve={id:K,properties:j.properties,type:j.type,sourceLayerIndex:te,index:Z,geometry:ce?ue.geometry:fn(j,u,m),patterns:{},sortKey:xe};D.push(ve)}v&&D.sort((j,K)=>j.sortKey-K.sortKey);const{lineAtlas:I,featureIndex:R}=l,N=this.addConstantDashes(I);for(const j of D){const{geometry:K,index:Z,sourceLayerIndex:te}=j;if(N&&this.addFeatureDashes(j,I),this.hasPattern){const ce=Zy("line",this.layers,j,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ce)}else this.addFeature(j,K,Z,u,I.positions,l.availableImages,l.brightness,l.elevationFeatures);R.insert(o[Z].feature,K,Z,te,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,v=u.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==v.kind)l=!0;else{const b=v.value,C=m.value;if(!C)continue;o.addDash(C,b)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const m of this.layers){const v=m.paint.get("line-dasharray").value,b=m.layout.get("line-cap").value;if("constant"===v.kind&&"constant"===b.kind)continue;let C,D;if("constant"===v.kind){if(C=v.value,!C)continue}else C=v.evaluate({zoom:u},o);D="constant"===b.kind?b.value:b.evaluate({zoom:u},o),l.addDash(C,D),o.patterns[m.id]=[l.getKey(C,D)]}}update(o,l,u,m,v,b,C){this.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C)}addFeatures(o,l,u,m,v,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,l,u,m,b)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,xE)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,cv)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,nC.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,iC),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,m,v,b,C,D){const I=this.layers[0].layout,R=I.get("line-join").evaluate(o,{}),N=I.get("line-cap").evaluate(o,{}),j=I.get("line-miter-limit"),K=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=I.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if("constant"!==Z.kind&&!1===Z.isLineProgressConstant&&(this.variableWidthValue=Z),"road"===this.elevationType){const te=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(o,l,m,D,R,N,j,K)){const[ce,ue]=this.clipRuntimeLinesToTile(l,1);for(let xe=0;xe<ce.length;xe++){const ve=ce[xe],ie=ue[xe],_e={progress:{min:ie.progress.min,max:ie.progress.max},nextDir:this.computeSegNextDir(ie,ve),prevDir:this.computeSegPrevDir(ie,ve)};this.addLine(ve,o,m,R,N,j,K,_e)}this.fillNonElevatedRoadSegment(te)}}else for(const te of l)this.addLine(te,o,m,R,N,j,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,v,b,m,C)}computeSegNextDir(o,l){return o.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(o,l){return l[1].sub(o.prevPoint).unit()}clipLinesToTile(o,l){return K0(o,-l,-l,Xt+l,Xt+l)}clipRuntimeLinesToTile(o,l){const u=[];return[K0(o,-l,-l,Xt+l,Xt+l,u),u]}addElevatedRoadFeature(o,l,u,m,v,b,C,D){const I=[],R=Yb.getElevationFeature(o,m);if(R){const N=this.clipLinesToTile(l,1),j=this.prepareElevatedLines(N,R,u);for(const K of j)I.push({geometry:K,elevation:R,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===I.length)return!1;for(const N of I){const j=this.layoutVertexArray.length;this.addLine(N.geometry,o,u,v,b,C,D);const K=new Xb(u,N.elevationTileID);if(N.elevation)for(let Z=j;Z<this.layoutVertexArray.length;Z++){const te=new Wt(this.layoutVertexArray.int16[6*Z]>>1,this.layoutVertexArray.int16[6*Z+1]>>1),ce=K.pointElevation(te,N.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(j)}return!0}prepareElevatedLines(o,l,u){if(null!=l.constantHeight)return o;const m=[],v=1/Je(u);for(const b of o)eC(b,new BM(l,v),0,m);return m}fillNonElevatedRoadSegment(o){for(let l=o;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(o){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,o),this.heightRange.max=Math.max(this.heightRange.max,o)):this.heightRange={min:o,max:o}}addLine(o,l,u,m,v,b,C,D){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I="none"===m;this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const R=D&&D.progress.min>0,N=D&&D.progress.max<1;if(this.lineClips){let ze={min:this.lineClips.start,max:this.lineClips.end},qe=1;if(D){const pt=this.lineClips.end-this.lineClips.start;ze={min:Jo((Rt=D.progress).min,Mt={min:0,max:1},Tt=ze),max:Jo(Rt.max,Mt,Tt)},pt>0&&(qe=(ze.max-ze.min)/pt)}const Ze=+l.properties.mapbox_clip_feature_len,Xe=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(Ze)||Number.isNaN(Xe)){for(let Rt=0;Rt<o.length-1;Rt++)this.totalDistance+=o[Rt].dist(o[Rt+1]);const pt=this.totalDistance/(ze.max-ze.min);this.totalFeatureLength=Number.isFinite(pt)?pt:0,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ze,this.distance=Xe*qe,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}var Rt,Mt,Tt;const j="Polygon"===gx[l.type];let K=o.length;for(;K>=2&&o[K-1].equals(o[K-2]);)K--;let Z=0;for(;Z<K-1&&o[Z].equals(o[Z+1]);)Z++;if(K<(j?3:2))return;"bevel"===m&&(b=1.05);const te=this.segments.prepareSegment(10*K,this.layoutVertexArray,this.indexArray);let ce,ue,xe,ve,ie,_e,we,Ce;D&&D.prevDir&&(_e=D.prevDir.perp()),D&&D.nextDir&&(we=D.nextDir.perp()),this.e1=this.e2=-1,j&&(ce=o[K-2],ie=o[Z].sub(ce)._unit()._perp());for(let ze=Z;ze<K;ze++){if(xe=ze===K-1?j?o[Z+1]:void 0:o[ze+1],xe&&o[ze].equals(xe))continue;ie&&(ve=ie),ce&&(ue=ce),ce=o[ze],Ce=this.evaluateLineProgressFeatures(ue?ue.dist(ce):0),ie=xe?xe.sub(ce)._unit()._perp():ve,ve=ve||ie;const qe=ue&&xe;let Ze=qe?m:j||I?"butt":v;const Xe=ve.x*ie.x+ve.y*ie.y;if(I){const lt=function(gt){if(gt.patternJoinNone){const Bt=gt.segmentPoints.length/2,q=gt.lineSoFar-gt.segmentStart;for(let gn=0;gn<Bt;++gn){const hn=gt.segmentPoints[2*gn+1],Kt=Math.round(gt.segmentPoints[2*gn])+.5+.25*hn;gt.patternVertexArray.emplaceBack(Kt,q,gt.segmentStart),gt.patternVertexArray.emplaceBack(Kt,q,gt.segmentStart)}gt.segmentPoints.length=0}gt.e1=gt.e2=-1};if(qe&&Xe<Yd){this.updateDistance(ue,ce),this.addCurrentVertex(ce,ve,1,1,te,Ce),lt(this),this.addCurrentVertex(ce,ie,-1,-1,te,Ce);continue}if(ue){if(!xe){this.updateDistance(ue,ce),this.addCurrentVertex(ce,ve,1,1,te,Ce),lt(this);continue}Ze="miter"}}let pt=ve.add(ie);0===pt.x&&0===pt.y||pt._unit();const Rt=pt.x*ie.x+pt.y*ie.y,Mt=0!==Rt?1/Rt:1/0,Tt=2*Math.sqrt(2-2*Rt),Nt=Rt<dv&&ue&&xe,ut=ve.x*ie.y-ve.y*ie.x>0,Et=this.overscaling<=16?15*Xt/(512*this.overscaling):0;if(qe&&"round"===Ze)if(Mt<C)Ze="miter";else if(Mt<=2){const lt=J0(ce,-10,Xt+10);Ze="offset"===this.elevationType&&(lt||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===Ze&&Mt>b&&(Ze="bevel"),"bevel"===Ze&&(Mt>2&&(Ze="flipbevel"),Mt<b&&(Ze="miter")),ue&&!("miter"===Ze&&Nt)&&this.updateDistance(ue,ce),"miter"===Ze)if(Nt){const lt=ce.dist(ue);if(lt>2*Et){const Bt=ce.sub(ce.sub(ue)._mult(Et/lt)._round());this.updateDistance(ue,Bt),this.addCurrentVertex(Bt,ve,0,0,te,Ce),ue=Bt}this.updateDistance(ue,ce),pt._mult(Mt),this.addCurrentVertex(ce,pt,0,0,te,Ce);const gt=ce.dist(xe);if(gt>2*Et){const Bt=ce.add(xe.sub(ce)._mult(Et/gt)._round());this.updateDistance(ce,Bt),this.addCurrentVertex(Bt,ie,0,0,te,Ce),ce=Bt}}else pt._mult(Mt),this.addCurrentVertex(ce,pt,0,0,te,Ce);else if("flipbevel"===Ze){if(Mt>100)pt=ie.mult(-1);else{const lt=Mt*ve.add(ie).mag()/ve.sub(ie).mag();pt._perp()._mult(lt*(ut?-1:1))}this.addCurrentVertex(ce,pt,0,0,te,Ce),this.addCurrentVertex(ce,pt.mult(-1),0,0,te,Ce)}else if("bevel"===Ze||"fakeround"===Ze){null!=Ce&&ue&&this.addCurrentVertex(ce,we||ve,-1,-1,te,Ce);const lt=ce.dist(ue)<=2*Et&&"bevel"!==Ze,gt=pt.mult(ut?1:-1);gt._mult(Mt);const Bt=ie.mult(ut?-1:1),q=ve.mult(ut?-1:1),gn=this.evaluateLineProgressFeatures(this.distance);if(null==Ce&&(this.addHalfVertex(ce,gt.x,gt.y,!1,!ut,0,te,gn),lt||this.addHalfVertex(ce,gt.x+2*q.x,gt.y+2*q.y,!1,ut,0,te,gn)),"fakeround"===Ze){const hn=Math.round(180*Tt/Math.PI/20);this.addHalfVertex(ce,q.x,q.y,!1,ut,0,te,gn);for(let Kt=0;Kt<hn;Kt++){let Qe=Kt/hn;if(.5!==Qe){const Yt=Qe-.5;Qe+=Qe*Yt*(Qe-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*Yt*Yt+(.848013+Xe*(.215638*Xe-1.06021)))}const Ft=Bt.sub(q)._mult(Qe)._add(q)._unit();this.addHalfVertex(ce,Ft.x,Ft.y,!1,ut,0,te,gn)}this.addHalfVertex(ce,Bt.x,Bt.y,!1,ut,0,te,gn)}lt||null!=Ce||this.addHalfVertex(ce,gt.x+2*Bt.x,gt.y+2*Bt.y,!1,ut,0,te,gn),null!=Ce&&xe&&this.addCurrentVertex(ce,_e||ie,1,1,te,Ce)}else if("butt"===Ze)this.addCurrentVertex(ce,pt,0,0,te,Ce);else if("square"===Ze){if(!ue){const lt=R?0:-1;this.addCurrentVertex(ce,pt,lt,lt,te,Ce)}if(this.addCurrentVertex(ce,pt,0,0,te,Ce),ue){const lt=N?0:1;this.addCurrentVertex(ce,pt,lt,lt,te,Ce)}}else if("round"===Ze){if(ue){const lt=!qe&&we?we:ve;this.addCurrentVertex(ce,lt,0,0,te,Ce),!qe&&N||this.addCurrentVertex(ce,lt,1,1,te,Ce,!0)}if(xe){const lt=!qe&&_e?_e:ie;!qe&&R||this.addCurrentVertex(ce,lt,-1,-1,te,Ce,!0),this.addCurrentVertex(ce,lt,0,0,te,Ce)}}}}addVerticesTo(o,l,u,m,v,b,C,D,I,R){const N=(l.w-o.w)/this.tessellationStep|0;let j=0;const K=this.scaledDistance;if(N>1){this.lineSoFar=o.w;const te=(l.x-o.x)/N,ce=(l.y-o.y)/N,ue=(l.z-o.z)/N,xe=(l.w-o.w)/N;for(let ve=1;ve<N;++ve){o.x+=te,o.y+=ce,o.z+=ue,this.lineSoFar+=xe,j+=xe;const ie=this.evaluateLineProgressFeatures(this.prevDistance+j);this.scaledDistance=(this.prevDistance+j)/this.totalDistance,this.addHalfVertex(o,u,m,R,!1,C,I,ie),this.addHalfVertex(o,v,b,R,!0,-D,I,ie)}}this.lineSoFar=l.w,this.scaledDistance=K;const Z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,u,m,R,!1,C,I,Z),this.addHalfVertex(l,v,b,R,!0,-D,I,Z)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):ci(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:l}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(o,l,u,m,v,b,C=!1){const D=l.x+l.y*u,I=l.y-l.x*u,R=l.y*m-l.x,N=-l.y-l.x*m;if(null!=b){const j="offset"===this.elevationType,K=-10,Z=Xt+10,te=b.zOffset,ce=new ov(o.x,o.y,te,this.lineSoFar),ue=!!j&&J0(o,K,Z),xe=this.lineSoFar,ve=this.distance;if(this.currentVertex)if(ue){const ie=this.currentVertexIsOutside,_e=this.currentVertex,we=new ov(o.x,o.y,te,this.lineSoFar);if(JM(_e,we,K,Z),!J0(we,K,Z)){if(ie){this.e1=this.e2=-1,this.distance-=_e.dist(ce),this.lineSoFar=_e.w;const Ce=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,D,I,C,!1,u,v,Ce),this.addHalfVertex(_e,R,N,C,!0,-m,v,Ce),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,we,D,I,R,N,u,m,v,C),this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}}else{const ie=this.currentVertex;if(this.currentVertexIsOutside){JM(ie,ce,K,Z),this.e1=this.e2=-1,this.distance-=ie.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;const _e=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,D,I,C,!1,u,v,_e),this.addHalfVertex(ie,R,N,C,!0,-m,v,_e),this.prevDistance=this.distance,this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,ce,D,I,R,N,u,m,v,C)}else ue||(this.addHalfVertex(o,D,I,C,!1,u,v,b),this.addHalfVertex(o,R,N,C,!0,-m,v,b));this.currentVertex=ce,this.currentVertexIsOutside=ue,this.lineSoFar=xe}else this.addHalfVertex(o,D,I,C,!1,u,v,b),this.addHalfVertex(o,R,N,C,!0,-m,v,b)}addHalfVertex({x:o,y:l},u,m,v,b,C,D,I){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,C)),this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(l<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const N=Cn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,N)}const R=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),D.primitiveLength++),b?this.e2=R:this.e1=R,null!=I&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,l){this.prevDistance=this.distance,this.distance+=o.dist(l),this.updateScaledDistance()}}function J0(d,o,l){return d.x<o||d.x>l||d.y<o||d.y>l}let oC,sC;function _x(d,o,l){return o*(Xt/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}ln(pf,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const vm=(d,o,l)=>(1-l)*d+l*o;function aC(d,o){return 1/_x(d,1,o.tileZoom)}function lC(d,o,l,u){return d.translatePosMatrix(u||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const cC=d=>{const o=[];hv(d)&&o.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const l=d.paint.get("line-trim-offset");0===l[0]&&0===l[1]||o.push("RENDER_LINE_TRIM_OFFSET"),0!==d.paint.get("line-border-width").constantOr(1)&&o.push("RENDER_LINE_BORDER");const u="none"===d.layout.get("line-join").constantOr("miter"),m=!!d.paint.get("line-pattern").constantOr(1);return u&&m&&o.push("LINE_JOIN_NONE"),o};function hv(d){const o=d.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}let n1;const dC=()=>n1||(n1={layout:oC||(oC=new jo({"line-cap":new nn(it.layout_line["line-cap"]),"line-join":new nn(it.layout_line["line-join"]),"line-miter-limit":new Ut(it.layout_line["line-miter-limit"]),"line-round-limit":new Ut(it.layout_line["line-round-limit"]),"line-sort-key":new nn(it.layout_line["line-sort-key"]),"line-z-offset":new nn(it.layout_line["line-z-offset"]),"line-elevation-reference":new Ut(it.layout_line["line-elevation-reference"]),"line-cross-slope":new Ut(it.layout_line["line-cross-slope"]),visibility:new Ut(it.layout_line.visibility),"line-width-unit":new Ut(it.layout_line["line-width-unit"])})),paint:sC||(sC=new jo({"line-opacity":new nn(it.paint_line["line-opacity"]),"line-color":new nn(it.paint_line["line-color"]),"line-translate":new Ut(it.paint_line["line-translate"]),"line-translate-anchor":new Ut(it.paint_line["line-translate-anchor"]),"line-width":new nn(it.paint_line["line-width"]),"line-gap-width":new nn(it.paint_line["line-gap-width"]),"line-offset":new nn(it.paint_line["line-offset"]),"line-blur":new nn(it.paint_line["line-blur"]),"line-dasharray":new nn(it.paint_line["line-dasharray"]),"line-pattern":new nn(it.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ut(it.paint_line["line-pattern-cross-fade"]),"line-gradient":new yu(it.paint_line["line-gradient"]),"line-trim-offset":new Ut(it.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ut(it.paint_line["line-trim-fade-range"]),"line-trim-color":new Ut(it.paint_line["line-trim-color"]),"line-emissive-strength":new Ut(it.paint_line["line-emissive-strength"]),"line-border-width":new nn(it.paint_line["line-border-width"]),"line-border-color":new nn(it.paint_line["line-border-color"]),"line-occlusion-opacity":new Ut(it.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},n1);class hC extends nn{possiblyEvaluate(o,l){return l=new dr(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,u,m){return l=tt({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,u,m)}}let mh;function wE(d,o){return o>0?o+2*d:d}const r1=Ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yx=Ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),kE=Ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const B6=Ei([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),V6=Ei([{name:"a_texb",components:2,type:"Uint16"}]),uv=Ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ME=Ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const pv=Ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vx=Ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ei([{name:"triangle",components:3,type:"Uint16"}]),Ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ei([{type:"Float32",name:"offsetX"}]),Ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var xs=24;function bx(d,o,l){return d.sections.forEach(u=>{u.text=function(m,v,b){const C=v.layout.get("text-transform").evaluate(b,{});return"uppercase"===C?m=m.toLocaleUpperCase():"lowercase"===C&&(m=m.toLocaleLowerCase()),Yr.applyArabicShaping&&(m=Yr.applyArabicShaping(m)),m}(u.text,o,l)}),d}const bm={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function e_(d){return"\ufe36"===d||"\ufe48"===d||"\ufe38"===d||"\ufe44"===d||"\ufe42"===d||"\ufe3e"===d||"\ufe3c"===d||"\ufe3a"===d||"\ufe18"===d||"\ufe40"===d||"\ufe10"===d||"\ufe13"===d||"\ufe14"===d||"\uff40"===d||"\uffe3"===d||"\ufe11"===d||"\ufe12"===d}function fv(d){return"\ufe35"===d||"\ufe47"===d||"\ufe37"===d||"\ufe43"===d||"\ufe41"===d||"\ufe3d"===d||"\ufe3b"===d||"\ufe39"===d||"\ufe17"===d||"\ufe3f"===d}var xm,t_,mv,o1={};function gv(){if(mv)return t_;mv=1,t_=o;var d=function j6(){return xm||(xm=1,o1.read=function(d,o,l,u,m){var v,b,C=8*m-u-1,D=(1<<C)-1,I=D>>1,R=-7,N=l?m-1:0,j=l?-1:1,K=d[o+N];for(N+=j,v=K&(1<<-R)-1,K>>=-R,R+=C;R>0;v=256*v+d[o+N],N+=j,R-=8);for(b=v&(1<<-R)-1,v>>=-R,R+=u;R>0;b=256*b+d[o+N],N+=j,R-=8);if(0===v)v=1-I;else{if(v===D)return b?NaN:1/0*(K?-1:1);b+=Math.pow(2,u),v-=I}return(K?-1:1)*b*Math.pow(2,v-u)},o1.write=function(d,o,l,u,m,v){var b,C,D,I=8*v-m-1,R=(1<<I)-1,N=R>>1,j=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,K=u?0:v-1,Z=u?1:-1,te=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(C=isNaN(o)?1:0,b=R):(b=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-b))<1&&(b--,D*=2),(o+=b+N>=1?j/D:j*Math.pow(2,1-N))*D>=2&&(b++,D/=2),b+N>=R?(C=0,b=R):b+N>=1?(C=(o*D-1)*Math.pow(2,m),b+=N):(C=o*Math.pow(2,N-1)*Math.pow(2,m),b=0));m>=8;d[l+K]=255&C,K+=Z,C/=256,m-=8);for(b=b<<m|C,I+=m;I>0;d[l+K]=255&b,K+=Z,b/=256,I-=8);d[l+K-Z]|=128*te}),o1}();function o(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var l=4294967296,u=1/l,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function v(ie){return ie.type===o.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function C(ie,_e,we){var Ce=_e<=16383?1:_e<=2097151?2:_e<=268435455?3:Math.floor(Math.log(_e)/(7*Math.LN2));we.realloc(Ce);for(var ze=we.pos-1;ze>=ie;ze--)we.buf[ze+Ce]=we.buf[ze]}function D(ie,_e){for(var we=0;we<ie.length;we++)_e.writeVarint(ie[we])}function I(ie,_e){for(var we=0;we<ie.length;we++)_e.writeSVarint(ie[we])}function R(ie,_e){for(var we=0;we<ie.length;we++)_e.writeFloat(ie[we])}function N(ie,_e){for(var we=0;we<ie.length;we++)_e.writeDouble(ie[we])}function j(ie,_e){for(var we=0;we<ie.length;we++)_e.writeBoolean(ie[we])}function K(ie,_e){for(var we=0;we<ie.length;we++)_e.writeFixed32(ie[we])}function Z(ie,_e){for(var we=0;we<ie.length;we++)_e.writeSFixed32(ie[we])}function te(ie,_e){for(var we=0;we<ie.length;we++)_e.writeFixed64(ie[we])}function ce(ie,_e){for(var we=0;we<ie.length;we++)_e.writeSFixed64(ie[we])}function ue(ie,_e){return(ie[_e]|ie[_e+1]<<8|ie[_e+2]<<16)+16777216*ie[_e+3]}function xe(ie,_e,we){ie[we]=_e,ie[we+1]=_e>>>8,ie[we+2]=_e>>>16,ie[we+3]=_e>>>24}function ve(ie,_e){return(ie[_e]|ie[_e+1]<<8|ie[_e+2]<<16)+(ie[_e+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(ie,_e,we){for(we=we||this.length;this.pos<we;){var Ce=this.readVarint(),ze=Ce>>3,qe=this.pos;this.type=7&Ce,ie(ze,_e,this),this.pos===qe&&this.skip(Ce)}return _e},readMessage:function(ie,_e){return this.readFields(ie,_e,this.readVarint()+this.pos)},readFixed32:function(){var ie=ue(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=ve(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=ue(this.buf,this.pos)+ue(this.buf,this.pos+4)*l;return this.pos+=8,ie},readSFixed64:function(){var ie=ue(this.buf,this.pos)+ve(this.buf,this.pos+4)*l;return this.pos+=8,ie},readFloat:function(){var ie=d.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=d.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var _e,we,Ce=this.buf;return _e=127&(we=Ce[this.pos++]),we<128?_e:(_e|=(127&(we=Ce[this.pos++]))<<7,we<128?_e:(_e|=(127&(we=Ce[this.pos++]))<<14,we<128?_e:(_e|=(127&(we=Ce[this.pos++]))<<21,we<128?_e:function(ze,qe,Ze){var Xe,pt,Rt=Ze.buf;if(Xe=(112&(pt=Rt[Ze.pos++]))>>4,pt<128||(Xe|=(127&(pt=Rt[Ze.pos++]))<<3,pt<128)||(Xe|=(127&(pt=Rt[Ze.pos++]))<<10,pt<128)||(Xe|=(127&(pt=Rt[Ze.pos++]))<<17,pt<128)||(Xe|=(127&(pt=Rt[Ze.pos++]))<<24,pt<128)||(Xe|=(1&(pt=Rt[Ze.pos++]))<<31,pt<128))return function b(ie,_e,we){return we?4294967296*_e+(ie>>>0):4294967296*(_e>>>0)+(ie>>>0)}(ze,Xe,qe);throw new Error("Expected varint not more than 10 bytes")}(_e|=(15&(we=Ce[this.pos]))<<28,ie,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2==1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,_e=this.pos;return this.pos=ie,ie-_e>=12&&m?m.decode(this.buf.subarray(_e,ie)):function(we,Ce,ze){for(var qe="",Ze=Ce;Ze<ze;){var Xe,pt,Rt,Mt=we[Ze],Tt=null,Nt=Mt>239?4:Mt>223?3:Mt>191?2:1;if(Ze+Nt>ze)break;1===Nt?Mt<128&&(Tt=Mt):2===Nt?128==(192&(Xe=we[Ze+1]))&&(Tt=(31&Mt)<<6|63&Xe)<=127&&(Tt=null):3===Nt?(pt=we[Ze+2],128==(192&(Xe=we[Ze+1]))&&128==(192&pt)&&((Tt=(15&Mt)<<12|(63&Xe)<<6|63&pt)<=2047||Tt>=55296&&Tt<=57343)&&(Tt=null)):4===Nt&&(pt=we[Ze+2],Rt=we[Ze+3],128==(192&(Xe=we[Ze+1]))&&128==(192&pt)&&128==(192&Rt)&&((Tt=(15&Mt)<<18|(63&Xe)<<12|(63&pt)<<6|63&Rt)<=65535||Tt>=1114112)&&(Tt=null)),null===Tt?(Tt=65533,Nt=1):Tt>65535&&(Tt-=65536,qe+=String.fromCharCode(Tt>>>10&1023|55296),Tt=56320|1023&Tt),qe+=String.fromCharCode(Tt),Ze+=Nt}return qe}(this.buf,_e,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,_e=this.buf.subarray(this.pos,ie);return this.pos=ie,_e},readPackedVarint:function(ie,_e){if(this.type!==o.Bytes)return ie.push(this.readVarint(_e));var we=v(this);for(ie=ie||[];this.pos<we;)ie.push(this.readVarint(_e));return ie},readPackedSVarint:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSVarint());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==o.Bytes)return ie.push(this.readBoolean());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFloat());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==o.Bytes)return ie.push(this.readDouble());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFixed32());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSFixed32());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==o.Bytes)return ie.push(this.readFixed64());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==o.Bytes)return ie.push(this.readSFixed64());var _e=v(this);for(ie=ie||[];this.pos<_e;)ie.push(this.readSFixed64());return ie},skip:function(ie){var _e=7&ie;if(_e===o.Varint)for(;this.buf[this.pos++]>127;);else if(_e===o.Bytes)this.pos=this.readVarint()+this.pos;else if(_e===o.Fixed32)this.pos+=4;else{if(_e!==o.Fixed64)throw new Error("Unimplemented type: "+_e);this.pos+=8}},writeTag:function(ie,_e){this.writeVarint(ie<<3|_e)},realloc:function(ie){for(var _e=this.length||16;_e<this.pos+ie;)_e*=2;if(_e!==this.length){var we=new Uint8Array(_e);we.set(this.buf),this.buf=we,this.length=_e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),xe(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),xe(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),xe(this.buf,-1&ie,this.pos),xe(this.buf,Math.floor(ie*u),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),xe(this.buf,-1&ie,this.pos),xe(this.buf,Math.floor(ie*u),this.pos+4),this.pos+=8},writeVarint:function(ie){(ie=+ie||0)>268435455||ie<0?function(_e,we){var Ce,ze,qe,Xe;if(_e>=0?(Ce=_e%4294967296|0,ze=_e/4294967296|0):(ze=~(-_e/4294967296),4294967295^(Ce=~(-_e%4294967296))?Ce=Ce+1|0:(Ce=0,ze=ze+1|0)),_e>=0x10000000000000000||_e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");we.realloc(10),qe=Ce,(Xe=we).buf[Xe.pos++]=127&qe|128,qe>>>=7,Xe.buf[Xe.pos++]=127&qe|128,qe>>>=7,Xe.buf[Xe.pos++]=127&qe|128,qe>>>=7,Xe.buf[Xe.pos++]=127&qe|128,Xe.buf[Xe.pos]=127&(qe>>>=7),function(qe,Ze){var Xe=(7&qe)<<4;Ze.buf[Ze.pos++]|=Xe|((qe>>>=3)?128:0),qe&&(Ze.buf[Ze.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ze.buf[Ze.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ze.buf[Ze.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ze.buf[Ze.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ze.buf[Ze.pos++]=127&qe)))))}(ze,we)}(ie,this):(this.realloc(4),this.buf[this.pos++]=127&ie|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=ie>>>7&127))))},writeSVarint:function(ie){this.writeVarint(ie<0?2*-ie-1:2*ie)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(4*ie.length),this.pos++;var _e=this.pos;this.pos=function(Ce,ze,qe){for(var Ze,Xe,pt=0;pt<ze.length;pt++){if((Ze=ze.charCodeAt(pt))>55295&&Ze<57344){if(!Xe){Ze>56319||pt+1===ze.length?(Ce[qe++]=239,Ce[qe++]=191,Ce[qe++]=189):Xe=Ze;continue}if(Ze<56320){Ce[qe++]=239,Ce[qe++]=191,Ce[qe++]=189,Xe=Ze;continue}Ze=Xe-55296<<10|Ze-56320|65536,Xe=null}else Xe&&(Ce[qe++]=239,Ce[qe++]=191,Ce[qe++]=189,Xe=null);Ze<128?Ce[qe++]=Ze:(Ze<2048?Ce[qe++]=Ze>>6|192:(Ze<65536?Ce[qe++]=Ze>>12|224:(Ce[qe++]=Ze>>18|240,Ce[qe++]=Ze>>12&63|128),Ce[qe++]=Ze>>6&63|128),Ce[qe++]=63&Ze|128)}return qe}(this.buf,ie,this.pos);var we=this.pos-_e;we>=128&&C(_e,we,this),this.pos=_e-1,this.writeVarint(we),this.pos+=we},writeFloat:function(ie){this.realloc(4),d.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),d.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var _e=ie.length;this.writeVarint(_e),this.realloc(_e);for(var we=0;we<_e;we++)this.buf[this.pos++]=ie[we]},writeRawMessage:function(ie,_e){this.pos++;var we=this.pos;ie(_e,this);var Ce=this.pos-we;Ce>=128&&C(we,Ce,this),this.pos=we-1,this.writeVarint(Ce),this.pos+=Ce},writeMessage:function(ie,_e,we){this.writeTag(ie,o.Bytes),this.writeRawMessage(_e,we)},writePackedVarint:function(ie,_e){_e.length&&this.writeMessage(ie,D,_e)},writePackedSVarint:function(ie,_e){_e.length&&this.writeMessage(ie,I,_e)},writePackedBoolean:function(ie,_e){_e.length&&this.writeMessage(ie,j,_e)},writePackedFloat:function(ie,_e){_e.length&&this.writeMessage(ie,R,_e)},writePackedDouble:function(ie,_e){_e.length&&this.writeMessage(ie,N,_e)},writePackedFixed32:function(ie,_e){_e.length&&this.writeMessage(ie,K,_e)},writePackedSFixed32:function(ie,_e){_e.length&&this.writeMessage(ie,Z,_e)},writePackedFixed64:function(ie,_e){_e.length&&this.writeMessage(ie,te,_e)},writePackedSFixed64:function(ie,_e){_e.length&&this.writeMessage(ie,ce,_e)},writeBytesField:function(ie,_e){this.writeTag(ie,o.Bytes),this.writeBytes(_e)},writeFixed32Field:function(ie,_e){this.writeTag(ie,o.Fixed32),this.writeFixed32(_e)},writeSFixed32Field:function(ie,_e){this.writeTag(ie,o.Fixed32),this.writeSFixed32(_e)},writeFixed64Field:function(ie,_e){this.writeTag(ie,o.Fixed64),this.writeFixed64(_e)},writeSFixed64Field:function(ie,_e){this.writeTag(ie,o.Fixed64),this.writeSFixed64(_e)},writeVarintField:function(ie,_e){this.writeTag(ie,o.Varint),this.writeVarint(_e)},writeSVarintField:function(ie,_e){this.writeTag(ie,o.Varint),this.writeSVarint(_e)},writeStringField:function(ie,_e){this.writeTag(ie,o.Bytes),this.writeString(_e)},writeFloatField:function(ie,_e){this.writeTag(ie,o.Fixed32),this.writeFloat(_e)},writeDoubleField:function(ie,_e){this.writeTag(ie,o.Fixed64),this.writeDouble(_e)},writeBooleanField:function(ie,_e){this.writeVarintField(ie,!!_e)}},t_}var ff=mc(gv());const xx=3;function uC(d,o,l){o.glyphs=[],1===d&&l.readMessage(CE,o)}function CE(d,o,l){if(3===d){const{id:u,bitmap:m,width:v,height:b,left:C,top:D,advance:I}=l.readMessage(SE,{});o.glyphs.push({id:u,bitmap:new sf({width:v+2*xx,height:b+2*xx},m),metrics:{width:v,height:b,left:C,top:D,advance:I}})}else 4===d?o.ascender=l.readSVarint():5===d&&(o.descender=l.readSVarint())}function SE(d,o,l){1===d?o.id=l.readVarint():2===d?o.bitmap=l.readBytes():3===d?o.width=l.readVarint():4===d?o.height=l.readVarint():5===d?o.left=l.readSVarint():6===d?o.top=l.readSVarint():7===d&&(o.advance=l.readVarint())}const _v=xx,Dc={horizontal:1,vertical:2,horizontalOnly:3};class n_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,l){const u=new n_;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new n_;return l.image=o,l}}class s1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l,u){const m=new s1;for(let v=0;v<o.sections.length;v++){const b=o.sections[v];b.image?m.addImageSection(b,u):m.addTextSection(b,l)}return m}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,u){let m="";for(let v=0;v<l.length;v++){const b=l.charCodeAt(v+1)||null,C=l.charCodeAt(v-1)||null;m+=!u&&(b&&g0(b)&&!bm[l[v+1]]||C&&g0(C)&&!bm[l[v-1]])||!bm[l[v]]?l[v]:bm[l[v]]}return m}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&yv[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&yv[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new s1;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(n_.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(u)}addImageSection(o,l){const u=o.image?o.image.getPrimary():null;if(!u)return void ci("Can't add FormattedSection with an empty image.");u.scaleSelf(l);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(n_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pC(d,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te=1){const ce=s1.fromFeature(d,m,te);N===Dc.vertical&&ce.verticalizePunctuation(j);let ue=[];const xe=function(Ce,ze,qe,Ze,Xe,pt){if(!Ce)return[];const Rt=[],Mt=function(Et,lt,gt,Bt,q,gn){let hn=0;for(let Kt=0;Kt<Et.length();Kt++){const Qe=Et.getSection(Kt);hn+=bv(Et.getCodePoint(Kt),Qe,Bt,q,lt,gn)}return hn/Math.max(1,Math.ceil(hn/gt))}(Ce,ze,qe,Ze,Xe,pt),Tt=Ce.text.indexOf("\u200b")>=0;let Nt=0;for(let Et=0;Et<Ce.length();Et++){const lt=Ce.getSection(Et),gt=Ce.getCodePoint(Et);if(yv[gt]||(Nt+=bv(gt,lt,Ze,Xe,ze,pt)),Et<Ce.length()-1){const Bt=!((ut=gt)<11904||!(Pn["Bopomofo Extended"](ut)||Pn.Bopomofo(ut)||Pn["CJK Compatibility Forms"](ut)||Pn["CJK Compatibility Ideographs"](ut)||Pn["CJK Compatibility"](ut)||Pn["CJK Radicals Supplement"](ut)||Pn["CJK Strokes"](ut)||Pn["CJK Symbols and Punctuation"](ut)||Pn["CJK Unified Ideographs Extension A"](ut)||Pn["CJK Unified Ideographs"](ut)||Pn["Enclosed CJK Letters and Months"](ut)||Pn["Halfwidth and Fullwidth Forms"](ut)||Pn.Hiragana(ut)||Pn["Ideographic Description Characters"](ut)||Pn["Kangxi Radicals"](ut)||Pn["Katakana Phonetic Extensions"](ut)||Pn.Katakana(ut)||Pn["Vertical Forms"](ut)||Pn["Yi Radicals"](ut)||Pn["Yi Syllables"](ut)));(vv[gt]||Bt||lt.image)&&Rt.push(xv(Et+1,Nt,Mt,Rt,mC(gt,Ce.getCodePoint(Et+1),Bt&&Tt),!1))}}var ut;return i_(xv(Ce.length(),Nt,Mt,Rt,0,!0))}(ce,I,v,o,u,K),{processBidirectionalText:ve,processStyledBidirectionalText:ie}=Yr;if(ve&&1===ce.sections.length){const Ce=ve(ce.toString(),xe);for(const ze of Ce){const qe=new s1;qe.text=ze,qe.sections=ce.sections;for(let Ze=0;Ze<ze.length;Ze++)qe.sectionIndex.push(0);ue.push(qe)}}else if(ie){const Ce=ie(ce.text,ce.sectionIndex,xe);for(const ze of Ce){const qe=new s1;qe.text=ze[0],qe.sectionIndex=ze[1],qe.sections=ce.sections,ue.push(qe)}}else ue=function(Ce,ze){const qe=[],Ze=Ce.text;let Xe=0;for(const pt of ze)qe.push(Ce.substring(Xe,pt)),Xe=pt;return Xe<Ze.length&&qe.push(Ce.substring(Xe,Ze.length)),qe}(ce,xe);const _e=[],we={positionedLines:_e,text:ce.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ce,ze,qe,Ze,Xe,pt,Rt,Mt,Tt,Nt,ut,Et){let lt=0,gt=0,Bt=0;const q="right"===Mt?1:"left"===Mt?0:.5;let gn=!1;for(const un of Xe){const Bn=un.getSections();for(const Kn of Bn){if(Kn.image)continue;const ri=ze[Kn.fontStack];if(ri&&(gn=void 0!==ri.ascender&&void 0!==ri.descender,!gn))break}if(!gn)break}let hn=0;for(const un of Xe){un.trim();const Bn=un.getMaxScale(),Kn=(Bn-1)*xs,ri={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[hn]=ri;const _i=ri.positionedGlyphs;let di=0;if(!un.length()){gt+=pt,++hn;continue}let li=0,Dr=0;for(let ke=0;ke<un.length();ke++){const Se=un.getSection(ke),_t=un.getSectionIndex(ke),$t=un.getCodePoint(ke);let en=Se.scale,Jt=null,_n=null,Fn=null,Di=xs,Ti=0;Tt===Dc.vertical&&(12312===(Kt=$t)||12313===Kt||12316===Kt||12540===Kt||12448===Kt)&&(Tt=Dc.horizontal);const hi=!(Tt===Dc.horizontal||!ut&&!Qf($t)||ut&&(yv[$t]||Cb($t)));if(Se.image){const ur=Ze.get(Se.image.toString());if(!ur)continue;Fn=Se.image,Ce.iconsInText=Ce.iconsInText||!0,_n=ur.paddedRect;const zr=ur.displaySize;en=en*xs/Et,Jt={width:zr[0],height:zr[1],left:0,top:-_v,advance:hi?zr[1]:zr[0],localGlyph:!1},Ti=gn?-Jt.height*en:Bn*xs-17-zr[1]*en,Di=Jt.advance;const Ai=(hi?zr[0]:zr[1])*en-xs*Bn;Ai>0&&Ai>di&&(di=Ai)}else{const ur=qe[Se.fontStack];if(!ur)continue;ur[$t]&&(_n=ur[$t]);const zr=ze[Se.fontStack];if(!zr)continue;const Ai=zr.glyphs[$t];if(!Ai)continue;if(Jt=Ai.metrics,Di=8203!==$t?xs:0,gn){const bo=void 0!==zr.ascender?Math.abs(zr.ascender):0,qr=void 0!==zr.descender?Math.abs(zr.descender):0,or=(bo+qr)*en;li<or&&(li=or,Dr=(bo-qr)/2*en),Ti=-bo*en}else Ti=(Bn-en)*xs-17}hi?(Ce.verticalizable=!0,_i.push({glyph:$t,image:Fn,x:lt,y:gt+Ti,vertical:hi,scale:en,localGlyph:Jt.localGlyph,fontStack:Se.fontStack,sectionIndex:_t,metrics:Jt,rect:_n}),lt+=Di*en+Nt):(_i.push({glyph:$t,image:Fn,x:lt,y:gt+Ti,vertical:hi,scale:en,localGlyph:Jt.localGlyph,fontStack:Se.fontStack,sectionIndex:_t,metrics:Jt,rect:_n}),lt+=Jt.advance*en+Nt)}0!==_i.length&&(Bt=Math.max(lt-Nt,Bt),gn?kx(_i,q,di,Dr,pt*Bn/2):kx(_i,q,di,0,pt/2)),lt=0;const Ur=pt*Bn+di;ri.lineOffset=Math.max(di,Kn),gt+=Ur,++hn}var Kt;const Qe=gt,{horizontalAlign:Ft,verticalAlign:Yt}=wx(Rt);(function(un,Bn,Kn,ri,_i,di){const li=(Bn-Kn)*_i,Dr=-di*ri;for(const Ur of un)for(const ke of Ur.positionedGlyphs)ke.x+=li,ke.y+=Dr})(Ce.positionedLines,q,Ft,Yt,Bt,Qe),Ce.top+=-Yt*Qe,Ce.bottom=Ce.top+Qe,Ce.left+=-Ft*Bt,Ce.right=Ce.left+Bt,Ce.hasBaseline=gn}(we,o,l,u,ue,b,C,D,N,I,j,Z),!function(Ce){for(const ze of Ce)if(0!==ze.positionedGlyphs.length)return!1;return!0}(_e))return we}const yv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bv(d,o,l,u,m,v){if(o.image){const b=u.get(o.image.toString());return b?b.displaySize[0]*o.scale*xs/v+m:0}{const b=l[o.fontStack],C=b&&b.glyphs[d];return C?C.metrics.advance*o.scale+m:0}}function fC(d,o,l,u){const m=Math.pow(d-o,2);return u?d<o?m/2:2*m:m+Math.abs(l)*l}function mC(d,o,l){let u=0;return 10===d&&(u-=1e4),l&&(u+=150),40!==d&&65288!==d||(u+=50),41!==o&&65289!==o||(u+=50),u}function xv(d,o,l,u,m,v){let b=null,C=fC(o,l,m,v);for(const D of u){const I=fC(o-D.x,l,m,v)+D.badness;I<=C&&(b=D,C=I)}return{index:d,x:o,priorBreak:b,badness:C}}function i_(d){return d?i_(d.priorBreak).concat(d.index):[]}function wx(d){let o=.5,l=.5;switch(d){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function kx(d,o,l,u,m){if(!(o||l||u||m))return;const v=d.length-1,b=d[v],C=(b.x+b.metrics.advance*b.scale)*o;for(let D=0;D<=v;D++)d[D].x-=C,d[D].y+=l+u+m}function gC(d){return void 0!==d.imagePrimary&&void 0!==d.top&&void 0!==d.bottom&&void 0!==d.left&&void 0!==d.right}function _C(d,o,l,u){const{horizontalAlign:m,verticalAlign:v}=wx(u),b=l[0]-d.displaySize[0]*m,C=l[1]-d.displaySize[1]*v;return{imagePrimary:d,imageSecondary:o,top:C,bottom:C+d.displaySize[1],left:b,right:b+d.displaySize[0]}}function EE(d,o,l,u,m,v){const b=d.imagePrimary;let C;if(b.content){const ce=b.content,ue=b.pixelRatio||1;C=[ce[0]/ue,ce[1]/ue,b.displaySize[0]-ce[2]/ue,b.displaySize[1]-ce[3]/ue]}const D=o.left*v,I=o.right*v;let R,N,j,K;"width"===l||"both"===l?(K=m[0]+D-u[3],N=m[0]+I+u[1]):(K=m[0]+(D+I-b.displaySize[0])/2,N=K+b.displaySize[0]);const Z=o.top*v,te=o.bottom*v;return"height"===l||"both"===l?(R=m[1]+Z-u[0],j=m[1]+te+u[2]):(R=m[1]+(Z+te-b.displaySize[1])/2,j=R+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:R,right:N,bottom:j,left:K,collisionPadding:C}}function yC(d){return!d.imagePrimary.stretchX}function wm(d){return!d.imagePrimary.stretchY}function vC(d){return{width:d.right-d.left,height:d.bottom-d.top}}const ed=128;function ns(d,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new dr(d+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:m}=l;let v=0;for(;v<u.length&&u[v]<=d;)v++;v=Math.max(0,v-1);let b=v;for(;b<u.length&&u[b]<d+1;)b++;b=Math.min(u.length-1,b);const C=u[v],D=u[b];return"composite"===l.kind?{kind:"composite",minZoom:C,maxZoom:D,interpolationType:m}:{kind:"camera",minZoom:C,maxZoom:D,minSize:l.evaluate(new dr(C)),maxSize:l.evaluate(new dr(D)),interpolationType:m}}}function Mx(d,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:m}){return"source"===d.kind?u/ed:"composite"===d.kind?Cn(u/ed,m/ed,l):o}function _p(d,o,l=1){let u=0,m=0;if("constant"===d.kind)m=d.layoutSize*l;else if("source"!==d.kind){const{interpolationType:v,minZoom:b,maxZoom:C}=d,D=v?Ge(il.interpolationFactor(v,o,b,C),0,1):0;"camera"===d.kind?m=Cn(d.minSize,d.maxSize,D)*l:u=D*l}return{uSizeT:u,uSize:m}}class sc extends Wt{constructor(o,l,u,m,v){super(o,l),this.angle=m,this.z=u,void 0!==v&&(this.segment=v)}clone(){return new sc(this.x,this.y,this.z,this.angle,this.segment)}}function bC(d,o,l,u,m){if(void 0===o.segment)return!0;let v=o,b=o.segment+1,C=0;for(;C>-l/2;){if(b--,b<0)return!1;C-=d[b].dist(v),v=d[b]}C+=d[b].dist(d[b+1]),b++;const D=[];let I=0;for(;C<l/2;){const R=d[b],N=d[b+1];if(!N)return!1;let j=d[b-1].angleTo(R)-R.angleTo(N);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:C,angleDelta:j}),I+=j;C-D[0].distance>u;)I-=D.shift().angleDelta;if(I>m)return!1;b++,C+=R.dist(N)}return!0}function xC(d){let o=0;for(let l=0;l<d.length-1;l++)o+=d[l].dist(d[l+1]);return o}function mf(d,o,l){return d?.6*o*l:0}function wC(d,o){return Math.max(d?d.right-d.left:0,o?o.right-o.left:0)}function Cx(d,o,l,u,m,v){const b=mf(l,m,v),C=wC(l,u)*v;let D=0;const I=xC(d)/2;for(let R=0;R<d.length-1;R++){const N=d[R],j=d[R+1],K=N.dist(j);if(D+K>I){const Z=(I-D)/K,te=Cn(N.x,j.x,Z),ce=Cn(N.y,j.y,Z),ue=new sc(te,ce,0,j.angleTo(N),R);return!b||bC(d,ue,C,b,o)?ue:void 0}D+=K}}function H6(d,o,l,u,m,v,b,C,D){const I=mf(u,v,b),R=wC(u,m),N=R*b,j=0===d[0].x||d[0].x===D||0===d[0].y||d[0].y===D;return o-N<o/4&&(o=N+o/4),wv(d,j?o/2*C%o:(R/2+2*v)*b*C%o,o,I,l,N,j,!1,D)}function wv(d,o,l,u,m,v,b,C,D){const I=v/2,R=xC(d);let N=0,j=o-l,K=[];for(let Z=0;Z<d.length-1;Z++){const te=d[Z],ce=d[Z+1],ue=te.dist(ce),xe=ce.angleTo(te);for(;j+l<N+ue;){j+=l;const ve=(j-N)/ue,ie=Cn(te.x,ce.x,ve),_e=Cn(te.y,ce.y,ve);if(ie>=0&&ie<D&&_e>=0&&_e<D&&j-I>=0&&j+I<=R){const we=new sc(ie,_e,0,xe,Z);u&&!bC(d,we,v,u,m)||K.push(we)}}N+=ue}return C||K.length||b||(K=wv(d,N/2,l,u,m,v,b,!0,D)),K}function Sx(d){let o=0,l=0;for(const b of d)o+=b.w*b.h,l=Math.max(l,b.w);d.sort((b,C)=>C.h-b.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let m=0,v=0;for(const b of d)for(let C=u.length-1;C>=0;C--){const D=u[C];if(!(b.w>D.w||b.h>D.h)){if(b.x=D.x,b.y=D.y,v=Math.max(v,b.y+b.h),m=Math.max(m,b.x+b.w),b.w===D.w&&b.h===D.h){const I=u.pop();C<u.length&&(u[C]=I)}else b.h===D.h?(D.x+=b.w,D.w-=b.w):b.w===D.w?(D.y+=b.h,D.h-=b.h):(u.push({x:D.x+b.w,y:D.y,w:D.w-b.w,h:b.h}),D.y+=b.h,D.h-=b.h);break}}return{w:m,h:v,fill:o/(m*v)||0}}ln(sc,"Anchor");const km=1;class r_{static getImagePositionScale(o,l,u){if(l&&o&&o.options&&o.options.transform){const m=o.options.transform;return{x:m.a,y:m.d}}return{x:u,y:u}}constructor(o,l,u,m){this.paddedRect=o;const{pixelRatio:v,version:b,stretchX:C,stretchY:D,content:I,sdf:R,usvg:N}=l;this.pixelRatio=v,this.stretchX=C,this.stretchY=D,this.content=I,this.version=b,this.padding=u,this.sdf=R,this.scale=r_.getImagePositionScale(m,N,v)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function kv(d,o,l){const u=Nl.parse(d),m=function(v,b,C=[1,1]){return{x:0,y:0,w:(v.data?v.data.width:v.width*C[0])+2*b,h:(v.data?v.data.height:v.height*C[1])+2*b}}(o,l,[u.options.transform.a,u.options.transform.d]);return{bin:m,imagePosition:new r_(m,o,l,u),imageVariant:u}}class kC{constructor(o,l,u){const m=new Map,v=new Map;this.haveRenderCallbacks=[];const b=[];this.addImages(o,m,km,b),this.addImages(l,v,2,b);const{w:C,h:D}=Sx(b),I=new $a({width:C||1,height:D||1});for(const[R,N]of o.entries()){const j=m.get(R).paddedRect;$a.copy(N.data,I,{x:0,y:0},{x:j.x+km,y:j.y+km},N.data,u,N.sdf)}for(const[R,N]of l.entries()){const j=v.get(R),K=j.paddedRect;let Z=j.padding;const te=K.x+Z,ce=K.y+Z,ue=N.data.width,xe=N.data.height;Z=Z>1?Z-1:Z,$a.copy(N.data,I,{x:0,y:0},{x:te,y:ce},N.data,u),$a.copy(N.data,I,{x:0,y:xe-Z},{x:te,y:ce-Z},{width:ue,height:Z},u),$a.copy(N.data,I,{x:0,y:0},{x:te,y:ce+xe},{width:ue,height:Z},u),$a.copy(N.data,I,{x:ue-Z,y:0},{x:te-Z,y:ce},{width:Z,height:xe},u),$a.copy(N.data,I,{x:0,y:0},{x:te+ue,y:ce},{width:Z,height:xe},u),$a.copy(N.data,I,{x:ue-Z,y:xe-Z},{x:te-Z,y:ce-Z},{width:Z,height:Z},u),$a.copy(N.data,I,{x:0,y:xe-Z},{x:te+ue,y:ce-Z},{width:Z,height:Z},u),$a.copy(N.data,I,{x:0,y:0},{x:te+ue,y:ce+xe},{width:Z,height:Z},u),$a.copy(N.data,I,{x:ue-Z,y:0},{x:te-Z,y:ce+xe},{width:Z,height:Z},u)}this.lut=u,this.image=I,this.iconPositions=m,this.patternPositions=v}addImages(o,l,u,m){for(const[v,b]of o.entries()){const{bin:C,imagePosition:D,imageVariant:I}=kv(v,b,u);l.set(v,D),m.push(C),b.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(o,l,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>o.hasImage(m,u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m of o.getUpdatedImages(u)){for(const v of this.iconPositions.keys()){const b=Nl.parse(v);if(Xo.isEqual(b.id,m)){const C=o.getImage(m,u);this.patchUpdatedImage(this.iconPositions.get(v),C,l)}}for(const v of this.patternPositions.keys()){const b=Nl.parse(v);if(Xo.isEqual(b.id,m)){const C=o.getImage(m,u);this.patchUpdatedImage(this.patternPositions.get(v),C,l)}}}}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[m,v]=o.tl,b=o.sdf;if(this.lut||b){const C={width:l.data.width,height:l.data.height},D=new $a(C);$a.copy(l.data,D,{x:0,y:0},{x:0,y:0},C,this.lut,b),u.update(D,{position:{x:m,y:v}})}else u.update(l.data,{position:{x:m,y:v}})}}ln(r_,"ImagePosition"),ln(kC,"ImageAtlas");const a1=1e20;function MC(d,o,l,u,m,v,b,C,D){for(let I=o;I<o+u;I++)CC(d,l*v+I,v,m,b,C,D);for(let I=l;I<l+m;I++)CC(d,I*v+o,1,u,b,C,D)}function CC(d,o,l,u,m,v,b){v[0]=0,b[0]=-a1,b[1]=a1,m[0]=d[o];for(let C=1,D=0,I=0;C<u;C++){m[C]=d[o+C*l];const R=C*C;do{const N=v[D];I=(m[C]-m[N]+R-N*N)/(C-N)/2}while(I<=b[D]&&--D>-1);D++,v[D]=C,b[D]=I,b[D+1]=a1}for(let C=0,D=0;C<u;C++){for(;b[D+1]<C;)D++;const I=v[D],R=C-I;d[o+C*l]=m[I]+R*R}}const Tu=2,Mv={none:0,ideographs:1,all:2};class Mm{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,u){const m=[],v=this.urls[l]||cs.GLYPHS_URL;for(const b in o)for(const C of o[b])m.push({stack:b,id:C});bt(m,({stack:b,id:C},D)=>{let I=this.entries[b];I||(I=this.entries[b]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=I.glyphs[C];if(void 0!==R)return void D(null,{stack:b,id:C,glyph:R});if(R=this._tinySDF(I,b,C),R)return I.glyphs[C]=R,void D(null,{stack:b,id:C,glyph:R});const N=Math.floor(C/256);if(256*N>65535)return ci("glyphs > 65535 not supported"),void D(null,{stack:b,id:C,glyph:R});if(I.ranges[N])return void D(null,{stack:b,id:C,glyph:R});let j=I.requests[N];j||(j=I.requests[N]=[],Mm.loadGlyphRange(b,N,v,this.requestManager,(K,Z)=>{if(Z){I.ascender=Z.ascender,I.descender=Z.descender;for(const te in Z.glyphs)this._doesCharSupportLocalGlyph(+te)||(I.glyphs[+te]=Z.glyphs[+te]);I.ranges[N]=!0}for(const te of j)te(K,Z);delete I.requests[N]})),j.push((K,Z)=>{K?D(K):Z&&D(null,{stack:b,id:C,glyph:Z.glyphs[C]||null})})},(b,C)=>{if(b)u(b);else if(C){const D={};for(const{stack:I,id:R,glyph:N}of C)void 0===D[I]&&(D[I]={}),void 0===D[I].glyphs&&(D[I].glyphs={}),D[I].glyphs[R]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},D[I].ascender=this.entries[I].ascender,D[I].descender=this.entries[I].descender;u(null,D)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==Mv.none&&(this.localGlyphMode===Mv.all?!!this.localFontFamily:!!this.localFontFamily&&(Pn["CJK Unified Ideographs"](o)||Pn["Hangul Syllables"](o)||Pn.Hiragana(o)||Pn.Katakana(o)||Pn["CJK Symbols and Punctuation"](o)||Pn["CJK Unified Ideographs Extension A"](o)||Pn["CJK Unified Ideographs Extension B"](o)||Pn.Osage(o)))}_tinySDF(o,l,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let v=o.tinySDF;if(!v){let te="400";/bold/i.test(l)?te="900":/medium/i.test(l)?te="500":/light/i.test(l)&&(te="200"),v=o.tinySDF=new Mm.TinySDF({fontFamily:m,fontWeight:te,fontSize:24*Tu,buffer:3*Tu,radius:8*Tu}),v.fontWeight=te}if(this.localGlyphs[v.fontWeight][u])return this.localGlyphs[v.fontWeight][u];const b=String.fromCodePoint(u),{data:C,width:D,height:I,glyphWidth:R,glyphHeight:N,glyphLeft:j,glyphTop:K,glyphAdvance:Z}=v.draw(b);return this.localGlyphs[v.fontWeight][u]={id:u,bitmap:new sf({width:D,height:I},C),metrics:{width:R/Tu,height:N/Tu,left:j/Tu,top:K/Tu-27,advance:Z/Tu,localGlyph:!0}}}}Mm.loadGlyphRange=function(d,o,l,u,m){const v=256*o,b=v+255,C=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",d).replace("{range}",`${v}-${b}`),Ui.Glyphs);Ld(C,(D,I)=>{if(D)m(D);else if(I){const R={},N=new ff(I).readFields(uC,{});for(const j of N.glyphs)R[j.id]=j;m(null,{glyphs:R,ascender:N.ascender,descender:N.descender})}})},Mm.TinySDF=class{constructor({fontSize:d=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:b="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const C=this.size=d+4*o,D=this._createCanvas(C),I=this.ctx=D.getContext("2d",{willReadFrequently:!0});I.font=`${b} ${v} ${d}px ${m}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(d){const o=document.createElement("canvas");return o.width=o.height=d,o}draw(d){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(d),b=Math.ceil(l),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),D=Math.min(this.size-this.buffer,b+Math.ceil(u)),I=C+2*this.buffer,R=D+2*this.buffer,N=Math.max(I*R,0),j=new Uint8ClampedArray(N),K={data:j,width:I,height:R,glyphWidth:C,glyphHeight:D,glyphTop:b,glyphLeft:0,glyphAdvance:o};if(0===C||0===D)return K;const{ctx:Z,buffer:te,gridInner:ce,gridOuter:ue}=this;Z.clearRect(te,te,C,D),Z.fillText(d,te,te+b);const xe=Z.getImageData(te,te,C,D);ue.fill(a1,0,N),ce.fill(0,0,N);for(let ve=0;ve<D;ve++)for(let ie=0;ie<C;ie++){const _e=xe.data[4*(ve*C+ie)+3]/255;if(0===_e)continue;const we=(ve+te)*I+ie+te;if(1===_e)ue[we]=0,ce[we]=a1;else{const Ce=.5-_e;ue[we]=Ce>0?Ce*Ce:0,ce[we]=Ce<0?Ce*Ce:0}}MC(ue,0,0,I,R,I,this.f,this.v,this.z),MC(ce,te,te,C,D,I,this.f,this.v,this.z);for(let ve=0;ve<N;ve++){const ie=Math.sqrt(ue[ve])-Math.sqrt(ce[ve]);j[ve]=Math.round(255-255*(ie/this.radius+this.cutoff))}return K}};const ws=km;function Ex(d,o){return d+o[1]-o[0]}function DE(d,o,l,u,m=1){const v=[],b=d.imagePrimary,C=b.pixelRatio,D=b.paddedRect.w-2*ws,I=b.paddedRect.h-2*ws,R=(d.right-d.left)*m,N=(d.bottom-d.top)*m,j=b.stretchX||[[0,D]],K=b.stretchY||[[0,I]],Z=j.reduce(Ex,0),te=K.reduce(Ex,0),ce=D-Z,ue=I-te;let xe=0,ve=Z,ie=0,_e=te,we=0,Ce=ce,ze=0,qe=ue;if(b.content&&u){const Xe=b.content;xe=l1(j,0,Xe[0]),ie=l1(K,0,Xe[1]),ve=l1(j,Xe[0],Xe[2]),_e=l1(K,Xe[1],Xe[3]),we=Xe[0]-xe,ze=Xe[1]-ie,Ce=Xe[2]-Xe[0]-ve,qe=Xe[3]-Xe[1]-_e}const Ze=(Xe,pt,Rt,Mt)=>{const Tt=Cm(Xe.stretch-xe,ve,R,d.left*m),Nt=Cv(Xe.fixed-we,Ce,Xe.stretch,Z),ut=Cm(pt.stretch-ie,_e,N,d.top*m),Et=Cv(pt.fixed-ze,qe,pt.stretch,te),lt=Cm(Rt.stretch-xe,ve,R,d.left*m),gt=Cv(Rt.fixed-we,Ce,Rt.stretch,Z),Bt=Cm(Mt.stretch-ie,_e,N,d.top*m),q=Cv(Mt.fixed-ze,qe,Mt.stretch,te),gn=new Wt(Tt,ut),hn=new Wt(lt,ut),Kt=new Wt(lt,Bt),Qe=new Wt(Tt,Bt),Ft=new Wt(Nt/C,Et/C),Yt=new Wt(gt/C,q/C),un=o*Math.PI/180;if(un){const li=Math.sin(un),Dr=Math.cos(un),Ur=[Dr,-li,li,Dr];gn._matMult(Ur),hn._matMult(Ur),Qe._matMult(Ur),Kt._matMult(Ur)}const Bn=Xe.stretch+Xe.fixed,Kn=Rt.stretch+Rt.fixed,ri=pt.stretch+pt.fixed,_i=Mt.stretch+Mt.fixed,di=d.imageSecondary;return{tl:gn,tr:hn,bl:Qe,br:Kt,texPrimary:{x:b.paddedRect.x+ws+Bn,y:b.paddedRect.y+ws+ri,w:Kn-Bn,h:_i-ri},texSecondary:di?{x:di.paddedRect.x+ws+Bn,y:di.paddedRect.y+ws+ri,w:Kn-Bn,h:_i-ri}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ft,pixelOffsetBR:Yt,minFontScaleX:Ce/C/R,minFontScaleY:qe/C/N,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const Xe=gh(j,ce,Z),pt=gh(K,ue,te);for(let Rt=0;Rt<Xe.length-1;Rt++){const Mt=Xe[Rt],Tt=Xe[Rt+1];for(let Nt=0;Nt<pt.length-1;Nt++)v.push(Ze(Mt,pt[Nt],Tt,pt[Nt+1]))}}else v.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:I+1}));return v}function l1(d,o,l){let u=0;for(const m of d)u+=Math.max(o,Math.min(l,m[1]))-Math.max(o,Math.min(l,m[0]));return u}function gh(d,o,l){const u=[{fixed:-ws,stretch:0}];for(const[m,v]of d){const b=u[u.length-1];u.push({fixed:m-b.stretch,stretch:b.stretch}),u.push({fixed:m-b.stretch,stretch:b.stretch+(v-m)})}return u.push({fixed:o+ws,stretch:l}),u}function Cm(d,o,l,u){return d/o*l+u}function Cv(d,o,l,u){return d-o*l/u}function TE(d,o,l,u){const m=o+d.positionedLines[u].lineOffset;return 0===u?l+m/2:l+(m+(o+d.positionedLines[u-1].lineOffset))/2}function AE(d,o=1,l=!1){let u=1/0,m=1/0,v=-1/0,b=-1/0;const C=d[0];for(let K=0;K<C.length;K++){const Z=C[K];(!K||Z.x<u)&&(u=Z.x),(!K||Z.y<m)&&(m=Z.y),(!K||Z.x>v)&&(v=Z.x),(!K||Z.y>b)&&(b=Z.y)}const D=Math.min(v-u,b-m);let I=D/2;const R=new du([],Dx);if(0===D)return new Wt(u,m);for(let K=u;K<v;K+=D)for(let Z=m;Z<b;Z+=D)R.push(new Xi(K+I,Z+I,I,d));let N=function(K){let Z=0,te=0,ce=0;const ue=K[0];for(let xe=0,ve=ue.length,ie=ve-1;xe<ve;ie=xe++){const _e=ue[xe],we=ue[ie],Ce=_e.x*we.y-we.x*_e.y;te+=(_e.x+we.x)*Ce,ce+=(_e.y+we.y)*Ce,Z+=3*Ce}return new Xi(te/Z,ce/Z,0,K)}(d),j=R.length;for(;R.length;){const K=R.pop();(K.d>N.d||!N.d)&&(N=K,l&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,j)),K.max-N.d<=o||(I=K.h/2,R.push(new Xi(K.p.x-I,K.p.y-I,I,d)),R.push(new Xi(K.p.x+I,K.p.y-I,I,d)),R.push(new Xi(K.p.x-I,K.p.y+I,I,d)),R.push(new Xi(K.p.x+I,K.p.y+I,I,d)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${N.d}`)),N.p}function Dx(d,o){return o.max-d.max}class Xi{constructor(o,l,u,m){this.p=new Wt(o,l),this.h=u,this.d=function(v,b){let C=!1,D=1/0;for(let I=0;I<b.length;I++){const R=b[I];for(let N=0,j=R.length,K=j-1;N<j;K=N++){const Z=R[N],te=R[K];Z.y>v.y!=te.y>v.y&&v.x<(te.x-Z.x)*(v.y-Z.y)/(te.y-Z.y)+Z.x&&(C=!C),D=Math.min(D,Li(v,Z,te))}}return(C?1:-1)*Math.sqrt(D)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const SC=Object.keys,Tx=Number.POSITIVE_INFINITY,U6=Math.sqrt(2);function Mr(d,[o,l]){let u=0,m=0;if(l===Tx){o<0&&(o=0);const v=o/U6;switch(d){case"top-right":case"top-left":m=v-7;break;case"bottom-right":case"bottom-left":m=7-v;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(d){case"top-right":case"bottom-right":u=-v;break;case"top-left":case"bottom-left":u=v;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),d){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(d){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,m]}function Sv(d,o,l,u,m,v,b,C,D){if(!o||!o.usvg)return;const I=vC(u),R=vC(m),N="both"!==v&&"width"!==v||!yC(u)?1:Math.max(1,R.width/I.width),j="both"!==v&&"height"!==v||!wm(u)?1:Math.max(1,R.height/I.height);l.scaleSelf(N,j);const K=l.toString();b.set(K,l),C.set(K,o);const{imagePosition:Z}=kv(K,o,km);D.set(K,Z)}function Ev(d,o,l,u,m,v,b,C){if(!d)return;const D=function(I,R,N,j,K){if("camera"===I.kind)return I.maxSize;if("composite"===I.kind){const Z=R.possiblyEvaluate(new dr(I.maxZoom),N).evaluate(K,{},N),te=R.possiblyEvaluate(new dr(I.minZoom),N).evaluate(K,{},N);return Math.max(Z,te)}return R.possiblyEvaluate(new dr(j)).evaluate(K,{},N)}(o,l,u,m,v);return d.scaleSelf(D*C*b)}function EC(d,o,l,u,m,v,b,C){return{iconPrimary:Ev(d.getPrimary(),o,l,u,m,v,b,C),iconSecondary:Ev(d.getSecondary(),o,l,u,m,v,b,C)}}function DC(d,o,l,u){if(!d)return;const m=o.get(l.toString());if(d.imagePrimary=m,u){const v=o.get(u.toString());d.imageSecondary=v}}function Ax(d,o){for(const l in d.horizontal)Px(d.horizontal[l],o);Px(d.vertical,o)}function Px(d,o){if(d)for(const l of d.positionedLines)for(const u of l.positionedGlyphs)if(null!==u.image){const m=u.image.toString();u.rect=o.get(m).paddedRect}}function Dv(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function PE(d,o,l,u,m,v,b,C,D){const I=o_(v.horizontal)||v.vertical,R=l.get("icon-text-fit-padding").evaluate(u,{},m);let N,j=o;return o&&"none"!==D&&(d.allowVerticalPlacement&&v.vertical&&(N=EE(o,v.vertical,D,R,C,b)),I&&(j=EE(o,I,D,R,C,b))),{defaultShapedIcon:j,verticallyShapedIcon:N}}function TC(d,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue,xe,ve){let ie=b.textMaxSize.evaluate(o,{},j);void 0===ie?ie=C*b.textScaleFactor:ie*=b.textScaleFactor;const _e=d.layers[0].layout,we=o_(l.horizontal)||l.vertical,Ce="globe"===K.name,ze=xs,qe=d.tilePixelRatio*ie/ze,Ze=(Nt=d.overscaling,d.zoom>18&&Nt>2&&(Nt>>=1),Math.max(Xt/(512*Nt),1)*_e.get("symbol-spacing")),Xe=_e.get("text-padding")*d.tilePixelRatio,pt=_e.get("icon-padding")*d.tilePixelRatio,Rt=ae(_e.get("text-max-angle")),Mt="map"===_e.get("icon-rotation-alignment")&&"point"!==ve,Tt=Ze/2;var Nt;!1===d.hasAnyIconTextFit&&"none"!==ce&&(d.hasAnyIconTextFit=!0);const ut=o.properties?+o.properties[mp]:null,Et=ut&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(ut):65535,lt=(gt,Bt,q)=>{if(Bt.x<0||Bt.x>=Xt||Bt.y<0||Bt.y>=Xt)return;let gn=null;if(Ce){const{x:hn,y:Kt,z:Qe}=K.projectTilePoint(Bt.x,Bt.y,q);gn={anchor:new sc(hn,Kt,Qe,0,void 0),up:K.upVector(q,Bt.x,Bt.y)}}!function(hn,Kt,Qe,Ft,Yt,un,Bn,Kn,ri,_i,di,li,Dr,Ur,ke,Se,_t,$t,en,Jt,_n,Fn,Di,Ti,hi,ur,zr,Ai,bo){const qr=hn.addToLineVertexArray(Kt,Ft);let or,Fo,$r,Pr,Nr,pr,mi,vr=0,mo=0,In=0,$i=0,br=-1,zo=-1;const to={};let Zo=Ca("");const Ir=Qe?Qe.anchor:Kt,Br="none"!==Ai;let td=0,Wa=0;if(void 0===ri._unevaluatedLayout.getValue("text-radial-offset")){const Ts=ri.layout.get("text-offset").evaluate(_n,{},hi);td=Ts[0]*xs,Wa=Ts[1]*xs}else td=ri.layout.get("text-radial-offset").evaluate(_n,{},hi)*xs,Wa=Tx;if(hn.allowVerticalPlacement&&Yt.vertical){const Ts=Yt.vertical;if(ke)pr=_f(Ts),Kn&&(mi=_f(Kn));else{const Js=ri.layout.get("text-rotate").evaluate(_n,{},hi)+90;$r=s_(_i,Ir,Kt,di,li,Dr,Ts,Ur,Js,Se),Kn&&(Pr=s_(_i,Ir,Kt,di,li,Dr,Kn,$t,Js))}}if(un){const Ts=hn.iconSizeData,Js=ri.layout.get("icon-rotate").evaluate(_n,{},hi),cl=DE(un,Js,Di,Br,Fn.iconScaleFactor),da=Kn?DE(Kn,Js,Di,Br,Fn.iconScaleFactor):void 0;Fo=s_(_i,Ir,Kt,di,li,Dr,un,$t,Js,null),vr=4*cl.length;let El=null;"source"===Ts.kind?(El=[ed*ri.layout.get("icon-size").evaluate(_n,{},hi)*Fn.iconScaleFactor],El[0]>gf&&ci(`${hn.layerIds[0]}: Value for "icon-size" is >= ${c1}. Reduce your "icon-size".`)):"composite"===Ts.kind&&(El=[ed*Fn.compositeIconSizes[0].evaluate(_n,{},hi)*Fn.iconScaleFactor,ed*Fn.compositeIconSizes[1].evaluate(_n,{},hi)*Fn.iconScaleFactor],(El[0]>gf||El[1]>gf)&&ci(`${hn.layerIds[0]}: Value for "icon-size" is >= ${c1}. Reduce your "icon-size".`)),hn.addSymbols(hn.icon,cl,El,Jt,en,_n,void 0,Qe,Kt,qr.lineStartIndex,qr.lineLength,-1,Ti,hi,ur,zr),br=hn.icon.placedSymbolArray.length-1,da&&(mo=4*da.length,hn.addSymbols(hn.icon,da,El,Jt,en,_n,Dc.vertical,Qe,Kt,qr.lineStartIndex,qr.lineLength,-1,Ti,hi,ur,zr),zo=hn.icon.placedSymbolArray.length-1)}for(const Ts in Yt.horizontal){const Js=Ts,cl=Yt.horizontal[Js];or||(Zo=Ca(cl.text),ke?Nr=_f(cl):or=s_(_i,Ir,Kt,di,li,Dr,cl,Ur,ri.layout.get("text-rotate").evaluate(_n,{},hi),Se));const da=1===cl.positionedLines.length;if(In+=Tv(hn,Qe,Kt,cl,Bn,ri,ke,_n,Se,qr,Yt.vertical?Dc.horizontal:Dc.horizontalOnly,da?SC(Yt.horizontal):[Js],to,br,Fn,Ti,hi,ur),da)break}Yt.vertical&&($i+=Tv(hn,Qe,Kt,Yt.vertical,Bn,ri,ke,_n,Se,qr,Dc.vertical,["vertical"],to,zo,Fn,Ti,hi,ur));let za=-1;const nd=(Ts,Js)=>Ts?Math.max(Ts,Js):Js;za=nd(Nr,za),za=nd(pr,za),za=nd(mi,za);const xo=za>-1?1:0;hn.glyphOffsetArray.length>=65535&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==_n.sortKey&&hn.addToSortKeyRanges(hn.symbolInstances.length,_n.sortKey),hn.symbolInstances.emplaceBack(Kt.x,Kt.y,Ir.x,Ir.y,Ir.z,to.right>=0?to.right:-1,to.center>=0?to.center:-1,to.left>=0?to.left:-1,to.vertical>=0?to.vertical:-1,br,zo,Zo,void 0!==or?or:hn.collisionBoxArray.length,void 0!==or?or+1:hn.collisionBoxArray.length,void 0!==$r?$r:hn.collisionBoxArray.length,void 0!==$r?$r+1:hn.collisionBoxArray.length,void 0!==Fo?Fo:hn.collisionBoxArray.length,void 0!==Fo?Fo+1:hn.collisionBoxArray.length,Pr||hn.collisionBoxArray.length,Pr?Pr+1:hn.collisionBoxArray.length,di,In,$i,vr,mo,xo,0,td,Wa,za,0,Br?1:0,bo)}(d,Bt,gn,gt,l,u,v,m,d.layers[0],d.collisionBoxArray,o.index,o.sourceLayerIndex,d.index,Xe,xe,I,0,pt,Mt,ue,o,b,R,N,j,Z,te,ce,Et)};if("line"===ve)for(const gt of K0(o.geometry,0,0,Xt,Xt)){const Bt=H6(gt,Ze,Rt,l.vertical||we,u,ze,qe,d.overscaling,Xt);for(const q of Bt)we&&yp(d,we.text,Tt,q)||lt(gt,q,j)}else if("line-center"===ve){for(const gt of o.geometry)if(gt.length>1){const Bt=Cx(gt,Rt,l.vertical||we,u,ze,qe);Bt&&lt(gt,Bt,j)}}else if("Polygon"===o.type)for(const gt of Xg(o.geometry,0)){const Bt=AE(gt,16);lt(gt[0],new sc(Bt.x,Bt.y,0,0,void 0),j)}else if("LineString"===o.type)for(const gt of o.geometry)lt(gt,new sc(gt[0].x,gt[0].y,0,0,void 0),j);else if("Point"===o.type)for(const gt of o.geometry)for(const Bt of gt)lt([Bt],new sc(Bt.x,Bt.y,0,0,void 0),j)}const c1=255,gf=c1*ed;function Tv(d,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce,ue){const xe=function(_e,we,Ce,ze,qe,Ze,Xe,pt){const Rt=[];if(0===we.positionedLines.length)return Rt;const Mt=ze.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,Tt=function(gt){const Bt=gt[0],q=gt[1],gn=Bt*q;return gn>0?[Bt,-q]:gn<0?[-Bt,q]:0===Bt?[q,Bt]:[q,-Bt]}(Ce);let Nt=Math.abs(we.top-we.bottom);for(const gt of we.positionedLines)Nt-=gt.lineOffset;const ut=we.positionedLines.length,Et=Nt/ut;let lt=we.top-Ce[1];for(let gt=0;gt<ut;++gt){const Bt=we.positionedLines[gt];lt=TE(we,Et,lt,gt);for(const q of Bt.positionedGlyphs){if(!q.rect)continue;const gn=q.rect||{};let hn=_v+1,Kt=!0,Qe=1,Ft=0;if(q.image){const _n=Xe.get(q.image.toString());if(!_n)continue;if(_n.sdf){ci("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,Qe=_n.pixelRatio,hn=km/Qe}const Yt=(qe||pt)&&q.vertical,un=q.metrics.advance*q.scale/2,Bn=q.metrics,Kn=q.rect;if(null===Kn)continue;pt&&we.verticalizable&&(Ft=q.image?un-q.metrics.width*q.scale/2:0);const ri=qe?[q.x+un,q.y]:[0,0];let _i=[0,0],di=[0,0],li=!1;qe||(Yt?(di=[q.x+un+Tt[0],q.y+Tt[1]-Ft],li=!0):_i=[q.x+un+Ce[0],q.y+Ce[1]-Ft]);const Dr=Kn.w*q.scale/(Qe*(q.localGlyph?Tu:1)),Ur=Kn.h*q.scale/(Qe*(q.localGlyph?Tu:1));let ke,Se,_t,$t;if(Yt){const _n=q.y-lt,Fn=new Wt(-un,un-_n),Di=-Math.PI/2,Ti=new Wt(...di);ke=new Wt(-un+_i[0],_i[1]),ke._rotateAround(Di,Fn)._add(Ti),ke.x+=-_n+un,ke.y-=(Bn.left-hn)*q.scale;const hi=q.image?Bn.advance*q.scale:xs*q.scale,ur=String.fromCodePoint(q.glyph);e_(ur)?ke.x+=(1-hn)*q.scale:fv(ur)?ke.x+=hi-Bn.height*q.scale+(-hn-1)*q.scale:ke.x+=q.image||Bn.width+2*hn===Kn.w&&Bn.height+2*hn===Kn.h?(hi-Ur)/2:(hi-(Bn.height+2*hn)*q.scale)/2,Se=new Wt(ke.x,ke.y-Dr),_t=new Wt(ke.x+Ur,ke.y),$t=new Wt(ke.x+Ur,ke.y-Dr)}else{const _n=(Bn.left-hn)*q.scale-un+_i[0],Fn=(-Bn.top-hn)*q.scale+_i[1],Di=_n+Dr,Ti=Fn+Ur;ke=new Wt(_n,Fn),Se=new Wt(Di,Fn),_t=new Wt(_n,Ti),$t=new Wt(Di,Ti)}if(Mt){let _n;_n=qe?new Wt(0,0):li?new Wt(Tt[0],Tt[1]):new Wt(Ce[0],Ce[1]),ke._rotateAround(Mt,_n),Se._rotateAround(Mt,_n),_t._rotateAround(Mt,_n),$t._rotateAround(Mt,_n)}const en=new Wt(0,0),Jt=new Wt(0,0);Rt.push({tl:ke,tr:Se,bl:_t,br:$t,texPrimary:gn,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:ri,sectionIndex:q.sectionIndex,isSDF:Kt,pixelOffsetTL:en,pixelOffsetBR:Jt,minFontScaleX:0,minFontScaleY:0})}}return Rt}(0,u,D,v,b,C,m,d.allowVerticalPlacement),ve=d.textSizeData;let ie=null;"source"===ve.kind?(ie=[ed*v.layout.get("text-size").evaluate(C,{},ce)*Z.textScaleFactor],ie[0]>gf&&ci(`${d.layerIds[0]}: Value for "text-size" is >= ${c1}. Reduce your "text-size".`)):"composite"===ve.kind&&(ie=[ed*Z.compositeTextSizes[0].evaluate(C,{},ce)*Z.textScaleFactor,ed*Z.compositeTextSizes[1].evaluate(C,{},ce)*Z.textScaleFactor],(ie[0]>gf||ie[1]>gf)&&ci(`${d.layerIds[0]}: Value for "text-size" is >= ${c1}. Reduce your "text-size".`)),d.addSymbols(d.text,xe,ie,D,b,C,R,o,l,I.lineStartIndex,I.lineLength,K,te,ce,ue,!1);for(const _e of N)j[_e]=d.text.placedSymbolArray.length-1;return 4*xe.length}function o_(d){for(const o in d)return d[o];return null}function s_(d,o,l,u,m,v,b,C,D,I){let R=b.top,N=b.bottom,j=b.left,K=b.right;if(gC(b)&&b.collisionPadding){const Z=b.collisionPadding;j-=Z[0],R-=Z[1],K+=Z[2],N+=Z[3]}if(D){const Z=new Wt(j,R),te=new Wt(K,R),ce=new Wt(j,N),ue=new Wt(K,N),xe=ae(D);let ve=new Wt(0,0);I&&(ve=new Wt(I[0],I[1])),Z._rotateAround(xe,ve),te._rotateAround(xe,ve),ce._rotateAround(xe,ve),ue._rotateAround(xe,ve),j=Math.min(Z.x,te.x,ce.x,ue.x),K=Math.max(Z.x,te.x,ce.x,ue.x),R=Math.min(Z.y,te.y,ce.y,ue.y),N=Math.max(Z.y,te.y,ce.y,ue.y)}return d.emplaceBack(o.x,o.y,o.z,l.x,l.y,j,R,K,N,C,u,m,v),d.length-1}function _f(d){gC(d)&&d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const o=d.bottom-d.top;return o>0?Math.max(10,o):null}function yp(d,o,l,u){const m=d.compareText;if(o in m){const v=m[o];for(let b=v.length-1;b>=0;b--)if(u.dist(v[b])<l)return!0}else m[o]=[];return m[o].push(u),!1}function Sm(d,o){const l=d.fovAboveCenter,u=d.elevation?d.elevation.getMinElevationBelowMSL()*o:0,m=(d._camera.position[2]*d.worldSize-u)/Math.cos(d._pitch),v=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-d._pitch-l,.01));let b=Math.sin(d._pitch)*v+m;const C=m*(1/d._horizonShift);if(!d.elevation||0===d.elevation.exaggeration()){let D=Math.max(d.zoom-17,0);d.isOrthographic&&(D/=10),b*=1+D}return Math.min(1.01*b,C)}function a_(d,o){if(!o.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:o};const l=Math.pow(2,-d.z),u=d.x*l,m=(d.x+1)*l,v=d.y*l,b=(d.y+1)*l,C=Be(u),D=Be(m),I=Ve(v),R=Ve(b),N=o.project(C,I),j=o.project(D,I),K=o.project(D,R),Z=o.project(C,R);let te=Math.min(N.x,j.x,K.x,Z.x),ce=Math.min(N.y,j.y,K.y,Z.y),ue=Math.max(N.x,j.x,K.x,Z.x),xe=Math.max(N.y,j.y,K.y,Z.y);const ve=l/16;function ie(we,Ce,ze,qe,Ze,Xe){const pt=(ze+Ze)/2,Rt=(qe+Xe)/2,Mt=o.project(Be(pt),Ve(Rt)),Tt=Math.max(0,te-Mt.x,ce-Mt.y,Mt.x-ue,Mt.y-xe);te=Math.min(te,Mt.x),ue=Math.max(ue,Mt.x),ce=Math.min(ce,Mt.y),xe=Math.max(xe,Mt.y),Tt>ve&&(ie(we,Mt,ze,qe,pt,Rt),ie(Mt,Ce,pt,Rt,Ze,Xe))}ie(N,j,u,v,m,v),ie(j,K,m,v,m,b),ie(K,Z,m,b,u,b),ie(Z,N,u,b,u,v),te-=ve,ce-=ve,ue+=ve,xe+=ve;const _e=1/Math.max(ue-te,xe-ce);return{scale:_e,x:te*_e,y:ce*_e,x2:ue*_e,y2:xe*_e,projection:o}}function AC(d,{x:o,y:l},u=0){return new Wt(((o-u)*d.scale-d.x)*Xt,(l*d.scale-d.y)*Xt)}const PC=Gn(new Float32Array(16));class vp{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new le(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u,m=!0){return o._coordinatePoint(o.locationCoordinate(l,u),m)}pixelsPerMeter(o,l){return Te(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return Sm(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,m){const v=o.horizonLineFromTop(!1),b=new Wt(l,Math.max(v,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(b,m))}pointCoordinate3D(o,l,u){const m=new Wt(l,u);if(o.elevation)return o.elevation.pointCoordinate(m);{const v=this.pointCoordinate(o,m.x,m.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return PC}createTileMatrix(o,l,u){let m,v,b;const C=u.canonical,D=Gn(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=a_(C,this);m=1,v=I.x+u.wrap*I.scale,b=I.y,No(D,D,[m/I.scale,m/I.scale,o.pixelsPerMeter/l])}else m=l/o.zoomScale(C.z),v=(C.x+Math.pow(2,C.z)*u.wrap)*m,b=C.y*m;return ho(D,D,[v,b,0]),No(D,D,[m/Xt,m/Xt,1]),D}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class Ix extends vp{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],m=Math.sin(ae(l));this.n=(m+Math.sin(ae(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:m,r0:v}=this,b=ae(o-this.center[0]),C=ae(l),D=Math.sqrt(m-2*u*Math.sin(C))/u;return{x:D*Math.sin(b*u),y:D*Math.cos(b*u)-v,z:0}}unproject(o,l){const{n:u,c:m,r0:v}=this,b=v+l;let C=Math.atan2(o,Math.abs(b))*Math.sign(b);b*u<0&&(C-=Math.PI*Math.sign(o)*Math.sign(b));const D=ae(this.center[0])*u;C=at(C,-Math.PI-D,Math.PI-D);const I=Ge(ge(C/u)+this.center[0],-180,180),R=Math.asin(Ge((m-(o*o+b*b)*u*u)/(2*u),-1,1)),N=Ge(ge(R),-Ye,Ye);return new le(I,N)}}const bp=1.340264,yf=-.081106,d1=893e-6,h1=.003796,Av=Math.sqrt(3)/2;class IE extends vp{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Av*Math.sin(l)),m=u*u,v=m*m*m;return{x:.5*(o*Math.cos(u)/(Av*(bp+3*yf*m+v*(7*d1+9*h1*m)))/Math.PI+.5),y:1-.5*(u*(bp+yf*m+v*(d1+h1*m))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,m=u*u,v=m*m*m;for(let R,N,j,K=0;K<12&&(N=u*(bp+yf*m+v*(d1+h1*m))-l,j=bp+3*yf*m+v*(7*d1+9*h1*m),R=N/j,u=Ge(u-R,-Math.PI/3,Math.PI/3),m=u*u,v=m*m*m,!(Math.abs(R)<1e-12));++K);const b=Av*o*(bp+3*yf*m+v*(7*d1+9*h1*m))/Math.cos(u),C=Math.asin(Math.sin(u)/Av),D=Ge(180*b/Math.PI,-180,180),I=Ge(180*C/Math.PI,-Ye,Ye);return new le(D,I)}}class OE extends vp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),m=Ge(360*(.5-l),-Ye,Ye);return new le(u,m)}}const u1=Math.PI/2;function l_(d){return Math.tan((u1+d)/2)}class q6 extends vp{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let m=ae(l),v=ae(u);this.southernCenter=m+v<0,this.southernCenter&&(m=-m,v=-v);const b=Math.cos(m),C=l_(m);this.n=m===v?Math.sin(m):Math.log(b/Math.cos(v))/Math.log(l_(v)/C),this.f=b*Math.pow(l_(m),this.n)/this.n}project(o,l){l=ae(l),this.southernCenter&&(l=-l),o=ae(o-this.center[0]);const u=1e-6,{n:m,f:v}=this;v>0?l<-u1+u&&(l=-u1+u):l>u1-u&&(l=u1-u);const b=v/Math.pow(l_(l),m);let C=b*Math.sin(m*o),D=v-b*Math.cos(m*o);return C=.5*(C/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:C,y:this.southernCenter?D:1-D,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f:m}=this,v=m-l,b=Math.sign(v),C=Math.sign(u)*Math.sqrt(o*o+v*v);let D=Math.atan2(o,Math.abs(v))*b;v*u<0&&(D-=Math.PI*Math.sign(o)*b);const I=Ge(ge(D/u)+this.center[0],-180,180),R=Ge(ge(2*Math.atan(Math.pow(m/C,1/u))-u1),-Ye,Ye);return new le(I,this.southernCenter?-R:R)}}class IC extends vp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:Ie(o),y:Oe(l),z:0}}unproject(o,l){const u=Be(o),m=Ve(l);return new le(u,m)}}const RE=ae(Ye);class $6 extends vp{project(o,l){const u=(l=ae(l))*l,m=u*u;return{x:.5*((o=ae(o))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,m=25,v=0,b=u*u;do{b=u*u;const I=b*b;v=(u*(1.007226+b*(.015085+I*(.028874*b-.044475-.005916*I)))-l)/(1.007226+b*(.045255+I*(.259866*b-.311325-.005916*11*I))),u=Ge(u-v,-RE,RE)}while(Math.abs(v)>1e-6&&--m>0);b=u*u;const C=Ge(ge(o/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),D=ge(u);return new le(C,D)}}const Ox=ae(Ye);class OC extends vp{project(o,l){l=ae(l),o=ae(o);const u=Math.cos(l),m=2/Math.PI,v=Math.acos(u*Math.cos(o/2)),b=Math.sin(v)/v,C=.5*(o*m+2*u*Math.sin(o/2)/b)||0,D=.5*(l+Math.sin(l)/b)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,v=25;const b=1e-6;let C=0,D=0;do{const I=Math.cos(m),R=Math.sin(m),N=2*R*I,j=R*R,K=I*I,Z=Math.cos(u/2),te=Math.sin(u/2),ce=2*Z*te,ue=te*te,xe=1-K*Z*Z,ve=xe?1/xe:0,ie=xe?Math.acos(I*Z)*Math.sqrt(1/xe):0,_e=.5*(2*ie*I*te+2*u/Math.PI)-o,we=.5*(ie*R+m)-l,Ce=.5*ve*(K*ue+ie*I*Z*j)+1/Math.PI,ze=ve*(ce*N/4-ie*R*te),qe=.125*ve*(N*te-ie*R*K*ce),Ze=.5*ve*(j*Z+ie*ue*I)+.5,Xe=ze*qe-Ze*Ce;C=(we*ze-_e*Ze)/Xe,D=(_e*qe-we*Ce)/Xe,u=Ge(u-C,-Math.PI,Math.PI),m=Ge(m-D,-Ox,Ox)}while((Math.abs(C)>b||Math.abs(D)>b)&&--v>0);return new le(ge(u),ge(m))}}class LE extends vp{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:m}=this;return{x:ae(o)*m*u+.5,y:-Math.sin(ae(l))/m*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:m}=this,v=-(l-.5)/u,b=Ge(ge((o-.5)/u)/m,-180,180),C=Math.asin(Ge(v*m,-1,1)),D=Ge(ge(C),-Ye,Ye);return new le(b,D)}}class Pv extends IC{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const m=nf(o,l,u);return ui(m,m,R0(hp(u))),{x:m[0],y:m[1],z:m[2]}}locationPoint(o,l,u){const m=se(l.lat,l.lng),v=Sn([],m),b=u?o._centerAltitude+u:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;yi(m,m,v,Te(1,0)*Xt*b);const C=Gn(new Float64Array(16));return Rr(C,o.pixelMatrix,o.globeMatrix),ui(m,m,C),new Wt(m[0],m[1])}pixelsPerMeter(o,l){return Te(1,0)*l}pixelSpaceConversion(o,l,u){const m=Te(1,o)*l,v=Cn(Te(1,45)*l,m,u);return this.pixelsPerMeter(o,l)/v}createTileMatrix(o,l,u){const m=rf(hp(u.canonical));return Rr(new Float64Array(16),o.globeMatrix,m)}createInversionMatrix(o,l){const{center:u}=o,m=R0(hp(l));return Ya(m,m,ae(u.lng)),Uo(m,m,ae(u.lat)),No(m,m,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(o,l,u,m){return ZS(o,l,u,!0)||new ot(0,0)}pointCoordinate3D(o,l,u){const m=this.pointCoordinate(o,l,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(o,l){return!ZS(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(m,v){const b=m.cameraToCenterDistance,C=m._centerAltitude*v,D=m._camera,I=m._camera.forward(),R=Cr([],Jn([],I,-b),[0,0,C]),N=m.worldSize/(2*Math.PI),j=[0,0,-N],K=m.width/m.height,Z=Math.tan(m.fovAboveCenter),te=Jn([],D.up(),Z),ce=Jn([],D.right(),Z*K),ue=Sn([],Cr([],Cr([],I,te),ce)),xe=[];let ve;if(new bd(R,ue).closestPointOnSphere(j,N,xe)){const ie=Cr([],xe,j),_e=Vr([],ie,R);ve=Math.cos(m.fovAboveCenter)*gr(_e)}else{const ie=Vr([],R,j),_e=Vr([],j,R);Sn(_e,_e);const we=gr(ie)-N;ve=Math.sqrt(we*(we+2*N));const Ce=Math.acos(ve/(N+we))-Math.acos(ei(I,_e));ve*=Math.cos(Ce)}return 1.01*ve}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Uh(o.zoom);if(u>0){const m=Sm(o,Te(1,o.center.lat)*o.worldSize),v=o.worldSize/(2*Math.PI),b=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Cn(l,m+v*(1-Math.cos(b)),Math.pow(u,10))}return l}upVector(o,l,u){return nf(l,u,o,1)}upVectorScale(o){return{metersToTile:Mu(O0(hp(o)))}}}function Rx(d){const o=d.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(d.name){case"mercator":return new IC(d);case"equirectangular":return new OE(d);case"naturalEarth":return new $6(d);case"equalEarth":return new IE(d);case"winkelTripel":return new OC(d);case"albers":return l?new LE(d):new Ix(d);case"lambertConformalConic":return l?new LE(d):new q6(d);case"globe":return new Pv(d)}throw new Error(`Invalid projection name: ${d.name}`)}const RC=fp.VectorTileFeature.types,FE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function c_(d,o,l,u,m,v,b,C,D,I,R,N,j){const K=C?Math.min(gf,Math.round(C[0])):0,Z=C?Math.min(gf,Math.round(C[1])):0;d.emplaceBack(o,l,Math.round(32*u),Math.round(32*m),v,b,(K<<1)+(D?1:0),Z,16*I,16*R,256*N,256*j)}function d_(d,o,l){d.emplaceBack(o,l)}function ar(d,o,l,u,m,v,b){d.emplaceBack(o,l,u,m,v,b)}function ne(d,o,l,u,m){d.emplaceBack(o,l,u,m),d.emplaceBack(o,l,u,m),d.emplaceBack(o,l,u,m),d.emplaceBack(o,l,u,m)}function LC(d){for(const o of d.sections)if(ol(o.text))return!0;return!1}class st{constructor(o){this.layoutVertexArray=new Gp,this.indexArray=new Qs,this.programConfigurations=o,this.segments=new ro,this.dynamicLayoutVertexArray=new gd,this.opacityVertexArray=new Bg,this.placedSymbolArray=new Iy,this.iconTransitioningVertexArray=new ch,this.globeExtVertexArray=new Cl,this.zOffsetVertexArray=new rp}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(o,l,u,m,v){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,r1.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,kE.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,FE,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,V6.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,yx.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||v)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,B6.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ln(st,"SymbolBuffers");class p1{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new ro,this.collisionVertexArray=new Vg,this.collisionVertexArrayExt=new gd}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,uv.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,ME.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ln(p1,"CollisionBuffers");class Iv{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gn([]),this.placementViewportMatrix=Gn([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ns(this.zoom,l["text-size"]),this.iconSizeData=ns(this.zoom,l["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),v=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==v&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===v||"auto"===v&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(b=>Dc[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new st(new dp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new st(new dp(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new Zp,this.lineVertexArray=new Ug,this.symbolInstances=new am}calculateGlyphDependencies(o,l,u,m,v){for(const b of o){const C=b.codePointAt(0);if(void 0===C)break;if(l[C]=!0,m&&v&&C<=65535){const D=bm[b];D&&(l[D.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const u=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!rx(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(o,l,u,m){const v=this.layers[0],b=v.layout,C="globe"===this.projection.name,D=b.get("text-font"),I=b.get("text-field"),R=b.get("icon-image"),[N,j]=b.get("icon-size-scale-range"),K=Ge(l.scaleFactor||1,N,j),Z=("constant"!==I.value.kind||I.value.value instanceof Ta&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),te="constant"!==R.value.kind||!!R.value.value||Object.keys(R.parameters).length>0,ce=b.get("symbol-sort-key");if(this.features=[],!Z&&!te)return;const ue=l.iconDependencies,xe=l.glyphDependencies,ve=l.availableImages,ie=new dr(this.zoom);for(const{feature:_e,id:we,index:Ce,sourceLayerIndex:ze}of o){const qe=v._featureFilter.needGeometry,Ze=bn(_e,qe);if(!v._featureFilter.filter(ie,Ze,u))continue;if(qe||(Ze.geometry=fn(_e,u,m)),C&&1!==_e.type&&u.z<=5){const Tt=Ze.geometry,Nt=.98078528056,ut=(Et,lt)=>ei(nf(Et.x,Et.y,u,1),nf(lt.x,lt.y,u,1))<Nt;for(let Et=0;Et<Tt.length;Et++)Tt[Et]=Ot(Tt[Et],ut)}let Xe,pt;if(Z){const Tt=v.getValueAndResolveTokens("text-field",Ze,u,ve),Nt=Ta.factory(Tt);LC(Nt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===tp()||this.hasRTLText&&Yr.isParsed())&&(Xe=bx(Nt,v,Ze))}if(te){const Tt=v.getValueAndResolveTokens("icon-image",Ze,u,ve);pt="string"==typeof Tt?ja.build(Tt):Tt}if(!Xe&&!pt)continue;const Rt=this.sortFeaturesByKey?ce.evaluate(Ze,{},u):void 0,Mt={id:we,text:Xe,icon:pt,index:Ce,sourceLayerIndex:ze,geometry:Ze.geometry,properties:_e.properties,type:RC[_e.type],sortKey:Rt};if(this.features.push(Mt),pt){const Tt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Nt,iconSecondary:ut}=EC(pt,this.iconSizeData,Tt["icon-size"],u,this.zoom,Mt,this.pixelRatio,K),Et=Nt.id.toString();if(ue.has(Et)?ue.get(Et).push(Nt):ue.set(Et,[Nt]),ut){const lt=ut.id.toString();ue.has(lt)?ue.get(lt).push(ut):ue.set(lt,[ut])}}if(Xe){const Tt=D.evaluate(Ze,{},u).join(","),Nt="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dc.vertical)>=0;for(const ut of Xe.sections)if(ut.image){const Et=ut.image.getPrimary().scaleSelf(this.pixelRatio),lt=Et.id.toString(),gt=ue.get(lt)||[];gt.push(Et),ue.set(lt,gt)}else{const Et=f0(Xe.toString()),lt=ut.fontStack||Tt,gt=xe[lt]=xe[lt]||{};this.calculateGlyphDependencies(ut.text,gt,Nt,this.allowVerticalPlacement,Et)}}}if("line"===b.get("symbol-placement")&&(this.features=function(_e){const we={},Ce={},ze=[];let qe=0;function Ze(Mt){ze.push(_e[Mt]),qe++}function Xe(Mt,Tt,Nt){const ut=Ce[Mt];return delete Ce[Mt],Ce[Tt]=ut,ze[ut].geometry[0].pop(),ze[ut].geometry[0]=ze[ut].geometry[0].concat(Nt[0]),ut}function pt(Mt,Tt,Nt){const ut=we[Tt];return delete we[Tt],we[Mt]=ut,ze[ut].geometry[0].shift(),ze[ut].geometry[0]=Nt[0].concat(ze[ut].geometry[0]),ut}function Rt(Mt,Tt,Nt){const ut=Nt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Mt}:${ut.x}:${ut.y}`}for(let Mt=0;Mt<_e.length;Mt++){const Tt=_e[Mt],Nt=Tt.geometry,ut=Tt.text?Tt.text.toString():null;if(!ut){Ze(Mt);continue}const Et=Rt(ut,Nt),lt=Rt(ut,Nt,!0);if(Et in Ce&&lt in we&&Ce[Et]!==we[lt]){const gt=pt(Et,lt,Nt),Bt=Xe(Et,lt,ze[gt].geometry);delete we[Et],delete Ce[lt],Ce[Rt(ut,ze[Bt].geometry,!0)]=Bt,ze[gt].geometry=null}else Et in Ce?Xe(Et,lt,Nt):lt in we?pt(Et,lt,Nt):(Ze(Mt),we[Et]=qe-1,Ce[lt]=qe-1)}return ze.filter(Mt=>Mt.geometry)}(this.features)),"hd-road-markup"===b.get("symbol-elevation-reference")){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const _e of l.elevationFeatures)this.elevationFeatureIdToIndex.set(_e.id,this.elevationFeatures.length),this.elevationFeatures.push(_e)}}else b.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((_e,we)=>_e.sortKey-we.sortKey)}update(o,l,u,m,v,b,C){this.text.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C),this.icon.programConfigurations.updatePaintArrays(o,l,v,u,m,b,C)}updateRoadElevation(){if("road"!==this.elevationType||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);if(65535===u.elevationFeatureIndex)continue;const m=this.elevationFeatures[u.elevationFeatureIndex];if(m){const v=.05+m.pointElevation(new Wt(u.tileAnchorX,u.tileAnchorY));u.zOffset!==v&&(o=!0,u.zOffset=v)}}o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(v,b,C)=>{u+=b,u>v.length&&v.resize(u);for(let D=-b;D<0;D++)v.emplace(D+u,C)},l=(v,b,C)=>{m+=b,m>v.length&&v.resize(m);for(let D=-b;D<0;D++)v.emplace(D+m,C)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:D,numIconVertices:I}=b,R=b.zOffset,N=I>0;if((C>0||D>0)&&(o(this.text.zOffsetVertexArray,C,R),o(this.text.zOffsetVertexArray,D,R)),N){const{placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:K}=b;j>=0&&l(this.icon.zOffsetVertexArray,I,R),K>=0&&l(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Rx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:m,y:v}of l)this.lineVertexArray.emplaceBack(m,v);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te,ce){const ue=o.indexArray,xe=o.layoutVertexArray,ve=o.globeExtVertexArray,ie=o.segments.prepareSegment(4*l.length,xe,ue,this.canOverlap?b.sortKey:void 0),_e=this.glyphOffsetArray.length,we=ie.vertexLength,Ce=this.allowVerticalPlacement&&C===Dc.vertical?Math.PI/2:0,ze=b.text&&b.text.sections;for(let Ze=0;Ze<l.length;Ze++){const{tl:Xe,tr:pt,bl:Rt,br:Mt,texPrimary:Tt,texSecondary:Nt,pixelOffsetTL:ut,pixelOffsetBR:Et,minFontScaleX:lt,minFontScaleY:gt,glyphOffset:Bt,isSDF:q,sectionIndex:gn}=l[Ze],hn=ie.vertexLength,Kt=Bt[1];if(c_(xe,I.x,I.y,Xe.x,Kt+Xe.y,Tt.x,Tt.y,u,q,ut.x,ut.y,lt,gt),c_(xe,I.x,I.y,pt.x,Kt+pt.y,Tt.x+Tt.w,Tt.y,u,q,Et.x,ut.y,lt,gt),c_(xe,I.x,I.y,Rt.x,Kt+Rt.y,Tt.x,Tt.y+Tt.h,u,q,ut.x,Et.y,lt,gt),c_(xe,I.x,I.y,Mt.x,Kt+Mt.y,Tt.x+Tt.w,Tt.y+Tt.h,u,q,Et.x,Et.y,lt,gt),D){const{x:Qe,y:Ft,z:Yt}=D.anchor,[un,Bn,Kn]=D.up;ar(ve,Qe,Ft,Yt,un,Bn,Kn),ar(ve,Qe,Ft,Yt,un,Bn,Kn),ar(ve,Qe,Ft,Yt,un,Bn,Kn),ar(ve,Qe,Ft,Yt,un,Bn,Kn),ne(o.dynamicLayoutVertexArray,Qe,Ft,Yt,Ce)}else ne(o.dynamicLayoutVertexArray,I.x,I.y,I.z,Ce);if(ce){const Qe=Nt||Tt;d_(o.iconTransitioningVertexArray,Qe.x,Qe.y),d_(o.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y),d_(o.iconTransitioningVertexArray,Qe.x,Qe.y+Qe.h),d_(o.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y+Qe.h)}ue.emplaceBack(hn,hn+1,hn+2),ue.emplaceBack(hn+1,hn+2,hn+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),Ze!==l.length-1&&gn===l[Ze+1].sectionIndex||o.programConfigurations.populatePaintArrays(xe.length,b,b.index,{},K,Z,te,ze&&ze[gn])}const qe=D?D.anchor:I;o.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,I.x,I.y,_e,this.glyphOffsetArray.length-_e,we,R,N,I.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],C,0,0,0,j,0)}_commitLayoutVertex(o,l,u,m,v,b,C){o.emplaceBack(l,u,m,v,b,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(o,l,u,m,v,b,C){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=D.vertexLength,R=C.tileAnchorX,N=C.tileAnchorY;for(let K=0;K<4;K++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,l,o.padding,C.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,v,b,R,N,new Wt(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,v,b,R,N,new Wt(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,v,b,R,N,new Wt(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,v,b,R,N,new Wt(o.x1,o.y2)),D.vertexLength+=4;const j=u.indexArray;j.emplaceBack(I,I+1),j.emplaceBack(I+1,I+2),j.emplaceBack(I+2,I+3),j.emplaceBack(I+3,I),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,m,v,b){for(let C=m;C<v;C++){const D=u.get(C),I=this.getSymbolInstanceTextSize(o,b,l,C);this._addCollisionDebugVertices(D,I,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(o,l,u,m,v,b){for(let C=m;C<v;C++){const D=u.get(C),I=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(D,I,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}generateCollisionDebugBuffers(o,l,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new p1(im,pv.members,ch),this.iconCollisionBox=new p1(im,pv.members,ch);const m=_p(this.iconSizeData,o),v=_p(this.textSizeData,o,u);for(let b=0;b<this.symbolInstances.length;b++){const C=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(v,o,l,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(v,o,l,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(m,o,l,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(m,o,l,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(o,l,u,m){const v=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),b=Mx(this.textSizeData,o,v)/xs;return this.tilePixelRatio*b}getSymbolInstanceIconSize(o,l,u){const m=this.icon.placedSymbolArray.get(u),v=Mx(this.iconSizeData,o,m);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(o,l,u,m){o.emplaceBack(l,-u,-u,m),o.emplaceBack(l,u,-u,m),o.emplaceBack(l,u,u,m),o.emplaceBack(l,-u,u,m)}_updateTextDebugCollisionBoxes(o,l,u,m,v,b,C){for(let D=m;D<v;D++){const I=u.get(D),R=this.getSymbolInstanceTextSize(o,b,l,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,I.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(o,l,u,m,v,b,C){for(let D=m;D<v;D++){const I=u.get(D),R=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,I.padding,b.zOffset)}}updateCollisionDebugBuffers(o,l,u,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const v=_p(this.iconSizeData,o,m),b=_p(this.textSizeData,o,u);for(let C=0;C<this.symbolInstances.length;C++){const D=this.symbolInstances.get(C);this._updateTextDebugCollisionBoxes(b,o,l,D.textBoxStartIndex,D.textBoxEndIndex,D,u),this._updateTextDebugCollisionBoxes(b,o,l,D.verticalTextBoxStartIndex,D.verticalTextBoxEndIndex,D,u),this._updateIconDebugCollisionBoxes(v,o,l,D.iconBoxStartIndex,D.iconBoxEndIndex,D,m),this._updateIconDebugCollisionBoxes(v,o,l,D.verticalIconBoxStartIndex,D.verticalIconBoxEndIndex,D,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,m,v,b,C,D,I){const R={};if(l<u){const{x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie,featureIndex:_e}=o.get(l);R.textBox={x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie},R.textFeatureIndex=_e}if(m<v){const{x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie,featureIndex:_e}=o.get(m);R.verticalTextBox={x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie},R.verticalTextFeatureIndex=_e}if(b<C){const{x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie,featureIndex:_e}=o.get(b);R.iconBox={x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie},R.iconFeatureIndex=_e}if(D<I){const{x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie,featureIndex:_e}=o.get(D);R.verticalIconBox={x1:N,y1:j,x2:K,y2:Z,padding:te,projectedAnchorX:ce,projectedAnchorY:ue,projectedAnchorZ:xe,tileAnchorX:ve,tileAnchorY:ie},R.verticalIconFeatureIndex=_e}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),m=u.vertexStartIndex+4*u.numGlyphs;for(let v=u.vertexStartIndex;v<m;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),m=[],v=[],b=[];for(let C=0;C<this.symbolInstances.length;++C){b.push(C);const D=this.symbolInstances.get(C);m.push(0|Math.round(l*D.tileAnchorX+u*D.tileAnchorY)),v.push(D.featureIndex)}return b.sort((C,D)=>m[C]-m[D]||v[D]-v[C]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:v,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:I}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&v!==m&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&b!==v&&b!==m&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let h_,Em,u_;ln(Iv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Iv.addDynamicAttributes=ne;class f1{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Fi,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ln(f1,"FormatSectionOverride",{omit:["defaultValue"]});const Ov=()=>u_||(u_={layout:h_||(h_=new jo({"symbol-placement":new Ut(it.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new nn(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(it.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ut(it.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ut(it.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ut(it.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ut(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new nn(it.layout_symbol["icon-size"]),"icon-size-scale-range":new Ut(it.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new nn(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new nn(it.layout_symbol["icon-image"]),"icon-rotate":new nn(it.layout_symbol["icon-rotate"]),"icon-padding":new Ut(it.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(it.layout_symbol["icon-keep-upright"]),"icon-offset":new nn(it.layout_symbol["icon-offset"]),"icon-anchor":new nn(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(it.layout_symbol["text-rotation-alignment"]),"text-field":new nn(it.layout_symbol["text-field"]),"text-font":new nn(it.layout_symbol["text-font"]),"text-size":new nn(it.layout_symbol["text-size"]),"text-size-scale-range":new Ut(it.layout_symbol["text-size-scale-range"]),"text-max-width":new nn(it.layout_symbol["text-max-width"]),"text-line-height":new nn(it.layout_symbol["text-line-height"]),"text-letter-spacing":new nn(it.layout_symbol["text-letter-spacing"]),"text-justify":new nn(it.layout_symbol["text-justify"]),"text-radial-offset":new nn(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(it.layout_symbol["text-variable-anchor"]),"text-anchor":new nn(it.layout_symbol["text-anchor"]),"text-max-angle":new Ut(it.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(it.layout_symbol["text-writing-mode"]),"text-rotate":new nn(it.layout_symbol["text-rotate"]),"text-padding":new Ut(it.layout_symbol["text-padding"]),"text-keep-upright":new Ut(it.layout_symbol["text-keep-upright"]),"text-transform":new nn(it.layout_symbol["text-transform"]),"text-offset":new nn(it.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(it.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ut(it.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(it.layout_symbol["text-optional"]),visibility:new Ut(it.layout_symbol.visibility)})),paint:Em||(Em=new jo({"icon-opacity":new nn(it.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new nn(it.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new nn(it.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new nn(it.paint_symbol["text-emissive-strength"]),"icon-color":new nn(it.paint_symbol["icon-color"]),"icon-halo-color":new nn(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new nn(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new nn(it.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(it.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ut(it.paint_symbol["icon-image-cross-fade"]),"text-opacity":new nn(it.paint_symbol["text-opacity"]),"text-occlusion-opacity":new nn(it.paint_symbol["text-occlusion-opacity"]),"text-color":new nn(it.paint_symbol["text-color"],{runtimeType:Da,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new nn(it.paint_symbol["text-halo-color"]),"text-halo-width":new nn(it.paint_symbol["text-halo-width"]),"text-halo-blur":new nn(it.paint_symbol["text-halo-blur"]),"text-translate":new Ut(it.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(it.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ut(it.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ut(it.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ut(it.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ut(it.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new nn(it.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},u_);class m1 extends Mn{constructor(o,l,u,m){super(o,Ov(),l,u,m),this._colorAdjustmentMatrix=Gn([]),this.hasInitialOcclusionOpacityProperties=void 0!==o.paint&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const v of u)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,u,m){return this._saturation===o&&this._contrast===l&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(v,b,C,D){v=Ps(v),b=ys(b);const I=Fc(),R=v/3,N=1-2*R,j=[N,R,R,0,R,N,R,0,R,R,N,0,0,0,0,1],K=.5-.5*b,Z=D-C;return Rr(I,[Z,0,0,0,0,Z,0,0,0,0,Z,0,C,C,C,1],[b,0,0,0,0,b,0,0,0,0,b,0,K,K,K,1]),Rr(I,I,j),I}(o,l,u,m),this._saturation=o,this._contrast=l,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,u,m){const v=this.layout.get(o).evaluate(l,{},u,m),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Lh(b.value)||!v?v:(C=l.properties,v.replace(/{([^{}]+)}/g,(I,R)=>R in C?String(C[R]):""));var C}createBucket(o){return new Iv(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Ov().paint.overridableProperties){if(!m1.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new f1(l),m=new Ku(u,l.property.specification,this.scope,this.options);let v=null;v="constant"===l.value.kind||"source"===l.value.kind?new Vp("source",m):new Zf("composite",m,l.value.zoomStops,l.value.interpolationType),this.paint._values[o]=new Hp(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&m1.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),m=Ov().paint.properties[l];let v=!1;const b=C=>{for(const D of C)if(m.overrides&&m.overrides.hasOverride(D))return void(v=!0)};if("constant"===u.value.kind&&u.value.value instanceof Ta)b(u.value.value.sections);else if("source"===u.value.kind){const C=I=>{v||(I instanceof Yn&&Vo(I.value)===au?b(I.value.sections):I instanceof Nd?b(I.sections):I.eachChild(C))},D=u.value;D._styleExpression&&C(D._styleExpression.expression)}return v}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,l,u){return{config:new Hh(this,{zoom:l,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let Rv,Lv,Lx,Fv;var Fx=Ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function zx(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Nx(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class zv{constructor(o,l,u,m){this.context=o,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=o.gl.createTexture(),this.update(l,{premultiply:m&&m.premultiply})}update(o,l){const u=o&&o instanceof HTMLVideoElement&&0===o.width?o.videoWidth:o.width,m=o&&o instanceof HTMLVideoElement&&0===o.height?o.videoHeight:o.height,{context:v}=this,{gl:b}=v,{x:C,y:D}=l&&l.position?l.position:{x:0,y:0},I=C+u,R=D+m;!this.size||this.size[0]===I&&this.size[1]===R||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!l||!1!==l.premultiply));const N=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&I>0&&R>0){const j=this.useMipmap?Math.floor(Math.log2(Math.max(I,R)))+1:1;b.texStorage2D(b.TEXTURE_2D,j,this.format,I,R),this.size=[I,R]}if(this.size)if(N)b.texSubImage2D(b.TEXTURE_2D,0,C,D,zx(this.format),Nx(this.format),o);else{const j=o.data;j&&b.texSubImage2D(b.TEXTURE_2D,0,C,D,u,m,zx(this.format),Nx(this.format),j)}this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(o,l,u=!1){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),o!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap&&!u?o===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,u,m){const{context:v}=this,{gl:b}=v;b.bindTexture(b.TEXTURE_2D,this.texture),l!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?o===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class Nv{constructor(o,l){this.context=o,this.texture=l}bind(o,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}function Bv(d,o,l,u,m,v,b,C){const D=[d,o,1,l,u,1,m,v,1],I=[b,C,1],R=Qr([],D),[N,j,K]=Nc(I,I,R);return zt(D,D,[N,0,0,0,j,0,0,0,K])}function FC(d,o,l,u,m,v,b,C){const D=function(I,R,N,j,K,Z,te,ce){const ue=Bv(0,0,1,0,1,1,0,1),xe=Bv(I,R,N,j,K,Z,te,ce);return zt(xe,xe,Qr([],ue))}(d,o,l,u,m,v,b,C);return[D[2]/D[8]/Xt,D[5]/D[8]/Xt]}function Vv(d){return[d[0],Math.min(Math.max(d[1],-Ye),Ye)]}class Bx extends Sa{constructor(o,l,u,m){super(),this.id=o,this.dispatcher=u,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new Fl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=ad(this.map._requestManager.transformRequest(this.url,Ui.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Va(u)):m&&(this.image=m instanceof HTMLImageElement?Un.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Nv(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Fl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Nv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],u=o[0][1];for(const v of o)v[1]>u&&(u=v[1]),v[1]<l&&(l=v[1]);const m=(u+l)/2;if(m>Ye?this.onNorthPole=!0:m<-Ye&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const v=o.map(ot.fromLngLat);this.tileID=function(b){let C=1/0,D=1/0,I=-1/0,R=-1/0;for(const te of b)C=Math.min(C,te.x),D=Math.min(D,te.y),I=Math.max(I,te.x),R=Math.max(R,te.y);const N=Math.max(I-C,R-D),j=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),K=Math.pow(2,j);let Z=Math.floor((C+I)/2*K);return Z>1&&(Z-=1),new kr(j,Z,Math.floor((D+R)/2*K))}(v),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Fl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const ue in this.tiles){const xe=this.tiles[ue];"loaded"!==xe.state&&(xe.state="loaded",xe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=a_(new kr(0,0,0),this.map.transform.projection),u=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ue){const xe=ue[1].x-ue[0].x,ve=ue[1].y-ue[0].y,ie=ue[2].x-ue[1].x,_e=ue[2].y-ue[1].y,we=ue[3].x-ue[2].x,Ce=ue[3].y-ue[2].y,ze=ue[0].x-ue[3].x,qe=ue[0].y-ue[3].y,Ze=xe*_e-ie*ve,Xe=ie*Ce-we*_e,pt=we*qe-ze*Ce,Rt=ze*ve-xe*qe;return Ze>0&&Xe>0&&pt>0&&Rt>0||Ze<0&&Xe<0&&pt<0&&Rt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=a_(this.tileID,this.map.transform.projection),[v,b,C,D]=this.coordinates.map(ue=>{const xe=m.projection.project(ue[0],ue[1]);return AC(m,xe)._round()});this.perspectiveTransform=FC(v.x,v.y,b.x,b.y,C.x,C.y,D.x,D.y);const I=this._boundsArray=new $p;I.emplaceBack(v.x,v.y,0,0),I.emplaceBack(b.x,b.y,Xt,0),I.emplaceBack(D.x,D.y,0,Xt),I.emplaceBack(C.x,C.y,Xt,Xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(I,Fx.members),this.boundsSegments=ro.simpleSegment(0,0,4,2);const R=[],N=[Vv((j=this.coordinates)[0]),Vv(j[1]),Vv(j[2]),Vv(j[3])];var j;const[K,Z,te,ce]=function(ue){let xe=ue[0][0],ve=xe,ie=ue[0][1],_e=ie;for(let we=1;we<ue.length;we++)ue[we][0]<xe?xe=ue[we][0]:ue[we][0]>ve&&(ve=ue[we][0]),ue[we][1]<ie?ie=ue[we][1]:ue[we][1]>_e&&(_e=ue[we][1]);return[xe,ie,ve-xe,_e-ie]}(N);{const ue=new $p,[xe,ve,ie,_e]=function(ut){let Et=ut[0].x,lt=Et,gt=ut[0].y,Bt=gt;for(let q=1;q<ut.length;q++)ut[q].x<Et?Et=ut[q].x:ut[q].x>lt&&(lt=ut[q].x),ut[q].y<gt?gt=ut[q].y:ut[q].y>Bt&&(Bt=ut[q].y);return[Et,gt,lt-Et,Bt-gt]}(u),we=ut=>[(ut.x-xe)/ie,(ut.y-ve)/_e],[Ce,ze,qe,Ze]=u.map(we),Xe=function(ut,Et,lt,gt,Bt,q,gn,hn){const Kt=Bv(0,0,1,0,1,1,0,1);return zt(Kt,Kt,Qr([],Bv(ut,Et,lt,gt,Bt,q,gn,hn)))}(Ce[0],Ce[1],ze[0],ze[1],qe[0],qe[1],Ze[0],Ze[1]);this.elevatedGlobePerspectiveTransform=FC(Ce[0],Ce[1],ze[0],ze[1],qe[0],qe[1],Ze[0],Ze[1]);const pt=(ut,Et)=>{R.push(ut.lng);const lt=Math.round((ut.lng-K)/te*Xt),gt=Math.round((ut.lat-Z)/ce*Xt),Bt=we(Et),q=Nc([],[Bt[0],Bt[1],1],Xe),gn=Math.round(q[0]/q[2]*Xt),hn=Math.round(q[1]/q[2]*Xt);ue.emplaceBack(lt,gt,gn,hn)},Rt=u[3].x-u[0].x,Mt=u[3].y-u[0].y,Tt=u[2].x-u[1].x,Nt=u[2].y-u[1].y;for(let ut=0;ut<65;ut++){const Et=ut/64,lt=[u[0].x+Et*Rt,u[0].y+Et*Mt],gt=[u[1].x+Et*Tt,u[1].y+Et*Nt],Bt=gt[0]-lt[0],q=gt[1]-lt[1];for(let gn=0;gn<65;gn++){const hn=gn/64,Kt={x:lt[0]+Bt*hn,y:lt[1]+q*hn,z:0};pt(l.projection.unproject(Kt.x,Kt.y),Kt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(ue,Fx.members)}{this.maxLongitudeTriangleSize=0;let ue=[],xe=new Qs;const ve=(ie,_e,we)=>{xe.emplaceBack(ie,_e,we);const Ce=R[ie],ze=R[_e],qe=R[we],Ze=Math.min(Math.min(Ce,ze),qe),Xe=Math.max(Math.max(Ce,ze),qe)-Ze;Xe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Xe),ue.push(Ze+Xe/2)};for(let ie=0;ie<64;ie++)for(let _e=0;_e<64;_e++){const we=65*ie+_e,Ce=we+1,ze=we+65,qe=ze+1;ve(we,ze,Ce),ve(Ce,ze,qe)}[ue,xe]=function(ie,_e){const we=Array.from({length:ie.length},(qe,Ze)=>Ze);we.sort((qe,Ze)=>ie[qe]-ie[Ze]);const Ce=[],ze=new Qs;for(let qe=0;qe<we.length;qe++){const Ze=we[qe];Ce.push(ie[Ze]);const Xe=3*Ze,pt=Xe+1;ze.emplaceBack(_e.uint16[Xe],_e.uint16[pt],_e.uint16[pt+1])}return[Ce,ze]}(ue,xe),this.elevatedGlobeTrianglesCenterLongitudes=ue,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(xe)}this.elevatedGlobeSegments=ro.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,te/Xt,0,ce/Xt,0,0,Z,K,0])}prepare(){const o=0!==Object.keys(this.tiles).length;if(this.tileID&&!o)return;const l=this.map.painter.context,u=l.gl;!this._dirty||this.texture instanceof Nv||(this.texture?this.texture.update(this.image):(this.texture=new zv(l,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(v=o+180)+360*Math.round((u[0]-v)/360);var v;const b=new ro,C=(N,j)=>{b.segments.push({vertexOffset:0,primitiveOffset:N,vertexLength:l.segments[0].vertexLength,primitiveLength:j,sortKey:void 0,vaos:{}})},D=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=D){const N=ka(u,0,u.length,m+D);return N===u.length||C(N,_s(u,N+1,u.length,m+360-D)-N),b}m<u[0]&&(m+=360);const I=_s(u,0,u.length,m-D);if(I===u.length)return C(0,u.length),b;C(0,I-0);const R=ka(u,I+1,u.length,m+D);return R!==u.length&&C(R,u.length-R),b}}const zC=(Math.pow(256,2)-1)/16907520;class NC extends Mn{constructor(o,l,u,m){super(o,{layout:Lx||(Lx=new jo({visibility:new Ut(it.layout_raster.visibility)})),paint:Fv||(Fv=new jo({"raster-opacity":new Ut(it.paint_raster["raster-opacity"]),"raster-color":new yu(it.paint_raster["raster-color"]),"raster-color-mix":new Ut(it.paint_raster["raster-color-mix"]),"raster-color-range":new Ut(it.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ut(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(it.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(it.paint_raster["raster-saturation"]),"raster-contrast":new Ut(it.paint_raster["raster-contrast"]),"raster-resampling":new Ut(it.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(it.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ut(it.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ut(it.paint_raster["raster-array-band"]),"raster-elevation":new Ut(it.paint_raster["raster-elevation"]),"raster-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},l,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof Bx&&(o._source.onNorthPole||o._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(o){"raster-color"!==o&&"raster-color-range"!==o||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Wg({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let BC,xd,VC,jC,zE;class jv extends Mn{constructor(o,l,u,m){super(o,{layout:BC||(BC=new jo({visibility:new Ut(it["layout_raster-particle"].visibility)})),paint:xd||(xd=new jo({"raster-particle-array-band":new Ut(it["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ut(it["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new yu(it["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ut(it["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ut(it["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ut(it["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ut(it["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ut(it["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},l,u,m),this._updateColorRamp(),this.lastInvalidatedAt=Un.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){"raster-particle-color"!==o&&"raster-particle-max-speed"!==o||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===o&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Wg({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Un.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class HC extends Mn{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(o){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function Vx(d,o,l){const u=[0,0,1],m=uc([]);return _r(m,m,l?-ae(d)+Math.PI:ae(d)),Ol(m,m,-ae(o)),zi(u,u,m),Sn(u,u)}function UC(d,o){const l=p_(d.projection,d.zoom,d.width,d.height),u=function(v,b,C,D,I){const R=new le(C.lng-180*vf,C.lat),N=new le(C.lng+180*vf,C.lat),j=v.project(R.lng,R.lat),K=v.project(N.lng,N.lat),Z=-Math.atan2(K.y-j.y,K.x-j.x),te=ot.fromLngLat(C);te.y=Ge(te.y,-1+vf,1-vf);const ce=te.toLngLat(),ue=v.project(ce.lng,ce.lat),xe=ot.fromLngLat(ce);xe.x+=vf;const ve=xe.toLngLat(),ie=v.project(ve.lng,ve.lat),_e=Hv(ie.x-ue.x,ie.y-ue.y,Z),we=ot.fromLngLat(ce);we.y+=vf;const Ce=we.toLngLat(),ze=v.project(Ce.lng,Ce.lat),qe=Hv(ze.x-ue.x,ze.y-ue.y,Z),Ze=Math.abs(_e.x)/Math.abs(qe.y),Xe=Gn([]);Pl(Xe,Xe,-Z*(1-(I?0:D)));const pt=Gn([]);return No(pt,pt,[1,1-(1-Ze)*D,1]),pt[4]=-qe.x/qe.y*D,Pl(pt,pt,Z),Rr(pt,Xe,pt),pt}(d.projection,0,d.center,l,o),m=qC(d);return No(u,u,[m,m,1]),u}function qC(d){const o=d.projection,l=p_(d.projection,d.zoom,d.width,d.height),u=jx(o,d.center),m=jx(o,le.convert(o.center));return Math.pow(2,u*l+(1-l)*m)}function p_(d,o,l,u,m=1/0){const v=d.range;if(!v)return 0;const b=Math.min(m,Math.max(l,u)),C=Math.log(b/1024)/Math.LN2;return Ne(v[0]+C,v[1]+C,o)}const vf=1/4e4;function jx(d,o){const l=Ge(o.lat,-Ye,Ye),u=new le(o.lng-180*vf,l),m=new le(o.lng+180*vf,l),v=d.project(u.lng,l),b=d.project(m.lng,l),C=ot.fromLngLat(u),D=ot.fromLngLat(m),I=b.x-v.x,R=b.y-v.y,N=D.x-C.x,j=D.y-C.y,K=Math.sqrt((N*N+j*j)/(I*I+R*R));return Math.log(K)/Math.LN2}function Hv(d,o,l){const u=Math.cos(l),m=Math.sin(l);return{x:d*u-o*m,y:d*m+o*u}}function $C(d,o,l){Gn(d),Pl(d,d,ae(o[2])),Uo(d,d,ae(o[0])),Ya(d,d,ae(o[1])),No(d,d,l),Rr(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Uv(d,o,l,u,m,v,b,C){const D=[l[0]-o[0],l[1]-o[1],0],I=[u[0]-o[0],u[1]-o[1],0];if(gr(D)<1e-12||gr(I)<1e-12)return uc(d);const R=si([],D,I);Sn(R,R),gs(I,u,o),D[2]=(v-m)*C,I[2]=(b-m)*C;const N=D;return si(N,D,I),Sn(N,N),pc(d,R,N)}function Hx(d,o,l=!1){const u=Uh(o.zoom),m=function(v,b,C){const D=b.worldSize,I=[v[12],v[13],v[14]],R=Ve(I[1]/D),N=Be(I[0]/D),j=Gn([]),K=Te(1,R)*D,Z=Te(1,0)*D*vt(R,b.zoom),te=1/zy(D);let ce=Z*te;if(C){const ie=p_(b.projection,b.zoom,b.width,b.height,1024);ce=te*b.projection.pixelSpaceConversion(b.center.lat,D,ie)}const ue=se(R,N);Cr(ue,ue,Jn([],Sn([],ue),K*ce*I[2]));const xe=function(ie){const _e=[ie[0],ie[1],ie[2]];let we=[0,1,0];const Ce=si([],we,_e);return si(we,_e,Ce),0===Yo(we)&&(we=[0,1,0],si(Ce,_e,we)),Sn(Ce,Ce),Sn(we,we),Sn(_e,_e),[Ce[0],Ce[1],Ce[2],0,we[0],we[1],we[2],0,_e[0],_e[1],_e[2],0,ie[0],ie[1],ie[2],1]}(ue);No(j,j,[ce,ce,ce*K]),ho(j,j,[-I[0],-I[1],-I[2]]);const ve=Rr([],b.globeMatrix,xe);return Rr(ve,ve,j),Rr(ve,ve,v),ve}(d,o,l);return u>0?function(b,C,D){const I=(Z,te,ce)=>{const ue=gr(Z),xe=gr(te),ve=tf(Z,te,ce);return Jn(ve,ve,1/gr(ve)*Cn(ue,xe,ce))},R=I([b[0],b[1],b[2]],[C[0],C[1],C[2]],D),N=I([b[4],b[5],b[6]],[C[4],C[5],C[6]],D),j=I([b[8],b[9],b[10]],[C[8],C[9],C[10]],D),K=tf([b[12],b[13],b[14]],[C[12],C[13],C[14]],D);return[R[0],R[1],R[2],0,N[0],N[1],N[2],0,j[0],j[1],j[2],0,K[0],K[1],K[2],1]}(m,function(b,C){const D=C.worldSize,I=Te(1,0)*D*vt(C.center.lat,C.zoom)/zy(D),R=Te(1,C.center.lat)*D,N=Gn([]);return Ya(N,N,ae(C.center.lng)),Uo(N,N,ae(C.center.lat)),ho(N,N,[0,0,M]),No(N,N,[I,I,I*R]),ho(N,N,[C.point.x-.5*D,C.point.y-.5*D,0]),Rr(N,N,b),Rr(N,C.globeMatrix,N)}(d,o),u):m}function GC(d,o,l,u){const m=eo.projectAabbCorners(u,l);let v=Number.MAX_VALUE,b=-1;for(let I=0;I<m.length;++I){const R=m[I];R[0]=(.5*R[0]+.5)*o.width,R[1]=(.5-.5*R[1])*o.height,R[2]<v&&(b=I,v=R[2])}const C=I=>new Wt(m[I][0],m[I][1]);let D;switch(b){case 0:case 6:D=[C(1),C(5),C(4),C(7),C(3),C(2),C(1)];break;case 1:case 7:D=[C(0),C(4),C(5),C(6),C(2),C(3),C(0)];break;case 3:case 5:D=[C(1),C(0),C(4),C(7),C(6),C(2),C(1)];break;default:D=[C(1),C(5),C(6),C(7),C(3),C(0),C(1)]}if(Dn(d,D))return v}const NE=Ei([{name:"a_pos_3f",components:3,type:"Float32"}]),Au=Ei([{name:"a_color_3f",components:3,type:"Float32"}]),Ux=Ei([{name:"a_color_4f",components:4,type:"Float32"}]),BE=Ei([{name:"a_uv_2f",components:2,type:"Float32"}]),WC=Ei([{name:"a_normal_3f",components:3,type:"Float32"}]),VE=Ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ZC=Ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),qx={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Dm{constructor(o,l,u,m){this.message=(o?`${o}: `:"")+u,m&&(this.identifier=m),null!=l&&l.__line__&&(this.line=l.__line__)}}function f_(d,o){const l=-1===d.indexOf("://");try{return new URL(d,l&&o?"http://example.com":void 0),!0}catch{return!1}}class jE{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $x{constructor(){this.instancedDataArray=new Wp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qv{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=o.styleDefinedModelURLs}updateFootprints(o,l){}populate(o,l,u,m){this.tileToMeter=Je(u);const v=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:b,id:C,index:D,sourceLayerIndex:I}of o){const R=C??(b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0),N=bn(b,v);if(!this.layers[0]._featureFilter.filter(new dr(this.zoom),N,u))continue;const j={id:R,sourceLayerIndex:I,index:D,geometry:v?N.geometry:fn(b,u,m),properties:b.properties,type:b.type,patterns:{}},K=this.addFeature(j,j.geometry,N);K&&l.featureIndex.insert(b,j.geometry,D,I,this.index,this.instancesPerModel[K].instancedDataArray.length,Xt/32)}this.lookup=null}update(o,l,u,m){for(const v in this.instancesPerModel){const b=this.instancesPerModel[v];for(const C in o)b.idToFeaturesIndex.hasOwnProperty(C)&&(this.evaluate(b.features[b.idToFeaturesIndex[C]],o[C],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];for(const m of u.features){const v=this.layers[0],b=m.feature,C=this.canonical,D=v.paint.get("model-rotation").evaluate(b,{},C),I=v.paint.get("model-scale").evaluate(b,{},C),R=v.paint.get("model-translation").evaluate(b,{},C);As(m.rotation,D)&&As(m.scale,I)&&As(m.translation,R)||(this.evaluate(m,m.featureStates,u,!0),o=!0)}}return o}updateReplacement(o,l,u,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const v=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(rx(this.activeReplacements,v))return!1;this.activeReplacements=v;let b=!1;for(const C in this.instancesPerModel){const D=this.instancesPerModel[C],I=D.instancedDataArray;for(const R of D.features){const N=R.instancedDataOffset,j=R.instancedDataCount;for(let K=0;K<j;K++){const Z=16*(K+N);let te=I.float32[Z+0];const ce=te>Xt;te=ce?te-Xt:te;const ue=Math.floor(te),xe=I.float32[Z+1];let ve=!1;for(const ie of this.activeReplacements)if(!qM(ie,u,qx.Model,m)&&!(ie.min.x>ue||ue>ie.max.x||ie.min.y>xe||xe>ie.max.y)&&(ve=sx(ox(ue,xe,o.canonical,ie.footprintTileId.canonical),ie.footprint),ve))break;I.float32[Z]=ve?te+Xt:te,b=b||ve!==ce}}}return b}isEmpty(){for(const o in this.instancesPerModel)if(0!==this.instancesPerModel[o].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];u.instancedDataArray.length<0||0===u.instancedDataArray.length||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=o.createVertexBuffer(u.instancedDataArray,VE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];0!==u.instancedDataArray.length&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)o.removeModel(l,"",!0)}addFeature(o,l,u){const m=this.layers[0],v=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!v)return ci(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),v;(f_(v,!1)||void 0!==this.styleDefinedModelURLs[v])&&(this.modelUris.includes(v)||this.modelUris.push(v)),this.instancesPerModel[v]||(this.instancesPerModel[v]=new $x);const b=this.instancesPerModel[v],C=b.instancedDataArray,D=new jE(u,C.length);for(const I of l)for(const R of I){if(R.x<0||R.x>=Xt||R.y<0||R.y>=Xt)continue;const N=(this.lookupDim-1)/Xt,j=this.lookupDim*(R.y*N|0)+R.x*N|0;if(this.lookup){if(0!==this.lookup[j])continue;this.lookup[j]=1}this.instanceCount++;const K=C.length;C.resize(K+1),b.instancesEvaluatedElevation.push(0),C.float32[16*K]=R.x,C.float32[16*K+1]=R.y}return D.instancedDataCount=b.instancedDataArray.length-D.instancedDataOffset,D.instancedDataCount>0&&(o.id&&(b.idToFeaturesIndex[o.id]=b.features.length),b.features.push(D),this.evaluate(D,{},b,!1)),v}getModelUris(){return this.modelUris}evaluate(o,l,u,m){const v=this.layers[0],b=o.feature,C=this.canonical,D=o.rotation=v.paint.get("model-rotation").evaluate(b,l,C),I=o.scale=v.paint.get("model-scale").evaluate(b,l,C),R=o.translation=v.paint.get("model-translation").evaluate(b,l,C),N=v.paint.get("model-color").evaluate(b,l,C);N.a=v.paint.get("model-color-mix-intensity").evaluate(b,l,C);const j=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),$C(j,D,I);const K=Math.round(100*N.a)+N.b/1.05;for(let Z=0;Z<o.instancedDataCount;++Z){const te=o.instancedDataOffset+Z,ce=16*te,ue=u.instancedDataArray.float32;let xe=0;m&&(xe=ue[ce+6]-u.instancesEvaluatedElevation[te]);const ve=0|ue[ce+1];ue[ce]=(0|ue[ce])+N.r/1.05,ue[ce+1]=ve+N.g/1.05,ue[ce+2]=K,ue[ce+3]=1/(C.z>10?this.tileToMeter:Je(C,ve)),ue[ce+4]=R[0],ue[ce+5]=R[1],ue[ce+6]=R[2]+xe,ue[ce+7]=j[0],ue[ce+8]=j[1],ue[ce+9]=j[2],ue[ce+10]=j[4],ue[ce+11]=j[5],ue[ce+12]=j[6],ue[ce+13]=j[8],ue[ce+14]=j[9],ue[ce+15]=j[10],u.instancesEvaluatedElevation[te]=R[2]}}}let Gx,Wx;ln(qv,"ModelBucket",{omit:["layers"]}),ln($x,"PerModelAttributes"),ln(jE,"ModelFeature");const wd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YC(d,o,l,u,m,v,b,C,D,I=!1){const R=l.zoom,N=l.project(u),j=vt(u.lat,R),K=1/j;Gn(d),ho(d,d,[N.x+b[0]*K,N.y+b[1]*K,b[2]]);let Z=1,te=1;const ce=l.worldSize;if(I){if("mercator"===l.projection.name){let ie=0;l.elevation&&(ie=l.elevation.getAtPointOrZero(new ot(N.x/ce,N.y/ce),0));const _e=_o([],[N.x,N.y,ie,1],l.projMatrix)[3]/l.cameraToCenterDistance;Z=_e,te=_e*vt(l.center.lat,R)}else if("globe"===l.projection.name){const ie=Hx(d,l),_e=[0,0,0,1];_o(_e,_e,Rr([],l.projMatrix,ie));const we=_e[3]/l.cameraToCenterDistance,Ce=Uh(R),ze=l.projection.pixelsPerMeter(u.lat,ce)*vt(u.lat,R),qe=l.projection.pixelsPerMeter(l.center.lat,ce)*vt(l.center.lat,R);Z=we/Cn(ze,kt(l.center.lat),Ce),te=we*j/ze,Z*=qe,te*=qe}}else Z=K;No(d,d,[Z,Z,te]);const ue=[...d],xe=o.orientation,ve=[];if($C(ve,[xe[0]+m[0],xe[1]+m[1],xe[2]+m[2]],v),Rr(d,ue,ve),C&&l.elevation){let ie=0;const _e=[];if(D&&l.elevation){ie=function(Ce,ze,qe,Ze,Xe){const pt=ze.elevation;if(!pt)return 0;const Rt=eo.projectAabbCorners(qe,Ze),Mt=Te(1,Xe.lat)*ze.worldSize,Tt=function(Qe,Ft){const Yt=[0,0,1],un=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Bn of un){const Kn=Qe[Bn.corners[0]],ri=Qe[Bn.corners[1]],_i=Qe[Bn.corners[2]],di=[ri[0]-Kn[0],ri[1]-Kn[1],Ft*(ri[2]-Kn[2])],li=si(di,di,[_i[0]-Kn[0],_i[1]-Kn[1],Ft*(_i[2]-Kn[2])]);Sn(li,li),Bn.dotProductWithUp=ei(li,Yt)}return un.sort((Bn,Kn)=>Bn.dotProductWithUp-Kn.dotProductWithUp),un[0].corners}(Rt,Mt),Nt=Rt[Tt[0]],ut=Rt[Tt[1]],Et=Rt[Tt[2]],lt=Rt[Tt[3]],gt=pt.getAtPointOrZero(new ot(Nt[0]/ze.worldSize,Nt[1]/ze.worldSize),0),Bt=pt.getAtPointOrZero(new ot(ut[0]/ze.worldSize,ut[1]/ze.worldSize),0),q=pt.getAtPointOrZero(new ot(Et[0]/ze.worldSize,Et[1]/ze.worldSize),0),gn=pt.getAtPointOrZero(new ot(lt[0]/ze.worldSize,lt[1]/ze.worldSize),0),hn=(gt+gn)/2,Kt=(Bt+q)/2;return hn>Kt?Bt<q?Uv(Ce,ut,lt,Nt,Bt,gn,gt,Mt):Uv(Ce,Et,Nt,lt,q,gt,gn,Mt):gt<gn?Uv(Ce,Nt,ut,Et,gt,Bt,q,Mt):Uv(Ce,lt,Et,ut,gn,q,Bt,Mt),Math.max(hn,Kt)}(_e,l,o.aabb,d,u);const we=Rr([],Xa([],_e),ve);Rr(d,ue,we)}else ie=l.elevation.getAtPointOrZero(new ot(N.x/ce,N.y/ce),0);0!==ie&&(d[14]+=ie)}}function m_(d,o,l=!1){d.uploaded||(d.gfxTexture=new zv(o,d.image,l?o.gl.R8:o.gl.RGBA8,{useMipmap:d.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function Zx(d,o,l){d.indexBuffer=o.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=o.createVertexBuffer(d.vertexArray,NE.members,!1,!0),d.normalArray&&(d.normalBuffer=o.createVertexBuffer(d.normalArray,WC.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=o.createVertexBuffer(d.texcoordArray,BE.members,!1,!0)),d.colorArray&&(d.colorBuffer=o.createVertexBuffer(d.colorArray,(12===d.colorArray.bytesPerElement?Au:Ux).members,!1,!0)),d.featureArray&&(d.pbrBuffer=o.createVertexBuffer(d.featureArray,ZC.members,!0)),d.segments=ro.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const u=d.material;u.pbrMetallicRoughness.baseColorTexture&&m_(u.pbrMetallicRoughness.baseColorTexture,o),u.pbrMetallicRoughness.metallicRoughnessTexture&&m_(u.pbrMetallicRoughness.metallicRoughnessTexture,o),u.normalTexture&&m_(u.normalTexture,o),u.occlusionTexture&&m_(u.occlusionTexture,o,l),u.emissionTexture&&m_(u.emissionTexture,o)}function Yx(d,o,l){if(d.meshes)for(const u of d.meshes)Zx(u,o,l);if(d.children)for(const u of d.children)Yx(u,o,l)}function g_(d){if(d.meshes)for(const o of d.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(d.children)for(const o of d.children)g_(o)}function Xx(d){if(d.meshes)for(const l of d.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(d.children)for(const l of d.children)Xx(l)}class wp{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const m=u||o.findDEMTileFor(l);if(!m||!m.dem)return;const v=m.dem,b=m.tileID,C=1<<l.canonical.z-b.canonical.z;return new wp(m,v.dim/Xt/C,[(l.canonical.x/C-b.canonical.x)*v.dim,(l.canonical.y/C-b.canonical.y)*v.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],m=Math.floor(o*this._scale+this._offset[0]),v=Math.floor(u);return new Wt(m,v)}getElevationAt(o,l,u,m){const v=o*this._scale+this._offset[0],b=l*this._scale+this._offset[1],C=Math.floor(v),D=Math.floor(b),I=this._dem;return m=!!m,u?Cn(Cn(I.get(C,D,m),I.get(C,D+1,m),b-D),Cn(I.get(C+1,D,m),I.get(C+1,D+1,m),b-D),v-C):I.get(C,D,m)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Te(1,o)*this._dem.stride}}const Tm=new Float32Array(262144),bf=new Uint8Array(262144);function __(d){let o=0;if(d.meshes)for(const l of d.meshes)o=Math.max(o,l.aabb.max[2]);if(d.children)for(const l of d.children)o=Math.max(o,__(l));return o}function HE(d,o,l){if(d.meshes)for(const u of d.meshes){if(u.aabb.min[0]===1/0)continue;const m=eo.applyTransform(u.aabb,d.matrix);l.insert(o,m.min[0],m.min[1],m.max[0],m.max[1])}if(d.children)for(const u of d.children)HE(u,o,l)}const XC=["","wall","door","roof","window","lamp","logo"];class Kx{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:__(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new eo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const l=new eo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==o&&(u.transformedAabb=eo.applyTransformFast(u.aabb,this.node.matrix),l.encapsulate(u.transformedAabb)),o++;this.aabb=l}return this.aabb}}class y_{constructor(o,l,u,m,v,b,C){this.id=u,this.layers=o,this.layerIds=this.layers.map(D=>D.fqid),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.modelTraits|=wd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=wd.HasMapboxMeshFeatures),v&&(this.modelTraits|=wd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const D of l)this.nodesInfo.push(new Kx(D)),HE(D,C.featureIndexArray.length,C.grid),C.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,C.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(o,l){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&l.push({footprint:m.footprint,id:o})}}update(o){const l=0!==Object.keys(o).length;if(l&&!this.stateDependentLayers.length)return;const u=l?this.stateDependentLayers:this.layers;if(!jc(o,this.states))for(const m of u)this.evaluate(m,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const u of l){const m=u.node;this.uploaded?this.updatePbrBuffer(m):Yx(m,o,!0)}for(const u of l)g_(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(const u of o.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),l=!0);return l}needsReEvaluation(o,l,u){const m=o.transform.projectionOptions,v=o.style.getBrightness(),b=this.brightness!==v;if(!this.uploaded||this.dirty||m.name!==this.projection.name||v_(u.paint.get("model-color").value,b)||v_(u.paint.get("model-color-mix-intensity").value,b)||v_(u.paint.get("model-roughness").value,b)||v_(u.paint.get("model-emissive-strength").value,b)||v_(u.paint.get("model-height-based-emissive-strength-multiplier").value,b)){this.projection=m,this.brightness=v;const C=this.getNodesInfo();for(const D of C)D.state=null;return!0}return!1}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const v of u){const b=v.feature;v.evaluatedScale=l.paint.get("model-scale").evaluate(b,{},m)}}evaluate(o,l){const u=this.getNodesInfo();for(const m of u){if(!m.node.meshes)continue;const v=m.feature,b=l&&l[v.id];if(jc(b,m.state))continue;m.state=structuredClone(b);const C=m.node.meshes&&m.node.meshes[0].featureData,D=m.evaluatedColor[2],I=m.evaluatedRMEA[2],R=this.id.canonical;if(m.hasTranslucentParts=!1,C){for(let N=0;N<XC.length;N++){const j=XC[N];j.length&&(v.properties.part=j);const K=o.paint.get("model-color").evaluate(v,b,R).toRenderColor(null),Z=o.paint.get("model-color-mix-intensity").evaluate(v,b,R);m.evaluatedColor[N]=[K.r,K.g,K.b,Z],m.evaluatedRMEA[N][0]=o.paint.get("model-roughness").evaluate(v,b,R),m.evaluatedRMEA[N][2]=o.paint.get("model-emissive-strength").evaluate(v,b,R),m.evaluatedRMEA[N][3]=K.a,m.emissionHeightBasedParams[N]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(v,b,R),!m.hasTranslucentParts&&K.a<1&&(m.hasTranslucentParts=!0)}delete v.properties.part,KC(m,D!==m.evaluatedColor[2]||I!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(v,b,R);m.evaluatedScale=o.paint.get("model-scale").evaluate(v,b,R),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,u,m){const v=o.findDEMTileFor(u);if(v&&(v.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(v.dem&&v.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=v.tileID.overscaledZ;const b=wp.create(o,u,v);if(!b)return;this.modelTraits&wd.HasMapboxMeshFeatures&&this.updateDEM(o,b,u,m);for(const C of this.getNodesInfo()){const D=C.node;if(!D.footprint||!D.footprint.vertices||!D.footprint.vertices.length)continue;const I=D.footprint.vertices;let R=b.getElevationAt(I[0].x,I[0].y,!0,!0);for(let N=1;N<I.length;N++)R=Math.min(R,b.getElevationAt(I[N].x,I[N].y,!0,!0));D.elevation=R}}this.terrainTile=v.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,u,m){let v=l._dem._modifiedForSources[m];if(void 0===v&&(l._dem._modifiedForSources[m]=[],v=l._dem._modifiedForSources[m]),v.includes(u.canonical))return;const b=l._dem.dim;v.push(u.canonical);let C=!1;for(const D of this.getNodesInfo()){const I=D.node;if(!I.footprint||!I.footprint.grid)continue;const R=I.footprint.grid,N=l.tileCoordToPixel(R.min.x,R.min.y),j=l.tileCoordToPixel(R.max.x,R.max.y),K=Math.min(Math.min(b-j.y,N.x),Math.min(N.y,b-j.x));if(K<0)continue;const Z=Ge(K,2,5);let te=Math.max(0,N.x-Z),ce=Math.max(0,N.y-Z),ue=Math.min(j.x+Z,b-1),xe=Math.min(j.y+Z,b-1);for(let we=ce;we<=xe;++we)for(let Ce=te;Ce<=ue;++Ce)bf[we*b+Ce]=255;let ve=0,ie=0;for(let we=0;we<R.cellsY;++we)for(let Ce=0;Ce<R.cellsX;++Ce){if(!R.cells[we*R.cellsX+Ce])continue;const ze=l.tileCoordToPixel(R.min.x+Ce/R.xScale,R.min.y+we/R.yScale),qe=l.tileCoordToPixel(R.min.x+(Ce+1)/R.xScale,R.min.y+(we+1)/R.yScale);for(let Ze=ze.y;Ze<=Math.min(qe.y+1,b-1);++Ze)for(let Xe=ze.x;Xe<=Math.min(qe.x+1,b-1);++Xe)255===bf[Ze*b+Xe]&&(bf[Ze*b+Xe]=0,ve+=l.getElevationAtPixel(Xe,Ze),ie++)}const _e=ve/ie;te=Math.max(1,N.x-Z),ce=Math.max(1,N.y-Z),ue=Math.min(j.x+Z,b-2),xe=Math.min(j.y+Z,b-2),C=!0;for(let we=ce;we<=xe;++we)for(let Ce=te;Ce<=ue;++Ce)0===bf[we*b+Ce]&&(Tm[we*b+Ce]=l._dem.set(Ce,we,_e));for(let we=1;we<Z;++we){te=Math.max(1,N.x-we),ce=Math.max(1,N.y-we),ue=Math.min(j.x+we,b-2),xe=Math.min(j.y+we,b-2);for(let Ce=ce;Ce<=xe;++Ce)for(let ze=te;ze<=ue;++ze){const qe=Ce*b+ze;if(255===bf[qe]){let Ze=0,Xe=0,pt=-1,Rt=-1;for(let Mt=-1;Mt<=1;++Mt)for(let Tt=-1;Tt<=1;++Tt){const Nt=(Ce+Mt)*b+ze+Tt;if(bf[Nt]>=we)continue;const ut=Tm[Nt],Et=Math.abs(ut);Et>Xe&&(Ze=ut,Xe=Et,pt=Tt,Rt=Mt)}if(Xe>.1){const Mt=1-(we+.5*Math.abs(pt*Rt))/Z;let Tt=l._dem.get(ze,Ce)+Ze*Mt;const Nt=l._dem.get(ze+pt,Ce+Rt),ut=l._dem.get(ze-pt,Ce-Rt,!0);(Tt-Nt)*(Tt-ut)>0&&(Tt=(Nt+ut)/2),Tm[qe]=l._dem.set(ze,Ce,Tt),bf[qe]=we}}}}}C&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=Un.now())}setFilter(o){this.filter=o?Yi(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new dr(this.id.overscaledZ),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const l of o)g_(l.node),Xx(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const u=l.getReplacementRegionsForTile(o.toUnwrapped()),m=this.getNodesInfo();for(let v=0;v<this.nodesInfo.length;v++){const b=m[v].node;m[v].hiddenByReplacement=!!b.footprint&&!u.find(C=>C.footprint===b.footprint)}}getHeightAtTileCoord(o,l){const u=this.getNodesInfo(),m=[],v=[0,0,0],b=Gn([]);for(let C=0;C<this.nodesInfo.length;C++){const D=u[C],I=D.node.meshes[0],R=I.transformedAabb;if(o<R.min[0]||l<R.min[1]||o>R.max[0]||l>R.max[1])continue;if(!0===D.node.hidden)return{height:1/0,maxHeight:D.feature.properties.height,hidden:!1,verticalScale:D.evaluatedScale[2]};mr(b,D.node.matrix),v[0]=o,v[1]=l,ui(v,v,b);const N=(v[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*64|0,j=64*Math.min(63,(v[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*64|0)+Math.min(63,N),K=I.heightmap[j];if(!(K<0&&D.node.footprint))return D.hiddenByReplacement?void 0:{height:K,maxHeight:D.feature.properties.height,hidden:!1,verticalScale:D.evaluatedScale[2]};if(D.node.footprint.grid.query(new Wt(o,l),new Wt(o,l),m),m.length>0)return{height:void 0,maxHeight:D.feature.properties.height,hidden:D.hiddenByReplacement,verticalScale:D.evaluatedScale[2]}}}}function v_(d,o){return d instanceof Vp&&!d.isLightConstant&&o}function UE(d,o,l,u,m,v,b,C){let D=(61440&o|(61440&o)>>4)>>8,I=(3840&o|(3840&o)>>4)>>4,R=240&o|(240&o)>>4;l[3]>0&&(D=Cn(D,255*l[0],l[3]),I=Cn(I,255*l[1],l[3]),R=Cn(R,255*l[2],l[3]));const N=D<<8|I,j=R<<8|Math.floor(255*u[3]),K=function(we){const Ce=Ge(we,0,2);return Math.min(Math.round(.5*Ce*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],Z=Ge(m[0],0,1),te=Ge(m[1],0,1),ce=Ge(m[2],0,1),ue=Ge(m[3],0,1);let xe,ve,ie,_e;if(Z!==te&&b!==v&&te!==Z){const we=b-v;ve=1/(we*(te-Z)),ie=-(v+we*Z)/(we*(te-Z));const Ce=Ge(m[4],-1,1);_e=Math.pow(10,Ce),xe=255*ce<<8|255*ue}else xe=65535,ve=0,ie=1,_e=1;if(d.emplaceBack(N,j,K,xe,ve,ie,_e),C){const we=C.length;C.clear();for(let Ce=0;Ce<we;Ce++)C.emplaceBack(N,j,K,xe,ve,ie,_e)}}function KC(d,o,l){const u=d.node;let m=0;const v=l&wd.HasMeshoptCompression;for(const b of u.meshes){if(u.lights&&u.lightMeshIndex===m||!b.featureData)continue;b.featureArray=new Ns,b.featureArray.reserve(b.featureData.length);let C=o;for(const D of b.featureData){const I=v?65535&D:D>>16&65535,R=v?D>>16&65535:65535&D,N=(15&R)<8?15&R:0,j=d.evaluatedRMEA[N],K=d.evaluatedColor[N],Z=d.emissionHeightBasedParams[N];let te;if(C&&2===N&&u.lights&&(te=new Ns,te.resize(10*u.lights.length)),UE(b.featureArray,I,K,j,Z,b.aabb.min[2],b.aabb.max[2],te),te&&C){C=!1;const ce=u.meshes[u.lightMeshIndex];ce.featureArray=te,ce.featureArray._trim()}}b.featureArray._trim(),m++}}function Qx(d,o,l,u){const m=1<<d.z;o.lat=Ve((u/Xt+d.y)/m),o.lng=Be((l/Xt+d.x)/m)}ln(y_,"Tiled3dModelBucket",{omit:["layers"]}),ln(Kx,"Tiled3dModelFeature");const b_={circle:class extends Mn{constructor(d,o,l,u){super(d,{layout:ir||(ir=new jo({"circle-sort-key":new nn(it.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ut(it.layout_circle["circle-elevation-reference"]),visibility:new Ut(it.layout_circle.visibility)})),paint:ao||(ao=new jo({"circle-radius":new nn(it.paint_circle["circle-radius"]),"circle-color":new nn(it.paint_circle["circle-color"]),"circle-blur":new nn(it.paint_circle["circle-blur"]),"circle-opacity":new nn(it.paint_circle["circle-opacity"]),"circle-translate":new Ut(it.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new nn(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new nn(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new nn(it.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ut(it.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u)}createBucket(d){return new mn(d)}queryRadius(d){const o=d;return ai("circle-radius",this,o)+ai("circle-stroke-width",this,o)+Hr(this.paint.get("circle-translate"))}queryIntersectsFeature(d,o,l,u,m,v,b,C){const D=Xr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,d.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return TM(d,u,v,b,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,o,l){const u=DM(this);return{config:new Hh(this,{zoom:o,lut:l}),defines:u,overrideFog:!1}}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends Mn{createBucket(d){return new Jc(d)}constructor(d,o,l,u){super(d,{layout:Ny||(Ny=new jo({visibility:new Ut(it.layout_heatmap.visibility)})),paint:Vb||(Vb=new jo({"heatmap-radius":new nn(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new nn(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yu(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(it.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){"heatmap-color"===d&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(d){return ai("heatmap-radius",this,d)}queryIntersectsFeature(d,o,l,u,m,v,b,C){const D=this.paint.get("heatmap-radius").evaluate(o,l);return TM(d,u,v,b,C,!0,!0,new Wt(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,o,l){return"heatmap"===d?{config:new Hh(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends Mn{constructor(d,o,l,u){super(d,{layout:By||(By=new jo({visibility:new Ut(it.layout_hillshade.visibility)})),paint:rc||(rc=new jo({"hillshade-illumination-direction":new Ut(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(it.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ut(it.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,o,l){return{overrideFog:!1}}},fill:class extends Mn{constructor(d,o,l,u){super(d,{layout:ex||(ex=new jo({"fill-sort-key":new nn(it.layout_fill["fill-sort-key"]),visibility:new Ut(it.layout_fill.visibility),"fill-elevation-reference":new Ut(it.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new nn(it.layout_fill["fill-construct-bridge-guard-rail"])})),paint:tx||(tx=new jo({"fill-antialias":new Ut(it.paint_fill["fill-antialias"]),"fill-opacity":new nn(it.paint_fill["fill-opacity"]),"fill-color":new nn(it.paint_fill["fill-color"]),"fill-outline-color":new nn(it.paint_fill["fill-outline-color"]),"fill-translate":new Ut(it.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new nn(it.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ut(it.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ut(it.paint_fill["fill-emissive-strength"]),"fill-z-offset":new nn(it.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new nn(it.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new nn(it.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u)}getProgramIds(){const d=this.paint.get("fill-pattern"),o=d&&d.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(d,o,l){return{config:new Hh(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(d,o){super.recalculate(d,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new Qy(d)}queryRadius(){return Hr(this.paint.get("fill-translate"))}queryIntersectsFeature(d,o,l,u,m,v){return!d.queryGeometry.isAboveHorizon&&xi(Vi(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,d.pixelToTileUnitsFactor),u)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(d){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const o=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=d?o&&!d:o}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends Mn{constructor(d,o,l,u){super(d,{layout:t1||(t1=new jo({visibility:new Ut(it["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ut(it["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:px||(px=new jo({"fill-extrusion-opacity":new Ut(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new nn(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nn(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ut(it["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new nn(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new nn(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ut(it["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ut(it["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ut(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ut(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ut(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ut(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ut(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ut(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ut(it["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ut(it["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new nn(it["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new nn(it["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ut(it["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ut(it["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ut(it["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ut(it["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nn(it["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new nn(it["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ut(it["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new rv(d)}queryRadius(){return Hr(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,o,l,u,m,v,b,C,D){const I=Xr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,d.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(o,l),N=this.paint.get("fill-extrusion-base").evaluate(o,l),j=[0,0],K=C&&v.elevation,Z=v.elevation?v.elevation.exaggeration():1,te=d.tile.getBucket(this);if(K&&te instanceof rv){const ie=te.centroidVertexArray,_e=D+1;_e<ie.length&&(j[0]=ie.geta_centroid_pos0(_e),j[1]=ie.geta_centroid_pos1(_e))}if(0===j[0]&&1===j[1])return!1;"globe"===v.projection.name&&(u=bE([u],[new Wt(0,0),new Wt(Xt,Xt)],d.tileID.canonical).map(ie=>ie.polygon).flat());const ce=K?C:null,[ue,xe]=(_e=u,we=N,Ce=R,ze=I,qe=b,Ze=ce,Xe=j,pt=Z,Rt=v.center.lat,"globe"===(ie=v).projection.name?function(Tt,Nt,ut,Et,lt,gt,Bt,q,gn,hn,Kt){const Qe=[],Ft=[],Yt=Tt.projection.upVectorScale(Kt,Tt.center.lat,Tt.worldSize).metersToTile,un=[0,0,0,1],Bn=[0,0,0,1],Kn=(_i,di,li,Dr)=>{_i[0]=di,_i[1]=li,_i[2]=Dr,_i[3]=1},ri=vE();ut>0&&(ut+=ri),Et+=ri;for(const _i of Nt){const di=[],li=[];for(const Dr of _i){const Ur=Dr.x+lt.x,ke=Dr.y+lt.y,Se=Tt.projection.projectTilePoint(Ur,ke,Kt),_t=Tt.projection.upVector(Kt,Dr.x,Dr.y);let $t=ut,en=Et;if(Bt){const Jt=tC(Ur,ke,ut,Et,Bt,q,gn,hn);$t+=Jt.base,en+=Jt.top}0!==ut?Kn(un,Se.x+_t[0]*Yt*$t,Se.y+_t[1]*Yt*$t,Se.z+_t[2]*Yt*$t):Kn(un,Se.x,Se.y,Se.z),Kn(Bn,Se.x+_t[0]*Yt*en,Se.y+_t[1]*Yt*en,Se.z+_t[2]*Yt*en),ui(un,un,gt),ui(Bn,Bn,gt),di.push(new uf(un[0],un[1],un[2])),li.push(new uf(Bn[0],Bn[1],Bn[2]))}Qe.push(di),Ft.push(li)}return[Qe,Ft]}(ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt,d.tileID.canonical):Ze?function(Tt,Nt,ut,Et,lt,gt,Bt,q,gn){const hn=[],Kt=[],Qe=[0,0,0,1];for(const Ft of Tt){const Yt=[],un=[];for(const Bn of Ft){const Kn=Bn.x+Et.x,ri=Bn.y+Et.y,_i=tC(Kn,ri,Nt,ut,gt,Bt,q,gn);Qe[0]=Kn,Qe[1]=ri,Qe[2]=_i.base,Qe[3]=1,_o(Qe,Qe,lt),Qe[3]=Math.max(Qe[3],1e-5);const di=new uf(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);Qe[0]=Kn,Qe[1]=ri,Qe[2]=_i.top,Qe[3]=1,_o(Qe,Qe,lt),Qe[3]=Math.max(Qe[3],1e-5);const li=new uf(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);Yt.push(di),un.push(li)}hn.push(Yt),Kt.push(un)}return[hn,Kt]}(_e,we,Ce,ze,qe,Ze,Xe,pt,Rt):function(Tt,Nt,ut,Et,lt){const gt=[],Bt=[],q=lt[8]*Nt,gn=lt[9]*Nt,hn=lt[10]*Nt,Kt=lt[11]*Nt,Qe=lt[8]*ut,Ft=lt[9]*ut,Yt=lt[10]*ut,un=lt[11]*ut;for(const Bn of Tt){const Kn=[],ri=[];for(const _i of Bn){const di=_i.x+Et.x,li=_i.y+Et.y,Dr=lt[0]*di+lt[4]*li+lt[12],Ur=lt[1]*di+lt[5]*li+lt[13],ke=lt[2]*di+lt[6]*li+lt[14],Se=lt[3]*di+lt[7]*li+lt[15],_t=Dr+q,$t=Ur+gn,en=ke+hn,Jt=Math.max(Se+Kt,1e-5),_n=Dr+Qe,Fn=Ur+Ft,Di=ke+Yt,Ti=Math.max(Se+un,1e-5);Kn.push(new uf(_t/Jt,$t/Jt,en/Jt)),ri.push(new uf(_n/Ti,Fn/Ti,Di/Ti))}gt.push(Kn),Bt.push(ri)}return[gt,Bt]}(_e,we,Ce,ze,qe)),ve=d.queryGeometry;var ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt;return function(ie,_e,we){let Ce=1/0;xi(we,_e)&&(Ce=lv(we,_e[0]));for(let ze=0;ze<_e.length;ze++){const qe=_e[ze],Ze=ie[ze];for(let Xe=0;Xe<qe.length-1;Xe++){const pt=qe[Xe],Rt=[pt,qe[Xe+1],Ze[Xe+1],Ze[Xe],pt];Dn(we,Rt)&&(Ce=Math.min(Ce,lv(we,Rt)))}}return Ce!==1/0&&Ce}(ue,xe,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends Mn{constructor(d,o,l,u){const m=dC();super(d,m,o,l,u),m.layout&&(this.layout=new ip(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if("line-gradient"===d){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof yr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,o){super.recalculate(d,o),this.paint._values["line-floorwidth"]=(()=>{if(mh)return mh;const l=dC();return mh=new hC(l.paint.properties["line-width"].specification),mh.useIntegerZoom=!0,mh})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new pf(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,o,l){const u=cC(this);return{config:new Hh(this,{zoom:o,lut:l}),defines:u,overrideFog:!1}}queryRadius(d){const o=d,l=wE(ai("line-width",this,o),ai("line-gap-width",this,o)),u=ai("line-offset",this,o);return l/2+Math.abs(u)+Hr(this.paint.get("line-translate"))}queryIntersectsFeature(d,o,l,u,m,v){if(d.queryGeometry.isAboveHorizon)return!1;const b=Vi(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,d.pixelToTileUnitsFactor),C=d.pixelToTileUnitsFactor/2*wE(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),D=this.paint.get("line-offset").evaluate(o,l);return D&&(u=function(I,R){const N=[],j=new Wt(0,0);for(let K=0;K<I.length;K++){const Z=I[K],te=[];for(let ce=0;ce<Z.length;ce++){const ue=Z[ce],xe=Z[ce+1],ve=0===ce?j:ue.sub(Z[ce-1])._unit()._perp(),ie=ce===Z.length-1?j:xe.sub(ue)._unit()._perp(),_e=ve._add(ie)._unit();_e._mult(1/(_e.x*ie.x+_e.y*ie.y)),te.push(_e._mult(R)._add(ue))}N.push(te)}return N}(u,D*d.pixelToTileUnitsFactor)),function(I,R,N){for(let j=0;j<R.length;j++){const K=R[j];if(I.length>=3)for(let Z=0;Z<K.length;Z++)if(wr(I,K[Z]))return!0;if(xr(I,K,N))return!0}return!1}(b,u,C)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:m1,background:class extends Mn{constructor(d,o,l,u){super(d,{layout:Rv||(Rv=new jo({visibility:new Ut(it.layout_background.visibility)})),paint:Lv||(Lv=new jo({"background-pitch-alignment":new Ut(it.paint_background["background-pitch-alignment"]),"background-color":new Ut(it.paint_background["background-color"]),"background-pattern":new Ut(it.paint_background["background-pattern"]),"background-opacity":new Ut(it.paint_background["background-opacity"]),"background-emissive-strength":new Ut(it.paint_background["background-emissive-strength"]),"background-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,o,l){return{overrideFog:!1}}is3D(d){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:NC,"raster-particle":jv,sky:class extends Mn{constructor(d,o,l,u){super(d,{layout:VC||(VC=new jo({visibility:new Ut(it.layout_sky.visibility)})),paint:jC||(jC=new jo({"sky-type":new Ut(it.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ut(it.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ut(it.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ut(it.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ut(it.paint_sky["sky-gradient-radius"]),"sky-gradient":new yu(it.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ut(it.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ut(it.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ut(it.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){"sky-gradient"===d?this._updateColorRamp():"sky-atmosphere-sun"!==d&&"sky-atmosphere-halo-color"!==d&&"sky-atmosphere-color"!==d&&"sky-atmosphere-sun-intensity"!==d||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(d,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),m=!u,v=d.style.light,b=v.properties.get("position");return m&&"viewport"===v.properties.get("anchor")&&ci("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Vx(b.azimuthal,90-b.polar,o):Vx(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return Vx(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return"atmosphere"===d?["skyboxCapture","skybox"]:"gradient"===d?["skyboxGradient"]:null}},slot:class extends Mn{constructor(d,o,l,u){super(d,{paint:zE||(zE=new jo({}))},o,null)}},model:class extends Mn{constructor(d,o,l,u){super(d,{layout:Gx||(Gx=new jo({visibility:new Ut(it.layout_model.visibility),"model-id":new nn(it.layout_model["model-id"])})),paint:Wx||(Wx=new jo({"model-opacity":new nn(it.paint_model["model-opacity"]),"model-rotation":new nn(it.paint_model["model-rotation"]),"model-scale":new nn(it.paint_model["model-scale"]),"model-translation":new nn(it.paint_model["model-translation"]),"model-color":new nn(it.paint_model["model-color"]),"model-color-mix-intensity":new nn(it.paint_model["model-color-mix-intensity"]),"model-type":new Ut(it.paint_model["model-type"]),"model-cast-shadows":new Ut(it.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ut(it.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ut(it.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new nn(it.paint_model["model-emissive-strength"]),"model-roughness":new nn(it.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new nn(it.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ut(it.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ut(it.paint_model["model-front-cutoff"]),"model-color-use-theme":new nn({type:"string",default:"default","property-type":"data-driven"})}))},o,l,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new qv(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof y_?Xt-1:0}queryIntersectsFeature(d,o,l,u,m,v){if(!this.modelManager)return!1;const b=this.modelManager,C=d.tile.getBucket(this);if(!(C&&C instanceof qv))return!1;for(const D in C.instancesPerModel){const I=C.instancesPerModel[D],R=void 0!==o.id?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(R)){const N=I.features[I.idToFeaturesIndex[R]],j=b.getModel(D,this.scope);if(!j)return!1;let K=Fc();const Z=new le(0,0),te=C.canonical;let ce=Number.MAX_VALUE;for(let ue=0;ue<N.instancedDataCount;++ue){const xe=16*(N.instancedDataOffset+ue),ve=I.instancedDataArray.float32,ie=[ve[xe+4],ve[xe+5],ve[xe+6]];Qx(te,Z,ve[xe],0|ve[xe+1]),YC(K,j,v,Z,N.rotation,N.scale,ie,!1,!1,!1),"globe"===v.projection.name&&(K=Hx(K,v));const _e=Rr([],v.projMatrix,K),we=d.queryGeometry,Ce=GC(we.isPointQuery()?we.screenBounds:we.screenGeometry,v,_e,j.aabb);null!=Ce&&(ce=Math.min(Ce,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(d,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||"model-color"!==d&&"model-color-mix-intensity"!==d&&"model-rotation"!==d&&"model-scale"!==d&&"model-translation"!==d&&"model-emissive-strength"!==d)}_isPropertyZoomDependent(d){const o=this._transitionablePaint._values[d];return null!=o&&null!=o.value&&null!=o.value.expression&&o.value.expression instanceof Zf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Mn{constructor(d,o,l,u){super(d,{layout:hf||(hf=new jo({"clip-layer-types":new Ut(it.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ut(it.layout_clip["clip-layer-scope"])})),paint:HM||(HM=new jo({}))},o,l,u)}recalculate(d,o){super.recalculate(d,o)}createBucket(d){return new UM(d)}is3D(d){return!0}}};class qE{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QC{constructor(){this.tasks={},this.taskQueue=[],Nn(["process"],this),this.invoker=new qE(this.process),this.nextId=0}add(o,l){const u=this.nextId++,m=function({type:v,isSymbolTile:b,zoom:C}){return C=C||0,"message"===v?0:"maybePrepare"!==v||b?"parseTile"!==v||b?"parseTile"===v&&b?300-C:"maybePrepare"===v&&b?400-C:500:200-C:100-C}(l);if(0===m){try{o()}finally{}return null}return this.tasks[u]={fn:o,metadata:l,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const v=this.tasks[this.taskQueue[m]];v.priority<l&&(l=v.priority,o=m)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class Jx{constructor(o,l,u){this.target=o,this.parent=l,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Nn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new QC}send(o,l,u,m,v=!1,b){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=b,this.callbacks[C]=u);const D=new Set;return this.target.postMessage({id:C,type:o,hasCallback:!!u,targetMapId:m,mustQueue:v,sourceMapId:this.mapId,data:Fh(l,D)},D),{cancel:()=>{u&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(o){const l=o.data;if(!l)return;const u=l.id;if(u&&(!l.targetMapId||this.mapId===l.targetMapId))if("<cancel>"===l.type){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(l.mustQueue||wi(self)){const m=this.callbacks[u],v=this.scheduler.add(()=>this.processTask(u,l),m&&m.metadata||{type:"message"});v&&(this.cancelCallbacks[u]=v)}else this.processTask(u,l)}processTask(o,l){if(delete this.cancelCallbacks[o],"<response>"===l.type){const u=this.callbacks[o];delete this.callbacks[o],u&&(l.error?u(zh(l.error)):u(null,zh(l.data)))}else{const u=new Set,m=l.hasCallback?(b,C)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:b?Fh(b):null,data:Fh(C,u)},u)}:()=>{},v=zh(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,v,m);else if(this.parent.getWorkerSource){const b=l.type.split("."),{source:C,scope:D}=v;this.parent.getWorkerSource(l.sourceMapId,b[0],C,D)[b[1]](v,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var x_={workerUrl:"",workerClass:null,workerParams:void 0};const ew="mapboxgl_preloaded_worker_pool";let w_,tw,xf=(()=>{class d{constructor(){this.active={}}acquire(l,u=d.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;)this.workers.push(null!=x_.workerClass?new x_.workerClass:new self.Worker(x_.workerUrl,x_.workerParams));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.workers&&0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ew]}numActive(){return Object.keys(this.active).length}}return d.workerCount=2,d})();class g1{constructor(o,l,u="Worker",m=xf.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=jt();const v=this.workerPool.acquire(this.id,m);for(let b=0;b<v.length;b++){const C=new g1.Actor(v[b],l,this.id);C.name=`${u} ${b}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,l,u){bt(this.actors,(m,v)=>{m.send(o,l,v)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $v(){return w_||(w_=new xf),w_}g1.Actor=Jx;const nw=new Ni(0,0,0),iw={PATH_RULE_UNSPECIFIED:0,PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},rw={LINE_CAP_UNSPECIFIED:0,LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Gv={LINE_JOIN_UNSPECIFIED:0,LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},JC={PAINT_ORDER_UNSPECIFIED:0,PAINT_ORDER_FILL_AND_STROKE:1,PAINT_ORDER_STROKE_AND_FILL:2},Kr={PATH_COMMAND_UNSPECIFIED:0,PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},e3={MASK_TYPE_UNSPECIFIED:0,MASK_TYPE_LUMINANCE:1,MASK_TYPE_ALPHA:2};function Wv(d,o,l){var u,m;1===d&&o.icons.push((u=l,m=l.readVarint()+l.pos,function(v){if(v.usvg_tree.height||(v.usvg_tree.height=v.usvg_tree.width),!v.metadata)return v;const{metadata:b}=v;if(b.content_area){const{content_area:C}=b;null==C.top&&(C.top=C.left),null==C.width&&(C.width=v.usvg_tree.width),null==C.height&&(C.height=C.width)}return b.stretch_x&&b.stretch_x.length&&t3(b,"x"),b.stretch_y&&b.stretch_y.length&&t3(b,"y"),v}(u.readFields($E,{name:void 0},m))))}function t3(d,o){const l=[],u=d[`stretch_${o}`];let m=null;for(let v=0;v<u.length;v++)null===m?m=0===l.length?u[0]:l[l.length-1][1]+u[v]:(l.push([m,m+u[v]]),m=null);d[`stretch_${o}_areas`]=l}function $E(d,o,l){var u,m;1===d?o.name=l.readString():2===d?o.metadata=(u=l,m=l.readVarint()+l.pos,u.readFields(GE,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)):3===d&&(o.usvg_tree=function(u,m){return u.readFields(YE,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(l,l.readVarint()+l.pos),o.data="usvg_tree")}function GE(d,o,l){var u,m;1===d?o.stretch_x=l.readPackedVarint():2===d?o.stretch_y=l.readPackedVarint():3===d?o.content_area=(u=l,m=l.readVarint()+l.pos,u.readFields(WE,{left:0},m)):4===d&&o.variables.push(function(u,m){return u.readFields(ZE,{name:void 0},m)}(l,l.readVarint()+l.pos))}function WE(d,o,l){1===d?o.left=l.readVarint():2===d?o.width=l.readVarint():3===d?o.top=l.readVarint():4===d&&(o.height=l.readVarint())}function ZE(d,o,l){1===d?o.name=l.readString():2===d&&(o.rgb_color=ow(l.readVarint()),o.value="rgb_color")}function YE(d,o,l){var u,m;1===d?o.width=o.height=l.readVarint():2===d?o.height=l.readVarint():3===d?o.children.push(Zv(l,l.readVarint()+l.pos)):4===d?o.linear_gradients.push((u=l,m=l.readVarint()+l.pos,u.readFields(XE,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m))):5===d?o.radial_gradients.push(function(u,m){return u.readFields(KE,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(l,l.readVarint()+l.pos)):7===d?o.clip_paths.push(function(u,m){return u.readFields(Pu,{children:[]},m)}(l,l.readVarint()+l.pos)):8===d&&o.masks.push(function(u,m){const v=u.readFields(k_,{left:0,width:20,mask_type:e3.MASK_TYPE_LUMINANCE,children:[]},m);return null==v.height&&(v.height=v.width),null==v.top&&(v.top=v.left),v}(l,l.readVarint()+l.pos))}function Zv(d,o){return d.readFields(n3,{},o)}function n3(d,o,l){var u,m;1===d?(o.group=(u=l,m=l.readVarint()+l.pos,u.readFields(r3,{opacity:255,children:[]},m)),o.node="group"):2===d&&(o.path=function(u,m){return u.readFields(o3,{paint_order:1,commands:[],step:1,diffs:[],rule:iw.PATH_RULE_NON_ZERO},m)}(l,l.readVarint()+l.pos),o.node="path")}function r3(d,o,l){1===d?o.transform=Yv(l,l.readVarint()+l.pos):2===d?o.opacity=l.readVarint():5===d?o.clip_path_idx=l.readVarint():6===d?o.mask_idx=l.readVarint():7===d&&o.children.push(Zv(l,l.readVarint()+l.pos))}function Yv(d,o){return d.readFields(G6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function G6(d,o,l){1===d?o.sx=l.readFloat():2===d?o.ky=l.readFloat():3===d?o.kx=l.readFloat():4===d?o.sy=l.readFloat():5===d?o.tx=l.readFloat():6===d&&(o.ty=l.readFloat())}function o3(d,o,l){var u,m;1===d?o.fill=(u=l,m=l.readVarint()+l.pos,u.readFields(s3,{rgb_color:nw,paint:"rgb_color",opacity:255},m)):2===d?o.stroke=function(u,m){return u.readFields(Xv,{rgb_color:nw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(l,l.readVarint()+l.pos):3===d?o.paint_order=l.readVarint():5===d?l.readPackedVarint(o.commands):6===d?o.step=l.readFloat():7===d?l.readPackedSVarint(o.diffs):8===d&&(o.rule=l.readVarint())}function s3(d,o,l){1===d?(o.rgb_color=ow(l.readVarint()),o.paint="rgb_color"):2===d?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):3===d?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):5===d&&(o.opacity=l.readVarint())}function ow(d){return new Ni((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function Xv(d,o,l){1===d?(o.rgb_color=ow(l.readVarint()),o.paint="rgb_color"):2===d?(o.linear_gradient_idx=l.readVarint(),o.paint="linear_gradient_idx"):3===d?(o.radial_gradient_idx=l.readVarint(),o.paint="radial_gradient_idx"):5===d?l.readPackedFloat(o.dasharray):6===d?o.dashoffset=l.readFloat():7===d?o.miterlimit=l.readFloat():8===d?o.opacity=l.readVarint():9===d?o.width=l.readFloat():10===d?o.linecap=l.readVarint():11===d&&(o.linejoin=l.readVarint())}function XE(d,o,l){1===d?o.transform=Yv(l,l.readVarint()+l.pos):2===d?o.spread_method=l.readVarint():3===d?o.stops.push(a3(l,l.readVarint()+l.pos)):4===d?o.x1=l.readFloat():5===d?o.y1=l.readFloat():6===d?o.x2=l.readFloat():7===d&&(o.y2=l.readFloat())}function a3(d,o){return d.readFields(sw,{offset:0,opacity:255,rgb_color:nw},o)}function sw(d,o,l){1===d?o.offset=l.readFloat():2===d?o.opacity=l.readVarint():3===d&&(o.rgb_color=ow(l.readVarint()))}function KE(d,o,l){1===d?o.transform=Yv(l,l.readVarint()+l.pos):2===d?o.spread_method=l.readVarint():3===d?o.stops.push(a3(l,l.readVarint()+l.pos)):4===d?o.cx=l.readFloat():5===d?o.cy=l.readFloat():6===d?o.r=l.readFloat():7===d?o.fx=l.readFloat():8===d?o.fy=l.readFloat():9===d&&(o.fr=l.readFloat())}function Pu(d,o,l){1===d?o.transform=Yv(l,l.readVarint()+l.pos):2===d?o.clip_path_idx=l.readVarint():3===d&&o.children.push(Zv(l,l.readVarint()+l.pos))}function k_(d,o,l){1===d?o.left=o.top=l.readFloat():2===d?o.width=o.height=l.readFloat():3===d?o.top=l.readFloat():4===d?o.height=l.readFloat():5===d?o.mask_type=l.readVarint():6===d?o.mask_idx=l.readVarint():7===d&&o.children.push(Zv(l,l.readVarint()+l.pos))}class Tc{static calculate(o={},l=[]){const u=new Map,m=new Map;if(0===Object.keys(o).length)return u;l.forEach(v=>{m.set(v.name,v.rgb_color||new Ni(0,0,0))});for(const[v,b]of Object.entries(o))m.has(v)?u.set(m.get(v).toStringPremultipliedAlpha(),b):console.warn(`Ignoring unknown image variable "${v}"`);return u}}function _h(d,o=255,l){const u=o/255,m=d.toStringPremultipliedAlpha(),v=l.has(m)?l.get(m).clone():d.clone();return v.a*=u,v.toString()}function wf(d,o){if(!Is()){const l=document.createElement("canvas");return l.width=d,l.height=o,l}return new OffscreenCanvas(d,o)}function yh(d,o){const l=Tc.calculate(o.params,d.metadata?d.metadata.variables:[]),u=d.usvg_tree,m=u.width,v=u.height,b=o.transform?o.transform:new DOMMatrix,C=Math.max(1,Math.round(m*b.a)),D=Math.max(1,Math.round(v*b.d)),I=new DOMMatrix([C/m,0,0,D/v,0,0]),R=wf(C,D).getContext("2d");return La(R,I,u,u,l),R.getImageData(0,0,C,D)}function La(d,o,l,u,m){for(const v of u.children)Am(d,o,l,v,m)}function Am(d,o,l,u,m){u.group?(d.save(),function(v,b,C,D,I){const R=null!=D.mask_idx?C.masks[D.mask_idx]:null,N=null!=D.clip_path_idx?C.clip_paths[D.clip_path_idx]:null;if(D.transform&&(b=M_(D.transform).preMultiplySelf(b)),255===D.opacity&&!(null!=N)&&!(null!=R))return void La(v,b,C,D,I);const j=wf(v.canvas.width,v.canvas.height),K=j.getContext("2d");La(K,b,C,D,I),N&&zm(K,b,C,N),R&&Nm(K,b,C,R,I),v.globalAlpha=D.opacity/255,v.drawImage(j,0,0)}(d,o,l,u.group,m),d.restore()):u.path&&(d.save(),function(v,b,C,D,I){const R=aw(D);v.setTransform(b),D.paint_order===JC.PAINT_ORDER_FILL_AND_STROKE?(Pm(v,C,D,R,I),Om(v,C,D,R,I)):(Om(v,C,D,R,I),Pm(v,C,D,R,I))}(d,o,l,u.path,m),d.restore())}function Pm(d,o,l,u,m){const v=l.fill;if(!v)return;const b=v.opacity/255;switch(v.paint){case"rgb_color":d.fillStyle=_h(v.rgb_color,v.opacity,m);break;case"linear_gradient_idx":d.fillStyle=Rm(d,o.linear_gradients[v.linear_gradient_idx],b,m);break;case"radial_gradient_idx":d.fillStyle=Lm(d,o.radial_gradients[v.radial_gradient_idx],b,m)}d.fill(u,Im(l))}function Im(d){return d.rule===iw.PATH_RULE_NON_ZERO?"nonzero":d.rule===iw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Om(d,o,l,u,m){const v=l.stroke;if(!v)return;d.lineWidth=v.width,d.miterLimit=v.miterlimit,d.setLineDash(v.dasharray),d.lineDashOffset=v.dashoffset;const b=v.opacity/255;switch(v.paint){case"rgb_color":d.strokeStyle=_h(v.rgb_color,v.opacity,m);break;case"linear_gradient_idx":d.strokeStyle=Rm(d,o.linear_gradients[v.linear_gradient_idx],b,m);break;case"radial_gradient_idx":d.strokeStyle=Lm(d,o.radial_gradients[v.radial_gradient_idx],b,m)}switch(v.linejoin){case Gv.LINE_JOIN_MITER_CLIP:case Gv.LINE_JOIN_MITER:d.lineJoin="miter";break;case Gv.LINE_JOIN_ROUND:d.lineJoin="round";break;case Gv.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(v.linecap){case rw.LINE_CAP_BUTT:d.lineCap="butt";break;case rw.LINE_CAP_ROUND:d.lineCap="round";break;case rw.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(u)}function Rm(d,o,l,u){if(1===o.stops.length){const j=o.stops[0];return _h(j.rgb_color,j.opacity*l,u)}const m=M_(o.transform),{x1:v,y1:b,x2:C,y2:D}=o,I=m.transformPoint(new DOMPoint(v,b)),R=m.transformPoint(new DOMPoint(C,D)),N=d.createLinearGradient(I.x,I.y,R.x,R.y);for(const j of o.stops)N.addColorStop(j.offset,_h(j.rgb_color,j.opacity*l,u));return N}function Lm(d,o,l,u){if(1===o.stops.length){const j=o.stops[0];return _h(j.rgb_color,j.opacity*l,u)}const m=M_(o.transform),{fx:v,fy:b,cx:C,cy:D}=o,I=m.transformPoint(new DOMPoint(v,b)),R=m.transformPoint(new DOMPoint(C,D)),N=d.createRadialGradient(I.x,I.y,0,R.x,R.y,o.r*((m.a+m.d)/2));for(const j of o.stops)N.addColorStop(j.offset,_h(j.rgb_color,j.opacity*l,u));return N}function Fm(d,o,l,u){const m=u.transform?M_(u.transform).preMultiplySelf(o):o,v=wf(d.canvas.width,d.canvas.height),b=v.getContext("2d");for(const D of u.children)if(D.group)Fm(b,m,l,D.group);else if(D.path){const I=D.path,R=new Path2D;R.addPath(aw(I),m),b.fill(R,Im(I))}const C=null!=u.clip_path_idx?l.clip_paths[u.clip_path_idx]:null;C&&zm(b,m,l,C),d.globalCompositeOperation="source-over",d.drawImage(v,0,0)}function zm(d,o,l,u){const m=wf(d.canvas.width,d.canvas.height);Fm(m.getContext("2d"),o,l,u),d.globalCompositeOperation="destination-in",d.drawImage(m,0,0)}function Nm(d,o,l,u,m){if(0===u.children.length)return;const v=null!=u.mask_idx?l.masks[u.mask_idx]:null;v&&Nm(d,o,l,v,m);const b=d.canvas.width,C=d.canvas.height,D=wf(b,C),I=D.getContext("2d"),R=u.width,N=u.height,j=u.left,K=u.top,Z=new Path2D,te=new Path2D;te.rect(j,K,R,N),Z.addPath(te,o),I.clip(Z);for(const xe of u.children)Am(I,o,l,xe,m);const ce=I.getImageData(0,0,b,C),ue=ce.data;if(u.mask_type===e3.MASK_TYPE_LUMINANCE)for(let xe=0;xe<ue.length;xe+=4)ue[xe+3]=ue[xe+3]/255*(.2126*ue[xe]+.7152*ue[xe+1]+.0722*ue[xe+2]);I.putImageData(ce,0,0),d.globalCompositeOperation="destination-in",d.drawImage(D,0,0)}function M_(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function aw(d){const o=new Path2D,l=d.step;let u=d.diffs[0]*l,m=d.diffs[1]*l;o.moveTo(u,m);for(let v=0,b=2;v<d.commands.length;v++)switch(d.commands[v]){case Kr.PATH_COMMAND_MOVE:u+=d.diffs[b++]*l,m+=d.diffs[b++]*l,o.moveTo(u,m);break;case Kr.PATH_COMMAND_LINE:u+=d.diffs[b++]*l,m+=d.diffs[b++]*l,o.lineTo(u,m);break;case Kr.PATH_COMMAND_QUAD:{const C=u+d.diffs[b++]*l,D=m+d.diffs[b++]*l;u=C+d.diffs[b++]*l,m=D+d.diffs[b++]*l,o.quadraticCurveTo(C,D,u,m);break}case Kr.PATH_COMMAND_CUBIC:{const C=u+d.diffs[b++]*l,D=m+d.diffs[b++]*l,I=C+d.diffs[b++]*l,R=D+d.diffs[b++]*l;u=I+d.diffs[b++]*l,m=R+d.diffs[b++]*l,o.bezierCurveTo(C,D,I,R,u,m);break}case Kr.PATH_COMMAND_CLOSE:o.closePath()}return o}class C_{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}delete(o){this.cache.delete(o)}}ln(C_,"LRUCache");class Kv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new $a(o,o.data)}getFromCache(o,l,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new C_(150)),this.cacheMap.get(u).get(cn(o.toString(),l))}setInCache(o,l,u,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new C_(150));const v=this.cacheDependenciesMap.get(m),b=cn(o.id.toString(),u);v.get(b)||v.set(b,new Set);const C=this.cacheMap.get(m),D=o.toString();v.get(b).add(D),C.put(cn(o.toString(),u),l)}removeImagesFromCacheByIds(o,l,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const m=this.cacheMap.get(u),v=this.cacheDependenciesMap.get(u);for(const b of o){const C=cn(b.toString(),l);if(v.has(C)){for(const D of v.get(C))m.delete(D);v.delete(C)}}}rasterize(o,l,u,m,v=yh){const b=this.getFromCache(o,u,m);if(b)return b.clone();const C=v(l.icon,o.options),D=Kv._getImage(C);return this.setInCache(o,D,u,m),D.clone()}}class lw{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function cw(d,o,l,u){let m=0,v=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(u[b])<1e-15){if(l[b]<d[b]||l[b]>o[b])return null}else{const C=1/u[b];let D=(d[b]-l[b])*C,I=(o[b]-l[b])*C;if(D>I){const R=D;D=I,I=R}if(D>m&&(m=D),I<v&&(v=I),m>v)return null}return m}function dw(d,o,l,u,m,v,b,C,D,I,R){const N=u-d,j=m-o,K=v-l,Z=b-d,te=C-o,ce=D-l,ue=R[1]*ce-R[2]*te,xe=R[2]*Z-R[0]*ce,ve=R[0]*te-R[1]*Z,ie=N*ue+j*xe+K*ve;if(Math.abs(ie)<1e-15)return null;const _e=1/ie,we=I[0]-d,Ce=I[1]-o,ze=I[2]-l,qe=(we*ue+Ce*xe+ze*ve)*_e;if(qe<0||qe>1)return null;const Ze=Ce*K-ze*j,Xe=ze*N-we*K,pt=we*j-Ce*N,Rt=(R[0]*Ze+R[1]*Xe+R[2]*pt)*_e;return Rt<0||qe+Rt>1?null:(Z*Ze+te*Xe+ce*pt)*_e}function hw(d,o,l){return(d-o)/(l-o)}function uw(d,o,l,u,m,v,b,C,D){const I=1<<l,R=v-u,N=b-m,j=(d+1)/I*R+u,K=(o+0)/I*N+m,Z=(o+1)/I*N+m;C[0]=(d+0)/I*R+u,C[1]=K,D[0]=j,D[1]=Z}class Qv{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(v){const b=Math.ceil(Math.log2(v.dim/8)),C=[];let D=Math.ceil(Math.pow(2,b));const I=1/D,R=(K,Z,te,ce,ue)=>{const xe=ce?1:0,ve=(K+1)*te-xe,ie=Z*te,_e=(Z+1)*te-xe;ue[0]=K*te,ue[1]=ie,ue[2]=ve,ue[3]=_e};let N=new lw(D);const j=[];for(let K=0;K<D*D;K++){R(K%D,Math.floor(K/D),I,!1,j);const Z=Bm(j[0],j[1],v),te=Bm(j[2],j[1],v),ce=Bm(j[2],j[3],v),ue=Bm(j[0],j[3],v);N.minimums.push(Math.min(Z,te,ce,ue)),N.maximums.push(Math.max(Z,te,ce,ue)),N.leaves.push(1)}for(C.push(N),D/=2;D>=1;D/=2){const K=C[C.length-1];N=new lw(D);for(let Z=0;Z<D*D;Z++){R(Z%D,Math.floor(Z/D),2,!0,j);const te=K.getElevation(j[0],j[1]),ce=K.getElevation(j[2],j[1]),ue=K.getElevation(j[2],j[3]),xe=K.getElevation(j[0],j[3]),ve=K.isLeaf(j[0],j[1]),ie=K.isLeaf(j[2],j[1]),_e=K.isLeaf(j[2],j[3]),we=K.isLeaf(j[0],j[3]),Ce=Math.min(te.min,ce.min,ue.min,xe.min),ze=Math.max(te.max,ce.max,ue.max,xe.max),qe=ve&&ie&&_e&&we;N.maximums.push(ze),N.minimums.push(Ce),N.leaves.push(ze-Ce<=5&&qe?1:0)}C.push(N)}return C}(this.dem),u=l.length-1,m=l[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,m,v,b,C=1){return cw([o,l,-100],[u,m,this.maximums[0]*C],v,b)}raycast(o,l,u,m,v,b,C=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,l,u,m,v,b,C);if(null==D)return null;const I=[],R=[],N=[],j=[],K=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;K.length>0;){const{idx:Z,t:te,nodex:ce,nodey:ue,depth:xe}=K.pop();if(this.leaves[Z]){uw(ce,ue,xe,o,l,u,m,N,j);const ie=1<<xe,_e=(ce+0)/ie,we=(ce+1)/ie,Ce=(ue+0)/ie,ze=(ue+1)/ie,qe=Bm(_e,Ce,this.dem)*C,Ze=Bm(we,Ce,this.dem)*C,Xe=Bm(we,ze,this.dem)*C,pt=Bm(_e,ze,this.dem)*C,Rt=dw(N[0],N[1],qe,j[0],N[1],Ze,j[0],j[1],Xe,v,b),Mt=dw(j[0],j[1],Xe,N[0],j[1],pt,N[0],N[1],qe,v,b),Tt=Math.min(null!==Rt?Rt:Number.MAX_VALUE,null!==Mt?Mt:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const Nt=yi([],v,b,te);if(l3(qe,Ze,pt,Xe,hw(Nt[0],N[0],j[0]),hw(Nt[1],N[1],j[1]))>=Nt[2])return te}continue}let ve=0;for(let ie=0;ie<this._siblingOffset.length;ie++){uw((ce<<1)+this._siblingOffset[ie][0],(ue<<1)+this._siblingOffset[ie][1],xe+1,o,l,u,m,N,j),N[2]=-100,j[2]=this.maximums[this.childOffsets[Z]+ie]*C;const _e=cw(N,j,v,b);if(null!=_e){const we=_e;I[ie]=we;let Ce=!1;for(let ze=0;ze<ve&&!Ce;ze++)we>=I[R[ze]]&&(R.splice(ze,0,ie),Ce=!0);Ce||(R[ve]=ie),ve++}}for(let ie=0;ie<ve;ie++){const _e=R[ie];K.push({idx:this.childOffsets[Z]+_e,t:I[_e],nodex:(ce<<1)+this._siblingOffset[_e][0],nodey:(ue<<1)+this._siblingOffset[_e][1],depth:xe+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,m,v){if(1===o[m].isLeaf(l,u))return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const b=m-1,C=o[b];let D=0,I=0;for(let R=0;R<this._siblingOffset.length;R++){const N=2*l+this._siblingOffset[R][0],j=2*u+this._siblingOffset[R][1],K=C.getElevation(N,j),Z=C.isLeaf(N,j),te=this._addNode(K.min,K.max,Z);Z&&(D|=1<<R),I||(I=te)}for(let R=0;R<this._siblingOffset.length;R++)D&1<<R||this._construct(o,2*l+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],b,I+R)}}function l3(d,o,l,u,m,v){return Cn(Cn(d,l,v),Cn(o,u,v),m)}function Bm(d,o,l){const u=l.dim,m=Ge(d*u-.5,0,u-1),v=Ge(o*u-.5,0,u-1),b=Math.floor(m),C=Math.floor(v),D=Math.min(b+1,u-1),I=Math.min(C+1,u-1);return l3(l.get(b,C),l.get(D,C),l.get(b,I),l.get(D,I),m-b,v-C)}const W6={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function QE(d,o,l){return(256*d*256+256*o+l)/10-1e4}function JE(d,o,l){return 256*d+o+l/256-32768}class pw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,m=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return void ci(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,b=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let D=0;D<v;D++)b[this._idx(-1,D)]=b[this._idx(0,D)],b[this._idx(v,D)]=b[this._idx(v-1,D)],b[this._idx(D,-1)]=b[this._idx(D,0)],b[this._idx(D,v)]=b[this._idx(D,v-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(v,-1)]=b[this._idx(v-1,0)],b[this._idx(-1,v)]=b[this._idx(0,v-1)],b[this._idx(v,v)]=b[this._idx(v-1,v-1)]}const C="terrarium"===u?JE:QE;for(let D=0;D<b.length;++D){const I=4*D;this.floatView[D]=C(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Un.now()}_buildQuadTree(){this._tree=new Qv(this)}get(o,l,u=!1){u&&(o=Ge(o,-1,this.dim),l=Ge(l,-1,this.dim));const m=this._idx(o,l);return this.floatView[m]}set(o,l,u){const m=this._idx(o,l),v=this.floatView[m];return this.floatView[m]=u,u-v}static getUnpackVector(o){return W6[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],m=pw.getUnpackVector(l);let v=Math.floor((o+m[3])/m[2]);return u[2]=v%256,v=Math.floor(v/256),u[1]=v%256,v=Math.floor(v/256),u[0]=v,u}getPixels(){return new AM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,v=l*this.dim+this.dim,b=u*this.dim,C=u*this.dim+this.dim;switch(l){case-1:m=v-1;break;case 1:v=m+1}switch(u){case-1:b=C-1;break;case 1:C=b+1}const D=-l*this.dim,I=-u*this.dim;for(let R=b;R<C;R++)for(let N=m;N<v;N++){const j=4*this._idx(N,R),K=4*this._idx(N+D,R+I);this.pixels[j+0]=o.pixels[K+0],this.pixels[j+1]=o.pixels[K+1],this.pixels[j+2]=o.pixels[K+2],this.pixels[j+3]=o.pixels[K+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function eD(d,o,l){var u,m;1===d?o.headerLength=l.readFixed32():2===d?o.x=l.readVarint():3===d?o.y=l.readVarint():4===d?o.z=l.readVarint():5===d&&o.layers.push((u=l,m=l.readVarint()+l.pos,u.readFields(fw,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)))}function Z6(d,o,l){var u,m;1===d?(o.delta_filter=(u=l,m=l.readVarint()+l.pos,u.readFields(tD,{blockSize:0},m)),o.filter="delta_filter"):2===d?(l.readVarint(),o.filter="zigzag_filter"):3===d?(l.readVarint(),o.filter="bitshuffle_filter"):4===d&&(l.readVarint(),o.filter="byteshuffle_filter")}function tD(d,o,l){1===d&&(o.blockSize=l.readVarint())}function nD(d,o,l){1===d?(l.readVarint(),o.codec="gzip_data"):2===d?(l.readVarint(),o.codec="jpeg_image"):3===d?(l.readVarint(),o.codec="webp_image"):4===d&&(l.readVarint(),o.codec="png_image")}function iD(d,o,l){let u=0,m=0;var v,b;1===d?o.firstByte=l.readFixed64():2===d?o.lastByte=l.readFixed64():3===d?o.filters.push((v=l,b=l.readVarint()+l.pos,v.readFields(Z6,{},b))):4===d?o.codec=function(v,b){return v.readFields(nD,{},b)}(l,l.readVarint()+l.pos):5===d?m=l.readFloat():6===d?u=l.readFloat():7===d?o.bands.push(l.readString()):8===d?o.offset=l.readDouble():9===d&&(o.scale=l.readDouble()),0===o.offset&&(o.offset=m),0===o.scale&&(o.scale=u)}function fw(d,o,l){var u,m;1===d?o.version=l.readVarint():2===d?o.name=l.readString():3===d?o.units=l.readString():4===d?o.tileSize=l.readVarint():5===d?o.buffer=l.readVarint():6===d?o.pixelFormat=l.readVarint():7===d&&o.dataIndex.push((u=l,m=l.readVarint()+l.pos,u.readFields(iD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)))}function S_(d,o,l){if(2===d)u=l,m=l.readVarint()+l.pos,u.readFields(mw,o,m);else if(3===d)throw new Error("Not implemented");var u,m}function mw(d,o,l){if(1===d){let u=0;const m=l.readVarint()+l.pos;for(;l.pos<m;)o[u++]=l.readVarint()}}function Jv(d,o){if(4!==o.length)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let u=2;u>=1;u--){const m=1===u?1:0,v=2===u?1:0;for(let b=0;b<o[0];b++){const C=o[1]*b;for(let D=m;D<o[1];D++){const I=o[2]*(D+C);for(let R=v;R<o[2];R++){const N=o[3]*(R+I);for(let j=0;j<o[3];j++){const K=N+j;d[K]+=d[K-l]}}}}l*=o[u]}return d}function c3(d){for(let o=0,l=d.length;o<l;o++)d[o]=d[o]>>>1^-(1&d[o]);return d}function E_(d,o){switch(o){case"uint32":return d;case"uint16":for(let l=0;l<d.length;l+=2){const u=d[l],m=d[l+1];d[l]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,d[l+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return d;case"uint8":for(let l=0;l<d.length;l+=4){const u=d[l],m=d[l+1],v=d[l+2],b=d[l+3];d[l+0]=(192&u)>>6|(192&m)>>4|(192&v)>>2|192&b,d[l+1]=(48&u)>>4|(48&m)>>2|48&v|(48&b)<<2,d[l+2]=(12&u)>>2|12&m|(12&v)<<2|(12&b)<<4,d[l+3]=3&u|(3&m)<<2|(3&v)<<4|(3&b)<<6}return d;default:throw new Error(`Invalid pixel format, "${o}"`)}}ln(pw,"DEMData"),ln(Qv,"DemMinMaxQuadTree",{omit:["dem"]});var kd=Uint8Array,D_=Uint16Array,T_=Int32Array,d3=new kd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h3=new kd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rD=new kd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u3=function(d,o){for(var l=new D_(31),u=0;u<31;++u)l[u]=o+=1<<d[u-1];var m=new T_(l[30]);for(u=1;u<30;++u)for(var v=l[u];v<l[u+1];++v)m[v]=v-l[u]<<5|u;return{b:l,r:m}},e2=u3(d3,2),A_=e2.b,t2=e2.r;A_[28]=258,t2[258]=28;for(var Y6=u3(h3,0).b,p3=new D_(32768),Bs=0;Bs<32768;++Bs){var kf=(43690&Bs)>>1|(21845&Bs)<<1;p3[Bs]=((65280&(kf=(61680&(kf=(52428&kf)>>2|(13107&kf)<<2))>>4|(3855&kf)<<4))>>8|(255&kf)<<8)>>1}var P_=function(d,o,l){for(var u=d.length,m=0,v=new D_(o);m<u;++m)d[m]&&++v[d[m]-1];var b,C=new D_(o);for(m=1;m<o;++m)C[m]=C[m-1]+v[m-1]<<1;b=new D_(1<<o);var D=15-o;for(m=0;m<u;++m)if(d[m])for(var I=m<<4|d[m],R=o-d[m],N=C[d[m]-1]++<<R,j=N|(1<<R)-1;N<=j;++N)b[p3[N]>>D]=I;return b},_1=new kd(288);for(Bs=0;Bs<144;++Bs)_1[Bs]=8;for(Bs=144;Bs<256;++Bs)_1[Bs]=9;for(Bs=256;Bs<280;++Bs)_1[Bs]=7;for(Bs=280;Bs<288;++Bs)_1[Bs]=8;var f3=new kd(32);for(Bs=0;Bs<32;++Bs)f3[Bs]=5;var oD=P_(_1,9),He=P_(f3,5),n2=function(d){for(var o=d[0],l=1;l<d.length;++l)d[l]>o&&(o=d[l]);return o},vh=function(d,o,l){var u=o/8|0;return(d[u]|d[u+1]<<8)>>(7&o)&l},gw=function(d,o){var l=o/8|0;return(d[l]|d[l+1]<<8|d[l+2]<<16)>>(7&o)},sD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],qh=function(d,o,l){var u=new Error(o||sD[d]);if(u.code=d,Error.captureStackTrace&&Error.captureStackTrace(u,qh),!l)throw u;return u},Fa=new kd(0),ye=typeof TextDecoder<"u"&&new TextDecoder;try{ye.decode(Fa,{stream:!0})}catch{}const _w={gzip_data:"gzip"};class bh extends Error{constructor(o){super(o),this.name="MRTError"}}const z={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},B={uint32:1,uint16:2,uint8:4},$e={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let r2;class o2{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const l=this.layers[o];if(!l)throw new bh(`Layer '${o}' not found`);return l}getHeaderLength(o){const l=new Uint8Array(o),u=new DataView(o);if(13!==l[0])throw new bh("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(o){const l=new Uint8Array(o),u=this.getHeaderLength(o);if(l.length<u)throw new bh(`Expected header with length >= ${u} but got buffer of length ${l.length}`);const m=new r2(l.subarray(0,u)).readFields(eD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new bh(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const v of m.layers)this.layers[v.name]=new m3(v,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const l=[],u=this.getLayer(o.layerName);for(let m of o.blockIndices){const v=u.dataIndex[m],b=v.firstByte-o.firstByte,C=v.lastByte-o.firstByte;if(u._blocksInProgress.has(m))continue;const D={layerName:u.name,firstByte:b,lastByte:C,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[v.bands.length].concat(u.bandShape),buffer:u.buffer,codec:v.codec.codec,filters:v.filters.map(I=>I.filter)};u._blocksInProgress.add(m),l.push(D)}return new g3(l,()=>{l.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,v)=>{if(l.forEach(b=>u._blocksInProgress.delete(b.blockIndex)),m)throw m;v.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class m3{constructor({version:o,name:l,units:u,tileSize:m,pixelFormat:v,buffer:b,dataIndex:C},D){if(this.version=o,1!==this.version)throw new bh(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=u,this.tileSize=m,this.buffer=b,this.pixelFormat=z[v],this.dataIndex=C,this.bandShape=[m+2*b,m+2*b,B[this.pixelFormat]],this._decodedBlocks=new C_(D?D.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return B[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[v,b]of m.bands.entries())if(b===o)return{bandIndex:l+v,blockIndex:u,blockBandIndex:v};l+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(o>=l&&o<l+m.bands.length)return{bandIndex:o,blockIndex:u,blockBandIndex:o-l};l+=m.bands.length}break;default:throw new bh(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(o){let l=1/0,u=-1/0;const m=[],v=new Set;for(const b of o){const{blockIndex:C}=this.getBlockForBand(b);if(C<0)throw new bh(`Invalid band: ${JSON.stringify(b)}`);const D=this.dataIndex[C];m.includes(C)||m.push(C),v.add(C),l=Math.min(l,D.firstByte),u=Math.max(u,D.lastByte)}if(v.size>this.cacheSize)throw new bh(`Number of blocks to decode (${v.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:u,blockIndices:m}}hasBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){const{blockIndex:l,blockBandIndex:u}=this.getBlockForBand(o);if(l<0)throw new bh(`Band not found: ${JSON.stringify(o)}`);const m=this._decodedBlocks.get(l.toString());if(!m)throw new bh(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const v=this.dataIndex[l],b=this.bandShape.reduce((I,R)=>I*R,1),C=u*b,D=m.subarray(C,C+b);return{data:D,bytes:new Uint8Array(D.buffer).subarray(D.byteOffset,D.byteOffset+D.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:v.offset,scale:v.scale}}}o2.setPbf=function(d){r2=d};class g3{constructor(o,l,u){this.tasks=o,this._onCancel=l,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}o2.performDecoding=function(d,o){const l=new Uint8Array(d);return Promise.all(o.tasks.map(u=>{const{layerName:m,firstByte:v,lastByte:b,pixelFormat:C,blockShape:D,blockIndex:I,filters:R,codec:N}=u,j=l.subarray(v,b+1),K=new Uint32Array(D[0]*D[1]*D[2]);let Z;if("gzip_data"!==N)throw new bh(`Unhandled codec: ${N}`);return Z=function(te,ce){if(!globalThis.DecompressionStream&&"gzip_data"===ce)return Promise.resolve(((ie=function(Ce){31==Ce[0]&&139==Ce[1]&&8==Ce[2]||qh(6,"invalid gzip data");var ze=Ce[3],qe=10;4&ze&&(qe+=2+(Ce[10]|Ce[11]<<8));for(var Ze=(ze>>3&1)+(ze>>4&1);Ze>0;Ze-=!Ce[qe++]);return qe+(2&ze)}(ve=te))+8>ve.length&&qh(6,"invalid gzip data"),function(Ce,ze,qe,Ze){var Xe=Ce.length;if(!Xe||ze.f&&!ze.l)return qe||new kd(0);var pt=!qe,Rt=pt||2!=ze.i,Mt=ze.i;pt&&(qe=new kd(3*Xe));var Tt,Nt,ut=function(Fo){var $r=qe.length;if(Fo>$r){var Pr=new kd(Math.max(2*$r,Fo));Pr.set(qe),qe=Pr}},Et=ze.f||0,lt=ze.p||0,gt=ze.b||0,Bt=ze.l,q=ze.d,gn=ze.m,hn=ze.n,Kt=8*Xe;do{if(!Bt){Et=vh(Ce,lt,1);var Qe=vh(Ce,lt+1,3);if(lt+=3,!Qe){var Ft=Ce[(ke=4+((lt+7)/8|0))-4]|Ce[ke-3]<<8,Yt=ke+Ft;if(Yt>Xe){Mt&&qh(0);break}Rt&&ut(gt+Ft),qe.set(Ce.subarray(ke,Yt),gt),ze.b=gt+=Ft,ze.p=lt=8*Yt,ze.f=Et;continue}if(1==Qe)Bt=oD,q=He,gn=9,hn=5;else if(2==Qe){var un=vh(Ce,lt,31)+257,Bn=vh(Ce,lt+10,15)+4,Kn=un+vh(Ce,lt+5,31)+1;lt+=14;for(var ri=new kd(Kn),_i=new kd(19),di=0;di<Bn;++di)_i[rD[di]]=vh(Ce,lt+3*di,7);lt+=3*Bn;var li=n2(_i),Dr=(1<<li)-1,Ur=P_(_i,li);for(di=0;di<Kn;){var ke,Se=Ur[vh(Ce,lt,Dr)];if(lt+=15&Se,(ke=Se>>4)<16)ri[di++]=ke;else{var _t=0,$t=0;for(16==ke?($t=3+vh(Ce,lt,3),lt+=2,_t=ri[di-1]):17==ke?($t=3+vh(Ce,lt,7),lt+=3):18==ke&&($t=11+vh(Ce,lt,127),lt+=7);$t--;)ri[di++]=_t}}var en=ri.subarray(0,un),Jt=ri.subarray(un);gn=n2(en),hn=n2(Jt),Bt=P_(en,gn),q=P_(Jt,hn)}else qh(1);if(lt>Kt){Mt&&qh(0);break}}Rt&&ut(gt+131072);for(var _n=(1<<gn)-1,Fn=(1<<hn)-1,Di=lt;;Di=lt){var Ti=(_t=Bt[gw(Ce,lt)&_n])>>4;if((lt+=15&_t)>Kt){Mt&&qh(0);break}if(_t||qh(2),Ti<256)qe[gt++]=Ti;else{if(256==Ti){Di=lt,Bt=null;break}var hi=Ti-254;Ti>264&&(hi=vh(Ce,lt,(1<<(Ai=d3[di=Ti-257]))-1)+A_[di],lt+=Ai);var ur=q[gw(Ce,lt)&Fn],zr=ur>>4;if(ur||qh(3),lt+=15&ur,Jt=Y6[zr],zr>3){var Ai=h3[zr];Jt+=gw(Ce,lt)&(1<<Ai)-1,lt+=Ai}if(lt>Kt){Mt&&qh(0);break}Rt&&ut(gt+131072);var bo=gt+hi;if(gt<Jt){var qr=0-Jt,or=Math.min(Jt,bo);for(qr+gt<0&&qh(3);gt<or;++gt)qe[gt]=(void 0)[qr+gt]}for(;gt<bo;++gt)qe[gt]=qe[gt-Jt]}}ze.l=Bt,ze.p=Di,ze.b=gt,ze.f=Et,Bt&&(Et=1,ze.m=gn,ze.d=q,ze.n=hn)}while(!Et);return gt!=qe.length&&pt?(Tt=qe,(null==(Nt=gt)||Nt>Tt.length)&&(Nt=Tt.length),new kd(Tt.subarray(0,Nt))):qe.subarray(0,gt)}(ve.subarray(ie,-8),{i:2},new kd(((ue=ve)[(xe=ue.length)-4]|ue[xe-3]<<8|ue[xe-2]<<16|ue[xe-1]<<24)>>>0))));var ue,xe,ve,ie;const _e=_w[ce];if(!_e)throw new Error(`Unhandled codec: ${ce}`);const we=new globalThis.DecompressionStream(_e);return new Response(new Blob([te]).stream().pipeThrough(we)).arrayBuffer().then(Ce=>new Uint8Array(Ce))}(j,N).then(te=>(new r2(te).readFields(S_,K),new $e[C](K.buffer))),Z.then(te=>{for(let ce=R.length-1;ce>=0;ce--)switch(R[ce]){case"delta_filter":Jv(te,D);break;case"zigzag_filter":c3(te);break;case"bitshuffle_filter":E_(te,C);break;default:throw new bh(`Unhandled filter "${R[ce]}"`)}return{layerName:m,blockIndex:I,data:te}}).catch(te=>{throw te})}))},ln(g3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ln(o2,"MapboxRasterTile"),ln(m3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let kp,Vm,$l,jm,yw,y1=null;function Ki(){return wi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Vm||cs.DRACO_URL}function v1(){if(wi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(jm)return jm;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return jm=WebAssembly.validate(d)?cs.MESHOPT_SIMD_URL:cs.MESHOPT_URL,jm}const I_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qt={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},b1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function _3(d,o,l){const u=l.json.bufferViews.length,m=l.buffers.length;o.bufferView=u,l.json.bufferViews[u]={buffer:m,byteLength:d.byteLength},l.buffers[m]=d}const s2="KHR_draco_mesh_compression";function y3(d,o){const l=d.extensions&&d.extensions[s2];if(!l)return;const u=new $l.Decoder,m=c2(o,l.bufferView),v=new $l.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,v))throw new Error("Failed to decode Draco mesh");const b=o.json.accessors[d.indices],C=I_[b.componentType],D=b.count*C.BYTES_PER_ELEMENT,I=$l._malloc(D);C===Uint16Array?u.GetTrianglesUInt16Array(v,D,I):u.GetTrianglesUInt32Array(v,D,I),_3($l.memory.buffer.slice(I,I+D),b,o),$l._free(I);for(const R of Object.keys(l.attributes)){const N=u.GetAttributeByUniqueId(v,l.attributes[R]),j=o.json.accessors[d.attributes[R]],K=qt[j.componentType],Z=j.count*b1[j.type]*I_[j.componentType].BYTES_PER_ELEMENT,te=$l._malloc(Z);u.GetAttributeDataArrayForAllPoints(v,N,$l[K],Z,te),_3($l.memory.buffer.slice(te,te+Z),j,o),$l._free(te)}u.destroy(),v.destroy(),delete d.extensions[s2]}const O_="EXT_meshopt_compression";function ht(d,o){if(!d.extensions||!d.extensions[O_])return;const l=d.extensions[O_],u=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);yw.decodeGltfBuffer(m,l.count,l.byteStride,u,l.mode,l.filter),d.buffer=o.buffers.length,d.byteOffset=0,o.buffers[d.buffer]=m.buffer,delete d.extensions[O_]}const v3=1179937895,a2=new TextDecoder("utf8");function l2(d,o){return new URL(d,o).href}function R_(d,o,l,u){return fetch(l2(d.uri,u)).then(m=>m.arrayBuffer()).then(m=>{o.buffers[l]=m})}function c2(d,o){const l=d.json.bufferViews[o];return new Uint8Array(d.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function b3(d,o,l,u){if(d.uri){const m=l2(d.uri,u);return fetch(m).then(v=>v.blob()).then(v=>createImageBitmap(v)).then(v=>{o.images[l]=v})}if(void 0!==d.bufferView){const m=c2(o,d.bufferView),v=new Blob([m],{type:d.mimeType});return createImageBitmap(v).then(b=>{o.images[l]=b})}}function vw(d,o=0,l){const u={json:null,images:[],buffers:[]};if(new Uint32Array(d,o,1)[0]===v3){const R=new Uint32Array(d,o);let N=2;const j=(R[N++]>>2)-3,K=R[N++]>>2;if(N++,u.json=JSON.parse(a2.decode(R.subarray(N,N+K))),N+=K,N<j){const Z=R[N++];N++;const te=o+(N<<2);u.buffers[0]=d.slice(te,te+Z)}}else u.json=JSON.parse(a2.decode(new Uint8Array(d,o)));const{buffers:m,images:v,meshes:b,extensionsUsed:C,bufferViews:D}=u.json;let I=Promise.resolve();if(m){const R=[];for(let N=0;N<m.length;N++){const j=m[N];j.uri?R.push(R_(j,u,N,l)):u.buffers[N]||(u.buffers[N]=null)}I=Promise.all(R)}return I.then(()=>{const R=[],N=C&&C.includes(s2),j=C&&C.includes(O_);if(N&&R.push(function(){if(!$l)return kp??(kp=function(K){let Z,te=null;function ce(){Z=new Uint8Array(te.buffer)}function ue(){throw new Error("Unexpected Draco error.")}const xe={a:{a:ue,d:function(ve,ie,_e){return Z.copyWithin(ve,ie,ie+_e)},c:function(ve){const ie=Z.length,_e=Math.max(ve>>>0,Math.ceil(1.2*ie)),we=Math.ceil((_e-ie)/65536);try{return te.grow(we),ce(),!0}catch{return!1}},b:ue}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(K,xe):K.then(ve=>ve.arrayBuffer()).then(ve=>WebAssembly.instantiate(ve,xe))).then(ve=>{const{Rb:ie,Qb:_e,P:we,T:Ce,X:ze,Ja:qe,La:Ze,Qa:Xe,Va:pt,Wa:Rt,eb:Mt,jb:Tt,f:Nt,e:ut,yb:Et,zb:lt,Ab:gt,Bb:Bt,Db:q,Gb:gn}=ve.instance.exports;te=ut;const hn=(()=>{let Kt=0,Qe=0,Ft=0,Yt=0;return un=>{Ft&&(ie(Yt),ie(Kt),Qe+=Ft,Ft=Kt=0),Kt||(Qe+=128,Kt=_e(Qe));const Bn=un.length+7&-8;let Kn=Kt;Bn>=Qe&&(Ft=Bn,Kn=Yt=_e(Bn));for(let ri=0;ri<un.length;ri++)Z[Kn+ri]=un[ri];return Kn}})();return ce(),Nt(),{memory:ut,_free:ie,_malloc:_e,Mesh:class{constructor(){this.ptr=we()}destroy(){Ce(this.ptr)}},Decoder:class{constructor(){this.ptr=qe()}destroy(){Tt(this.ptr)}DecodeArrayToMesh(Kt,Qe,Ft){const Yt=hn(Kt),un=Ze(this.ptr,Yt,Qe,Ft.ptr);return!!ze(un)}GetAttributeByUniqueId(Kt,Qe){return{ptr:Xe(this.ptr,Kt.ptr,Qe)}}GetTrianglesUInt16Array(Kt,Qe,Ft){pt(this.ptr,Kt.ptr,Qe,Ft)}GetTrianglesUInt32Array(Kt,Qe,Ft){Rt(this.ptr,Kt.ptr,Qe,Ft)}GetAttributeDataArrayForAllPoints(Kt,Qe,Ft,Yt,un){Mt(this.ptr,Kt.ptr,Qe.ptr,Ft,Yt,un)}},DT_INT8:Et(),DT_UINT8:lt(),DT_INT16:gt(),DT_UINT16:Bt(),DT_UINT32:q(),DT_FLOAT32:gn()}})}(fetch(Ki())),kp.then(K=>{$l=K,kp=void 0}))}()),j&&R.push(function(){if(yw)return;const K=function(Z){let te;const ce=WebAssembly.instantiateStreaming(Z,{}).then(ve=>{te=ve.instance,te.exports.__wasm_call_ctors()}),ue={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},xe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(ve,ie,_e,we,Ce,ze){!function(qe,Ze,Xe,pt,Rt,Mt,Tt){const Nt=qe.exports.sbrk,ut=pt+3&-4,Et=Nt(ut*Rt),lt=Nt(Mt.length),gt=new Uint8Array(qe.exports.memory.buffer);gt.set(Mt,lt);const Bt=Ze(Et,pt,Rt,lt,Mt.length);if(0===Bt&&Tt&&Tt(Et,ut,Rt),Xe.set(gt.subarray(Et,Et+pt*Rt)),Nt(Et-Nt(0)),0!==Bt)throw new Error(`Malformed buffer data: ${Bt}`)}(te,te.exports[xe[Ce]],ve,ie,_e,we,te.exports[ue[ze]])}}}(fetch(v1()));return K.ready.then(()=>{yw=K})}()),v)for(let K=0;K<v.length;K++)R.push(b3(v[K],u,K,l));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(N&&b)for(const{primitives:K}of b)for(const Z of K)y3(Z,u);if(j&&b&&D)for(const K of D)ht(K,u);return u})})}function Mf(d,o){const l=d.json.bufferViews[o.bufferView],u=I_[o.componentType];return new u(d.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==b1[o.type]*u.BYTES_PER_ELEMENT?l.byteStride/u.BYTES_PER_ELEMENT:b1[o.type]))}function d2(d,o,l,u){const m=I_[o.componentType],v=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),b=d.json.bufferViews[o.bufferView],C=b.byteStride?b.byteStride/m.BYTES_PER_ELEMENT:b1[o.type],D=l.float32,I=D.length/l.capacity;for(let R=0,N=0;R<o.count*C;R+=C,N+=I)for(let j=0;j<I;j++)D[N+j]=u[R+j]*v;l._trim()}function x3(d,o,l){const u=d.indices,m=d.attributes,v={};v.indexArray=new Qs;const b=o.json.accessors[u],C=b.count/3;v.indexArray.reserve(C);const D=Mf(o,b);for(let j=0;j<C;j++)v.indexArray.emplaceBack(D[3*j],D[3*j+1],D[3*j+2]);v.indexArray._trim(),v.vertexArray=new al;const I=o.json.accessors[m.POSITION];v.vertexArray.reserve(I.count);const R=Mf(o,I);for(let j=0;j<I.count;j++)v.vertexArray.emplaceBack(R[3*j],R[3*j+1],R[3*j+2]);if(v.vertexArray._trim(),v.aabb=new eo(I.min,I.max),v.centroid=function(j,K){const Z=[0,0,0],te=j.length;if(te>0){for(let ce=0;ce<te;ce++){const ue=3*j[ce];Z[0]+=K[ue],Z[1]+=K[ue+1],Z[2]+=K[ue+2]}Z[0]/=te,Z[1]/=te,Z[2]/=te}return Z}(D,R),void 0!==m.COLOR_0){const j=o.json.accessors[m.COLOR_0],K=b1[j.type],Z=Mf(o,j);v.colorArray=3===K?new al:new gd,v.colorArray.resize(j.count),d2(o,j,v.colorArray,Z)}if(void 0!==m.NORMAL){v.normalArray=new al;const j=o.json.accessors[m.NORMAL];v.normalArray.resize(j.count);const K=Mf(o,j);d2(o,j,v.normalArray,K)}if(void 0!==m.TEXCOORD_0&&l.length>0){v.texcoordArray=new Xc;const j=o.json.accessors[m.TEXCOORD_0];v.texcoordArray.resize(j.count);const K=Mf(o,j);d2(o,j,v.texcoordArray,K)}if(void 0!==m._FEATURE_ID_RGBA4444){const j=o.json.accessors[m._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(v.featureData=Mf(o,j))}void 0!==m._FEATURE_RGBA4444&&(v.featureData=new Uint32Array(Mf(o,o.json.accessors[m._FEATURE_RGBA4444]).buffer));const N=d.material;return v.material=function(j,K){const{emissiveFactor:Z=[0,0,0],alphaMode:te="OPAQUE",alphaCutoff:ce=.5,normalTexture:ue,occlusionTexture:xe,emissiveTexture:ve,doubleSided:ie}=j,{baseColorFactor:_e=[1,1,1,1],metallicFactor:we=1,roughnessFactor:Ce=1,baseColorTexture:ze,metallicRoughnessTexture:qe}=j.pbrMetallicRoughness||{},Ze=xe?K[xe.index]:void 0;if(xe&&xe.extensions&&xe.extensions.KHR_texture_transform&&Ze){const Xe=xe.extensions.KHR_texture_transform;Ze.offsetScale=[Xe.offset[0],Xe.offset[1],Xe.scale[0],Xe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ni(..._e),metallicFactor:we,roughnessFactor:Ce,baseColorTexture:ze?K[ze.index]:void 0,metallicRoughnessTexture:qe?K[qe.index]:void 0},doubleSided:ie,emissiveFactor:Z,alphaMode:te,alphaCutoff:ce,normalTexture:ue?K[ue.index]:void 0,occlusionTexture:Ze,emissionTexture:ve?K[ve.index]:void 0,defined:void 0===j.defined}}(void 0!==N?o.json.materials[N]:{defined:!1},l),v}function bw(d,o,l){const{matrix:u,rotation:m,translation:v,scale:b,mesh:C,extras:D,children:I}=d,R={};if(R.matrix=u||(K=v||[0,0,0],we=(te=(j=m||[0,0,0,1])[0])*(ve=te+te),Ce=te*(ie=(ce=j[1])+ce),ze=te*(_e=(ue=j[2])+ue),Ze=ce*_e,pt=(xe=j[3])*ve,Rt=xe*ie,Mt=xe*_e,Nt=(Z=b||[1,1,1])[1],ut=Z[2],(N=[])[0]=(1-((qe=ce*ie)+(Xe=ue*_e)))*(Tt=Z[0]),N[1]=(Ce+Mt)*Tt,N[2]=(ze-Rt)*Tt,N[3]=0,N[4]=(Ce-Mt)*Nt,N[5]=(1-(we+Xe))*Nt,N[6]=(Ze+pt)*Nt,N[7]=0,N[8]=(ze+Rt)*ut,N[9]=(Ze-pt)*ut,N[10]=(1-(we+qe))*ut,N[11]=0,N[12]=K[0],N[13]=K[1],N[14]=K[2],N[15]=1,N),void 0!==C){R.meshes=l[C];const N=R.anchor=[0,0];for(const j of R.meshes){const{min:K,max:Z}=j.aabb;N[0]+=K[0]+Z[0],N[1]+=K[1]+Z[1]}N[0]=Math.floor(N[0]/R.meshes.length/2),N[1]=Math.floor(N[1]/R.meshes.length/2)}var N,j,K,Z,te,ce,ue,xe,ve,ie,_e,we,Ce,ze,qe,Ze,Xe,pt,Rt,Mt,Tt,Nt,ut;if(D&&(D.id&&(R.id=D.id),D.lights&&(R.lights=function(N){if(!N.length)return[];const j=function(ue){const xe=atob(ue),ve=new Uint8Array(xe.length);for(let ie=0;ie<xe.length;ie++)ve[ie]=xe.codePointAt(ie);return ve}(N),K=[],Z=j.length/24,te=new Uint16Array(j.buffer),ce=new Float32Array(j.buffer);for(let ue=0;ue<Z;ue++){const xe=te[2*ue*6]/30,ve=te[2*ue*6+1]/30,ie=te[2*ue*6+10]/100,_e=ce[6*ue+1],we=ce[6*ue+2],Ce=ce[6*ue+3],ze=ce[6*ue+4],qe=Ce-_e,Ze=ze-we,Xe=Math.hypot(qe,Ze);K.push({pos:[_e+.5*qe,we+.5*Ze,ve],normal:[Ze/Xe,-qe/Xe,0],width:Xe,height:xe,depth:ie,points:[_e,we,Ce,ze]})}return K}(D.lights))),I){const N=[];for(const j of I)N.push(bw(o.json.nodes[j],o,l));R.children=N}return R}function w3(d){if(0===d.vertices.length||0===d.indices.length)return null;const o=new nx(d.vertices,d.indices,8,256),[l,u]=[o.min.clone(),o.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:o,min:l,max:u}}function k3(d){if(!d.extras||!d.extras.ground)return null;const o=d.extras.ground;if(!o||!Array.isArray(o)||0===o.length)return null;const l=o[0];if(!l||!Array.isArray(l)||0===l.length)return null;const u=[];for(const b of l){if(!Array.isArray(b)||2!==b.length)continue;const C=b[0],D=b[1];"number"==typeof C&&"number"==typeof D&&u.push(new Wt(C,D))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let b=0;b<u.length;b++){const C=u[b],D=u[(b+1)%u.length],I=u[(b+2)%u.length];m+=(C.x-D.x)*(I.y-D.y)-(I.x-D.x)*(C.y-D.y)}m>0&&u.reverse();const v=gm(u.flatMap(b=>[b.x,b.y]),[]);return 0===v.length?null:{vertices:u,indices:v}}function h2(d,o){const l=[],u=[];let m=0;const v=[];for(const b of d){m=l.length;const C=b.vertexArray.float32,D=b.indexArray.uint16;for(let I=0;I<b.vertexArray.length;I++)v[0]=C[3*I+0],v[1]=C[3*I+1],v[2]=C[3*I+2],ui(v,v,o),l.push(new Wt(v[0],v[1]));for(let I=0;I<3*b.indexArray.length;I++)u.push(D[I]+m)}if(u.length%3!=0)return null;for(let b=0;b<u.length;b+=3){const C=l[u[b+0]],D=l[u[b+1]],I=l[u[b+2]];(C.x-D.x)*(I.y-D.y)-(I.x-D.x)*(C.y-D.y)>0&&([u[b+1],u[b+2]]=[u[b+2],u[b+1]])}return{vertices:l,indices:u}}function Mp(d){const l=function(D,I){const R=[];for(const N of D.json.meshes){const j=[];for(const K of N.primitives)j.push(x3(K,D,I));R.push(j)}return R}(d,function(D,I){const R=[],N=WebGL2RenderingContext;if(D.json.textures)for(const j of D.json.textures){const K={magFilter:N.LINEAR,minFilter:N.NEAREST,wrapS:N.REPEAT,wrapT:N.REPEAT};void 0!==j.sampler&&Object.assign(K,D.json.samplers[j.sampler]),R.push({image:I[j.source],sampler:K,uploaded:!1})}return R}(d,d.images)),{scenes:u,scene:m,nodes:v}=d.json,b=u?u[m||0].nodes:v,C=[];for(const D of b)C.push(bw(v[D],d,l));return function(D,I,R){const N={},j=new Set;for(let K=0;K<D.length;K++){const Z=R[I[K]];if(!Z.extras)continue;const te=Z.extras["mapbox:footprint:version"],ce=Z.extras["mapbox:footprint:id"];(te||ce)&&j.add(K),"1.0.0"===te&&ce&&(N[ce]=K)}for(let K=0;K<D.length;K++){if(j.has(K))continue;const Z=D[K],te=R[I[K]];if(!te.extras)continue;let ce=null;Z.id in N&&(ce=h2(D[N[Z.id]].meshes,Z.matrix)),ce||(ce=k3(te)),ce&&(Z.footprint=w3(ce))}if(j.size>0){const K=Array.from(j.values()).sort((Z,te)=>Z-te);for(let Z=K.length-1;Z>=0;Z--)D.splice(K[Z],1)}}(C,b,d.json.nodes),C}function aD(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const o=d.vertexArray.float32,l=d.aabb.min[0]-1,u=d.aabb.min[1]-1,m=64/(d.aabb.max[0]-l+2),v=64/(d.aabb.max[1]-u+2);for(let b=0;b<o.length;b+=3){const C=o[b+2],D=(o[b+0]-l)*m|0,I=(o[b+1]-u)*v|0;C>d.heightmap[64*I+D]&&(d.heightmap[64*I+D]=C)}}function lD(d,o){const l={};l.indexArray=new Qs,l.indexArray.reserve(4*d.length),l.vertexArray=new al,l.vertexArray.reserve(10*d.length),l.colorArray=new gd,l.vertexArray.reserve(10*d.length);let u=0;for(const b of d){const C=Math.min(10,Math.max(4,1.3*b.height))*o,D=[-b.normal[1],b.normal[0],0],I=Math.min(.29,.1*b.width/b.depth),R=b.width-2*b.depth*o*(I+.01),N=yi([],b.pos,D,R/2),j=yi([],b.pos,D,-R/2),K=[N[0],N[1],N[2]+b.height],Z=[j[0],j[1],j[2]+b.height],te=yi([],b.normal,D,I);Jn(te,te,C);const ce=yi([],b.normal,D,-I);Jn(ce,ce,C),Cr(te,N,te),Cr(ce,j,ce),N[2]+=.1,j[2]+=.1,l.vertexArray.emplaceBack(te[0],te[1],te[2]),l.vertexArray.emplaceBack(ce[0],ce[1],ce[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(j[0],j[1],j[2]),l.vertexArray.emplaceBack(K[0],K[1],K[2]),l.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(j[0],j[1],j[2]),l.vertexArray.emplaceBack(te[0],te[1],te[2]),l.vertexArray.emplaceBack(ce[0],ce[1],ce[2]);const ue=R/C/2;l.colorArray.emplaceBack(-ue-I,-1,ue,.8),l.colorArray.emplaceBack(ue+I,-1,ue,.8),l.colorArray.emplaceBack(-ue,0,ue,1.3),l.colorArray.emplaceBack(ue,0,ue,1.3),l.colorArray.emplaceBack(ue+I,-.8,ue,.7),l.colorArray.emplaceBack(ue+I,-.8,ue,.7),l.colorArray.emplaceBack(0,0,ue,1.3),l.colorArray.emplaceBack(0,0,ue,1.3),l.colorArray.emplaceBack(ue+I,-1.2,ue,.8),l.colorArray.emplaceBack(ue+I,-1.2,ue,.8),l.indexArray.emplaceBack(6+u,4+u,8+u),l.indexArray.emplaceBack(7+u,9+u,5+u),l.indexArray.emplaceBack(0+u,1+u,2+u),l.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0,emissiveFactor:[0,0,0]},v={};return v.baseColorFactor=Ni.white,m.pbrMetallicRoughness=v,l.material=m,l.aabb=new eo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class u2{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const Hm=["id","tile","layer","source","sourceLayer","state"];class Cf{constructor(o,l,u,m,v){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=m,this.properties=o.properties,this.id=v}clone(){const o=new Cf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of Hm)void 0!==this[l]&&(o[l]=this[l]);return o}}class M3{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new jp(Xt,16,0),this.featureIndexArray=new A0,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,l,u,m,v,b=0,C=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,v,b);const I=this.grid;for(let R=0;R<l.length;R++){const N=l[R],j=[1/0,1/0,-1/0,-1/0];for(let K=0;K<N.length;K++){const Z=N[K];j[0]=Math.min(j[0],Z.x),j[1]=Math.min(j[1],Z.y),j[2]=Math.max(j[2],Z.x),j[3]=Math.max(j[3],Z.y)}0!==C&&(j[0]-=C,j[1]-=C,j[2]+=C,j[3]+=C),j[0]<Xt&&j[1]<Xt&&j[2]>=0&&j[3]>=0&&I.insert(D,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fp.VectorTile(new ff(this.rawTileData)).layers,this.sourceLayerCoder=new u2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l){const{tilespaceGeometry:u,transform:m,tileTransform:v,pixelPosMatrix:b,availableImages:C}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const D=u.bufferedTilespaceBounds,I=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(K,Z,te,ce)=>oo(u.bufferedTilespaceGeometry,K,Z,te,ce));I.sort(X6);let R=null;m.elevation&&I.length>0&&(R=wp.create(m.elevation,this.tileID));const N={};let j;for(let K=0;K<I.length;K++){const Z=I[K];if(Z===j)continue;j=Z;const te=this.featureIndexArray.get(Z);let ce=null;this.is3DTile?this.loadMatchingModelFeature(N,te,o,u,m):this.loadMatchingFeature(N,te,o,C,(ue,xe,ve,ie=0)=>(ce||(ce=fn(ue,this.tileID.canonical,v)),xe.queryIntersectsFeature(u,ue,ve,ce,this.z,m,b,R,ie)))}return N}loadMatchingFeature(o,l,u,m,v){const{featureIndex:b,bucketIndex:C,sourceLayerIndex:D,layoutVertexArrayOffset:I}=l,R=this.bucketLayerIDs[C],N=u.layers,j=Object.keys(N);if(j.length&&!function(ue,xe){for(let ve=0;ve<ue.length;ve++)if(xe.indexOf(ue[ve])>=0)return!0;return!1}(j,R))return;const K=u.sourceCache,Z=this.sourceLayerCoder.decode(D),te=this.vtLayers[Z].feature(b),ce=this.getId(te,Z);for(let ue=0;ue<R.length;ue++){const xe=R[ue];if(!N[xe])continue;const{styleLayer:ve,targets:ie}=N[xe];let _e={};void 0!==ce&&(_e=K.getFeatureState(ve.sourceLayer,ce));const we=!v||v(te,ve,_e,I);if(!we)continue;const Ce=new Cf(te,this.z,this.x,this.y,ce);Ce.tile=this.tileID.canonical,Ce.state=_e;let ze=this.serializedLayersCache.get(xe);ze||(ze=ve.serialize(),ze.id=xe,this.serializedLayersCache.set(xe,ze)),Ce.source=ze.source,Ce.sourceLayer=ze["source-layer"],Ce.layer=tt({},ze),Ce.layer.paint=p2(ze.paint,ve.paint,te,_e,m),Ce.layer.layout=p2(ze.layout,ve.layout,te,_e,m);let qe=!1;for(const Ze of ie){this.updateFeatureProperties(Ce,Ze);const{filter:Xe}=Ze;if(Xe)if(te.properties=Ce.properties,Xe.needGeometry){const pt=bn(te,!0);if(!Xe.filter(new dr(this.tileID.overscaledZ),pt,this.tileID.canonical))continue}else if(!Xe.filter(new dr(this.tileID.overscaledZ),te))continue;qe=!0,Ze.targetId&&this.addFeatureVariant(Ce,Ze)}qe&&this.appendToResult(o,xe,b,Ce,we)}}loadMatchingModelFeature(o,l,u,m,v){const b=this.bucketLayerIDs[0][0],C=u.layers;if(!C[b])return;const{styleLayer:D,targets:I}=C[b];if("model"!==D.type)return;const R=m.tile,N=l.featureIndex,j=R.getBucket(D);if(!(j&&j instanceof y_))return;const K=function(ze,qe,Ze,Xe){const pt=ze.getNodesInfo()[qe];if(pt.hiddenByReplacement||!pt.node.meshes)return;let Rt=Number.MAX_VALUE;const Mt=pt.node,Tt=Ze.tile,Nt=Xe.calculatePosMatrix(Tt.tileID.toUnwrapped(),Xe.worldSize),ut=pt.evaluatedScale;let Et=0;Xe.elevation&&Mt.elevation&&(Et=Mt.elevation*Xe.elevation.exaggeration()),ho(Nt,Nt,[(Mt.anchor?Mt.anchor[0]:0)*(ut[0]-1),(Mt.anchor?Mt.anchor[1]:0)*(ut[1]-1),Et]),No(Nt,Nt,ut);const lt=Ze.queryGeometry,gt=lt.isPointQuery()?lt.screenBounds:lt.screenGeometry,Bt=function(gn){const hn=Rr([],Nt,gn.matrix);Rr(hn,Xe.expandedFarZProjMatrix,hn);for(let Kt=0;Kt<gn.meshes.length;++Kt){const Qe=gn.meshes[Kt];if(Kt===gn.lightMeshIndex)continue;const Ft=GC(gt,Xe,hn,Qe.aabb);null!=Ft&&(Rt=Math.min(Ft,Rt))}if(gn.children)for(const Kt of gn.children)Bt(Kt)};if(Bt(Mt),Rt===Number.MAX_VALUE)return;const q=new le(0,0);return Qx(Tt.tileID.canonical,q,pt.node.anchor[0],pt.node.anchor[1]),{intersectionZ:Rt,position:q,feature:pt.feature}}(j,N,m,v);if(!K)return;const{z:Z,x:te,y:ce}=R.tileID.canonical,{feature:ue,intersectionZ:xe,position:ve}=K;let ie={};void 0!==ue.id&&(ie=u.sourceCache.getFeatureState(D.sourceLayer,ue.id));const _e=new Cf({},Z,te,ce,ue.id);_e.tile=this.tileID.canonical,_e.state=ie,_e.properties=ue.properties,_e.geometry={type:"Point",coordinates:[ve.lng,ve.lat]};let we=this.serializedLayersCache.get(b);we||(we=D.serialize(),we.id=b,this.serializedLayersCache.set(b,we)),_e.source=we.source,_e.sourceLayer=we["source-layer"],_e.layer=tt({},we);let Ce=!1;for(const ze of I){this.updateFeatureProperties(_e,ze);const{filter:qe}=ze;if(qe)if(ue.properties=_e.properties,qe.needGeometry){if(!qe.filter(new dr(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!qe.filter(new dr(this.tileID.overscaledZ),ue))continue;Ce=!0,ze.targetId&&this.addFeatureVariant(_e,ze)}Ce&&this.appendToResult(o,b,N,_e,xe)}updateFeatureProperties(o,l,u){if(l.properties){const m={};for(const v in l.properties){const b=l.properties[v].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,u);null!=b&&(m[v]=b)}o.properties=m}}addFeatureVariant(o,l,u){const m={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(m.properties=o.properties),o.variants=o.variants||{},o.variants[l.targetId]=o.variants[l.targetId]||[],o.variants[l.targetId].push(m)}appendToResult(o,l,u,m,v){let b=o[l];void 0===b&&(b=o[l]=[]),b.push({featureIndex:u,feature:m,intersectionZ:v})}lookupSymbolFeatures(o,l,u,m,v){const b={};this.loadVTLayers();for(const C of o)this.loadMatchingFeature(b,{bucketIndex:l,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},m,v);return b}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),v=this.vtFeatures[m];if(v[l])return v[l];const b=this.vtLayers[m].feature(l);return v[l]=b,b}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[l];if(null!=m)if(Array.isArray(m)){if(!this.promoteIdExpression){const v=Qu(m);if("success"!==v.result)return void ci(`Failed to create expression for promoteId: ${v.value.map(C=>`${C.key}: ${C.message}`).join(", ")}`);this.promoteIdExpression=v.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new dd),u=this.promoteIdExpression.evaluate({zoom:0},o)}else u=o.properties[m];"boolean"==typeof u&&(u=Number(u))}return u}}function p2(d,o,l,u,m){return Wn(d,(v,b)=>{const C=o instanceof ip?o.get(b):null;return C&&C.evaluate?C.evaluate(l,u,void 0,m):C})}function X6(d,o){return o-d}ln(M3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const cD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xw{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const v=cD[15&u];if(!v)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[C]=new Uint32Array(o,4,1);return new xw(C,b,v,o)}constructor(o,l=64,u=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const v=cD.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,C=o*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-C%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+D,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+C+D),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+D,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=l,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return ww(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:C}=this,D=[0,v.length-1,0],I=[];for(;D.length;){const R=D.pop()||0,N=D.pop()||0,j=D.pop()||0;if(N-j<=C){for(let ce=j;ce<=N;ce++){const ue=b[2*ce],xe=b[2*ce+1];ue>=o&&ue<=u&&xe>=l&&xe<=m&&I.push(v[ce])}continue}const K=j+N>>1,Z=b[2*K],te=b[2*K+1];Z>=o&&Z<=u&&te>=l&&te<=m&&I.push(v[K]),(0===R?o<=Z:l<=te)&&(D.push(j),D.push(K-1),D.push(1-R)),(0===R?u>=Z:m>=te)&&(D.push(K+1),D.push(N),D.push(1-R))}return I}within(o,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:b}=this,C=[0,m.length-1,0],D=[],I=u*u;for(;C.length;){const R=C.pop()||0,N=C.pop()||0,j=C.pop()||0;if(N-j<=b){for(let ce=j;ce<=N;ce++)Mw(v[2*ce],v[2*ce+1],o,l)<=I&&D.push(m[ce]);continue}const K=j+N>>1,Z=v[2*K],te=v[2*K+1];Mw(Z,te,o,l)<=I&&D.push(m[K]),(0===R?o-u<=Z:l-u<=te)&&(C.push(j),C.push(K-1),C.push(1-R)),(0===R?o+u>=Z:l+u>=te)&&(C.push(K+1),C.push(N),C.push(1-R))}return D}}function ww(d,o,l,u,m,v){if(m-u<=l)return;const b=u+m>>1;kw(d,o,b,u,m,v),ww(d,o,l,u,b-1,1-v),ww(d,o,l,b+1,m,1-v)}function kw(d,o,l,u,m,v){for(;m>u;){if(m-u>600){const I=m-u+1,R=l-u+1,N=Math.log(I),j=.5*Math.exp(2*N/3),K=.5*Math.sqrt(N*j*(I-j)/I)*(R-I/2<0?-1:1);kw(d,o,l,Math.max(u,Math.floor(l-R*j/I+K)),Math.min(m,Math.floor(l+(I-R)*j/I+K)),v)}const b=o[2*l+v];let C=u,D=m;for(L_(d,o,u,l),o[2*m+v]>b&&L_(d,o,u,m);C<D;){for(L_(d,o,C,D),C++,D--;o[2*C+v]<b;)C++;for(;o[2*D+v]>b;)D--}o[2*u+v]===b?L_(d,o,u,D):(D++,L_(d,o,D,m)),D<=l&&(u=D+1),l<=D&&(m=D-1)}}function L_(d,o,l,u){Ga(d,l,u),Ga(o,2*l,2*u),Ga(o,2*l+1,2*u+1)}function Ga(d,o,l){const u=d[o];d[o]=d[l],d[l]=u}function Mw(d,o,l,u){const m=d-l,v=o-u;return m*m+v*v}p.$=ds,p.A=Fl,p.B=Nl,p.C=cn,p.D=g1,p.E=Sa,p.F=2,p.G=r_,p.H=Sx,p.I=Xo,p.J=class extends Dm{},p.K=Ln,p.L=Ea,p.M=md,p.N=Wf,p.O=Gf,p.P=Wt,p.Q=Sg,p.R=Ui,p.S=Lh,p.T=zv,p.U=Jf,p.V=Dm,p.W=Tg,p.X=Qu,p.Y=on,p.Z=J,p._=yt,p.a=function(d){return cs.API_CDN_URL_REGEX.test(d)},p.a$=jt,p.a0=Ii,p.a1=Lg,p.a2=Np,p.a3=h0,p.a4=function(d){const o=d.value;let l=[];if(!o)return l;const u=Ln(o);return"string"!==u?(l=l.concat([new Dm(d.key,o,`string expected, "${u}" found`)]),l):(f_(o,!0)||(l=l.concat([new Dm(d.key,o,`invalid url "${o}"`)])),l)},p.a5=it,p.a6=Ay,p.a7=jo,p.a8=Ut,p.a9=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return Si(d.expression.evaluate(o))}interpolate(d,o,l){return{x:Cn(d.x,o.x,l),y:Cn(d.y,o.y,l),z:Cn(d.z,o.z,l),azimuthal:Cn(d.azimuthal,o.azimuthal,l),polar:Cn(d.polar,o.polar,l)}}},p.aA=_o,p.aB=wr,p.aC=xt,p.aD=Ge,p.aE=M,p.aF=function(d,o){const l={};for(let u=0;u<o.length;u++){const m=o[u];m in d&&(l[m]=d[m])}return l},p.aG=be,p.aH=Oe,p.aI=class{constructor(d){this.entries={},this.scheduler=d}request(d,o,l,u){const m=this.entries[d]=this.entries[d]||{callbacks:[]};if(m.result){const[v,b]=m.result;return this.scheduler?this.scheduler.add(()=>{u(v,b)},o):u(v,b),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=l((v,b)=>{m.result=[v,b];for(const C of m.callbacks)this.scheduler?this.scheduler.add(()=>{C(v,b)},o):C(v,b);setTimeout(()=>delete this.entries[d],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(v=>v!==u),m.callbacks.length||(m.cancel(),delete this.entries[d]))}}},p.aJ=function(d,o,l){const u=JSON.stringify(d.request);return d.data&&(this.deduped.entries[u]={result:[null,d.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},m=>{const v=Ld(d.request,(b,C,D,I)=>{b?m(b):C&&m(null,{vectorTile:l?void 0:new fp.VectorTile(new ff(C)),rawData:C,cacheControl:D,expires:I})});return()=>{v.cancel(),m()}},o)},p.aK=function(d){Tr++,Tr>uo&&(d.getActor().send("enforceCacheSizeLimit",na),Tr=0)},p.aL=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log(d)/Math.LN2))},p.aM=ps,p.aN=NC,p.aO=jv,p.aP=Bx,p.aQ=function(d,o){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<d.length;u++){const m=document.createElement("source");Ah(d[u])||(l.crossOrigin="Anonymous"),m.src=d[u],l.appendChild(m)}return{cancel:()=>{}}},p.aR=Nv,p.aS=function(d){return fetch(d).then(o=>o.arrayBuffer()).then(o=>vw(o,0,d))},p.aT=Mp,p.aU=class{constructor(d,o,l,u){this.id=d,this.position=null!=o?new le(o[0],o[1]):new le(0,0),this.orientation=l??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new eo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(d,o){if(Rr(d.matrix,o,d.matrix),d.meshes)for(const l of d.meshes){const u=eo.applyTransformFast(l.aabb,d.matrix);this.aabb.encapsulate(u)}if(d.children)for(const l of d.children)this._applyTransformations(l,d.matrix)}computeBoundsAndApplyParent(){const d=Gn([]);for(const o of this.nodes)this._applyTransformations(o,d)}computeModelMatrix(d,o,l,u,m,v,b=!1){YC(this.matrix,this,d.transform,this.position,o,l,u,m,v,b)}upload(d){if(!this.uploaded){for(const o of this.nodes)Yx(o,d);for(const o of this.nodes)g_(o);this.uploaded=!0}}destroy(){for(const d of this.nodes)Xx(d)}},p.aV=Nn,p.aW=a_,p.aX=Be,p.aY=Ve,p.aZ=$p,p.a_=Qs,p.aa=dr,p.ab=Zf,p.ac=ot,p.ad=ui,p.ae=gr,p.af=Ne,p.ag=ip,p.ah=Uh,p.ai=Cn,p.aj=Xt,p.ak=qu,p.al=ae,p.am=Ni,p.an=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return function([l,u]){const m=Si([1,l,u]);return{x:m.x,y:m.y,z:m.z}}(d.expression.evaluate(o))}interpolate(d,o,l){return{x:Cn(d.x,o.x,l),y:Cn(d.y,o.y,l),z:Cn(d.z,o.z,l)}}},p.ao=function(d,o,l=0,u=!0){const m=new Wt(l,l),v=d.sub(m),b=o.add(m),C=[v,new Wt(b.x,v.y),b,new Wt(v.x,b.y)];return u&&C.push(v.clone()),C},p.ap=function(d,o){const l=[];for(let u=0;u<d.length;u++){const m=at(u-1,-1,d.length-1),v=at(u+1,-1,d.length-1),b=d[u],C=d[v],D=d[m].sub(b).unit(),I=C.sub(b).unit(),R=I.angleWithSep(D.x,D.y),N=D.add(I).unit().mult(-1*o/Math.sin(R/2));l.push(b.add(N))}return l},p.aq=AC,p.ar=oo,p.as=function(d,o,l=0){return Qn(((o.x-l)*d.scale-d.x)*Xt,(o.y*d.scale-d.y)*Xt,ct(o.z,o.y))},p.at=Vr,p.au=Sn,p.av=bd,p.aw=_x,p.ax=function(d){let o=1/0,l=1/0,u=-1/0,m=-1/0;for(const v of d)o=Math.min(o,v.x),l=Math.min(l,v.y),u=Math.max(u,v.x),m=Math.max(m,v.y);return{min:new Wt(o,l),max:new Wt(u,m)}},p.ay=Ie,p.az=Rr,p.b=function(d){return cs.API_FONTS_REGEX.test(d)},p.b$=Jn,p.b0=ap,p.b1=Iv,p.b2=function(){Yr.isLoading()||Yr.isLoaded()||"deferred"!==tp()||v0()},p.b3=Yi,p.b4=bn,p.b5=Cf,p.b6=Do,p.b7=pf,p.b8=Qy,p.b9=fn,p.bA=function(d,o){const{x:l,y:u}=d.point,m=L0(l,u,d.worldSize/d._pixelsPerMercatorPixel,0,0);return Rr(m,m,rf(hp(o)))},p.bB=Xl,p.bC=function(d){return d[0]=0,d[1]=0,d[2]=0,d},p.bD=function(d,o){return Math.hypot(o[0]-d[0],o[1]-d[1],o[2]-d[2])},p.bE=ei,p.bF=yi,p.bG=si,p.bH=_p,p.bI=Dc,p.bJ=Mx,p.bK=function(d,o,l,u,m){const v=5*o+2;d.float32[v+0]=l,d.float32[v+1]=u,d.float32[v+2]=m},p.bL=ne,p.bM=K0,p.bN=Dn,p.bO=xs,p.bP=qM,p.bQ=qx,p.bR=ox,p.bS=sx,p.bT=Dv,p.bU=Mr,p.bV=wx,p.bW=xw,p.bX=at,p.bY=uc,p.bZ=function(d,o,l){l*=.5;var u=o[0],m=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return d[0]=u*D+m*C,d[1]=m*D-u*C,d[2]=v*D+b*C,d[3]=b*D-v*C,d},p.b_=Ol,p.ba=Gd,p.bb=Ao,p.bc=fh,p.bd=ro,p.be=gm,p.bf=Fx,p.bg=function(d,o){const l=Uh(o.zoom);if(0===l)return hp(d);const u=Fy(d),m=$g(u),v=Ie(u.getWest())*o.worldSize,b=Ie(u.getEast())*o.worldSize,C=Oe(u.getNorth())*o.worldSize,D=Oe(u.getSouth())*o.worldSize,I=[v,C,0],R=[b,C,0],N=[v,D,0],j=[b,D,0],K=mr([],o.globeMatrix);return ui(I,I,K),ui(R,R,K),ui(N,N,K),ui(j,j,K),m[0]=tf(m[0],N,l),m[1]=tf(m[1],j,l),m[2]=tf(m[2],R,l),m[3]=tf(m[3],I,l),eo.fromPoints(m)},p.bh=R0,p.bi=mr,p.bj=nf,p.bk=tf,p.bl=zg,p.bm=vd,p.bn=xa,p.bo=ho,p.bp=o2,p.bq=ff,p.br=Ld,p.bs=function(d,o){const l=[];for(const u in d)u in o||l.push(u);return l},p.bt=bt,p.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.bv=jc,p.bw=function(d){var o=new oi(16);return o[0]=d[0],o[1]=d[1],o[2]=d[2],o[3]=d[3],o[4]=d[4],o[5]=d[5],o[6]=d[6],o[7]=d[7],o[8]=d[8],o[9]=d[9],o[10]=d[10],o[11]=d[11],o[12]=d[12],o[13]=d[13],o[14]=d[14],o[15]=d[15],o},p.bx=Gn,p.by=Pl,p.bz=Fc,p.c=yo,p.c$=function(d){return d({pluginStatus:ic,pluginURL:gu}),Zc.on("pluginStateChange",d),d},p.c0=Id,p.c1=Qo,p.c2=function(d,o){return d[0]=-o[0],d[1]=-o[1],d[2]=-o[2],d[3]=o[3],d},p.c3=Xa,p.c4=function(d,o,l,u,m){var v,b=1/Math.tan(o/2);return d[0]=b/l,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,null!=m&&m!==1/0?(d[10]=(m+u)*(v=1/(u-m)),d[14]=2*m*u*v):(d[10]=-1,d[14]=-2*u),d},p.c5=function(d,o,l,u,m,v,b){var C=1/(o-l),D=1/(u-m),I=1/(v-b);return d[0]=-2*C,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*D,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*I,d[11]=0,d[12]=(o+l)*C,d[13]=(m+u)*D,d[14]=(b+v)*I,d[15]=1,d},p.c6=Te,p.c7=function(d,o,l){d[4*o+0]=l[0],d[4*o+1]=l[1],d[4*o+2]=l[2],d[4*o+3]=l[3]},p.c8=hm,p.c9=hh,p.cA=p_,p.cB=zc,p.cC=UC,p.cD=function(d){const o=UC(d,!0);return Xl([],[o[0],o[1],o[4],o[5]])},p.cE=No,p.cF=ef,p.cG=Uo,p.cH=function(d){const{x:o,y:l}=d.point,{lng:u,lat:m}=d._center;return L0(o,l,d.worldSize,u,m)},p.cI=no,p.cJ=ge,p.cK=Ra,p.cL=S,p.cM=function(d,o,l){let u=0;for(let m=0;m<2;++m)d[m]>0&&(u+=(d[m]-0)*(d[m]-0)),o[m]<0&&(u+=(0-o[m])*(0-o[m]));return u},p.cN=45,p.cO=el,p.cP=Le,p.cQ=dm,p.cR=function(d,o,l){const u=Math.sqrt(d*d+o*o+l*l),m=u>0?Math.acos(l/u)*mt:0;let v=0!==d||0!==o?Math.atan2(-o,-d)*mt+90:0;return v<0&&(v+=360),[u,v,m]},p.cS=Qn,p.cT=Je,p.cU=Cr,p.cV=eo,p.cW=Si,p.cX=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},p.cY=gs,p.cZ=f_,p.c_=function(d,o){return d.readFields(Wv,{icons:[]},o)},p.ca=Qp,p.cb=Wo,p.cc=Kp,p.cd=le,p.ce=Rx,p.cf=function(){var d=new oi(4);return oi!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},p.cg=function(d,o,l){var u=o[0],m=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return d[0]=u*D+v*C,d[1]=m*D+b*C,d[2]=u*-C+v*D,d[3]=m*-C+b*D,d},p.ch=function(d,o){return d[0]===o[0]&&d[1]===o[1]&&d[2]===o[2]&&d[3]===o[3]},p.ci=As,p.cj=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},p.ck=fl,p.cl=zi,p.cm=Oa,p.cn=mm,p.co=qC,p.cp=kr,p.cq=XS,p.cr=function(d,o,l,u,m,v,b,C,D){if("globe"===D.name)return XS(d,o,new kr(l,u,m),!1);const I=a_({z:l,x:u,y:m},D);return new eo([(v+I.x/I.scale)*o,o*(I.y/I.scale),b],[(v+I.x2/I.scale)*o,o*(I.y2/I.scale),C])},p.cs=function(d,o,l){return d[0]=Math.min(o[0],l[0]),d[1]=Math.min(o[1],l[1]),d[2]=Math.min(o[2],l[2]),d[3]=Math.min(o[3],l[3]),d},p.ct=function(d,o,l){return d[0]=Math.max(o[0],l[0]),d[1]=Math.max(o[1],l[1]),d[2]=Math.max(o[2],l[2]),d[3]=Math.max(o[3],l[3]),d},p.cu=function(d){const o=Math.round((d+45+360)%360/90)%4;return Ae[o]},p.cv=Ye,p.cw=Gs,p.cx=P,p.cy=function(d){const o=Gn(new Float64Array(16));Rr(o,d.pixelMatrix,d.globeMatrix);const l=[0,X,0],u=[0,G,0];return ui(l,l,o),ui(u,u,o),[l[0]>0&&l[0]<=d.width&&l[1]>0&&l[1]<=d.height&&!zb(d,new le(d.center.lat,90)),u[0]>0&&u[0]<=d.width&&u[1]>0&&u[1]<=d.height&&!zb(d,new le(d.center.lat,-90))]},p.cz=function(d,o){const{scale:l}=d.tileTransform,u=l*Xt/(d.tileSize*Math.pow(2,o.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return m=new Float32Array(4),C=(v=o.inverseAdjustmentMatrix)[1],D=v[2],I=v[3],N=(b=[u,u])[1],m[0]=v[0]*(R=b[0]),m[1]=C*R,m[2]=D*N,m[3]=I*N,m;var m,v,b,C,D,I,R,N},p.d=function(d){return cs.API_TILEJSON_REGEX.test(d)},p.d$=E0,p.d0=$v,p.d1=Mm,p.d2=Mv,p.d3=vi,p.d4=Nh,p.d5=Rs,p.d6=Ca,p.d7=pi,p.d8=function(d){const o=d.indexOf("\x1f");return o>=0?d.slice(0,o):d},p.d9=function(d){return d.indexOf("\x1f")>=0},p.dA=Fb,p.dB=Ps,p.dC=ys,p.dD=256,p.dE=function(d,o){const l=[0,0,0];return ui(l,l,R0(hp(o.canonical))),ui(l,l,d),l},p.dF=d=>({u_camera_to_center_distance:new Wo(d),u_extrude_scale:new Kc(d),u_device_pixel_ratio:new Wo(d),u_matrix:new hm(d),u_inv_rot_matrix:new hm(d),u_merc_center:new hh(d),u_tile_id:new Qp(d),u_zoom_transition:new Wo(d),u_up_dir:new Qp(d),u_emissive_strength:new Wo(d)}),p.dG=d=>({u_matrix:new hm(d),u_pixels_to_tile_units:new Kc(d),u_device_pixel_ratio:new Wo(d),u_width_scale:new Wo(d),u_floor_width_scale:new Wo(d),u_units_to_pixels:new hh(d),u_dash_image:new Kp(d),u_gradient_image:new Kp(d),u_image_height:new Wo(d),u_texsize:new hh(d),u_tile_units_to_pixels:new Wo(d),u_alpha_discard_threshold:new Wo(d),u_trim_offset:new hh(d),u_trim_fade_range:new hh(d),u_trim_color:new dm(d),u_emissive_strength:new Wo(d),u_zbias_factor:new Wo(d),u_tile_to_meter:new Wo(d),u_ground_shadow_factor:new Qp(d)}),p.dH=d=>({u_matrix:new hm(d),u_texsize:new hh(d),u_pixels_to_tile_units:new Kc(d),u_device_pixel_ratio:new Wo(d),u_width_scale:new Wo(d),u_floor_width_scale:new Wo(d),u_image:new Kp(d),u_units_to_pixels:new hh(d),u_tile_units_to_pixels:new Wo(d),u_alpha_discard_threshold:new Wo(d),u_trim_offset:new hh(d),u_trim_fade_range:new hh(d),u_trim_color:new dm(d),u_emissive_strength:new Wo(d),u_zbias_factor:new Wo(d),u_tile_to_meter:new Wo(d),u_ground_shadow_factor:new Qp(d),u_pattern_transition:new Wo(d)}),p.dI=sp,p.dJ=vx,p.dK=DM,p.dL=(d,o,l,u,m,v)=>{const b=d.transform,C="globe"===b.projection.name;let D;if("map"===v.paint.get("circle-pitch-alignment"))if(C){const R=Fb(b.zoom,o.canonical)*b._pixelsPerMercatorPixel;D=Float32Array.from([R,0,0,R])}else D=b.calculatePixelsToTileUnitsMatrix(l);else D=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(b.projection),u_matrix:d.translatePosMatrix(o.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Un.devicePixelRatio,u_extrude_scale:D,u_inv_rot_matrix:Nb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:v.paint.get("circle-emissive-strength")};if(C){I.u_inv_rot_matrix=u,I.u_merc_center=m,I.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],I.u_zoom_transition=Uh(b.zoom);const R=m[0]*Xt,N=m[1]*Xt;I.u_up_dir=b.projection.upVector(new kr(0,0,0),R,N)}return I},p.dM=cC,p.dN=ja,p.dO=(d,o,l,u,m,v,b,C,D,I)=>{const R=d.transform,N=R.pitch<15?vm(.07,.7,Ge((14-R.zoom)/5,0,1)):.07,j="none"===l.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:lC(d,o,l,u),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:m,u_width_scale:v,u_floor_width_scale:b,u_image:0,u_tile_units_to_pixels:aC(o,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(j?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:Je(o.tileID.canonical,0),u_ground_shadow_factor:D,u_pattern_transition:I}},p.dP=(d,o,l,u,m,v,b,C,D,I)=>{const R=d.transform,N=R.calculatePixelsToTileUnitsMatrix(o),j="none"===l.paint.get("line-trim-color-use-theme").constantOr("default"),K=R.pitch<15?vm(.07,.7,Ge((14-R.zoom)/5,0,1)):.07;return{u_matrix:lC(d,o,l,u),u_pixels_to_tile_units:N,u_device_pixel_ratio:v,u_width_scale:b,u_floor_width_scale:C,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:hv(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:aC(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:D,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(j?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:K,u_tile_to_meter:Je(o.tileID.canonical,0),u_ground_shadow_factor:I}},p.dQ=pn,p.dR=Wg,p.dS=ct,p.dT=vE,p.dU=Wd,p.dV=rv,p.dW=gp,p.dX=450,p.dY=7,p.dZ=zC,p.d_=Ei,p.da=function(d){const o=d.lastIndexOf("\x1f");return o>=0?d.slice(o+1):""},p.db=function(d){const o=[],l=d.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===d.render&&o.push({message:`layers.${l}: missing required method "render"`}),d.renderingMode&&"2d"!==d.renderingMode&&"3d"!==d.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.dc=function(d,o,l,u){return"custom"===d.type?new HC(d,o):new b_[d.type](d,o,l,u)},p.dd=ii,p.de=function(d){const o=d.indexOf("\x1f");return o>=0?d.slice(o+1):""},p.df=class extends Cf{constructor(d,o){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},p.dg=Zc,p.dh=po,p.di=Ry,p.dj=class extends Sc{constructor(d){super(d),this.current=um}set(d,o,l){if(this.fetchUniformLocation(d,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.dk=je,p.dl=function(d,o,l){const u=Uh(l.zoom),m=d.style.map._antialias,v=d.terrain&&d.terrain.exaggeration()>0;return 0===u&&!m&&!v},p.dm=function(d){const o=d.pixelsPerMeter,l=o/Te(1,d.center.lat),u=Gn(new Float64Array(16));return ho(u,u,[d.point.x,d.point.y,0]),No(u,u,[l,l,o]),Float32Array.from(u)},p.dn=Fy,p.dp=function(d){const o=Ye-5;d=Ge(d,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(ae(d))),3);return Math.round(l*(U.length-1))},p.dq=function(d,o,l,u){const m=o.getNorth(),v=o.getSouth(),b=o.getWest(),C=o.getEast(),D=1<<d.z,I=C-b,R=m-v,N=I/V,j=-R/U[l],K=[0,N,0,j,0,0,m,b,0];if(d.z>0){const Z=180/u;zt(K,K,[Z/I+1,0,0,0,Z/R+1,0,-.5*Z/N,.5*Z/j,1])}return K[2]=D,K[5]=d.x,K[8]=d.y,K},p.dr=hp,p.ds=function(d,o,l){const u=Gn(new Float64Array(16)),m=(o/(1<<d)-.5)*Math.PI*2;return Ya(u,l.globeMatrix,m),Float32Array.from(u)},p.dt=class{isDataAvailableAtPoint(d){const o=this._source();if(this.isUsingMockSource()||!o||d.y<0||d.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,m=Math.floor(d.x),v=Math.floor((d.x-m)*u),b=Math.floor(d.y*u),C=this.findDEMTileFor(new ps(l,m,l,v,b));return!(!C||!C.dem)}getAtPointOrZero(d,o=0){return this.getAtPoint(d,o)||0}getAtPoint(d,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||d.y<0||d.y>1)return o;const m=u.getSource().maxzoom,v=1<<m,b=Math.floor(d.x),C=d.x-b,D=new ps(m,b,m,Math.floor(C*v),Math.floor(d.y*v)),I=this.findDEMTileFor(D);if(!I||!I.dem)return o;const R=I.dem,N=1<<I.tileID.canonical.z,j=(C*N-I.tileID.canonical.x)*R.dim,K=(d.y*N-I.tileID.canonical.y)*R.dim,Z=Math.floor(j),te=Math.floor(K);return(l?this.exaggeration():1)*Cn(Cn(R.get(Z,te),R.get(Z,te+1),K-te),Cn(R.get(Z+1,te),R.get(Z+1,te+1),K-te),j-Z)}getAtTileOffset(d,o,l){const u=1<<d.canonical.z;return this.getAtPointOrZero(new ot(d.wrap+(d.canonical.x+o/Xt)/u,(d.canonical.y+l/Xt)/u))}getAtTileOffsetFunc(d,o,l,u){return m=>{const v=this.getAtTileOffset(d,m.x,m.y),b=u.upVector(d.canonical,m.x,m.y);return Jn(b,b,v*u.upVectorScale(d.canonical,o,l).metersToTile),b}}getForTilePoints(d,o,l,u){if(this.isUsingMockSource())return!1;const m=wp.create(this,d,u);return!!m&&(o.forEach(v=>{v[2]=this.exaggeration()*m.getElevationAt(v[0],v[1],l)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(d);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,m=1<<d.canonical.z-u.canonical.z;let v=d.canonical.x/m-u.canonical.x,b=d.canonical.y/m-u.canonical.y,C=0;for(let D=0;D<d.canonical.z-u.canonical.z&&!l.leaves[C];D++){v*=2,b*=2;const I=2*Math.floor(b)+Math.floor(v);C=l.childOffsets[C]+I,v%=1,b%=1}return{min:this.exaggeration()*l.minimums[C],max:this.exaggeration()*l.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(0===d.length)return null;let o=!1,l=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of d){const v=this.getMinMaxForTile(m.tileID);v&&(l=Math.min(l,v.min),u=Math.max(u,v.max),o=!0)}return o?{min:l,max:u}:null}},p.du=AM,p.dv=Mu,p.dw=function(d,o){return[Math.pow(d[0],2.2)*o,Math.pow(d[1],2.2)*o,Math.pow(d[2],2.2)*o]},p.dx=cc,p.dy=function(d,o){var l=Math.sin(o),u=Math.cos(o);return d[0]=u,d[1]=l,d[2]=0,d[3]=-l,d[4]=u,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},p.dz=Nc,p.e=cs,p.e$=u2,p.e0=256,p.e1=rf,p.e2=al,p.e3=Ya,p.e4=function(d,o){return d[0]=o[0],d[1]=o[1],d[2]=o[2],d[3]=o[4],d[4]=o[5],d[5]=o[6],d[6]=o[8],d[7]=o[9],d[8]=o[10],d},p.e5=dh,p.e6=rm,p.e7=function(d,o,l,u,m){return Ge((d-o)/(l-o)*(m-u)+u,u,m)},p.e8=_r,p.e9=function(d,o){var l=o[0],u=o[1],m=o[2],v=o[3],b=o[4],C=o[5],D=o[6],I=o[7],R=o[8],N=R*b-C*I,j=-R*v+C*D,K=I*v-b*D,Z=l*N+u*j+m*K;return Z?(d[0]=N*(Z=1/Z),d[1]=(-R*u+m*I)*Z,d[2]=(C*u-m*b)*Z,d[3]=j*Z,d[4]=(R*l-m*D)*Z,d[5]=(-C*l+m*v)*Z,d[6]=K*Z,d[7]=(-I*l+u*D)*Z,d[8]=(b*l-u*v)*Z,d):null},p.eA=function(d,o,l){return d[0]=o[0]/l[0],d[1]=o[1]/l[1],d[2]=o[2]/l[2],d},p.eB=dc,p.eC=se,p.eD=Yo,p.eE=function(d,o,l,u){return d[0]=o,d[1]=l,d[2]=u,d},p.eF=function([d,o,l]){const u=Math.hypot(d,o,l),m=Math.atan2(d,l),v=.5*Math.PI-Math.acos(-o/u);return new le(ge(m),ge(v))},p.eG=hc,p.eH=jx,p.eI=function(d){const o=d.navigator?d.navigator.userAgent:null;return!!function(l){if(null==qo){const u=l.navigator?l.navigator.userAgent:null;qo=!!l.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return qo}(d)&&!(!o||!(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},p.eJ=function(d,o){na=d,uo=o},p.eK=zb,p.eL=up,p.eM=function(d){const o=[0,0,0],l=Gn(new Float64Array(16));return Rr(l,d.pixelMatrix,d.globeMatrix),ui(o,o,l),new Wt(o[0],o[1])},p.eN=function(d,o,l=!1){if(ic===Ig||ic===_0||ic===y0)throw new Error("setRTLTextPlugin cannot be called multiple times.");gu=Un.resolveURL(d),ic=Ig,Og=o,Rg(),l||v0()},p.eO=tp,p.eP=function(){$v().acquire(ew)},p.eQ=function(){const d=w_;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(ew),w_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},p.eR=xf,p.eS=function(d){const o=Rd();if(!o)return;const l=o.delete($o);d&&l.then(()=>d()).catch(d)},p.eT=x_,p.eU=Ki,p.eV=function(d){Vm=Un.resolveURL(d),y1||(y1=new g1($v(),new Sa)),y1.broadcast("setDracoUrl",Vm)},p.eW=v1,p.eX=function(d){jm=Un.resolveURL(d),y1||(y1=new g1($v(),new Sa)),y1.broadcast("setMeshoptUrl",jm)},p.eY=ln,p.eZ=sf,p.e_=Tu,p.ea=wb,p.eb=Bo,p.ec=vt,p.ed=class{constructor(d,o,l,u){this.context=d,this.format=u,this.size=l,this.texture=d.gl.createTexture();const[m,v,b]=this.size,{gl:C}=d;C.bindTexture(C.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),C.texImage3D(C.TEXTURE_3D,0,this.format,m,v,b,0,zx(this.format),Nx(this.format),o.data)}bind(d,o){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_3D,this.texture),d!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,d),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,d),this.minFilter=d),o!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,o),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},p.ee=function(d,o){if(d===o){var l=o[1],u=o[2],m=o[3],v=o[6],b=o[7],C=o[11];d[1]=o[4],d[2]=o[8],d[3]=o[12],d[4]=l,d[6]=o[9],d[7]=o[13],d[8]=u,d[9]=v,d[11]=o[14],d[12]=m,d[13]=b,d[14]=C}else d[0]=o[0],d[1]=o[4],d[2]=o[8],d[3]=o[12],d[4]=o[1],d[5]=o[5],d[6]=o[9],d[7]=o[13],d[8]=o[2],d[9]=o[6],d[10]=o[10],d[11]=o[14],d[12]=o[3],d[13]=o[7],d[14]=o[11],d[15]=o[15];return d},p.ef=Hx,p.eg=Ji,p.eh=[1,1,1],p.ei=function(d,o,l,u){var m=new oi(4);return m[0]=d,m[1]=o,m[2]=l,m[3]=u,m},p.ej=go,p.ek=function(d,o,l,u){var m=o[0],v=o[1],b=o[2],C=o[3];return d[0]=m+u*(l[0]-m),d[1]=v+u*(l[1]-v),d[2]=b+u*(l[2]-b),d[3]=C+u*(l[3]-C),d},p.el=wp,p.em=wd,p.en=ch,p.eo=Xc,p.ep=function(d,o,l,u,m,v,b,C,D,I,R,N,j,K,Z,te){var ce=new oi(16);return ce[0]=d,ce[1]=o,ce[2]=l,ce[3]=u,ce[4]=m,ce[5]=v,ce[6]=b,ce[7]=C,ce[8]=D,ce[9]=I,ce[10]=R,ce[11]=N,ce[12]=j,ce[13]=K,ce[14]=Z,ce[15]=te,ce},p.eq=oe,p.er=ll,p.es=S0,p.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Wt(1/0,1/0),max:new Wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,o=!1){const l=GM(new Wt(0,0),new Wt(Xt,Xt),d),u=[];if(o&&!ix(l,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!ix(l,m))continue;const v=ev(m.min,m.max,d);u.push({min:v.min,max:v.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(d){this._setSources(d.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const l=[];for(const u of o.cache.getVisibleCoordinates()){const m=o.cache.getTile(u).buckets[o.layer];m&&m.updateFootprints(u.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(d){const o=d.getFootprints();if(0===o.length)return;const l=d.getOrder(),u=d.getClipMask(),m=d.getClipScope();for(const v of o){if(!v.footprint)continue;const b=GM(v.footprint.min,v.footprint.max,v.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:v.id,footprint:v.footprint,order:l,clipMask:u,clipScope:m})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||$0(o.min,l.min)||$0(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(u,m){const v=(b,C)=>b+C;return u.length-m.length||u.reduce(v,"").localeCompare(m.reduce(v,""))}(o.clipScope,l.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let o=0;for(;!d&&o!==this._activeRegions.length;){const l=this._activeRegions[o],u=this._prevRegions[o];d=l.priority!==u.priority||!$M(l,u)||l.order!==u.order||l.clipMask!==u.clipMask||!jc(l.clipScope,u.clipScope),++o}}if(d){++this._updateTime;for(const l of this._activeRegions)l.order!==Jy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const o=l=>{const u=this._activeRegions;if(l>=u.length)return l;const m=u[l].priority;for(;l<u.length&&u[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,u=o(l);for(;l!==u;){let m=l;const v=l;for(;m!==u;){const b=this._activeRegions[m];b.hiddenByOverlap=!1;for(let C=0;C<v;C++){const D=this._activeRegions[C];if(!D.hiddenByOverlap&&b.order===Jy&&ix(b,D)&&(b.hiddenByOverlap=e1(b.footprint,b.tileId,D.footprint,D.tileId),b.hiddenByOverlap))break}++m}l=u,u=o(l)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=d.length-1;o>=0;o--)this._addSource(d[o]);this._computeReplacement()}},p.eu=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,o){const l=new Gd,u=new Qs,m=[],v=d+1+2,b=o[0]+1,C=o[0]+1+(1+o.length),D=(I,R,N)=>{let j=I===v-1?I-2:0===I?I:I-1;return j+=N?24575:0,[j,R]};for(let I=0;I<v;++I)l.emplaceBack(...D(I,0,!0));for(let I=0;I<b;++I)for(let R=0;R<v;++R)l.emplaceBack(...D(R,I,(0===R||R===v-1)&&!0));for(let I=0;I<o.length;++I){const R=o[I];for(let N=0;N<v;++N)l.emplaceBack(...D(N,R,!0))}for(let I=0;I<o.length;++I){const R=u.length,N=o[I]+1+2,j=new Qs;for(let te=0;te<N-1;te++){const ce=te===N-2,ue=ce?v*(C-o.length+I-te):v;for(let xe=0;xe<v-1;xe++){const ve=te*v+xe;0===te||ce||0===xe||xe===v-2?(j.emplaceBack(ve+1,ve,ve+ue),j.emplaceBack(ve+ue,ve+ue+1,ve+1)):(u.emplaceBack(ve+1,ve,ve+ue),u.emplaceBack(ve+ue,ve+ue+1,ve+1))}}const K=ro.simpleSegment(0,R,l.length,u.length-R);for(let te=0;te<j.uint16.length;te+=3)u.emplaceBack(j.uint16[te],j.uint16[te+1],j.uint16[te+2]);const Z=ro.simpleSegment(0,R,l.length,u.length-R);m.push({withoutSkirts:K,withSkirts:Z})}return{vertices:l,indices:u,segments:m}}_createGrid(d){const o=this._fillGridMeshWithLods(V,U);this._gridSegments=o.segments,this._gridBuffer=d.createVertexBuffer(o.vertices,fh.members),this._gridIndexBuffer=d.createIndexBuffer(o.indices,!0)}_createPoles(d){const o=new Qs;for(let b=0;b<=V;b++)o.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=d.createIndexBuffer(o,!0);const l=new dh,u=new dh,m=new dh,v=new dh;this._poleSegments=[];for(let b=0,C=0;b<S;b++){const D=360/(1<<b);l.emplaceBack(0,-M,0,.5,0),u.emplaceBack(0,-M,0,.5,1),m.emplaceBack(0,-M,0,.5,.5),v.emplaceBack(0,-M,0,.5,.5);for(let I=0;I<=V;I++){let R=I/V,N=0;const j=Cn(0,D,R),[K,Z,te]=Q(KS,EM,j,M);l.emplaceBack(K,Z,te,R,N),u.emplaceBack(K,Z,te,R,1-N);const ce=ae(j);R=.5+.5*Math.sin(ce),N=.5+.5*Math.cos(ce),m.emplaceBack(K,Z,te,R,N),v.emplaceBack(K,Z,te,R,1-N)}this._poleSegments.push(ro.simpleSegment(C,0,66,64)),C+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(l,Ec,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(u,Ec,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(m,Ec,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(v,Ec,!1)}getGridBuffers(d,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},p.ev=Jy,p.ew=Fe,p.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},p.ey=We,p.ez=Pt,p.f=function(d){return 0===d.indexOf("mapbox:")},p.f0=M3,p.f1=rC,p.f2=mp,p.f3="hd_road_elevation",p.f4=Yb,p.f5=Wn,p.f6=Cu,p.f7=kv,p.f8=km,p.f9=function(d,o,l,u,m,v,b,C=1,D,I){d.createArrays(),d.tilePixelRatio=Xt/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const R=d.layers[0].layout,N=d.layers[0]._unevaluatedLayout._values,j={};j.scaleFactor=C,j.textSizeScaleRange=R.get("text-size-scale-range"),j.iconSizeScaleRange=R.get("icon-size-scale-range");const[K,Z]=j.textSizeScaleRange,[te,ce]=j.iconSizeScaleRange;j.textScaleFactor=Ge(j.scaleFactor,K,Z),j.iconScaleFactor=Ge(j.scaleFactor,te,ce);const ue=N["text-size"],xe=N["icon-size"];if("composite"===d.textSizeData.kind){const{minZoom:ze,maxZoom:qe}=d.textSizeData;j.compositeTextSizes=[ue.possiblyEvaluate(new dr(ze),v),ue.possiblyEvaluate(new dr(qe),v)]}if("composite"===d.iconSizeData.kind){const{minZoom:ze,maxZoom:qe}=d.iconSizeData;j.compositeIconSizes=[xe.possiblyEvaluate(new dr(ze),v),xe.possiblyEvaluate(new dr(qe),v)]}j.layoutTextSize=ue.possiblyEvaluate(new dr(b+1),v),j.layoutIconSize=xe.possiblyEvaluate(new dr(b+1),v),j.textMaxSize=ue.possiblyEvaluate(new dr(18),v);const ve=R.get("symbol-placement"),ie="map"===R.get("text-rotation-alignment")&&"point"!==ve,_e=R.get("text-size");let we=!1;const Ce=[];for(const ze of d.features){const qe=R.get("text-font").evaluate(ze,{},v).join(","),Ze=_e.evaluate(ze,{},v)*j.textScaleFactor,Xe=j.layoutTextSize.evaluate(ze,{},v)*j.textScaleFactor,pt=j.layoutIconSize.evaluate(ze,{},v)*j.iconScaleFactor,Rt={horizontal:{},vertical:void 0},Mt=ze.text;let Tt,Nt=[0,0];if(Mt){const un=Mt.toString(),Bn=R.get("text-letter-spacing").evaluate(ze,{},v)*xs,Kn=R.get("text-line-height").evaluate(ze,{},v)*xs,ri=Mb(un)?Bn:0,_i=R.get("text-anchor").evaluate(ze,{},v),di=R.get("text-variable-anchor");if(!di){const Se=R.get("text-radial-offset").evaluate(ze,{},v);if(Se)Nt=Mr(_i,[Se*xs,Tx]);else{const _t=R.get("text-offset").evaluate(ze,{},v);Nt=[_t[0]*xs,_t[1]*xs]}}let li=ie?"center":R.get("text-justify").evaluate(ze,{},v);const Dr="point"===ve,Ur=Dr?R.get("text-max-width").evaluate(ze,{},v)*xs:1/0,ke=Se=>{d.allowVerticalPlacement&&f0(un)&&(Rt.vertical=pC(Mt,o,l,m,qe,Ur,Kn,_i,Se,ri,Nt,Dc.vertical,!0,Xe,Ze,D))};if(!ie&&di){const Se="auto"===li?di.map($t=>Dv($t)):[li];let _t=!1;for(let $t=0;$t<Se.length;$t++){const en=Se[$t];if(!Rt.horizontal[en])if(_t)Rt.horizontal[en]=Rt.horizontal[0];else{const Jt=pC(Mt,o,l,m,qe,Ur,Kn,"center",en,ri,Nt,Dc.horizontal,!1,Xe,Ze,D);Jt&&(Rt.horizontal[en]=Jt,_t=1===Jt.positionedLines.length)}}ke("left")}else{if("auto"===li&&(li=Dv(_i)),Dr||R.get("text-writing-mode").indexOf("horizontal")>=0||!f0(un)){const Se=pC(Mt,o,l,m,qe,Ur,Kn,_i,li,ri,Nt,Dc.horizontal,!1,Xe,Ze,D);Se&&(Rt.horizontal[li]=Se)}ke(Dr?"left":li)}}let ut,Et,lt,gt,Bt,q,gn,hn=!1;if(ze.icon&&ze.icon.hasPrimary()){const un=EC(ze.icon,d.iconSizeData,N["icon-size"],v,d.zoom,ze,D,j.iconScaleFactor);ut=un.iconPrimary,lt=un.iconSecondary;const Bn=ut.toString();if(Et=u.get(Bn),Et&&(Bt=R.get("icon-offset").evaluate(ze,{},v),q=R.get("icon-anchor").evaluate(ze,{},v),gn=R.get("icon-text-fit").evaluate(ze,{},v),Tt=_C(m.get(Bn),lt?m.get(lt.toString()):void 0,Bt,q),hn=Et.sdf,void 0===d.sdfIcons?d.sdfIcons=Et.sdf:d.sdfIcons!==Et.sdf&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Et.pixelRatio!==d.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(d.iconsNeedLinear=!0)),lt){const Kn=lt.toString();gt=u.get(Kn)}}we=we||!(!ze.icon||!ze.icon.hasSecondary());const Kt=o_(Rt.horizontal)||Rt.vertical;d.iconsInText||(d.iconsInText=!!Kt&&Kt.iconsInText);const Qe=Xe*j.textScaleFactor/xs,{defaultShapedIcon:Ft,verticallyShapedIcon:Yt}=PE(d,Tt,R,ze,v,Rt,Qe,Bt,gn);"none"!==gn&&Tt&&(yC(Tt)||wm(Tt))&&(Sv(0,Et,ut,Tt,Ft,gn,I,u,m),Sv(0,gt,lt,Tt,Ft,gn,I,u,m),Yt&&(Sv(0,Et,ut,Tt,Yt,gn,I,u,m),Sv(0,gt,lt,Tt,Yt,gn,I,u,m))),Tt=Ft,Ce.push({feature:ze,shapedTextOrientations:Rt,shapedText:Kt,shapedIcon:Tt,iconPrimary:ut,iconSecondary:lt,iconOffset:Bt,iconAnchor:q,verticallyShapedIcon:Yt,layoutTextSize:Xe,layoutIconSize:pt,textOffset:Nt,isSDFIcon:hn,iconTextFit:gn})}return{featureData:Ce,sizes:j,hasAnySecondaryIcon:we,textAlongLine:ie,symbolPlacement:ve}},p.fa=kC,p.fb=function(d,o,l,u,m,v,b,C,D,I){const{featureData:R,hasAnySecondaryIcon:N,sizes:j,textAlongLine:K,symbolPlacement:Z}=o;for(const te of R){const{shapedIcon:ce,verticallyShapedIcon:ue,feature:xe,shapedTextOrientations:ve,shapedText:ie,layoutTextSize:_e,textOffset:we,isSDFIcon:Ce,iconPrimary:ze,iconSecondary:qe,iconTextFit:Ze,iconOffset:Xe}=te;DC(ce,I.iconPositions,ze,qe),DC(ue,I.iconPositions,ze,qe),Ax(ve,I.iconPositions),(ie||ce)&&TC(d,xe,ve,ce,ue,D,j,_e,0,we,Ce,u,m,b,C,N,Ze,Xe,K,Z)}l&&d.generateCollisionDebugBuffers(v,d.collisionBoxArray,j.textScaleFactor)},p.fc=fp,p.fd=pw,p.fe=Th,p.ff=Jg,p.fg=gv,p.fh=mc,p.fi=function(d){let o=0;if(new Uint32Array(d,0,1)[0]!==v3){const l=new Uint32Array(d,0,7),[,,u,m,v,b]=l;o=l.byteLength+m+v+b+v,(u!==d.byteLength||o>=d.byteLength)&&ci("Invalid b3dm header information.")}return vw(d,o)},p.fj=function(d,o){const l=Mp(d);for(const u of l){for(const m of u.meshes)aD(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(lD(u.lights,o)))}return l},p.fk=y_,p.fl=wi,p.fm=Jx,p.fn=Yr,p.fo=function(d){Qa(),Ls?.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-d;u++)o.delete(l[u]).catch(m=>ci(m.message))}).catch(l=>ci(l.message))}).catch(o=>ci(o.message))},p.g=function(d,o){return po(tt(d,{method:"GET"}),o)},p.h=rr,p.i=function(d){return cs.API_STYLE_REGEX.test(d)&&!yo(d)},p.j=function(d){return decodeURIComponent(atob(d).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},p.k=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(o,l)=>String.fromCharCode(+("0x"+l))))},p.l=tt,p.m=Ri,p.n=function(d,o){return po(tt(d,{type:"json"}),o)},p.o=ad,p.p=function(d,o){return po(tt(d,{method:"POST"}),o)},p.q=Un,p.r=$a,p.s=function(d){try{const o=self[d];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},p.t=Is,p.u=function(){return function d(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},p.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},p.w=ci,p.x=function(){return tw||(tw=new xf),tw},p.y=Kv,p.z=Va}),co(0,function(p){function En(mt){const ae=mt?mt.url.toString():void 0;return ae?performance.getEntriesByName(ae):[]}function oi(mt){if("number"==typeof mt||"boolean"==typeof mt||"string"==typeof mt||null==mt)return JSON.stringify(mt);if(Array.isArray(mt)){let ge="[";for(const Ae of mt)ge+=`${oi(Ae)},`;return`${ge}]`}let ae="{";for(const ge of Object.keys(mt).sort())ae+=`${ge}:${oi(mt[ge])},`;return`${ae}}`}function Xl(mt){let ae="";for(const ge of p.bu)("model"!==mt.type||"minzoom"!==ge&&"maxzoom"!==ge)&&(ae+=`/${oi(mt[ge])}`);return ae}class cc{constructor(ae){this.keyCache={},this._layers={},this._layerConfigs={},ae&&this.replace(ae)}replace(ae,ge){this._layerConfigs={},this._layers={},this.update(ae,[],ge)}update(ae,ge,Ae){this._options=Ae;for(const Fe of ae)this._layerConfigs[Fe.id]=Fe,(this._layers[Fe.id]=p.dc(Fe,this.scope,null,this._options)).compileFilter(Ae),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id];for(const Fe of ge)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};const je=function(Fe,We){const Ge={};for(let at=0;at<Fe.length;at++){const bt=Fe[at];let tt=We&&We[bt.id];tt||("symbol"===bt.type?tt=bt.id:(tt=Xl(bt),"line"===bt.type&&bt.paint&&function jt(pn){return"string"==typeof pn&&"line-progress"===pn||(Array.isArray(pn)?pn.some(jt):!(!pn||"object"!=typeof pn)&&Object.values(pn).some(jt))}(bt.paint["line-width"])&&(tt+=`/${oi(bt.paint["line-width"])}`))),We&&(We[bt.id]=tt);let Zt=Ge[tt];Zt||(Zt=Ge[tt]=[]),Zt.push(bt)}const Ne=[];for(const at in Ge)Ne.push(Ge[at]);return Ne}(Object.values(this._layerConfigs),this.keyCache);for(const Fe of je){const We=Fe.map(Zt=>this._layers[Zt.id]),Ge=We[0];if("none"===Ge.visibility)continue;const Ne=Ge.source||"";let at=this.familiesBySource[Ne];at||(at=this.familiesBySource[Ne]={});const bt=Ge.sourceLayer||"_geojsonTileLayer";let tt=at[bt];tt||(tt=at[bt]=[]),tt.push(We)}}}const Qr=1*p.e_;class zt{constructor(ae){const ge={},Ae=[];for(const Ge in ae){const Ne=ae[Ge],at=ge[Ge]={};for(const bt in Ne.glyphs){const tt=Ne.glyphs[+bt];if(!tt||0===tt.bitmap.width||0===tt.bitmap.height)continue;const Zt=tt.metrics.localGlyph?Qr:1,jt={x:0,y:0,w:tt.bitmap.width+2*Zt,h:tt.bitmap.height+2*Zt};Ae.push(jt),at[bt]=jt}}const{w:je,h:Fe}=p.H(Ae),We=new p.eZ({width:je||1,height:Fe||1});for(const Ge in ae){const Ne=ae[Ge];for(const at in Ne.glyphs){const bt=Ne.glyphs[+at];if(!bt||0===bt.bitmap.width||0===bt.bitmap.height)continue;const tt=ge[Ge][at],Zt=bt.metrics.localGlyph?Qr:1;p.eZ.copy(bt.bitmap,We,{x:0,y:0},{x:tt.x+Zt,y:tt.y+Zt},bt.bitmap)}}this.image=We,this.positions=ge}}p.eY(zt,"GlyphAtlas");class Fc{constructor(ae){this.tileID=new p.aM(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.lut=ae.lut,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.scope=ae.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ae.showCollisionBoxes,this.collectResourceTiming=!!ae.request&&ae.request.collectResourceTiming,this.promoteId=ae.promoteId,this.isSymbolTile=ae.isSymbolTile,this.tileTransform=p.aW(ae.tileID.canonical,ae.projection),this.projection=ae.projection,this.worldview=ae.worldview,this.localizableLayerIds=ae.localizableLayerIds,this.brightness=ae.brightness,this.extraShadowCaster=!!ae.extraShadowCaster,this.tessellationStep=ae.tessellationStep,this.scaleFactor=ae.scaleFactor}parse(ae,ge,Ae,je,Fe,We){this.status="parsing",this.data=ae,this.collisionBoxArray=new p.b0;const Ge=new p.e$(Object.keys(ae.layers).sort()),Ne=new p.f0(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];const at={},bt=new p.f1(256,256),tt={featureIndex:Ne,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:bt,availableImages:Ae,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Zt=ge.familiesBySource[this.source];for(const ki in Zt){const Si=ae.layers[ki];if(!Si)continue;let wi=!1,Do=!1,qo=!1;for(const ys of Zt[ki])"symbol"===ys[0].type?wi=!0:Do=!0,ys[0].is3D()&&"model"!==ys[0].type&&(qo=!0);if(this.extraShadowCaster&&!qo||!0===this.isSymbolTile&&!wi||!1===this.isSymbolTile&&!Do)continue;1===Si.version&&p.w(`Vector tile source "${this.source}" layer "${ki}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qo=Ge.encode(ki),_s=[];let ka=!1;for(let ys=0,Ps=0;ys<Si.length;ys++){const Jo=Si.feature(ys),cs=Ne.getId(Jo,ki);if(this.localizableLayerIds&&this.localizableLayerIds.has(ki)){const rr=Jo.properties?Jo.properties.worldview:null;if(this.worldview&&"string"==typeof rr)if("all"===rr)Jo.properties.$localized=!0;else{if(!rr.split(",").includes(this.worldview))continue;Jo.properties.$localized=!0,Jo.properties.worldview=this.worldview}}!ka&&Jo.properties&&Jo.properties.hasOwnProperty(p.f2)&&(ka=!0),_s.push({feature:Jo,id:cs,index:Ps,sourceLayerIndex:Qo}),Ps++}ka&&!tt.elevationFeatures&&ae.layers.hasOwnProperty(p.f3)&&(tt.elevationFeatures=p.f4.parseFrom(ae.layers[p.f3],this.canonical));for(const ys of Zt[ki]){const Ps=ys[0];(!this.extraShadowCaster||Ps.is3D()&&"model"!==Ps.type)&&(void 0!==this.isSymbolTile&&"symbol"===Ps.type!==this.isSymbolTile||Ps.minzoom&&this.zoom<Math.floor(Ps.minzoom)||Ps.maxzoom&&this.zoom>=Ps.maxzoom||"none"!==Ps.visibility&&(Gn(ys,this.zoom,tt.brightness,Ae),(at[Ps.id]=Ps.createBucket({index:Ne.bucketLayerIDs.length,layers:ys,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:je})).populate(_s,tt,this.tileID.canonical,this.tileTransform),Ne.bucketLayerIDs.push(ys.map(Jo=>p.C(Jo.id,Jo.scope)))))}}let jt,pn,Nn,Wn,ii,pi;bt.trim();const cr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ci=()=>{if(jt)return this.status="done",We(jt);if(this.extraShadowCaster)this.status="done",We(null,{buckets:Object.values(at).filter(ki=>!ki.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pn&&Nn&&Wn){const ki=new zt(pn),Si=new Map;for(const[qo,Qo]of Nn.entries()){const{imagePosition:_s}=p.f7(qo,Qo,p.f8);Si.set(qo,_s)}const wi={};for(const qo in at){const Qo=at[qo];Qo instanceof p.b1&&(Gn(Qo.layers,this.zoom,tt.brightness,Ae),wi[qo]=p.f9(Qo,pn,ki.positions,Nn,Si,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ii))}const Do={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Fe,Nn,ii,()=>{Do.iconsPending=!1,fi(wi,ki,Do)}),this.rasterizeIfNeeded(Fe,Wn,pi,()=>{Do.patternsPending=!1,fi(wi,ki,Do)})}},fi=(ki,Si,wi,Do)=>{if(wi.iconsPending||wi.patternsPending)return;const qo=new p.fa(Nn,Wn,this.lut);for(const Qo in at){const _s=at[Qo];if(Qo in ki)p.fb(_s,ki[Qo],this.showCollisionBoxes,Ae,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Nn,qo);else if(_s.hasPattern&&(_s instanceof p.b7||_s instanceof p.b8||_s instanceof p.dV)){Gn(_s.layers,this.zoom,tt.brightness,Ae);const ka=Object.fromEntries(qo.patternPositions);_s.addFeatures(tt,this.tileID.canonical,ka,Ae,this.tileTransform,this.brightness)}}this.status="done",We(null,{buckets:Object.values(at).filter(Qo=>!Qo.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Si.image,lineAtlas:bt,imageAtlas:qo,brightness:tt.brightness})};if(!this.extraShadowCaster){const ki=p.f5(tt.glyphDependencies,Do=>Object.keys(Do).map(Number));Object.keys(ki).length?Fe.send("getGlyphs",{uid:this.uid,stacks:ki,scope:this.scope},(Do,qo)=>{jt||(jt=Do,pn=qo,ci())},void 0,!1,cr):pn={};const Si=Array.from(tt.iconDependencies.keys()).map(Do=>p.I.parse(Do));Si.length?Fe.send("getImages",{images:Si,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Do,qo)=>{jt||(jt=Do,Nn=new Map,ii=this.updateImageMapAndGetImageTaskQueue(Nn,qo,tt.iconDependencies),ci())},void 0,!1,cr):(Nn=new Map,ii=new Map);const wi=Array.from(tt.patternDependencies.keys()).map(Do=>p.I.parse(Do));wi.length?Fe.send("getImages",{images:wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Do,qo)=>{jt||(jt=Do,Wn=new Map,pi=this.updateImageMapAndGetImageTaskQueue(Wn,qo,tt.patternDependencies),ci())},void 0,!1,cr):(Wn=new Map,pi=new Map)}if(tt.elevationFeatures&&tt.elevationFeatures.length>0){const ki=[];for(const wi of Object.values(at))if(wi instanceof p.b8){const Do=wi.getUnevaluatedPortalGraph();Do&&ki.push(Do)}const Si=p.f6.evaluate(ki);for(const wi of Object.values(at))wi instanceof p.b8&&wi.setEvaluatedPortalGraph(Si)}ci()}rasterizeIfNeeded(ae,ge,Ae,je){Array.from(ge.values()).some(Fe=>Fe.usvg)?this.rasterize(ae,ge,Ae,je):je()}updateImageMapAndGetImageTaskQueue(ae,ge,Ae){const je=new Map;for(const Fe of ge.keys()){const We=Ae.get(Fe)||[];for(const Ge of We){const Ne=Ge.toString(),at=ge.get(Ge.id.toString());at.usvg?je.has(Ne)||(je.set(Ne,Ge),ae.set(Ne,Object.assign({},at))):ae.set(Ne,at)}}return je}rasterize(ae,ge,Ae,je){this.rasterizeTask=ae.send("rasterizeImages",{scope:this.scope,tasks:Ae},(Fe,We)=>{if(!Fe)for(const[Ge,Ne]of We.entries()){const at=Object.assign(ge.get(Ge),{data:Ne});ge.set(Ge,at)}je()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Gn(mt,ae,ge,Ae){const je=new p.aa(ae,{brightness:ge});for(const Fe of mt)Fe.recalculate(je,Ae)}class mr extends p.E{constructor(ae,ge,Ae,je,Fe,We,Ge){super(),this.actor=ae,this.layerIndex=ge,this.availableImages=Ae,this.availableModels=je,this.loadVectorData=We||p.aJ,this.loading={},this.loaded={},this.deduped=new p.aI(ae.scheduler),this.isSpriteLoaded=Fe,this.scheduler=ae.scheduler,this.brightness=Ge}loadTile(ae,ge){const Ae=ae.uid,je=ae&&ae.request,Fe=je&&je.collectResourceTiming,We=this.loading[Ae]=new Fc(ae);We.abort=this.loadVectorData(ae,(Ge,Ne)=>{const at=!this.loading[Ae];if(delete this.loading[Ae],We.cancelRasterize(),at||Ge||!Ne)return We.status="done",at||(this.loaded[Ae]=We),ge(Ge);const bt=Ne.rawData,tt={};Ne.expires&&(tt.expires=Ne.expires),Ne.cacheControl&&(tt.cacheControl=Ne.cacheControl),We.vectorTile=Ne.vectorTile||new p.fc.VectorTile(new p.bq(bt));const Zt=()=>{We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(jt,pn)=>{if(jt||!pn)return ge(jt);const Nn={};if(Fe){const Wn=En(je);Wn.length>0&&(Nn.resourceTiming=JSON.parse(JSON.stringify(Wn)))}ge(null,p.l({rawTileData:bt.slice(0)},pn,tt,Nn))})};this.isSpriteLoaded?Zt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Zt,{type:"parseTile",isSymbolTile:ae.isSymbolTile,zoom:ae.tileZoom}):Zt()}),this.loaded=this.loaded||{},this.loaded[Ae]=We})}reloadTile(ae,ge){const Ae=this.loaded,je=ae.uid;if(Ae&&Ae[je]){const Fe=Ae[je];Fe.scaleFactor=ae.scaleFactor,Fe.showCollisionBoxes=ae.showCollisionBoxes,Fe.projection=ae.projection,Fe.brightness=ae.brightness,Fe.tileTransform=p.aW(ae.tileID.canonical,ae.projection),Fe.extraShadowCaster=ae.extraShadowCaster,Fe.lut=ae.lut;const We=(Ge,Ne)=>{const at=Fe.reloadCallback;at&&(delete Fe.reloadCallback,Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at)),ge(Ge,Ne)};"parsing"===Fe.status?Fe.reloadCallback=We:"done"===Fe.status&&(Fe.vectorTile?Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,We):We())}else ge(null,void 0)}abortTile(ae,ge){const Ae=ae.uid,je=this.loading[Ae];je&&(je.abort&&je.abort(),delete this.loading[Ae]),ge()}removeTile(ae,ge){const Ae=this.loaded,je=ae.uid;Ae&&Ae[je]&&delete Ae[je],ge()}}class Rr{loadTile(ae,ge){const{uid:Ae,encoding:je,rawImageData:Fe,padding:We}=ae,Ge=ImageBitmap&&Fe instanceof ImageBitmap?this.getImageData(Fe,We):Fe;ge(null,new p.fd(Ae,Ge,je,We<1))}reloadTile(ae,ge){ge(null,null)}abortTile(ae,ge){ge()}removeTile(ae,ge){ge()}getImageData(ae,ge){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ae.width,ae.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ae.width,this.offscreenCanvas.height=ae.height,this.offscreenCanvasContext.drawImage(ae,0,0,ae.width,ae.height);const Ae=this.offscreenCanvasContext.getImageData(-ge,-ge,ae.width+2*ge,ae.height+2*ge);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ae}}p.bp.setPbf(p.bq);class ho{constructor(ae){this._mrt=new p.bp(ae.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ae.uid,this.tileID=ae.tileID,this.source=ae.source}parse(ae,ge){const Ae=this._mrt;this.status="parsing",this._entireBuffer=ae;try{Ae.parseHeader(ae),this._isHeaderLoaded=!0;const je=[];for(const Fe in Ae.layers){const We=Ae.getLayer(Fe),Ge=We.getDataRange(We.getBandList()),Ne=Ae.createDecodingTask(Ge),at=ae.slice(Ge.firstByte,Ge.lastByte+1),bt=p.bp.performDecoding(at,Ne).then(tt=>Ne.complete(null,tt)).catch(tt=>Ne.complete(tt,null));je.push(bt)}Promise.allSettled(je).then(()=>ge(null,Ae)).catch(Fe=>ge(Fe))}catch(je){ge(je)}}}class No{constructor(ae){this.actor=ae,this.loading={},this.loaded={}}loadTile(ae,ge){const Ae=ae.uid,je=ae.request,Fe=this.loading[Ae]=new ho(ae),{cancel:We}=p.br(je,(Ge,Ne,at,bt)=>{const tt=!this.loading[Ae];if(delete this.loading[Ae],tt||Ge||!Ne)return Fe.status="done",tt||(this.loaded[Ae]=Fe),ge(Ge);Fe.parse(Ne,(Zt,jt)=>{if(Zt||!jt)return ge(Zt);ge(null,jt,at,bt)}),this.loaded[Ae]=Fe});Fe.abort=We}reloadTile(ae,ge){ge(null,void 0)}abortTile(ae,ge){const Ae=ae.uid,je=this.loading[Ae];je&&(je.abort&&je.abort(),delete this.loading[Ae]),ge()}removeTile(ae,ge){const Ae=ae.uid;this.loaded[Ae]&&delete this.loaded[Ae],ge()}decodeRasterArray(ae,ge){p.bp.performDecoding(ae.buffer,ae.task).then(Ae=>ge(null,Ae)).catch(Ae=>ge(Ae))}}const Uo=p.fc.VectorTileFeature.prototype.toGeoJSON;class Ya{constructor(ae){this._feature=ae,this.extent=p.aj,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(1===this._feature.type){const ae=[];for(const ge of this._feature.geometry)ae.push([new p.P(ge[0],ge[1])]);return ae}{const ae=[];for(const ge of this._feature.geometry){const Ae=[];for(const je of ge)Ae.push(new p.P(je[0],je[1]));ae.push(Ae)}return ae}}toGeoJSON(ae,ge,Ae){return Uo.call(this,ae,ge,Ae)}}class Pl{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.aj,this.length=ae.length,this._features=ae}feature(ae){return new Ya(this._features[ae])}}const xa=64/4096,Il=128;class Xa{constructor(){this.features=new Map}clear(){this.features.clear()}load(ae=[],ge){for(const Ae of ae){const je=Ae.id;if(null==je)continue;let Fe=this.features.get(je);Fe&&this.updateCache(Fe,ge),Ae.geometry?(Fe=Ji(Ae),this.updateCache(Fe,ge),this.features.set(je,Fe)):this.features.delete(je),this.updateCache(Fe,ge)}}updateCache(ae,ge){for(const{canonical:Ae,uid:je}of Object.values(ge)){const{z:Fe,x:We,y:Ge}=Ae;zc(ae,Math.pow(2,Fe),We,Ge)&&delete ge[je]}}getTile(ae,ge,Ae){const je=Math.pow(2,ae),Fe=[];for(const We of this.features.values())zc(We,je,ge,Ae)&&Fe.push(Cr(We,je,ge,Ae));return{features:Fe}}getFeatures(){return[...this.features.values()]}}function zc({minX:mt,minY:ae,maxX:ge,maxY:Ae},je,Fe,We){return mt<(Fe+1+xa)/je&&ae<(We+1+xa)/je&&ge>(Fe-xa)/je&&Ae>(We-xa)/je}function Ji(mt){const{id:ae,geometry:ge,properties:Ae}=mt;if(!ge)return;if("GeometryCollection"===ge.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:je,coordinates:Fe}=ge,We={id:ae,type:1,geometry:[],tags:Ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=We.geometry;if("Point"===je)Co(Fe,Ge,We);else if("MultiPoint"===je)for(const Ne of Fe)Co(Ne,Ge,We);else if("LineString"===je)We.type=2,gr(Fe,Ge,We);else if("MultiLineString"===je)We.type=2,Qn(Fe,Ge,We);else if("Polygon"===je)We.type=3,Qn(Fe,Ge,We,!0);else{if("MultiPolygon"!==je)throw new Error("Input data is not a valid GeoJSON object.");We.type=3;for(const Ne of Fe)Qn(Ne,Ge,We,!0)}return We}function Co([mt,ae],ge,Ae){const je=p.ay(mt);let Fe=p.aH(ae);Fe=Fe<0?0:Fe>1?1:Fe,ge.push(je,Fe),Ae.minX=Math.min(Ae.minX,je),Ae.minY=Math.min(Ae.minY,Fe),Ae.maxX=Math.max(Ae.maxX,je),Ae.maxY=Math.max(Ae.maxY,Fe)}function gr(mt,ae,ge,Ae=!1,je=!1){const Fe=[];for(const We of mt)Co(We,Fe,ge);ae.push(Fe),Ae&&function(We,Ge){let Ne=0;for(let at=0,bt=We.length,tt=bt-2;at<bt;tt=at,at+=2)Ne+=(We[at]-We[tt])*(We[at+1]+We[tt+1]);if(Ne>0===Ge)for(let at=0,bt=We.length;at<bt/2;at+=2){const tt=We[at],Zt=We[at+1];We[at]=We[bt-2-at],We[at+1]=We[bt-1-at],We[bt-2-at]=tt,We[bt-1-at]=Zt}}(Fe,je)}function Qn(mt,ae,ge,Ae=!1){for(let je=0;je<mt.length;je++)gr(mt[je],ae,ge,Ae,0===je)}function Cr(mt,ae,ge,Ae){const{id:je,type:Fe,geometry:We,tags:Ge}=mt,Ne=[];if(1===Fe)!function(at,bt,tt,Zt,jt){for(let pn=0;pn<at.length;pn+=2){const Nn=Math.round(p.aj*(at[pn+0]*bt-tt)),Wn=Math.round(p.aj*(at[pn+1]*bt-Zt));jt.push([Nn,Wn])}}(We,ae,ge,Ae,Ne);else for(const at of We)gs(at,ae,ge,Ae,Ne);return{id:je,type:Fe,geometry:Ne,tags:Ge}}function gs(mt,ae,ge,Ae,je){const Fe=-Il,We=p.aj+Il;let Ge;for(let Ne=0;Ne<mt.length-2;Ne+=2){let at=Math.round(p.aj*(mt[Ne+0]*ae-ge)),bt=Math.round(p.aj*(mt[Ne+1]*ae-Ae)),tt=Math.round(p.aj*(mt[Ne+2]*ae-ge)),Zt=Math.round(p.aj*(mt[Ne+3]*ae-Ae));const jt=tt-at,pn=Zt-bt;at<Fe&&tt<Fe||(at<Fe?(bt+=Math.round(pn*((Fe-at)/jt)),at=Fe):tt<Fe&&(Zt=bt+Math.round(pn*((Fe-at)/jt)),tt=Fe),bt<Fe&&Zt<Fe||(bt<Fe?(at+=Math.round(jt*((Fe-bt)/pn)),bt=Fe):Zt<Fe&&(tt=at+Math.round(jt*((Fe-bt)/pn)),Zt=Fe),at>=We&&tt>=We||(at>=We?(bt+=Math.round(pn*((We-at)/jt)),at=We):tt>=We&&(Zt=bt+Math.round(pn*((We-at)/jt)),tt=We),bt>=We&&Zt>=We||(bt>=We?(at+=Math.round(jt*((We-bt)/pn)),bt=We):Zt>=We&&(tt=at+Math.round(jt*((We-bt)/pn)),Zt=We),Ge&&at===Ge[Ge.length-1][0]&&bt===Ge[Ge.length-1][1]||(Ge=[[at,bt]],je.push(Ge)),Ge.push([tt,Zt])))))}}var no,wa,Pi,Jn={exports:{}},yi=function(){if(Pi)return Jn.exports;Pi=1;var mt=p.fg(),ae=function(){if(wa)return no;wa=1;var bt=p.fe(),tt=p.ff().VectorTileFeature;function Zt(pn,Nn){this.options=Nn||{},this.features=pn,this.length=pn.length}function jt(pn,Nn){this.id="number"==typeof pn.id?pn.id:void 0,this.type=pn.type,this.rawGeometry=1===pn.type?[pn.geometry]:pn.geometry,this.properties=pn.tags,this.extent=Nn||4096}return no=Zt,Zt.prototype.feature=function(pn){return new jt(this.features[pn],this.options.extent)},jt.prototype.loadGeometry=function(){var pn=this.rawGeometry;this.geometry=[];for(var Nn=0;Nn<pn.length;Nn++){for(var Wn=pn[Nn],ii=[],pi=0;pi<Wn.length;pi++)ii.push(new bt(Wn[pi][0],Wn[pi][1]));this.geometry.push(ii)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var pn=this.geometry,Nn=1/0,Wn=-1/0,ii=1/0,pi=-1/0,cr=0;cr<pn.length;cr++)for(var ci=pn[cr],fi=0;fi<ci.length;fi++){var ki=ci[fi];Nn=Math.min(Nn,ki.x),Wn=Math.max(Wn,ki.x),ii=Math.min(ii,ki.y),pi=Math.max(pi,ki.y)}return[Nn,ii,Wn,pi]},jt.prototype.toGeoJSON=tt.prototype.toGeoJSON,no}();function ge(bt){var tt=new mt;return function(Zt,jt){for(var pn in Zt.layers)jt.writeMessage(3,Ae,Zt.layers[pn])}(bt,tt),tt.finish()}function Ae(bt,tt){var Zt;tt.writeVarintField(15,bt.version||1),tt.writeStringField(1,bt.name||""),tt.writeVarintField(5,bt.extent||4096);var jt={keys:[],values:[],keycache:{},valuecache:{}};for(Zt=0;Zt<bt.length;Zt++)jt.feature=bt.feature(Zt),tt.writeMessage(2,je,jt);var pn=jt.keys;for(Zt=0;Zt<pn.length;Zt++)tt.writeStringField(3,pn[Zt]);var Nn=jt.values;for(Zt=0;Zt<Nn.length;Zt++)tt.writeMessage(4,at,Nn[Zt])}function je(bt,tt){var Zt=bt.feature;void 0!==Zt.id&&tt.writeVarintField(1,Zt.id),tt.writeMessage(2,Fe,bt),tt.writeVarintField(3,Zt.type),tt.writeMessage(4,Ne,Zt)}function Fe(bt,tt){var Zt=bt.feature,jt=bt.keys,pn=bt.values,Nn=bt.keycache,Wn=bt.valuecache;for(var ii in Zt.properties){var pi=Zt.properties[ii],cr=Nn[ii];if(null!==pi){void 0===cr&&(jt.push(ii),Nn[ii]=cr=jt.length-1),tt.writeVarint(cr);var ci=typeof pi;"string"!==ci&&"boolean"!==ci&&"number"!==ci&&(pi=JSON.stringify(pi));var fi=ci+":"+pi,ki=Wn[fi];void 0===ki&&(pn.push(pi),Wn[fi]=ki=pn.length-1),tt.writeVarint(ki)}}}function We(bt,tt){return(tt<<3)+(7&bt)}function Ge(bt){return bt<<1^bt>>31}function Ne(bt,tt){for(var Zt=bt.loadGeometry(),jt=bt.type,pn=0,Nn=0,Wn=Zt.length,ii=0;ii<Wn;ii++){var pi=Zt[ii],cr=1;1===jt&&(cr=pi.length),tt.writeVarint(We(1,cr));for(var ci=3===jt?pi.length-1:pi.length,fi=0;fi<ci;fi++){1===fi&&1!==jt&&tt.writeVarint(We(2,ci-1));var ki=pi[fi].x-pn,Si=pi[fi].y-Nn;tt.writeVarint(Ge(ki)),tt.writeVarint(Ge(Si)),pn+=ki,Nn+=Si}3===jt&&tt.writeVarint(We(7,1))}}function at(bt,tt){var Zt=typeof bt;"string"===Zt?tt.writeStringField(1,bt):"boolean"===Zt?tt.writeBooleanField(7,bt):"number"===Zt&&(bt%1!=0?tt.writeDoubleField(3,bt):bt<0?tt.writeSVarintField(6,bt):tt.writeVarintField(5,bt))}return Jn.exports=ge,Jn.exports.fromVectorTileJs=ge,Jn.exports.fromGeojsonVt=function(bt,tt){tt=tt||{};var Zt={};for(var jt in bt)Zt[jt]=new ae(bt[jt].features,tt),Zt[jt].name=jt,Zt[jt].version=tt.version,Zt[jt].extent=tt.extent;return ge({layers:Zt})},Jn.exports.GeoJSONWrapper=ae,Jn.exports}(),Sr=p.fh(yi);const Yo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:mt=>mt},Bo=Math.fround||(Sn=new Float32Array(1),mt=>(Sn[0]=+mt,Sn[0]));var Sn;const ei=3,si=5,Lr=6;class ui{constructor(ae){this.options=Object.assign(Object.create(Yo),ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ae){const{log:ge,minZoom:Ae,maxZoom:je}=this.options;ge&&console.time("total time");const Fe=`prepare ${ae.length} points`;ge&&console.time(Fe),this.points=ae;const We=[];for(let Ne=0;Ne<ae.length;Ne++){const at=ae[Ne];if(!at.geometry)continue;const[bt,tt]=at.geometry.coordinates,Zt=Bo(As(bt)),jt=Bo(Vr(tt));We.push(Zt,jt,1/0,Ne,-1,1),this.options.reduce&&We.push(0)}let Ge=this.trees[je+1]=this._createTree(We);ge&&console.timeEnd(Fe);for(let Ne=je;Ne>=Ae;Ne--){const at=+Date.now();Ge=this.trees[Ne]=this._createTree(this._cluster(Ge,Ne)),ge&&console.log("z%d: %d clusters in %dms",Ne,Ge.numItems,+Date.now()-at)}return ge&&console.timeEnd("total time"),this}getClusters(ae,ge){let Ae=((ae[0]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ae[1]));let Fe=180===ae[2]?180:((ae[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)Ae=-180,Fe=180;else if(Ae>Fe){const tt=this.getClusters([Ae,je,180,We],ge),Zt=this.getClusters([-180,je,Fe,We],ge);return tt.concat(Zt)}const Ge=this.trees[this._limitZoom(ge)],Ne=Ge.range(As(Ae),Vr(We),As(Fe),Vr(je)),at=Ge.data,bt=[];for(const tt of Ne){const Zt=this.stride*tt;bt.push(at[Zt+si]>1?Nc(at,Zt,this.clusterProps):this.points[at[Zt+ei]])}return bt}getChildren(ae){const ge=this._getOriginId(ae),Ae=this._getOriginZoom(ae),je="No cluster with the specified id.",Fe=this.trees[Ae];if(!Fe)throw new Error(je);const We=Fe.data;if(ge*this.stride>=We.length)throw new Error(je);const Ge=this.options.radius/(this.options.extent*Math.pow(2,Ae-1)),Ne=Fe.within(We[ge*this.stride],We[ge*this.stride+1],Ge),at=[];for(const bt of Ne){const tt=bt*this.stride;We[tt+4]===ae&&at.push(We[tt+si]>1?Nc(We,tt,this.clusterProps):this.points[We[tt+ei]])}if(0===at.length)throw new Error(je);return at}getLeaves(ae,ge,Ae){const je=[];return this._appendLeaves(je,ae,ge=ge||10,Ae=Ae||0,0),je}getTile(ae,ge,Ae){const je=this.trees[this._limitZoom(ae)],Fe=Math.pow(2,ae),{extent:We,radius:Ge}=this.options,Ne=Ge/We,at=(Ae-Ne)/Fe,bt=(Ae+1+Ne)/Fe,tt={features:[]};return this._addTileFeatures(je.range((ge-Ne)/Fe,at,(ge+1+Ne)/Fe,bt),je.data,ge,Ae,Fe,tt),0===ge&&this._addTileFeatures(je.range(1-Ne/Fe,at,1,bt),je.data,Fe,Ae,Fe,tt),ge===Fe-1&&this._addTileFeatures(je.range(0,at,Ne/Fe,bt),je.data,-1,Ae,Fe,tt),tt.features.length?tt:null}getClusterExpansionZoom(ae){let ge=this._getOriginZoom(ae)-1;for(;ge<=this.options.maxZoom;){const Ae=this.getChildren(ae);if(ge++,1!==Ae.length)break;ae=Ae[0].properties.cluster_id}return ge}_appendLeaves(ae,ge,Ae,je,Fe){const We=this.getChildren(ge);for(const Ge of We){const Ne=Ge.properties;if(Ne&&Ne.cluster?Fe+Ne.point_count<=je?Fe+=Ne.point_count:Fe=this._appendLeaves(ae,Ne.cluster_id,Ae,je,Fe):Fe<je?Fe++:ae.push(Ge),ae.length===Ae)break}return Fe}_createTree(ae){const ge=new p.bW(ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ae=0;Ae<ae.length;Ae+=this.stride)ge.add(ae[Ae],ae[Ae+1]);return ge.finish(),ge.data=ae,ge}_addTileFeatures(ae,ge,Ae,je,Fe,We){for(const Ge of ae){const Ne=Ge*this.stride,at=ge[Ne+si]>1;let bt,tt,Zt;if(at)bt=zi(ge,Ne,this.clusterProps),tt=ge[Ne],Zt=ge[Ne+1];else{const Nn=this.points[ge[Ne+ei]];bt=Nn.properties;const[Wn,ii]=Nn.geometry.coordinates;tt=As(Wn),Zt=Vr(ii)}const jt={type:1,geometry:[[Math.round(this.options.extent*(tt*Fe-Ae)),Math.round(this.options.extent*(Zt*Fe-je))]],tags:bt};let pn;pn=at||this.options.generateId?ge[Ne+ei]:this.points[ge[Ne+ei]].id,void 0!==pn&&(jt.id=pn),We.features.push(jt)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,ge){const{radius:Ae,extent:je,reduce:Fe,minPoints:We}=this.options,Ge=Ae/(je*Math.pow(2,ge)),Ne=ae.data,at=[],bt=this.stride;for(let tt=0;tt<Ne.length;tt+=bt){if(Ne[tt+2]<=ge)continue;Ne[tt+2]=ge;const Zt=Ne[tt],jt=Ne[tt+1],pn=ae.within(Ne[tt],Ne[tt+1],Ge),Nn=Ne[tt+si];let Wn=Nn;for(const ii of pn){const pi=ii*bt;Ne[pi+2]>ge&&(Wn+=Ne[pi+si])}if(Wn>Nn&&Wn>=We){let ii,pi=Zt*Nn,cr=jt*Nn,ci=-1;const fi=(tt/bt<<5)+(ge+1)+this.points.length;for(const ki of pn){const Si=ki*bt;if(Ne[Si+2]<=ge)continue;Ne[Si+2]=ge;const wi=Ne[Si+si];pi+=Ne[Si]*wi,cr+=Ne[Si+1]*wi,Ne[Si+4]=fi,Fe&&(ii||(ii=this._map(Ne,tt,!0),ci=this.clusterProps.length,this.clusterProps.push(ii)),Fe(ii,this._map(Ne,Si)))}Ne[tt+4]=fi,at.push(pi/Wn,cr/Wn,1/0,fi,-1,Wn),Fe&&at.push(ci)}else{for(let ii=0;ii<bt;ii++)at.push(Ne[tt+ii]);if(Wn>1)for(const ii of pn){const pi=ii*bt;if(!(Ne[pi+2]<=ge)){Ne[pi+2]=ge;for(let cr=0;cr<bt;cr++)at.push(Ne[pi+cr])}}}}return at}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,ge,Ae){if(ae[ge+si]>1){const We=this.clusterProps[ae[ge+Lr]];return Ae?Object.assign({},We):We}const je=this.points[ae[ge+ei]].properties,Fe=this.options.map(je);return Ae&&Fe===je?Object.assign({},Fe):Fe}}function Nc(mt,ae,ge){return{type:"Feature",id:mt[ae+ei],properties:zi(mt,ae,ge),geometry:{type:"Point",coordinates:[(Ae=mt[ae],360*(Ae-.5)),dc(mt[ae+1])]}};var Ae}function zi(mt,ae,ge){const Ae=mt[ae+si],je=Ae>=1e4?`${Math.round(Ae/1e3)}k`:Ae>=1e3?Math.round(Ae/100)/10+"k":Ae,Fe=mt[ae+Lr],We=-1===Fe?{}:Object.assign({},ge[Fe]);return Object.assign(We,{cluster:!0,cluster_id:mt[ae+ei],point_count:Ae,point_count_abbreviated:je})}function As(mt){return mt/360+.5}function Vr(mt){const ae=Math.sin(mt*Math.PI/180),ge=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return ge<0?0:ge>1?1:ge}function dc(mt){const ae=(180-360*mt)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function Id(mt,ae,ge,Ae){let je=Ae;const Fe=ae+(ge-ae>>1);let We,Ge=ge-ae;const Ne=mt[ae],at=mt[ae+1],bt=mt[ge],tt=mt[ge+1];for(let Zt=ae+3;Zt<ge;Zt+=3){const jt=go(mt[Zt],mt[Zt+1],Ne,at,bt,tt);if(jt>je)We=Zt,je=jt;else if(jt===je){const pn=Math.abs(Zt-Fe);pn<Ge&&(We=Zt,Ge=pn)}}je>Ae&&(We-ae>3&&Id(mt,ae,We,Ae),mt[We+2]=je,ge-We>3&&Id(mt,We,ge,Ae))}function go(mt,ae,ge,Ae,je,Fe){let We=je-ge,Ge=Fe-Ae;if(0!==We||0!==Ge){const Ne=((mt-ge)*We+(ae-Ae)*Ge)/(We*We+Ge*Ge);Ne>1?(ge=je,Ae=Fe):Ne>0&&(ge+=We*Ne,Ae+=Ge*Ne)}return We=mt-ge,Ge=ae-Ae,We*We+Ge*Ge}function Gs(mt,ae,ge,Ae){const je={id:mt??null,type:ae,geometry:ge,tags:Ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===ae||"MultiPoint"===ae||"LineString"===ae)hc(je,ge);else if("Polygon"===ae)hc(je,ge[0]);else if("MultiLineString"===ae)for(const Fe of ge)hc(je,Fe);else if("MultiPolygon"===ae)for(const Fe of ge)hc(je,Fe[0]);return je}function hc(mt,ae){for(let ge=0;ge<ae.length;ge+=3)mt.minX=Math.min(mt.minX,ae[ge]),mt.minY=Math.min(mt.minY,ae[ge+1]),mt.maxX=Math.max(mt.maxX,ae[ge]),mt.maxY=Math.max(mt.maxY,ae[ge+1])}function _o(mt,ae,ge,Ae){if(!ae.geometry)return;const je=ae.geometry.coordinates;if(je&&0===je.length)return;const Fe=ae.geometry.type,We=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2);let Ge=[],Ne=ae.id;if(ge.promoteId?Ne=ae.properties[ge.promoteId]:ge.generateId&&(Ne=Ae||0),"Point"===Fe)Ka(je,Ge);else if("MultiPoint"===Fe)for(const at of je)Ka(at,Ge);else if("LineString"===Fe)uc(je,Ge,We,!1);else if("MultiLineString"===Fe){if(ge.lineMetrics){for(const at of je)Ge=[],uc(at,Ge,We,!1),mt.push(Gs(Ne,"LineString",Ge,ae.properties));return}Ol(je,Ge,We,!1)}else if("Polygon"===Fe)Ol(je,Ge,We,!0);else{if("MultiPolygon"!==Fe){if("GeometryCollection"===Fe){for(const at of ae.geometry.geometries)_o(mt,{id:Ne,geometry:at,properties:ae.properties},ge,Ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of je){const bt=[];Ol(at,bt,We,!0),Ge.push(bt)}}mt.push(Gs(Ne,Fe,Ge,ae.properties))}function Ka(mt,ae){ae.push(_r(mt[0]),Io(mt[1]),0)}function uc(mt,ae,ge,Ae){let je,Fe,We=0;for(let Ne=0;Ne<mt.length;Ne++){const at=_r(mt[Ne][0]),bt=Io(mt[Ne][1]);ae.push(at,bt,0),Ne>0&&(We+=Ae?(je*bt-at*Fe)/2:Math.sqrt(Math.pow(at-je,2)+Math.pow(bt-Fe,2))),je=at,Fe=bt}const Ge=ae.length-3;ae[2]=1,Id(ae,0,Ge,ge),ae[Ge+2]=1,ae.size=Math.abs(We),ae.start=0,ae.end=ae.size}function Ol(mt,ae,ge,Ae){for(let je=0;je<mt.length;je++){const Fe=[];uc(mt[je],Fe,ge,Ae),ae.push(Fe)}}function _r(mt){return mt/360+.5}function Io(mt){const ae=Math.sin(mt*Math.PI/180),ge=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return ge<0?0:ge>1?1:ge}function ls(mt,ae,ge,Ae,je,Fe,We,Ge){if(Ae/=ae,Fe>=(ge/=ae)&&We<Ae)return mt;if(We<ge||Fe>=Ae)return null;const Ne=[];for(const at of mt){const bt=at.geometry;let tt=at.type;const Zt=0===je?at.minX:at.minY,jt=0===je?at.maxX:at.maxY;if(Zt>=ge&&jt<Ae){Ne.push(at);continue}if(jt<ge||Zt>=Ae)continue;let pn=[];if("Point"===tt||"MultiPoint"===tt)Kl(bt,pn,ge,Ae,je);else if("LineString"===tt)So(bt,pn,ge,Ae,je,!1,Ge.lineMetrics);else if("MultiLineString"===tt)fl(bt,pn,ge,Ae,je,!1);else if("Polygon"===tt)fl(bt,pn,ge,Ae,je,!0);else if("MultiPolygon"===tt)for(const Nn of bt){const Wn=[];fl(Nn,Wn,ge,Ae,je,!0),Wn.length&&pn.push(Wn)}if(pn.length){if(Ge.lineMetrics&&"LineString"===tt){for(const Nn of pn)Ne.push(Gs(at.id,tt,Nn,at.tags));continue}"LineString"!==tt&&"MultiLineString"!==tt||(1===pn.length?(tt="LineString",pn=pn[0]):tt="MultiLineString"),"Point"!==tt&&"MultiPoint"!==tt||(tt=3===pn.length?"Point":"MultiPoint"),Ne.push(Gs(at.id,tt,pn,at.tags))}}return Ne.length?Ne:null}function Kl(mt,ae,ge,Ae,je){for(let Fe=0;Fe<mt.length;Fe+=3){const We=mt[Fe+je];We>=ge&&We<=Ae&&pc(ae,mt[Fe],mt[Fe+1],mt[Fe+2])}}function So(mt,ae,ge,Ae,je,Fe,We){let Ge=Ko(mt);const Ne=0===je?Ss:Eo;let at,bt,tt=mt.start;for(let Wn=0;Wn<mt.length-3;Wn+=3){const ii=mt[Wn],pi=mt[Wn+1],cr=mt[Wn+2],ci=mt[Wn+3],fi=mt[Wn+4],ki=0===je?ii:pi,Si=0===je?ci:fi;let wi=!1;We&&(at=Math.sqrt(Math.pow(ii-ci,2)+Math.pow(pi-fi,2))),ki<ge?Si>ge&&(bt=Ne(Ge,ii,pi,ci,fi,ge),We&&(Ge.start=tt+at*bt)):ki>Ae?Si<Ae&&(bt=Ne(Ge,ii,pi,ci,fi,Ae),We&&(Ge.start=tt+at*bt)):pc(Ge,ii,pi,cr),Si<ge&&ki>=ge&&(bt=Ne(Ge,ii,pi,ci,fi,ge),wi=!0),Si>Ae&&ki<=Ae&&(bt=Ne(Ge,ii,pi,ci,fi,Ae),wi=!0),!Fe&&wi&&(We&&(Ge.end=tt+at*bt),ae.push(Ge),Ge=Ko(mt)),We&&(tt+=at)}let Zt=mt.length-3;const jt=mt[Zt],pn=mt[Zt+1],Nn=0===je?jt:pn;Nn>=ge&&Nn<=Ae&&pc(Ge,jt,pn,mt[Zt+2]),Zt=Ge.length-3,Fe&&Zt>=3&&(Ge[Zt]!==Ge[0]||Ge[Zt+1]!==Ge[1])&&pc(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&ae.push(Ge)}function Ko(mt){const ae=[];return ae.size=mt.size,ae.start=mt.start,ae.end=mt.end,ae}function fl(mt,ae,ge,Ae,je,Fe){for(const We of mt)So(We,ae,ge,Ae,je,Fe,!1)}function pc(mt,ae,ge,Ae){mt.push(ae,ge,Ae)}function Ss(mt,ae,ge,Ae,je,Fe){const We=(Fe-ae)/(Ae-ae);return pc(mt,Fe,ge+(je-ge)*We,1),We}function Eo(mt,ae,ge,Ae,je,Fe){const We=(Fe-ge)/(je-ge);return pc(mt,ae+(Ae-ae)*We,Fe,1),We}function Bc(mt,ae){const ge=[];for(let Ae=0;Ae<mt.length;Ae++){const je=mt[Ae],Fe=je.type;let We;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)We=ml(je.geometry,ae);else if("MultiLineString"===Fe||"Polygon"===Fe){We=[];for(const Ge of je.geometry)We.push(ml(Ge,ae))}else if("MultiPolygon"===Fe){We=[];for(const Ge of je.geometry){const Ne=[];for(const at of Ge)Ne.push(ml(at,ae));We.push(Ne)}}ge.push(Gs(je.id,Fe,We,je.tags))}return ge}function ml(mt,ae){const ge=[];ge.size=mt.size,void 0!==mt.start&&(ge.start=mt.start,ge.end=mt.end);for(let Ae=0;Ae<mt.length;Ae+=3)ge.push(mt[Ae]+ae,mt[Ae+1],mt[Ae+2]);return ge}function fc(mt,ae){if(mt.transformed)return mt;const ge=1<<mt.z,Ae=mt.x,je=mt.y;for(const Fe of mt.features){const We=Fe.geometry,Ge=Fe.type;if(Fe.geometry=[],1===Ge)for(let Ne=0;Ne<We.length;Ne+=2)Fe.geometry.push(Vc(We[Ne],We[Ne+1],ae,ge,Ae,je));else for(let Ne=0;Ne<We.length;Ne++){const at=[];for(let bt=0;bt<We[Ne].length;bt+=2)at.push(Vc(We[Ne][bt],We[Ne][bt+1],ae,ge,Ae,je));Fe.geometry.push(at)}}return mt.transformed=!0,mt}function Vc(mt,ae,ge,Ae,je,Fe){return[Math.round(ge*(mt*Ae-je)),Math.round(ge*(ae*Ae-Fe))]}function Od(mt,ae,ge,Ae,je){const Fe=ae===je.maxZoom?0:je.tolerance/((1<<ae)*je.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:mt.length,source:null,x:ge,y:Ae,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of mt)lr(We,Ge,Fe,je);return We}function lr(mt,ae,ge,Ae){const je=ae.geometry,Fe=ae.type,We=[];if(mt.minX=Math.min(mt.minX,ae.minX),mt.minY=Math.min(mt.minY,ae.minY),mt.maxX=Math.max(mt.maxX,ae.maxX),mt.maxY=Math.max(mt.maxY,ae.maxY),"Point"===Fe||"MultiPoint"===Fe)for(let Ge=0;Ge<je.length;Ge+=3)We.push(je[Ge],je[Ge+1]),mt.numPoints++,mt.numSimplified++;else if("LineString"===Fe)mc(We,je,mt,ge,!1,!1);else if("MultiLineString"===Fe||"Polygon"===Fe)for(let Ge=0;Ge<je.length;Ge++)mc(We,je[Ge],mt,ge,"Polygon"===Fe,0===Ge);else if("MultiPolygon"===Fe)for(let Ge=0;Ge<je.length;Ge++){const Ne=je[Ge];for(let at=0;at<Ne.length;at++)mc(We,Ne[at],mt,ge,!0,0===at)}if(We.length){let Ge=ae.tags||null;if("LineString"===Fe&&Ae.lineMetrics){Ge={};for(const at in ae.tags)Ge[at]=ae.tags[at];Ge.mapbox_clip_start=je.start/je.size,Ge.mapbox_clip_end=je.end/je.size}const Ne={geometry:We,type:"Polygon"===Fe||"MultiPolygon"===Fe?3:"LineString"===Fe||"MultiLineString"===Fe?2:1,tags:Ge};null!==ae.id&&(Ne.id=ae.id),mt.features.push(Ne)}}function mc(mt,ae,ge,Ae,je,Fe){const We=Ae*Ae;if(Ae>0&&ae.size<(je?We:Ae))return void(ge.numPoints+=ae.length/3);const Ge=[];for(let Ne=0;Ne<ae.length;Ne+=3)(0===Ae||ae[Ne+2]>We)&&(ge.numSimplified++,Ge.push(ae[Ne],ae[Ne+1])),ge.numPoints++;je&&function(Ne,at){let bt=0;for(let tt=0,Zt=Ne.length,jt=Zt-2;tt<Zt;jt=tt,tt+=2)bt+=(Ne[tt]-Ne[jt])*(Ne[tt+1]+Ne[jt+1]);if(bt>0===at)for(let tt=0,Zt=Ne.length;tt<Zt/2;tt+=2){const jt=Ne[tt],pn=Ne[tt+1];Ne[tt]=Ne[Zt-2-tt],Ne[tt+1]=Ne[Zt-1-tt],Ne[Zt-2-tt]=jt,Ne[Zt-1-tt]=pn}}(Ge,Fe),mt.push(Ge)}const nh={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gl{constructor(ae,ge){const Ae=(ge=this.options=function(Fe,We){for(const Ge in We)Fe[Ge]=We[Ge];return Fe}(Object.create(nh),ge)).debug;if(Ae&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let je=function(Fe,We){const Ge=[];if("FeatureCollection"===Fe.type)for(let Ne=0;Ne<Fe.features.length;Ne++)_o(Ge,Fe.features[Ne],We,Ne);else _o(Ge,"Feature"===Fe.type?Fe:{geometry:Fe},We);return Ge}(ae,ge);this.tiles={},this.tileCoords=[],Ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=function(Fe,We){const Ge=We.buffer/We.extent;let Ne=Fe;const at=ls(Fe,1,-1-Ge,Ge,0,-1,2,We),bt=ls(Fe,1,1-Ge,2+Ge,0,-1,2,We);return(at||bt)&&(Ne=ls(Fe,1,-Ge,1+Ge,0,-1,2,We)||[],at&&(Ne=Bc(at,1).concat(Ne)),bt&&(Ne=Ne.concat(Bc(bt,-1)))),Ne}(je,ge),je.length&&this.splitTile(je,0,0,0),Ae&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ae,ge,Ae,je,Fe,We,Ge){const Ne=[ae,ge,Ae,je],at=this.options,bt=at.debug;for(;Ne.length;){je=Ne.pop(),Ae=Ne.pop(),ge=Ne.pop(),ae=Ne.pop();const tt=1<<ge,Zt=Rl(ge,Ae,je);let jt=this.tiles[Zt];if(!jt&&(bt>1&&console.time("creation"),jt=this.tiles[Zt]=Od(ae,ge,Ae,je,at),this.tileCoords.push({z:ge,x:Ae,y:je}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,Ae,je,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));const wi=`z${ge}`;this.stats[wi]=(this.stats[wi]||0)+1,this.total++}if(jt.source=ae,null==Fe){if(ge===at.indexMaxZoom||jt.numPoints<=at.indexMaxPoints)continue}else{if(ge===at.maxZoom||ge===Fe)continue;if(null!=Fe){const wi=Fe-ge;if(Ae!==We>>wi||je!==Ge>>wi)continue}}if(jt.source=null,0===ae.length)continue;bt>1&&console.time("clipping");const pn=.5*at.buffer/at.extent,Nn=.5-pn,Wn=.5+pn,ii=1+pn;let pi=null,cr=null,ci=null,fi=null,ki=ls(ae,tt,Ae-pn,Ae+Wn,0,jt.minX,jt.maxX,at),Si=ls(ae,tt,Ae+Nn,Ae+ii,0,jt.minX,jt.maxX,at);ae=null,ki&&(pi=ls(ki,tt,je-pn,je+Wn,1,jt.minY,jt.maxY,at),cr=ls(ki,tt,je+Nn,je+ii,1,jt.minY,jt.maxY,at),ki=null),Si&&(ci=ls(Si,tt,je-pn,je+Wn,1,jt.minY,jt.maxY,at),fi=ls(Si,tt,je+Nn,je+ii,1,jt.minY,jt.maxY,at),Si=null),bt>1&&console.timeEnd("clipping"),Ne.push(pi||[],ge+1,2*Ae,2*je),Ne.push(cr||[],ge+1,2*Ae,2*je+1),Ne.push(ci||[],ge+1,2*Ae+1,2*je),Ne.push(fi||[],ge+1,2*Ae+1,2*je+1)}}getTile(ae,ge,Ae){ae=+ae,ge=+ge,Ae=+Ae;const je=this.options,{extent:Fe,debug:We}=je;if(ae<0||ae>24)return null;const Ge=1<<ae,Ne=Rl(ae,ge=ge+Ge&Ge-1,Ae);if(this.tiles[Ne])return fc(this.tiles[Ne],Fe);We>1&&console.log("drilling down to z%d-%d-%d",ae,ge,Ae);let at,bt=ae,tt=ge,Zt=Ae;for(;!at&&bt>0;)bt--,tt>>=1,Zt>>=1,at=this.tiles[Rl(bt,tt,Zt)];return at&&at.source?(We>1&&(console.log("found parent tile z%d-%d-%d",bt,tt,Zt),console.time("drilling down")),this.splitTile(at.source,bt,tt,Zt,ae,ge,Ae),We>1&&console.timeEnd("drilling down"),this.tiles[Ne]?fc(this.tiles[Ne],Fe):null):null}}function Rl(mt,ae,ge){return 32*((1<<mt)*ge+ae)+mt}function Dh(mt,ae){const ge=mt.tileID.canonical;if(!this._geoJSONIndex)return void ae(null,null);const Ae=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!Ae)return void ae(null,null);const je=new Pl(Ae.features);let Fe=Sr(je);0===Fe.byteOffset&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),ae(null,{vectorTile:je,rawData:Fe.buffer})}class Th extends mr{constructor(ae,ge,Ae,je,Fe,We,Ge){super(ae,ge,Ae,je,Fe,Dh,Ge),We&&(this.loadGeoJSON=We),this._dynamicIndex=new Xa}loadData(ae,ge){const Ae=ae&&ae.request,je=Ae&&Ae.collectResourceTiming;this.loadGeoJSON(ae,(Fe,We)=>{if(Fe||!We)return ge(Fe);if("object"!=typeof We)return ge(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));{try{if(ae.filter){const Ne=p.X(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ne.result)throw new Error(Ne.value.map(at=>`${at.key}: ${at.message}`).join(", "));We.features=We.features.filter(at=>Ne.value.evaluate({zoom:0},at))}ae.dynamic?("Feature"===We.type&&(We={type:"FeatureCollection",features:[We]}),ae.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(We.features,this.loaded),ae.cluster&&(We.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ae.cluster?new ui(function({superclusterOptions:Ne,clusterProperties:at}){if(!at||!Ne)return Ne;const bt={},tt={},Zt={accumulated:null,zoom:0},jt={properties:null},pn=Object.keys(at);for(const Nn of pn){const[Wn,ii]=at[Nn],pi=p.X(ii),cr=p.X("string"==typeof Wn?[Wn,["accumulated"],["get",Nn]]:Wn);bt[Nn]=pi.value,tt[Nn]=cr.value}return Ne.map=Nn=>{jt.properties=Nn;const Wn={};for(const ii of pn)Wn[ii]=bt[ii].evaluate(Zt,jt);return Wn},Ne.reduce=(Nn,Wn)=>{jt.properties=Wn;for(const ii of pn)Zt.accumulated=Nn[ii],Nn[ii]=tt[ii].evaluate(Zt,jt)},Ne}(ae)).load(We.features):ae.dynamic?this._dynamicIndex:new gl(Ne=We,ae.geojsonVtOptions)}catch(Ne){return ge(Ne)}const Ge={};if(je){const Ne=En(Ae);Ne&&(Ge.resourceTiming={},Ge.resourceTiming[ae.source]=JSON.parse(JSON.stringify(Ne)))}ge(null,Ge)}var Ne})}reloadTile(ae,ge){const Ae=this.loaded;return Ae&&Ae[ae.uid]?ae.partial?ge(null,void 0):super.reloadTile(ae,ge):this.loadTile(ae,ge)}loadGeoJSON(ae,ge){if(ae.request)p.n(ae.request,ge);else{if("string"!=typeof ae.data)return ge(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));try{return ge(null,JSON.parse(ae.data))}catch{return ge(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ae,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Ae){ge(Ae)}}getClusterChildren(ae,ge){try{ge(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Ae){ge(Ae)}}getClusterLeaves(ae,ge){try{ge(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Ae){ge(Ae)}}}class Wt{constructor(ae,ge){this.tileID=new p.aM(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ae.projection,this.brightness=ge}parse(ae,ge,Ae,je){this.status="parsing";const Fe=new p.aM(Ae.tileID.overscaledZ,Ae.tileID.wrap,Ae.tileID.canonical.z,Ae.tileID.canonical.x,Ae.tileID.canonical.y),We=[],Ge=ge.familiesBySource[Ae.source],Ne=new p.f0(Fe,Ae.promoteId);Ne.bucketLayerIDs=[],Ne.is3DTile=!0,p.fi(ae).then(at=>{if(!at)return je(new Error("Could not parse tile"));const bt=p.fj(at,1/p.cT(Ae.tileID.canonical)),tt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,Zt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),jt=new p.aa(this.zoom,{brightness:this.brightness});for(const pn in Ge)for(const Nn of Ge[pn]){const Wn=Nn[0];Ne.bucketLayerIDs.push(Nn.map(pi=>p.C(pi.id,pi.scope))),Wn.recalculate(jt,[]);const ii=new p.fk(Nn,bt,Fe,tt,Zt,this.brightness,Ne);tt||(ii.needsUpload=!0),We.push(ii),ii.evaluate(Wn)}this.status="done",je(null,{buckets:We,featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(at=>je(new Error(at.message)))}}class jc{constructor(ae,ge,Ae,je,Fe,We,Ge){this.actor=ae,this.layerIndex=ge,this.availableImages=Ae,this.availableModels=je,this.brightness=Ge,this.loading={},this.loaded={}}loadTile(ae,ge){const Ae=ae.uid,je=this.loading[Ae]=new Wt(ae,this.brightness);p.br(ae.request,(Fe,We)=>{const Ge=!this.loading[Ae];return delete this.loading[Ae],Ge||Fe?(je.status="done",Ge||(this.loaded[Ae]=je),ge(Fe)):We&&0!==We.byteLength?void je.parse(We,this.layerIndex,ae,(Ne,at)=>{je.status="done",this.loaded=this.loaded||{},this.loaded[Ae]=je,Ne||!at?ge(Ne):ge(null,at)}):(je.status="done",this.loaded[Ae]=je,ge())})}reloadTile(ae,ge){const Ae=this.loaded,je=ae.uid;if(Ae&&Ae[je]){const Fe=Ae[je];Fe.projection=ae.projection,Fe.brightness=ae.brightness;const We=(Ge,Ne)=>{Fe.reloadCallback&&(delete Fe.reloadCallback,this.loadTile(ae,ge)),ge(Ge,Ne)};"parsing"===Fe.status?Fe.reloadCallback=We:"done"===Fe.status&&this.loadTile(ae,ge)}}abortTile(ae,ge){const Ae=ae.uid;this.loading[Ae]&&delete this.loading[Ae],ge()}removeTile(ae,ge){const Ae=this.loaded,je=ae.uid;Ae&&Ae[je]&&delete Ae[je],ge()}}class iu{constructor(ae){this.self=ae,this.actor=new p.fm(ae,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new p.y,this.projections={},this.defaultProjection=p.ce({name:"mercator"}),this.workerSourceTypes={vector:mr,geojson:Th,"raster-dem":Rr,"raster-array":No,"batched-model":jc},this.workerSources={},this.self.registerWorkerSource=(ge,Ae)=>{if(this.workerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.workerSourceTypes[ge]=Ae},this.self.registerRTLTextPlugin=ge=>{if(p.fn.isParsed())throw new Error("RTL text plugin already registered.");p.fn.applyArabicShaping=ge.applyArabicShaping,p.fn.processBidirectionalText=ge.processBidirectionalText,p.fn.processStyledBidirectionalText=ge.processStyledBidirectionalText}}clearCaches(ae,ge,Ae){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.availableModels[ae],delete this.workerSources[ae],Ae()}checkIfReady(ae,ge,Ae){Ae()}setReferrer(ae,ge){this.referrer=ge}spriteLoaded(ae,ge){this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={});const{scope:Ae,isLoaded:je}=ge;if(this.isSpriteLoaded[ae][Ae]=je,this.workerSources[ae]&&this.workerSources[ae][Ae])for(const Fe in this.workerSources[ae][Ae]){const We=this.workerSources[ae][Ae][Fe];for(const Ge in We){const Ne=We[Ge];Ne instanceof mr&&(Ne.isSpriteLoaded=je,Ne.fire(new p.A("isSpriteLoaded")))}}}setImages(ae,ge,Ae){this.availableImages[ae]||(this.availableImages[ae]={});const{scope:je,images:Fe}=ge;if(this.availableImages[ae][je]=Fe,this.workerSources[ae]&&this.workerSources[ae][je]){for(const We in this.workerSources[ae][je]){const Ge=this.workerSources[ae][je][We];for(const Ne in Ge)Ge[Ne].availableImages=Fe}Ae()}else Ae()}setModels(ae,{scope:ge,models:Ae},je){if(this.availableModels[ae]||(this.availableModels[ae]={}),this.availableModels[ae][ge]=Ae,this.workerSources[ae]&&this.workerSources[ae][ge]){for(const Fe in this.workerSources[ae][ge]){const We=this.workerSources[ae][ge][Fe];for(const Ge in We)We[Ge].availableModels=Ae}je()}else je()}setProjection(ae,ge){this.projections[ae]=p.ce(ge)}setBrightness(ae,ge,Ae){this.brightness=ge,Ae()}setLayers(ae,ge,Ae){this.getLayerIndex(ae,ge.scope).replace(ge.layers,ge.options),Ae()}updateLayers(ae,ge,Ae){this.getLayerIndex(ae,ge.scope).update(ge.layers,ge.removedIds,ge.options),Ae()}loadTile(ae,ge,Ae){ge.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,ge.type,ge.source,ge.scope).loadTile(ge,Ae)}decodeRasterArray(ae,ge,Ae){this.getWorkerSource(ae,ge.type,ge.source,ge.scope).decodeRasterArray(ge,Ae)}reloadTile(ae,ge,Ae){ge.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,ge.type,ge.source,ge.scope).reloadTile(ge,Ae)}abortTile(ae,ge,Ae){this.getWorkerSource(ae,ge.type,ge.source,ge.scope).abortTile(ge,Ae)}removeTile(ae,ge,Ae){this.getWorkerSource(ae,ge.type,ge.source,ge.scope).removeTile(ge,Ae)}removeSource(ae,ge,Ae){if(!(this.workerSources[ae]&&this.workerSources[ae][ge.scope]&&this.workerSources[ae][ge.scope][ge.type]&&this.workerSources[ae][ge.scope][ge.type][ge.source]))return;const je=this.workerSources[ae][ge.scope][ge.type][ge.source];delete this.workerSources[ae][ge.scope][ge.type][ge.source],void 0!==je.removeSource?je.removeSource(ge,Ae):Ae()}loadWorkerSource(ae,ge,Ae){try{this.self.importScripts(ge.url),Ae()}catch(je){Ae(je.toString())}}syncRTLPluginState(ae,ge,Ae){try{p.fn.setState(ge);const je=p.fn.getPluginURL();if(p.fn.isLoaded()&&!p.fn.isParsed()&&null!=je){this.self.importScripts(je);const Fe=p.fn.isParsed();Ae(Fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${je}`),Fe)}}catch(je){Ae(je.toString())}}setDracoUrl(ae,ge){this.dracoUrl=ge}getAvailableImages(ae,ge){this.availableImages[ae]||(this.availableImages[ae]={});let Ae=this.availableImages[ae][ge];return Ae||(Ae=[]),Ae}getAvailableModels(ae,ge){this.availableModels[ae]||(this.availableModels[ae]={});let Ae=this.availableModels[ae][ge];return Ae||(Ae={}),Ae}getLayerIndex(ae,ge){this.layerIndexes[ae]||(this.layerIndexes[ae]={});let Ae=this.layerIndexes[ae][ge];return Ae||(Ae=this.layerIndexes[ae][ge]=new cc,Ae.scope=ge),Ae}getWorkerSource(ae,ge,Ae,je){const Fe=this.workerSources;return Fe[ae]||(Fe[ae]={}),Fe[ae][je]||(Fe[ae][je]={}),Fe[ae][je][ge]||(Fe[ae][je][ge]={}),this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={}),Fe[ae][je][ge][Ae]||(Fe[ae][je][ge][Ae]=new this.workerSourceTypes[ge]({send:(We,Ge,Ne,at,bt,tt)=>this.actor.send(We,Ge,Ne,ae,bt,tt),scheduler:this.actor.scheduler},this.getLayerIndex(ae,je),this.getAvailableImages(ae,je),this.getAvailableModels(ae,je),this.isSpriteLoaded[ae][je],void 0,this.brightness)),Fe[ae][je][ge][Ae]}rasterizeImagesWorker(ae,ge,Ae){const je=new Map;for(const[Fe,{image:We,imageVariant:Ge}]of ge.tasks.entries()){const Ne=this.imageRasterizer.rasterize(Ge,We,ge.scope,ae);je.set(Fe,Ne)}Ae(void 0,je)}removeRasterizedImages(ae,ge,Ae){this.imageRasterizer.removeImagesFromCacheByIds(ge.imageIds,ge.scope,ae),Ae()}enforceCacheSizeLimit(ae,ge){p.fo(ge)}getWorkerPerformanceMetrics(ae,ge,Ae){Ae(void 0,void 0)}}return p.fl(self)&&(self.worker=new iu(self)),iu}),co(0,function(p){var En="3.12.0";const oi={create:"create",load:"load",fullLoad:"fullLoad"},Xl={mark(g){performance.mark(g)},measure(g,a,h){performance.measure(g,a,h)}};function cc(g){const a=g.name.split("?")[0];return p.a(a)&&a.includes("mapbox-gl.js")?"javascript":p.a(a)&&a.includes("mapbox-gl.css")?"css":p.b(a)?"fontRange":p.c(a)?"sprite":p.i(a)?"style":p.d(a)?"tilejson":"other"}var Qr,zt={},Fc=function(){if(Qr)return zt;function g(_){return!a(_)}function a(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,S,P=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(P);try{S=new Worker(O),M=!0}catch{M=!1}return S&&S.terminate(),URL.revokeObjectURL(O),M}()?function(){var M=document.createElement("canvas");M.width=M.height=1;var S=M.getContext("2d");if(!S)return!1;var P=S.getImageData(0,0,1,1);return P&&P.width===M.width}()?(void 0===h[w=_&&_.failIfMajorPerformanceCaveat]&&(h[w]=function(M){var S,O,V,U,P=(O=M,V=document.createElement("canvas"),(U=Object.create(g.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,V.getContext("webgl2",U));if(!P)return!1;try{S=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!S||P.isContextLost())&&(P.shaderSource(S,"void main() {}"),P.compileShader(S),!0===P.getShaderParameter(S,P.COMPILE_STATUS))}(w)),h[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}Qr=1,zt.supported=g,zt.notSupportedReason=a;var h={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},zt}();function Gn(g,a,h){const _=document.createElement(g);return null!=a&&(_.className=a),h&&h.appendChild(_),_}function mr(g,a,h){const _=document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(a))_.setAttributeNS(null,w,String(a[w]));return h&&h.appendChild(_),_}const Rr=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ho=Rr&&void 0!==Rr.userSelect?"userSelect":"WebkitUserSelect";let No;function Uo(){Rr&&ho&&(No=Rr[ho],Rr[ho]="none")}function Ya(){Rr&&ho&&(Rr[ho]=No)}function Pl(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",Pl,!0)}function xa(){window.addEventListener("click",Pl,!0),window.setTimeout(()=>{window.removeEventListener("click",Pl,!0)},0)}function Il(g,a){const h=g.getBoundingClientRect();return Ji(g,h,a)}function Xa(g,a){const h=g.getBoundingClientRect(),_=[];for(let w=0;w<a.length;w++)_.push(Ji(g,h,a[w]));return _}function zc(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===g.button&&g.ctrlKey?0:g.button}function Ji(g,a,h){const _=g.offsetWidth===a.width?1:g.offsetWidth/a.width;return new p.P((h.clientX-a.left)*_,(h.clientY-a.top)*_)}const Co="01",gr="NO_ACCESS_TOKEN";class Qn{constructor(a,h,_){this._transformRequestFn=a,this._customAccessToken=h,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const a=function(){let h="";for(let _=0;_<10;_++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Co,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,h){return this._transformRequestFn&&this._transformRequestFn(a,h)||{url:a}}normalizeStyleURL(a,h){if(!p.f(a))return a;const _=gs(a);return _.params.push(`sdk=js-${En}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeGlyphsURL(a,h){if(!p.f(a))return a;const _=gs(a);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeModelURL(a,h){if(!p.f(a))return a;const _=gs(a);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeSourceURL(a,h,_,w){if(!p.f(a))return a;const M=gs(a);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),_&&M.params.push(`language=${_}`),w&&M.params.push(`worldview=${w}`),this._makeAPIURL(M,this._customAccessToken||h)}normalizeIconsetURL(a,h){const _=gs(a);return p.f(a)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||h)):no(_)}normalizeSpriteURL(a,h,_,w){const M=gs(a);return p.f(a)?(M.path=`/styles/v1${M.path}/sprite${h}${_}`,this._makeAPIURL(M,this._customAccessToken||w)):(M.path+=`${h}${_}`,no(M))}normalizeTileURL(a,h,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!p.f(a))return a;const w=gs(a);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||_&&"raster"!==w.authority&&512===_?"@2x":""}${p.m.supported?".webp":"$1"}`),"raster"===w.authority?w.path=`/${p.e.RASTER_URL_PREFIX}${w.path}`:"rasterarrays"===w.authority?w.path=`/${p.e.RASTERARRAYS_URL_PREFIX}${w.path}`:"3dtiles"===w.authority?w.path=`/${p.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${p.e.TILE_URL_VERSION}${w.path}`);const M=this._customAccessToken||function(S){for(const P of S){const O=P.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(w.params)||p.e.ACCESS_TOKEN;return p.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,M)}canonicalizeTileURL(a,h){const _=gs(a);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return a;let w="mapbox://";_.path.match(/^\/raster\/v1\//)?w+=`raster/${_.path.replace(`/${p.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${_.path.replace(`/${p.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${_.path.replace(`/${p.e.TILE_URL_VERSION}/`,"")}`;let M=_.params;return h&&(M=M.filter(S=>!S.match(/^access_token=/))),M.length&&(w+=`?${M.join("&")}`),w}canonicalizeTileset(a,h){const _=!!h&&p.f(h),w=[];for(const M of a.tiles||[])p.h(M)?w.push(this.canonicalizeTileURL(M,_)):w.push(M);return w}_makeAPIURL(a,h){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=gs(p.e.API_URL);if(a.protocol=w.protocol,a.authority=w.authority,"http"===a.protocol){const M=a.params.indexOf("secure");M>=0&&a.params.splice(M,1)}if("/"!==w.path&&(a.path=`${w.path}${a.path}`),!p.e.REQUIRE_ACCESS_TOKEN)return no(a);if(h=h||p.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if("s"===h[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return a.params=a.params.filter(M=>-1===M.indexOf("access_token")),a.params.push(`access_token=${h||""}`),no(a)}}const Cr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gs(g){const a=g.match(Cr);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function no(g){const a=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${a}`}const wa="mapbox.eventData";function Pi(g){if(!g)return null;const a=g.split(".");if(!a||3!==a.length)return null;try{return JSON.parse(p.j(a[1]))}catch{return null}}class Jn{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const h=Pi(p.e.ACCESS_TOKEN);let _="";return _=h&&h.u?p.k(h.u):p.e.ACCESS_TOKEN||"",a?`${wa}.${a}:${_}`:`${wa}:${_}`}fetchEventData(){const a=p.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid");if(a)try{const w=localStorage.getItem(h);w&&(this.eventData=JSON.parse(w));const M=localStorage.getItem(_);M&&(this.anonId=M)}catch{p.w("Unable to read from LocalStorage")}}saveEventData(){const a=p.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid"),w=this.anonId;if(a&&w)try{localStorage.setItem(_,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData))}catch{p.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,h,_,w){if(!p.e.EVENTS_URL)return;const M=gs(p.e.EVENTS_URL);M.params.push(`access_token=${w||p.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(a).toISOString()},P=h?p.l(S,h):S,O={url:no(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=p.p(O,V=>{this.pendingRequest=null,_(V),this.saveEventData(),this.processRequests(w)})}queueRequest(a,h){this.queue.push(a),this.processRequests(h)}}const yi=new class extends Jn{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,a){p.e.EVENTS_URL&&p.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(h=>p.f(h)||p.h(h))&&this.queueRequest(Date.now(),a)}processRequests(g){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=Pi(p.e.ACCESS_TOKEN),h=a?a.u:p.e.ACCESS_TOKEN;let _=h!==this.eventData.tokenU;p.v(this.anonId)||(this.anonId=p.u(),_=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),S=new Date(w),P=(w-this.eventData.lastSuccess)/864e5;_=_||P>=1||P<-1||M.getDate()!==S.getDate()}else _=!0;_?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:En,skuId:Co,"enabled.telemetry":!1,userId:this.anonId},M=>{M||(this.eventData.lastSuccess=w,this.eventData.tokenU=h)},g):this.processRequests()}},Sr=yi.postTurnstileEvent.bind(yi),Yo=new class extends Jn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,a,h,_){this.skuToken=a,this.errorCb=_,p.e.EVENTS_URL&&(h||p.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(gr)))}processRequests(g){if(this.pendingRequest||0===this.queue.length)return;const{id:a,timestamp:h}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),p.v(this.anonId)||(this.anonId=p.u()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:En,skuId:Co,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},g))}remove(){this.errorCb=null}},Bo=Yo.postMapLoadEvent.bind(Yo),Sn=new class extends Jn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let a=this.mapInstanceIdMap.get(g);return a||(a=p.u(),this.mapInstanceIdMap.set(g,a)),a}getEventId(g){const a=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,a+1),a}postStyleLoadEvent(g,a){const{map:h,style:_,importedStyles:w}=a;if(!p.e.EVENTS_URL||!g&&!p.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(h),S={mapInstanceId:M,eventId:this.getEventId(M),style:_};w.length&&(S.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:S},g)}processRequests(g){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:a,payload:h}=this.queue.shift();this.postEvent(a,h,()=>{},g)}},ei=Sn.postStyleLoadEvent.bind(Sn),si=new class extends Jn{constructor(){super("gljs.performance")}postPerformanceEvent(g,a){p.e.EVENTS_URL&&(g||p.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},g)}processRequests(g){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:a,performanceData:h}=this.queue.shift(),_=function(w){const M=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),P=function(Q){const se={};if(Q)for(const oe in Q)if("other"!==oe)for(const de of Q[oe]){const le=`${oe}ResolveRangeMin`,be=`${oe}ResolveRangeMax`,Me=`${oe}RequestCount`,De=`${oe}RequestCachedCount`;se[le]=Math.min(se[le]||1/0,de.startTime),se[be]=Math.max(se[be]||-1/0,de.responseEnd);const Le=Ie=>{void 0===se[Ie]&&(se[Ie]=0),++se[Ie]};void 0!==de.transferSize&&0===de.transferSize&&Le(De),Le(Me)}return se}(function(Q,se){const oe={};if(Q)for(const de of Q){const le=se(de);void 0===oe[le]&&(oe[le]=[]),oe[le].push(de)}return oe}(M,cc)),O=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,U=V?V.effectiveType:void 0,X={counters:[],metadata:[],attributes:[]},G=(Q,se,oe)=>{null!=oe&&Q.push({name:se,value:oe.toString()})};for(const Q in P)G(X.counters,Q,P[Q]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(G(X.counters,"interactionRangeMin",w.interactionRange[0]),G(X.counters,"interactionRangeMax",w.interactionRange[1])),S)for(const Q of Object.keys(oi)){const se=oi[Q],oe=S.find(de=>de.name===se);oe&&G(X.counters,se,oe.startTime)}return G(X.counters,"visibilityHidden",w.visibilityHidden),G(X.attributes,"style",function(Q){if(Q)for(const se of Q){const oe=se.name.split("?")[0];if(p.i(oe)){const de=oe.split("/").slice(-2);if(2===de.length)return`mapbox://styles/${de[0]}/${de[1]}`}}}(M)),G(X.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),G(X.attributes,"fogEnabled",w.fogEnabled?"true":"false"),G(X.attributes,"projection",w.projection),G(X.attributes,"zoom",w.zoom),G(X.metadata,"devicePixelRatio",O),G(X.metadata,"connectionEffectiveType",U),G(X.metadata,"navigatorUserAgent",navigator.userAgent),G(X.metadata,"screenWidth",window.screen.width),G(X.metadata,"screenHeight",window.screen.height),G(X.metadata,"windowWidth",window.innerWidth),G(X.metadata,"windowHeight",window.innerHeight),G(X.metadata,"mapWidth",w.width/O),G(X.metadata,"mapHeight",w.height/O),G(X.metadata,"webglRenderer",w.renderer),G(X.metadata,"webglVendor",w.vendor),G(X.metadata,"sdkVersion",En),G(X.metadata,"sdkIdentifier","mapbox-gl-js"),X}(h);for(const w of _.metadata);for(const w of _.counters);for(const w of _.attributes);this.postEvent(a,_,()=>{},g)}},Lr=si.postPerformanceEvent.bind(si),ui=new class extends Jn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,a,h,_){if(!p.e.API_URL||!p.e.SESSION_PATH)return;const w=gs(p.e.API_URL+p.e.SESSION_PATH);w.params.push(`sku=${a||""}`),w.params.push(`access_token=${_||p.e.ACCESS_TOKEN||""}`);const M={url:no(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=p.g(M,S=>{this.pendingRequest=null,h(S),this.saveEventData(),this.processRequests(_)})}getSessionAPI(g,a,h,_){this.skuToken=a,this.errorCb=_,p.e.SESSION_PATH&&p.e.API_URL&&(h||p.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(gr)))}processRequests(g){if(this.pendingRequest||0===this.queue.length)return;const{id:a,timestamp:h}=this.queue.shift();a&&this.success[a]||this.getSession(h,this.skuToken,_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},g)}remove(){this.errorCb=null}},Nc=ui.getSessionAPI.bind(ui),zi=new Set;function As(g,a){a?zi.add(g):zi.delete(g)}class Vr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,h){this._updatedSourceCaches[a]=h,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const h=a.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(a.id),this.setDirty()}removeLayer(a){const h=a.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][a.id]=a,this._updatedLayers[h].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const h in this._updatedLayers)a[h]=a[h]||{},a[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)a[h]=a[h]||{},a[h].removedIds=Object.keys(this._removedLayers[h]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(p.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function dc(g){const{userImage:a}=g;return!!(a&&a.render&&a.render())&&(g.data.replace(new Uint8Array(a.data.buffer)),!0)}class Id extends p.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,"raster"!==a&&p.t()&&(this.imageRasterizerDispatcher=new p.D(p.x(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new p.r({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const h=this.atlasTexture.get(a);h&&(h.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(a.id,a)}removeImageProvider(a,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(a)}getPendingImageProviders(){const a=[];for(const h of this.imageProviders.values())for(const _ of h.values())_.hasPendingRequests()&&a.push(_);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new p.y),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,h){if(this.loaded.get(h)!==a&&(this.loaded.set(h,a),a)){for(const{ids:_,callback:w}of this.requestors)this._notify(_,h,w);this.requestors=[]}}hasImage(a,h){return!!this.getImage(a,h)}getImage(a,h){return this.images.get(h).get(a.toString())}addImage(a,h,_){this._validate(a,_)&&this.images.get(h).set(a.toString(),_)}_validate(a,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.z(new Error(`Image "${a.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.z(new Error(`Image "${a.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.z(new Error(`Image "${a.name}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(const w of a){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(a,h){return!a||!(4!==a.length||!h.usvg&&(a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]))&&!(a[2]<a[0]||a[3]<a[1])}updateImage(a,h,_){const w=this.images.get(h).get(a.toString());_.version=w.version+1,this.images.get(h).set(a.toString(),_),this.updatedImages.get(h).add(a),this.removeFromImageRasterizerCache(a,h)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,h){"raster"!==this.spriteFormat&&(p.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([a],h))}removeImage(a,h){const _=this.images.get(h),w=_.get(a.toString());_.delete(a.toString()),this.patterns.get(h).delete(a.toString()),this.removeFromImageRasterizerCache(a,h),w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(h=>p.I.from(h))}getImages(a,h,_){const w=[],M=[],S=this.imageProviders.get(h);for(const U of a){if(!U.iconsetId){w.push(U);continue}const X=S.get(U.iconsetId);X&&(this.getImage(U,h)?M.push(U):X.addPendingRequest(U))}if(0===w.length)return void this._notify(M,h,_);let P=!0;const O=!!this.loaded.get(h),V=this.images.get(h);if(!O)for(const U of w)V.has(U.toString())||(P=!1);O||P?this._notify(w,h,_):this.requestors.push({ids:w,scope:h,callback:_})}rasterizeImages(a,h){const _=new Map,{tasks:w,scope:M}=a;for(const[S,P]of w.entries()){const O=this.getImage(P.id,M);O&&_.set(S,{image:O,imageVariant:P})}this._rasterizeImages(M,_,h)}_rasterizeImages(a,h,_){if(p.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:a},_);else{const w=new Map;for(const[M,{image:S,imageVariant:P}]of h.entries())w.set(M,this.imageRasterizer.rasterize(P,S,a,0));_(void 0,w)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,h,_){const w=this.images.get(h),M=new Map;for(const S of a){if(!w.get(S.toString())){if(S.iconsetId)continue;this.fire(new p.A("styleimagemissing",{id:S.name}))}const P=w.get(S.toString());if(!P){p.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!(!P.userImage||!P.userImage.render)};P.usvg&&Object.assign(O,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),M.set(p.I.toString(S),O)}_(null,M)}getPixelSize(a){const{width:h,height:_}=this.atlasImage.get(a);return{width:h,height:_}}getPattern(a,h,_){const w=a.toString(),M=this.patterns.get(h),S=M.get(w),P=this.getImage(a,h);if(!P)return null;if(S){if(S.position.version===P.version)return S.position;S.position.version=P.version}else{if(P.usvg&&!P.data){const O=this.getPatternInFlightId(w,h);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const V=new p.B(a).scaleSelf(p.q.devicePixelRatio),U=new Map([[V.toString(),{image:P,imageVariant:V}]]);return this._rasterizeImages(h,U,(X,G)=>this.storePatternImage(V,h,P,_,G)),null}this.storePattern(a,h,P)}return this._updatePatternAtlas(h,_),M.get(w).position}getPatternInFlightId(a,h){return p.C(a,h)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(a,h,_,w,M){const S=a.toString(),P=M?M.get(S):void 0;P&&(_.data=P,this.storePattern(a.id,h,_),this._updatePatternAtlas(h,w),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),h)))}storePattern(a,h,_){const w={w:_.data.width+2*p.F,h:_.data.height+2*p.F,x:0,y:0},M=new p.G(w,_,p.F);this.patterns.get(h).set(a.toString(),{bin:w,position:M})}bind(a,h){const _=a.gl;let w=this.atlasTexture.get(h);w?this.dirty&&(w.update(this.atlasImage.get(h)),this.dirty=!1):(w=new p.T(a,this.atlasImage.get(h),_.RGBA8),this.atlasTexture.set(h,w)),w.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(a,h){const _=this.patterns.get(a),w=Array.from(_.values()).map(({bin:V})=>V),{w:M,h:S}=p.H(w),P=this.atlasImage.get(a);P.resize({width:M||1,height:S||1});const O=this.images.get(a);for(const[V,{bin:U,position:X}]of _.entries()){let G=X.padding;const Q=U.x+G,se=U.y+G,oe=O.get(V).data,de=oe.width,le=oe.height;G=G>1?G-1:G,p.r.copy(oe,P,{x:0,y:0},{x:Q,y:se},{width:de,height:le},h),p.r.copy(oe,P,{x:0,y:le-G},{x:Q,y:se-G},{width:de,height:G},h),p.r.copy(oe,P,{x:0,y:0},{x:Q,y:se+le},{width:de,height:G},h),p.r.copy(oe,P,{x:de-G,y:0},{x:Q-G,y:se},{width:G,height:le},h),p.r.copy(oe,P,{x:0,y:0},{x:Q+de,y:se},{width:G,height:le},h),p.r.copy(oe,P,{x:de-G,y:le-G},{x:Q-G,y:se-G},{width:G,height:G},h),p.r.copy(oe,P,{x:0,y:le-G},{x:Q+de,y:se-G},{width:G,height:G},h),p.r.copy(oe,P,{x:0,y:0},{x:Q+de,y:se+le},{width:G,height:G},h),p.r.copy(oe,P,{x:de-G,y:0},{x:Q-G,y:se+le},{width:G,height:G},h)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,h){const _=this.images.get(h);for(const w of a){if(this.callbackDispatchedThisFrame.get(h).has(w.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(w.toString());const M=_.get(w.toString());dc(M)&&this.updateImage(w,h,M)}}}function go(g){const a=g.key,h=g.value,_=g.valueSpec||{},w=g.objectElementValidators||{},M=g.style,S=g.styleSpec;let P=[];const O=p.K(h);if("object"!==O)return[new p.V(a,h,`object expected, ${O} found`)];for(const V in h){const U=V.split(".")[0];let X;w[U]?X=w[U]:_[U]?X=lr:w["*"]?X=w["*"]:_["*"]&&(X=lr),X?P=P.concat(X({key:(a&&`${a}.`)+V,value:h[V],valueSpec:_[U]||_["*"],style:M,styleSpec:S,object:h,objectKey:V},h)):P.push(new p.J(a,h[V],`unknown property "${V}"`))}for(const V in _)w[V]||_[V].required&&void 0===_[V].default&&void 0===h[V]&&P.push(new p.V(a,h,`missing required property "${V}"`));return P}function Gs(g){const a=g.value,h=g.valueSpec,_=g.style,w=g.styleSpec,M=g.key,S=g.arrayElementValidator||lr;if("array"!==p.K(a))return[new p.V(M,a,`array expected, ${p.K(a)} found`)];if(h.length&&a.length!==h.length)return[new p.V(M,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new p.V(M,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let P={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};w.$version<7&&(P.function=h.function),"object"===p.K(h.value)&&(P=h.value);let O=[];for(let V=0;V<a.length;V++)O=O.concat(S({array:a,arrayIndex:V,value:a[V],valueSpec:P,style:_,styleSpec:w,key:`${M}[${V}]`},!0));return O}function hc(g){const a=g.key,h=g.value,_=g.valueSpec;let w=p.K(h);if("number"===w&&h!=h&&(w="NaN"),"number"!==w)return[new p.V(a,h,`number expected, ${w} found`)];if("minimum"in _){let M=_.minimum;if("array"===p.K(_.minimum)&&(M=_.minimum[g.arrayIndex]),h<M)return[new p.V(a,h,`${h} is less than the minimum value ${M}`)]}if("maximum"in _){let M=_.maximum;if("array"===p.K(_.maximum)&&(M=_.maximum[g.arrayIndex]),h>M)return[new p.V(a,h,`${h} is greater than the maximum value ${M}`)]}return[]}function _o(g){const a=g.valueSpec,h=p.M(g.value.type);let _,w,M,S={};const P="categorical"!==h&&void 0===g.value.property,O=!P,V="array"===p.K(g.value.stops)&&"array"===p.K(g.value.stops[0])&&"object"===p.K(g.value.stops[0][0]),U=go({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Q){if("identity"===h)return[new p.V(Q.key,Q.value,'identity function may not have a "stops" property')];let se=[];const oe=Q.value;return se=se.concat(Gs({key:Q.key,value:oe,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:X})),"array"===p.K(oe)&&0===oe.length&&se.push(new p.V(Q.key,oe,"array must have at least one stop")),se},default:function(Q){return lr({key:Q.key,value:Q.value,valueSpec:a,style:Q.style,styleSpec:Q.styleSpec})}}});return"identity"===h&&P&&U.push(new p.V(g.key,g.value,'missing required property "property"')),"identity"===h||g.value.stops||U.push(new p.V(g.key,g.value,'missing required property "stops"')),"exponential"===h&&g.valueSpec.expression&&!p.N(g.valueSpec)&&U.push(new p.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(O&&!p.O(g.valueSpec)?U.push(new p.V(g.key,g.value,"property functions not supported")):P&&!p.Q(g.valueSpec)&&U.push(new p.V(g.key,g.value,"zoom functions not supported"))),"categorical"!==h&&!V||void 0!==g.value.property||U.push(new p.V(g.key,g.value,'"property" property is required')),U;function X(Q){let se=[];const oe=Q.value,de=Q.key;if("array"!==p.K(oe))return[new p.V(de,oe,`array expected, ${p.K(oe)} found`)];if(2!==oe.length)return[new p.V(de,oe,`array length 2 expected, length ${oe.length} found`)];if(V){if("object"!==p.K(oe[0]))return[new p.V(de,oe,`object expected, ${p.K(oe[0])} found`)];if(void 0===oe[0].zoom)return[new p.V(de,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new p.V(de,oe,"object stop key must have value")];const le=p.M(oe[0].zoom);if("number"!=typeof le)return[new p.V(de,oe[0].zoom,"stop zoom values must be numbers")];if(M&&M>le)return[new p.V(de,oe[0].zoom,"stop zoom values must appear in ascending order")];le!==M&&(M=le,w=void 0,S={}),se=se.concat(go({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:hc,value:G}}))}else se=se.concat(G({key:`${de}[0]`,value:oe[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},oe));return p.S(p.U(oe[1]))?se.concat([new p.V(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):se.concat(lr({key:`${de}[1]`,value:oe[1],valueSpec:a,style:Q.style,styleSpec:Q.styleSpec}))}function G(Q,se){const oe=p.K(Q.value),de=p.M(Q.value),le=null!==Q.value?Q.value:se;if(_){if(oe!==_)return[new p.V(Q.key,le,`${oe} stop domain type must match previous stop domain type ${_}`)]}else _=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe&&"number"!=typeof de&&"string"!=typeof de&&"boolean"!=typeof de)return[new p.V(Q.key,le,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==h){let be=`number expected, ${oe} found`;return p.O(a)&&void 0===h&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new p.V(Q.key,le,be)]}return"categorical"!==h||"number"!==oe||"number"==typeof de&&isFinite(de)&&Math.floor(de)===de?"categorical"!==h&&"number"===oe&&"number"==typeof de&&"number"==typeof w&&void 0!==w&&de<w?[new p.V(Q.key,le,"stop domain values must appear in ascending order")]:(w=de,"categorical"===h&&de in S?[new p.V(Q.key,le,"stop domain values must be unique")]:(S[de]=!0,[])):[new p.V(Q.key,le,`integer expected, found ${String(de)}`)]}}function Ka(g){const a=("property"===g.expressionContext?p.W:p.X)(p.U(g.value),g.valueSpec);if("error"===a.result)return a.value.map(_=>new p.V(`${g.key}${_.key}`,g.value,_.message));const h=a.value.expression||a.value._styleExpression.expression;if("property"===g.expressionContext&&"text-font"===g.propertyKey&&!h.outputDefined())return[new p.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===g.expressionContext&&"layout"===g.propertyType&&!p.Y(h))return[new p.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===g.expressionContext)return uc(h,g);if(g.expressionContext&&0===g.expressionContext.indexOf("cluster")){if(!p.Z(h,["zoom","feature-state"]))return[new p.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===g.expressionContext&&!p._(h))return[new p.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(g,a){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const w of a.valueSpec.expression.parameters)h.delete(w);if(0===h.size)return[];const _=[];return g instanceof p.$&&h.has(g.name)?[new p.V(a.key,a.value,`["${g.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(g.eachChild(w=>{_.push(...uc(w,a))}),_)}function Ol(g){const a=g.key,h=g.value,_=g.valueSpec,w=[];return Array.isArray(_.values)?-1===_.values.indexOf(p.M(h))&&w.push(new p.V(a,h,`expected one of [${_.values.join(", ")}], ${JSON.stringify(h)} found`)):-1===Object.keys(_.values).indexOf(p.M(h))&&w.push(new p.V(a,h,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(h)} found`)),w}function _r(g){return p.a1(p.U(g.value))?Ka(p.L({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Io(g)}function Io(g){const a=g.value,h=g.key;if("array"!==p.K(a))return[new p.V(h,a,`array expected, ${p.K(a)} found`)];const _=g.styleSpec;let w,M=[];if(a.length<1)return[new p.V(h,a,"filter array must have at least 1 element")];switch(M=M.concat(Ol({key:`${h}[0]`,value:a[0],valueSpec:_.filter_operator,style:g.style,styleSpec:g.styleSpec})),p.M(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&"$type"===p.M(a[1])&&M.push(new p.V(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":3!==a.length&&M.push(new p.V(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(w=p.K(a[1]),"string"!==w&&M.push(new p.V(`${h}[1]`,a[1],`string expected, ${w} found`)));for(let S=2;S<a.length;S++)w=p.K(a[S]),"$type"===p.M(a[1])?M=M.concat(Ol({key:`${h}[${S}]`,value:a[S],valueSpec:_.geometry_type,style:g.style,styleSpec:g.styleSpec})):"string"!==w&&"number"!==w&&"boolean"!==w&&M.push(new p.V(`${h}[${S}]`,a[S],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)M=M.concat(Io({key:`${h}[${S}]`,value:a[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":w=p.K(a[1]),2!==a.length?M.push(new p.V(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):"string"!==w&&M.push(new p.V(`${h}[1]`,a[1],`string expected, ${w} found`))}return M}function ls(g,a){const h=g.key,_=g.style,w=g.layer,M=g.styleSpec,S=g.value,P=g.objectKey,O=M[`${a}_${g.layerType}`];if(!O)return[];const V=P.match(/^(.*)-use-theme$/);if("paint"===a&&V&&O[V[1]])return p.S(S)?[].concat(lr({key:g.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:M,expressionContext:"property",propertyType:a,propertyKey:P})):lr({key:h,value:S,valueSpec:{type:"string"},style:_,styleSpec:M});const U=P.match(/^(.*)-transition$/);if("paint"===a&&U&&O[U[1]]&&O[U[1]].transition)return lr({key:h,value:S,valueSpec:M.transition,style:_,styleSpec:M});const X=g.valueSpec||O[P];if(!X)return[new p.J(h,S,`unknown property "${P}"`)];let G;if("string"===p.K(S)&&p.O(X)&&!X.tokens&&(G=/^{([^}]+)}$/.exec(S))){const se=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new p.V(h,S,`"${P}" does not support interpolation syntax\nUse an identity property function instead: ${se}.`)]}const Q=[];if("symbol"===g.layerType)"text-field"!==P||!_||_.glyphs||_.imports||Q.push(new p.V(h,S,'use of "text-field" requires a style "glyphs" property')),"text-font"===P&&p.a2(p.U(S))&&"identity"===p.M(S.type)&&Q.push(new p.V(h,S,'"text-font" does not support identity functions'));else if("model"===g.layerType&&"paint"===a&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&p.O(X)&&(p.a3(X)||p.Q(X))){const se=p.W(p.U(S),X),oe=se.value.expression||se.value._styleExpression.expression;oe&&!p.Z(oe,["measure-light"])&&("model-emissive-strength"===P&&p._(oe)&&p.Y(oe)||Q.push(new p.V(h,S,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(lr({key:g.key,value:S,valueSpec:X,style:_,styleSpec:M,expressionContext:"property",propertyType:a,propertyKey:P}))}function Kl(g){return ls(g,"paint")}function So(g){return ls(g,"layout")}function Ko(g){let a=[];const h=g.value,_=g.key,w=g.style,M=g.styleSpec;h.type||h.ref||a.push(new p.V(_,h,'either "type" or "ref" is required'));let S=p.M(h.type);const P=p.M(h.ref);if(h.id){const O=p.M(h.id);for(let V=0;V<g.arrayIndex;V++){const U=w.layers[V];p.M(U.id)===O&&a.push(new p.V(_,h.id,`duplicate layer id "${h.id}", previously used at line ${U.id.__line__}`))}}if("ref"in h){let O;["type","source","source-layer","filter","layout"].forEach(V=>{V in h&&a.push(new p.V(_,h[V],`"${V}" is prohibited for ref layers`))}),w.layers.forEach(V=>{p.M(V.id)===P&&(O=V)}),O?O.ref?a.push(new p.V(_,h.ref,"ref cannot reference another ref layer")):S=p.M(O.type):"string"==typeof P&&a.push(new p.V(_,h.ref,`ref layer "${P}" not found`))}else if("background"!==S&&"sky"!==S&&"slot"!==S)if(h.source){const O=w.sources&&w.sources[h.source],V=O&&p.M(O.type);O?"vector"===V&&"raster"===S?a.push(new p.V(_,h.source,`layer "${h.id}" requires a raster source`)):"raster"===V&&"raster"!==S?a.push(new p.V(_,h.source,`layer "${h.id}" requires a vector source`)):"vector"!==V||h["source-layer"]?"raster-dem"===V&&"hillshade"!==S?a.push(new p.V(_,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==V||["raster","raster-particle"].includes(S)?"line"===S&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&"geojson"===V&&!O.lineMetrics?a.push(new p.V(_,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):"raster-particle"===S&&"raster-array"!==V&&a.push(new p.V(_,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):a.push(new p.V(_,h.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new p.V(_,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new p.V(_,h.source,`source "${h.source}" not found`))}else a.push(new p.V(_,h,'missing required property "source"'));return a=a.concat(go({key:_,value:h,valueSpec:M.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lr({key:`${_}.type`,value:h.type,valueSpec:M.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:O=>_r(p.L({layerType:S},O)),layout:O=>go({layer:h,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":V=>So(p.L({layerType:S},V))}}),paint:O=>go({layer:h,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":V=>Kl(p.L({layerType:S,layer:h},V))}})}})),a}function fl(g){const a=g.value,h=g.key,_=p.K(a);return"string"!==_?[new p.V(h,a,`string expected, ${_} found`)]:[]}const pc={promoteId:function g({key:a,value:h}){if("string"===p.K(h))return fl({key:a,value:h});if(Array.isArray(h)){const _=[],w=p.U(h),M=p.X(w);return"error"===M.result&&M.value.forEach(S=>{_.push(new p.V(`${a}${S.key}`,null,`${S.message}`))}),p.Z(M.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new p.V(`${a}`,null,"promoteId expression should be only feature dependent")),_}{const _=[];for(const w in h)_.push(...g({key:`${a}.${w}`,value:h[w]}));return _}}};function Ss(g){const a=g.value,h=g.key,_=g.styleSpec,w=g.style;if(!a.type)return[new p.V(h,a,'"type" is required')];const M=p.M(a.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&(a.url||a.tiles||S.push(new p.J(h,a,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(go({key:h,value:a,valueSpec:_[`source_${M.replace("-","_")}`],style:g.style,styleSpec:_,objectElementValidators:pc})),S;case"geojson":if(S=go({key:h,value:a,valueSpec:_.source_geojson,style:w,styleSpec:_,objectElementValidators:pc}),a.cluster)for(const P in a.clusterProperties){const[O,V]=a.clusterProperties[P],U="string"==typeof O?[O,["accumulated"],["get",P]]:O;S.push(...Ka({key:`${h}.${P}.map`,value:V,expressionContext:"cluster-map"})),S.push(...Ka({key:`${h}.${P}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return S;case"video":return go({key:h,value:a,valueSpec:_.source_video,style:w,styleSpec:_});case"image":return go({key:h,value:a,valueSpec:_.source_image,style:w,styleSpec:_});case"canvas":return[new p.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ol({key:`${h}.type`,value:a.type,valueSpec:{values:Eo(_)},style:w,styleSpec:_})}}function Eo(g){return g.source.reduce((a,h)=>{const _=g[h];return"enum"===_.type.type&&(a=a.concat(Object.keys(_.type.values))),a},[])}function Bc(g){const a=g.value,h=g.styleSpec,_=h.light,w=g.style;let M=[];const S=p.K(a);if(void 0===a)return M;if("object"!==S)return M=M.concat([new p.V("light",a,`object expected, ${S} found`)]),M;for(const P in a){const O=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);M=M.concat(V&&_[V[1]]?lr({key:P,value:a[P],valueSpec:{type:"string"},style:w,styleSpec:h}):O&&_[O[1]]&&_[O[1]].transition?lr({key:P,value:a[P],valueSpec:h.transition,style:w,styleSpec:h}):_[P]?lr({key:P,value:a[P],valueSpec:_[P],style:w,styleSpec:h}):[new p.V(P,a[P],`unknown property "${P}"`)])}return M}function ml(g){const a=g.value;let h=[];if(!a)return h;const _=p.K(a);if("object"!==_)return h=h.concat([new p.V("light-3d",a,`object expected, ${_} found`)]),h;const w=g.styleSpec,M=w["light-3d"],S=g.key,P=g.style,O=g.style.lights;for(const X of["type","id"])if(!(X in a))return h=h.concat([new p.V("light-3d",a,`missing property ${X} on light`)]),h;if(a.type&&O)for(let X=0;X<g.arrayIndex;X++){const G=p.M(a.type),Q=O[X];p.M(Q.type)===G&&h.push(new p.V(S,a.id,`duplicate light type "${a.type}", previously defined at line ${Q.id.__line__}`))}const V=`properties_light_${a.type}`;if(!(V in w))return h=h.concat([new p.V("light-3d",a,`Invalid light type ${a.type}`)]),h;const U=w[V];for(const X in a)if("properties"===X){const G=a[X],Q=p.K(G);if("object"!==Q)return h=h.concat([new p.V("properties",G,`object expected, ${Q} found`)]),h;for(const se in G)h=h.concat(U[se]?lr({key:se,value:G[se],valueSpec:U[se],style:P,styleSpec:w}):[new p.J(g.key,G[se],`unknown property "${se}"`)])}else{const G=X.match(/^(.*)-transition$/),Q=X.match(/^(.*)-use-theme$/);h=h.concat(Q&&M[Q[1]]?lr({key:X,value:a[X],valueSpec:{type:"string"},style:P,styleSpec:w}):G&&M[G[1]]&&M[G[1]].transition?lr({key:X,value:a[X],valueSpec:w.transition,style:P,styleSpec:w}):M[X]?lr({key:X,value:a[X],valueSpec:M[X],style:P,styleSpec:w}):[new p.J(X,a[X],`unknown property "${X}"`)])}return h}function fc(g){const a=g.value,h=g.key,_=g.style,w=g.styleSpec,M=w.terrain;let S=[];const P=p.K(a);if(void 0===a||"null"===P)return S;if("object"!==P)return S=S.concat([new p.V("terrain",a,`object expected, ${P} found`)]),S;for(const O in a){const V=O.match(/^(.*)-transition$/),U=O.match(/^(.*)-use-theme$/);S=S.concat(U&&M[U[1]]?lr({key:O,value:a[O],valueSpec:{type:"string"},style:_,styleSpec:w}):V&&M[V[1]]&&M[V[1]].transition?lr({key:O,value:a[O],valueSpec:w.transition,style:_,styleSpec:w}):M[O]?lr({key:O,value:a[O],valueSpec:M[O],style:_,styleSpec:w}):[new p.J(O,a[O],`unknown property "${O}"`)])}if(a.source){const O=_.sources&&_.sources[a.source],V=O&&p.M(O.type);O?"raster-dem"!==V&&S.push(new p.V(h,a.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):S.push(new p.V(h,a.source,`source "${a.source}" not found`))}else S.push(new p.V(h,a,'terrain is missing required property "source"'));return S}function Vc(g){const a=g.value,h=g.style,_=g.styleSpec,w=_.fog;let M=[];const S=p.K(a);if(void 0===a)return M;if("object"!==S)return M=M.concat([new p.V("fog",a,`object expected, ${S} found`)]),M;for(const P in a){const O=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);M=M.concat(V&&w[V[1]]?lr({key:P,value:a[P],valueSpec:{type:"string"},style:h,styleSpec:_}):O&&w[O[1]]&&w[O[1]].transition?lr({key:P,value:a[P],valueSpec:_.transition,style:h,styleSpec:_}):w[P]?lr({key:P,value:a[P],valueSpec:w[P],style:h,styleSpec:_}):[new p.J(P,a[P],`unknown property "${P}"`)])}return M}const Od={"*":()=>[],array:Gs,boolean:function(g){const a=g.value,h=g.key,_=p.K(a);return"boolean"!==_?[new p.V(h,a,`boolean expected, ${_} found`)]:[]},number:hc,color:function(g){const a=g.key,h=g.value,_=p.K(h);return"string"!==_?[new p.V(a,h,`color expected, ${_} found`)]:null===p.a0.parseCSSColor(h)?[new p.V(a,h,`color expected, "${h}" found`)]:[]},enum:Ol,filter:_r,function:_o,layer:Ko,object:go,source:Ss,model:p.a4,light:Bc,"light-3d":ml,terrain:fc,fog:Vc,string:fl,formatted:function(g){return 0===fl(g).length?[]:Ka(g)},resolvedImage:function(g){return 0===fl(g).length?[]:Ka(g)},projection:function(g){const a=g.value,h=g.styleSpec,_=h.projection,w=g.style;let M=[];const S=p.K(a);if("object"===S)for(const P in a)M=M.concat(lr({key:P,value:a[P],valueSpec:_[P],style:w,styleSpec:h}));else"string"!==S&&(M=M.concat([new p.V("projection",a,`object or string expected, ${S} found`)]));return M},import:function(g){const{value:a,styleSpec:h}=g,{data:_,...w}=a;Object.defineProperty(w,"__line__",{value:a.__line__,enumerable:!1});let M=go(p.L({},g,{value:w,valueSpec:h.import}));return""===p.M(w.id)&&M.push(new p.V(`${g.key}.id`,w,"import id can't be an empty string")),_&&(M=M.concat(nh(_,h,{key:`${g.key}.data`}))),M},iconset:function(g){const a=g.value,h=g.key,_=g.styleSpec,w=g.style;if(!a.type)return[new p.V(h,a,'"type" is required')];const M=p.M(a.type);let S=[];if(S=S.concat(go({key:h,value:a,valueSpec:_[`iconset_${M}`],style:w,styleSpec:_})),"source"===M&&a.source){const P=w.sources&&w.sources[a.source],O=P&&p.M(P.type);P?"raster-array"!==O&&S.push(new p.V(h,a.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):S.push(new p.V(h,a.source,`source "${a.source}" not found`))}return S}};function lr(g,a=!1){const h=g.value,_=g.valueSpec,w=g.styleSpec;if(_.expression&&p.a2(p.M(h)))return _o(g);if(_.expression&&p.S(p.U(h)))return Ka(g);if(_.type&&Od[_.type]){const M=Od[_.type](g);return!0===a&&M.length>0&&"array"===p.K(g.value)?Ka(g):M}return go(p.L({},g,{valueSpec:_.type?w[_.type]:_}))}function mc(g){const a=g.value,h=g.key,_=fl(g);return _.length||(-1===a.indexOf("{fontstack}")&&_.push(new p.V(h,a,'"glyphs" url must include a "{fontstack}" token')),-1===a.indexOf("{range}")&&_.push(new p.V(h,a,'"glyphs" url must include a "{range}" token'))),_}function nh(g,a=p.a5,h={}){return lr({key:h.key||"",value:g,valueSpec:a.$root,styleSpec:a,style:g,objectElementValidators:{glyphs:mc,"*":()=>[]}})}function gl(g,a=p.a5){return We(nh(g,a))}const Rl=g=>We(Ss(g)),Dh=g=>We(Bc(g)),Th=g=>We(ml(g)),Wt=g=>We(fc(g)),jc=g=>We(Vc(g)),iu=g=>We(function(a){const h=a.value,_=a.style,w=a.styleSpec,M=w.snow;let S=[];const P=p.K(h);if(void 0===h)return S;if("object"!==P)return S=S.concat([new p.V("snow",h,`object expected, ${P} found`)]),S;for(const O in h){const V=O.match(/^(.*)-transition$/);S=S.concat(V&&M[V[1]]&&M[V[1]].transition?lr({key:O,value:h[O],valueSpec:w.transition,style:_,styleSpec:w}):M[O]?lr({key:O,value:h[O],valueSpec:M[O],style:_,styleSpec:w}):[new p.J(O,h[O],`unknown property "${O}"`)])}return S}(g)),mt=g=>We(function(a){const h=a.value,_=a.style,w=a.styleSpec,M=w.rain;let S=[];const P=p.K(h);if(void 0===h)return S;if("object"!==P)return S=S.concat([new p.V("rain",h,`object expected, ${P} found`)]),S;for(const O in h){const V=O.match(/^(.*)-transition$/);S=S.concat(V&&M[V[1]]&&M[V[1]].transition?lr({key:O,value:h[O],valueSpec:w.transition,style:_,styleSpec:w}):M[O]?lr({key:O,value:h[O],valueSpec:M[O],style:_,styleSpec:w}):[new p.J(O,h[O],`unknown property "${O}"`)])}return S}(g)),ae=g=>We(Ko(g)),ge=g=>We(_r(g)),Ae=g=>We(Kl(g)),je=g=>We(So(g)),Fe=g=>We(p.a4(g));function We(g){return g.slice().sort((a,h)=>a.line&&h.line?a.line-h.line:0)}function Ge(g,a){let h=!1;if(a&&a.length)for(const _ of a)_ instanceof p.J?p.w(_.message):(g.fire(new p.z(new Error(_.message))),h=!0);return h}let Ne;class at extends p.E{constructor(a,h="flat"){super(),this._transitionable=new p.a6(Ne||(Ne=new p.a7({anchor:new p.a8(p.a5.light.anchor),position:new p.a9(p.a5.light.position),color:new p.a8(p.a5.light.color),intensity:new p.a8(p.a5.light.intensity)}))),this.setLight(a,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h,_={}){this._validate(Dh,a,_)||(this._transitionable.setTransitionOrValue(a),this.id=h)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&Ge(this,a.call(gl,p.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.a5})))}}let bt=class extends p.E{constructor(g,a,h,_){super(),this.scope=h,this._transitionable=new p.a6(new p.a7({source:new p.a8(p.a5.terrain.source),exaggeration:new p.a8(p.a5.terrain.exaggeration)}),h,_),this._transitionable.setTransitionOrValue(g,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(g,a){this._transitionable.setTransitionOrValue(g,a)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new p.aa(g)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const a=g.value.expression;if(!a)return null;let h=-1,_=-1,w=1;for(const M of a.zoomStops)w=a.evaluate(new p.aa(M)),w>.01?(h=M,_=-1):_=M;return w<.01&&h>0&&_>h?[h,_]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return null!=g&&null!=g.value&&null!=g.value.expression&&g.value.expression instanceof p.ab}};const tt=45,Zt=65,jt=.05;function pn(g,a,h,_){const w=p.af(tt,Zt,h),[M,S]=Nn(g,_);let P=1-Math.min(1,Math.exp((a-M)/(S-M)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*w*g.alpha}function Nn(g,a){const h=.5/Math.tan(.5*a);return[g.range[0]+h,g.range[1]+h]}function Wn(g,a,h,_,w){const M=p.ad([],[a,h,_],w.mercatorFogMatrix);return pn(g,p.ae(M),w.pitch,w._fov)}function ii(g,a,h,_,w,M,S){const P=[[h,_,0],[w,_,0],[w,M,0],[h,M,0]];let O=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const U of P){const X=p.ad([],U,a),G=p.ae(X);O=Math.min(O,G),V=Math.max(V,G)}return[pn(g,O,S.pitch,S._fov),pn(g,V,S.pitch,S._fov)]}class pi extends p.E{constructor(a,h,_,w){super();const M=new p.a7({range:new p.a8(p.a5.fog.range),color:new p.a8(p.a5.fog.color),"color-use-theme":new p.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new p.a8(p.a5.fog["high-color"]),"high-color-use-theme":new p.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new p.a8(p.a5.fog["space-color"]),"space-color-use-theme":new p.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new p.a8(p.a5.fog["horizon-blend"]),"star-intensity":new p.a8(p.a5.fog["star-intensity"]),"vertical-range":new p.a8(p.a5.fog["vertical-range"])});this._transitionable=new p.a6(M,_,new Map(w)),this.set(a,w),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new p.ag(M),this.scope=_}get state(){const a=this._transform,h="globe"===a.projection.name,_=p.ah(a.zoom),w=this.properties.get("range"),M=[.5,3];return{range:h?[p.ai(M[0],w[0],_),p.ai(M[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h,_={}){if(this._validate(jc,a,_))return;const w=p.l({},a);for(const M of Object.keys(p.a5.fog))void 0===w[M]&&(w[M]=p.a5.fog[M].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.af(tt,Zt,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(_,w,M){const S=p.ac.fromLngLat(w),P=M.elevation?M.elevation.getAtPointOrZero(S):0;return Wn(_,S.x,S.y,P,M)}(this.state,a,h):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(a.toUnwrapped());return ii(this.state,h,0,0,p.aj,p.aj,this._transform)}getOpacityForBounds(a,h,_,w,M){return this._transform.projection.supportsFog?ii(this.state,a,h,_,w,M,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Nn(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const _ of h){const w=a.points[_];let M;if(w[2]>=0)M=w;else{const S=a.points[_-4];M=p.ak(S,w,S[2]/(S[2]-w[2]))}if(Wn(this.state,M[0],M[1],0,this._transform)>=jt)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&Ge(this,a.call(gl,p.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.a5})))}}let cr,ci,fi,ki,Si=class extends p.E{constructor(g,a,h,_){super();const w=cr||(cr=new p.a7({density:new p.a8(p.a5.snow.density),intensity:new p.a8(p.a5.snow.intensity),color:new p.a8(p.a5.snow.color),opacity:new p.a8(p.a5.snow.opacity),vignette:new p.a8(p.a5.snow.vignette),"vignette-color":new p.a8(p.a5.snow["vignette-color"]),"center-thinning":new p.a8(p.a5.snow["center-thinning"]),direction:new p.a8(p.a5.snow.direction),"flake-size":new p.a8(p.a5.snow["flake-size"])}));this._transitionable=new p.a6(w,h,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new p.ag(w),this.scope=h}get state(){const g=this.properties.get("opacity"),a=this.properties.get("color"),h=this.properties.get("direction"),_=p.al(h[0]),w=-Math.max(p.al(h[1]),.01),M=[Math.cos(_)*Math.cos(w),Math.sin(_)*Math.cos(w),Math.sin(w)],S=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new p.am(a.r,a.g,a.b,a.a*g),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(g,a,h={}){if(this._validate(iu,g,h))return;const _=p.l({},g);for(const w of Object.keys(p.a5.snow))void 0===_[w]&&(_[w]=p.a5.snow[w].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,a,h){return(!h||!1!==h.validate)&&Ge(this,g.call(gl,p.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:p.a5})))}},wi=class extends p.E{constructor(g,a,h,_){super();const w=ci||(ci=new p.a7({density:new p.a8(p.a5.rain.density),intensity:new p.a8(p.a5.rain.intensity),color:new p.a8(p.a5.rain.color),opacity:new p.a8(p.a5.rain.opacity),vignette:new p.a8(p.a5.rain.vignette),"vignette-color":new p.a8(p.a5.rain["vignette-color"]),"center-thinning":new p.a8(p.a5.rain["center-thinning"]),direction:new p.a8(p.a5.rain.direction),"droplet-size":new p.a8(p.a5.rain["droplet-size"]),"distortion-strength":new p.a8(p.a5.rain["distortion-strength"])}));this._transitionable=new p.a6(w,h,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new p.ag(w),this.scope=h}get state(){const g=this.properties.get("opacity"),a=this.properties.get("color"),h=this.properties.get("direction"),_=p.al(h[0]),w=-Math.max(p.al(h[1]),.01),M=[Math.cos(_)*Math.cos(w),Math.sin(_)*Math.cos(w),Math.sin(w)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new p.am(a.r,a.g,a.b,a.a*g),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(g,a,h={}){if(this._validate(mt,g,h))return;const _=p.l({},g);for(const w of Object.keys(p.a5.rain))void 0===_[w]&&(_[w]=p.a5.rain[w].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,a,h){return(!h||!1!==h.validate)&&Ge(this,g.call(gl,p.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:p.a5})))}};class Do extends p.E{constructor(a,h,_,w){super(),this.scope=_,this._options=a,this.properties=new p.ag(h),this._transitionable=new p.a6(h,_,new Map(w)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,h){this._options=a,this._transitionable.setTransitionOrValue(a.properties,h)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class qo{constructor(a,h,_,w){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(a,h){let _,w;if(a instanceof p.P||"number"==typeof a[0]){const M=p.P.convert(a);_=[M],w=h.isPointAboveHorizon(M)}else{const M=p.P.convert(a[0]),S=p.P.convert(a[1]),P=M.add(S)._div(2);_=[M,S],w=p.ao(M,S).every(O=>h.isPointAboveHorizon(O))&&h.isPointAboveHorizon(P)}return new qo(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return p.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.P(1,1)):this.screenBounds[1],w=p.ao(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),p.ap(w,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.P(1,1)):this.screenBounds[1],w=p.ao(h,_,a),M=this.cameraPoint.clone();switch(3*((M.y>h.y)+(M.y>_.y))+((M.x>h.x)+(M.x>_.x))){case 0:w[0]=M,w[4]=M.clone();break;case 1:w.splice(1,0,M);break;case 2:w[1]=M;break;case 3:w.splice(4,0,M);break;case 5:w.splice(2,0,M);break;case 6:w[3]=M;break;case 7:w.splice(3,0,M);break;case 8:w[2]=M}return w}containsTile(a,h,_,w=0){const M=a.queryPadding/h._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(M,h):this._bufferedScreenMercator(M,h);let P=a.tileID.wrap+(S.unwrapped?w:0);const O=S.polygon.map(de=>p.aq(a.tileTransform,de,P));if(!p.ar(O,0,0,p.aj,p.aj))return;P=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const V=this.screenGeometryMercator.polygon.map(de=>p.as(a.tileTransform,de,P)),U=V.map(de=>new p.P(de[0],de[1])),X=h.getFreeCameraOptions().position||new p.ac(0,0,0),G=p.as(a.tileTransform,X,P),Q=V.map(de=>{const le=p.at(de,de,G);return p.au(le,le),new p.av(G,le)}),se=p.aw(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:Q,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(oe=p.ax(O),oe.min.x=p.aD(oe.min.x,0,p.aj),oe.min.y=p.aD(oe.min.y,0,p.aj),oe.max.x=p.aD(oe.max.x,0,p.aj),oe.max.y=p.aD(oe.max.y,0,p.aj),oe),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:se};var oe}_bufferedScreenMercator(a,h){const _=ka(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(a,h){const _=ka(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(a,h){const _=function(M,S){const P=p.az([],S.pixelMatrix,S.globeMatrix),O=[0,-p.aE,0,1],V=[0,p.aE,0,1],U=[0,0,0,1];p.aA(O,O,P),p.aA(V,V,P),p.aA(U,U,P);const X=new p.P(O[0]/O[3],O[1]/O[3]),G=new p.P(V[0]/V[3],V[1]/V[3]),Q=p.aB(M,X)&&O[3]<U[3],se=p.aB(M,G)&&V[3]<U[3];if(!Q&&!se)return null;const oe=function(Oe,Te,Be){for(let Ve=1;Ve<Oe.length;Ve++){const ct=_s(Te.pointCoordinate3D(Oe[Ve-1]).x),Ye=_s(Te.pointCoordinate3D(Oe[Ve]).x);if(Be<0){if(ct<Ye)return{idx:Ve,t:-ct/(Ye-1-ct)}}else if(Ye<ct)return{idx:Ve,t:(1-ct)/(Ye+1-ct)}}return null}(M,S,Q?-1:1);if(!oe)return null;const{idx:de,t:le}=oe;let be=de>1?Qo(M.slice(0,de),S):[],Me=de<M.length?Qo(M.slice(de),S):[];be=be.map(Oe=>new p.P(_s(Oe.x),Oe.y)),Me=Me.map(Oe=>new p.P(_s(Oe.x),Oe.y));const De=[...be];0===De.length&&De.push(Me[Me.length-1]);const Le=p.ai(De[De.length-1].y,(0===Me.length?be[0]:Me[0]).y,le);let Ie;return Ie=Q?[new p.P(0,Le),new p.P(0,0),new p.P(1,0),new p.P(1,Le)]:[new p.P(1,Le),new p.P(1,1),new p.P(0,1),new p.P(0,Le)],De.push(...Ie),0===Me.length?De.push(be[0]):De.push(...Me),{polygon:De.map(Oe=>new p.ac(Oe.x,Oe.y)),unwrapped:!1}}(a,h);if(_)return _;const w=function(M,S){let P=!1,O=-1/0,V=0;for(let X=0;X<M.length-1;X++)M[X].x>O&&(O=M[X].x,V=X);for(let X=0;X<M.length-1;X++){const G=(V+X)%(M.length-1),Q=M[G],se=M[G+1];Math.abs(Q.x-se.x)>.5&&(Q.x<se.x?(Q.x+=1,0===G&&(M[M.length-1].x+=1)):(se.x+=1,G+1===M.length-1&&(M[0].x+=1)),P=!0)}const U=p.ay(S.center.lng);return P&&U<Math.abs(U-1)&&M.forEach(X=>{X.x-=1}),{polygon:M,unwrapped:P}}(Qo(a,h).map(M=>new p.P(_s(M.x),M.y)),h);return{polygon:w.polygon.map(M=>new p.ac(M.x,M.y)),unwrapped:w.unwrapped}}}function Qo(g,a){return p.aC(g,h=>{const _=a.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function _s(g){return g<0?1+g%1:g%1}function ka(g){return 100*g|0}function ys(g,a,h,_,w){const M=function(P,O){if(P)return w(P);if(O){if(g.url&&O.tiles&&g.tiles&&delete g.tiles,O.variants){if(!Array.isArray(O.variants))return w(new Error("variants must be an array"));for(const U of O.variants){if(null==U||"object"!=typeof U||U.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(U.capabilities))return w(new Error("capabilities must be an array"));if(1===U.capabilities.length&&"meshopt"===U.capabilities[0]){O=p.l(O,U);break}}}const V=p.aF(p.l({},O,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=a.canonicalizeTileset(V,g.url),w(null,V)}},S=function(P,O,V){if(!P)return null;if(!O&&!V)return P;V=V||P.worldview_default;const U=Object.values(P.language||{});if(0===U.length)return null;const X=Object.values(P.worldview||{});if(0===X.length)return null;const G=U.every(se=>se===O),Q=X.every(se=>se===V);return G&&Q?P:O in(P.language_options||{})||V in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(g.data,h,_);return S?p.q.frame(()=>M(null,S)):g.url?p.n(a.transformRequest(a.normalizeSourceURL(g.url,null,h,_),p.R.Source),M):p.q.frame(()=>{const{data:P,...O}=g;M(null,O)})}function Ps(g,a){const h=Math.pow(2,a.z),_=Math.floor(p.ay(g.getWest())*h),w=Math.floor(p.aH(g.getNorth())*h),M=Math.ceil(p.ay(g.getEast())*h),S=Math.ceil(p.aH(g.getSouth())*h);return a.x>=_&&a.x<M&&a.y>=w&&a.y<S}class Jo{constructor(a,h,_){this.bounds=a?p.aG.convert(this.validateBounds(a)):null,this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const h of a)this.extraBounds.push(p.aG.convert(this.validateBounds(h)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!Ps(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Ps(h,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const h=new Jo(a.bounds,a.minzoom,a.maxzoom);return h.addExtraBounds(a.extra_bounds),h}}class cs extends p.E{constructor(a,h,_,w){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.l(this,p.aF(h,["url","scheme","tileSize","promoteId"])),this._options=p.l({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new p.aI}load(a){this._loaded=!1,this.fire(new p.A("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=ys(this._options,this.map._requestManager,h,_,(w,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.z(w));else if(M){if(p.l(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of M.vector_layers)this.vectorLayerIds.push(S.id),M.worldview&&M.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=Jo.fromTileJSON(M),Sr(M.tiles,this.map._requestManager._customAccessToken),this.fire(new p.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.A("data",{dataType:"source",sourceDataType:"content"}))}a&&a(w)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=p.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return p.l({},this._options)}loadTile(a,h){const _=a.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(_),M=this.map._requestManager.transformRequest(w,p.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,P=S?{image:S.image.clone()}:null,O={request:M,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:p.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&p.f(_)&&(O.worldview=this.map.getWorldview()||this.worldviewDefault,O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=h:a.request=a.actor.send("reloadTile",O,V.bind(this));else if(a.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",O,V.bind(this),void 0,!0);else{const U=p.aJ.call({deduped:this._deduped},O,(X,G)=>{X||!G?V.call(this,X):(O.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},a.actor&&a.actor.send("loadTile",O,V.bind(this),void 0,!0))},!0);a.request={cancel:U}}function V(U,X){return delete a.request,a.aborted?h(null):U&&404!==U.status?h(U):(X&&X.resourceTiming&&(a.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&a.setExpiryData(X),a.loadVectorData(X,this.map.painter),p.aK(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,h){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rr extends p.E{constructor(a,h,_,w){super(),this.id=a,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.l({type:"raster"},h),p.l(this,p.aF(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new p.A("dataloading",{dataType:"source"})),this._tileJSONRequest=ys(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.z(h)):_&&(p.l(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=Jo.fromTileJSON(_),Sr(_.tiles),this.fire(new p.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.A("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=p.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return p.l({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const _=p.q.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=p.o(this.map._requestManager.transformRequest(w,p.R.Tile),(M,S,P,O)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):M?(a.state="errored",h(M)):S?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:P,expires:O}),a.setTexture(S,this.map.painter),a.state="loaded",p.aK(this.dispatcher),void h(null)):h(null)))}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h&&h()}unloadTile(a,h){a.texture&&a.texture instanceof p.T?(a.destroy(!0),a.texture&&a.texture instanceof p.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class yo extends rr{constructor(a,h,_,w){super(a,h,_,w),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=p.l({type:"raster-array"},h)}triggerRepaint(a){const h=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);h&&h.enabled&&_&&h._clearRenderCacheForTile(_.id,a.tileID),this.map.triggerRepaint()}loadTile(a,h){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(_,p.R.Tile),M={request:w,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=w,a.actor||(a.actor=this.dispatcher.getActor());const S=(P,O,V,U)=>{if(delete a.request,a.aborted)return a.state="unloaded",h(null);if(P)return"AbortError"===P.name?void 0:(a.state="errored",h(P));if(this.map._refreshExpiredTiles&&O&&a.setExpiryData({cacheControl:V,expires:U}),this.partial)a.state="empty";else{if(!O)return h(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=O}h(null)};a.request=this.partial?a.fetchHeader(void 0,S.bind(this)):a.actor.send("loadTile",M,S.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,h){const _=a.texture;_&&_ instanceof p.T?(a.destroy(!0),this.map.painter.saveTileTexture(_)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,h,_){a._isHeaderLoaded&&("empty"!==a.state&&(a.state="reloading"),a.fetchBand(h,_,(w,M)=>{if(w)return a.state="errored",this.fire(new p.z(w)),void this.triggerRepaint(a);M&&(a._isHeaderLoaded=!0,a.setTexture(M,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:M})=>M===a),_=h&&h.fields,w=_&&_.bands&&_.bands;return w?w[0]:0}getTextureDescriptor(a,h,_){if(!a)return;const w=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let M=null;h instanceof p.aN?M=h.paint.get("raster-array-band"):h instanceof p.aO&&(M=h.paint.get("raster-particle-array-band"));const S=M||this.getInitialBand(w);if(null!=S)if(a.textureDescriptor){if(!a.updateNeeded(w,S)||_)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,w,S)}getImages(a,h){const _=new Map;for(const w of a)for(const M of h){const[S,P]=M.split("/"),O=w.getLayer(S);if(!O||!O.hasBand(P)||!O.hasDataForBand(P))continue;const{bytes:V,tileSize:U,buffer:X}=O.getBandView(P),G=U+2*X,Q={data:new p.r({width:G,height:G},V),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(M,Q)}return _}}const gc={vector:cs,raster:rr,"raster-dem":class extends rr{constructor(g,a,h,_){super(g,a,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.l({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(g,a){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,M){w&&(g.state="errored",a(w)),M&&(g.dem=M,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",a(null))}g.request=p.o(this.map._requestManager.transformRequest(h,p.R.Tile),function(w,M,S,P){if(delete g.request,g.aborted)g.state="unloaded",a(null);else if(w)g.state="errored",a(w);else if(M){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:P});const O=ImageBitmap&&M instanceof ImageBitmap&&p.t(),V=1-(M.width-p.aL(M.width))/2;V<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const U=O?M:p.q.getImageData(M,V),X={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:U,encoding:this.encoding,padding:V};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",X,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const a=g.canonical,h=Math.pow(2,a.z),_=(a.x-1+h)%h,w=0===a.x?g.wrap-1:g.wrap,M=(a.x+1+h)%h,S=a.x+1===h?g.wrap+1:g.wrap,P={};return P[new p.aM(g.overscaledZ,w,a.z,_,a.y).key]={backfilled:!1},P[new p.aM(g.overscaledZ,S,a.z,M,a.y).key]={backfilled:!1},a.y>0&&(P[new p.aM(g.overscaledZ,w,a.z,_,a.y-1).key]={backfilled:!1},P[new p.aM(g.overscaledZ,g.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},P[new p.aM(g.overscaledZ,S,a.z,M,a.y-1).key]={backfilled:!1}),a.y+1<h&&(P[new p.aM(g.overscaledZ,w,a.z,_,a.y+1).key]={backfilled:!1},P[new p.aM(g.overscaledZ,g.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},P[new p.aM(g.overscaledZ,S,a.z,M,a.y+1).key]={backfilled:!1}),P}},"raster-array":yo,geojson:class extends p.E{constructor(g,a,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=a.data,this._options=p.l({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),void 0!==a.minzoom&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const w=p.aj/this.tileSize;this.workerOptions=p.l({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*w,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*w,extent:p.aj,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:p.aj,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*w,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new p.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof g&&("Feature"===g.type&&(g={type:"FeatureCollection",features:[g]}),"FeatureCollection"!==g.type))return this.fire(new p.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof g&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const a=new Map;for(const h of this._data.features)a.set(h.id,h);for(const h of g.features)a.set(h.id,h);this._data.features=[...a.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},a),this}getClusterChildren(g,a){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},a),this}getClusterLeaves(g,a,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:a,offset:h},_),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.A("dataloading",{dataType:"source"})),this._loaded=!1;const a=p.l({append:g},this.workerOptions);a.scope=this.scope;const h=this._data;"string"==typeof h?(a.request=this.map._requestManager.transformRequest(p.q.resolveURL(h),p.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(_,w)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new p.z(_));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(M.resourceTiming=w.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new p.A("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=p.C(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,a){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,w=_?{image:_.image.clone()}:null,M=this._partialReload,S={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:p.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:M};g.request=this.actor.send(h,S,(P,O)=>M&&!O?(g.state="loaded",a(null)):(delete g.request,g.destroy(),g.aborted?a(null):P?a(P):(g.loadVectorData(O,this.map.painter,"reloadTile"===h),a(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,a){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends p.aP{constructor(g,a,h,_){super(g,a,h,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const a of g.urls)this.urls.push(this.map._requestManager.transformRequest(a,p.R.Source).url);p.aQ(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new p.z(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const a=this.video.seekable;g<a.start(0)||g>a.end(0)?this.fire(new p.z(new p.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,a=g.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new p.T(g,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:p.aP,model:class extends p.E{constructor(g,a,h,_){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const g=[];for(const a in this._options.models){const h=this._options.models[a],_=p.aS(this.map._requestManager.transformRequest(h.uri,p.R.Model).url).then(w=>{if(!w)return;const M=p.aT(w),S=new p.aU(a,h.position,h.orientation,M);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(w=>{this.fire(new p.z(new Error(`Could not load model ${a} from ${h.uri}: ${w.message}`)))});g.push(_)}Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new p.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new p.z(new Error(`Could not load models: ${a.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,a){}serialize(){return this._options}},"batched-model":class extends p.E{constructor(g,a,h,_){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=p.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new p.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=ys(this._options,this.map._requestManager,a,h,(_,w)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new p.z(_))):w&&(p.l(this,w),w.bounds&&(this.tileBounds=new Jo(w.bounds,this.minzoom,this.maxzoom)),Sr(w.tiles,this.map._requestManager._customAccessToken),this.fire(new p.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.A("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,a){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,p.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:p.q.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&"expired"!==g.state)if("loading"===g.state)g.reloadCallback=a;else{if(g.buckets){const M=Object.values(g.buckets);for(const S of M)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",_,w.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_,w.bind(this),void 0,!0);function w(M,S){return g.aborted?a(null):M&&404!==M.status?a(M):(this.map._refreshExpiredTiles&&S&&g.setExpiryData(S),g.loadModelData(S,this.map.painter),g.state="loaded",void a(null))}}serialize(){return p.l({},this._options)}},canvas:class extends p.aP{constructor(g,a,h,_){super(g,a,h,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(M=>"number"!=typeof M))||this.fire(new p.z(new p.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.z(new p.V(`sources.${g}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new p.z(new p.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof HTMLCanvasElement||this.fire(new p.z(new p.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.z(new p.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof p.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.E{constructor(g,a,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jo(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),p.l(this,p.aF(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new p.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:a,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:a,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,a){const{x:h,y:_,z:w}=g.tileID.canonical,M=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:w},{signal:M.signal})).then(function(S){return delete g.request,g.aborted?(g.state="unloaded",a(null)):void 0===S?(g.state="errored",a(null)):null===S?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",a(null)):(P=S)instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement?(this.loadTileData(g,S),g.state="loaded",void a(null)):(g.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var P}.bind(this)).catch(S=>{"AbortError"!==S.name&&(g.state="errored",a(S))}),g.request.cancel=()=>M.abort()}loadTileData(g,a){g.setTexture(a,this.map.painter)}unloadTile(g,a){if(g.texture&&g.texture instanceof p.T?(g.destroy(!0),g.texture&&g.texture instanceof p.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y:_,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}a&&a()}abortTile(g,a){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=p.C(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new p.A("data",{dataType:"source",sourceDataType:"content"}))}}},_l=function(g,a,h,_){const w=new gc[a.type](g,a,h,_);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return p.aV(["load","abort","unload","serialize","prepare"],w),w};function _c(g,a,h=""){return`${h}:${a.id||""}:${a.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:w,importId:M}=_;return`featureset:${w}${M?`:import:${M}`:""}`}}(g.target)}`}function sd(g,a,h,_=""){if(g.uniqueFeatureID){const w=_c(g,a,_);if(h.has(w))return!0;h.add(w)}return!1}function ti(g,a,h,_,w=!1){const M=a.sourceCache.transform,S=a.sourceCache.tilesIn(g,a.has3DLayers,w);S.sort(Un);const P=[];for(const O of S){const V=O.tile.queryRenderedFeatures(a,O,h,_,M,w);Object.keys(V).length&&P.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:V})}return 0===P.length?{}:function(O){const V={},U={};for(const X of O){const G=X.queryResults,Q=X.wrappedTileID,se=U[Q]=U[Q]||{};for(const oe in G){const de=G[oe],le=se[oe]=se[oe]||{},be=V[oe]=V[oe]||[];for(const Me of de)le[Me.featureIndex]||(le[Me.featureIndex]=!0,be.push(Me))}}return V}(P)}function Oo(g,a,h,_,w){const M={},S=_.queryRenderedSymbols(g),P=[];for(const O of Object.keys(S).map(Number))P.push(w[O]);P.sort(Un);for(const O of P){const V=O.featureIndex.lookupSymbolFeatures(S[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,a,h);for(const U in V){const X=M[U]=M[U]||[],G=V[U];G.sort((Q,se)=>{const oe=O.featureSortOrder;if(oe){const de=oe.indexOf(Q.featureIndex);return oe.indexOf(se.featureIndex)-de}return se.featureIndex-Q.featureIndex});for(const Q of G)X.push(Q)}}return M}function Is(g,a){const h=g.getRenderableIds().map(M=>g.getTileByID(M)),_=[],w={};for(let M=0;M<h.length;M++){const S=h[M],P=S.tileID.canonical.key;w[P]||(w[P]=!0,S.querySourceFeatures(_,a))}return _}function Un(g,a){const h=g.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Os(g,a){const h={};if(!a)return h;for(const _ of g){const w=_.layerIds.map(M=>a.getLayer(M)).filter(Boolean);if(0!==w.length){_.layers=w,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(M=>w.filter(S=>S.id===M)[0]));for(const M of w)h[M.fqid]=_}}return h}const na=new Uint16Array(8184);for(let g=0;g<2046;g++){let a=g+2,h=0,_=0,w=0,M=0,S=0,P=0;for(1&a?w=M=S=32:h=_=P=32;(a>>=1)>1;){const V=h+w>>1,U=_+M>>1;1&a?(w=h,M=_,h=S,_=P):(h=w,_=M,w=S,M=P),S=V,P=U}const O=4*g;na[O+0]=h,na[O+1]=_,na[O+2]=w,na[O+3]=M}const uo=new Uint16Array(2178),tr=new Uint8Array(1089),Ls=new Uint16Array(1089);function Ro(g){return 0===g?-.03125:32===g?.03125:0}const Rd={type:2,extent:p.aj,loadGeometry:()=>[[new p.P(0,0),new p.P(p.aj+1,0),new p.P(p.aj+1,p.aj+1),new p.P(0,p.aj+1),new p.P(0,0)]]};class Qa{constructor(a,h,_,w,M){this.tileID=a,this.uid=p.a$(),this.uses=0,this.tileSize=h,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection)}registerFadeDuration(a){const h=a+this.timeAdded;h<p.q.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=p.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,h,_){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=Os(a.buckets,h.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const M=this.buckets[w];if(M instanceof p.b1){if(this.hasSymbolBuckets=!0,!_)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const M=this.buckets[w];if(M instanceof p.b1&&M.hasRTLText){this.hasRTLText=!0,p.b2();break}}this.queryPadding=0;for(const w in this.buckets){const M=this.buckets[w],S=h.style.getOwnLayer(w);if(!S)continue;const P=S.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,P)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new p.b0}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,h,_){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,Os(a.buckets,h.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const w in this.buckets){const M=this.buckets[w];M.uploadPending()&&M.upload(a)}const h=a.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new p.T(a,_.image,h.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new p.T(a,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new p.T(a,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(a,h,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,_),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=h.style.getBrightness();(this._lastUpdatedBrightness||w)&&(this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}queryRenderedFeatures(a,h,_,w,M,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=function(O,V){const U=p.bn([],[.5*O.width,.5*-O.height,1]);return p.bo(U,U,[1,-1,0]),p.az(U,U,O.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(U)}(M,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:h,pixelPosMatrix:P,transform:w,availableImages:_,tileTransform:this.tileTransform})}querySourceFeatures(a,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const w=_.loadVTLayers(),M=h?h.sourceLayer:"",S=w._geojsonTileLayer||w[M];if(!S)return;const P=p.b3(h&&h.filter),{z:O,x:V,y:U}=this.tileID.canonical,X={z:O,x:V,y:U};for(let G=0;G<S.length;G++){const Q=S.feature(G);if(P.needGeometry){const de=p.b4(Q,!0);if(!P.filter(new p.aa(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!P.filter(new p.aa(this.tileID.overscaledZ),Q))continue;const se=_.getId(Q,M),oe=new p.b5(Q,O,V,U,se);oe.tile=X,a.push(oe)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const h=this.expirationTime;if(a.cacheControl){const _=p.b6(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let w=!1;if(this.expirationTime>_)w=!1;else if(h)if(this.expirationTime<h)w=!0;else{const M=this.expirationTime-h;M?this.expirationTime=_+Math.max(M,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}updateBuckets(a,h){if(!this.latestFeatureIndex||!a.style)return;const _=this.latestFeatureIndex.loadVTLayers(),w=a.style.listImages(),M=a.style.getBrightness();for(const S in this.buckets){if(!a.style.hasLayer(S))continue;const P=this.buckets[S],O=P.layers[0],V=O.sourceLayer||"_geojsonTileLayer",U=_[V],X=a.style.getLayerSourceCache(O);let G={};X&&(G=X._state.getState(V,void 0));const Q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},se=Object.keys(G).length>0&&!h;se&&!P.stateDependentLayers.length&&!h||P.update(G,U,w,Q,se?P.stateDependentLayers:P.layers,h,M),(P instanceof p.b7||P instanceof p.b8)&&a._terrain&&a._terrain.enabled&&X&&P.uploadPending()&&a._terrain._clearRenderCacheForTile(X.id,this.tileID);const oe=a&&a.style&&a.style.getOwnLayer(S);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(P)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<p.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=p.q.now()+a}setTexture(a,h){const _=h.context,w=_.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof p.T?this.texture.update(a):(this.texture=new p.T(_,a,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(a,h){const _={};for(const w of h)_[w]=!0;this.dependencies[a]=_}hasDependency(a,h){for(const _ of a){const w=this.dependencies[_];if(w)for(const M of h)if(w[M])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,h){if(!h||"mercator"===h.name||this._tileDebugBuffer)return;const _=p.b9(Rd,this.tileID.canonical,this.tileTransform)[0],w=new p.ba,M=new p.bb;for(let S=0;S<_.length;S++){const{x:P,y:O}=_[S];w.emplaceBack(P,O),M.emplaceBack(S)}M.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(M),this._tileDebugBuffer=a.createVertexBuffer(w,p.bc.members),this._tileDebugSegments=p.bd.simpleSegment(0,0,w.length,M.length)}_makeTileBoundsBuffers(a,h){if(this._tileBoundsBuffer||!h||"mercator"===h.name)return;const _=p.b9(Rd,this.tileID.canonical,this.tileTransform)[0];let w,M;if(this.isRaster){const S=function(P,O){const V=p.aW(P,O),U=Math.pow(2,P.z);for(let de=0;de<33;de++)for(let le=0;le<33;le++){const be=p.aX((P.x+(le+Ro(le))/32)/U),Me=p.aY((P.y+(de+Ro(de))/32)/U),De=O.project(be,Me),Le=33*de+le;uo[2*Le+0]=Math.round((De.x*V.scale-V.x)*p.aj),uo[2*Le+1]=Math.round((De.y*V.scale-V.y)*p.aj)}tr.fill(0),Ls.fill(0);for(let de=2045;de>=0;de--){const le=4*de,be=na[le+0],Me=na[le+1],De=na[le+2],Le=na[le+3],Ie=be+De>>1,Oe=Me+Le>>1,Te=Ie+Oe-Me,Be=Oe+be-Ie,Ve=33*Me+be,ct=33*Le+De,Ye=33*Oe+Ie,kt=Math.hypot((uo[2*Ve+0]+uo[2*ct+0])/2-uo[2*Ye+0],(uo[2*Ve+1]+uo[2*ct+1])/2-uo[2*Ye+1])>=16;tr[Ye]=tr[Ye]||(kt?1:0),de<1022&&(tr[Ye]=tr[Ye]||tr[33*(Me+Be>>1)+(be+Te>>1)]||tr[33*(Le+Be>>1)+(De+Te>>1)])}const X=new p.aZ,G=new p.a_;let Q=0;function se(de,le){const be=33*le+de;return 0===Ls[be]&&(X.emplaceBack(uo[2*be+0],uo[2*be+1],de*p.aj/32,le*p.aj/32),Ls[be]=++Q),Ls[be]-1}function oe(de,le,be,Me,De,Le){const Ie=de+be>>1,Oe=le+Me>>1;if(Math.abs(de-De)+Math.abs(le-Le)>1&&tr[33*Oe+Ie])oe(De,Le,de,le,Ie,Oe),oe(be,Me,De,Le,Ie,Oe);else{const Te=se(de,le),Be=se(be,Me),Ve=se(De,Le);G.emplaceBack(Te,Be,Ve)}}return oe(0,0,32,32,32,0),oe(32,32,0,0,0,32),{vertices:X,indices:G}}(this.tileID.canonical,h);w=S.vertices,M=S.indices}else{w=new p.aZ,M=new p.a_;for(const{x:P,y:O}of _)w.emplaceBack(P,O,0,0);const S=p.be(w.int16.subarray(0,4*w.length),void 0,4);for(let P=0;P<S.length;P+=3)M.emplaceBack(S[P],S[P+1],S[P+2])}this._tileBoundsBuffer=a.createVertexBuffer(w,p.bf.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(M),this._tileBoundsSegments=p.bd.simpleSegment(0,0,w.length,M.length)}_makeGlobeTileDebugBuffers(a,h){const _=h.projection;if(!_||"globe"!==_.name||h.freezeTileCoverage)return;const w=this.tileID.canonical,M=p.bg(w,h),S=p.bh(M),P=p.ah(h.zoom);let O;P>0&&(O=p.bi(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,w,h,S,O,P),this._makeGlobeTileDebugTextBuffer(a,w,h,S,O,P)}_globePoint(a,h,_,w,M,S,P){let O=p.bj(a,h,_);if(S){const V=1<<_.z,U=p.ay(w.center.lng),X=p.aH(w.center.lat),G=(_.x+.5)/V-U;let Q=0;G>.5?Q=-1:G<-.5&&(Q=1);let se=(a/p.aj+_.x)/V+Q,oe=(h/p.aj+_.y)/V;se=(se-U)*w._pixelsPerMercatorPixel+U,oe=(oe-X)*w._pixelsPerMercatorPixel+X;const de=[se*w.worldSize,oe*w.worldSize,0];p.ad(de,de,S),O=p.bk(O,de,P)}return p.ad(O,O,M)}_makeGlobeTileDebugBorderBuffer(a,h,_,w,M,S){const P=new p.ba,O=new p.bb,V=new p.bl,U=(G,Q,se,oe,de)=>{const le=(se-G)/(de-1),be=(oe-Q)/(de-1),Me=P.length;for(let De=0;De<de;De++){const Le=G+De*le,Ie=Q+De*be;P.emplaceBack(Le,Ie);const Oe=this._globePoint(Le,Ie,h,_,w,M,S);V.emplaceBack(Oe[0],Oe[1],Oe[2]),O.emplaceBack(Me+De)}},X=p.aj;U(0,0,X,0,16),U(X,0,X,X,16),U(X,X,0,X,16),U(0,X,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(O),this._tileDebugBuffer=a.createVertexBuffer(P,p.bc.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(V,p.bm.members),this._tileDebugSegments=p.bd.simpleSegment(0,0,P.length,O.length)}_makeGlobeTileDebugTextBuffer(a,h,_,w,M,S){const P=p.aj/4,O=new p.ba,V=new p.a_,U=new p.bl,X=25;V.reserve(32),O.reserve(X),U.reserve(X);const G=(Q,se)=>X*Q+se;for(let Q=0;Q<X;Q++){const se=Q*P;for(let oe=0;oe<X;oe++){const de=oe*P;O.emplaceBack(de,se);const le=this._globePoint(de,se,h,_,w,M,S);U.emplaceBack(le[0],le[1],le[2])}}for(let Q=0;Q<4;Q++)for(let se=0;se<4;se++){const oe=G(Q,se),de=G(Q,se+1),le=G(Q+1,se),be=G(Q+1,se+1);V.emplaceBack(oe,de,le),V.emplaceBack(le,de,be)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(V),this._tileDebugTextBuffer=a.createVertexBuffer(O,p.bc.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(U,p.bm.members),this._tileDebugTextSegments=p.bd.simpleSegment(0,0,X,32)}destroy(a=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof p.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}p.bp.setPbf(p.bq);class Tr extends Qa{constructor(a,h,_,w,M){super(a,h,_,w,M),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexture(a,h){const _=h.context,w=_.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof p.T?this.texture.update(a,{premultiply:!1}):this.texture=new p.T(_,a,w.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,h){const _=this._mrt=new p.bp(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=p.br(w,(M,S,P,O)=>{if(M)h(M);else try{const V=_.getHeaderLength(S);if(V>a)return void(this.request=this.fetchHeader(V,h));_.parseHeader(S),this._isHeaderLoaded=!0;let U=0;for(const X of Object.values(_.layers))U=Math.max(U,X.dataIndex[X.dataIndex.length-1].lastByte);S.byteLength>=U&&(this.entireBuffer=S),h(null,this.entireBuffer||S,P,O)}catch(V){h(V)}}),this.request}fetchBand(a,h,_){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void _(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void _(new Error("Can't fetch tile band without an actor"));let S;const P=(X,G)=>{S.complete(X,G),X?_(X):(this.updateTextureDescriptor(a,h),_(null,this.textureDescriptor&&this.textureDescriptor.img))},O=(X,G)=>{if(X)return _(X);const Q=M.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:G,task:S},P,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),S.cancel()})},V=w.getLayer(a);if(!V)return void _(new Error(`Unknown sourceLayer "${a}"`));if(V.hasDataForBand(h))return this.updateTextureDescriptor(a,h),void _(null,this.textureDescriptor?this.textureDescriptor.img:null);const U=V.getDataRange([h]);if(S=w.createDecodingTask(U),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)O(null,this.entireBuffer.slice(U.firstByte,U.lastByte+1));else{const X=Object.assign({},this.requestParams,{headers:{Range:`bytes=${U.firstByte}-${U.lastByte}`}}),G=p.br(X,O);this._fetchQueue.push(()=>{G.cancel(),S.cancel()})}else _(null)}updateNeeded(a,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==a)&&"errored"!==this.state}updateTextureDescriptor(a,h){if(!this._mrt)return;const _=this._mrt.getLayer(a);if(!_||!_.hasBand(h)||!_.hasDataForBand(h))return;const{bytes:w,tileSize:M,buffer:S,offset:P,scale:O}=_.getBandView(h),V=M+2*S,U=new p.r({width:V,height:V},w),X=this.texture;X&&X instanceof p.T&&X.update(U,{premultiply:!1}),this.textureDescriptor={layer:a,band:h,img:U,buffer:S,offset:P,tileSize:M,format:_.pixelFormat,mix:[O,256*O,65536*O,16777216*O]}}}class Ri{constructor(a,h){this.max=a,this.onRemove=h,this.reset()}reset(){for(const a in this.data)for(const h of this.data[a])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(a,h,_){const w=a.wrapped().key;void 0===this.data[w]&&(this.data[w]=[]);const M={value:h,timeout:void 0};if(void 0!==_&&(M.timeout=setTimeout(()=>{this.remove(a,M)},_)),this.data[w].push(M),this.order.push(w),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const h=this.data[a].shift();return h.timeout&&clearTimeout(h.timeout),0===this.data[a].length&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),h.value}getByKey(a){const h=this.data[a];return h?h[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,h){if(!this.has(a))return this;const _=a.wrapped().key,w=void 0===h?0:this.data[_].indexOf(h),M=this.data[_][w];return this.data[_].splice(w,1),M.timeout&&clearTimeout(M.timeout),0===this.data[_].length&&delete this.data[_],this.onRemove(M.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(a){const h=[];for(const _ in this.data)for(const w of this.data[_])a(w.value)||h.push(w);for(const _ of h)this.remove(_.value.tileID,_)}}class yc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,h,_){const w=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][w]=this.stateChanges[a][w]||{},p.l(this.stateChanges[a][w],_),null===this.deletedStates[a]){this.deletedStates[a]={};for(const M in this.state[a])M!==w&&(this.deletedStates[a][M]=null)}else if(this.deletedStates[a]&&null===this.deletedStates[a][w]){this.deletedStates[a][w]={};for(const M in this.state[a][w])_[M]||(this.deletedStates[a][w][M]=null)}else for(const M in _)this.deletedStates[a]&&this.deletedStates[a][w]&&null===this.deletedStates[a][w][M]&&delete this.deletedStates[a][w][M]}removeFeatureState(a,h,_){if(null===this.deletedStates[a])return;const w=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&void 0!==h)null!==this.deletedStates[a][w]&&(this.deletedStates[a][w]=this.deletedStates[a][w]||{},this.deletedStates[a][w][_]=null);else if(void 0!==h)if(this.stateChanges[a]&&this.stateChanges[a][w])for(_ in this.deletedStates[a][w]={},this.stateChanges[a][w])this.deletedStates[a][w][_]=null;else this.deletedStates[a][w]=null;else this.deletedStates[a]=null}getState(a,h){const _=this.state[a]||{},w=this.stateChanges[a]||{},M=this.deletedStates[a];if(null===M)return{};if(void 0!==h){const P=String(h),O=p.l({},_[P],w[P]);if(M){const V=M[h];if(null===V)return{};for(const U in V)delete O[U]}return O}const S=p.l({},_,w);if(M)for(const P in M)delete S[P];return S}initializeTileState(a,h){a.refreshFeatureState(h)}coalesceChanges(a,h){const _={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const M={};for(const S in this.stateChanges[w])this.state[w][S]||(this.state[w][S]={}),p.l(this.state[w][S],this.stateChanges[w][S]),M[S]=this.state[w][S];_[w]=M}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const M={};if(null===this.deletedStates[w])for(const S in this.state[w])M[S]={},this.state[w][S]={};else for(const S in this.deletedStates[w]){if(null===this.deletedStates[w][S])this.state[w][S]={};else if(this.state[w][S])for(const P of Object.keys(this.deletedStates[w][S]))delete this.state[w][S][P];M[S]=this.state[w][S]}_[w]=_[w]||{},p.l(_[w],M)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(_).length)for(const w in a)a[w].refreshFeatureState(h)}}class Es extends p.E{constructor(a,h,_){super(),this.id=a,this._onlySymbols=_,h.on("data",w=>{"source"===w.dataType&&"metadata"===w.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===w.dataType&&"content"===w.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new Ri(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new yc,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(a){this.map=a,this._minTileCacheSize=void 0===this._minTileCacheSize&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,h){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,h)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(a),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(vc).map(a=>a.key)}getRenderableIds(a,h){const _=[];for(const w in this._tiles)this._isIdRenderable(+w,a,h)&&_.push(this._tiles[w]);return a?_.sort((w,M)=>{const S=w.tileID,P=M.tileID,O=new p.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),V=new p.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-P.overscaledZ||V.y-O.y||V.x-O.x}).map(w=>w.tileID.key):_.map(w=>w.tileID).sort(vc).map(w=>w.key)}hasRenderableParent(a){const h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(a,h,_){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())&&(_||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)"errored"!==this._tiles[a].state&&this._reloadTile(+a,"reloading")}}_reloadTile(a,h){const _=this._tiles[a];_&&("loading"!==_.state&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,a,h)))}_tileLoaded(a,h,_,w){if(w)if(a.state="errored",404!==w.status)this._source.fire(new p.z(w,{tile:a}));else{if(this._source.fire(new p.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const M=this.map.painter.terrain;this.update(this.transform,M.getScaledDemTileSize(),!0),M.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=p.q.now(),"expired"===_&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),"raster-dem"===this._source.type&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.A("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const h=this.getRenderableIds();for(let w=0;w<h.length;w++){const M=h[w];if(a.neighboringTiles&&a.neighboringTiles[M]){const S=this.getTileByID(M);_(a,S),_(S,a)}}function _(w,M){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let S=M.tileID.canonical.x-w.tileID.canonical.x;const P=M.tileID.canonical.y-w.tileID.canonical.y,O=Math.pow(2,w.tileID.canonical.z),V=M.tileID.key;0===S&&0===P||Math.abs(P)>1||(Math.abs(S)>1&&(1===Math.abs(S+O)?S+=O:1===Math.abs(S-O)&&(S-=O)),M.dem&&w.dem&&(w.dem.backfillBorder(M.dem,S,P),w.neighboringTiles&&w.neighboringTiles[V]&&(w.neighboringTiles[V].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,h,_,w){for(const M in this._tiles){let S=this._tiles[M];if(w[M]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>_)continue;let P=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const V=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[V.key],S&&S.hasData()&&(P=V)}let O=P;for(;O.overscaledZ>h;)if(O=O.scaledTo(O.overscaledZ-1),a[O.key]){w[P.key]=P;break}}}findLoadedParent(a,h){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=a.overscaledZ-1;_>=h;_--){const w=a.scaledTo(_),M=this._getLoadedTile(w);if(M)return M}}_getLoadedTile(a){const h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,h){h=h||this._source.tileSize;const _=Math.ceil(a.width/h)+1,w=Math.ceil(a.height/h)+1,M=Math.floor(_*w*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,M):M,P="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(P)}handleWrapJump(a){const h=Math.round((a-(void 0===this._prevLng?a:this._prevLng))/360);if(this._prevLng=a,h){const _={};for(const w in this._tiles){const M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),_[M.tileID.key]=M}this._tiles=_;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(a,h,_,w,M){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(a,h),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S="batched-model"===this._source.type;let P,O=this._source.maxzoom;const V=this.map&&this.map.painter?this.map.painter._terrain:null;if(V&&V.sourceCache===this&&V.attenuationRange()){const G=V.attenuationRange()[0],Q=Math.floor(G)-Math.log2(V.getDemUpscale());O>Q&&(O=Q)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new p.aM(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y));else if(0!==this.tileCoverLift){const G=a.clone();G.tileCoverLift=this.tileCoverLift,P=G.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&"globe"===a.projection.name&&(P.push(new p.aM(1,0,1,0,0)),P.push(new p.aM(1,0,1,1,0)),P.push(new p.aM(1,0,1,0,1)),P.push(new p.aM(1,0,1,1,1)))}else if(P=a.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const G=this._source.hasTile.bind(this._source);P=P.filter(Q=>G(Q))}}else P=[];if(P.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Hc(this._source.type)){const G=a.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),Q=Math.min(G,this._source.maxzoom);if(S){const se=a.extendTileCover(P,Q);for(const oe of se)P.push(oe)}else if(M){const se=a.extendTileCover(P,Q,this.transform._camera.forward());for(const oe of se)P.push(oe)}else if(this.castsShadows&&w){const se=a.extendTileCover(P,Q,w);for(const oe of se)this._shadowCasterTiles[oe.key]=!0,P.push(oe)}}const U=this._updateRetainedTiles(P);if(Hc(this._source.type)&&0!==P.length){const G={},Q={},se=Object.keys(U);for(const de of se){const le=U[de],be=this._tiles[de];if(!be||be.fadeEndTime&&be.fadeEndTime<=p.q.now())continue;const Me=this.findLoadedParent(le,Math.max(le.overscaledZ-Es.maxOverzooming,this._source.minzoom));Me&&(this._addTile(Me.tileID),G[Me.tileID.key]=Me.tileID),Q[de]=le}const oe=P[P.length-1].overscaledZ;for(const de in this._tiles){const le=this._tiles[de];if(U[de]||!le.hasData())continue;let be=le.tileID;for(;be.overscaledZ>oe;){be=be.scaledTo(be.overscaledZ-1);const Me=this._tiles[be.key];if(Me&&Me.hasData()&&Q[be.key]){U[de]=le.tileID;break}}}for(const de in G)U[de]||(this._coveredTiles[de]=!0,U[de]=G[de])}for(const G in U)this._tiles[G].clearFadeHold();const X=p.bs(this._tiles,U);for(const G of X){const Q=this._tiles[G];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+G)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const h={};if(0===a.length)return h;const _={},w=a.reduce((V,U)=>Math.min(V,U.overscaledZ),1/0),M=a[0].overscaledZ,S=Math.max(M-Es.maxOverzooming,this._source.minzoom),P=Math.max(M+Es.maxUnderzooming,this._source.minzoom),O={};for(const V of a){const U=this._addTile(V);h[V.key]=V,U.hasData()||w<this._source.maxzoom&&(O[V.key]=V)}this._retainLoadedChildren(O,w,P,h);for(const V of a){let U=this._tiles[V.key];if(U.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const G=V.children(this._source.maxzoom)[0],Q=this.getTile(G);if(Q&&Q.hasData()){h[G.key]=G;continue}}else{const G=V.children(this._source.maxzoom);if(h[G[0].key]&&h[G[1].key]&&h[G[2].key]&&h[G[3].key])continue}let X=U.wasRequested();for(let G=V.overscaledZ-1;G>=S;--G){const Q=V.scaledTo(G);if(_[Q.key]||(_[Q.key]=!0,U=this.getTile(Q),!U&&X&&(U=this._addTile(Q)),U&&(h[Q.key]=Q,X=U.wasRequested(),U.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const h=[];let _,w=this._tiles[a].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){_=this._loadedParentTiles[w.key];break}h.push(w.key);const M=w.scaledTo(w.overscaledZ-1);if(_=this._getLoadedTile(M),_)break;w=M}for(const M of h)this._loadedParentTiles[M]=_}}_addTile(a){let h=this._tiles[a.key];if(h)return!0!==h.isExtraShadowCaster||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),h;h=this._cache.getAndRemove(a),h&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));const _=!!h;if(!_){const w=this.map?this.map.painter:null,M=this._source.tileSize*a.overscaleFactor();h="raster-array"===this._source.type?new Tr(a,M,this.transform.tileZoom,w,this._isRaster):new Qa(a,M,this.transform.tileZoom,w,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))}return h.uses++,this._tiles[a.key]=h,_||this._source.fire(new p.A("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(a,h){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=h.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&"reloading"!==h.state||"empty"===h.state?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,h,_){const w=[],M=this.transform;if(!M)return w;const S="globe"===M.projection.name,P=p.ay(M.center.lng);for(const O in this._tiles){const V=this._tiles[O];if(_&&V.clearQueryDebugViz(),V.holdingForFade())continue;let U;if(S){const X=V.tileID.canonical;if(0===X.z){const G=[Math.abs(p.aD(P,...Ht(X,-1))-P),Math.abs(p.aD(P,...Ht(X,1))-P)];U=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(p.aD(P,...Ht(X,-1))-P),Math.abs(p.aD(P,...Ht(X,0))-P),Math.abs(p.aD(P,...Ht(X,1))-P)];U=[G.indexOf(Math.min(...G))-1]}}else U=[0];for(const X of U){const G=a.containsTile(V,M,h,X);G&&w.push(G)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,h){const _=this.getRenderableIds(a,h).map(M=>this._tiles[M].tileID),w="globe"===this.transform.projection.name;for(const M of _)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=w?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return _}sortCoordinatesByDistance(a){const h=a.slice(),_=this.transform._camera.position,w=this.transform._camera.forward(),M={};for(const S of h){const P=1/(1<<S.canonical.z);M[S.key]=((S.canonical.x+.5)*P+S.wrap-_[0])*w[0]+((S.canonical.y+.5)*P-_[1])*w[1]-_[2]*w[2]}return h.sort((S,P)=>M[S.key]-M[P.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(Hc(this._source.type))for(const a in this._tiles){const h=this._tiles[a];if(void 0!==h.fadeEndTime&&h.fadeEndTime>=p.q.now())return!0}return!1}setFeatureState(a,h,_){this._state.updateState(a=a||"_geojsonTileLayer",h,_)}removeFeatureState(a,h,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,_)}getFeatureState(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)}setDependencies(a,h,_){const w=this._tiles[a];w&&w.setDependencies(h,_)}reloadTilesForDependencies(a,h){for(const _ in this._tiles)this._tiles[_].hasDependency(a,h)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(a,h))}_preloadTiles(a,h){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(a,h))};return void this._source.on("data",O)}const _=new Map,w=Array.isArray(a)?a:[a],M=this.map.painter.terrain,S=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const O of w){const V=O.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const U of V)_.set(U.key,U);this.usedForTerrain&&O.updateElevation(!1)}const P=Array.from(_.values());p.bt(P,(O,V)=>{const U=new Qa(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(U,X=>{"raster-dem"===this._source.type&&U.dem&&this._backfillDEM(U),V(X,U)})},h)}}function vc(g,a){const h=Math.abs(2*g.wrap)-+(g.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return g.overscaledZ-a.overscaledZ||_-h||a.canonical.y-g.canonical.y||a.canonical.x-g.canonical.x}function Hc(g){return"raster"===g||"image"===g||"video"===g||"custom"===g}function Ht(g,a){const h=1<<g.z;return[g.x/h+a,(g.x+1)/h+a]}Es.maxOverzooming=10,Es.maxUnderzooming=3;class Uc{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const _ in this.style._mergedLayers){const w=this.style._mergedLayers[_];if("fill-extrusion"===w.type)this.layers.push({layer:w,visible:false,visibilityChanged:false});else if("model"===w.type){const M=this.style.getLayerSource(w);M&&"batched-model"===M.type&&this.layers.push({layer:w,visible:false,visibilityChanged:false})}}}onNewFrame(a){this.layersGotHidden=!1;for(const h of this.layers){const _=h.layer;let w=!1;"fill-extrusion"===_.type?w=!_.isHidden(a)&&_.paint.get("fill-extrusion-opacity")>0:"model"===_.type&&(w=!_.isHidden(a)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&h.visible,h.visible=w}}updateZOffset(a,h){this.currentBuildingBuckets=[];for(const w of this.layers){const M=w.layer,S=this.style.getLayerSourceCache(M);let P=1;"fill-extrusion"===M.type&&(P=w.visible?M.paint.get("fill-extrusion-vertical-scale"):0);let O=S?S.getTile(h):null;if(!O&&S&&h.canonical.z>S.getSource().minzoom){let V=h.scaledTo(Math.min(S.getSource().maxzoom,h.overscaledZ-1));for(;V.overscaledZ>=S.getSource().minzoom&&(O=S.getTile(V),!O&&0!==V.overscaledZ);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(M):null,tileID:O?O.tileID:h,verticalScale:P})}a.hasAnyZOffset=!1;let _=!1;for(let w=0;w<a.symbolInstances.length;w++){const M=a.symbolInstances.get(w),S=M.zOffset,P=this._getHeightAtTileOffset(h,M.tileAnchorX,M.tileAnchorY);M.zOffset=P!==Number.NEGATIVE_INFINITY?P:S,_||S===M.zOffset||(_=!0),a.hasAnyZOffset||0===M.zOffset||(a.hasAnyZOffset=!0)}_&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,h,_,w){let M=h,S=_;if(a.canonical.z!==w.canonical.z){const P=w.canonical,O=1/(1<<a.canonical.z-P.z);M=(h+a.canonical.x*p.aj)*O-P.x*p.aj|0,S=(_+a.canonical.y*p.aj)*O-P.y*p.aj|0}return{tileX:M,tileY:S}}_getHeightAtTileOffset(a,h,_){let w,M;for(let S=0;S<this.layers.length;++S){if("fill-extrusion"!==this.layers[S].layer.type)continue;const{bucket:P,tileID:O,verticalScale:V}=this.currentBuildingBuckets[S];if(!P)continue;const{tileX:U,tileY:X}=this._mapCoordToOverlappingTile(a,h,_,O),G=P.getHeightAtTileCoord(U,X);G&&void 0!==G.height&&(G.hidden?w=G.height:M=Math.max(G.height*V,M||0))}if(void 0!==M)return M;for(let S=0;S<this.layers.length;++S){const P=this.layers[S];if("model"!==P.layer.type||!P.visible)continue;const{bucket:O,tileID:V}=this.currentBuildingBuckets[S];if(!O)continue;const{tileX:U,tileY:X}=this._mapCoordToOverlappingTile(a,h,_,V),G=O.getHeightAtTileCoord(U,X);if(G&&!G.hidden)return void 0===G.height&&void 0!==w?Math.min(G.maxHeight,w)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ui(g,a){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.bu.forEach(_=>{_ in a&&(h[_]=a[_])}),h}function jn(g){g=g.slice();const a=Object.create(null);for(let h=0;h<g.length;h++)a[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Ui(g[h],a[g[h].ref]));return g}const vi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function po(g,a,h){h.push({command:vi.addSource,args:[g,a[g]]})}function Ld(g,a,h){a.push({command:vi.removeSource,args:[g]}),h[g]=!0}function Ah(g,a,h,_){Ld(g,h,_),po(g,a,h)}function Ma(g,a,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!p.bv(g[h][_],a[h][_]))return!1;for(_ in a[h])if(a[h].hasOwnProperty(_)&&"data"!==_&&!p.bv(g[h][_],a[h][_]))return!1;return!0}function yl(g,a,h,_,w,M){let S;for(S in a=a||{},g=g||{})g.hasOwnProperty(S)&&(p.bv(g[S],a[S])||h.push({command:M,args:[_,S,a[S],w]}));for(S in a)a.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(p.bv(g[S],a[S])||h.push({command:M,args:[_,S,a[S],w]}))}function Ja(g){return g.id}function ad(g,a){return g[a.id]=a,g}class vl{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=p.aD(a,0,1);let h=1,_=this._distances[h];const w=a*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const M=h-1,S=this._distances[M],P=_-S,O=P>0?(w-S)/P:0;return this.points[M].mult(1-O).add(this.points[h].mult(O))}}class Ws{constructor(a,h,_){const w=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)w.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,w,M){this._forEachCell(h,_,w,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(M)}insertCircle(a,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(a,h,_,w,M,S){this.boxCells[M].push(S)}_insertCircleCell(a,h,_,w,M,S){this.circleCells[M].push(S)}_query(a,h,_,w,M,S){if(_<0||a>this.width||w<0||h>this.height)return!M&&[];const P=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=w){if(M)return!0;for(let O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const V=this.circles[3*O],U=this.circles[3*O+1],X=this.circles[3*O+2];P.push({key:this.circleKeys[O],x1:V-X,y1:U-X,x2:V+X,y2:U+X})}return S?P.filter(S):P}return this._forEachCell(a,h,_,w,this._queryCell,P,{hitTest:M,seenUids:{box:{},circle:{}}},S),M?P.length>0:P}_queryCircle(a,h,_,w,M){const S=a-_,P=a+_,O=h-_,V=h+_;if(P<0||S>this.width||V<0||O>this.height)return!w&&[];const U=[];return this._forEachCell(S,O,P,V,this._queryCellCircle,U,{hitTest:w,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},M),w?U.length>0:U}query(a,h,_,w,M){return this._query(a,h,_,w,!1,M)}hitTest(a,h,_,w,M){return this._query(a,h,_,w,!0,M)}hitTestCircle(a,h,_,w){return this._queryCircle(a,h,_,!0,w)}_queryCell(a,h,_,w,M,S,P,O){const V=P.seenUids,U=this.boxCells[M];if(null!==U){const G=this.bboxes;for(const Q of U)if(!V.box[Q]){V.box[Q]=!0;const se=4*Q;if(a<=G[se+2]&&h<=G[se+3]&&_>=G[se+0]&&w>=G[se+1]&&(!O||O(this.boxKeys[Q]))){if(P.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Q],x1:G[se],y1:G[se+1],x2:G[se+2],y2:G[se+3]})}}}const X=this.circleCells[M];if(null!==X){const G=this.circles;for(const Q of X)if(!V.circle[Q]){V.circle[Q]=!0;const se=3*Q;if(this._circleAndRectCollide(G[se],G[se+1],G[se+2],a,h,_,w)&&(!O||O(this.circleKeys[Q]))){if(P.hitTest)return S.push(!0),!0;{const oe=G[se],de=G[se+1],le=G[se+2];S.push({key:this.circleKeys[Q],x1:oe-le,y1:de-le,x2:oe+le,y2:de+le})}}}}}_queryCellCircle(a,h,_,w,M,S,P,O){const V=P.circle,U=P.seenUids,X=this.boxCells[M];if(null!==X){const Q=this.bboxes;for(const se of X)if(!U.box[se]){U.box[se]=!0;const oe=4*se;if(this._circleAndRectCollide(V.x,V.y,V.radius,Q[oe+0],Q[oe+1],Q[oe+2],Q[oe+3])&&(!O||O(this.boxKeys[se])))return S.push(!0),!0}}const G=this.circleCells[M];if(null!==G){const Q=this.circles;for(const se of G)if(!U.circle[se]){U.circle[se]=!0;const oe=3*se;if(this._circlesCollide(Q[oe],Q[oe+1],Q[oe+2],V.x,V.y,V.radius)&&(!O||O(this.circleKeys[se])))return S.push(!0),!0}}}_forEachCell(a,h,_,w,M,S,P,O){const V=this._convertToXCellCoord(a),U=this._convertToYCellCoord(h),X=this._convertToXCellCoord(_),G=this._convertToYCellCoord(w);for(let Q=V;Q<=X;Q++)for(let se=U;se<=G;se++)if(M.call(this,a,h,_,w,this.xCellCount*se+Q,S,P,O))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,w,M,S){const P=w-a,O=M-h,V=_+S;return V*V>P*P+O*O}_circleAndRectCollide(a,h,_,w,M,S,P){const O=(S-w)/2,V=Math.abs(a-(w+O));if(V>O+_)return!1;const U=(P-M)/2,X=Math.abs(h-(M+U));if(X>U+_)return!1;if(V<=O||X<=U)return!0;const G=V-O,Q=X-U;return G*G+Q*Q<=_*_}}const Ll={unknown:0,flipRequired:1,flipNotRequired:2},Ph=Math.tan(85*Math.PI/180);function ih(g,a,h,_,w,M,S){const P=p.bz();if(h)if("globe"===M.name){const O=p.bA(w,a);p.az(P,P,O)}else{const O=p.bB([],S);P[0]=O[0],P[1]=O[1],P[4]=O[2],P[5]=O[3],_||p.by(P,P,w.angle)}else p.az(P,w.labelPlaneMatrix,g);return P}function ru(g,a,h,_,w,M,S){const P=ih(g,a,h,_,w,M,S);return"globe"===M.name&&h||(P[2]=P[6]=P[10]=P[14]=0),P}function Hu(g,a,h,_,w,M,S){if(h){if("globe"===M.name){const P=ih(g,a,h,_,w,M,S);return p.bi(P,P),p.az(P,g,P),P}{const P=p.bw(g),O=p.bx([]);return O[0]=S[0],O[1]=S[1],O[4]=S[2],O[5]=S[3],p.az(P,P,O),_||p.by(P,P,-w.angle),P}}return w.glCoordMatrix}function Ca(g,a,h,_){const w=[g,a,h,1];h?p.aA(w,w,_):Uu(w,w,_);const M=w[3];return w[0]/=M,w[1]/=M,w[2]/=M,w}function Fl(g,a){return Math.min(.5+g/a*.5,1.5)}function Va(g,a){const h=g[0]/g[3],_=g[1]/g[3];return h>=-a[0]&&h<=a[0]&&_>=-a[1]&&_<=a[1]}function On(g,a,h,_,w,M,S,P,O,V){const U=h.transform,X=_?g.textSizeData:g.iconSizeData,G=p.bH(X,h.transform.zoom),Q="globe"===U.projection.name,se=[256/h.width*2+1,256/h.height*2+1],oe=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let de=null;Q&&(de=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const le=g.lineVertexArray,be=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,Me=h.transform.width/h.transform.height;let De,Le=!1;for(let Ie=0;Ie<be.length;Ie++){const Oe=be.get(Ie),{numGlyphs:Te,writingMode:Be}=Oe;if(Be!==p.bI.vertical||Le||De===p.bI.horizontal||(Le=!0),De=Be,(Oe.hidden||Be===p.bI.vertical)&&!Le){Ni(Te,oe);continue}Le=!1;const Ve=new p.P(Oe.tileAnchorX,Oe.tileAnchorY);let{x:ct,y:Ye,z:kt}=U.projection.projectTilePoint(Ve.x,Ve.y,V.canonical);if(O){const[fn,bn,dn]=O(Ve);ct+=fn,Ye+=bn,kt+=dn}const vt=[ct,Ye,kt,1];if(p.aA(vt,vt,a),!Va(vt,se)){Ni(Te,oe);continue}const Pt=vt[3],Je=Fl(h.transform.getCameraToCenterDistance(U.projection),Pt),ot=p.bJ(X,G,Oe),Ke=S?ot/Je:ot*Je,xt=Ca(ct,Ye,kt,w);if(xt[3]<=0){Ni(Te,oe);continue}let dt={};const Ot=p.al(g.layers[0].layout.get("text-max-angle")),wt=Math.cos(Ot),It=S?null:O,Lt=Xo(Oe,Ke,!1,P,a,w,M,g.glyphOffsetArray,le,oe,de,xt,Ve,dt,Me,It,U.projection,V,S,wt);Le=Lt.useVertical,It&&Lt.needsFlipping&&(dt={}),(Lt.notEnoughRoom||Le||Lt.needsFlipping&&Xo(Oe,Ke,!0,P,a,w,M,g.glyphOffsetArray,le,oe,de,xt,Ve,dt,Me,It,U.projection,V,S,wt).notEnoughRoom)&&Ni(Te,oe)}_?(g.text.dynamicLayoutVertexBuffer.updateData(oe),de&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(de)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),de&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(de))}function ou(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de){const{lineStartIndex:le,glyphStartIndex:be,segment:Me}=P,De=be+P.numGlyphs,Le=le+P.lineLength,Ie=a.getoffsetX(be),Oe=a.getoffsetX(De-1),Te=Ii(g*Ie,h,_,w,M,S,Me,le,Le,O,V,U,X,G,!0,Q,se,oe,de);if(!Te)return null;const Be=Ii(g*Oe,h,_,w,M,S,Me,le,Le,O,V,U,X,G,!0,Q,se,oe,de);return Be?{first:Te,last:Be}:null}function Sa(g,a,h,_){return g===p.bI.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.bI.vertical?_>0?{needsFlipping:!0}:null:a!==Ll.unknown&&(0===(w=h)||Math.abs(_/w)>Ph)?a===Ll.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var w}function Xo(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be,Me){const De=a/24,Le=g.lineOffsetX*De,Ie=g.lineOffsetY*De,{lineStartIndex:Oe,glyphStartIndex:Te,numGlyphs:Be,segment:Ve,writingMode:ct,flipState:Ye}=g,kt=Oe+g.lineLength,vt=Pt=>{if(U){const[xt,dt,Ot]=Pt.up,wt=V.length;p.bK(U,wt+0,xt,dt,Ot),p.bK(U,wt+1,xt,dt,Ot),p.bK(U,wt+2,xt,dt,Ot),p.bK(U,wt+3,xt,dt,Ot)}const[Je,ot,Ke]=Pt.point;p.bL(V,Je,ot,Ke,Pt.angle)};if(Be>1){const Pt=ou(De,P,Le,Ie,h,X,G,g,O,M,Q,oe,!1,de,le,be,Me);if(!Pt)return{notEnoughRoom:!0};if(_&&!h){let[Je,ot,Ke]=Pt.first.point,[xt,dt,Ot]=Pt.last.point;[Je,ot]=Ca(Je,ot,Ke,S),[xt,dt]=Ca(xt,dt,Ot,S);const wt=Sa(ct,Ye,(xt-Je)*se,dt-ot);if(g.flipState=wt&&wt.needsFlipping?Ll.flipRequired:Ll.flipNotRequired,wt)return wt}vt(Pt.first);for(let Je=Te+1;Je<Te+Be-1;Je++){const ot=Ii(De*P.getoffsetX(Je),Le,Ie,h,X,G,Ve,Oe,kt,O,M,Q,oe,!1,!1,de,le,be,Me);if(!ot)return V.length-=4*(Je-Te),{notEnoughRoom:!0};vt(ot)}vt(Pt.last)}else{if(_&&!h){const Je=Ca(G.x,G.y,0,w),ot=Oe+Ve+1,Ke=new p.P(O.getx(ot),O.gety(ot)),xt=Ca(Ke.x,Ke.y,0,w),dt=xt[3]>0?xt:su(G,Ke,Je,1,w,void 0,de,le.canonical),Ot=Sa(ct,Ye,(dt[0]-Je[0])*se,dt[1]-Je[1]);if(g.flipState=Ot&&Ot.needsFlipping?Ll.flipRequired:Ll.flipNotRequired,Ot)return Ot}const Pt=Ii(De*P.getoffsetX(Te),Le,Ie,h,X,G,Ve,Oe,kt,O,M,Q,oe,!1,!1,de,le,be,Me);if(!Pt)return{notEnoughRoom:!0};vt(Pt)}return{}}function vn(g,a,h,_,w){const{x:M,y:S,z:P}=_.projectTilePoint(g.x,g.y,a);if(!w)return Ca(M,S,P,h);const[O,V,U]=w(g);return Ca(M+O,S+V,P+U,h)}function su(g,a,h,_,w,M,S,P){const O=vn(g.sub(a)._unit()._add(g),P,w,S,M);return p.at(O,h,O),p.au(O,O),p.bF(O,h,O,_)}function Ii(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be){const Me=_?g-a:g+a;let De=Me>0?1:-1,Le=0;_&&(De*=-1,Le=Math.PI),De<0&&(Le+=Math.PI);let Ie=P+S+(De>0?0:1)|0,Oe=w,Te=w,Be=0,Ve=0;const ct=Math.abs(Me),Ye=[],kt=[];let vt=M,Pt=vt,Je=p.bC([]);const ot=()=>su(Pt,vt,Te,ct-Be+1,U,G,oe,de.canonical);for(;Be+Ve<=ct;){if(Ie+=De,Ie<P||Ie>=O)return null;if(Te=Oe,Pt=vt,Ye.push(Te),Q&&kt.push(Pt),vt=new p.P(V.getx(Ie),V.gety(Ie)),Oe=X[Ie],!Oe){const dn=vn(vt,de.canonical,U,oe,G);Oe=dn[3]>0?X[Ie]=dn:ot()}Be+=Ve;const fn=p.at([],Oe,Te),bn=p.bD(Te,Oe);if(h&&bn>0&&Ve>0&&p.bE(Je,fn)/(Ve*bn)<be)return null;Ve=bn,Je=fn}se&&G&&(X[Ie]&&(Oe=ot(),Ve=p.bD(Te,Oe),Je=p.at([],Oe,Te)),X[Ie]=Oe);const Ke=(ct-Be)/Ve,xt=vt.sub(Pt)._mult(Ke)._add(Pt),dt=p.bF([],Te,Je,Ke);let Ot=[0,0,1],wt=Je[0],It=Je[1];if(le&&(Ot=oe.upVector(de.canonical,xt.x,xt.y),0!==Ot[0]||0!==Ot[1]||1!==Ot[2])){const fn=[Ot[2],0,-Ot[0]],bn=p.bG([],Ot,fn);p.au(fn,fn),p.au(bn,bn),wt=p.bE(Je,fn),It=p.bE(Je,bn)}if(h){const fn=p.bG([],Ot,Je);p.au(fn,fn),p.bF(dt,dt,fn,h*De)}const Lt=Le+Math.atan2(It,wt);return Ye.push(dt),Q&&kt.push(xt),{point:dt,angle:Lt,path:Ye,tilePath:kt,up:Ot}}function Ni(g,a){const h=a.length,_=h+4*g;a.resize(_),a.float32.fill(-1/0,4*h,4*_)}function Uu(g,a,h){const _=a[0],w=a[1];return g[0]=h[0]*_+h[4]*w+h[12],g[1]=h[1]*_+h[5]*w+h[13],g[3]=h[3]*_+h[7]*w+h[15],g}const Cn=100;class qu{constructor(a,h,_=new Ws(a.width+200,a.height+200,25),w=new Ws(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Cn,this.screenBottomBoundary=a.height+Cn,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,_,w,M,S,P,O){let V=_.projectedAnchorX,U=_.projectedAnchorY,X=_.projectedAnchorZ;const G=_.elevation,Q=_.tileID,se=a.getProjection();if(G&&Q){const[Ie,Oe,Te]=se.upVector(Q.canonical,_.tileAnchorX,_.tileAnchorY),Be=se.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Ie*G*Be,U+=Oe*G*Be,X+=Te*G*Be}const oe=this.projectAndGetPerspectiveRatio(P,V,U,X,_.tileID,"globe"===se.name||!!G||this.transform.pitch>0,se),de=S*oe.perspectiveRatio,le=(_.x1*h+w.x-_.padding)*de+oe.point.x,be=(_.y1*h+w.y-_.padding)*de+oe.point.y,Me=(_.x2*h+w.x+_.padding)*de+oe.point.x,De=(_.y2*h+w.y+_.padding)*de+oe.point.y,Le=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(le,be,Me,De)||!M&&this.grid.hitTest(le,be,Me,De,O)||Le?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[le,be,Me,De],offscreen:this.isOffscreen(le,be,Me,De),occluded:!1}}placeCollisionCircles(a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe){const de=[],le=this.transform.elevation,be=a.getProjection(),Me=le?le.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,be):null,De=new p.P(_.tileAnchorX,_.tileAnchorY);let{x:Le,y:Ie,z:Oe}=be.projectTilePoint(De.x,De.y,oe.canonical);if(Me){const[Ot,wt,It]=Me(De);Le+=Ot,Ie+=wt,Oe+=It}const Te="globe"===be.name,Be=this.projectAndGetPerspectiveRatio(P,Le,Ie,Oe,oe,Te||!!le||this.transform.pitch>0,be),{perspectiveRatio:Ve}=Be,ct=(X?S/Ve:S*Ve)/p.bO,Ye=Ca(Le,Ie,Oe,O),kt=_.lineOffsetX*ct,vt=_.lineOffsetY*ct,Pt=p.al(a.layers[0].layout.get("text-max-angle")),Je=Math.cos(Pt),ot=Be.signedDistanceFromCamera>0?ou(ct,M,kt,vt,!1,Ye,De,_,w,O,{},le&&!X?Me:null,X&&!!le,be,oe,X,Je):null;let Ke=!1,xt=!1,dt=!0;if(ot&&!Be.occluded){const Ot=.5*Q*Ve+se,wt=new p.P(-100,-100),It=new p.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new vl,{first:fn,last:bn}=ot,dn=fn.path.length;let an=[];for(let qn=dn-1;qn>=1;qn--)an.push(fn.path[qn]);for(let qn=1;qn<bn.path.length;qn++)an.push(bn.path[qn]);const mn=2.5*Ot;V&&(an=an.map(([qn,xi,xr],hr)=>(Me&&!Te&&(xr=Me(hr<dn-1?fn.tilePath[dn-1-hr]:bn.tilePath[hr-dn+2])[2]),Ca(qn,xi,xr,V))),an.some(qn=>qn[3]<=0)&&(an=[]));let Dn=[];if(an.length>0){let qn=1/0,xi=-1/0,xr=1/0,hr=-1/0;for(const Ci of an)qn=Math.min(qn,Ci[0]),xr=Math.min(xr,Ci[1]),xi=Math.max(xi,Ci[0]),hr=Math.max(hr,Ci[1]);xi>=wt.x&&qn<=It.x&&hr>=wt.y&&xr<=It.y&&(Dn=[an.map(Ci=>new p.P(Ci[0],Ci[1]))],(qn<wt.x||xi>It.x||xr<wt.y||hr>It.y)&&(Dn=p.bM(Dn,wt.x,wt.y,It.x,It.y)))}for(const qn of Dn){Lt.reset(qn,.25*Ot);let xi=0;xi=Lt.length<=.5*Ot?1:Math.ceil(Lt.paddedLength/mn)+1;for(let xr=0;xr<xi;xr++){const hr=xr/Math.max(xi-1,1),Ci=Lt.lerp(hr),Lo=Ci.x+Cn,fo=Ci.y+Cn;de.push(Lo,fo,Ot,0);const ni=Lo-Ot,Li=fo-Ot,qi=Lo+Ot,wr=fo+Ot;if(dt=dt&&this.isOffscreen(ni,Li,qi,wr),xt=xt||this.isInsideGrid(ni,Li,qi,wr),!h&&this.grid.hitTestCircle(Lo,fo,Ot,G)&&(Ke=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ke,occluded:!1}}}}return{circles:!U&&Ke||!xt?[]:de,offscreen:dt,collisionDetected:Ke,occluded:Be.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,M=-1/0,S=-1/0;for(const U of a){const X=new p.P(U.x+Cn,U.y+Cn);_=Math.min(_,X.x),w=Math.min(w,X.y),M=Math.max(M,X.x),S=Math.max(S,X.y),h.push(X)}const P=this.grid.query(_,w,M,S).concat(this.ignoredGrid.query(_,w,M,S)),O={},V={};for(const U of P){const X=U.key;if(void 0===O[X.bucketInstanceId]&&(O[X.bucketInstanceId]={}),O[X.bucketInstanceId][X.featureIndex])continue;const G=[new p.P(U.x1,U.y1),new p.P(U.x2,U.y1),new p.P(U.x2,U.y2),new p.P(U.x1,U.y2)];p.bN(h,G)&&(O[X.bucketInstanceId][X.featureIndex]=!0,void 0===V[X.bucketInstanceId]&&(V[X.bucketInstanceId]=[]),V[X.bucketInstanceId].push(X.featureIndex))}return V}insertCollisionBox(a,h,_,w,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:M},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,w,M){const S=h?this.ignoredGrid:this.grid,P={bucketInstanceId:_,featureIndex:w,collisionGroupID:M};for(let O=0;O<a.length;O+=4)S.insertCircle(P,a[O],a[O+1],a[O+2])}projectAndGetPerspectiveRatio(a,h,_,w,M,S,P){const O=[h,_,w,1];let V=!1;w||this.transform.pitch>0?(p.aA(O,O,a),this.fogState&&M&&"globe"!==P.name&&(V=function(G,Q,se,oe,de,le){const be=le.calculateFogTileMatrix(de),Me=[Q,se,oe];return p.ad(Me,Me,be),pn(G,p.ae(Me),le.pitch,le._fov)}(this.fogState,h,_,w,M.toUnwrapped(),this.transform)>.9)):Uu(O,O,a);const U=O[3];return{point:new p.P((O[0]/U+1)/2*this.transform.width+Cn,(-O[1]/U+1)/2*this.transform.height+Cn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/U*.5,1.5),signedDistanceFromCamera:U,occluded:S&&O[2]>U||V}}isOffscreen(a,h,_,w){return _<Cn||a>=this.screenRightBoundary||w<Cn||h>this.screenBottomBoundary}isInsideGrid(a,h,_,w){return _>=0&&a<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=p.bx([]);return p.bo(a,a,[-100,-100,0]),a}}function el(g,a,h){const _=a.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.az(new Float32Array(16),g.projMatrix,_)}function Fd(g,a,h){if(a.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(a.projection),el(_,a.getProjection(),g)}function Ea(g,a,h){return a.name===h.projection.name?g.projMatrix:el(h,a,g)}class bl{constructor(a,h,_,w){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class ld{constructor(a,h,_,w,M,S=!1){this.text=new bl(a?a.text:null,h,_,M),this.icon=new bl(a?a.icon:null,h,w,M),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fi{constructor(a,h,_,w=!1){this.text=a,this.icon=h,this.skipFade=_,this.clipped=w}}class yn{constructor(){this.invProjMatrix=p.bz(),this.viewportMatrix=p.bz(),this.circles=[]}}class nr{constructor(a,h,_,w,M){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=M}}class bi{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function Da(g,a,h,_,w){const{horizontalAlign:M,verticalAlign:S}=p.bV(g),P=-(M-.5)*a,O=-(S-.5)*h,V=p.bU(g,_);return new p.P(P+V[0]*w,O+V[1]*w)}function cd(g,a,h,_,w){const M=new p.P(g,a);return h&&M._rotate(_?w:-w),M}class Hn{constructor(a,h,_,w,M,S){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new qu(this.transform,M),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new bi(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,_,w,M=1){const S=_.getBucket(h),P=_.latestFeatureIndex;if(!S||!P||h.fqid!==S.layerIds[0])return;const O=S.layers[0].layout,V=S.layers[0].paint,U=_.collisionBoxArray,X=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),G=_.tileSize/p.aj,Q=_.tileID.toUnwrapped();this.transform.setProjection(S.projection);const se=(oe=_.tileID,de=S.getProjection(),le=this.transform,de.name===this.projection?le.calculateProjMatrix(oe.toUnwrapped()):el(le,de,oe));var oe,de,le;const be="map"===O.get("text-pitch-alignment"),Me="map"===O.get("text-rotation-alignment");h.compileFilter(h.options);const De=h.dynamicFilter(),Le=h.dynamicFilterNeedsFeature(),Ie=this.transform.calculatePixelsToTileUnitsMatrix(_),Oe=ru(se,_.tileID.canonical,be,Me,this.transform,S.getProjection(),Ie);let Te=null;if(be){const ot=Hu(se,_.tileID.canonical,be,Me,this.transform,S.getProjection(),Ie);Te=p.az([],this.transform.labelPlaneMatrix,ot)}let Be=null;De&&_.latestFeatureIndex&&(Be={unwrappedTileID:Q,dynamicFilter:De,dynamicFilterNeedsFeature:Le}),this.retainedQueryData[S.bucketInstanceId]=new nr(S.bucketInstanceId,P,S.sourceLayerIndex,S.index,_.tileID);const[Ve,ct]=S.layers[0].layout.get("text-size-scale-range"),Ye=p.aD(M,Ve,ct),[kt,vt]=O.get("icon-size-scale-range"),Pt=p.aD(M,kt,vt),Je={bucket:S,layout:O,paint:V,posMatrix:se,textLabelPlaneMatrix:Oe,labelToScreenMatrix:Te,clippingData:Be,scale:X,textPixelRatio:G,holdingForFade:_.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:p.bH(S.textSizeData,this.transform.zoom,Ye),partiallyEvaluatedIconSize:p.bH(S.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(w)for(const ot of S.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:xt,symbolInstanceEnd:dt}=ot;a.push({sortKey:Ke,symbolInstanceStart:xt,symbolInstanceEnd:dt,parameters:Je})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Je})}attemptAnchorPlacement(a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be){const{textOffset0:Me,textOffset1:De,crossTileID:Le}=G,Ie=[Me,De],Oe=Da(a,_,w,Ie,M),Te=this.collisionIndex.placeCollisionBox(se,M,h,cd(Oe.x,Oe.y,S,P,this.transform.angle),X,O,V,U.predicate);if(de){const Be=se.getSymbolInstanceIconSize(be,this.transform.zoom,G.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(se,Be,de,cd(Oe.x,Oe.y,S,P,this.transform.angle),X,O,V,U.predicate).box.length)return}if(Te.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[Le]&&this.prevPlacement.placements[Le]&&this.prevPlacement.placements[Le].text&&(Be=this.prevPlacement.variableOffsets[Le].anchor),this.variableOffsets[Le]={textOffset:Ie,width:_,height:w,anchor:a,textScale:M,prevAnchor:Be},this.markUsedJustification(se,a,G,oe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,oe,G),this.placedOrientations[Le]=oe),{shift:Oe,placedGlyphBoxes:Te}}}placeLayerBucketPart(a,h,_,w,M=1){const{bucket:S,layout:P,paint:O,posMatrix:V,textLabelPlaneMatrix:U,labelToScreenMatrix:X,clippingData:G,textPixelRatio:Q,holdingForFade:se,collisionBoxArray:oe,partiallyEvaluatedTextSize:de,partiallyEvaluatedIconSize:le,collisionGroup:be,latestFeatureIndex:Me}=a.parameters,De=P.get("text-optional"),Le=P.get("icon-optional"),Ie=P.get("text-allow-overlap"),Oe=P.get("icon-allow-overlap"),Te="map"===P.get("text-rotation-alignment"),Be="map"===P.get("text-pitch-alignment"),Ve=O.get("symbol-z-offset"),ct="sea"===P.get("symbol-elevation-reference"),[Ye,kt]=P.get("text-size-scale-range"),[vt,Pt]=P.get("icon-size-scale-range"),Je=p.aD(M,Ye,kt),ot=p.aD(M,vt,Pt);this.transform.setProjection(S.projection);let Ke=Ie&&(Oe||!S.hasIconData()||Le),xt=Oe&&(Ie||!S.hasTextData()||De);const dt=!Ve.isConstant();!S.collisionArrays&&oe&&S.deserializeCollisionBoxes(oe),_&&w&&S.updateCollisionDebugBuffers(this.transform.zoom,oe,Je,ot);const Ot=(wt,It,Lt)=>{const{crossTileID:fn,numVerticalGlyphVertices:bn}=wt;let dn=null;if(G&&G.dynamicFilterNeedsFeature||dt){const Vi=this.retainedQueryData[S.bucketInstanceId];dn=Me.loadFeature({featureIndex:wt.featureIndex,bucketIndex:Vi.bucketIndex,sourceLayerIndex:Vi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(G&&!(0,G.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},dn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new p.P(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[fn]=new Fi(!1,!1,!1,!0),void h.add(fn);const an=Ve.evaluate(dn,{});if(h.has(fn))return;if(se)return void(this.placements[fn]=new Fi(!1,!1,!1));let mn=!1,Dn=!1,qn=!0,xi=!1,xr=!1,hr=null,Ci={box:null,offscreen:null,occluded:null},Lo={box:null,offscreen:null,occluded:null},fo=null,ni=null,Li=null,qi=0,wr=0,oo=0;Lt.textFeatureIndex?qi=Lt.textFeatureIndex:wt.useRuntimeCollisionCircles&&(qi=wt.featureIndex),Lt.verticalTextFeatureIndex&&(wr=Lt.verticalTextFeatureIndex);const Ho=Vi=>{Vi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Xr=this.transform.elevation;Vi.elevation=ct?an:an+(Xr?Xr.getAtTileOffset(Vi.tileID,Vi.tileAnchorX,Vi.tileAnchorY):0),Vi.elevation+=wt.zOffset},vo=Lt.textBox;if(vo){Ho(vo);const Vi=ir=>{let ao=p.bI.horizontal;if(S.allowVerticalPlacement&&!ir&&this.prevPlacement){const us=this.prevPlacement.placedOrientations[fn];us&&(this.placedOrientations[fn]=us,ao=us,this.markUsedOrientation(S,ao,wt))}return ao},Xr=(ir,ao)=>{if(S.allowVerticalPlacement&&bn>0&&Lt.verticalTextBox){for(const us of S.writingModes)if(us===p.bI.vertical?(Ci=ao(),Lo=Ci):Ci=ir(),Ci&&Ci.box&&Ci.box.length)break}else Ci=ir()};if(P.get("text-variable-anchor")){let ir=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[fn]){const kr=this.prevPlacement.variableOffsets[fn];ir.indexOf(kr.anchor)>0&&(ir=ir.filter(Oa=>Oa!==kr.anchor),ir.unshift(kr.anchor))}const ao=(kr,Oa,ps)=>{const Ra=S.getSymbolInstanceTextSize(de,wt,this.transform.zoom,It),Wd=(kr.x2-kr.x1)*Ra+2*kr.padding,wu=(kr.y2-kr.y1)*Ra+2*kr.padding,Ec=wt.hasIconTextFit&&!Oe?Oa:null;Ec&&Ho(Ec);let vd={box:[],offscreen:!1,occluded:!1};const fh=Ie?2*ir.length:ir.length;for(let Qc=0;Qc<fh;++Qc){const bd=this.attemptAnchorPlacement(ir[Qc%ir.length],kr,Wd,wu,Ra,Te,Be,Q,V,be,Qc>=ir.length,wt,It,S,ps,Ec,de,le);if(bd&&(vd=bd.placedGlyphBoxes,vd&&vd.box&&vd.box.length)){mn=!0,hr=bd.shift;break}}return vd};Xr(()=>ao(vo,Lt.iconBox,p.bI.horizontal),()=>{const kr=Lt.verticalTextBox;return kr&&Ho(kr),S.allowVerticalPlacement&&!(Ci&&Ci.box&&Ci.box.length)&&bn>0&&kr?ao(kr,Lt.verticalIconBox,p.bI.vertical):{box:null,offscreen:null,occluded:null}}),Ci&&(mn=Ci.box,qn=Ci.offscreen,xi=Ci.occluded);const us=Vi(!(!Ci||!Ci.box));if(!mn&&this.prevPlacement){const kr=this.prevPlacement.variableOffsets[fn];kr&&(this.variableOffsets[fn]=kr,this.markUsedJustification(S,kr.anchor,wt,us))}}else{const ir=(ao,us)=>{const kr=S.getSymbolInstanceTextSize(de,wt,this.transform.zoom,It,M),Oa=this.collisionIndex.placeCollisionBox(S,kr,ao,new p.P(0,0),Ie,Q,V,be.predicate);return Oa&&Oa.box&&Oa.box.length&&(this.markUsedOrientation(S,us,wt),this.placedOrientations[fn]=us),Oa};Xr(()=>ir(vo,p.bI.horizontal),()=>{const ao=Lt.verticalTextBox;return S.allowVerticalPlacement&&bn>0&&ao?(Ho(ao),ir(ao,p.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Vi(!!(Ci&&Ci.box&&Ci.box.length))}}if(fo=Ci,mn=fo&&fo.box&&fo.box.length>0,qn=fo&&fo.offscreen,xi=fo&&fo.occluded,wt.useRuntimeCollisionCircles){const Vi=S.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),Xr=p.bJ(S.textSizeData,de,Vi),ir=P.get("text-padding");ni=this.collisionIndex.placeCollisionCircles(S,Ie,Vi,S.lineVertexArray,S.glyphOffsetArray,Xr,V,U,X,_,Be,be.predicate,wt.collisionCircleDiameter*Xr/p.bO,ir,this.retainedQueryData[S.bucketInstanceId].tileID),mn=Ie||ni.circles.length>0&&!ni.collisionDetected,qn=qn&&ni.offscreen,xi=ni.occluded}if(Lt.iconFeatureIndex&&(oo=Lt.iconFeatureIndex),Lt.iconBox){const Vi=Xr=>{Ho(Xr);const ir=wt.hasIconTextFit&&hr?cd(hr.x,hr.y,Te,Be,this.transform.angle):new p.P(0,0),ao=S.getSymbolInstanceIconSize(le,this.transform.zoom,wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ao,Xr,ir,Oe,Q,V,be.predicate)};Lo&&Lo.box&&Lo.box.length&&Lt.verticalIconBox?(Li=Vi(Lt.verticalIconBox),Dn=Li.box.length>0):(Li=Vi(Lt.iconBox),Dn=Li.box.length>0),qn=qn&&Li.offscreen,xr=Li.occluded}const so=De||0===wt.numHorizontalGlyphVertices&&0===bn,ai=Le||0===wt.numIconVertices;if(so||ai?ai?so||(Dn=Dn&&mn):mn=Dn&&mn:Dn=mn=Dn&&mn,mn&&fo&&fo.box&&this.collisionIndex.insertCollisionBox(fo.box,P.get("text-ignore-placement"),S.bucketInstanceId,Lo&&Lo.box&&wr?wr:qi,be.ID),Dn&&Li&&this.collisionIndex.insertCollisionBox(Li.box,P.get("icon-ignore-placement"),S.bucketInstanceId,oo,be.ID),ni&&(mn&&this.collisionIndex.insertCollisionCircles(ni.circles,P.get("text-ignore-placement"),S.bucketInstanceId,qi,be.ID),_)){const Vi=S.bucketInstanceId;let Xr=this.collisionCircleArrays[Vi];void 0===Xr&&(Xr=this.collisionCircleArrays[Vi]=new yn);for(let ir=0;ir<ni.circles.length;ir+=4)Xr.circles.push(ni.circles[ir+0]),Xr.circles.push(ni.circles[ir+1]),Xr.circles.push(ni.circles[ir+2]),Xr.circles.push(ni.collisionDetected?1:0)}const Hr="globe"!==S.projection.name;Ke=Ke&&(Hr||!xi),xt=xt&&(Hr||!xr),this.placements[fn]=new Fi(mn||Ke,Dn||xt,qn||S.justReloaded),h.add(fn)};if("offset"===S.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),"road"===S.elevationType&&S.updateRoadElevation(),S.updateZOffset(),S.sortFeaturesByY){const wt=S.getSortedSymbolIndexes(this.transform.angle);for(let It=wt.length-1;It>=0;--It){const Lt=wt[It];Ot(S.symbolInstances.get(Lt),Lt,S.collisionArrays[Lt])}S.hasAnyZOffset&&p.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const wt=S.getSortedIndexesByZOffset();for(let It=0;It<wt.length;++It){const Lt=wt[It];Ot(S.symbolInstances.get(Lt),Lt,S.collisionArrays[Lt])}}else for(let wt=a.symbolInstanceStart;wt<a.symbolInstanceEnd;wt++)Ot(S.symbolInstances.get(wt),wt,S.collisionArrays[wt]);if(_&&S.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[S.bucketInstanceId];p.bi(wt.invProjMatrix,V),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(a,h,_,w){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O,crossTileID:V}=_,U=p.bT(h),X=w===p.bI.vertical?O:"left"===U?M:"center"===U?S:"right"===U?P:-1;M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=X>=0&&M!==X?0:V),S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=X>=0&&S!==X?0:V),P>=0&&(a.text.placedSymbolArray.get(P).crossTileID=X>=0&&P!==X?0:V),O>=0&&(a.text.placedSymbolArray.get(O).crossTileID=X>=0&&O!==X?0:V)}markUsedOrientation(a,h,_){const w=h===p.bI.horizontal||h===p.bI.horizontalOnly?h:0,M=h===p.bI.vertical?h:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:V}=_,U=a.text.placedSymbolArray;S>=0&&(U.get(S).placedOrientation=w),P>=0&&(U.get(P).placedOrientation=w),O>=0&&(U.get(O).placedOrientation=w),V>=0&&(U.get(V).placedOrientation=M)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(a):1,M=h?h.opacities:{},S=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(const O in this.placements){const V=this.placements[O],U=M[O];U?(this.opacities[O]=new ld(U,w,V.text,V.icon,null,V.clipped),_=_||V.text!==U.text.placed||V.icon!==U.icon.placed):(this.opacities[O]=new ld(null,w,V.text,V.icon,V.skipFade,V.clipped),_=_||V.text||V.icon)}for(const O in M){const V=M[O];if(!this.opacities[O]){const U=new ld(V,w,!1,!1);U.isHidden()||(this.opacities[O]=U,_=_||V.text.placed||V.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h,_,w){const M=new Set;for(const S of h){const P=S.getBucket(a);P&&S.latestFeatureIndex&&a.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,M,S,S.collisionBoxArray,_,w,S.tileID,a.scope),"offset"===P.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,S.tileID),"road"===P.elevationType&&P.updateRoadElevation(),P.updateZOffset())}}updateBucketOpacities(a,h,_,w,M,S,P,O){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const V=a.layers[0].layout,U=a.layers[0].paint,X=!!a.layers[0].dynamicFilter(),G=new ld(null,0,!1,!1,!0),Q=V.get("text-allow-overlap"),se=V.get("icon-allow-overlap"),oe=V.get("text-variable-anchor"),de="map"===V.get("text-rotation-alignment"),le="map"===V.get("text-pitch-alignment"),be=U.get("symbol-z-offset"),Me="sea"===V.get("symbol-elevation-reference"),De=!be.isConstant(),Le=new ld(null,0,Q&&(se||!a.hasIconData()||V.get("icon-optional")),se&&(Q||!a.hasTextData()||V.get("text-optional")),!0);!a.collisionArrays&&w&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(w);const Ie=(Te,Be,Ve)=>{for(let ct=0;ct<Be/4;ct++)Te.opacityVertexArray.emplaceBack(Ve)};let Oe=0;S&&a.updateReplacement(P,S);for(let Te=0;Te<a.symbolInstances.length;Te++){const Be=a.symbolInstances.get(Te),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:ct,crossTileID:Ye,numIconVertices:kt,tileAnchorX:vt,tileAnchorY:Pt}=Be;let Je=null;const ot=this.retainedQueryData[a.bucketInstanceId];De&&Be&&ot&&(Je=_.latestFeatureIndex.loadFeature({featureIndex:Be.featureIndex,bucketIndex:ot.bucketIndex,sourceLayerIndex:ot.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ke=be.evaluate(Je,{}),xt=h.has(Ye);let dt=this.opacities[Ye];xt?dt=G:dt||(dt=Le,this.opacities[Ye]=dt),h.add(Ye);const Ot=Ve>0||ct>0,wt=kt>0,It=this.placedOrientations[Ye],Lt=It===p.bI.vertical,fn=It===p.bI.horizontal||It===p.bI.horizontalOnly;!Ot&&!wt||dt.isHidden()||Oe++;let bn=!1;if((Ot||wt)&&S)for(const dn of a.activeReplacements){if(p.bP(dn,M,p.bQ.Symbol,O)||dn.min.x>vt||vt>dn.max.x||dn.min.y>Pt||Pt>dn.max.y)continue;const an=p.bR(vt,Pt,P.canonical,dn.footprintTileId.canonical);if(bn=p.bS(an,dn.footprint),bn)break}if(Ot){const dn=bn?xl:qc(dt.text);Ie(a.text,Ve,Lt?xl:dn),Ie(a.text,ct,fn?xl:dn);const an=dt.text.isHidden(),{leftJustifiedTextSymbolIndex:mn,centerJustifiedTextSymbolIndex:Dn,rightJustifiedTextSymbolIndex:qn,verticalPlacedTextSymbolIndex:xi}=Be,xr=a.text.placedSymbolArray,hr=an||Lt?1:0;mn>=0&&(xr.get(mn).hidden=hr),Dn>=0&&(xr.get(Dn).hidden=hr),qn>=0&&(xr.get(qn).hidden=hr),xi>=0&&(xr.get(xi).hidden=an||fn?1:0);const Ci=this.variableOffsets[Ye];Ci&&this.markUsedJustification(a,Ci.anchor,Be,It);const Lo=this.placedOrientations[Ye];Lo&&(this.markUsedJustification(a,"left",Be,Lo),this.markUsedOrientation(a,Lo,Be))}if(wt){const dn=bn?xl:qc(dt.icon),{placedIconSymbolIndex:an,verticalPlacedIconSymbolIndex:mn}=Be,Dn=a.icon.placedSymbolArray,qn=dt.icon.isHidden()?1:0;an>=0&&(Ie(a.icon,kt,Lt?xl:dn),Dn.get(an).hidden=qn),mn>=0&&(Ie(a.icon,Be.numVerticalIconVertices,fn?xl:dn),Dn.get(mn).hidden=qn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const dn=a.collisionArrays[Te];if(dn){let an=new p.P(0,0),mn=!0;if(dn.textBox||dn.verticalTextBox){if(oe){const qn=this.variableOffsets[Ye];qn?(an=Da(qn.anchor,qn.width,qn.height,qn.textOffset,qn.textScale),de&&an._rotate(le?this.transform.angle:-this.transform.angle)):mn=!1}X&&(mn=!dt.clipped),dn.textBox&&zd(a.textCollisionBox.collisionVertexArray,dt.text.placed,!mn||Lt,Ke,Me,an.x,an.y),dn.verticalTextBox&&zd(a.textCollisionBox.collisionVertexArray,dt.text.placed,!mn||fn,Ke,Me,an.x,an.y)}const Dn=mn&&!(fn||!dn.verticalIconBox);dn.iconBox&&zd(a.iconCollisionBox.collisionVertexArray,dt.icon.placed,Dn,Ke,Me,Be.hasIconTextFit?an.x:0,Be.hasIconTextFit?an.y:0),dn.verticalIconBox&&zd(a.iconCollisionBox.collisionVertexArray,dt.icon.placed,!Dn,Ke,Me,Be.hasIconTextFit?an.x:0,Be.hasIconTextFit?an.y:0)}}}if(a.fullyClipped=0===Oe,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Te.invProjMatrix,a.placementViewportMatrix=Te.viewportMatrix,a.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function zd(g,a,h,_,w,M,S){g.emplaceBack(a?1:0,h?1:0,M||0,S||0,_,w?1:0),g.emplaceBack(a?1:0,h?1:0,M||0,S||0,_,w?1:0),g.emplaceBack(a?1:0,h?1:0,M||0,S||0,_,w?1:0),g.emplaceBack(a?1:0,h?1:0,M||0,S||0,_,w?1:0)}const au=Math.pow(2,25),tn=Math.pow(2,24),Zs=Math.pow(2,17),To=Math.pow(2,16),$u=Math.pow(2,9),zl=Math.pow(2,8),bc=Math.pow(2,1);function qc(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const a=g.placed?1:0,h=Math.floor(127*g.opacity);return h*au+a*tn+h*Zs+a*To+h*$u+a*zl+h*bc+a}const xl=0;class ia{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,_,w,M,S){const P=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(P,w,a[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,V)=>O.sortKey-V.sortKey));this._currentPartIndex<P.length;){const O=P[this._currentPartIndex];if(h.placeLayerBucketPart(O,this._seenCrossTileIDs,_,0===O.symbolInstanceStart,S),this._currentPartIndex++,M())return!0}return!1}}class Ta{constructor(a,h,_,w,M,S,P,O,V){this.placement=new Hn(a,M,S,P,O,V),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_,w,M){const S=p.q.now(),P=()=>{const O=p.q.now()-S;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=h[a[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=V)&&(!O.maxzoom||O.maxzoom>V)){const U=O,X=U.layout.get("symbol-z-elevate"),G=void 0!==U.layout.get("symbol-sort-key").constantOr(1),Q=U.layout.get("symbol-z-order"),se="viewport-y"===Q||"auto"===Q&&!("viewport-y"!==Q&&G),oe=U.layout.get("text-allow-overlap")||U.layout.get("icon-allow-overlap")||U.layout.get("text-ignore-placement")||U.layout.get("icon-ignore-placement"),de=se&&oe,le=this._inProgressLayer=this._inProgressLayer||new ia(U),be=p.C(O.source,O.scope);if(le.continuePlacement(X||de?w[be]:_[be],this.placement,this._showCollisionBoxes,O,P,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Nl=512/p.aj/2;class ja{constructor(a,h,_){this.tileID=a,this.bucketInstanceId=_,this.index=new p.bW(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=a.canonical.x*p.aj,M=a.canonical.y*p.aj;for(let S=0;S<h.length;S++){const{key:P,crossTileID:O,tileAnchorX:V,tileAnchorY:U}=h.get(S),X=Math.floor((w+V)*Nl),G=Math.floor((M+U)*Nl);this.index.add(X,G),this.keys.push(P),this.crossTileIDs.push(O)}this.index.finish()}findMatches(a,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),M=Nl/Math.pow(2,h.canonical.z-this.tileID.canonical.z),S=h.canonical.x*p.aj,P=h.canonical.y*p.aj;for(let O=0;O<a.length;O++){const V=a.get(O);if(V.crossTileID)continue;const{key:U,tileAnchorX:X,tileAnchorY:G}=V,Q=Math.floor((S+X)*M),se=Math.floor((P+G)*M),oe=this.index.range(Q-w,se-w,Q+w,se+w).sort((de,le)=>de-le);for(const de of oe){const le=this.crossTileIDs[de];if(this.keys[de]===U&&!_.has(le)){_.add(le),V.crossTileID=le;break}}}}}class $c{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ql{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],M={};for(const S in w){const P=w[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),M[P.tileID.key]=P}this.indexes[_]=M}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let M=0;M<h.symbolInstances.length;M++)h.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const w=this.usedCrossTileIDs[a.overscaledZ];for(const M in this.indexes){const S=this.indexes[M];if(Number(M)>a.overscaledZ)for(const P in S){const O=S[P];O.tileID.isChildOf(a)&&O.findMatches(h.symbolInstances,a,w)}else{const P=S[a.scaledTo(Number(M)).key];P&&P.findMatches(h.symbolInstances,a,w)}}for(let M=0;M<h.symbolInstances.length;M++){const S=h.symbolInstances.get(M);S.crossTileID||(S.crossTileID=_.generate(),w.add(S.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new ja(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const M in w)a[w[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[M]),delete w[M],h=!0)}return h}}class Vo{constructor(){this.layerIndexes={},this.crossTileIDs=new $c,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_,w){let M=this.layerIndexes[a.fqid];void 0===M&&(M=this.layerIndexes[a.fqid]=new Ql);let S=!1;const P={};"globe"!==w.name&&M.handleWrapJump(_);for(const O of h){const V=O.getBucket(a);V&&a.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(O.tileID,V,this.crossTileIDs)&&(S=!0),P[V.bucketInstanceId]=!0)}return M.removeStaleBuckets(P)&&(S=!0),S}pruneUnusedLayers(a){const h={};a.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}class Yn{constructor(a,h,_,w){this.blendFunction=a,this.blendColor=h,this.mask=_,this.blendEquation=w}}Yn.Replace=[1,0,1,0],Yn.disabled=new Yn(Yn.Replace,p.am.transparent,[!1,!1,!1,!1]),Yn.unblended=new Yn(Yn.Replace,p.am.transparent,[!0,!0,!0,!0]),Yn.alphaBlended=new Yn([1,771,1,771],p.am.transparent,[!0,!0,!0,!0]),Yn.alphaBlendedNonPremultiplied=new Yn([770,771,770,771],p.am.transparent,[!0,!0,!0,!0]),Yn.multiply=new Yn([774,0,774,0],p.am.transparent,[!0,!0,!0,!0]);class rn{constructor(a,h,_){this.func=a,this.mask=h,this.range=_}}rn.ReadOnly=!1,rn.ReadWrite=!0,rn.disabled=new rn(519,rn.ReadOnly,[0,1]);class kn{constructor(a,h,_,w,M,S){this.test=a,this.ref=h,this.mask=_,this.fail=w,this.depthFail=M,this.pass=S}}kn.disabled=new kn({func:519,mask:0},0,0,7680,7680,7680);class Ln{constructor(a,h,_){this.enable=a,this.mode=h,this.frontFace=_}}function Dt(g,a){const h=p.c1(g,3);p.c3(g,a),p.c7(g,3,h)}function wl(g,a){const h=p.bY([]);return p.bZ(h,h,-a),p.b_(h,h,-g),h}function Rn(g,a){const h=[g[0],g[1],0],_=[a[0],a[1],0];if(p.ae(h)>=1e-15){const S=p.au([],h);p.b$(_,S,p.bE(_,S)),a[0]=_[0],a[1]=_[1]}const w=p.bG([],a,g);if(p.c0(w)<1e-15)return null;const M=Math.atan2(-w[1],w[0]);return wl(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),M)}Ln.disabled=new Ln(!1,1029,2305),Ln.backCCW=new Ln(!0,1029,2305),Ln.backCW=new Ln(!0,1029,2304),Ln.frontCW=new Ln(!0,1028,2304),Ln.frontCCW=new Ln(!0,1028,2305);class dd{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof p.ac?a:new p.ac(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=p.bX(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const _=this.position,w=this._elevation?this._elevation.getAtPointOrZero(p.ac.fromLngLat(a)):0,M=p.ac.fromLngLat(a,w),S=[M.x-_.x,M.y-_.y,M.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Rn(S,h)}setPitchBearing(a,h){this.orientation=wl(p.al(a),p.al(-h))}}class ds{constructor(a,h){this._transform=p.bx([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new p.ac(a[0],a[1],a[2])}get position(){const a=p.c1(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&p.c7(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||p.bY([]),a&&Dt(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=wl(a,h),Dt(this._transform,this._orientation)}forward(){const a=p.c1(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=p.c1(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=p.c1(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const _=new Float64Array(16);return p.bi(_,this.getWorldToCamera(a,h)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,h,_){const w=this.position;p.b$(w,w,-a);const M=new Float64Array(16);return p.bn(M,[_,_,_]),p.bo(M,M,w),M[10]*=h,M}getWorldToCamera(a,h){const _=new Float64Array(16),w=new Float64Array(4),M=this.position;return p.c2(w,this._orientation),p.b$(M,M,-a),p.c3(_,w),p.bo(_,_,M),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(a,h,_,w){const M=new Float64Array(16);return p.c4(M,a,h,_,w),M}getCameraToClipOrthographic(a,h,_,w,M,S){const P=new Float64Array(16);return p.c5(P,a,h,_,w,M,S),P}getDistanceToElevation(a,h=!1){const _=0===a?0:p.c6(a,h?p.aY(this.position[1]):this.position[1]),w=this.forward();return(_-this.position[2])/w[2]}clone(){return new ds([...this.position],[...this.orientation])}}const Ds={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class tl{constructor(a=0,h=0,_=0,w=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=w}interpolate(a,h,_){return null!=h.top&&null!=a.top&&(this.top=p.ai(a.top,h.top,_)),null!=h.bottom&&null!=a.bottom&&(this.bottom=p.ai(a.bottom,h.bottom,_)),null!=h.left&&null!=a.left&&(this.left=p.ai(a.left,h.left,_)),null!=h.right&&null!=a.right&&(this.right=p.ai(a.right,h.right,_)),this}getCenter(a,h){const _=p.aD((this.left+a-this.right)/2,0,a),w=p.aD((this.top+h-this.bottom)/2,0,h);return new p.P(_,w)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new tl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Bd{constructor(a,h,_,w,M,S,P){this.tileSize=512,this._renderWorldCopies=void 0===M||M,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=w??60,this.setProjection(S),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new p.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ds,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Bd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(a,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.aF(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.ce(this.projectionOptions);const _=this.getProjection(),w=!p.bv(h,_);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.ce({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.P(this.width,this.height)}get bearing(){return p.bX(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=p.cf(),p.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=p.aD(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=p.al(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,M=0;for(let S=0;S<h.length;S++){const P=new p.P(h[S][0]*this.width,_+h[S][1]*(this.height-_)),O=a.pointCoordinate(P);if(!O)continue;const V=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);w+=O[3]*V,M+=V}return 0===M?NaN:w/M}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(a),M=this._mercatorZfromZoom(this._maxZoom),S=Math.max(w-_,M);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const w=p.ae(p.at([],this._camera.position,_));return p.aD(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!p.ch(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];p.ci(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new dd;return h.position=new p.ac(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!p.cj(a))return!1;p.ck(a,a);const h=p.cl([],[0,0,-1],a),_=p.cl([],[0,-1,0],a);if(_[2]<0)return!1;const w=Rn(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;a[2]=p.aD(a[2],w/_,w/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new p.cm(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.P(0,0)),w=this.pointCoordinate(new p.P(this.width,0)),M=this.pointCoordinate(new p.P(this.width,this.height)),S=this.pointCoordinate(new p.P(0,this.height)),P=Math.floor(Math.min(_.x,w.x,M.x,S.x)),O=Math.floor(Math.max(_.x,w.x,M.x,S.x)),V=1;for(let U=P-V;U<=O+V;U++)0!==U&&h.push(new p.cm(U,a))}return h}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,h,_){let w=[];const M=null!=_,S=!M;if(S&&this.zoom<h||M&&0===_[0]&&0===_[1])return w;const P=new Set,O=(U,X,G,Q,se)=>{const oe=p.cK(X,U,G,Q,se);P.has(oe)||(w.push(new p.aM(U,X,G,Q,se)),P.add(oe))};for(let U=0;U<a.length;U++){const X=a[U];if(S&&X.canonical.z!==h)continue;const G=X.canonical,Q=X.overscaledZ,se=X.wrap,oe=1<<G.z,de=G.x+1<oe,le=G.x>0,be=G.y+1<oe,Me=G.y>0,De=X.wrap-(le?0:1),Le=X.wrap+(de?0:1),Ie=le?G.x-1:oe-1,Oe=de?G.x+1:0;if(M)_[0]<0?(O(Q,Le,G.z,Oe,G.y),_[1]<0&&be&&(O(Q,se,G.z,G.x,G.y+1),O(Q,Le,G.z,Oe,G.y+1)),_[1]>0&&Me&&(O(Q,se,G.z,G.x,G.y-1),O(Q,Le,G.z,Oe,G.y-1))):_[0]>0?(O(Q,De,G.z,Ie,G.y),_[1]<0&&be&&(O(Q,se,G.z,G.x,G.y+1),O(Q,De,G.z,Ie,G.y+1)),_[1]>0&&Me&&(O(Q,se,G.z,G.x,G.y-1),O(Q,De,G.z,Ie,G.y-1))):_[1]<0&&be?O(Q,se,G.z,G.x,G.y+1):Me&&O(Q,se,G.z,G.x,G.y-1);else{const Te=X.visibleQuadrants;1&Te&&(O(Q,De,G.z,Ie,G.y),Me&&(O(Q,se,G.z,G.x,G.y-1),O(Q,De,G.z,Ie,G.y-1))),2&Te&&(O(Q,Le,G.z,Oe,G.y),Me&&(O(Q,se,G.z,G.x,G.y-1),O(Q,Le,G.z,Oe,G.y-1))),4&Te&&(O(Q,De,G.z,Ie,G.y),be&&(O(Q,se,G.z,G.x,G.y+1),O(Q,De,G.z,Ie,G.y+1))),8&Te&&(O(Q,Le,G.z,Oe,G.y),be&&(O(Q,se,G.z,G.x,G.y+1),O(Q,Le,G.z,Oe,G.y+1)))}}const V=[];for(const U of w)w.some(X=>U.isChildOf(X))||V.push(U);if(w=V.filter(U=>!a.some(X=>!!(U.overscaledZ<h&&X.isChildOf(U))||U.equals(X)||U.isChildOf(X))),S){const U=1<<h,X="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=[U*X.x,U*X.y],Q=4,se=Q*Q;w=w.filter(oe=>{const de=oe.canonical.x+.5-G[0],le=oe.canonical.y+.5-G[1];return de*de+le*le<se})}return w}coveringTiles(a){let h=this.coveringZoomLevel(a);const _=h,w=this.elevation&&this.elevation.exaggeration(),M=w&&!a.isTerrainDEM,S="mercator"===this.projection.name;if(void 0!==a.minzoom&&h<a.minzoom)return[];void 0!==a.maxzoom&&h>a.maxzoom&&(h=a.maxzoom);const P=this.locationCoordinate(this.center),O=this.center.lat,V=1<<h,U=[V*P.x,V*P.y,0],X="globe"===this.projection.name,G=!X,Q=p.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,G),se=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=V*p.c6(1,this.center.lat),de=this._camera.position[2]/p.c6(1,this.center.lat),le=[V*se.x,V*se.y,de*(G?1:oe)],be=X||w,Me=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),De=this.isLODDisabled(!0)?h:0;let Le;if(this._elevation&&a.isTerrainDEM)Le=1e4*this._elevation.exaggeration();else if(this._elevation){const Ke=this._elevation.getMinMaxForVisibleTiles();Le=Ke?Ke.max:this._centerAltitude}else Le=this._centerAltitude;const Ie=a.isTerrainDEM?-Le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Oe=this.projection.isReprojectedInTileSpace?p.co(this):1,Te=Ke=>{const dt=new p.ac(Ke.x+25e-6,Ke.y,Ke.z),Ot=new p.ac(Ke.x,Ke.y+25e-6,Ke.z),wt=Ke.toLngLat(),It=dt.toLngLat(),Lt=Ot.toLngLat(),fn=this.locationCoordinate(wt),bn=this.locationCoordinate(It),dn=this.locationCoordinate(Lt),an=Math.hypot(bn.x-fn.x,bn.y-fn.y),mn=Math.hypot(dn.x-fn.x,dn.y-fn.y);return Math.sqrt(an*mn)*Oe/25e-6},Be=Ke=>{const xt=Le,dt=Ie;return{aabb:p.cr(this,V,0,0,0,Ke,dt,xt,this.projection),zoom:0,x:0,y:0,minZ:dt,maxZ:xt,wrap:Ke,fullyVisible:!1}},Ve=[];let ct=[];const Ye=h,kt=a.reparseOverscaled?_:h,vt=(de-this._centerAltitude)*oe,Pt=Ke=>{if(!this._elevation||!Ke.tileID||!S)return;const xt=this._elevation.getMinMaxForTile(Ke.tileID),dt=Ke.aabb;xt?(dt.min[2]=xt.min,dt.max[2]=xt.max,dt.center[2]=(dt.min[2]+dt.max[2])/2):(Ke.shouldSplit=ot(Ke),Ke.shouldSplit||(dt.min[2]=dt.max[2]=dt.center[2]=this._centerAltitude))},Je=(Ke,xt)=>{if(.707*xt<Ke)return 1;const dt=xt/Ke;return dt/(1.4144271570014144+(Math.pow(1.1,dt-1.4144271570014144+1)-1)/(1.1-1)-1)},ot=Ke=>{if(Ke.zoom<De)return!0;if(Ke.zoom===Ye)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const xt=Ke.aabb.distanceX(le),dt=Ke.aabb.distanceY(le);let Ot=vt,wt=1;if(X){Ot=Ke.aabb.distanceZ(le);const mn=Math.pow(2,Ke.zoom),Dn=p.aY((Ke.y+1)/mn),qn=p.aY(Ke.y/mn),xi=Math.min(Math.max(O,Dn),qn),xr=p.cP(xi)/p.cP(O);if(wt=xi===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xr/this._mercatorScaleRatio),this.zoom<=p.cL&&Ke.zoom===Ye-1&&xr>=.9)return!0}else if(M&&(Ot=Ke.aabb.distanceZ(le)*oe),this.projection.isReprojectedInTileSpace&&_<=5){const mn=Math.pow(2,Ke.zoom),Dn=Te(new p.ac((Ke.x+.5)/mn,(Ke.y+.5)/mn));wt=Dn>.85?1:Dn}if(!S){const mn=Math.sqrt(xt*xt+dt*dt+Ot*Ot);let Dn=(1<<Ye-Ke.zoom)*Me*wt;return Dn*=Je(Math.max(Ot,vt),mn),mn<Dn}let It=Number.MAX_VALUE,Lt=0;const fn=Ke.aabb.getCorners(),bn=[];for(const mn of fn){p.at(bn,mn,le),X||(M?bn[2]*=oe:bn[2]=vt);const Dn=p.bE(bn,this._camera.forward());Dn<It&&(It=Dn,Lt=Math.abs(bn[2]))}let dn=(1<<Ye-Ke.zoom)*Me*wt;if(dn*=Je(Math.max(Lt,vt),It),It<dn)return!0;const an=Ke.aabb.closestPoint(U);return an[0]===U[0]&&an[1]===U[1]};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)Ve.push(Be(-Ke)),Ve.push(Be(Ke));for(Ve.push(Be(0));Ve.length>0;){const Ke=Ve.pop(),xt=Ke.x,dt=Ke.y;let Ot=Ke.fullyVisible;const wt=()=>"globe"===this.projection.name&&(0===Ke.y||Ke.y===(1<<Ke.zoom)-1);if(!Ot){let It=be?Ke.aabb.intersects(Q):Ke.aabb.intersectsFlat(Q);if(0===It&&wt()){const Lt=new p.cp(Ke.zoom,xt,dt);It=p.cq(this,V,Lt,!0).intersects(Q)}if(0===It)continue;Ot=2===It}if(Ke.zoom!==Ye&&ot(Ke))for(let It=0;It<4;It++){const Lt=(xt<<1)+It%2,fn=(dt<<1)+(It>>1),bn={aabb:S?Ke.aabb.quadrant(It):p.cr(this,V,Ke.zoom+1,Lt,fn,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:Lt,y:fn,wrap:Ke.wrap,fullyVisible:Ot,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};M&&!X&&(bn.tileID=new p.aM(Ke.zoom+1===Ye?kt:Ke.zoom+1,Ke.wrap,Ke.zoom+1,Lt,fn),Pt(bn)),Ve.push(bn)}else{const It=Ke.zoom===Ye?kt:Ke.zoom;if(a.minzoom&&a.minzoom>It)continue;let Lt=0;if(!Ot){let an=be?Ke.aabb.intersectsPrecise(Q):Ke.aabb.intersectsPreciseFlat(Q);if(0===an&&wt()){const mn=new p.cp(Ke.zoom,xt,dt);an=p.cq(this,V,mn,!0).intersectsPrecise(Q)}if(0===an)continue;if(a.calculateQuadrantVisibility)if(Q.containsPoint(Ke.aabb.center))Lt=15;else for(let mn=0;mn<4;mn++)0!==Ke.aabb.quadrant(mn).intersects(Q)&&(Lt|=1<<mn)}const fn=U[0]-(.5+xt+(Ke.wrap<<Ke.zoom))*(1<<h-Ke.zoom),bn=U[1]-.5-dt,dn=Ke.tileID?Ke.tileID:new p.aM(It,Ke.wrap,Ke.zoom,xt,dt);a.calculateQuadrantVisibility&&(dn.visibleQuadrants=Lt),ct.push({tileID:dn,distanceSq:fn*fn+bn*bn})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,xt=this.horizonLineFromTop();ct=ct.filter(dt=>{const Ot=[0,0,0,1],wt=[p.aj,p.aj,0,1],It=this.calculateFogTileMatrix(dt.tileID.toUnwrapped());p.aA(Ot,Ot,It),p.aA(wt,wt,It);const Lt=p.cs([],Ot,wt),fn=p.ct([],Ot,wt),bn=p.cM(Lt,fn);if(0===bn)return!0;let dn=!1;const an=this._elevation;if(an&&bn>Ke&&0!==xt){const mn=this.calculateProjMatrix(dt.tileID.toUnwrapped());let Dn;a.isTerrainDEM||(Dn=an.getMinMaxForTile(dt.tileID)),Dn||(Dn={min:Ie,max:Le});const qn=p.cu(this.rotation),xi=[qn[0]*p.aj,qn[1]*p.aj,Dn.max];p.ad(xi,xi,mn),dn=(1-xi[1])*this.height*.5<xt}return bn<Ke||dn})}return ct.sort((Ke,xt)=>Ke.distanceSq-xt.distanceSq).map(Ke=>Ke.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=p.aD(a.lat,-p.cv,p.cv),_=this.projection.project(a.lng,h);return new p.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let _,w;const M=this.centerPoint;if("globe"===this.projection.name){const P=this.worldSize;_=(h.x-M.x)/P,w=(h.y-M.y)/P}else{const P=this.pointCoordinate(h),O=this.pointCoordinate(M);_=P.x-O.x,w=P.y-O.y}const S=this.locationCoordinate(a);this.setLocation(new p.ac(S.x-_,S.y-w))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,h){return this.projection.locationPoint(this,a,h)}locationPoint3D(a,h){return this.projection.locationPoint(this,a,h,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,h){return this.coordinateLocation(this.pointCoordinate3D(a,h))}locationCoordinate(a,h){const _=h?p.c6(h,a.lat):void 0,w=this.projection.project(a.lng,a.lat);return new p.ac(w.x,w.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const _=h??this._centerAltitude,w=[a.x,a.y,0,1],M=[a.x,a.y,1,1];p.aA(w,w,this.pixelMatrixInverse),p.aA(M,M,this.pixelMatrixInverse);const S=M[3];p.cw(w,w,1/w[3]),p.cw(M,M,1/S);const P=w[2],O=M[2];return{p0:w,p1:M,t:P===O?0:(_-P)/(O-P)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return p.aA(h,h,this.pixelMatrixInverse),p.aA(_,_,this.pixelMatrixInverse),p.cw(h,h,1/h[3]),p.cw(_,_,1/_[3]),h[2]=p.c6(h[2],this._center.lat)*this.worldSize,_[2]=p.c6(_[2],this._center.lat)*this.worldSize,p.cw(h,h,1/this.worldSize),p.cw(_,_,1/this.worldSize),new p.av([h[0],h[1],h[2]],p.au([],p.at([],_,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:_,t:w}=a,M=p.c6(h[2],this._center.lat),S=p.c6(_[2],this._center.lat);return new p.ac(p.ai(h[0],_[0],w)/this.worldSize,p.ai(h[1],_[1],w)/this.worldSize,p.ai(M,S,w))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a,h){if(!this.elevation)return this.pointCoordinate(a,h);let _=this.projection.pointCoordinate3D(this,a.x,a.y);if(_)return new p.ac(_[0],_[1],_[2]);let w=0,M=this.horizonLineFromTop();if(a.y>M)return this.pointCoordinate(a,h);const S=.02*M,P=a.clone();for(let O=0;O<10&&M-w>S;O++){P.y=p.ai(w,M,.66);const V=this.projection.pointCoordinate3D(this,P.x,P.y);V?(M=P.y,_=V):w=P.y}return _?new p.ac(_[0],_[1],_[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=p.cx)return!this.isPointAboveHorizon(a);const h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,w=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return p.aA(w,w,this.pixelMatrix),w[3]>0?new p.P(w[0]/w[3],w[1]/w[3]):new p.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,M=this.pointLocation3D(new p.P(h,a)),S=this.pointLocation3D(new p.P(w,a)),P=this.pointLocation3D(new p.P(w,_)),O=this.pointLocation3D(new p.P(h,_));let V=Math.min(M.lng,S.lng,P.lng,O.lng),U=Math.max(M.lng,S.lng,P.lng,O.lng),X=Math.min(M.lat,S.lat,P.lat,O.lat),G=Math.max(M.lat,S.lat,P.lat,O.lat);const Q=Math.pow(2,-this.zoom)/16*270,se="globe"===this.projection.name?1:4,oe=(de,le,be,Me,De)=>{const Le=(de+be)/2,Ie=(le+Me)/2,Oe=new p.P(Le,Ie),{lng:Te,lat:Be}=this.pointLocation3D(Oe),Ve=Math.max(0,V-Te,X-Be,Te-U,Be-G);V=Math.min(V,Te),U=Math.max(U,Te),X=Math.min(X,Be),G=Math.max(G,Be),(De<se||Ve>Q)&&(oe(de,le,Le,Ie,De+1),oe(Le,Ie,be,Me,De+1))};if(oe(h,a,w,a,1),oe(w,a,w,_,1),oe(w,_,h,_,1),oe(h,_,h,a,1),"globe"===this.projection.name){const[de,le]=p.cy(this);de?(G=90,U=180,V=-180):le&&(X=-90,U=180,V=-180)}return new p.aG(new p.cd(V,X),new p.cd(U,G))}_getBoundsRectangular(a,h){const{top:_,left:w}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,P=new p.P(w,_),O=new p.P(S,_),V=new p.P(S,M),U=new p.P(w,M);let X=this.pointCoordinate(P,a),G=this.pointCoordinate(O,a);const Q=this.pointCoordinate(V,h),se=this.pointCoordinate(U,h),oe=(de,le)=>(le.y-de.y)/(le.x-de.x);return X.y>1&&G.y>=0?X=new p.ac((1-se.y)/oe(se,X)+se.x,1):X.y<0&&G.y<=1&&(X=new p.ac(-se.y/oe(se,X)+se.x,0)),G.y>1&&X.y>=0?G=new p.ac((1-Q.y)/oe(Q,G)+Q.x,1):G.y<0&&X.y<=1&&(G=new p.ac(-Q.y/oe(Q,G)+Q.x,0)),(new p.aG).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=a.visibleDemTiles.reduce((_,w)=>{if(w.dem){const M=w.dem.tree;_.min=Math.min(_.min,M.minimums[0]),_.max=Math.max(_.max,M.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-p.cv,this.maxLat=p.cv,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.ay(this.minLng)*this.tileSize,this.worldMaxX=p.ay(this.maxLng)*this.tileSize,this.worldMinY=p.aH(this.maxLat)*this.tileSize,this.worldMaxY=p.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=a.canonical,M=1/this.height,S=this.cameraWorldSize,P=S/this.zoomScale(w.z),O=(w.x+Math.pow(2,w.z)*a.wrap)*P,V=w.y*P,U=this.point;U.x*=S/this.worldSize,U.y*=S/this.worldSize;const X=this.angle,G=Math.sin(-X),Q=-Math.cos(-X);return _[h]={bearing:[G,Q],center:[(U.x-O)*M,(U.y-V)*M],scale:P/p.aj*M},_[h]}calculateFogTileMatrix(a){const h=a.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return p.az(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(a,h=!1,_=!1){const w=a.key;let M;if(M=_?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,M[w])return M[w];const S=this.calculatePosMatrix(a,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,p.az(S,P,S),M[w]=new Float32Array(S),M[w]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=p.cz(a,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,h=p.bn([],[a,a,a]);return p.az(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const h=p.c6(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),M=p.c6(1,this._center.lat);_[2]/=M,w[2]/=M,p.au(w,w);const S=a.raycast(_,w,a.exaggeration());if(S){const P=p.bF([],_,w,S),O=new p.ac(P[0],P[1],p.c6(P[2],p.aY(P[1]))),V=(O.z+p.ae([O.x-_[0],O.y-_[1],O.z-_[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const h=this._elevation,_=p.c6(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(_),M=h.getAtPointOrZero(new p.ac(...w)),S=this.pixelsPerMeter/this.worldSize*M,P=this._minimumHeightOverTerrain(),O=w[2]-S;if(O<=P)if(O<0||a){const V=this.locationCoordinate(this._center,this._centerAltitude),U=[w[0],w[1],V.z-w[2]],X=p.ae(U);U[2]-=(P-O)/this._pixelsPerMercatorPixel;const G=p.ae(U);if(0===G)return;p.b$(U,U,X/G*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],V.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const G=this.center;return G.lat=p.aD(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(G.lng=p.aD(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:w}=this.point;let M=0,S=_,P=w;const O=this.width/2,V=this.height/2,U=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(w-V<U&&(P=U+V),w+V>X&&(P=X-V),X-U<this.height&&(M=Math.max(M,this.height/(X-U)),P=(X+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,se=this.worldSize/2-(G+Q)/2;S=(_+se+this.worldSize)%this.worldSize-se,S-O<G&&(S=G+O),S+O>Q&&(S=Q-O),Q-G<this.width&&(M=Math.max(M,this.width/(Q-G)),S=(Q+G)/2)}S===_&&P===w||this._allowWorldUnderZoom||(this.center=this.unproject(new p.P(S,P))),M&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h="globe"===this.projection.name,_=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.c6(1,this.center.lat)/p.c6(1,p.cN));const w=p.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M="meters"===this.projection.zAxisUnit?_:1,S=this._camera.getWorldToCamera(this.worldSize,M);let P;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-a.x/this.width,O[9]=2*a.y/this.height,this.isOrthographic){let Be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ve=Be*this.aspect,ct=-Ve,Ye=-Be;Ve-=a.x,ct-=a.x,Be+=a.y,Ye+=a.y,P=this._camera.getCameraToClipOrthographic(ct,Ve,Ye,Be,this._nearZ,this._farZ),((kt,vt,Pt,Je)=>{for(let ot=0;ot<16;ot++)kt[ot]=p.ai(vt[ot],Pt[ot],Je)})(P,P,O,p.cO(this.pitch>=15?1:this.pitch/15))}else P=O;const V=p.cB([],O,S);let U=p.cB([],P,S);if(this.projection.isReprojectedInTileSpace){const Be=this.locationCoordinate(this.center),Ve=p.bx([]);p.bo(Ve,Ve,[Be.x*this.worldSize,Be.y*this.worldSize,0]),p.az(Ve,Ve,p.cC(this)),p.bo(Ve,Ve,[-Be.x*this.worldSize,-Be.y*this.worldSize,0]),p.az(U,U,Ve),p.az(V,V,Ve),this.inverseAdjustmentMatrix=p.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=p.cE([],U,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=U,this.invProjMatrix=p.bi(new Float64Array(16),this.projMatrix),h){const Be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Be[8]=2*-a.x/this.width,Be[9]=2*a.y/this.height,this.expandedFarZProjMatrix=p.cB([],Be,S)}else this.expandedFarZProjMatrix=this.projMatrix;const X=p.bi([],P);this.frustumCorners=p.cF.fromInvProjectionMatrix(X,this.horizonLineFromTop(),this.height),this.cameraFrustum=p.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const G=new Float32Array(16);p.bx(G),p.cE(G,G,[1,-1,1]),p.cG(G,G,this._pitch),p.by(G,G,this.angle);const Q=p.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=p.bw(Q);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-a.x/this.width,Q[9]=2*(a.y+se)/this.height,this.skyboxMatrix=p.az(G,Q,G);const oe=this.point,de=oe.x,le=oe.y,be=this.width%2/2,Me=this.height%2/2,De=Math.cos(this.angle),Le=Math.sin(this.angle),Ie=de-Math.round(de)+De*be+Le*Me,Oe=le-Math.round(le)+De*Me+Le*be,Te=new Float64Array(U);if(p.bo(Te,Te,[Ie>.5?Ie-1:Ie,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=Te,U=p.bz(),p.cE(U,U,[this.width/2,-this.height/2,1]),p.bo(U,U,[1,-1,0]),this.labelPlaneMatrix=U,U=p.bz(),p.cE(U,U,[1,-1,1]),p.bo(U,U,[-1,-1,0]),p.cE(U,U,[2/this.width,2/this.height,1]),this.glCoordMatrix=U,this.pixelMatrix=p.az(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},U=p.bi(new Float64Array(16),this.pixelMatrix),!U)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=U,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.cH(this);const Be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.ad(Be,Be,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=U;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,M=[a,a,h];p.b$(M,M,w),p.b$(_,_,-1),p.cI(_,_,M);const S=p.bz();p.bo(S,S,_),p.cE(S,S,M),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,w)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*M,w.y/this.worldSize-_[1]*M,a/this.worldSize*this._centerAltitude-_[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],w=a[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(M=Math.min((h-_)/w,1)),this._camera.position=p.bF([],this._camera.position,a,M),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),M=p.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.al(this._maxPitch)),P=Math.max((a[2]-M)/Math.cos(_),S),O=this._zoomFromMercatorZ(P);p.bF(a,a,h,P),this._pitch=p.aD(_,p.al(this.minPitch),p.al(this.maxPitch)),this.angle=p.bX(w,-Math.PI,Math.PI),this._setZoom(p.aD(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.ac(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,_=p.cx,w=0,M=1/0;for(;_-h>1e-6&&_>h;){const S=h+.5*(_-h),P=this.tileSize*Math.pow(2,S),O=this.getCameraToCenterDistance(this.projection,S,P),V=this.scaleZoom(O/(a*this.tileSize)),U=Math.abs(S-V);U<M&&(M=U,w=S),S<V?h=S:_=S}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const _=Math.min(a.x,h.x),w=Math.max(a.x,h.x),M=Math.min(a.y,h.y),S=Math.max(a.y,h.y);if(M<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const P=[new p.P(_,M),new p.P(w,S),new p.P(_,S),new p.P(w,M)],O=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const U of P){const X=this.pointRayIntersection(U);if(X.t<0)return!0;const G=this.rayIntersectionCoordinate(X);if(G.x<O||G.y<0||G.x>V||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.P(0,0),new p.P(this.width,this.height))}zoomDeltaToMovement(a,h){const _=p.ae(p.at([],this._camera.position,a)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const a=function([h,_,w],M){const S=[h,_,w,1];p.aA(S,S,M);const P=S[3]=Math.max(S[3],1e-6);return S[0]/=P,S[1]/=P,S[2]/=P,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.P(0,a))}}getCameraToCenterDistance(a,h=this.zoom,_=this.worldSize){const w=p.cA(a,h,this.width,this.height,1024),M=a.pixelSpaceConversion(this.center.lat,_,w);let S=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(S=p.ai(1,S,p.cO(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.az(a,a,this.globeMatrix),a}getFrustum(a){return p.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,"meters"===this.projection.zAxisUnit)}}const Ys=(g,a)=>{if(a>0&&g.terrain&&p.w("Cutoff is currently disabled on terrain"),a<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,_=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),w=h.isLODDisabled(!1)?p.af(60,45,h.pitch):p.af(30,15,h.pitch),M=h._farZ-h._nearZ,S=a*h.height,P=((1-(O=w))*h.cameraToCenterDistance+O*(h._farZ+S))*_;var O;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(P-h._nearZ)/M,(P-S-h._nearZ)/M]}}},Fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Go{constructor(a,h){this.aabb=a,this.lastCascade=h}}class Aa{add(a,h){const _=this.receivers[a.key];void 0!==_?(_.aabb.min[0]=Math.min(_.aabb.min[0],h.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],h.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],h.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],h.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],h.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],h.max[2])):this.receivers[a.key]=new Go(h,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,h,_){const w=p.cV.fromPoints(a.points);let M=0;for(const S in this.receivers){const P=this.receivers[S];if(!P||!w.intersectsAabb(P.aabb))continue;P.aabb.min=w.closestPoint(P.aabb.min),P.aabb.max=w.closestPoint(P.aabb.max);const O=P.aabb.getCorners();for(let V=0;V<_.length;V++){let U=!0;for(const X of O){const G=[X[0]*h,X[1]*h,X[2]];if(p.ad(G,G,_[V].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){U=!1;break}}if(P.lastCascade=V,M=Math.max(M,V),U)break}}return M+1}}class Er{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Aa,this._depthMode=new rn(a.context.gl.LEQUAL,rn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(Fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,h){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const w=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||w<=0||(this._shadowLayerCount=_.style.order.reduce((se,oe)=>{const de=_.style._mergedLayers[oe];return se+(de.hasShadowPass()&&!de.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=_.context,S=Fs.shadowMapResolution,P=Fs.shadowMapResolution;if(0===this._cascades.length||Fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<Fs.cascadeCount;++se){const oe=_._shadowMapDebug,de=M.gl,le=M.createFramebuffer(S,P,oe,"texture"),be=new p.T(M,{width:S,height:P,data:null},de.DEPTH_COMPONENT16);if(le.depthAttachment.set(be.texture),oe){const Me=new p.T(M,{width:S,height:P,data:null},de.RGBA8);le.colorAttachment.set(Me.texture)}this._cascades.push({framebuffer:le,texture:be,matrix:[],far:0,boundingSphereRadius:0,frustum:new p.cn,scale:0})}}this.shadowDirection=kl(h);let O=0;if(a.elevation){const se=a.elevation,oe=[1e4,-1e4];se.visibleDemTiles.filter(de=>de.dem).forEach(de=>{const le=de.dem.tree;oe[0]=Math.min(oe[0],le.minimums[0]),oe[1]=Math.max(oe[1],le.maximums[0])}),1e4!==oe[0]&&(O=(oe[1]-oe[0])*se.exaggeration())}const V=1.5*a.cameraToCenterDistance,U=3*V,X=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const oe=this._cascades[se];let de=a.height/50,le=1;1===Fs.cascadeCount?le=U:0===se?le=V:(de=V,le=U);const[be,Me]=hd(a,this.shadowDirection,de,le,Fs.shadowMapResolution,O);oe.scale=a.scale,oe.matrix=be,oe.boundingSphereRadius=Me,p.bi(X,oe.matrix),oe.frustum=p.cn.fromInvProjectionMatrix(X,1,0,!0),oe.far=le}const G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ds.ShadowMap0,this._uniformValues.u_shadowmap_1=Ds.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=_.transform.elevation;for(const se of this._groundShadowTiles){let oe={min:0,max:0};if(Q){const de=Q.getMinMaxForTile(se);de&&(oe=de)}this.addShadowReceiver(se.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,h){if(!this.enabled)return;const _=this.painter,w=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),w.viewport.set([0,0,Fs.shadowMapResolution,Fs.shadowMapResolution]);for(let M=0;M<this._numCascadesToRender;++M){_.currentShadowCascade=M,w.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),w.clear({color:p.am.white,depth:1});for(const S of a.order){const P=a._mergedLayers[S];if(!P.hasShadowPass()||P.isHidden(_.transform.zoom))continue;const O=a.getLayerSourceCache(P),V=O?h[O.id]:void 0;("model"===P.type||V&&V.length)&&_.renderLayer(_,O,P,V)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,h=a.style,_=a.context,w=h.directionalLight,M=h.ambientLight;if(!w||!M)return;const S=[],P=Ys(a,a.longestCutoffRange);P.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const O=Ha(h,w,M),V=new rn(_.gl.LEQUAL,rn.ReadOnly,a.depthRangeFor3D);for(const U of this._groundShadowTiles){const X=U.toUnwrapped(),G=a.isTileAffectedByFog(U),Q=a.getOrCreateProgram("groundShadow",{defines:S,overrideFog:G});this.setupShadows(X,Q),a.uploadCommonUniforms(_,Q,X,null,P);const se={u_matrix:a.transform.calculateProjMatrix(X),u_ground_shadow_factor:O};Q.draw(a,_.gl.TRIANGLES,V,kn.disabled,Yn.multiply,Ln.disabled,se,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Yn.unblended:Yn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const h=this.painter.transform,_=h.calculatePosMatrix(a,h.worldSize);return p.az(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(a){return p.az(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,h,_,w=0){if(!this.enabled)return;const M=this.painter.transform,S=this.painter.context,P=S.gl,O=this._uniformValues,V=new Float64Array(16),U=M.calculatePosMatrix(a,M.worldSize);for(let X=0;X<this._cascades.length;X++)p.az(V,this._cascades[X].matrix,U),O[0===X?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),S.activeTexture.set(P.TEXTURE0+Ds.ShadowMap0+X),this._cascades[X].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const X=p.cT(a.canonical),G=2/M.tileSize*p.aj/Fs.shadowMapResolution,Q=G*this._cascades[0].boundingSphereRadius,se=G*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=("vector-tile"===_?1:3)/Math.pow(2,w-a.canonical.z-(1-M.zoom+Math.floor(M.zoom)));O.u_shadow_normal_offset=[X,Q*oe,se*oe],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,O)}setupShadowsFromMatrix(a,h,_=!1){if(!this.enabled)return;const w=this.painter.context,M=w.gl,S=this._uniformValues,P=new Float64Array(16);for(let O=0;O<Fs.cascadeCount;O++)p.az(P,this._cascades[O].matrix,a),S[0===O?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),w.activeTexture.set(M.TEXTURE0+Ds.ShadowMap0+O),this._cascades[O].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=_,_){const O=Fs.normalOffset;S.u_shadow_normal_offset=[1,O,O],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(w,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,h,_,w){if(w[2]>=0)return{};const M=function(O,V,U){const X=U/(1<<O.canonical.z);return new p.cV([O.canonical.x*X+O.wrap*U,O.canonical.y*X+O.wrap*U,0],[(O.canonical.x+1)*X+O.wrap*U,(O.canonical.y+1)*X+O.wrap*U,V])}(a,h,_).getCorners(),S=h/-w[2];w[0]<0?(p.cU(M[0],M[0],[w[0]*S,0,0]),p.cU(M[3],M[3],[w[0]*S,0,0])):w[0]>0&&(p.cU(M[1],M[1],[w[0]*S,0,0]),p.cU(M[2],M[2],[w[0]*S,0,0])),w[1]<0?(p.cU(M[0],M[0],[0,w[1]*S,0]),p.cU(M[1],M[1],[0,w[1]*S,0])):w[1]>0&&(p.cU(M[2],M[2],[0,w[1]*S,0]),p.cU(M[3],M[3],[0,w[1]*S,0]));const P={};return P.vertices=M,P.planes=[Vl(M[1],M[0],M[4]),Vl(M[2],M[1],M[5]),Vl(M[3],M[2],M[6]),Vl(M[0],M[3],M[7])],P}addShadowReceiver(a,h,_){this._receivers.add(a,p.cV.fromTileIdAndHeight(a,h,_))}getMaxCascadeForTile(a){const h=this._receivers.get(a);return h&&h.lastCascade?h.lastCascade:0}}function Vl(g,a,h){const _=p.at([],h,a),w=p.at([],g,a),M=p.bG([],_,w),S=p.ae(M);return 0===S?[0,0,1,0]:(p.b$(M,M,1/S),[M[0],M[1],M[2],-p.bE(M,a)])}function kl(g){const a=g.properties.get("direction"),h=p.cR(a.x,a.y,a.z);h[2]=p.aD(h[2],0,75);const _=p.cW([h[0],h[1],h[2]]);return p.cS(_.x,_.y,_.z)}function Ha(g,a,h){const _="none"===a.properties.get("color-use-theme"),w=a.properties.get("color"),M=a.properties.get("intensity"),S=a.properties.get("direction"),P=[S.x,S.y,S.z],O="none"===h.properties.get("color-use-theme"),V=h.properties.get("color"),U=h.properties.get("intensity"),X=Math.max(p.bE([0,0,1],P),0),G=[0,0,0];p.b$(G,V.toRenderColor(O?null:g.getLut(a.scope)).toArray01Linear().slice(0,3),U);const Q=[0,0,0];return p.b$(Q,w.toRenderColor(_?null:g.getLut(h.scope)).toArray01Linear().slice(0,3),X*M),p.cX([G[0]>0?G[0]/(G[0]+Q[0]):0,G[1]>0?G[1]/(G[1]+Q[1]):0,G[2]>0?G[2]/(G[2]+Q[2]):0])}function hd(g,a,h,_,w,M){const S=g.zoom,P=g.scale,O=g.worldSize,V=1/O,U=g.aspect,X=Math.sqrt(1+U*U)*Math.tan(.5*g.fovX),G=X*X,Q=_-h,se=_+h;let oe,de;G>Q/se?(oe=_,de=_*X):(oe=.5*se*(1+G),de=.5*Math.sqrt(Q*Q+2*(_*_+h*h)*G+se*se*G*G));const le=g.projection.pixelsPerMeter(g.center.lat,O),be=g._camera.getCameraToWorldMercator(),Me=[0,0,-oe*V];p.ad(Me,Me,be);let De=de*V;const Le=g._edgeInsets;if(!(0===Le.left&&0===Le.top&&0===Le.right&&0===Le.bottom||Le.left===Le.right&&Le.top===Le.bottom)){const Ot=g._camera.getWorldToCamera(g.worldSize,"meters"===g.projection.zAxisUnit?le:1),wt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,_);wt[8]=2*-g.centerOffset.x/g.width,wt[9]=2*g.centerOffset.y/g.height;const It=new Float64Array(16);p.cB(It,wt,Ot);const Lt=new Float64Array(16);p.bi(Lt,It);const fn=p.cn.fromInvProjectionMatrix(Lt,O,S,!0);for(const bn of fn.points){const dn=((Ie=bn)[0]/=P,Ie[1]/=P,Ie[2]=p.c6(Ie[2],g._center.lat),Ie);De=Math.max(De,p.c0(p.cY([],Me,dn)))}}var Ie;De*=w/(w-1);const Oe=Math.acos(a[2]),Te=Math.atan2(-a[0],-a[1]),Be=new ds;Be.position=Me,Be.setPitchBearing(Oe,Te);const Ve=Be.getWorldToCamera(O,le),ct=De*O,Ye=Math.min(g._mercatorZfromZoom(17)*O*-2,-2*ct),kt=Be.getCameraToClipOrthographic(-ct,ct,-ct,ct,Ye,(ct+M*le)/a[2]),vt=new Float64Array(16);p.az(vt,kt,Ve);const Pt=p.cS(Math.floor(1e6*Me[0])/1e6*O,Math.floor(1e6*Me[1])/1e6*O,0),Je=.5*w,ot=[0,0,0];p.ad(ot,Pt,vt),p.b$(ot,ot,Je);const Ke=[Math.floor(ot[0]),Math.floor(ot[1]),Math.floor(ot[2])],xt=[0,0,0];p.at(xt,ot,Ke),p.b$(xt,xt,-1/Je);const dt=new Float64Array(16);return p.bx(dt),p.bo(dt,dt,xt),p.az(vt,dt,vt),[vt,ct]}class Xs extends p.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,h){return p.aS(this.requestManager.transformRequest(h,p.R.Model).url).then(_=>{if(!_)return;const w=p.aT(_),M=new p.aU(a,void 0,void 0,w);return M.computeBoundsAndApplyParent(),M}).catch(_=>{if(_&&404===_.status)return null;this.fire(new p.z(new Error(`Could not load model ${a} from ${h}: ${_.message}`)))})}load(a,h,_={forceReload:!1}){this.models[h]||(this.models[h]={});const w=Object.keys(a),M=[],S=[];for(const P of w){const O=a[P];this.hasURLBeenRequested(O)&&!_.forceReload||(this.modelByURL[O]={modelId:P,scope:h},M.push(this.loadModel(P,O)),S.push(P)),this.models[h][P]||(this.models[h][P]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+S.length,Promise.allSettled(M).then(P=>{for(let O=0;O<P.length;O++){const{status:V}=P[O];if("rejected"===V)continue;const{value:U}=P[O];this.models[h][S[O]]||(this.models[h][S[O]]={model:null,numReferences:1}),this.models[h][S[O]].model=U}this.numModelsLoading[h]-=S.length,this.fire(new p.A("data",{dataType:"style"}))}).catch(P=>{this.fire(new p.z(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,h,_={exactIdMatch:!1}){return!!(_.exactIdMatch?this.getModel(a,h):this.getModelByURL(this.modelUris[h][a]))}getModel(a,h){return this.models[h]||(this.models[h]={}),this.models[h][a]?this.models[h][a].model:void 0}getModelByURL(a){if(!a)return null;const h=this.modelByURL[a];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(a,h){return this.models[h]&&void 0!==this.models[h][a]}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,h,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const w=this.requestManager.normalizeModelURL(h);if((this.hasModel(a,_,{exactIdMatch:!0})||this.hasModelBeenAdded(a,_))&&this.modelUris[_][a]===w)this.models[_][a].numReferences++;else if(this.hasURLBeenRequested(w)){const{scope:M,modelId:S}=this.modelByURL[w];this.models[M][S].numReferences++}else this.modelUris[_][a]=w,this.load({[a]:this.modelUris[_][a]},_)}addModelURLs(a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _=this.modelUris[h];for(const w in a)_[w]=this.requestManager.normalizeModelURL(a[w])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _={};for(const w of a)this.hasModel(w,h,{exactIdMatch:!0})||this.hasURLBeenRequested(w)?this.models[h][w].numReferences++:this.modelUris[h][w]&&!this.hasURLBeenRequested(w)?_[w]=this.modelUris[h][w]:!this.hasURLBeenRequested(w)&&p.cZ(w,!1)&&(this.modelUris[h][w]=this.requestManager.normalizeModelURL(w),_[w]=this.modelUris[h][w]);this.load(_,h)}hasURLBeenRequested(a){return void 0!==this.modelByURL[a]}removeModel(a,h,_=!1){if(this.models[h]&&this.models[h][a]&&(this.models[h][a].numReferences--,0===this.models[h][a].numReferences)){const w=this.modelUris[h][a];_||delete this.modelUris[h][a],delete this.modelByURL[w];const M=this.models[h][a].model;if(!M)return;delete this.models[h][a],M.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const h of Object.keys(this.models[a])){const _=this.models[a][h].model;delete this.models[a][h],_&&_.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,h){this.models[h]||(this.models[h]={});for(const _ in this.models[h])this.models[h][_].model&&this.models[h][_].model.upload(a.context)}}const ud=new p.a7({data:new p.a8(p.a5.colorTheme.data)}),lu={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function rh(g){return g=g||{},Object.assign(g,lu)}class xc extends p.E{constructor(a){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},p.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=a,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(a=>{a.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new p.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=a.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=a.stylesheet.indoor.buildingFeaturesetId,this._scope=a.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:a=>(a.feature&&a.feature.properties.floorplan&&this.selectFloorplan(a.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(a){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,P){const[O,V]=S,{center:U,radius:X}=P,[G,Q]=U,se=Math.abs(O-G);return Math.sqrt((se>180?360-se:se)**2+(V-Q)**2)<=X}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new p.A("floorplangone")));const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=new p.P(this._map.transform.width/2,this._map.transform.height/2),w=[new p.P(0,0),new p.P(this._map.transform.width,this._map.transform.height)],M=this._map.queryRenderedFeatures(a?w:_,h);M.length>0&&(this._selectedFloorplan&&M[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=M[0],this._floorplanSelected(!1)))}_floorplanSelected(a){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(M){const[[S,P],[O,V]]=M,U=(O-S+360)%360,X=U>180?360-U:U;return{center:[(S+X/2+360)%360,(P+V)/2],radius:Math.sqrt(X**2+(V-P)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const h=this._floorplanStates[this._indoorData.id].selectedBuilding,_=this._floorplanStates[this._indoorData.id].selectedLevel;let w;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const M of this._indoorData.levels)M.id===this._selectedLevel.id&&(w=M.id);if(this.fire(new p.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:w})),h){const M=this._indoorData.buildings.find(S=>S.id===h);this._buildingSelected(M,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(_){const M=this._indoorData.levels.find(S=>S.id===_);this._updateLevels(M,a)}else a&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(a,h){h&&a&&a.extent&&this._map.fitBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=a?a.id:void 0;const _=this._indoorData.levels.filter(w=>a.levels.includes(w.id));this.fire(new p.A("buildingselected",{buildingId:a.id,levels:_}))}_levelSelected(a){if("overview"===a)this._updateLevels(void 0,!0);else{const h=this._indoorData.levels.find(_=>_.id===a);this._updateLevels(h,!0)}this.fire(new p.A("levelselected",{levelId:"overview"===a?void 0:a}))}_updateLevels(a,h){if(!a)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(h&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function _(V){const U=V.indexOf("/floor/");if(-1===U)return V;const X=U+7,G=V.indexOf("/",X);return-1===G?V.slice(X):V.slice(X,G)}this._selectedLevel=a,this._floorplanStates[this._indoorData.id].selectedLevel=a?a.id:void 0;const w=[],M={},S={},P={},O={};for(const V of this._indoorData.levels)if(w.push(V.id),M[V.id]=V.height,S[V.id]=V.base,a){if(this.mergeFloors){const U=_(a.id),X=_(V.id);P[V.id]=X===U?"true":"false"}else P[V.id]=V.id===a.id?"true":"false";O[V.id]=V.base<a.base?"true":"false"}else O[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",P]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",O]),a&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!a.isUnderground),h&&a.extent)){const V=this._map.cameraForBounds(a.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),U=this._map.getZoom(),X=V.zoom?Math.abs(U-V.zoom):0;this._map.fitBounds(a.extent,X>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:U})}}selectFloorplan(a){const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=[new p.P(0,0),new p.P(this._map.transform.width,this._map.transform.height)],w=this._map.queryRenderedFeatures(_,h);if(w.length>0)for(const M of w)if(JSON.parse(M.properties["indoor-data"]).floorplanIDs.includes(a)){this._selectedFloorplan=M,this._floorplanSelected(!0);break}}selectBuilding(a){const h=this._indoorData.buildings.find(_=>_.id===a);this._buildingSelected(h,!0)}selectLevel(a){this._levelSelected(a)}}function Ih(g){if(!g.metadata||!g.metadata.content_area)return;const a=p.q.devicePixelRatio,{left:h,top:_,width:w,height:M}=g.metadata.content_area,S=h*a,P=_*a;return[S,P,S+w*a,P+M*a]}function Vd(g){if(g)return g.map(([a,h])=>[a*p.q.devicePixelRatio,h*p.q.devicePixelRatio])}class jd{constructor(a,h,_){this.id=a,this.scope=h,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const h=this.sourceCache.getVisibleCoordinates();if(0===h.length)return a;const _=this.sourceCache.getSource();if(!(_ instanceof yo))return a;const w=h.map(S=>this.sourceCache.getTile(S)),M=_.getImages(w,Array.from(this.pendingRequests));for(const[S,P]of M)a.set(p.I.from({name:S,iconsetId:this.id}),P),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),a}}const Gc=(g,a)=>Ge(g,a&&a.filter(h=>"source.canvas"!==h.identifier)),Hd=p.aF(vi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Gu=p.aF(vi,["setCenter","setZoom","setBearing","setPitch"]),Jl=new Set(["background","sky","slot","custom"]),Oh={version:8,layers:[],sources:{}},cu={duration:300,delay:0};class es extends p.E{constructor(a,h={}){super(),this.map=a,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=p.l({},cu),this._buildingIndex=new Uc(this),this.crossTileSymbolIndex=new Vo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Vr,this.dispatcher=h.dispatcher?h.dispatcher:new p.D(p.d0(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Id(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new p.d1(a._requestManager,h.localFontFamily?p.d2.all:h.localIdeographFontFamily?p.d2.ideographs:p.d2.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Xs(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",p.d3());const _=this;this._rtlTextPluginCallback=es.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(M,S)=>{if(p.d4(M),S&&S.every(P=>P))for(const P in _._sourceCaches){const O=_._sourceCaches[P],V=O.getSource().type;"vector"!==V&&"geojson"!==V||O.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const M=this.getOwnSource(w.sourceId);if(M&&M.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===M.id&&this._validateLayer(P)}})}load(a){return a?("string"==typeof a?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if("string"==typeof a){if(p.f(a))return a;const h=p.d5(a);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${p.d6(JSON.stringify(a))}`}_diffStyle(a,h,_){this.globalId=this._getGlobalId(a);const w=(M,S)=>{try{S(null,this.setState(M,_))}catch(P){S(P,!1)}};if("string"==typeof a){const M=this.map._requestManager.normalizeStyleURL(a),S=this.map._requestManager.transformRequest(M,p.R.Style);p.n(S,(P,O)=>{P?this.fire(new p.z(P)):O&&w(O,h)})}else"object"==typeof a&&w(a,h)}loadURL(a,h={}){this.fire(new p.A("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.f(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,h.accessToken),this.resolvedImports.add(a);const w=this.importsCache.get(a);if(w)return this._load(w,_);const M=this.map._requestManager.transformRequest(a,p.R.Style);this._request=p.n(M,(S,P)=>{if(this._request=null,S)this.fire(new p.z(S));else if(P)return this.importsCache.set(a,P),this._load(P,_)})}loadJSON(a,h={}){this.fire(new p.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=p.q.frame(()=>{this._request=null,this._load(a,!1!==h.validate)})}loadEmpty(){this.fire(new p.A("dataloading",{dataType:"style"})),this._load(Oh,!1)}_loadImports(a,h,_){if(this.importDepth>=4)return p.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const M of a){const S=this._createFragmentStyle(M),P=new Promise(U=>{S.once("style.import.load",U),S.once("error",U)}).then(()=>this.mergeAll());if(w.push(P),this.resolvedImports.has(M.url)){S.loadEmpty();continue}const O=M.data||this.importsCache.get(M.url);O?(S.loadJSON(O,{validate:h}),this._isInternalStyle(O)&&(S.globalId=null)):M.url?S.loadURL(M.url,{validate:h}):S.loadEmpty();const V={style:S,id:M.id,config:M.config};if(_){const U=this.fragments.findIndex(({id:X})=>X===_);this.fragments=this.fragments.slice(0,U).concat(V).concat(this.fragments.slice(U))}else this.fragments.push(V)}return Promise.allSettled(w)}getImportGlobalIds(a=this,h=new Set){for(const _ of a.fragments)_.style.globalId&&h.add(_.style.globalId),this.getImportGlobalIds(_.style,h);return[...h.values()]}_createFragmentStyle(a){const h=this.scope?p.C(a.id,this.scope):a.id;let _;const w=this._initialConfig&&this._initialConfig[h];(a.config||w)&&(_=p.l({},a.config,w));const M=new es(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&!1!==a.fragment)}_load(a,h){const _=a.indoor?rh(a.schema):a.schema;if(this._isInternalStyle(a)){const S=p.l({},Oh,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(S,h)}if(this.updateConfig(this._config,_),h&&Gc(this,gl(a)))return;this._loaded=!0,this.stylesheet=p.d7(a);const w=()=>{for(const V in a.sources)this.addSource(V,a.sources[V],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const V in a.iconsets)this.addIconset(V,a.iconsets[V]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(a.glyphs);const S=jn(this.stylesheet.layers);if(this._order=S.map(V=>V.id),this.stylesheet.light&&p.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const V=this.stylesheet.lights[0];this.light=new at(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const V of S){const U=p.dc(V,this.scope,this._styleColorTheme.lut,this.options);0!==U.configDependencies.size&&this._configDependentLayers.add(U.fqid),U.setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U;const X=this.getOwnLayerSourceCache(U),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();X&&U.canCastShadows()&&G&&(X.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new p.A("data",{dataType:"style"}));const O=this.isRootStyle();a.imports?this._loadImports(a.imports,h).then(()=>{this._reloadImports(),this.fire(new p.A(O?"style.load":"style.import.load"))}).catch(V=>{this.fire(new p.z(new Error("Failed to load imports",V))),this.fire(new p.A(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new p.A(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const M=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(M){const S=this._evaluateColorThemeData(M);this._loadColorTheme(S).then(()=>{w()}).catch(P=>{p.w(`Couldn't load color theme from the stylesheet: ${P}`),w()})}else this._styleColorTheme.lut=null,w()}isRootStyle(){return 0===this.importDepth}mergeAll(){let a,h,_,w,M,S,P,O,V,U;const X={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(G=>{if(G.stylesheet){if(null!=G.light&&(a=G.light),G.stylesheet.lights)for(const Q of G.stylesheet.lights)"ambient"===Q.type&&null!=G.ambientLight&&(h=G.ambientLight),"directional"===Q.type&&null!=G.directionalLight&&(_=G.directionalLight);w=this._prioritizeTerrain(w,G.terrain,G.stylesheet.terrain),G.stylesheet.fog&&null!=G.fog&&(M=G.fog),G.stylesheet.snow&&null!=G.snow&&(S=G.snow),G.stylesheet.rain&&null!=G.rain&&(P=G.rain),null!=G.stylesheet.camera&&(U=G.stylesheet.camera),null!=G.stylesheet.projection&&(O=G.stylesheet.projection),null!=G.stylesheet.transition&&(V=G.stylesheet.transition),X[G.scope]=G._styleColorTheme}}),this.light=a,this.ambientLight=h,this.directionalLight=_,this.fog=M,this.snow=S,this.rain=P,this._styleColorThemeForScope=X,null===w?delete this.terrain:this.terrain=w,this.camera=U||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=p.l({},cu,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const h=_=>{for(const w of _.fragments)h(w.style);a(_)};h(this)}_prioritizeTerrain(a,h,_){const w=a&&0===a.drapeRenderMode;return null===_?h&&0===h.drapeRenderMode?h:w?a:null:null!=h&&(!a||w||h&&1===h.drapeRenderMode)?h:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{a=this._prioritizeTerrain(a,h.terrain,h.stylesheet.terrain)}),null===a?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(h=>{null!=h.stylesheet.projection&&(a=h.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},h={},_={};this.forEachFragmentStyle(w=>{for(const M in w._sourceCaches){const S=p.C(M,w.scope);a[S]=w._sourceCaches[M]}for(const M in w._otherSourceCaches){const S=p.C(M,w.scope);h[S]=w._otherSourceCaches[M]}for(const M in w._symbolSourceCaches){const S=p.C(M,w.scope);_[S]=w._symbolSourceCaches[M]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=_}mergeLayers(){const a={},h=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const S of M._order){const P=M._layers[S];if("slot"===P.type){const O=p.d8(S);if(a[O])continue;a[O]=[]}P.slot&&a[P.slot]?a[P.slot].push(P):h.push(P)}}),this._mergedOrder=[];const w=(M=[])=>{for(const S of M)if("slot"===S.type){const P=p.d8(S.id);a[P]&&w(a[P]),this._mergedSlots.push(P)}else{const P=p.C(S.id,S.scope);this._mergedOrder.push(P),_[P]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===S.type&&(this._hasCircleLayers=!0),"symbol"===S.type&&(this._hasSymbolLayers=!0),"clip"===S.type&&(this._clipLayerPresent=!0)}};w(h),this._mergedOrder.sort((M,S)=>{const P=_[M],O=_[S];return P.hasInitialOcclusionOpacityProperties?O.is3D(!!this.terrain)?1:0:P.is3D(!!this.terrain)&&O.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=p.l({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(h,_,w){const M=p.l({},_);for(const P of Object.keys(p.a5.colorTheme))void 0===M[P]&&(M[P]=p.a5.colorTheme[P].default);const S=new p.a6(ud,h,new Map(w));return S.setTransitionOrValue(M,w),S.untransitioned().possiblyEvaluate(new p.aa(0))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,w)=>{const M="data:image/png;base64,";if(!a||0===a.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let S=a;S.startsWith(M)||(S=M+S);const P=p.I.from("mapbox-reserved-lut"),O=new Image;O.src=S,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void _();this._styleColorTheme.lutLoading=!1;const{width:V,height:U,data:X}=p.q.getImageData(O);if(U>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==U*U)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new p.r({width:V,height:U},X),pixelRatio:1,sdf:!1,usvg:!1,version:0});const G=this.imageManager.getImage(P,this.scope);G?(this._styleColorTheme.lut={image:G.data,data:a},_()):w(new Error("Missing LUT image."))}})}getLut(a){const h=this._styleColorThemeForScope[a];return h?h.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(h,_,w){let M,S,P;const O=p.q.devicePixelRatio>1?"@2x":"";let V=p.n(_.transformRequest(_.normalizeSpriteURL(h,O,".json"),p.R.SpriteJSON),(G,Q)=>{V=null,P||(P=G,M=Q,X())}),U=p.o(_.transformRequest(_.normalizeSpriteURL(h,O,".png"),p.R.SpriteImage),(G,Q)=>{U=null,P||(P=G,S=Q,X())});function X(){if(P)w(P);else if(M&&S){const G=p.q.getImageData(S),Q={};for(const se in M){const{width:oe,height:de,x:le,y:be,sdf:Me,pixelRatio:De,stretchX:Le,stretchY:Ie,content:Oe}=M[se],Te=new p.r({width:oe,height:de});p.r.copy(G,Te,{x:le,y:be},{x:0,y:0},{width:oe,height:de},null),Q[se]={data:Te,pixelRatio:De,sdf:Me,stretchX:Le,stretchY:Ie,content:Oe,usvg:!1}}w(null,Q)}}return{cancel(){V&&(V.cancel(),V=null),U&&(U.cancel(),U=null)}}}(a,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.z(h));else if(_){const w=new Map;for(const M in _)w.set(p.I.from(M),_[M]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new p.A("data",{dataType:"style"}))})}addIconset(a,h){if("sprite"===h.type)return void this._loadSprite(h.url);const _=this.getOwnSourceCache(h.source);if(!_)return void this.fire(new p.z(new Error(`Source "${h.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const w=_.getSource();if("raster-array"!==w.type)return void this.fire(new p.z(new Error(`Source "${h.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));w.partial=!1;const M=new jd(a,this.scope,_);this.imageManager.addImageProvider(M,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!p.f(a)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(a);const h="auto"===this.map._spriteFormat;var _,w;this._spriteRequest=(w=(M,S)=>{if(this._spriteRequest=null,M)h?this._loadSprite(a):this.fire(new p.z(M));else if(S){const P=new Map;for(const O in S)P.set(p.I.from(O),S[O]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new p.A("data",{dataType:"style"}))},p.br((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(a),p.R.Iconset),(M,S)=>{if(M)return void w(M);const P={},O=p.c_(new p.bq(S));for(const V of O.icons){const U={version:1,pixelRatio:p.q.devicePixelRatio,content:Ih(V),stretchX:V.metadata?Vd(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?Vd(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};P[V.name]=U}w(null,P)}))}_validateLayer(a){const h=this.getOwnSource(a.source);if(!h)return;const _=a.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.z(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,h)=>{const _=this.fragments[h];return _&&_.style&&(a.data=_.style.serialize()),a})}_serializeSources(){const a={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();a[_.id]||(a[_.id]=_.serialize())}return a}_serializeLayers(a){const h=[];for(const _ of a){const w=this._layers[_];w&&"custom"!==w.type&&h.push(w.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const h=this.getOwnLayer(a);if(h)return h;this.fire(new p.z(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const h=this.getOwnSource(a);if(h)return h;this.fire(new p.z(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,h){const _=this.map.painter;if(_)for(let w=a.minzoom||0;w<(a.maxzoom||25.5);w++){const M=a.getProgramIds();if(M)for(const S of M){const P=a.getDefaultProgramParams(S,h.zoom,this._styleColorTheme.lut);P&&(_.style=this,this.fog&&(_._fogVisible=!0,P.overrideFog=!0,_.getOrCreateProgram(S,P)),_._fogVisible=!1,P.overrideFog=!1,_.getOrCreateProgram(S,P),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(P.overrideRtt=!0,_.getOrCreateProgram(S,P)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const h=this.calculateLightsBrightness();a.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const _=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const O in P){const{updatedIds:V,removedIds:U}=P[O];(V||U)&&(this._updateWorkerLayers(O,V,U),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const M={};for(const P in this._mergedSourceCaches){const O=this._mergedSourceCaches[P];M[P]=O.used,O.used=!1,O.tileCoverLift=0}for(const P of this._mergedOrder){const O=this._mergedLayers[P];if(O.recalculate(a,this._availableImages),!O.isHidden(a.zoom)){const V=this.getLayerSourceCache(O);V&&(V.used=!0,V.tileCoverLift=Math.max(V.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,a)}):this.precompilePrograms(O,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const P of S)P.sourceCache.used=!0;for(const P in M){const O=this._mergedSourceCaches[P];M[P]!==O.used&&O.getSource().fire(new p.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new p.A("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const h of a){const _=h.resolvePendingRequests(),w=this.getFragmentStyle(h.scope);w&&w.addImages(_)}}_updateTilesForChangedImages(){const a={};for(const h in this._mergedSourceCaches){const _=this._mergedSourceCaches[h].getSource().scope;a[_]=a[_]||this._changes.getUpdatedImages(_),0!==a[_].length&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a[_])}for(const h in a)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(a,h,_){const w=this.getFragmentStyle(a);w&&this.dispatcher.broadcast("updateLayers",{layers:h?w._serializeLayers(h):[],scope:a,removedIds:_||[],options:w.options})}setState(a,h){if(this._checkLoaded(),Gc(this,gl(a)))return!1;(a=p.d7(a)).layers=jn(a.layers);const _=function(S,P){if(!S)return[{command:vi.setStyle,args:[P]}];let O=[];try{if(!p.bv(S.version,P.version))return[{command:vi.setStyle,args:[P]}];if(p.bv(S.center,P.center)||O.push({command:vi.setCenter,args:[P.center]}),p.bv(S.zoom,P.zoom)||O.push({command:vi.setZoom,args:[P.zoom]}),p.bv(S.bearing,P.bearing)||O.push({command:vi.setBearing,args:[P.bearing]}),p.bv(S.pitch,P.pitch)||O.push({command:vi.setPitch,args:[P.pitch]}),p.bv(S.sprite,P.sprite)||O.push({command:vi.setSprite,args:[P.sprite]}),p.bv(S.glyphs,P.glyphs)||O.push({command:vi.setGlyphs,args:[P.glyphs]}),p.bv(S.imports,P.imports)||function(Q=[],se=[],oe){se=se||[];const de=(Q=Q||[]).map(Ja),le=se.map(Ja),be=Q.reduce(ad,{}),Me=se.reduce(ad,{}),De=de.slice();let Le,Ie,Oe,Te;for(Le=0,Ie=0;Le<de.length;Le++)Oe=de[Le],Me.hasOwnProperty(Oe)?Ie++:(oe.push({command:vi.removeImport,args:[Oe]}),De.splice(De.indexOf(Oe,Ie),1));for(Le=0,Ie=0;Le<le.length;Le++)Oe=le[le.length-1-Le],De[De.length-1-Le]!==Oe&&(be.hasOwnProperty(Oe)?(oe.push({command:vi.removeImport,args:[Oe]}),De.splice(De.lastIndexOf(Oe,De.length-Ie),1)):Ie++,Te=De[De.length-Le],oe.push({command:vi.addImport,args:[Me[Oe],Te]}),De.splice(De.length-Le,0,Oe));for(const Be of se){const Ve=be[Be.id];Ve&&!p.bv(Ve,Be)&&oe.push({command:vi.updateImport,args:[Be.id,Be]})}}(S.imports,P.imports,O),p.bv(S.transition,P.transition)||O.push({command:vi.setTransition,args:[P.transition]}),p.bv(S.light,P.light)||O.push({command:vi.setLight,args:[P.light]}),p.bv(S.fog,P.fog)||O.push({command:vi.setFog,args:[P.fog]}),p.bv(S.snow,P.snow)||O.push({command:vi.setSnow,args:[P.snow]}),p.bv(S.rain,P.rain)||O.push({command:vi.setRain,args:[P.rain]}),p.bv(S.projection,P.projection)||O.push({command:vi.setProjection,args:[P.projection]}),p.bv(S.lights,P.lights)||O.push({command:vi.setLights,args:[P.lights]}),p.bv(S.camera,P.camera)||O.push({command:vi.setCamera,args:[P.camera]}),p.bv(S.iconsets,P.iconsets)||function(Q,se,oe){let de;for(de in se=se||{},Q=Q||{})Q.hasOwnProperty(de)&&(se.hasOwnProperty(de)||oe.push({command:vi.removeIconset,args:[de]}));for(de in se){if(!se.hasOwnProperty(de))continue;const le=se[de];Q.hasOwnProperty(de)?p.bv(Q[de],le)||(oe.push({command:vi.removeIconset,args:[de]}),oe.push({command:vi.addIconset,args:[de,le]})):oe.push({command:vi.addIconset,args:[de,le]})}}(S.iconsets,P.iconsets,O),!p.bv(S["color-theme"],P["color-theme"]))return[{command:vi.setStyle,args:[P]}];const V={},U=[];!function(Q,se,oe,de){let le;for(le in se=se||{},Q=Q||{})Q.hasOwnProperty(le)&&(se.hasOwnProperty(le)||Ld(le,oe,de));for(le in se){if(!se.hasOwnProperty(le))continue;const be=se[le];Q.hasOwnProperty(le)?p.bv(Q[le],be)||("geojson"===Q[le].type&&"geojson"===be.type&&Ma(Q,se,le)?oe.push({command:vi.setGeoJSONSourceData,args:[le,be.data]}):Ah(le,se,oe,de)):po(le,se,oe)}}(S.sources,P.sources,U,V);const X=[];S.layers&&S.layers.forEach(Q=>{Q.source&&V[Q.source]?O.push({command:vi.removeLayer,args:[Q.id]}):X.push(Q)});let G=S.terrain;G&&V[G.source]&&(O.push({command:vi.setTerrain,args:[void 0]}),G=void 0),O=O.concat(U),p.bv(G,P.terrain)||O.push({command:vi.setTerrain,args:[P.terrain]}),function(Q,se,oe){se=se||[];const de=(Q=Q||[]).map(Ja),le=se.map(Ja),be=Q.reduce(ad,{}),Me=se.reduce(ad,{}),De=de.slice(),Le=Object.create(null);let Ie,Oe,Te,Be,Ve,ct,Ye;for(Ie=0,Oe=0;Ie<de.length;Ie++)Te=de[Ie],Me.hasOwnProperty(Te)?Oe++:(oe.push({command:vi.removeLayer,args:[Te]}),De.splice(De.indexOf(Te,Oe),1));for(Ie=0,Oe=0;Ie<le.length;Ie++)Te=le[le.length-1-Ie],De[De.length-1-Ie]!==Te&&(be.hasOwnProperty(Te)?(oe.push({command:vi.removeLayer,args:[Te]}),De.splice(De.lastIndexOf(Te,De.length-Oe),1)):Oe++,ct=De[De.length-Ie],oe.push({command:vi.addLayer,args:[Me[Te],ct]}),De.splice(De.length-Ie,0,Te),Le[Te]=!0);for(Ie=0;Ie<le.length;Ie++)if(Te=le[Ie],Be=be[Te],Ve=Me[Te],!Le[Te]&&!p.bv(Be,Ve))if(p.bv(Be.source,Ve.source)&&p.bv(Be["source-layer"],Ve["source-layer"])&&p.bv(Be.type,Ve.type)){for(Ye in yl(Be.layout,Ve.layout,oe,Te,null,vi.setLayoutProperty),yl(Be.paint,Ve.paint,oe,Te,null,vi.setPaintProperty),p.bv(Be.slot,Ve.slot)||oe.push({command:vi.setSlot,args:[Te,Ve.slot]}),p.bv(Be.filter,Ve.filter)||oe.push({command:vi.setFilter,args:[Te,Ve.filter]}),p.bv(Be.minzoom,Ve.minzoom)&&p.bv(Be.maxzoom,Ve.maxzoom)||oe.push({command:vi.setLayerZoomRange,args:[Te,Ve.minzoom,Ve.maxzoom]}),Be)Be.hasOwnProperty(Ye)&&"layout"!==Ye&&"paint"!==Ye&&"filter"!==Ye&&"metadata"!==Ye&&"minzoom"!==Ye&&"maxzoom"!==Ye&&"slot"!==Ye&&(0===Ye.indexOf("paint.")?yl(Be[Ye],Ve[Ye],oe,Te,Ye.slice(6),vi.setPaintProperty):p.bv(Be[Ye],Ve[Ye])||oe.push({command:vi.setLayerProperty,args:[Te,Ye,Ve[Ye]]}));for(Ye in Ve)Ve.hasOwnProperty(Ye)&&!Be.hasOwnProperty(Ye)&&"layout"!==Ye&&"paint"!==Ye&&"filter"!==Ye&&"metadata"!==Ye&&"minzoom"!==Ye&&"maxzoom"!==Ye&&"slot"!==Ye&&(0===Ye.indexOf("paint.")?yl(Be[Ye],Ve[Ye],oe,Te,Ye.slice(6),vi.setPaintProperty):p.bv(Be[Ye],Ve[Ye])||oe.push({command:vi.setLayerProperty,args:[Te,Ye,Ve[Ye]]}))}else oe.push({command:vi.removeLayer,args:[Te]}),ct=De[De.lastIndexOf(Te)+1],oe.push({command:vi.addLayer,args:[Ve,ct]})}(X,P.layers,O)}catch(V){console.warn("Unable to compute style diff:",V),O=[{command:vi.setStyle,args:[P]}]}return O}(this.serialize(),a).filter(S=>!(S.command in Gu));if(0===_.length)return!1;const w=_.filter(S=>!(S.command in Hd));if(w.length>0)throw new Error(`Unimplemented: ${w.map(S=>S.command).join(", ")}.`);const M=[];return _.forEach(S=>{M.push(this[S.command](...S.args))}),h&&Promise.all(M).then(h).catch(h),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){for(const[h,_]of a.entries()){if(this.getImage(h))return this.fire(new p.z(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,_),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new p.A("data",{dataType:"style"})),this}addImage(a,h){return this.getImage(a)?this.fire(new p.z(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,h),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new p.A("data",{dataType:"style"})),this)}updateImage(a,h,_=!1){this.imageManager.updateImage(a,this.scope,h),_&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new p.A("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new p.A("data",{dataType:"style"})),this):this.fire(new p.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(a){return this.modelManager.addModelURLs(a,this.scope),this._updateWorkerModels(),this.fire(new p.A("data",{dataType:"style"})),this}addModel(a,h,_={}){return this._checkLoaded(),this._validate(Fe,`models.${a}`,h,null,_)||(this.modelManager.addModel(a,h,this.scope),this.fire(new p.A("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this.fire(new p.A("data",{dataType:"style"})),this):this.fire(new p.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,h,_={}){if(this._checkLoaded(),void 0!==this.getOwnSource(a))throw new Error(`There is already a source with ID "${a}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(Rl,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=_l(a,h,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const M=S=>{const P=(S?"symbol:":"other:")+w.id,O=p.C(P,this.scope),V=this._sourceCaches[P]=new Es(O,w,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=V,V.onAdd(this.map)};M(!1),"vector"!==h.type&&"geojson"!==h.type||M(!0),w.onAdd&&w.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const h=this.getOwnSource(a);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===a)return this.fire(new p.z(new Error(`Source "${a}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new p.z(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const w=Object.entries(this.stylesheet.iconsets).find(([M,S])=>"source"===S.type&&S.source===a);if(w)return this.fire(new p.z(new Error(`Source "${a}" cannot be removed while iconset "${w[0]}" is using it.`)))}const _=this.getOwnSourceCaches(a);for(const w of _){const M=p.d8(w.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(w.id),w.fire(new p.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getOwnSource(a).setData(h),this._changes.setDirty()}getOwnSource(a){const h=this.getOwnSourceCache(a);return h&&h.getSource()}getOwnSources(){const a=[];for(const h in this._otherSourceCaches){const _=this.getOwnSourceCache(h);_&&a.push(_.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const h in a){const _=a[h]._tiles;for(const w in _){const M=_[w];if("loaded"!==M.state&&"errored"!==M.state)return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const w of a){if(this._validate(Th,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const M=this.ambientLight;M.set(w),M.updateTransitions(h)}else this.ambientLight=new Do(w,fi||(fi=new p.a7({color:new p.a8(p.a5.properties_light_ambient.color),"color-use-theme":new p.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new p.a8(p.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const M=this.directionalLight;M.set(w),M.updateTransitions(h)}else this.directionalLight=new Do(w,ki||(ki=new p.a7({direction:new p.an(p.a5.properties_light_directional.direction),color:new p.a8(p.a5.properties_light_directional.color),"color-use-theme":new p.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new p.a8(p.a5.properties_light_directional.intensity),"cast-shadows":new p.a8(p.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new p.a8(p.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new p.a8(p.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=new p.aa(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,h=this.ambientLight;if(!a||!h)return;const _=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),w=a.properties.get("color").toRenderColor(null).toArray01(),M=a.properties.get("intensity"),S=a.properties.get("direction"),P=1-p.cR(S.x,S.y,S.z)[2]/90,O=_(w)*M*P,V=h.properties.get("color").toRenderColor(null).toArray01(),U=h.properties.get("intensity"),X=_(V)*U;return Number(((O+X)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(null==a||""===a&&this.isRootStyle())return this;if(p.d9(a)){const h=p.da(a),_=this.fragments.find(({id:M})=>M===h);if(!_)return;const w=p.d8(a);return _.style.getFragmentStyle(w)}{const h=this.fragments.find(({id:_})=>_===a);return h?h.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const h={},_=(w,M="")=>`${w}::${M}`;this._featuresetSelectors={};for(const w in a){const M=this._featuresetSelectors[w]=[];for(const S of a[w].selectors){if(S.featureNamespace){const O=this.getOwnLayer(S.layer);if(!O){p.w(`Layer is undefined for selector: ${S.layer}`);continue}const V=_(O.source,O.sourceLayer);if(V in h&&h[V]!==S.featureNamespace){p.w(`"featureNamespace ${S.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}h[V]=S.featureNamespace}let P;if(S.properties)for(const O in S.properties){const V=p.X(S.properties[O]);"success"===V.result&&(P=P||{},P[O]=V.value)}M.push({layerId:S.layer,namespace:S.featureNamespace,properties:P,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const h=this.getFragmentStyle(a);if(!h||!h.stylesheet.featuresets)return[];const _=[];for(const w in h.stylesheet.featuresets)_.push({featuresetId:w,importId:h.scope?h.scope:void 0});return _}getFeaturesetLayers(a,h){const _=this.getFragmentStyle(h),w=_.stylesheet.featuresets;if(!w||!w[a])return this.fire(new p.z(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const S of w[a].selectors){const P=_.getOwnLayer(S.layer);P&&M.push(P)}return M}getConfigProperty(a,h){const _=this.getFragmentStyle(a);if(!_)return null;const w=p.C(h,_.scope),M=_.options.get(w),S=M?M.value||M.default:null;return S?S.serialize():null}setConfigProperty(a,h,_){const w=this.getFragmentStyle(a);if(!w)return;const M=w.stylesheet.indoor?rh(w.stylesheet.schema):w.stylesheet.schema;if(!M||!M[h])return;const S=p.X(_);if("success"!==S.result)return void Gc(this,S.value);const P=S.value.expression,O=p.C(h,w.scope),V=w.options.get(O);if(!V)return;let U;const{minValue:X,maxValue:G,stepValue:Q,type:se,values:oe}=M[h],de=p.X(M[h].default);"success"===de.result&&(U=de.value.expression),U?(this.options.set(O,Object.assign({},V,{value:P,default:U,minValue:X,maxValue:G,stepValue:Q,type:se,values:oe})),this.updateConfigDependencies(h)):this.fire(new p.z(new Error(`No schema defined for the config option "${h}" in the "${a}" fragment.`)))}getConfig(a){const h=this.getFragmentStyle(a);if(!h)return null;const _=h.stylesheet.schema;if(!_)return null;const w={};for(const M in _){const S=p.C(M,h.scope),P=h.options.get(S),O=P?P.value||P.default:null;w[M]=O?O.serialize():null}return w}setConfig(a,h){const _=this.getFragmentStyle(a);_&&(_.updateConfig(h,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const h=this.getFragmentStyle(a);return h?h.stylesheet.schema:null}setSchema(a,h){const _=this.getFragmentStyle(a);_&&(_.stylesheet.schema=h,_.updateConfig(_._config,h),this.updateConfigDependencies())}updateConfig(a,h){if(this._config=a,a||h)if(h)for(const _ in h){let w,M;const S=p.X(h[_].default);if("success"===S.result&&(w=S.value.expression),a&&void 0!==a[_]){const G=p.X(a[_]);"success"===G.result&&(M=G.value.expression)}const{minValue:P,maxValue:O,stepValue:V,type:U,values:X}=h[_];if(w){const G=p.C(_,this.scope);this.options.set(G,{default:w,value:M,minValue:P,maxValue:O,stepValue:V,type:U,values:X})}else this.fire(new p.z(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new p.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(a){for(const h of this._configDependentLayers){const _=this.getLayer(h);if(_){if(a&&!_.configDependencies.has(a))continue;_.possiblyEvaluateVisibility(),this._updateLayer(_)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const _=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(_){const w=h._evaluateColorThemeData(_);(!h._styleColorTheme.lut&&""!==w||h._styleColorTheme.lut&&w!==h._styleColorTheme.lut.data)&&h.setColorTheme(_)}}),this._changes.setDirty()}addLayer(a,h,_={}){this._checkLoaded();const w=a.id;if(this._layers[w])return void this.fire(new p.z(new Error(`Layer with id "${w}" already exists on this map`)));let M;if("custom"===a.type){if(Gc(this,p.db(a)))return;M=p.dc(a,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof a.source&&(this.addSource(w,a.source),a=p.d7(a),a=p.l(a,{source:w})),this._validate(ae,`layers.${w}`,a,{arrayIndex:-1},_))return;M=p.dc(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}})}0!==M.configDependencies.size&&this._configDependentLayers.add(M.fqid);let S=this._order.length;if(h){const U=this._order.indexOf(h);if(-1===U)return void this.fire(new p.z(new Error(`Layer with id "${h}" does not exist on this map.`)));M.slot===this._layers[h].slot?S=U:p.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,w),this._layerOrderChanged=!0,this._layers[w]=M;const P=this.getOwnLayerSourceCache(M),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&M.canCastShadows()&&O&&(P.castsShadows=!0);const V=this._changes.getRemovedLayer(M);if(V&&M.source&&P&&"custom"!==M.type){this._changes.discardLayerRemoval(M);const U=p.C(M.source,M.scope);V.type!==M.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),P.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(a,h){this._checkLoaded();const _=this._checkLayer(a);if(!_||a===h)return;const w=this._order.indexOf(a);this._order.splice(w,1);let M=this._order.length;if(h){const S=this._order.indexOf(h);if(-1===S)return void this.fire(new p.z(new Error(`Layer with id "${h}" does not exist on this map.`)));_.slot===this._layers[h].slot?M=S:p.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const h=this._checkLayer(a);if(!h)return;h.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const w=this.getOwnLayerSourceCache(h);if(w&&w.castsShadows){let M=!1;for(const S in this._layers)if(this._layers[S].source===h.source&&this._layers[S].canCastShadows()){M=!0;break}w.castsShadows=M}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,_){this._checkLoaded();const w=this._checkLayer(a);w&&(w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,h){this._checkLoaded();const _=this._checkLayer(a);_&&_.slot!==h&&(_.slot=h,this._updateLayer(_))}setFilter(a,h,_={}){this._checkLoaded();const w=this._checkLayer(a);if(w&&!p.bv(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(ge,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=p.d7(h),this._updateLayer(w)))}getFilter(a){const h=this._checkLayer(a);if(h)return p.d7(h.filter)}setLayoutProperty(a,h,_,w={}){this._checkLoaded();const M=this._checkLayer(a);if(M&&!p.bv(M.getLayoutProperty(h),_)){if(null!=_&&(!w||!1!==w.validate)&&Gc(M,je.call(gl,{key:`layers.${a}.layout.${h}`,layerType:M.type,objectKey:h,value:_,styleSpec:p.a5,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(h,_),0!==M.configDependencies.size&&this._configDependentLayers.add(M.fqid),this._updateLayer(M)}}getLayoutProperty(a,h){const _=this._checkLayer(a);if(_)return _.getLayoutProperty(h)}setPaintProperty(a,h,_,w={}){this._checkLoaded();const M=this._checkLayer(a);if(!M||p.bv(M.getPaintProperty(h),_)||null!=_&&(!w||!1!==w.validate)&&Gc(M,Ae.call(gl,{key:`layers.${a}.paint.${h}`,layerType:M.type,objectKey:h,value:_,styleSpec:p.a5})))return;const S=M.setPaintProperty(h,_);0!==M.configDependencies.size&&this._configDependentLayers.add(M.fqid),S&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(a,h){const _=this._checkLayer(a);if(_)return _.getPaintProperty(h)}setFeatureState(a,h){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:O,importId:V}=a.target,U=this.getFragmentStyle(V),X=U.getFeaturesetLayers(O);for(const{source:G,sourceLayer:Q}of X)U.setFeatureState({id:a.id,source:G,sourceLayer:Q},h)}else if("layerId"in a.target){const{layerId:O}=a.target,V=this.getLayer(O);this.setFeatureState({id:a.id,source:V.source,sourceLayer:V.sourceLayer},h)}return}const _=a.source,w=a.sourceLayer,M=this._checkSource(_);if(!M)return;const S=M.type;if("geojson"===S&&w)return void this.fire(new p.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===S&&!w)return void this.fire(new p.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new p.z(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(_);for(const O of P)O.setFeatureState(w,a.id,h)}removeFeatureState(a,h){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:O,importId:V}=a.target,U=this.getFragmentStyle(V),X=U.getFeaturesetLayers(O);for(const{source:G,sourceLayer:Q}of X)U.removeFeatureState({id:a.id,source:G,sourceLayer:Q},h)}else if("layerId"in a.target){const{layerId:O}=a.target,V=this.getLayer(O);this.removeFeatureState({id:a.id,source:V.source,sourceLayer:V.sourceLayer},h)}return}const _=a.source,w=this._checkSource(_);if(!w)return;const M=w.type,S="vector"===M?a.sourceLayer:void 0;if("vector"===M&&!S)return void this.fire(new p.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new p.z(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(_);for(const O of P)O.removeFeatureState(S,a.id,h)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let M;if("featuresetId"in a.target){const{featuresetId:S,importId:P}=a.target,O=this.getFragmentStyle(P),V=O.getFeaturesetLayers(S);for(const{source:U,sourceLayer:X}of V){const G=O.getFeatureState({id:a.id,source:U,sourceLayer:X});if(G&&!M)M=G;else if(!p.bv(M,G))return void this.fire(new p.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:S}=a.target,P=this.getLayer(S);M=this.getFeatureState({id:a.id,source:P.source,sourceLayer:P.sourceLayer})}return M}const h=a.source,_=a.sourceLayer,w=this._checkSource(h);if(w){if("vector"!==w.type||_)return void 0===a.id&&this.fire(new p.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(_,a.id);this.fire(new p.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=p.l({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return p.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),h=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return p.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>void 0!==_)}_updateFilteredLayers(a){for(const h of Object.values(this._mergedLayers))a(h)&&this._updateLayer(h)}_updateLayer(a){this._changes.updateLayer(a);const h=this.getLayerSourceCache(a),_=p.C(a.source,a.scope),w=this._changes.getUpdatedSourceCaches();a.source&&!w[_]&&h&&"raster"!==h.getSource().type&&(this._changes.updateSourceCache(_,"reload"),h.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=P=>this._mergedLayers[P].is3D(!!this.terrain),_=this.order,w={},M=[];for(let P=_.length-1;P>=0;P--){const O=_[P];if(h(O)){w[O]=P;for(const V of a){const U=V[O];if(U)for(const X of U)M.push(X)}}}M.sort((P,O)=>O.intersectionZ-P.intersectionZ);const S=[];for(let P=_.length-1;P>=0;P--){const O=_[P];if(h(O))for(let V=M.length-1;V>=0;V--){const U=M[V].feature;if(U.layer&&w[U.layer.id]<P)break;S.push(U),M.pop()}else for(const V of a){const U=V[O];if(U)for(const X of U)S.push(X.feature)}}return S}queryRenderedFeatures(a,h,_){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(ge,"queryRenderedFeatures.filter",h.filter,null,h),w=p.b3(h.filter));const M={},S=U=>{if(Jl.has(U.type))return;const X=this.getOwnLayerSourceCache(U),G=M[X.id]=M[X.id]||{sourceCache:X,layers:{},has3DLayers:!1};U.is3D(!!this.terrain)&&(G.has3DLayers=!0),G.layers[U.fqid]=G.layers[U.fqid]||{styleLayer:U,targets:[]},G.layers[U.fqid].targets.push({filter:w})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.z(new Error("parameters.layers must be an Array."))),[];for(const U of h.layers){const X=this._layers[U];if(!X)return this.fire(new p.z(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];S(X)}}else for(const U in this._layers)S(this._layers[U]);const P=this._queryRenderedFeatures(a,M,_),O=this._flattenAndSortRenderedFeatures(P),V=[];for(const U of O)p.de(U.layer.id)===this.scope&&V.push(U);return V}queryRenderedFeatureset(a,h,_){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(ge,"queryRenderedFeatures.filter",h.filter,null,h),w=p.b3(h.filter));const M="mock",S=[];if(h&&h.target)S.push(Object.assign({},h,{targetId:M,filter:w}));else{const U=this.getFeaturesetDescriptors();for(const X of U)S.push({targetId:M,filter:w,target:X});for(const{style:X}of this.fragments){const G=X.getFeaturesetDescriptors();for(const Q of G)S.push({targetId:M,filter:w,target:Q})}}const P=this.queryRenderedTargets(a,S,_),O=[],V=new Set;for(const U of P)for(const X of U.variants[M])sd(X,U,V)||O.push(new p.df(U,X));return O}queryRenderedTargets(a,h,_){const w={},M=(P,O,V,U)=>{const X=w[O.id]=w[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(X.layers[P.fqid]=X.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(X.has3DLayers=!0),!U)return V.uniqueFeatureID=!1,void X.layers[P.fqid].targets.push(V);X.layers[P.fqid].targets.push(Object.assign({},V,{namespace:U.namespace,properties:U.properties,uniqueFeatureID:U.uniqueFeatureID}))};for(const P of h)if("featuresetId"in P.target){const{featuresetId:O,importId:V}=P.target,U=this.getFragmentStyle(V);if(!U||!U._featuresetSelectors)continue;const X=U._featuresetSelectors[O];if(!X){this.fire(new p.z(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const G of X){const Q=U.getOwnLayer(G.layerId);Q&&!Jl.has(Q.type)&&M(Q,U.getOwnLayerSourceCache(Q),P,G)}}else if("layerId"in P.target){const{layerId:O}=P.target,V=this.getLayer(O);if(!V||Jl.has(V.type))continue;M(V,this.getLayerSourceCache(V),P)}const S=this._queryRenderedFeatures(a,w,_);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(a,h,_){const w=[],M=!!this.map._showQueryGeometry,S=qo.createFromScreenPoints(a,_);for(const P in h){const O=ti(S,h[P],this._availableImages,_,M);Object.keys(O).length&&w.push(O)}if(this.placement)for(const P in h){if(!h[P].sourceCache._onlySymbols)continue;const O=Oo(S.screenGeometry,h[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(O).length&&w.push(O)}return w}querySourceFeatures(a,h){const _=h&&h.filter;_&&this._validate(ge,"querySourceFeatures.filter",_,null,h);let w=[];const M=this.getOwnSourceCaches(a);for(const S of M)w=w.concat(Is(S,h));return w}addSourceType(a,h,_){return es.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(es.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,h,_={}){this._checkLoaded();const w=this.light.getLight();let M=!1;for(const P in a)if(!p.bv(a[P],w[P])){M=!0;break}if(!M)return;const S=this._getTransitionParameters();this.light.setLight(a,h,_),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=p.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&p.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,h=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===h&&delete this.terrain,null===a?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=a;const w=null==a.source;if(1===h){if(this.disableElevatedTerrain)return;if("object"==typeof _.source){const P="terrain-dem-src";this.addSource(P,_.source),_=p.d7(_),_=p.l(_,{source:P})}const M=p.l({},_),S={};if(this.terrain&&w){M.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(S.style=P.serialize())}if(this._validate(Wt,"terrain",M,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h),this.fire(new p.A("data",{dataType:"style"}))}else{const M=this.terrain,S=M.get();for(const P of Object.keys(p.a5.terrain))!_.hasOwnProperty(P)&&p.a5.terrain[P].default&&(_[P]=p.a5.terrain[P].default);for(const P in a)if(!p.bv(a[P],S[P])){M.set(a,this.options),this.stylesheet.terrain=a;const O=this._getTransitionParameters({duration:0});M.updateTransitions(O),this.fire(new p.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new pi(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createSnow(a){const h=this.snow=new Si(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createRain(a){const h=this.rain=new wi(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!p.bv(h.get(),a)){h.set(a,this.options),this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!p.bv(h.get(),a)){h.set(a,this.options),this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!p.bv(h.get(),a)){h.set(a,this.options),this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void a();const _=this._evaluateColorThemeData(h);this._loadColorTheme(_).then(()=>{this.fire(new p.A("colorthemeset")),a()}).catch(w=>{p.w(`Couldn't set color theme: ${w}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&p.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,h){const _=this.getFragmentStyle(a);_&&(_._styleColorTheme.colorThemeOverride=h,_._reloadColorTheme())}_getTransitionParameters(a){return{now:p.q.now(),transition:p.l(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],h=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?a.push(_):h.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const _=this.terrain=new bt(a,h,this.scope,this.options);1===h&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"symbol"===h.type&&this._updateLayer(h)}}_validate(a,h,_,w,M={}){if(M&&!1===M.validate)return!1;const S=p.l({},this.serialize());return Gc(this,a.call(gl,p.l({key:h,style:S,value:_,styleSpec:p.a5},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const h=this.getSourceCaches(a);for(const _ of h)_.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){const h=this.getSourceCaches(a);for(const _ of h)_.resume(),_.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let h;this.directionalLight&&(h=kl(this.directionalLight));const _=new Set;for(const w in this._mergedLayers){const M=this._mergedLayers[w];M.hasElevation()&&!_.has(M.source)&&_.add(M.source)}for(const w in this._mergedSourceCaches){const M=this._mergedSourceCaches[w],S=_.has(M._source.id);M.update(a,void 0,void 0,h,S)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,_,w,M,S,P=!1){let O=!1,V=!1;const U={},X={};for(const G of this._mergedOrder){const Q=this._mergedLayers[G];if("symbol"!==Q.type)continue;const se=p.C(Q.source,Q.scope);let oe=U[se];if(!oe){const le=this.getLayerSourceCache(Q);if(!le)continue;const be=le.getRenderableIds(!0).map(Me=>le.getTileByID(Me));X[se]=be.slice(),oe=U[se]=be.sort((Me,De)=>De.tileID.overscaledZ-Me.tileID.overscaledZ||(Me.tileID.isLessThan(De.tileID)?-1:1))}const de=this.crossTileSymbolIndex.addLayer(Q,oe,h.center.lng,h.projection);O=O||de}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||0===w,this._layerOrderChanged&&this.fire(new p.A("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.q.now(),h.zoom))&&(this.pauseablePlacement=new Ta(h,this._mergedOrder,P,_,w,M,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,U,X,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.q.now()),V=!0),O&&this.pauseablePlacement.placement.setStale()),V||O){this._buildingIndex.onNewFrame(h.zoom);for(let G=0;G<this._mergedOrder.length;G++){const Q=this._mergedLayers[this._mergedOrder[G]];if("symbol"!==Q.type)continue;const se=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,U[p.C(Q.source,Q.scope)],G,se?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.q.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,h){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==_.findIndex(({id:M})=>M===a.id))return void this.fire(new p.z(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!h)return _.push(a),this._loadImports([a],!0);const w=_.findIndex(({id:M})=>M===h);return-1===w&&this.fire(new p.z(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,w).concat(a).concat(_.slice(w)),this._loadImports([a],!0,h)}updateImport(a,h){this._checkLoaded();const _=this.stylesheet.imports||[],w=this.getImportIndex(a);return-1===w?this:"string"==typeof h?(this.setImportUrl(a,h),this):(h.url&&h.url!==_[w].url&&this.setImportUrl(a,h.url),p.bv(h.config,_[w].config)||this.setImportConfig(a,h.config,h.data.schema),p.bv(h.data,_[w].data)||this.setImportData(a,h.data),this)}moveImport(a,h){this._checkLoaded();let _=this.stylesheet.imports||[];const w=this.getImportIndex(a);if(-1===w)return this;const M=this.getImportIndex(h);if(-1===M)return this;const S=_[w],P=this.fragments[w];return _=_.filter(({id:O})=>O!==a),this.fragments=this.fragments.filter(({id:O})=>O!==a),this.stylesheet.imports=_.slice(0,M).concat(S).concat(_.slice(M)),this.fragments=this.fragments.slice(0,M).concat(P).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(a,h){this._checkLoaded();const _=this.stylesheet.imports||[],w=this.getImportIndex(a);if(-1===w)return this;_[w].url=h;const M=this.fragments[w];return M.style=this._createFragmentStyle(_[w]),M.style.on("style.import.load",()=>this.mergeAll()),M.style.loadURL(h),this}setImportData(a,h){this._checkLoaded();const _=this.getImportIndex(a),w=this.stylesheet.imports||[];return-1===_?this:h?(this.fragments[_].style.setState(h),this._reloadImports(),this):(delete w[_].data,this.setImportUrl(a,w[_].url))}setImportConfig(a,h,_){this._checkLoaded();const w=this.getImportIndex(a),M=this.stylesheet.imports||[];if(-1===w)return this;h?M[w].config=h:delete M[w].config;const S=this.fragments[w];_&&S.style.stylesheet&&(S.style.stylesheet.schema=_);const P=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=h,S.style.updateConfig(h,P),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const h=this.stylesheet.imports||[],_=this.getImportIndex(a);-1!==_&&(h.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(a){const h=(this.stylesheet.imports||[]).findIndex(_=>_.id===a);return-1===h&&this.fire(new p.z(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),h}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const h in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[h];_&&a.push(_.getSource())}return a}getSource(a,h){const _=this.getSourceCache(a,h);return _&&_.getSource()}getLayerSource(a){const h=this.getLayerSourceCache(a);return h&&h.getSource()}getSourceCache(a,h){const _=p.C(a,h);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(a){const h=p.C(a.source,a.scope);return"symbol"===a.type?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(a){if(null==a)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[a]&&h.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&h.push(this._mergedSymbolSourceCaches[a]),h}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const h in a){const _=a[h];"reload"===_?this.reloadSource(h):"clear"===_&&this.clearSource(h)}}updateLayers(a){const h=this._changes.getUpdatedPaintProperties();for(const _ of h){const w=this.getLayer(_);w&&w.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a,this.scope)}getImages(a,h,_){this.imageManager.getImages(h.images,h.scope,_),this._updateTilesForChangedImages();const w=S=>{if(S){const P=h.images.map(O=>p.I.toString(O));S.setDependencies(h.tileID.key,h.type,P)}},M=p.C(h.source,h.scope);w(this._mergedOtherSourceCaches[M]),w(this._mergedSymbolSourceCaches[M])}rasterizeImages(a,h,_){this.imageManager.rasterizeImages(h,_)}getGlyphs(a,h,_){this.glyphManager.getGlyphs(h.stacks,h.scope,_)}getResource(a,h,_){return p.dh(h,_)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this.getOwnSourceCaches(a);return 0===h.length?(this.fire(new p.z(new Error(`There is no source with ID '${a}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,h){if(!this._clipLayerPresent&&"fill-extrusion"!==a.type)return!1;const _="fill-extrusion"===a.type&&"building"===a.sourceLayer;if(a.is3D(!!this.terrain)){if(_||h&&"batched-model"===h.type||"model"===a.type)return!0}else if("symbol"===a.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}es.getSourceType=function(g){return gc[g]},es.setSourceType=function(g,a){gc[g]=a},es.registerForPluginStateChange=p.c$;var sa="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",wc="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Wu="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Ud="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",jl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",du="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Xt="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",qd="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",hu="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",kc="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Xn="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const pd=[];gi(sa,pd),gi(Wu,pd),gi(wc,pd);const Hl={"_prelude_fog.vertex.glsl":du,"_prelude_terrain.vertex.glsl":jl,"_prelude_shadow.vertex.glsl":kc,"_prelude_fog.fragment.glsl":Xt,"_prelude_shadow.fragment.glsl":Xn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":qd,"_prelude_raster_particle.glsl":hu},nl={};$n("",jl),$n(Xt,du),$n(Xn,kc),$n(qd,""),$n(hu,"");const Bi=$n(wc,Wu),oh=sa;var Ul={background:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in highp vec3 v_normal;in highp float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_height);\n#endif\nglFragColor=vec4(linearTosRGB(color.rgb),color.a);\n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),buildingDepth:$n("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:$n("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$n('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:$n("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$n("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:$n("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$n("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:$n("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$n("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvoid main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,normal);\n#endif\nif (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:$n("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:$n('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:$n("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:$n("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:$n("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:$n("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$n('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$n('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n#endif\n}'),terrainRaster:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:$n("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:$n('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Ud),skyboxGradient:$n('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Ud),skyboxCapture:$n("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:$n('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:$n('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:$n("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:$n("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:$n("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:$n("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:$n("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$n("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function gi(g,a){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=_.split(" ");for(const M of w)a.includes(M)||a.push(M)}}function $n(g,a){const h=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(V=>{const U=V.split(" ");return U[U.length-1]}),w=[...new Set(w)]);const M={},S=[],P=[];if(g=g.replace(h,(V,U)=>(P.push(U),"")),(a=a.replace(h,(V,U)=>(S.push(U),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...pd];gi(g,O),gi(a,O);for(const V of[...S,...P])Hl[V]||console.error(`Undefined include: ${V}`),nl[V]||(nl[V]=[],gi(Hl[V],nl[V])),O=[...O,...nl[V]];return{fragmentSource:g=g.replace(_,(V,U,X,G,Q)=>(M[Q]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nin ${X} ${G} ${Q};\n#else\nuniform ${X} ${G} u_${Q};\n#endif\n`:"initialize"===U?`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${X} ${G} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${X} ${G} ${Q};\n#endif\n`:"initialize-attribute"===U?"":void 0)),vertexSource:a=a.replace(_,(V,U,X,G,Q)=>{const se="float"===G?"vec2":G,oe=Q.match(/color/)?"color":se;return"define-attribute-vertex-shader-only"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\nin ${X} ${G} a_${Q};\n#endif\n`:M[Q]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${X} ${se} a_${Q};\nout ${X} ${G} ${Q};\n#else\nuniform ${X} ${G} u_${Q};\n#endif\n`:"initialize"===U?"vec4"===oe?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${X} ${G} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);\n#else\n    ${X} ${G} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${X} ${G} a_${Q};\n    out ${X} ${G} ${Q};\n#endif\n`:"initialize-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${Q} = a_${Q};\n#endif\n`:void 0:"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${X} ${se} a_${Q};\n#else\nuniform ${X} ${G} u_${Q};\n#endif\n`:"define-instanced"===U?"mat4"===oe?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${Q}0;\nin vec4 a_${Q}1;\nin vec4 a_${Q}2;\nin vec4 a_${Q}3;\n#else\nuniform ${X} ${G} u_${Q};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${X} ${se} a_${Q};\n#else\nuniform ${X} ${G} u_${Q};\n#endif\n`:"initialize-attribute-custom"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${X} ${G} ${Q} = a_${Q};\n#endif\n`:"vec4"===oe?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${X} ${G} ${Q} = a_${Q};\n#else\n    ${X} ${G} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${X} ${G} ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);\n#else\n    ${X} ${G} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:w,usedDefines:O,vertexIncludes:S,fragmentIncludes:P}}class Wi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,_,w,M,S,P,O){this.context=a;let V=this.boundPaintVertexBuffers.length!==w.length;for(let X=0;!V&&X<w.length;X++)this.boundPaintVertexBuffers[X]!==w[X]&&(V=!0);let U=this.boundDynamicVertexBuffers.length!==P.length;for(let X=0;!U&&X<P.length;X++)this.boundDynamicVertexBuffers[X]!==P[X]&&(U=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||V||U||this.boundIndexBuffer!==M||this.boundVertexOffset!==S)this.freshBind(h,_,w,M,S,P,O);else{a.bindVertexArrayOES.set(this.vao);for(const X of P)X&&(X.bind(),O&&X.instanceCount&&X.setVertexAttribDivisor(a.gl,h,O));M&&M.dynamicDraw&&M.bind()}}freshBind(a,h,_,w,M,S,P){const O=a.numAttributes,V=this.context,U=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=S,h.enableAttributes(U,a),h.bind(),h.setVertexAttribPointers(U,a,M);for(const X of _)X.enableAttributes(U,a),X.bind(),X.setVertexAttribPointers(U,a,M);for(const X of S)X&&(X.enableAttributes(U,a),X.bind(),X.setVertexAttribPointers(U,a,M),P&&X.instanceCount&&X.setVertexAttribDivisor(U,a,P));w&&w.bind(),V.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function zs(g,a){const h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new p.ac(0,_/h).toLngLat().lat,new p.ac(0,(_+1)/h).toLngLat().lat]}function aa(g,a,h,_,w,M,S){const P=g.context,O=P.gl,V=h.hillshadeFBO;if(!V)return;g.prepareDrawTile();const U=g.isTileAffectedByFog(a),X=g.getOrCreateProgram("hillshade",{overrideFog:U});P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,V.colorAttachment.get());const G=((de,le,be,Me)=>{const De=be.paint.get("hillshade-shadow-color"),Le="none"===be.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),Ie=be.paint.get("hillshade-highlight-color"),Oe="none"===be.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),Te=be.paint.get("hillshade-accent-color"),Be="none"===be.paint.get("hillshade-accent-color-use-theme").constantOr("default"),Ve=be.paint.get("hillshade-emissive-strength");let ct=p.al(be.paint.get("hillshade-illumination-direction"));if("viewport"===be.paint.get("hillshade-illumination-anchor"))ct-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const kt=de.style.directionalLight.properties.get("direction"),vt=p.cR(kt.x,kt.y,kt.z);ct=p.al(vt[1])}const Ye=!de.options.moving;return{u_matrix:Me||de.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Ye),u_image:0,u_latrange:zs(0,le.tileID),u_light:[be.paint.get("hillshade-exaggeration"),ct],u_shadow:De.toRenderColor(Le?null:be.lut),u_highlight:Ie.toRenderColor(Oe?null:be.lut),u_emissive_strength:Ve,u_accent:Te.toRenderColor(Be?null:be.lut)}})(g,h,_,g.terrain?a.projMatrix:null);g.uploadCommonUniforms(P,X,a.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:se,tileBoundsSegments:oe}=g.getTileBoundsBuffers(h);X.draw(g,O.TRIANGLES,w,M,S,Ln.disabled,G,_.id,Q,se,oe)}function ec(g,a,h){if(!a.needsDEMTextureUpload)return;const _=g.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||g.getTileTexture(h.stride);const M=h.getPixels();a.demTexture?a.demTexture.update(M,{premultiply:!1}):a.demTexture=new p.T(_,M,w.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Pa(g,a,h){const _=g.context,w=_.gl;if(!a.dem)return;const M=a.dem;if(_.activeTexture.set(w.TEXTURE1),ec(g,a,M),!a.demTexture)return;a.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const S=M.dim;_.activeTexture.set(w.TEXTURE0);let P=a.hillshadeFBO;if(!P){const G=new p.T(_,{width:S,height:S,data:null},w.RGBA8);G.bind(w.LINEAR,w.CLAMP_TO_EDGE),P=a.hillshadeFBO=_.createFramebuffer(S,S,!0,"renderbuffer"),P.colorAttachment.set(G.texture)}_.bindFramebuffer.set(P.framebuffer),_.viewport.set([0,0,S,S]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=g.getMercatorTileBoundsBuffers(),X=[];g.linearFloatFilteringSupported()&&X.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:X}).draw(g,w.TRIANGLES,rn.disabled,kn.disabled,Yn.unblended,Ln.disabled,((G,Q)=>{const se=Q.stride,oe=p.bz();return p.c5(oe,0,p.aj,-p.aj,0,0,1),p.bo(oe,oe,[0,-p.aj,0]),{u_matrix:oe,u_image:1,u_dimension:[se,se],u_zoom:G.overscaledZ}})(a.tileID,M),h.id,O,V,U),a.needsHillshadePrepare=!1}class jr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zu extends jr{getDefault(){return p.am.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class sh extends jr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ip extends jr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Op extends jr{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ts extends jr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Tn extends jr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Zi extends jr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class x extends jr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class T extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class H extends jr{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ee extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class pe extends jr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ee extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class nt extends jr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class St extends jr{getDefault(){return p.am.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class yt extends jr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class on extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class Y extends jr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class J extends jr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let fe=class extends jr{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Ue extends jr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class At extends jr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class xn extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Mi extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class yr extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class io extends jr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ua extends jr{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class fd extends jr{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Wc extends jr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Ar extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class s0 extends jr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class hs extends jr{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class Yu extends hs{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class tc extends hs{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class uu extends hs{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ah extends tc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $d=(g,a,h)=>({u_matrix:g,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:h}),Ks=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:M,u_image0:0,u_frustum_tl:S,u_frustum_tr:P,u_frustum_br:O,u_frustum_bl:V,u_globe_pos:U,u_globe_radius:X,u_viewport:G,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:se});function vg(g,a){return null!=g&&null!=a&&!(!g.hasData()||!a.hasData())&&null!=g.demTexture&&null!=a.demTexture&&g.tileID.key!==a.tileID.key}const qa=new class{constructor(){this.operations={}}newMorphing(g,a,h,_,w){if(g in this.operations){const M=this.operations[g];M.to.tileID.key!==h.tileID.key&&(M.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:w,from:a,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const a=this.operations[g];return{from:a.from,to:a.to,phase:a.phase}}update(g){for(const a in this.operations){const h=this.operations[a];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[a];break}}}_nextOp(g,a){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=a,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Ia={0:null,1:"TERRAIN_VERTEX_MORPHING"};function pu(g,a,h){if(0===a)return 0;const _=a<1&&514===h?.25/a:1;return 6*Math.pow(1.5,22-g)*Math.max(a,1)*_}function fu(g,a){const h=1<<g.z;return!a&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const il=g=>({u_matrix:g});function nc(g,a,h,_,w){if(w>0){const M=p.q.now(),S=(M-g.timeAdded)/w,P=a?(M-a.timeAdded)/w:-1,O=h.getSource(),V=_.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),U=!a||Math.abs(a.tileID.overscaledZ-V)>Math.abs(g.tileID.overscaledZ-V),X=U&&g.refreshedUponExpiration?1:p.aD(U?S:1-P,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),a?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}class Rp extends Es{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new p.D(p.d0(),null),w=_l("mock-dem",h,_,a.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class bg extends Es{constructor(a){const h=_l("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new p.D(p.d0(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,_){if(a.freezeTileCoverage)return;this.transform=a;const w=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,S)=>{if(M[S.key]="",!this._tiles[S.key]){const P=new Qa(S,this._source.tileSize*S.overscaleFactor(),a.tileZoom);P.state="loaded",this._tiles[S.key]=P}return M},{});for(const M in this._tiles)M in w||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(a){const h=this.proxyCachedFBO[a];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xg extends p.aM{constructor(a,h,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class a0 extends p.dt{constructor(a,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,M]=function(O){const V=new p.ba,U=new p.a_,X=131;V.reserve(17161),U.reserve(33800);const G=p.aj/128,Q=p.aj+G/2,se=Q+G;for(let de=-G;de<se;de+=G)for(let le=-G;le<se;le+=G){const be=le<0||le>Q||de<0||de>Q?24575:0,Me=p.aD(Math.round(le),0,p.aj),De=p.aD(Math.round(de),0,p.aj);V.emplaceBack(Me+be,De)}const oe=(de,le)=>{const be=le*X+de;U.emplaceBack(be+1,be,be+X),U.emplaceBack(be+X,be+X+1,be+1)};for(let de=1;de<129;de++)for(let le=1;le<129;le++)oe(le,de);return[0,129].forEach(de=>{for(let le=0;le<130;le++)oe(le,de),oe(de,le)}),[V,U,32768]}(),S=a.context;this.gridBuffer=S.createVertexBuffer(_,p.bc.members),this.gridIndexBuffer=S.createIndexBuffer(w),this.gridSegments=p.bd.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=p.bd.simpleSegment(0,0,_.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bg(h.map),this.orthoMatrix=p.bz(),p.c5(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.aj,0,p.aj,0,1);const P=S.gl;this._overlapStencilMode=new kn({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Rp(h.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,h,_){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const w=a.terrain.properties,M=0===a.terrain.drapeRenderMode,S=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=p.q.now();const P=a.terrain&&a.terrain.scope,O=w.get("source"),V=M?this._mockSourceCache:a.getSourceCache(O,P);if(!V)return void p.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=V,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(h):w.get("exaggeration"),!h.projection.requiresDraping&&S&&0===this._exaggeration)return void this._disable();this.enabled=!0;const U=()=>{this.sourceCache.used&&p.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const X=this.getScaledDemTileSize();this.sourceCache.update(h,X,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,U(),this._initializing=!0),U(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const h=this._previousCameraAltitude,_=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=_;const w=null!=h?_-h:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const M=a.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(M);let P=M-this._previousZoom;const O=this._previousUpdateTimestamp;let V=M;null!=this._evaluationZoom&&(V=this._evaluationZoom,Math.abs(M-V)>.5&&(P=.5*(M-V+P)),P*w<0&&(V+=P)),this._evaluationZoom=V;const U=S.getExaggeration(V),X=U===S.getExaggeration(Math.max(0,V-.1));if(X&&Math.abs(U-this._exaggeration)<.01)return U;let G=Math.min(.1,.00375*(this._updateTimestamp-O));return(X||U<.1||Math.abs(P)<1e-4)&&(G=Math.min(.2,4*G)),p.ai(this._exaggeration,U,G)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.ac.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(O=>{const V=h.getTileByID(O).tileID;return V.projMatrix=_.calculateProjMatrix(V.toUnwrapped()),V});!function(O,V){const U=V.transform.pointCoordinate(V.transform.getCameraPoint()),X=new p.P(U.x,U.y);O.sort((G,Q)=>{if(Q.overscaledZ-G.overscaledZ)return Q.overscaledZ-G.overscaledZ;const se=new p.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),oe=new p.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),de=X.mult(1<<G.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(se)-de.distSqr(oe)})}(w,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},w.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const O in S){const V=S[O];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,a[O],M),V.usedForTerrain))continue;const U=a[O];V.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[h.id]=w.map(O=>new xg(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const V=this.terrainTileForTile[O.key];if(!V)continue;const U=V.tileID.key;U in P||(this._visibleDemTiles.push(V),P[U]=U)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],M=w.dem;!M||w.demTexture&&!w.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),ec(this.painter,w,M))}}_prepareDemTileUniforms(a,h,_,w){if(!h||null==h.demTexture)return!1;const M=a.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-M.z),P=w||"";return _[`u_dem_tl${P}`]=[M.x*S%1,M.y*S%1],_[`u_dem_scale${P}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const M=w.dem.tree.minimums[0];return M>0&&a++,_+M},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new p.du({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(w,{premultiply:!1}):M=this._emptyDEMTexture=new p.T(a,w,h.R32F,{premultiply:!1}),M}setupElevationDraw(a,h,_){const w=this.painter.context,M=w.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let P=null,O=null,V=1;if(_&&_.morphing&&this._useVertexMorphing){const Q=_.morphing.srcDemTile,se=_.morphing.dstDemTile;V=_.morphing.phase,Q&&se&&(this._prepareDemTileUniforms(a,Q,S,"_prev")&&(O=Q),this._prepareDemTileUniforms(a,se,S)&&(P=se))}const U=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let X=null;var G;if(this.enabled?O&&P?(X=P.demTexture,w.activeTexture.set(M.TEXTURE4),O.demTexture.bind(U(O),M.CLAMP_TO_EDGE),S.u_dem_lerp=V):(P=this.terrainTileForTile[a.tileID.key],X=this._prepareDemTileUniforms(a,P,S)?P.demTexture:this.emptyDEMTexture):X=this.emptyDEMTexture,w.activeTexture.set(M.TEXTURE2),X&&(S.u_dem_size=1===(G=X).size[0]?1:G.size[0]-2,X.bind(U(P),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,h,S),_&&_.useMeterToDem&&P){const Q=(1<<P.tileID.canonical.z)*p.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=Q}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,S),"globe"===this.painter.transform.projection.name){const Q=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,Q)}}globeUniformValues(a,h,_){const w=a.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,p.aj,0),u_tile_br_up:w.upVector(h,p.aj,p.aj),u_tile_bl_up:w.upVector(h,0,p.aj),u_tile_up_scale:_?p.dv(1):w.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,M,S,P,O){if("globe"===w.transform.projection.name)!function(V,U,X,G,Q){const se=V.context,oe=se.gl;let de,le;const be=V.transform,Me=p.dl(V,se,be),De=(kt,vt)=>{if(le===vt)return;const Pt=[Ia[vt],"PROJECTION_GLOBE_VIEW"];Me&&Pt.push("CUSTOM_ANTIALIASING");const Je=V.isTileAffectedByFog(kt);de=V.getOrCreateProgram("globeRaster",{defines:Pt,overrideFog:Je}),le=vt},Le=V.colorModeForRenderPass(),Ie=new rn(oe.LEQUAL,rn.ReadWrite,V.depthRangeFor3D);qa.update(Q);const Oe=p.dm(be),Te=[p.ay(be.center.lng),p.aH(be.center.lat)],Be=V.globeSharedBuffers,Ve=[be.width*p.q.devicePixelRatio,be.height*p.q.devicePixelRatio],ct=Float32Array.from(be.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};{const kt=V.transform,vt=pu(kt.zoom,U.exaggeration(),U.sourceCache._source.tileSize);le=-1;const Pt=oe.TRIANGLES;for(const Je of G){const ot=X.getTile(Je),Ke=kn.disabled,xt=U.prevTerrainTileForTile[Je.key],dt=U.terrainTileForTile[Je.key];vg(xt,dt)&&qa.newMorphing(Je.key,xt,dt,Q,250),se.activeTexture.set(oe.TEXTURE0),ot.texture&&ot.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Ot=qa.getMorphValuesForProxy(Je.key),wt=Ot?1:0;Ot&&p.L(Ye,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:p.dk(Ot.phase)}});const It=p.dn(Je.canonical),Lt=p.dp(It.getCenter().lat),fn=p.dq(Je.canonical,It,Lt,kt.worldSize/kt._pixelsPerMercatorPixel),bn=p.bh(p.dr(Je.canonical)),dn=Ks(kt.expandedFarZProjMatrix,ct,Oe,bn,p.ah(kt.zoom),Te,kt.frustumCorners.TL,kt.frustumCorners.TR,kt.frustumCorners.BR,kt.frustumCorners.BL,kt.globeCenterInViewSpace,kt.globeRadius,Ve,vt,kt._farZ,fn);if(De(Je,wt),de&&(U.setupElevationDraw(ot,de,Ye),V.uploadCommonUniforms(se,de,Je.toUnwrapped()),Be)){const[an,mn,Dn]=Be.getGridBuffers(Lt,0!==vt);de.draw(V,Pt,Ie,Ke,Le,Ln.backCCW,dn,"globe_raster",an,mn,Dn)}}}if(Be&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const kt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Me&&kt.push("CUSTOM_ANTIALIASING"),de=V.getOrCreateProgram("globeRaster",{defines:kt});for(const vt of G){const{x:Pt,y:Je,z:ot}=vt.canonical,Ke=0===Je,xt=Je===(1<<ot)-1,[dt,Ot,wt,It]=Be.getPoleBuffers(ot,!1);if(It&&(Ke||xt)){const Lt=X.getTile(vt);se.activeTexture.set(oe.TEXTURE0),Lt.texture&&Lt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let fn=p.ds(ot,Pt,be);const bn=p.bh(p.dr(vt.canonical)),dn=(an,mn)=>an.draw(V,oe.TRIANGLES,Ie,kn.disabled,Le,Ln.disabled,Ks(be.expandedFarZProjMatrix,fn,fn,bn,0,Te,be.frustumCorners.TL,be.frustumCorners.TR,be.frustumCorners.BR,be.frustumCorners.BL,be.globeCenterInViewSpace,be.globeRadius,Ve,0,be._farZ),"globe_pole_raster",mn,wt,It);U.setupElevationDraw(Lt,de,Ye),V.uploadCommonUniforms(se,de,vt.toUnwrapped()),Ke&&V.renderDefaultNorthPole&&dn(de,dt),xt&&V.renderDefaultSouthPole&&(fn=p.cE(p.bz(),fn,[1,-1,1]),dn(de,Ot))}}}}(w,M,S,P,O);else{const V=w.context,U=V.gl;let X,G;const Q=w.shadowRenderer,se=Ys(w,w.longestCutoffRange),oe=Le=>{if(G===Le)return;const Ie=[];Ie.push(Ia[Le]),se.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),Q&&(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Ie.push("NORMAL_OFFSET")),X=w.getOrCreateProgram("terrainRaster",{defines:Ie}),G=Le},de=w.colorModeForRenderPass(),le=new rn(U.LEQUAL,rn.ReadWrite,w.depthRangeFor3D);qa.update(O);const be=w.transform,Me=pu(be.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let De=[0,0,0];if(Q){const Le=w.style.directionalLight,Ie=w.style.ambientLight;Le&&Ie&&(De=Ha(w.style,Le,Ie))}{G=-1;const Le=U.TRIANGLES,[Ie,Oe]=[M.gridIndexBuffer,M.gridSegments];for(const Te of P){const Be=S.getTile(Te),Ve=kn.disabled,ct=M.prevTerrainTileForTile[Te.key],Ye=M.terrainTileForTile[Te.key];vg(ct,Ye)&&qa.newMorphing(Te.key,ct,Ye,O,250),V.activeTexture.set(U.TEXTURE0),Be.texture&&Be.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const kt=qa.getMorphValuesForProxy(Te.key),vt=kt?1:0;let Pt;kt&&(Pt={morphing:{srcDemTile:kt.from,dstDemTile:kt.to,phase:p.dk(kt.phase)}});const Je=$d(Te.projMatrix,fu(Te.canonical,be.renderWorldCopies)?Me/10:Me,De);if(oe(vt),!X)continue;M.setupElevationDraw(Be,X,Pt);const ot=Te.toUnwrapped();Q&&Q.setupShadows(ot,X),w.uploadCommonUniforms(V,X,ot,null,se),X.draw(w,Le,le,Ve,de,Ln.backCCW,Je,"terrain_raster",M.gridBuffer,Ie,Oe)}}}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,M=this.proxiedCoords[w.id],S=this._drapedRenderBatches.shift(),P=h.style.order,O=[];let V=0;for(const U of M){const X=w.getTileByID(U.proxyTileKey),G=w.proxyCachedFBO[U.key]?w.proxyCachedFBO[U.key][a]:void 0,Q=void 0!==G?w.renderCache[G]:this.pool[V++],se=void 0!==G;if(X.texture=Q.tex,se&&!Q.dirty){O.push(X.tileID);continue}let oe;_.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(_.clear({color:p.am.transparent,stencil:0}),Q.dirty=!1);for(let de=S.start;de<=S.end;++de){const le=h.style._mergedLayers[P[de]];if(le.isHidden(h.transform.zoom))continue;const be=h.style.getLayerSourceCache(le),Me=be?this.proxyToSource[U.key][be.id]:[U];if(!Me)continue;const De=Me;_.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(be?be.id:null)&&(this._setupStencil(Q,Me,le,be),oe=be?be.id:null),h.renderLayer(h,be,le,De)}if(0===this._drapedRenderBatches.length)for(const de of this._pendingGroundEffectLayers){const le=h.style._mergedLayers[P[de]];if(le.isHidden(h.transform.zoom))continue;const be=h.style.getLayerSourceCache(le),Me=be?this.proxyToSource[U.key][be.id]:[U];if(!Me)continue;const De=Me;_.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(be?be.id:null)&&(this._setupStencil(Q,Me,le,be),oe=be?be.id:null),h.renderLayer(h,be,le,De)}this.renderedToTile?(Q.dirty=!0,O.push(X.tileID)):se||--V,5===V&&(V=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}isLayerOrderingCorrect(a){const h=a.order.length;let _=-1,w=h;for(let M=0;M<h;++M)this._style.isLayerDraped(a._mergedLayers[a.order[M]])?_=Math.max(_,M):w=Math.min(w,M);return w>_}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const S=M.tileID,P=1<<S.overscaledZ,{x:O,y:V}=S.canonical,U=O/P,X=(O+1)/P,G=V/P,Q=(V+1)/P;return{minx:U,miny:G,maxx:X,maxy:Q,t:M.dem.tree.raycastRoot(U,G,X,Q,a,h,_),tile:M}});w.sort((M,S)=>(null!==M.t?M.t:Number.MAX_VALUE)-(null!==S.t?S.t:Number.MAX_VALUE));for(const M of w){if(null==M.t)return null;const S=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,a,h,_);if(null!=S)return S}return null}_createFBO(){const a=this.painter.context,h=a.gl,_=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const w=new p.T(a,{width:_[0],height:_[1],data:null},h.RGBA8);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const M=a.createFramebuffer(_[0],_[1],!0,null);return M.colorAttachment.set(w.texture),M.depthAttachment=new ah(a,M.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:M,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._mergedLayers[a],_=h.isHidden(this.painter.transform.zoom);return"hillshade"===h.type||"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style.getSources())if(_ instanceof cs){a=!0;break}if(!a)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._mergedLayers[this._style.order[_]],M=this._style.getLayerSourceCache(w);if(M&&!h[M.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof p.ab){h[M.id]=!0;for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][M.id];if(P)for(const O of P)this._clearRenderCacheForTile(M.id,O)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof rr){a=!0;break}if(!a)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._mergedLayers[this._style.order[_]],M=this._style.getLayerSourceCache(w);if(!M||h[M.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const S=w.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][M.id];if(O)for(const V of O){const U=nc(M.getTile(V),M.findLoadedParent(V,0),M,this.painter.transform,S);(1!==U.opacity||0!==U.mix)&&this._clearRenderCacheForTile(M.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,h=a.length;if(0===h)return;const _=[];this._pendingGroundEffectLayers=[];let w,M=0,S=this._style._mergedLayers[a[M]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++M<h;)S=this._style._mergedLayers[a[M]];for(;M<h;++M){const P=this._style._mergedLayers[a[M]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?void 0===w&&(w=M):("fill-extrusion"===P.type&&this._pendingGroundEffectLayers.push(M),void 0!==w&&(_.push({start:w,end:M-1}),w=void 0)))}if(void 0!==w&&_.push({start:w,end:M-1}),0!==_.length){const P=_[_.length-1];this._pendingGroundEffectLayers.every(O=>O>P.end)||p.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let P=0;P<S.length;++P){const O=Object.values(S[P]);h.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const P=_[S];if(h.getTileByID(P.key),void 0!==h.proxyCachedFBO[P.key]){const O=a[P.key],V=this.proxyToSource[P.key];let U=0;for(const X in V){const G=V[X],Q=O[X];if(!Q||Q.length!==G.length||G.some((se,oe)=>se!==Q[oe]||w[X]&&w[X].hasOwnProperty(se.key))){U=-1;break}++U}for(const X in h.proxyCachedFBO[P.key])h.renderCache[h.proxyCachedFBO[P.key][X]].dirty=U<0||U!==Object.values(O).length}}const M=[...this._drapedRenderBatches];M.sort((S,P)=>P.end-P.start-(S.end-S.start));for(const S of M)for(const P of _){if(h.proxyCachedFBO[P.key])continue;let O=h.renderCachePool.pop();void 0===O&&h.renderCache.length<50&&(O=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==O&&(h.proxyCachedFBO[P.key]={},h.proxyCachedFBO[P.key][S.start]=O,h.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,S=M.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let P;if(_.isTileClipped())P=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):kn.disabled}_renderTileClippingMasks(a,h){const _=this.painter,w=this.painter.context,M=w.gl;_._tileClippingMaskIDs={},w.setColorMode(Yn.disabled),w.setDepthMode(rn.disabled);const S=_.getOrCreateProgram("clippingMask");for(const P of a){const O=_._tileClippingMaskIDs[P.key]=--h;S.draw(_,M.TRIANGLES,rn.disabled,new kn({func:M.ALWAYS,mask:0},O,255,M.KEEP,M.KEEP,M.REPLACE),Yn.disabled,Ln.disabled,il(P.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const _=[a.x,a.y,1,1];p.aA(_,_,h.pixelMatrixInverse),p.cw(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,M=p.c6(1,h.center.lat),S=[w[0],w[1],w[2]/M,0],P=p.cY([],_.slice(0,3),S);p.au(P,P);const O=this.raycast(S,P,this._exaggeration);return null!==O&&O?(p.bF(S,S,P,O),S[3]=S[2],S[2]*=M,S):null}_setupProxiedCoordsForOrtho(a,h,_){if(a.getSource()instanceof p.aP)return this._setupProxiedCoordsForImageSource(a,h,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const w=this.proxiedCoords[a.id]=[],M=this.proxyCoords;for(let O=0;O<M.length;O++){const V=M[O],U=this._findTileCoveringTileID(V,a);if(U){const X=this._createProxiedId(V,U,_[V.key]&&_[V.key][a.id]);w.push(X),this.proxyToSource[V.key][a.id]=[X]}}let S=!1;const P=new Set;for(let O=0;O<h.length;O++){const V=a.getTile(h[O]);if(!V||!V.hasData())continue;const U=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==V.tileID.canonical.z){const X=this.proxyToSource[U.tileID.key][a.id],G=this._createProxiedId(U.tileID,V,_[U.tileID.key]&&_[U.tileID.key][a.id]);X?X.splice(X.length-1,0,G):this.proxyToSource[U.tileID.key][a.id]=[G];const Q=this.proxyToSource[U.tileID.key][a.id];P.has(Q)||P.add(Q),w.push(G),S=!0}}if(this._sourceTilesOverlap[a.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const O of P)O.sort((V,U)=>U.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(a,h,_){if(!a.getSource().loaded())return;const w=this.proxiedCoords[a.id]=[],M=this.proxyCoords,S=a.getSource(),P=S.tileID;if(!P)return;const O=new p.P(P.x,P.y)._div(1<<P.z),V=S.coordinates.map(p.ac.fromLngLat).reduce((X,G)=>(X.min.x=Math.min(X.min.x,G.x-O.x),X.min.y=Math.min(X.min.y,G.y-O.y),X.max.x=Math.max(X.max.x,G.x-O.x),X.max.y=Math.max(X.max.y,G.y-O.y),X),{min:new p.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(X,G)=>{const Q=X.wrap+X.canonical.x/(1<<X.canonical.z),se=X.canonical.y/(1<<X.canonical.z),oe=p.aj/(1<<X.canonical.z),de=G.wrap+G.canonical.x/(1<<G.canonical.z),le=G.canonical.y/(1<<G.canonical.z);return Q+oe<de+V.min.x||Q>de+V.max.x||se+oe<le+V.min.y||se>le+V.max.y};for(let X=0;X<M.length;X++){const G=M[X];for(let Q=0;Q<h.length;Q++){const se=a.getTile(h[Q]);if(!se||!se.hasData()||U(G,se.tileID))continue;const oe=this._createProxiedId(G,se,_[G.key]&&_[G.key][a.id]),de=this.proxyToSource[G.key][a.id];de?de.push(oe):this.proxyToSource[G.key][a.id]=[oe],w.push(oe)}}}_createProxiedId(a,h,_){let w=this.orthoMatrix;if(_){const M=_.find(S=>S.key===h.tileID.key);if(M)return M}if(h.tileID.key!==a.key){const M=a.canonical.z-h.tileID.canonical.z;let S,P,O;w=p.bz();const V=h.tileID.wrap-a.wrap<<a.overscaledZ;M>0?(S=p.aj>>M,P=S*((h.tileID.canonical.x<<M)-a.canonical.x+V),O=S*((h.tileID.canonical.y<<M)-a.canonical.y)):(S=p.aj<<-M,P=p.aj*(h.tileID.canonical.x-(a.canonical.x+V<<-M)),O=p.aj*(h.tileID.canonical.y-(a.canonical.y<<-M))),p.c5(w,0,S,0,S,0,1),p.bo(w,w,[P,O,0])}return new xg(h.tileID,a.key,w)}_findTileCoveringTileID(a,h){let _=h.getTile(a);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],M=w[a.key];if(_=M?h.getTileByID(M):null,_&&_.hasData()||null===M)return _;let S=_?_.tileID:a,P=S.overscaledZ;const O=h.getSource().minzoom,V=[];if(!M){const X=h.getSource().maxzoom;if(a.canonical.z>=X){const G=a.canonical.z-X;h.getSource().reparseOverscaled?(P=Math.max(a.canonical.z+2,h.transform.tileZoom),S=new p.aM(P,a.wrap,X,a.canonical.x>>G,a.canonical.y>>G)):0!==G&&(P=X,S=new p.aM(P,a.wrap,X,a.canonical.x>>G,a.canonical.y>>G))}S.key!==a.key&&(V.push(S.key),_=h.getTile(S))}const U=X=>{V.forEach(G=>{w[G]=X}),V.length=0};for(P-=1;P>=O&&(!_||!_.hasData());P--){_&&U(_.tileID.key);const X=S.calculateScaledKey(P);if(_=h.getTileByID(X),_&&_.hasData())break;const G=w[X];if(null===G)break;void 0===G?V.push(X):_=h.getTileByID(G)}return U(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[h.key]=!0}}function l0(g,a,h){const _=function(P,O,V){const U=p.bE(O,P),X=p.bE(V,[.2126,.7152,.0722]),G=(se,oe,de)=>(1-de)*se+de*oe,Q=G(1-.3*Math.min(X,1),1,Math.min(U+1,1));return G(.92,1,Math.asin(p.aD(O[2],-1,1))/Math.PI+.5)*Q}(g,[0,0,1],a),w=[0,0,0];p.b$(w,h.slice(0,3),_);const M=[0,0,0];p.b$(M,a.slice(0,3),g[2]);const S=[0,0,0];return p.cU(S,w,M),p.cX(S)}const wg=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ey=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class c0{static cacheKey(a,h,_,w){let M=`${h}${w?w.cacheKey:""}`;for(const S of _)a.usedDefines.includes(S)&&(M+=`/${S}`);return M}constructor(a,h,_,w,M,S){const P=a.gl;this.program=P.createProgram(),this.configuration=w,this.name=h,this.fixedDefines=[...S];const O=w?w.getBinderAttributes():[],V=(_.staticAttributes||[]).concat(O);let U=w?w.defines():[];U=U.concat(S.map(de=>`#define ${de}`));const X="#version 300 es\n";let G=X+U.concat("precision mediump float;",oh,Bi.fragmentSource).join("\n");for(const de of _.fragmentIncludes)G+=`\n${Hl[de]}`;G+=`\n${_.fragmentSource}`;let Q=X+U.concat("precision highp float;",oh,Bi.vertexSource).join("\n");for(const de of _.vertexIncludes)Q+=`\n${Hl[de]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&-1!==_.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(Q+="\nuniform int u_instanceID;\n"),Q+=`\n${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const se=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(se,G),P.compileShader(se),P.attachShader(this.program,se);const oe=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(oe,Q),P.compileShader(oe),P.attachShader(this.program,oe),this.attributes={},this.numAttributes=V.length;for(let de=0;de<this.numAttributes;de++)if(V[de]){const le=V[de].startsWith("a_")?V[de]:`a_${V[de]}`;P.bindAttribLocation(this.program,de,le),this.attributes[le]=de}P.linkProgram(this.program),P.deleteShader(oe),P.deleteShader(se),this.fixedUniforms=M(a),this.binderUniforms=w?w.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms={u_instanceID:new p.cc(a)}),(S.includes("TERRAIN")||-1!==h.indexOf("symbol")||-1!==h.indexOf("circle"))&&(this.terrainUniforms={u_dem:new p.cc(de=a),u_dem_prev:new p.cc(de),u_dem_tl:new p.c9(de),u_dem_scale:new p.cb(de),u_dem_tl_prev:new p.c9(de),u_dem_scale_prev:new p.cb(de),u_dem_size:new p.cb(de),u_dem_lerp:new p.cb(de),u_exaggeration:new p.cb(de),u_depth:new p.cc(de),u_depth_size_inv:new p.c9(de),u_depth_range_unpack:new p.c9(de),u_occluder_half_size:new p.cb(de),u_occlusion_depth_offset:new p.cb(de),u_meter_to_dem:new p.cb(de),u_label_plane_matrix_inv:new p.c8(de)}),S.includes("GLOBE")&&(this.globeUniforms=(de=>({u_tile_tl_up:new p.ca(de),u_tile_tr_up:new p.ca(de),u_tile_br_up:new p.ca(de),u_tile_bl_up:new p.ca(de),u_tile_up_scale:new p.cb(de)}))(a)),S.includes("FOG")&&(this.fogUniforms=(de=>({u_fog_matrix:new p.c8(de),u_fog_range:new p.c9(de),u_fog_color:new p.cQ(de),u_fog_horizon_blend:new p.cb(de),u_fog_vertical_limit:new p.c9(de),u_fog_temporal_offset:new p.cb(de),u_frustum_tl:new p.ca(de),u_frustum_tr:new p.ca(de),u_frustum_br:new p.ca(de),u_frustum_bl:new p.ca(de),u_globe_pos:new p.ca(de),u_globe_radius:new p.cb(de),u_globe_transition:new p.cb(de),u_is_globe:new p.cc(de),u_viewport:new p.c9(de)}))(a)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(de=>({u_cutoff_params:new p.cQ(de)}))(a)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(de=>({u_lighting_ambient_color:new p.ca(de),u_lighting_directional_dir:new p.ca(de),u_lighting_directional_color:new p.ca(de),u_ground_radiance:new p.ca(de)}))(a)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(de=>({u_light_matrix_0:new p.c8(de),u_light_matrix_1:new p.c8(de),u_fade_range:new p.c9(de),u_shadow_normal_offset:new p.ca(de),u_shadow_intensity:new p.cb(de),u_shadow_texel_size:new p.cb(de),u_shadow_map_resolution:new p.cb(de),u_shadow_direction:new p.ca(de),u_shadow_bias:new p.ca(de),u_shadowmap_0:new p.cc(de),u_shadowmap_1:new p.cc(de)}))(a))}var de}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}setCutoffUniformValues(a,h){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}setLightsUniformValues(a,h){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}setShadowUniformValues(a,h){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;a.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}_drawDebugWireframe(a,h,_,w,M,S,P,O,V,U){const X=a.options.wireframe;if(!1===X.terrain&&!1===X.layers2D&&!1===X.layers3D)return;const G=a.context;if(!(()=>!(!X.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!X.layers2D||a._terrain&&a._terrain.renderingToTexture||!wg.includes(this.name))||!(!X.layers3D||!Ey.includes(this.name)))())return;const Q=G.gl,se=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,M,G);if(!se)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const de=a.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});G.program.set(de.program);const le=(De,Le,Ie)=>{if(Le[De]&&Ie[De])for(const Oe in Le[De])Ie[De][Oe]&&Ie[De][Oe].set(Ie.program,Oe,Le[De][Oe].current)};V&&V.setUniforms(de.program,G,de.binderUniforms,P,{zoom:O}),le("fixedUniforms",this,de),le("terrainUniforms",this,de),le("globeUniforms",this,de),le("fogUniforms",this,de),le("lightsUniforms",this,de),le("shadowUniforms",this,de),se.bind(),G.setColorMode(new Yn([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],p.am.transparent,[!0,!0,!0,!1])),G.setDepthMode(new rn(h.func===Q.LESS?Q.LEQUAL:h.func,rn.ReadOnly,h.range)),G.setStencilMode(kn.disabled);const be=3*S.primitiveLength*2,Me=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const De=U||1;for(let Le=0;Le<De;++Le)de.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),Q.drawElements(Q.LINES,be,Q.UNSIGNED_SHORT,Me)}else U&&U>1?Q.drawElementsInstanced(Q.LINES,be,Q.UNSIGNED_SHORT,Me,U):Q.drawElements(Q.LINES,be,Q.UNSIGNED_SHORT,Me);M.bind(),G.program.set(this.program),G.setDepthMode(h),G.setStencilMode(_),G.setColorMode(w)}checkUniforms(a,h,_){if(this.fixedDefines.includes(h))for(const w of Object.keys(_))if(!_[w].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${w} not set but required by ${h} being defined`)}draw(a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de){const le=a.context,be=le.gl;if(this.failedToCreate)return;le.program.set(this.program),le.setDepthMode(_),le.setStencilMode(w),le.setColorMode(M),le.setCullFace(S);for(const Le of Object.keys(this.fixedUniforms))this.fixedUniforms[Le].set(this.program,Le,P[Le]);se&&se.setUniforms(this.program,le,this.binderUniforms,G,{zoom:Q});const Me={[be.POINTS]:1,[be.LINES]:2,[be.TRIANGLES]:3,[be.LINE_STRIP]:1}[h];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const De=de&&de>0?1:void 0;for(const Le of X.get()){const Ie=Le.vaos||(Le.vaos={});if((Ie[O]||(Ie[O]=new Wi)).bind(le,this,V,se?se.getPaintVertexBuffers():[],U,Le.vertexOffset,oe||[],De),this.forceManualRenderingForInstanceIDShaders){const Oe=de||1;for(let Te=0;Te<Oe;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),U?be.drawElements(h,Le.primitiveLength*Me,be.UNSIGNED_SHORT,Le.primitiveOffset*Me*2):be.drawArrays(h,Le.vertexOffset,Le.vertexLength)}else de&&de>1?be.drawElementsInstanced(h,Le.primitiveLength*Me,be.UNSIGNED_SHORT,Le.primitiveOffset*Me*2,de):U?be.drawElements(h,Le.primitiveLength*Me,be.UNSIGNED_SHORT,Le.primitiveOffset*Me*2):be.drawArrays(h,Le.vertexOffset,Le.vertexLength);h===be.TRIANGLES&&U&&this._drawDebugWireframe(a,_,w,M,U,Le,G,Q,se,de)}}}function kg(g,a,h=0){const _=Math.pow(2,a.tileID.overscaledZ),w=a.tileSize*Math.pow(2,g.transform.tileZoom)/_,M=w*(a.tileID.canonical.x+a.tileID.wrap*_),S=w*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/p.aw(a,1,g.transform.tileZoom),u_pixel_coord_upper:[M>>16,S>>16],u_pixel_coord_lower:[65535&M,65535&S],u_pattern_transition:h}}const Mg={terrain:0,flat:1},vb=p.bz(),Lp=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le)=>{const be=a.style.light,Me=be.properties.get("position"),De=[Me.x,Me.y,Me.z],Le=p.dx();"viewport"===be.properties.get("anchor")&&(p.dy(Le,-a.transform.angle),p.dz(De,De,Le));const Ie=be.properties.get("color"),Oe=a.transform,Te={u_matrix:g,u_lightpos:De,u_lightintensity:be.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:vb,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Mg[V],u_base_type:Mg[U],u_ao:w,u_edge_radius:M,u_width_scale:S,u_flood_light_color:se,u_vertical_scale:oe,u_flood_light_intensity:de,u_ground_shadow_factor:le};return"globe"===Oe.projection.name&&(Te.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],Te.u_zoom_transition=X,Te.u_inv_rot_matrix=Q,Te.u_merc_center=G,Te.u_up_dir=Oe.projection.upVector(new p.cp(0,0,0),G[0]*p.aj,G[1]*p.aj),Te.u_height_lift=O),Te},vM=(g,a,h,_,w,M)=>({u_matrix:g,u_edge_radius:a,u_width_scale:h,u_vertical_scale:_,u_height_type:Mg[w],u_base_type:Mg[M]}),bM=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le)=>{const be=Lp(g,a,h,_,w,M,S,P,V,U,X,G,Q,se,oe,de,1,[0,0,0]),Me={u_height_factor:-Math.pow(2,P.overscaledZ)/O.tileSize/8};return p.l(be,kg(a,O,le),Me)},bb=(g,a,h)=>({u_matrix:g,u_emissive_strength:a,u_ground_shadow_factor:h}),xb=(g,a,h,_,w,M=0)=>p.l(bb(g,a,w),kg(h,_,M)),xM=(g,a,h,_)=>({u_matrix:g,u_world:h,u_emissive_strength:a,u_ground_shadow_factor:_}),wM=(g,a,h,_,w,M,S=0)=>p.l(xb(g,a,h,_,M,S),{u_world:w}),Cg=(g,a)=>({u_matrix:g,u_ground_shadow_factor:a}),Fp=(g,a,h,_,w)=>({u_matrix:g,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:h,u_height_scale:_,u_reset_depth:w}),wb=(g,a,h,_)=>{const w=p.aj/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/w,a.pixelsToGLUnits[1]/w]}},zp=(g,a,h=1)=>({u_matrix:g,u_color:a.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),kb=p.bz(),mu=(g,a,h,_,w,M,S)=>{const P=g.transform,O="globe"===P.projection.name,V=O?p.dA(P.zoom,a.canonical)*P._pixelsPerMercatorPixel:p.aw(h,1,M),U={u_matrix:a.projMatrix,u_extrude_scale:V,u_intensity:S,u_inv_rot_matrix:kb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){U.u_inv_rot_matrix=_,U.u_merc_center=w,U.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],U.u_zoom_transition=p.ah(P.zoom);const X=w[0]*p.aj,G=w[1]*p.aj;U.u_up_dir=P.projection.upVector(new p.cp(0,0,0),X,G)}return U};function lh(g,[a,h,_,w],[M,S]){if(M===S)return[0,0,0,0];const P=255*(g-1)/(g*(S-M));return[a*P,h*P,_*P,w*P]}function d0(g,a,[h,_]){return h===_?0:.5/g+(a-h)*(g-1)/(g*(_-h))}const Xu=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be,Me,De)=>({u_matrix:g,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:w,u_tl_parent:M,u_scale_parent:V,u_fade_t:U.mix,u_opacity:U.opacity*X.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:X.paint.get("raster-brightness-min"),u_brightness_high:X.paint.get("raster-brightness-max"),u_saturation_factor:p.dB(X.paint.get("raster-saturation")),u_contrast_factor:p.dC(X.paint.get("raster-contrast")),u_spin_weights:rl(X.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:Q,u_zoom_transition:S,u_merc_center:P,u_cutoff_params:O,u_colorization_mix:lh(p.dD,oe,le),u_colorization_offset:d0(p.dD,de,le),u_color_ramp:se,u_texture_offset:[Me/(be+2*Me),be/(be+2*Me)],u_texture_res:[be+2*Me,be+2*Me],u_emissive_strength:De});function rl(g){g*=Math.PI/180;const a=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const ql=.05,Mc=(g,a,h,_,w,M,S,P,O,V,U,X)=>({u_matrix:g,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:w,u_tl_parent:M,u_scale_parent:V,u_fade_t:U.mix,u_opacity:U.opacity,u_image0:0,u_image1:1,u_raster_elevation:X,u_zoom_transition:S,u_merc_center:P,u_cutoff_params:O}),Gf=(g,a,h,_,w,M,S,P,O,V)=>({u_particle_texture:g,u_particle_texture_side_len:a,u_tile_offset:h,u_velocity:_,u_color_ramp:M,u_velocity_res:w,u_max_speed:S,u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[ql,ql]}),h0=(g,a,h,_,w,M,S,P,O,V)=>({u_particle_texture:g,u_particle_texture_side_len:a,u_velocity:h,u_velocity_res:_,u_max_speed:w,u_speed_factor:M,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[ql,ql]}),Sg=p.bz(),Wf=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be,Me,De,Le,Ie)=>{const Oe=w.transform,Te={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Oe.getCameraToCenterDistance(be),u_rotate_symbol:+h,u_aspect_ratio:Oe.width/Oe.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+V,u_elevation_from_sea:O?1:0,u_pitch_with_map:+_,u_texsize:U,u_texsize_icon:X,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Sg,u_up_vector:[0,-1,0],u_color_adj_mat:De,u_icon_transition:Le||0,u_gamma_scale:_?w.transform.getCameraToCenterDistance(be)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:p.q.devicePixelRatio,u_is_halo:+G,u_scale_factor:Ie||1,u_ground_shadow_factor:Me,u_inv_matrix:p.bi(p.bz(),S)};return"globe"===be.name&&(Te.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],Te.u_zoom_transition=se,Te.u_inv_rot_matrix=de,Te.u_merc_center=oe,Te.u_camera_forward=Oe._camera.forward(),Te.u_ecef_origin=p.dE(Oe.globeMatrix,Q.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Oe.globeMatrix),Te.u_up_vector=le),Te},Np=(g,a,h,_)=>({u_matrix:g,u_emissive_strength:a,u_opacity:h,u_color:_}),u0=(g,a,h,_,w,M,S,P,O)=>p.l(function(V,U,X,G,Q,se){const{width:oe,height:de}=G.imageManager.getPixelSize(U),le=Math.pow(2,se.tileID.overscaledZ),be=se.tileSize*Math.pow(2,G.transform.tileZoom)/le,Me=be*(se.tileID.canonical.x+se.tileID.wrap*le),De=be*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[oe,de],u_pattern_size:X.displaySize,u_pattern_units_to_pixels:Q?[G.transform.width,-1*G.transform.height]:[1/p.aw(se,1,G.transform.tileZoom),1/p.aw(se,1,G.transform.tileZoom)],u_pixel_coord_upper:[Me>>16,De>>16],u_pixel_coord_lower:[65535&Me,65535&De]}}(0,M,S,_,P,O),{u_matrix:g,u_emissive_strength:a,u_opacity:h}),Bp=new Float32Array(p.bx([])),Rh=(g,a,h,_,w,M,S,P,O,V,U,X,G,Q=[0,0,0],se)=>{const oe=w.style.light,de=oe.properties.get("position"),le=[-de.x,-de.y,de.z],be=p.dx();"viewport"===oe.properties.get("anchor")&&(p.dy(be,-w.transform.angle),p.dz(le,le,be));const Me="MASK"===U.alphaMode,De=oe.properties.get("color").toRenderColor(null),Le=G.paint.get("model-ambient-occlusion-intensity"),Ie=G.paint.get("model-color").constantOr(p.am.white).toRenderColor(null),Oe=G.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:a,u_normal_matrix:h,u_node_matrix:_||Bp,u_lightpos:le,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[De.r,De.g,De.b],u_camera_pos:Q,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+Me,u_alphaCutoff:U.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[P[0],P[1],P[2],1],u_metallicFactor:O,u_roughnessFactor:V,u_baseColorTexture:Ds.BaseColor,u_metallicRoughnessTexture:Ds.MetallicRoughness,u_normalTexture:Ds.Normal,u_occlusionTexture:Ds.Occlusion,u_emissionTexture:Ds.Emission,u_lutTexture:Ds.LUT,u_color_mix:[Ie.r,Ie.g,Ie.b,Oe],u_aoIntensity:Le,u_emissive_strength:X,u_occlusionTextureTransform:se||[0,0,0,0]}},p0=(g,a=Bp,h=Bp)=>({u_matrix:g,u_instance:a,u_node_matrix:h}),Dy={fillExtrusion:g=>({u_matrix:new p.c8(g),u_lightpos:new p.ca(g),u_lightintensity:new p.cb(g),u_lightcolor:new p.ca(g),u_vertical_gradient:new p.cb(g),u_opacity:new p.cb(g),u_edge_radius:new p.cb(g),u_width_scale:new p.cb(g),u_ao:new p.c9(g),u_height_type:new p.cc(g),u_base_type:new p.cc(g),u_tile_id:new p.ca(g),u_zoom_transition:new p.cb(g),u_inv_rot_matrix:new p.c8(g),u_merc_center:new p.c9(g),u_up_dir:new p.ca(g),u_height_lift:new p.cb(g),u_flood_light_color:new p.ca(g),u_vertical_scale:new p.cb(g),u_flood_light_intensity:new p.cb(g),u_ground_shadow_factor:new p.ca(g)}),fillExtrusionDepth:g=>({u_matrix:new p.c8(g),u_edge_radius:new p.cb(g),u_width_scale:new p.cb(g),u_vertical_scale:new p.cb(g),u_height_type:new p.cc(g),u_base_type:new p.cc(g)}),fillExtrusionPattern:g=>({u_matrix:new p.c8(g),u_lightpos:new p.ca(g),u_lightintensity:new p.cb(g),u_lightcolor:new p.ca(g),u_vertical_gradient:new p.cb(g),u_height_factor:new p.cb(g),u_edge_radius:new p.cb(g),u_width_scale:new p.cb(g),u_ao:new p.c9(g),u_height_type:new p.cc(g),u_base_type:new p.cc(g),u_tile_id:new p.ca(g),u_zoom_transition:new p.cb(g),u_inv_rot_matrix:new p.c8(g),u_merc_center:new p.c9(g),u_up_dir:new p.ca(g),u_height_lift:new p.cb(g),u_image:new p.cc(g),u_texsize:new p.c9(g),u_pixel_coord_upper:new p.c9(g),u_pixel_coord_lower:new p.c9(g),u_tile_units_to_pixels:new p.cb(g),u_opacity:new p.cb(g),u_pattern_transition:new p.cb(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new p.c8(g),u_opacity:new p.cb(g),u_ao_pass:new p.cb(g),u_meter_to_tile:new p.cb(g),u_ao:new p.c9(g),u_flood_light_intensity:new p.cb(g),u_flood_light_color:new p.ca(g),u_attenuation:new p.cb(g),u_edge_radius:new p.cb(g),u_fb:new p.cc(g),u_fb_size:new p.cb(g),u_dynamic_offset:new p.cb(g)}),fill:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_ground_shadow_factor:new p.ca(g)}),fillPattern:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_image:new p.cc(g),u_texsize:new p.c9(g),u_pixel_coord_upper:new p.c9(g),u_pixel_coord_lower:new p.c9(g),u_tile_units_to_pixels:new p.cb(g),u_ground_shadow_factor:new p.ca(g),u_pattern_transition:new p.cb(g)}),fillOutline:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_world:new p.c9(g),u_ground_shadow_factor:new p.ca(g)}),fillOutlinePattern:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_world:new p.c9(g),u_image:new p.cc(g),u_texsize:new p.c9(g),u_pixel_coord_upper:new p.c9(g),u_pixel_coord_lower:new p.c9(g),u_tile_units_to_pixels:new p.cb(g),u_ground_shadow_factor:new p.ca(g),u_pattern_transition:new p.cb(g)}),building:g=>({u_matrix:new p.c8(g),u_normal_matrix:new p.c8(g),u_opacity:new p.cb(g)}),buildingDepth:g=>({u_matrix:new p.c8(g)}),elevatedStructuresDepth:g=>({u_matrix:new p.c8(g),u_depth_bias:new p.cb(g)}),elevatedStructures:g=>({u_matrix:new p.c8(g),u_ground_shadow_factor:new p.ca(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new p.c8(g),u_camera_pos:new p.ca(g),u_depth_bias:new p.cb(g),u_height_scale:new p.cb(g),u_reset_depth:new p.cb(g)}),circle:p.dF,collisionBox:g=>({u_matrix:new p.c8(g),u_camera_to_center_distance:new p.cb(g),u_extrude_scale:new p.c9(g)}),collisionCircle:g=>({u_matrix:new p.c8(g),u_inv_matrix:new p.c8(g),u_camera_to_center_distance:new p.cb(g),u_viewport_size:new p.c9(g)}),debug:g=>({u_color:new p.di(g),u_matrix:new p.c8(g),u_overlay:new p.cc(g),u_overlay_scale:new p.cb(g)}),clippingMask:g=>({u_matrix:new p.c8(g)}),heatmap:g=>({u_extrude_scale:new p.cb(g),u_intensity:new p.cb(g),u_matrix:new p.c8(g),u_inv_rot_matrix:new p.c8(g),u_merc_center:new p.c9(g),u_tile_id:new p.ca(g),u_zoom_transition:new p.cb(g),u_up_dir:new p.ca(g)}),heatmapTexture:g=>({u_image:new p.cc(g),u_color_ramp:new p.cc(g),u_opacity:new p.cb(g)}),hillshade:g=>({u_matrix:new p.c8(g),u_image:new p.cc(g),u_latrange:new p.c9(g),u_light:new p.c9(g),u_shadow:new p.di(g),u_highlight:new p.di(g),u_emissive_strength:new p.cb(g),u_accent:new p.di(g)}),hillshadePrepare:g=>({u_matrix:new p.c8(g),u_image:new p.cc(g),u_dimension:new p.c9(g),u_zoom:new p.cb(g)}),line:p.dG,linePattern:p.dH,raster:g=>({u_matrix:new p.c8(g),u_normalize_matrix:new p.c8(g),u_globe_matrix:new p.c8(g),u_merc_matrix:new p.c8(g),u_grid_matrix:new p.dj(g),u_tl_parent:new p.c9(g),u_scale_parent:new p.cb(g),u_fade_t:new p.cb(g),u_opacity:new p.cb(g),u_image0:new p.cc(g),u_image1:new p.cc(g),u_brightness_low:new p.cb(g),u_brightness_high:new p.cb(g),u_saturation_factor:new p.cb(g),u_contrast_factor:new p.cb(g),u_spin_weights:new p.ca(g),u_perspective_transform:new p.c9(g),u_raster_elevation:new p.cb(g),u_zoom_transition:new p.cb(g),u_merc_center:new p.c9(g),u_cutoff_params:new p.cQ(g),u_colorization_mix:new p.cQ(g),u_colorization_offset:new p.cb(g),u_color_ramp:new p.cc(g),u_texture_offset:new p.c9(g),u_texture_res:new p.c9(g),u_emissive_strength:new p.cb(g)}),rasterParticle:g=>({u_matrix:new p.c8(g),u_normalize_matrix:new p.c8(g),u_globe_matrix:new p.c8(g),u_merc_matrix:new p.c8(g),u_grid_matrix:new p.dj(g),u_tl_parent:new p.c9(g),u_scale_parent:new p.cb(g),u_fade_t:new p.cb(g),u_opacity:new p.cb(g),u_image0:new p.cc(g),u_image1:new p.cc(g),u_raster_elevation:new p.cb(g),u_zoom_transition:new p.cb(g),u_merc_center:new p.c9(g),u_cutoff_params:new p.cQ(g)}),rasterParticleTexture:g=>({u_texture:new p.cc(g),u_opacity:new p.cb(g)}),rasterParticleDraw:g=>({u_particle_texture:new p.cc(g),u_particle_texture_side_len:new p.cb(g),u_tile_offset:new p.c9(g),u_velocity:new p.cc(g),u_color_ramp:new p.cc(g),u_velocity_res:new p.c9(g),u_max_speed:new p.cb(g),u_uv_offset:new p.c9(g),u_data_scale:new p.c9(g),u_data_offset:new p.cb(g),u_particle_pos_scale:new p.cb(g),u_particle_pos_offset:new p.c9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new p.cc(g),u_particle_texture_side_len:new p.cb(g),u_velocity:new p.cc(g),u_velocity_res:new p.c9(g),u_max_speed:new p.cb(g),u_speed_factor:new p.cb(g),u_reset_rate:new p.cb(g),u_rand_seed:new p.cb(g),u_uv_offset:new p.c9(g),u_data_scale:new p.c9(g),u_data_offset:new p.cb(g),u_particle_pos_scale:new p.cb(g),u_particle_pos_offset:new p.c9(g)}),symbol:g=>({u_is_size_zoom_constant:new p.cc(g),u_is_size_feature_constant:new p.cc(g),u_size_t:new p.cb(g),u_size:new p.cb(g),u_camera_to_center_distance:new p.cb(g),u_rotate_symbol:new p.cc(g),u_aspect_ratio:new p.cb(g),u_fade_change:new p.cb(g),u_matrix:new p.c8(g),u_label_plane_matrix:new p.c8(g),u_coord_matrix:new p.c8(g),u_is_text:new p.cc(g),u_elevation_from_sea:new p.cc(g),u_pitch_with_map:new p.cc(g),u_texsize:new p.c9(g),u_texsize_icon:new p.c9(g),u_texture:new p.cc(g),u_texture_icon:new p.cc(g),u_gamma_scale:new p.cb(g),u_device_pixel_ratio:new p.cb(g),u_tile_id:new p.ca(g),u_zoom_transition:new p.cb(g),u_inv_rot_matrix:new p.c8(g),u_merc_center:new p.c9(g),u_camera_forward:new p.ca(g),u_tile_matrix:new p.c8(g),u_up_vector:new p.ca(g),u_ecef_origin:new p.ca(g),u_is_halo:new p.cc(g),u_icon_transition:new p.cb(g),u_color_adj_mat:new p.c8(g),u_scale_factor:new p.cb(g),u_ground_shadow_factor:new p.ca(g),u_inv_matrix:new p.c8(g)}),background:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_opacity:new p.cb(g),u_color:new p.di(g)}),backgroundPattern:g=>({u_matrix:new p.c8(g),u_emissive_strength:new p.cb(g),u_opacity:new p.cb(g),u_image:new p.cc(g),u_pattern_tl:new p.c9(g),u_pattern_br:new p.c9(g),u_texsize:new p.c9(g),u_pattern_size:new p.c9(g),u_pixel_coord_upper:new p.c9(g),u_pixel_coord_lower:new p.c9(g),u_pattern_units_to_pixels:new p.c9(g)}),terrainRaster:g=>({u_matrix:new p.c8(g),u_image0:new p.cc(g),u_skirt_height:new p.cb(g),u_ground_shadow_factor:new p.ca(g)}),skybox:g=>({u_matrix:new p.c8(g),u_sun_direction:new p.ca(g),u_cubemap:new p.cc(g),u_opacity:new p.cb(g),u_temporal_offset:new p.cb(g)}),skyboxGradient:g=>({u_matrix:new p.c8(g),u_color_ramp:new p.cc(g),u_center_direction:new p.ca(g),u_radius:new p.cb(g),u_opacity:new p.cb(g),u_temporal_offset:new p.cb(g)}),skyboxCapture:g=>({u_matrix_3f:new p.dj(g),u_sun_direction:new p.ca(g),u_sun_intensity:new p.cb(g),u_color_tint_r:new p.cQ(g),u_color_tint_m:new p.cQ(g),u_luminance:new p.cb(g)}),globeRaster:g=>({u_proj_matrix:new p.c8(g),u_globe_matrix:new p.c8(g),u_normalize_matrix:new p.c8(g),u_merc_matrix:new p.c8(g),u_zoom_transition:new p.cb(g),u_merc_center:new p.c9(g),u_image0:new p.cc(g),u_grid_matrix:new p.dj(g),u_skirt_height:new p.cb(g),u_far_z_cutoff:new p.cb(g),u_frustum_tl:new p.ca(g),u_frustum_tr:new p.ca(g),u_frustum_br:new p.ca(g),u_frustum_bl:new p.ca(g),u_globe_pos:new p.ca(g),u_globe_radius:new p.cb(g),u_viewport:new p.c9(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.ca(g),u_frustum_tr:new p.ca(g),u_frustum_br:new p.ca(g),u_frustum_bl:new p.ca(g),u_horizon:new p.cb(g),u_transition:new p.cb(g),u_fadeout_range:new p.cb(g),u_color:new p.cQ(g),u_high_color:new p.cQ(g),u_space_color:new p.cQ(g),u_temporal_offset:new p.cb(g),u_horizon_angle:new p.cb(g)}),model:g=>({u_matrix:new p.c8(g),u_lighting_matrix:new p.c8(g),u_normal_matrix:new p.c8(g),u_node_matrix:new p.c8(g),u_lightpos:new p.ca(g),u_lightintensity:new p.cb(g),u_lightcolor:new p.ca(g),u_camera_pos:new p.ca(g),u_opacity:new p.cb(g),u_baseColorFactor:new p.cQ(g),u_emissiveFactor:new p.cQ(g),u_metallicFactor:new p.cb(g),u_roughnessFactor:new p.cb(g),u_baseTextureIsAlpha:new p.cc(g),u_alphaMask:new p.cc(g),u_alphaCutoff:new p.cb(g),u_baseColorTexture:new p.cc(g),u_metallicRoughnessTexture:new p.cc(g),u_normalTexture:new p.cc(g),u_occlusionTexture:new p.cc(g),u_emissionTexture:new p.cc(g),u_lutTexture:new p.cc(g),u_color_mix:new p.cQ(g),u_aoIntensity:new p.cb(g),u_emissive_strength:new p.cb(g),u_occlusionTextureTransform:new p.cQ(g)}),modelDepth:g=>({u_matrix:new p.c8(g),u_instance:new p.c8(g),u_node_matrix:new p.c8(g)}),groundShadow:g=>({u_matrix:new p.c8(g),u_ground_shadow_factor:new p.ca(g)}),stars:g=>({u_matrix:new p.c8(g),u_up:new p.ca(g),u_right:new p.ca(g),u_intensity_multiplier:new p.cb(g)}),snowParticle:g=>({u_modelview:new p.c8(g),u_projection:new p.c8(g),u_time:new p.cb(g),u_cam_pos:new p.ca(g),u_velocityConeAperture:new p.cb(g),u_velocity:new p.cb(g),u_horizontalOscillationRadius:new p.cb(g),u_horizontalOscillationRate:new p.cb(g),u_boxSize:new p.cb(g),u_billboardSize:new p.cb(g),u_simpleShapeParameters:new p.c9(g),u_screenSize:new p.c9(g),u_thinningCenterPos:new p.c9(g),u_thinningShape:new p.ca(g),u_thinningAffectedRatio:new p.cb(g),u_thinningParticleOffset:new p.cb(g),u_particleColor:new p.cQ(g),u_direction:new p.ca(g)}),rainParticle:g=>({u_modelview:new p.c8(g),u_projection:new p.c8(g),u_time:new p.cb(g),u_cam_pos:new p.ca(g),u_texScreen:new p.cc(g),u_velocityConeAperture:new p.cb(g),u_velocity:new p.cb(g),u_boxSize:new p.cb(g),u_rainDropletSize:new p.c9(g),u_distortionStrength:new p.cb(g),u_rainDirection:new p.ca(g),u_color:new p.cQ(g),u_screenSize:new p.c9(g),u_thinningCenterPos:new p.c9(g),u_thinningShape:new p.ca(g),u_thinningAffectedRatio:new p.cb(g),u_thinningParticleOffset:new p.cb(g),u_shapeDirectionalPower:new p.cb(g),u_shapeNormalPower:new p.cb(g),u_mode:new p.cb(g)}),vignette:g=>({u_vignetteShape:new p.ca(g),u_vignetteColor:new p.cQ(g)}),occlusion:g=>({u_matrix:new p.c8(g),u_anchorPos:new p.ca(g),u_screenSizePx:new p.c9(g),u_occluderSizePx:new p.c9(g),u_color:new p.cQ(g)})};let Eg=(()=>{class g{constructor(h,_,w,M){this.id=g.uniqueIdxCounter,g.uniqueIdxCounter++,this.context=h;const S=h.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||M||_.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){this.id=g.uniqueIdxCounter,g.uniqueIdxCounter++;const _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return g.uniqueIdxCounter=0,g})();const Dg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ku{constructor(a,h,_,w,M,S){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.instanceCount=S,this.context=a;const P=a.gl;this.buffer=P.createBuffer(),a.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||M||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&a.enableVertexAttribArray(w)}}setVertexAttribPointers(a,h,_){for(let w=0;w<this.attributes.length;w++){const M=this.attributes[w],S=h.attributes[M.name];void 0!==S&&a.vertexAttribPointer(S,M.components,a[Dg[M.type]],!1,this.itemSize,M.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(a,h,_){for(let w=0;w<this.attributes.length;w++){const M=h.attributes[this.attributes[w].name];void 0!==M&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(M,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lh{constructor(a,h,_,w,M){this.context=a,this.width=h,this.height=_;const S=this.framebuffer=a.gl.createFramebuffer();w&&(this.colorAttachment=new Yu(a,S)),M&&(this.depthAttachmentType=M,this.depthAttachment="renderbuffer"===M?new tc(a,S):new uu(a,S))}destroy(){const a=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&a.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const h=this.depthAttachment.get();h&&a.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&a.deleteTexture(h)}a.deleteFramebuffer(this.framebuffer)}}class Qu{constructor(a,h){this.gl=a,this.clearColor=new Zu(this),this.clearDepth=new sh(this),this.clearStencil=new Ip(this),this.colorMask=new Op(this),this.depthMask=new ts(this),this.stencilMask=new Tn(this),this.stencilFunc=new Zi(this),this.stencilOp=new x(this),this.stencilTest=new T(this),this.depthRange=new H(this),this.depthTest=new ee(this),this.depthFunc=new pe(this),this.blend=new Ee(this),this.blendFunc=new nt(this),this.blendColor=new St(this),this.blendEquation=new yt(this),this.cullFace=new on(this),this.cullFaceSide=new Y(this),this.frontFace=new J(this),this.program=new fe(this),this.activeTexture=new Ue(this),this.viewport=new At(this),this.bindFramebuffer=new xn(this),this.bindRenderbuffer=new Mi(this),this.bindTexture=new yr(this),this.bindVertexBuffer=new io(this),this.bindElementBuffer=new Ua(this),this.bindVertexArrayOES=new fd(this),this.pixelStoreUnpack=new Wc(this),this.pixelStoreUnpackPremultiplyAlpha=new Ar(this),this.pixelStoreUnpackFlipY=new s0(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h,_){return new Eg(this,a,h,_)}createVertexBuffer(a,h,_,w,M){return new Ku(this,a,h,_,w,M)}createRenderbuffer(a,h,_){const w=this.gl,M=w.createRenderbuffer();return this.bindRenderbuffer.set(M),w.renderbufferStorage(w.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),M}createFramebuffer(a,h,_,w){return new Lh(this,a,h,_,w)}clear({color:a,depth:h,stencil:_,colorMask:w}){const M=this.gl;let S=0;a&&(S|=M.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(w||[!0,!0,!0,!0])),void 0!==h&&(S|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(S|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),M.clear(S)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){p.bv(a.blendFunction,Yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vp;function Zf(g,a,h,_,w,M,S){const P=g.context,O=P.gl,V=g.transform,U=g.getOrCreateProgram("collisionBox"),X=[];let G=0,Q=0;for(let De=0;De<_.length;De++){const Le=_[De],Ie=a.getTile(Le),Oe=Ie.getBucket(h);if(!Oe)continue;const Te=Fd(Le,Oe,V);let Be=Te;0===w[0]&&0===w[1]||(Be=g.translatePosMatrix(Te,Ie,w,M));const Ve=S?Oe.textCollisionBox:Oe.iconCollisionBox,ct=Oe.collisionCircleArray;if(ct.length>0){const Ye=p.bz(),kt=Be;p.cB(Ye,Oe.placementInvProjMatrix,V.glCoordMatrix),p.cB(Ye,Ye,Oe.placementViewportMatrix),X.push({circleArray:ct,circleOffset:Q,transform:kt,invTransform:Ye,projection:Oe.getProjection()}),G+=ct.length/4,Q=G}Ve&&(g.terrain&&g.terrain.setupElevationDraw(Ie,U),U.draw(g,O.LINES,rn.disabled,kn.disabled,g.colorModeForRenderPass(),Ln.disabled,wb(Be,V,Ie,Oe.getProjection()),h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,V.zoom,null,[Ve.collisionVertexBuffer,Ve.collisionVertexBufferExt]))}if(!S||!X.length)return;const se=g.getOrCreateProgram("collisionCircle"),oe=new p.dI;oe.resize(4*G),oe._trim();let de=0;for(const De of X)for(let Le=0;Le<De.circleArray.length/4;Le++){const Ie=4*Le,Oe=De.circleArray[Ie+0],Te=De.circleArray[Ie+1],Be=De.circleArray[Ie+2],Ve=De.circleArray[Ie+3];oe.emplace(de++,Oe,Te,Be,Ve,0),oe.emplace(de++,Oe,Te,Be,Ve,1),oe.emplace(de++,Oe,Te,Be,Ve,2),oe.emplace(de++,Oe,Te,Be,Ve,3)}(!Vp||Vp.length<2*G)&&(Vp=function(De){const Le=2*De,Ie=new p.a_;Ie.resize(Le),Ie._trim();for(let Oe=0;Oe<Le;Oe++){const Te=6*Oe;Ie.uint16[Te+0]=4*Oe+0,Ie.uint16[Te+1]=4*Oe+1,Ie.uint16[Te+2]=4*Oe+2,Ie.uint16[Te+3]=4*Oe+2,Ie.uint16[Te+4]=4*Oe+3,Ie.uint16[Te+5]=4*Oe+0}return Ie}(G));const le=P.createIndexBuffer(Vp,!0),be=P.createVertexBuffer(oe,p.dJ.members,!0);for(const De of X){const Le={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Me=V).getCameraToCenterDistance(De.projection),u_viewport_size:[Me.width,Me.height]};se.draw(g,O.TRIANGLES,rn.disabled,kn.disabled,g.colorModeForRenderPass(),Ln.disabled,Le,h.id,be,le,p.bd.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,V.zoom)}var Me;be.destroy(),le.destroy()}const Tg=p.bz();function Yf(g){const a=g._camera.getWorldToCamera(g.worldSize,1),h=p.az([],a,g.globeMatrix);p.bi(h,h);const _=[0,0,0],w=[0,1,0,0];return p.aA(w,w,h),_[0]=w[0],_[1]=w[1],_[2]=w[2],p.au(_,_),_}function Ag({width:g,height:a,anchor:h,textOffset:_,textScale:w},M){const{horizontalAlign:S,verticalAlign:P}=p.bV(h),O=-(S-.5)*g,V=-(P-.5)*a,U=p.bU(h,_);return new p.P((O/w+U[0])*M,(V/w+U[1])*M)}function Ty(g,a,h,_,w,M,S,P,O,V){const U=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,G=g.icon.dynamicLayoutVertexArray,Q={},se=g.getProjection(),oe=Ea(S,se,w),de=w.elevation,le=se.upVectorScale(S.canonical,w.center.lat,w.worldSize).metersToTile;X.clear();for(let be=0;be<U.length;be++){const Me=U.get(be),{tileAnchorX:De,tileAnchorY:Le,numGlyphs:Ie}=Me,Oe=Me.hidden||!Me.crossTileID||g.allowVerticalPlacement&&!Me.placedOrientation?null:_[Me.crossTileID];if(Oe){let Te=0,Be=0,Ve=0;if(de){const xt=de?de.getAtTileOffset(S,De,Le):0,[dt,Ot,wt]=se.upVector(S.canonical,De,Le);Te=xt*dt*le,Be=xt*Ot*le,Ve=xt*wt*le}let[ct,Ye,kt,vt]=Ca(Me.projectedAnchorX+Te,Me.projectedAnchorY+Be,Me.projectedAnchorZ+Ve,h?oe:M);const Pt=Fl(w.getCameraToCenterDistance(se),vt);let Je=p.bJ(g.textSizeData,O,Me)*Pt/p.bO;h&&(Je*=g.tilePixelRatio/P);const ot=Ag(Oe,Je);h?(({x:ct,y:Ye,z:kt}=se.projectTilePoint(De+ot.x,Le+ot.y,S.canonical)),[ct,Ye,kt]=Ca(ct+Te,Ye+Be,kt+Ve,M)):(a&&ot._rotate(-w.angle),ct+=ot.x,Ye+=ot.y,kt=0);const Ke=g.allowVerticalPlacement&&Me.placedOrientation===p.bI.vertical?Math.PI/2:0;for(let xt=0;xt<Ie;xt++)p.bL(X,ct,Ye,kt,Ke);V&&Me.associatedIconIndex>=0&&(Q[Me.associatedIconIndex]={x:ct,y:Ye,z:kt,angle:Ke})}else Ni(Ie,X)}if(V){G.clear();const be=g.icon.placedSymbolArray;for(let Me=0;Me<be.length;Me++){const De=be.get(Me),{numGlyphs:Le}=De,Ie=Q[Me];if(De.hidden||!Ie)Ni(Le,G);else{const{x:Oe,y:Te,z:Be,angle:Ve}=Ie;for(let ct=0;ct<Le;ct++)p.bL(G,Oe,Te,Be,Ve)}}g.icon.dynamicLayoutVertexBuffer.updateData(G)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function Xf(g,a,h,_,w,M,S={}){const P=h.paint.get("icon-translate"),O=h.paint.get("text-translate"),V=h.paint.get("icon-translate-anchor"),U=h.paint.get("text-translate-anchor"),X=h.layout.get("icon-rotation-alignment"),G=h.layout.get("text-rotation-alignment"),Q=h.layout.get("icon-pitch-alignment"),se=h.layout.get("text-pitch-alignment"),oe=h.layout.get("icon-keep-upright"),de=h.layout.get("text-keep-upright"),le=h.paint.get("icon-color-saturation"),be=h.paint.get("icon-color-contrast"),Me=h.paint.get("icon-color-brightness-min"),De=h.paint.get("icon-color-brightness-max"),Le="sea"===h.layout.get("symbol-elevation-reference"),Ie=g.context,Oe=Ie.gl,Te=g.transform,Be="map"===X,Ve="map"===G,ct="map"===Q,Ye="map"===se,kt=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let vt=!1;const Pt=g.depthModeForSublayer(0,rn.ReadOnly),Je=new rn(g.context.gl.LEQUAL,rn.ReadOnly,g.depthRangeFor3D),ot=[p.ay(Te.center.lng),p.aH(Te.center.lat)],Ke=h.layout.get("text-variable-anchor"),xt="globe"===Te.projection.name,dt=[],Ot=[0,-1,0];for(const wt of _){const It=a.getTile(wt),Lt=It.getBucket(h);if(!Lt||"mercator"===Lt.projection.name&&xt||Lt.fullyClipped)continue;const fn="globe"===Lt.projection.name,bn=fn?p.ah(Te.zoom):0,dn=Ea(wt,Lt.getProjection(),Te),an=Te.calculatePixelsToTileUnitsMatrix(It),mn=Ke&&Lt.hasTextData(),Dn=Lt.hasIconTextFit()&&mn&&Lt.hasIconData(),qn="road"===Lt.elevationType?Je:Pt,xi=Lt.getProjection().createInversionMatrix(Te,wt.canonical),xr=g.shadowRenderer,hr="road"===Lt.elevationType&&!!xr&&xr.enabled;let Ci=[0,0,0];if(hr){const so=g.style.directionalLight,ai=g.style.ambientLight;so&&ai&&(Ci=Ha(g.style,so,ai))}const Lo=so=>{Te.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||g.terrain)&&(so.push("DEPTH_D24"),so.push("DEPTH_OCCLUSION"))},fo=()=>{const so=Be&&"point"!==h.layout.get("symbol-placement"),ai=[];Lo(ai);const Hr=so||Dn,Vi=h.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&ct&&ai.push("PITCH_WITH_MAP_TERRAIN"),fn&&(ai.push("PROJECTION_GLOBE_VIEW"),Hr&&ai.push("PROJECTED_POS_ON_VIEWPORT")),Vi>0&&ai.push("ICON_TRANSITION"),Lt.icon.zOffsetVertexBuffer&&ai.push("Z_OFFSET"),0===le&&0===be&&0===Me&&1===De||ai.push("COLOR_ADJUSTMENT"),Lt.sdfIcons&&ai.push("RENDER_SDF"),hr&&ai.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Xr=Lt.icon.programConfigurations.get(h.id),ir=g.getOrCreateProgram("symbol",{config:Xr,defines:ai}),ao=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],us=Lt.iconSizeData,kr=p.bH(us,Te.zoom),Oa=ct||0!==Te.pitch,ps=ih(dn,It.tileID.canonical,ct,Be,Te,Lt.getProjection(),an),Ra=Hu(dn,It.tileID.canonical,ct,Be,Te,Lt.getProjection(),an),Wd=g.translatePosMatrix(Ra,It,P,V,!0),wu=g.translatePosMatrix(dn,It,P,V),Ec=Hr?Tg:ps,vd=Be&&!ct&&!so;let fh=Ot;!xt&&!Te.mercatorFromTransition||Be||(fh=Yf(Te));const Qc=fn?fh:Ot,bd=h.getColorAdjustmentMatrix(le,be,Me,De),ef=Wf(us.kind,kr,vd,ct,g,wu,Ec,Wd,Le,!1,ao,[0,0],!0,wt,bn,ot,xi,Qc,Lt.getProjection(),Ci,bd,Vi),ku=It.imageAtlasTexture?It.imageAtlasTexture:null,P0=1!==h.layout.get("icon-size").constantOr(0)||Lt.iconsNeedLinear,fm=Lt.sdfIcons||g.options.rotating||g.options.zooming||P0||Oa?Oe.LINEAR:Oe.NEAREST,I0=Lt.sdfIcons&&0!==h.paint.get("icon-halo-width").constantOr(1),mm=g.terrain&&ct&&so?p.bi(p.bz(),ps):Tg;if(so&&Lt.icon){const eo=Te.elevation,Mu=eo?eo.getAtTileOffsetFunc(wt,Te.center.lat,Te.worldSize,Lt.getProjection()):null,Ly=ru(dn,It.tileID.canonical,ct,Be,Te,Lt.getProjection(),an);On(Lt,dn,g,!1,Ly,Ra,ct,oe,Mu,wt)}return{program:ir,buffers:Lt.icon,uniformValues:ef,atlasTexture:ku,atlasTextureIcon:null,atlasInterpolation:fm,atlasInterpolationIcon:null,isSDF:Lt.sdfIcons,hasHalo:I0,depthMode:qn,tile:It,renderWithShadows:hr,labelPlaneMatrixInv:mm}},ni=()=>{const so=Ve&&"point"!==h.layout.get("symbol-placement"),ai=[],Hr=so||Ke||Dn;g.terrainRenderModeElevated()&&Ye&&ai.push("PITCH_WITH_MAP_TERRAIN"),fn&&(ai.push("PROJECTION_GLOBE_VIEW"),Hr&&ai.push("PROJECTED_POS_ON_VIEWPORT")),Lt.text.zOffsetVertexBuffer&&ai.push("Z_OFFSET"),Lt.iconsInText&&ai.push("RENDER_TEXT_AND_SYMBOL"),ai.push("RENDER_SDF"),hr&&ai.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Lo(ai);const Vi=Lt.text.programConfigurations.get(h.id),Xr=g.getOrCreateProgram("symbol",{config:Vi,defines:ai});let ir,ao=[0,0],us=null;const kr=Lt.textSizeData;Lt.iconsInText&&(ao=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],us=It.imageAtlasTexture?It.imageAtlasTexture:null,ir=Ye||0!==Te.pitch||g.options.rotating||g.options.zooming||"composite"===kr.kind||"camera"===kr.kind?Oe.LINEAR:Oe.NEAREST);const Oa=It.glyphAtlasTexture?It.glyphAtlasTexture.size:[0,0],ps=h.layout.get("text-size-scale-range"),Ra=p.aD(g.scaleFactor,ps[0],ps[1]),Wd=p.bH(kr,Te.zoom,Ra),wu=ih(dn,It.tileID.canonical,Ye,Ve,Te,Lt.getProjection(),an),Ec=Hu(dn,It.tileID.canonical,Ye,Ve,Te,Lt.getProjection(),an),vd=g.translatePosMatrix(Ec,It,O,U,!0),fh=g.translatePosMatrix(dn,It,O,U),Qc=Hr?Tg:wu,bd=Ve&&!Ye&&!so;let ef=Ot;!xt&&!Te.mercatorFromTransition||Ve||(ef=Yf(Te));const ku=Wf(kr.kind,Wd,bd,Ye,g,fh,Qc,vd,Le,!0,Oa,ao,!0,wt,bn,ot,xi,fn?ef:Ot,Lt.getProjection(),Ci,null,null,Ra),P0=It.glyphAtlasTexture?It.glyphAtlasTexture:null,fm=Oe.LINEAR,I0=0!==h.paint.get("text-halo-width").constantOr(1),mm=g.terrain&&Ye&&so?p.bi(p.bz(),wu):Tg;if(so&&Lt.text){const eo=Te.elevation,Mu=eo?eo.getAtTileOffsetFunc(wt,Te.center.lat,Te.worldSize,Lt.getProjection()):null,Ly=ru(dn,It.tileID.canonical,Ye,Ve,Te,Lt.getProjection(),an);On(Lt,dn,g,!0,Ly,Ec,Ye,de,Mu,wt)}return{program:Xr,buffers:Lt.text,uniformValues:ku,atlasTexture:P0,atlasTextureIcon:us,atlasInterpolation:fm,atlasInterpolationIcon:ir,isSDF:!0,hasHalo:I0,depthMode:qn,tile:It,renderWithShadows:hr,labelPlaneMatrixInv:mm}},Li=Lt.icon.segments.get().length,qi=Lt.text.segments.get().length,wr=Li&&!S.onlyText?fo():null,oo=qi&&!S.onlyIcons?ni():null,Ho=h.paint.get("icon-opacity").constantOr(1),vo=h.paint.get("text-opacity").constantOr(1);if(kt&&Lt.canOverlap){vt=!0;const so=Ho&&!S.onlyText?Lt.icon.segments.get():[],ai=vo&&!S.onlyIcons?Lt.text.segments.get():[];for(const Hr of so)dt.push({segments:new p.bd([Hr]),sortKey:Hr.sortKey,state:wr});for(const Hr of ai)dt.push({segments:new p.bd([Hr]),sortKey:Hr.sortKey,state:oo})}else S.onlyText||dt.push({segments:Ho?Lt.icon.segments:new p.bd([]),sortKey:0,state:wr}),S.onlyIcons||dt.push({segments:vo?Lt.text.segments:new p.bd([]),sortKey:0,state:oo})}vt&&dt.sort((wt,It)=>wt.sortKey-It.sortKey);for(const wt of dt){const It=wt.state;if(It)if(g.terrain?g.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:It.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,It.program),Ie.activeTexture.set(Oe.TEXTURE0),It.atlasTexture&&It.atlasTexture.bind(It.atlasInterpolation,Oe.CLAMP_TO_EDGE,!0),It.atlasTextureIcon&&(Ie.activeTexture.set(Oe.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE,!0)),It.renderWithShadows&&g.shadowRenderer.setupShadows(It.tile.tileID.toUnwrapped(),It.program,"vector-tile",It.tile.tileID.overscaledZ),g.uploadCommonLightUniforms(g.context,It.program),It.hasHalo){const Lt=It.uniformValues;Lt.u_is_halo=1,Kf(It.buffers,wt.segments,h,g,It.program,It.depthMode,w,M,Lt,2),Lt.u_is_halo=0}else{if(It.isSDF){const Lt=It.uniformValues;It.hasHalo&&(Lt.u_is_halo=1,Kf(It.buffers,wt.segments,h,g,It.program,It.depthMode,w,M,Lt,1)),Lt.u_is_halo=0}Kf(It.buffers,wt.segments,h,g,It.program,It.depthMode,w,M,It.uniformValues,1)}}}function Kf(g,a,h,_,w,M,S,P,O,V){const U=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];w.draw(_,_.context.gl.TRIANGLES,M,S,P,Ln.disabled,O,h.id,g.layoutVertexBuffer,g.indexBuffer,a,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),U,V)}function jp(g,a){const h=1<<g.canonical.z,_=(a.x*h-g.canonical.x-g.wrap*h)*p.aj,w=(a.y*h-g.canonical.y)*p.aj,M=p.dS(a.z,a.y);return p.cS(_,w,M)}function Ju(g,a,h,_,w){if(!h.layout||"none"===h.layout.get("fill-elevation-reference"))return;const M=g.context.gl,S=new rn(g.context.gl.LEQUAL,rn.ReadWrite,g.depthRangeFor3D),P=new rn(g.context.gl.GREATER,rn.ReadWrite,g.depthRangeFor3D),O=function(Q){const se=p.cJ(Q.pitch);let oe=.01;return Q.isOrthographic&&(oe=p.ai(1e-4,oe,p.cO(se>=15?1:se/15))),2*oe}(g.transform),V=g.transform.getFreeCameraOptions().position,U="elevatedStructuresDepthReconstruct",X=g.getOrCreateProgram(U,{defines:["DEPTH_RECONSTRUCTION"]}),G=g.getOrCreateProgram(U);for(const Q of _){const se=a.getTile(Q),oe=se.getBucket(h);if(!oe)continue;const de=oe.elevatedStructures;if(!de)continue;const le=oe.elevationBufferData.heightRange,be=jp(Q.toUnwrapped(),V),Me=g.translatePosMatrix(Q.projMatrix,se,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let De,Le,Ie,Oe;if("initialize"===w){if(!le||le.min>=1||0===de.depthSegments.segments[0].primitiveLength)continue;De=Fp(Me,be,O,1,0),Le=S,Ie=de.depthSegments,Oe=X}else if("reset"===w){if(!le||le.min>=0||0===de.maskSegments.segments[0].primitiveLength)continue;De=Fp(Me,be,0,0,1),Le=P,Ie=de.maskSegments,Oe=X}else if("geometry"===w){if(0===de.depthSegments.segments[0].primitiveLength)continue;De=Fp(Me,be,O,1,0),Le=S,Ie=de.depthSegments,Oe=G}Oe.draw(g,M.TRIANGLES,Le,kn.disabled,Yn.disabled,Ln.disabled,De,h.id,de.vertexBuffer,de.indexBuffer,Ie,h.paint,g.transform.zoom)}}function ln(g,a,h){const{painter:_,sourceCache:w,layer:M,coords:S,colorMode:P,elevationType:O,terrainEnabled:V,pass:U}=g,X=_.context.gl,G=M.paint.get("fill-pattern"),Q=M.paint.get("fill-pattern-cross-fade"),se=G.constantOr(null);let oe=O;"road"!==O||a&&!V||(oe="none");const de="road"===oe,le=g.painter.shadowRenderer,be=de&&!!le&&le.enabled,Me=new rn(_.context.gl.LEQUAL,rn.ReadOnly,_.depthRangeFor3D);let De=[0,0,0];if(be){const Oe=_.style.directionalLight,Te=_.style.ambientLight;Oe&&Te&&(De=Ha(_.style,Oe,Te))}const Le=G&&G.constantOr(1),Ie=(Oe,Te)=>{let Be,Ve,ct,Ye,kt;Te?(Be=Le&&!M.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ct=X.LINES):(Be=Le?"fillPattern":"fill",ct=X.TRIANGLES);for(const vt of S){const Pt=w.getTile(vt);if(Le&&!Pt.patternsLoaded())continue;const Je=Pt.getBucket(M);if(!Je)continue;const ot=a?Je.elevationBufferData:Je.bufferData;if(ot.isEmpty())continue;_.prepareDrawTile();const Ke=ot.programConfigurations.get(M.id),xt=_.isTileAffectedByFog(vt),dt=[],Ot=[];de&&(dt.push("ELEVATED_ROADS"),Ot.push(ot.elevatedLayoutVertexBuffer)),be&&dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Le&&(_.context.activeTexture.set(X.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Ke.updatePaintBuffers());let wt=!1;if(se&&Pt.imageAtlas){const dn=Pt.imageAtlas,an=p.dN.from(se),mn=an.getPrimary().scaleSelf(p.q.devicePixelRatio).toString(),Dn=an.getSecondary(),qn=dn.patternPositions.get(mn),xi=Dn?dn.patternPositions.get(Dn.scaleSelf(p.q.devicePixelRatio).toString()):null;wt=!!qn&&!!xi,qn&&Ke.setConstantPatternPositions(qn,xi)}Q>0&&(wt||Ke.getPatternTransitionVertexBuffer("fill-pattern"))&&dt.push("FILL_PATTERN_TRANSITION");const It=_.getOrCreateProgram(Be,{config:Ke,overrideFog:xt,defines:dt}),Lt=_.translatePosMatrix(vt.projMatrix,Pt,M.paint.get("fill-translate"),M.paint.get("fill-translate-anchor"));be&&le.setupShadows(Pt.tileID.toUnwrapped(),It,"vector-tile",Pt.tileID.overscaledZ);const fn=M.paint.get("fill-emissive-strength");if(Te){Ye=ot.lineIndexBuffer,kt=ot.lineSegments;const dn=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];Ve="fillOutlinePattern"===Be&&Le?wM(Lt,fn,_,Pt,dn,De,Q):xM(Lt,fn,dn,De)}else Ye=ot.indexBuffer,kt=ot.triangleSegments,Ve=Le?xb(Lt,fn,_,Pt,De,Q):bb(Lt,fn,De);_.uploadCommonUniforms(_.context,It,vt.toUnwrapped());let bn=Oe;("road"===O&&!V||"offset"===O)&&(bn=Me),It.draw(_,ct,bn,h||_.stencilModeForClipping(vt),P,Ln.disabled,Ve,M.id,ot.layoutVertexBuffer,Ye,kt,M.paint,_.transform.zoom,Ke,Ot)}};_.renderPass===U&&Ie(_.depthModeForSublayer(1,"opaque"===_.renderPass?rn.ReadWrite:rn.ReadOnly),!1),"none"===oe&&"translucent"===_.renderPass&&M.paint.get("fill-antialias")&&Ie(_.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,rn.ReadOnly),!0)}function Pg(g,a,h,_,w,M,S,P){h.resetLayerRenderingStats(g);const O=g.context,V=O.gl,U=g.transform,X=h.paint.get("fill-extrusion-pattern"),G=h.paint.get("fill-extrusion-pattern-cross-fade"),Q=X.constantOr(null),se=X.constantOr(1),oe=h.paint.get("fill-extrusion-opacity"),de=g.style.enable3dLights(),le=h.paint.get(de&&!se?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),be=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),le],Me=h.layout.get("fill-extrusion-edge-radius"),De=Me>0&&!h.paint.get("fill-extrusion-rounded-roof"),Le=De?0:Me,Ie="globe"===U.projection.name?p.dT():0,Oe="globe"===U.projection.name,Te=Oe?p.ah(U.zoom):0,Be=[p.ay(U.center.lng),p.aH(U.center.lat)],Ve="none"===h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),ct=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ve?null:h.lut).toArray01().slice(0,3),Ye=h.paint.get("fill-extrusion-flood-light-intensity"),kt=h.paint.get("fill-extrusion-vertical-scale"),vt=0!==h.paint.get("fill-extrusion-line-width").constantOr(1),Pt=h.paint.get("fill-extrusion-height-alignment"),Je=h.paint.get("fill-extrusion-base-alignment"),ot=Ys(g,h.paint.get("fill-extrusion-cutoff-fade-range")),Ke=[];let xt;Oe&&Ke.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&Ke.push("FAUX_AO"),De&&Ke.push("ZERO_ROOF_RADIUS"),P&&Ke.push("HAS_CENTROID"),Ye>0&&Ke.push("FLOOD_LIGHT"),ot.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),vt&&Ke.push("RENDER_WALL_MODE");const dt="shadow"===g.renderPass,Ot=g.shadowRenderer,wt=dt&&!!Ot,It=dt?Ln.disabled:Ln.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Lt=[0,0,0];if(Ot){const dn=g.style.directionalLight,an=g.style.ambientLight;dn&&an&&(Lt=Ha(g.style,dn,an)),dt||(Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ot.useNormalOffset&&Ke.push("NORMAL_OFFSET")),xt=Ke.concat(["SHADOWS_SINGLE_CASCADE"])}const fn=wt?"fillExtrusionDepth":se?"fillExtrusionPattern":"fillExtrusion",bn=h.getLayerRenderingStats();for(const dn of _){const an=a.getTile(dn),mn=an.getBucket(h);if(!mn||mn.projection.name!==U.projection.name)continue;let Dn=!1;Ot&&(Dn=0===Ot.getMaxCascadeForTile(dn.toUnwrapped()));const qn=g.isTileAffectedByFog(dn),xi=mn.programConfigurations.get(h.id);let xr=!1;if(Q&&an.imageAtlas){const qi=an.imageAtlas,wr=p.dN.from(Q),oo=wr.getPrimary().scaleSelf(p.q.devicePixelRatio).toString(),Ho=wr.getSecondary(),vo=qi.patternPositions.get(oo),so=Ho?qi.patternPositions.get(Ho.scaleSelf(p.q.devicePixelRatio).toString()):null;xr=!!vo&&!!so,vo&&xi.setConstantPatternPositions(vo,so)}G>0&&(xr||xi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ke.push("FILL_EXTRUSION_PATTERN_TRANSITION");const hr=g.getOrCreateProgram(fn,{config:xi,defines:Dn?xt:Ke,overrideFog:qn});if(g.terrain&&g.terrain.setupElevationDraw(an,hr,{useMeterToDem:!0}),!mn.centroidVertexBuffer){const qi=hr.attributes.a_centroid_pos;void 0!==qi&&V.vertexAttrib2f(qi,0,0)}!dt&&Ot&&Ot.setupShadows(an.tileID.toUnwrapped(),hr,"vector-tile",an.tileID.overscaledZ),se&&(g.context.activeTexture.set(V.TEXTURE0),an.imageAtlasTexture&&an.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),xi.updatePaintBuffers());const Ci=h.paint.get("fill-extrusion-vertical-gradient"),Lo=1/mn.tileToMeter;let fo;if(dt&&Ot){if(Mb(an.tileID,mn,g))continue;const qi=Ot.calculateShadowPassMatrixFromTile(an.tileID.toUnwrapped());fo=vM(qi,Le,Lo,kt,Pt,Je)}else{const qi=g.translatePosMatrix(dn.expandedProjMatrix,an,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),wr=U.projection.createInversionMatrix(U,dn.canonical);fo=se?bM(qi,g,Ci,oe,be,Le,Lo,dn,an,Ie,Pt,Je,Te,Be,wr,ct,kt,G):Lp(qi,g,Ci,oe,be,Le,Lo,dn,Ie,Pt,Je,Te,Be,wr,ct,kt,Ye,Lt)}g.uploadCommonUniforms(O,hr,dn.toUnwrapped(),null,ot);let ni=mn.segments;if("mercator"===U.projection.name&&!dt&&(ni=mn.getVisibleSegments(an.tileID,g.terrain,g.transform.getFrustum(0)),!ni.get().length))continue;if(bn)if(dt)for(const qi of ni.get())bn.numRenderedVerticesInShadowPass+=qi.primitiveLength;else for(const qi of ni.get())bn.numRenderedVerticesInTransparentPass+=qi.primitiveLength;const Li=[];(g.terrain||P)&&Li.push(mn.centroidVertexBuffer),Oe&&Li.push(mn.layoutVertexExtBuffer),vt&&Li.push(mn.wallVertexBuffer),hr.draw(g,O.gl.TRIANGLES,w,M,S,It,fo,h.id,mn.layoutVertexBuffer,mn.indexBuffer,ni,h.paint,g.transform.zoom,xi,Li)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function ep(g,a,h,_,w,M,S,P,O,V,U,X,G,Q,se,oe,de,le,be){const Me=g.context,De=Me.gl,Le=g.transform,Ie=g.transform.zoom,Oe=[],Te=Ys(g,h.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===V?(Oe.push("CLEAR_SUBPASS"),be&&(Oe.push("CLEAR_FROM_TEXTURE"),Me.activeTexture.set(De.TEXTURE0),be.bind(De.LINEAR,De.CLAMP_TO_EDGE))):"sdf"===V&&Oe.push("SDF_SUBPASS"),de&&Oe.push("HAS_CENTROID"),Te.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF");const Be=h.layout.get("fill-extrusion-edge-radius"),Ve=(ct,Ye,kt,vt,Pt)=>{const Je=Ye.programConfigurations.get(h.id),ot=g.isTileAffectedByFog(ct),Ke=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:Oe,overrideFog:ot}),xt={u_matrix:vt,u_opacity:U,u_ao_pass:O?1:0,u_meter_to_tile:Pt,u_ao:[X,G*Pt],u_flood_light_intensity:Q,u_flood_light_color:se,u_attenuation:oe,u_edge_radius:Ie>=17?0:Be*Pt,u_fb:0,u_fb_size:be?be.size[0]:0,u_dynamic_offset:1},dt=[];de&&dt.push(Ye.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(Me,Ke,ct.toUnwrapped(),null,Te),Ke.draw(g,Me.gl.TRIANGLES,w,M,S,P,xt,h.id,Ye.vertexBuffer,Ye.indexBuffer,kt,h.paint,Ie,Je,dt)};for(const ct of _){const Ye=a.getTile(ct),kt=Ye.getBucket(h);if(!kt||kt.projection.name!==Le.projection.name||!kt.groundEffect||kt.groundEffect&&!kt.groundEffect.hasData())continue;const vt=kt.groundEffect,Pt=1/kt.tileToMeter;{const Je=g.translatePosMatrix(ct.projMatrix,Ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ot=vt.getDefaultSegment();Ve(ct,vt,ot,Je,Pt)}if(le)for(let Je=0;Je<4;Je++){const ot=p.dU[Je](ct),Ke=a.getTile(ot);if(!Ke)continue;const xt=Ke.getBucket(h);if(!xt||xt.projection.name!==Le.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const dt=xt.groundEffect;let Ot,wt;0===Je?(Ot=[-p.aj,0,0],wt=1):1===Je?(Ot=[p.aj,0,0],wt=0):2===Je?(Ot=[0,-p.aj,0],wt=3):(Ot=[0,p.aj,0],wt=2);const It=dt.regionSegments[wt];if(!It)continue;const Lt=new Float32Array(16);p.bo(Lt,ct.projMatrix,Ot),Ve(ct,dt,It,g.translatePosMatrix(Lt,Ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Pt)}}}function Fh(g,a,h,_,w,M,S){0===_.centroidVertexArray.length&&_.createCentroidsBuffer();const P=M?M.findDEMTileFor(h):null;if(!(P&&P.dem||S))return;M&&P&&P.dem&&_.selfDEMTileTimestamp!==P.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=P.dem._timestamp);const O=le=>new p.P(Math.ceil((le+p.dX)*p.dY),0),V=le=>{const be=a.getSource().minzoom,Me=Le=>{const Ie=a.getTileByID(Le);if(Ie&&Ie.hasData())return Ie.getBucket(w)},De=[0,-1,1];for(const Le of De){if(le.overscaledZ+Le<be)continue;const Ie=Me(le.calculateScaledKey(le.overscaledZ+Le));if(Ie)return Ie}},U=[0,0,0],X=(le,be)=>(U[0]=Math.min(le.min.y,be.min.y),U[1]=Math.max(le.max.y,be.max.y),U[2]=p.aj-be.min.x>le.max.x?be.min.x-p.aj:le.max.x,U),G=(le,be)=>(U[0]=Math.min(le.min.x,be.min.x),U[1]=Math.max(le.max.x,be.max.x),U[2]=p.aj-be.min.y>le.max.y?be.min.y-p.aj:le.max.y,U),Q=[(le,be)=>X(le,be),(le,be)=>X(be,le),(le,be)=>G(le,be),(le,be)=>G(be,le)],se=(le,be,Me,De,Le,Ie,Oe)=>{if(!M)return 0;const Te=[[Ie?Me:le,Ie?le:Me,0],[Ie?Me:be,Ie?be:Me,0]],Be=Oe<0?p.aj+Oe:Oe,Ve=[Ie?Be:(le+be)/2,Ie?(le+be)/2:Be,0];return 0===Me&&Oe<0||0!==Me&&Oe>0?M.getForTilePoints(Le,[Ve],!0,De):Te.push(Ve),M.getForTilePoints(h,Te,!0,P),Math.max(Te[0][2],Te[1][2],Ve[2])/M.exaggeration()};for(let le=0;le<4;le++){const be=_.borderFeatureIndices[le];if(0===be.length)continue;const Me=p.dU[le](h),De=V(Me);if(!(De&&De instanceof p.dV))continue;const Le=M?M.findDEMTileFor(Me):null;if(!(Le&&Le.dem||S)||(M&&Le&&Le.dem&&_.borderDEMTileTimestamp[le]!==Le.dem._timestamp&&(_.borderDoneWithNeighborZ[le]=-1,_.borderDEMTileTimestamp[le]=Le.dem._timestamp),_.borderDoneWithNeighborZ[le]===De.canonical.z))continue;0===De.centroidVertexArray.length&&De.createCentroidsBuffer();const Ie=(le<2?1:5)-le,Oe=De.borderDoneWithNeighborZ[Ie]!==_.canonical.z,Te=De.borderFeatureIndices[Ie];let Be=0;if(_.canonical.z!==De.canonical.z){for(const Ve of be)_.showCentroid(_.featuresOnBorder[Ve]);if(Oe)for(const Ve of Te)De.showCentroid(De.featuresOnBorder[Ve]);_.borderDoneWithNeighborZ[le]=De.canonical.z,De.borderDoneWithNeighborZ[Ie]=_.canonical.z}for(const Ve of be){const ct=_.featuresOnBorder[Ve],Ye=_.centroidData[ct.centroidDataIndex],kt=ct.borders[le];let vt;for(;Be<Te.length;){vt=De.featuresOnBorder[Te[Be]];const Pt=vt.borders[Ie];if(Pt[1]>kt[0]+3||Pt[0]>kt[0]-3)break;De.showCentroid(vt),Be++}if(vt&&Be<Te.length){const Pt=Be;let Je=0;for(;!(vt.borders[Ie][0]>kt[1]-3)&&(Je++,++Be!==Te.length);)vt=De.featuresOnBorder[Te[Be]];vt=De.featuresOnBorder[Te[Pt]];let ot=!1;if(Je>=1){const dt=vt.borders[Ie];Math.abs(kt[0]-dt[0])<3&&Math.abs(kt[1]-dt[1])<3&&(Je=1,ot=!0,Be=Pt+1)}else if(0===Je){_.showCentroid(ct);continue}const Ke=De.centroidData[vt.centroidDataIndex];S&&ot&&(((oe=Ye).flags|(de=Ke).flags)&p.dW?(oe.flags|=p.dW,de.flags|=p.dW):(oe.flags&=~p.dW,de.flags&=~p.dW));const xt=ct.intersectsCount()>1||vt.intersectsCount()>1;if(Je>1)Be=Pt,Ye.centroidXY=Ke.centroidXY=new p.P(0,0);else if(Le&&Le.dem&&!xt){const dt=Q[le](Ye,Ke),Ot=le%2?p.aj-1:0,wt=se(dt[0],Math.min(p.aj-1,dt[1]),Ot,Le,Me,le<2,dt[2]);Ye.centroidXY=Ke.centroidXY=O(wt)}else xt?Ye.centroidXY=Ke.centroidXY=new p.P(0,0):(Ye.centroidXY=_.encodeBorderCentroid(ct),Ke.centroidXY=De.encodeBorderCentroid(vt));_.writeCentroidToBuffer(Ye),De.writeCentroidToBuffer(Ke)}else _.showCentroid(ct)}_.borderDoneWithNeighborZ[le]=De.canonical.z,De.borderDoneWithNeighborZ[Ie]=_.canonical.z}var oe,de;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const zh=[1,0,0],Pn=[0,1,0],f0=[0,0,1];function Mb(g,a,h){const _=h.transform,w=h.shadowRenderer;if(!w)return!0;const M=g.toUnwrapped(),S=_.tileSize*w._cascades[h.currentShadowCascade].scale;let P=a.maxHeight;if(_.elevation){const oe=_.elevation.getMinMaxForTile(g);oe&&(P+=oe.max)}const O=[...w.shadowDirection];O[2]=-O[2];const V=w.computeSimplifiedTileShadowVolume(M,P,S,O);if(!V)return!1;const U=[zh,Pn,f0,O,[O[0],0,O[2]],[0,O[1],O[2]]],X="globe"===_.projection.name,G=_.scaleZoom(S),Q=p.cn.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,G,!X),se=w.getCurrentCascadeFrustum();return 0===Q.intersectsPrecise(V.vertices,V.planes,U)||0===se.intersectsPrecise(V.vertices,V.planes,U)}function m0(g){return[g[0]*p.dZ,g[1]*p.dZ,g[2]*p.dZ,0]}function Qf(g,a,h,_,w,M,S,P,O){const V=_.getSource(),U=h.globeSharedBuffers;if(!U)return;let X,G,Q;if(a&&(X=_.getTile(a)),V instanceof p.aP?(G=V.texture,Q=p.ds(0,0,h.transform)):X&&a&&(G=X.texture,Q=p.ds(a.canonical.z,a.canonical.x,h.transform)),!G||!Q)return;g||(Q=p.cE(p.bz(),Q,[1,-1,1]));const se=h.context,oe=se.gl,de="nearest"===w.paint.get("raster-resampling")?oe.NEAREST:oe.LINEAR,le=h.colorModeForDrapableLayerRenderPass(M),be=S.defines;be.push("GLOBE_POLES");const Me=new rn(oe.LEQUAL,rn.ReadWrite,h.depthRangeFor3D),De=Float32Array.from(h.transform.expandedFarZProjMatrix),Le=Float32Array.from(p.bh(p.dr(new p.cp(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),se.activeTexture.set(oe.TEXTURE0),G.bind(de,oe.CLAMP_TO_EDGE),se.activeTexture.set(oe.TEXTURE1),G.bind(de,oe.CLAMP_TO_EDGE),"useMipmap"in G&&se.extTextureFilterAnisotropic&&h.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Ie,Oe,Te,Be]=a?U.getPoleBuffers(a.canonical.z,!1):U.getPoleBuffers(0,!0),Ve=w.paint.get("raster-elevation");let ct;g?(ct=Ie,h.renderDefaultNorthPole=0!==Ve):(ct=Oe,h.renderDefaultSouthPole=0!==Ve);const Ye=m0(S.mix),kt=(Pt=De,Je=Le,ot=Q,Ke=p.ah(h.transform.zoom),dt=w,wt=Ve,Lt=Ye,fn=S.offset,bn=S.range,dn=M,Xu(Pt,Je,ot,new Float32Array(16),new Float32Array(9),[0,0],Ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},dt,[0,0],wt,2,Lt,fn,bn,1,0,dn)),vt=h.getOrCreateProgram("raster",{defines:be});var Pt,Je,ot,Ke,dt,wt,Lt,fn,bn,dn;h.uploadCommonUniforms(se,vt,null),vt.draw(h,oe.TRIANGLES,Me,O,le,P,kt,w.id,ct,Te,Be)}function g0(g){const a=g._nearZ,h=g.projection.farthestPixelDistance(g),_=h-a,w=.2*g.height,M=a+w;return[a,h,(M-w-a)/_,(M-a)/_]}function Cb(g,a,h,_){if(g)return a instanceof yo&&g instanceof Tr?a.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:m0(_.mix),offset:_.offset,buffer:0,tileSize:1}}var Sb=p.d_([{name:"a_index",type:"Int16",components:1}]);class Eb{constructor(a,h,_,w){const M={width:_[0],height:_[1],data:null},S=a.gl;this.targetColorTexture=new p.T(a,M,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new p.T(a,M,S.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(h,w),this.lastInvalidatedAt=0}updateParticleTexture(a,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,w=h.width*h.height;this.particleTexture0=new p.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new p.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1});const M=new p.d$;M.reserve(w);for(let S=0;S<w;S++)M.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(M,Sb.members,!0),this.particleSegment=p.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=p.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ol(g,a,h){if(!g)return null;const _=a.getTextureDescriptor(g,h,!0);if(!_)return null;let{texture:w,mix:M,offset:S,tileSize:P,buffer:O,format:V}=_;if(!w||!V)return null;let U=!1;return"uint32"===V&&(U=!0,M[3]=0,M=lh(p.e0,M,[0,h.paint.get("raster-particle-max-speed")]),S=d0(p.e0,S,[0,h.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[O/(P+2*O),P/(P+2*O)],tileSize:P,scalarData:U,scale:M,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function Ig(g){const a=g._nearZ,h=g.projection.farthestPixelDistance(g),_=h-a,w=.2*g.height,M=a+w;return[a,h,(M-w-a)/_,(M-a)/_]}const _0=new p.am(1,0,0,1),y0=new p.am(0,1,0,1),Og=new p.am(0,0,1,1),ic=new p.am(1,0,1,1),gu=new p.am(0,1,1,1);function Nh(g,a,h,_,w,M,S){const P=g.context,O=g.transform,V=P.gl,U="globe"===O.projection.name,X=U?["PROJECTION_GLOBE_VIEW"]:[];let G=p.bw(h.projMatrix);if(U&&p.ah(O.zoom)>0){const Ye=p.bg(h.canonical,O),kt=p.e1(Ye);G=p.az(new Float32Array(16),O.globeMatrix,kt),p.az(G,O.projMatrix,G)}const Q=p.bz();Q[12]+=2*w/(p.q.devicePixelRatio*O.width),Q[13]+=2*M/(p.q.devicePixelRatio*O.height),p.az(G,Q,G);const se=g.getOrCreateProgram("debug",{defines:X}),oe=a.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(oe,se);const de=rn.disabled,le=kn.disabled,be=g.colorModeForRenderPass();P.activeTexture.set(V.TEXTURE0),g.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),U?oe._makeGlobeTileDebugBuffers(g.context,O):oe._makeDebugTileBoundsBuffers(g.context,O.projection);const De=oe._tileDebugBuffer||g.debugBuffer,Le=oe._tileDebugIndexBuffer||g.debugIndexBuffer,Ie=oe._tileDebugSegments||g.debugSegments;if(se.draw(g,V.LINE_STRIP,de,le,be,Ln.disabled,zp(G,_),"$debug",De,Le,Ie,null,null,null,[oe._globeTileDebugBorderBuffer]),S){const Ye=oe.latestRawTileData,kt=Math.floor((Ye&&Ye.byteLength||0)/1024);let vt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(vt+=` => ${h.overscaledZ}`),vt+=` ${oe.state}`,vt+=` ${kt}kb`,function(Pt,Je){Pt.initDebugOverlayCanvas();const ot=Pt.debugOverlayCanvas,Ke=Pt.context.gl,xt=Pt.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,ot.width,ot.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(Je,5,5),xt.strokeText(Je,5,5),Pt.debugOverlayTexture.update(ot),Pt.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(g,vt)}const Oe=a.getTile(h).tileSize,Te=512/Math.min(Oe,512)*(h.overscaledZ/O.zoom)*.5,Be=oe._tileDebugTextBuffer||g.debugBuffer,Ve=oe._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,ct=oe._tileDebugTextSegments||g.debugSegments;se.draw(g,V.TRIANGLES,de,le,Yn.alphaBlended,Ln.disabled,zp(G,p.am.transparent,Te),"$debug",Be,Ve,ct,null,null,null,[oe._globeTileDebugTextBuffer])}function Rg(g,a,h,_){tp(g,0,a+h/2,g.transform.width,h,_)}function Zc(g,a,h,_){tp(g,a-h/2,0,h,g.transform.height,_)}function tp(g,a,h,_,w,M){const S=g.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(a*p.q.devicePixelRatio,h*p.q.devicePixelRatio,_*p.q.devicePixelRatio,w*p.q.devicePixelRatio),S.clear({color:M}),P.disable(P.SCISSOR_TEST)}const v0=p.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Yr}=v0;function dr(g,a,h,_){g.emplaceBack(a,h,_)}class _u{constructor(a){this.vertexArray=new p.e2,this.indices=new p.a_,dr(this.vertexArray,-1,-1,1),dr(this.vertexArray,1,-1,1),dr(this.vertexArray,-1,1,1),dr(this.vertexArray,1,1,1),dr(this.vertexArray,-1,-1,-1),dr(this.vertexArray,1,-1,-1),dr(this.vertexArray,-1,1,-1),dr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Yr),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=p.bd.simpleSegment(0,0,36,12)}}function la(g,a,h,_,w,M){const S=g.context.gl,P=a.paint.get("sky-atmosphere-color"),O=a.paint.get("sky-atmosphere-halo-color"),V=a.paint.get("sky-atmosphere-sun-intensity"),U={u_matrix_3f:p.e4(p.dx(),_),u_sun_direction:w,u_sun_intensity:V,u_color_tint_r:[(se=P).r,se.g,se.b,se.a],u_color_tint_m:[(oe=O).r,oe.g,oe.b,oe.a],u_luminance:5e-5};var se,oe;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+M,a.skyboxTexture,0),h.draw(g,S.TRIANGLES,rn.disabled,kn.disabled,Yn.unblended,Ln.frontCW,U,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Ay=p.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class b0{constructor(a){const h=new p.e5;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.a_;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,Ay.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=p.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const np=p.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yc{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Hp{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Yn([1,771,1,771],p.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Yn([1,0,1,0],p.am.transparent,[!1,!1,!1,!0]),this.params=new Yc,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const h=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new b0(h);const _=this.params.sizeRange,w=this.params.intensityRange,M=function(U){const X=p.ea(30),G=[];for(let Q=0;Q<U;++Q){const se=2*Math.PI*X(),oe=Math.acos(1-2*X())-.5*Math.PI;G.push(p.cS(Math.cos(oe)*Math.cos(se),Math.cos(oe)*Math.sin(se),Math.sin(oe)))}return G}(this.params.starsCount),S=p.ea(300),P=new p.e6,O=new p.a_;let V=0;for(let U=0;U<M.length;++U){const X=p.b$([],M[U],200),G=Math.max(0,1+.01*_*(1*S()-.5)),Q=Math.max(0,1+.01*w*(1*S()-.5));P.emplaceBack(X[0],X[1],X[2],-1,-1,G,Q),P.emplaceBack(X[0],X[1],X[2],1,-1,G,Q),P.emplaceBack(X[0],X[1],X[2],1,1,G,Q),P.emplaceBack(X[0],X[1],X[2],-1,1,G,Q),O.emplaceBack(V+0,V+1,V+2),O.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=h.createVertexBuffer(P,np.members),this.starsIdx=h.createIndexBuffer(O),this.starsSegments=p.bd.simpleSegment(0,0,P.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,h){const _=a.context,w=_.gl,M=a.transform,S=new rn(w.LEQUAL,rn.ReadOnly,[0,1]),P=p.ah(M.zoom),O=a.style.getLut(h.scope),V="none"===h.properties.get("color-use-theme"),U=h.properties.get("color").toRenderColor(V?null:O).toArray01(),X="none"===h.properties.get("high-color-use-theme"),G=h.properties.get("high-color").toRenderColor(X?null:O).toArray01(),Q="none"===h.properties.get("space-color-use-theme"),se=h.properties.get("space-color").toRenderColor(Q?null:O).toArray01PremultipliedAlpha(),de=p.e7(h.properties.get("horizon-blend"),0,1,5e-4,.25),le=p.dl(a,_,M)&&5e-4===de?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,be=a.frameCounter/1e3%1,Me=p.ae(M.globeCenterInViewSpace),De=Math.sqrt(Math.pow(Me,2)-Math.pow(le,2)),Le=Math.acos(De/Me),Ie=Oe=>{const Te="globe"===M.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Oe&&Te.push("ALPHA_PASS");const Be=a.getOrCreateProgram("globeAtmosphere",{defines:Te}),Ve={u_frustum_tl:M.frustumCorners.TL,u_frustum_tr:M.frustumCorners.TR,u_frustum_br:M.frustumCorners.BR,u_frustum_bl:M.frustumCorners.BL,u_horizon:M.frustumCorners.horizon,u_transition:P,u_fadeout_range:de,u_color:U,u_high_color:G,u_space_color:se,u_temporal_offset:be,u_horizon_angle:Le};a.uploadCommonUniforms(_,Be);const ct=this.atmosphereBuffer;ct&&Be.draw(a,w.TRIANGLES,S,kn.disabled,Oe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ln.backCW,Ve,Oe?"atmosphere_glow_alpha":"atmosphere_glow",ct.vertexBuffer,ct.indexBuffer,ct.segments)};Ie(!1),Ie(!0)}drawStars(a,h){const _=p.aD(h.properties.get("star-intensity"),0,1);if(0===_)return;const w=a.context,M=w.gl,S=a.transform,P=a.getOrCreateProgram("stars"),O=p.bY([]);p.b_(O,O,-S._pitch),p.bZ(O,O,-S.angle),p.b_(O,O,p.al(S._center.lat)),p.e8(O,O,-p.al(S._center.lng));const V=p.c3(new Float32Array(16),O),U=p.az([],S.starsProjMatrix,V),X=p.e4([],V),G=p.e9([],X),Q=[0,1,0];p.dz(Q,Q,G),p.b$(Q,Q,this.params.sizeMultiplier);const se=[1,0,0];p.dz(se,se,G),p.b$(se,se,this.params.sizeMultiplier);const oe=(de=Q,le=se,be=_,{u_matrix:Float32Array.from(U),u_up:de,u_right:le,u_intensity_multiplier:be});var de,le,be;a.uploadCommonUniforms(w,P),this.starsVx&&this.starsIdx&&P.draw(a,M.TRIANGLES,rn.disabled,kn.disabled,this.colorModeAlphaBlendedWriteRGB,Ln.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ip(g,a){const h=[...g],_=a.cameraWorldSizeForFog/a.worldSize,w=p.bx([]);return p.cE(w,w,[_,_,1]),p.az(h,w,h),p.az(h,a.worldToFogMatrix,h),h}function Ut(g,a,h,_,w){const M=h.material,S=_.context,{baseColorTexture:P,metallicRoughnessTexture:O}=M.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:U,emissionTexture:X}=M;function G(se,oe,de){if(se&&(g.push(oe),S.activeTexture.set(S.gl.TEXTURE0+de),se.gfxTexture)){const{minFilter:le,magFilter:be,wrapS:Me,wrapT:De}=se.sampler;se.gfxTexture.bindExtraParam(le,be,Me,De)}}G(P,"HAS_TEXTURE_u_baseColorTexture",Ds.BaseColor),G(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Ds.MetallicRoughness),G(V,"HAS_TEXTURE_u_normalTexture",Ds.Normal),G(U,"HAS_TEXTURE_u_occlusionTexture",Ds.Occlusion),G(X,"HAS_TEXTURE_u_emissionTexture",Ds.Emission),w&&(w.texture||(w.texture=new p.ed(_.context,w.image,[w.image.height,w.image.height,w.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+Ds.LUT),w.texture&&w.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(12===h.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(h.pbrBuffer)),"OPAQUE"!==M.alphaMode&&"MASK"!==M.alphaMode||g.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||g.push("DIFFUSE_SHADED");const Q=_.shadowRenderer;Q&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&g.push("NORMAL_OFFSET"))}function nn(g,a,h,_,w,M){const S=h.paint.get("model-opacity").constantOr(1),P=a.context,O=new rn(a.context.gl.LEQUAL,rn.ReadWrite,a.depthRangeFor3D),V=a.transform,U=g.mesh,X=U.material,G=X.pbrMetallicRoughness,Q=a.style.fog;let se;se="pixels"===a.transform.projection.zAxisUnit?[...g.nodeModelMatrix]:p.az([],_.zScaleMatrix,g.nodeModelMatrix),p.az(se,_.negCameraPosMatrix,se);const oe=p.bi([],se);p.ee(oe,oe);const de="none"===h.paint.get("model-color-use-theme").constantOr("default"),le=h.paint.get("model-emissive-strength").constantOr(0),be=Rh(new Float32Array(g.worldViewProjection),new Float32Array(se),new Float32Array(oe),null,a,S,G.baseColorFactor.toRenderColor(null),X.emissiveFactor,G.metallicFactor,G.roughnessFactor,X,le,h),Me={defines:[]},De=[],Le=a.shadowRenderer;Le&&(Le.useNormalOffset=!1),Ut(Me.defines,De,U,a,de?null:h.lut);let Ie=null;if(Q){const Be=ip(g.nodeModelMatrix,a.transform);if(Ie=new Float32Array(Be),"globe"!==V.projection.name){const Ve=U.aabb.min,ct=U.aabb.max,[Ye,kt]=Q.getOpacityForBounds(Be,Ve[0],Ve[1],ct[0],ct[1]);Me.overrideFog=Ye>=jt||kt>=jt}}const Oe=Ys(a,h.paint.get("model-cutoff-fade-range"));Oe.shouldRenderCutoff&&Me.defines.push("RENDER_CUTOFF");const Te=a.getOrCreateProgram("model",Me);a.uploadCommonUniforms(P,Te,null,Ie,Oe),"shadow"!==a.renderPass&&Le&&Le.setupShadowsFromMatrix(g.nodeModelMatrix,Te),Te.draw(a,P.gl.TRIANGLES,O,w,M,U.material.doubleSided?Ln.disabled:Ln.backCCW,be,h.id,U.vertexBuffer,U.indexBuffer,U.segments,h.paint,a.transform.zoom,void 0,De)}function yu(g,a,h,_,w,M,S){let P;P="globe"===g.projection.name?p.ef(h,g):[...h],p.az(P,P,a.matrix);const O=p.az([],_,P);if(a.meshes)for(const V of a.meshes){if("BLEND"!==V.material.alphaMode){S.push({mesh:V,depth:0,modelIndex:w,worldViewProjection:O,nodeModelMatrix:P});continue}const U=p.ad([],V.centroid,O);!g.isOrthographic&&U[2]<=0||M.push({mesh:V,depth:U[2],modelIndex:w,worldViewProjection:O,nodeModelMatrix:P})}if(a.children)for(const V of a.children)yu(g,V,h,_,w,M,S)}function jo(g,a,h,_){const w=h.shadowRenderer;if(!w)return;const M=w.getShadowPassDepthMode(),S=w.getShadowPassColorMode(),P=w.calculateShadowPassMatrixFromMatrix(a),O=p0(P);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,M,kn.disabled,S,Ln.backCCW,O,_.id,g.vertexBuffer,g.indexBuffer,g.segments,_.paint,h.transform.zoom,void 0,void 0)}function it(g,a,h){const _=a.updateZoomBasedPaintProperties(),w=function(M,S,P){let O,V,U,X=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&X>0){const G=M.terrain,Q=G.findDEMTileFor(P);Q&&Q.dem?O=p.el.create(G,P,Q):X=0}if(0===X&&(S.terrainElevationMin=0,S.terrainElevationMax=0),X===S.validForExaggeration&&(0===X||O&&O._demTile&&O._demTile.tileID===S.validForDEMTile.id&&O._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const G in S.instancesPerModel){const Q=S.instancesPerModel[G];for(let se=0;se<Q.instancedDataArray.length;++se){const oe=(O?X*O.getElevationAt(0|Q.instancedDataArray.float32[16*se],0|Q.instancedDataArray.float32[16*se+1],!0,!0):0)+Q.instancesEvaluatedElevation[se];Q.instancedDataArray.float32[16*se+6]=oe,V=V?Math.min(S.terrainElevationMin,oe):oe,U=U?Math.max(S.terrainElevationMax,oe):oe}}return S.terrainElevationMin=V||0,S.terrainElevationMax=U||0,S.validForExaggeration=X,S.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,a,h);(_||w)&&(a.uploaded=!1,a.upload(g.context))}const md={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new p.cV([0,0,0],[p.aj,p.aj,0])};function Jf(g,a){const h=1<<g.canonical.z,_=a.getFreeCameraOptions().position,w=a.elevation,M=g.canonical.x/h,S=(g.canonical.x+1)/h,P=g.canonical.y/h,O=(g.canonical.y+1)/h;let V=a._centerAltitude;if(w){const Q=w.getMinMaxForTile(g);Q&&Q.max>V&&(V=Q.max)}const U=p.aD(_.x,M,S)-_.x,X=p.aD(_.y,P,O)-_.y,G=p.c6(V,a.center.lat)-_.z;return a._zoomFromMercatorZ(Math.sqrt(U*U+X*X+G*G))}function Lg(g,a,h,_,w,M,S){const P=g.context,O="shadow"===g.renderPass,V=g.shadowRenderer,U=O&&V?V.getShadowPassDepthMode():new rn(P.gl.LEQUAL,rn.ReadWrite,g.depthRangeFor3D),X=g.isTileAffectedByFog(M);if(h.meshes)for(const G of h.meshes){const Q=["MODEL_POSITION_ON_GPU"],se=[];let oe,de,le;_.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const be=Ys(g,a.paint.get("model-cutoff-fade-range"));if(be.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),O&&V)oe=g.getOrCreateProgram("modelDepth",{defines:Q}),de=p0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(h.matrix)),le=V.getShadowPassColorMode();else{Ut(Q,se,G,g,"none"===a.paint.get("model-color-use-theme").constantOr("default")?null:a.lut),oe=g.getOrCreateProgram("model",{defines:Q,overrideFog:X});const De=G.material,Le=De.pbrMetallicRoughness,Ie=a.paint.get("model-opacity").constantOr(1),Oe=a.paint.get("model-emissive-strength").constantOr(0);de=Rh(M.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,g,Ie,Le.baseColorFactor.toRenderColor(null),De.emissiveFactor,Le.metallicFactor,Le.roughnessFactor,De,Oe,a,w),V&&(S.shadowUniformsInitialized?oe.setShadowUniformValues(P,V.getShadowUniformValues()):(V.setupShadows(M.toUnwrapped(),oe,"model-tile",M.overscaledZ),S.shadowUniformsInitialized=!0)),le=be.shouldRenderCutoff||Ie<1||"OPAQUE"!==De.alphaMode?Yn.alphaBlended:Yn.unblended}g.uploadCommonUniforms(P,oe,M.toUnwrapped(),null,be);const Me=G.material.doubleSided?Ln.disabled:Ln.backCCW;if(_.instancedDataArray.length>20)se.push(_.instancedDataBuffer),oe.draw(g,P.gl.TRIANGLES,U,kn.disabled,le,Me,de,a.id,G.vertexBuffer,G.indexBuffer,G.segments,a.paint,g.transform.zoom,void 0,se,_.instancedDataArray.length);else{const De=O?"u_instance":"u_normal_matrix";for(let Le=0;Le<_.instancedDataArray.length;++Le)de[De]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Le,16),oe.draw(g,P.gl.TRIANGLES,U,kn.disabled,le,Me,de,a.id,G.vertexBuffer,G.indexBuffer,G.segments,a.paint,g.transform.zoom,void 0,se)}}if(h.children)for(const G of h.children)Lg(g,a,G,_,w,M,S)}const Yi=[1,-1,1];function x0(g,a,h,_){if(!h.modelManager)return!0;const w=h.modelManager;if(!h.shadowRenderer)return!0;const M=h.shadowRenderer,S=a.aabb;let P=!0,O=g.maxHeight;if(0===O){let U=0;for(const X in g.instancesPerModel){const G=w.getModel(X,_);G?U=Math.max(U,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):P=!1}O=g.maxScale*U*1.41+g.maxVerticalOffset,P&&(g.maxHeight=O)}S.max[2]=O,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,p.ad(S.min,S.min,a.tileMatrix),p.ad(S.max,S.max,a.tileMatrix);const V=S.intersects(M.getCurrentCascadeFrustum());return 0===h.currentShadowCascade&&(g.isInsideFirstShadowMapFrustum=2===V),0===V}function Db(g,a){const h=g.uniformValues.u_cutoff_params[0],_=g.uniformValues.u_cutoff_params[1],w=g.uniformValues.u_cutoff_params[2],M=g.uniformValues.u_cutoff_params[3];return _===h||M===w?1:p.aD(((a-h)/(_-h)-w)/(M-w),0,1)}function Up(g,a,h,_){if(a.pitch<20)return 1;const w=a.getWorldToCameraMatrix();p.az(w,w,g);const M=p.ei(h.min[0],h.min[1],h.min[2],1);let S=p.aA(p.ej(),M,w),P=S,O=S;M[1]=h.max[1],S=p.aA(p.ej(),M,w),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O,M[0]=h.max[0],S=p.aA(p.ej(),M,w),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O,M[1]=h.min[1],S=p.aA(p.ej(),M,w),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O;const V=p.aD(_[0],0,1),U=100*a.pixelsPerMeter*p.aD(_[1],0,1),X=p.aD(_[2],0,1),G=p.ek(p.ej(),P,O,V),Q=Math.tan(.5*a.fovX),se=-G[2]*Q;if(0===U)return G[1]<-Math.abs(se)?X:1;const oe=(-Math.abs(se)-G[1])/U,de=(be,Me,De)=>(1-De)*be+De*Me,le=p.aD(de(1,X,oe),X,1);return de(1,le,p.aD((a.pitch-20)/20,0,1))}class Tb{}class Ab{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,h,_){{const X=this._storage.get(h.id);if(X)return X.lastUsedFrameIdx=a,X.buf}const w=_.gl,M=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),S=new ArrayBuffer(M),P=new Int16Array(S);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const O=new p.en;for(let X=0;X<M/2;X+=3){const G=P[X],Q=P[X+1],se=P[X+2];O.emplaceBack(G,Q),O.emplaceBack(Q,se),O.emplaceBack(se,G)}const V=_.bindVertexArrayOES.current,U=new Tb;return U.buf=new Eg(_,O),U.lastUsedFrameIdx=a,this._storage.set(h.id,U),_.bindVertexArrayOES.set(V),U.buf}update(a){for(const[h,_]of this._storage)a-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(h))}destroy(){for(const[a,h]of this._storage)h.buf.destroy(),this._storage.delete(a)}}class w0{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Bh=p.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class k0{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class M0{constructor(a,h){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Py=p.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Fg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,h){const _=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new p.eo,P=new p.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(S,Py.members),this.vignetteIdx=a.context.createIndexBuffer(P)}const w=p.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,_);const S={u_vignetteShape:(M={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};_.draw(a,a.context.gl.TRIANGLES,rn.disabled,kn.disabled,Yn.alphaBlended,Ln.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,w)}var M}}class em{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,h){const _=a.getFreeCameraOptions().position,w=_.toAltitude(),M=_.toLngLat(),S=p.al(M.lng),P=p.al(M.lat),O=a.pixelsPerMeter/h,V=S*p.eq,U=p.eq*Math.log(Math.tan(Math.PI/4+P/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const X=-this._offsetYPrev+U,G=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*O,this._accumulatedOffsetY+=X*O,this._accumulatedElevation+=G*O,this._offsetXPrev=V,this._offsetYPrev=U,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function cn(g,a){return[-(g[0]-Math.floor(g[0]/a)*a),-(g[1]-Math.floor(g[1]/a)*a),-(g[2]-Math.floor(g[2]/a)*a)]}function Jr(g){const a=p.ea(1323123451230),h=[];for(let _=0;_<g;++_){const w=2*a()-1,M=2*a()-1,S=2*a()-1;h.push(p.cS(w,M,S))}return h}function An(g,a,h,_,w){const M=p.aD((w-h)/(_-h),0,1);return(1-M)*g+M*a}class Mn{constructor(a){this._movement=new em,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Fg,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,h){const _=a.transform;this._movement.update(_,this._ppmScaleFactor);const w=_.starsProjMatrix,M=p.bY([]);p.b_(M,M,p.al(90)-_._pitch),p.bZ(M,M,-_.angle);const S=p.c3(new Float32Array(16),M),P=p.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=p.ee([],P),V=p.az([],O,S),U=Date.now()/1e3;return this._accumulatedTimeFromStart+=(U-this._prevTime)*h,this._prevTime=U,{projectionMatrix:w,modelviewMatrix:V}}}class Ml extends Mn{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new M0(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const h=a.context;if(!this.particlesVx){const _=Jr(this.particlesCount),w=new p.er,M=new p.a_;let S=0;const P=p.ea(1323123451230);for(let O=0;O<_.length;++O){const V=_[O],U=[2*P()-1,P(),P(),P()];w.emplaceBack(V[0],V[1],V[2],-1,-1,...U),w.emplaceBack(V[0],V[1],V[2],1,-1,...U),w.emplaceBack(V[0],V[1],V[2],1,1,...U),w.emplaceBack(V[0],V[1],V[2],-1,1,...U),M.emplaceBack(S+0,S+1,S+2),M.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=h.createVertexBuffer(w,Bh.members),this.particlesIdx=h.createIndexBuffer(M)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=a.transform.zoom;if(h.revealStart>_)return;const w=An(0,1,h.revealStart,h.revealStart+h.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let S=[-M.direction.x,M.direction.y,-100];p.au(S,S);const P=structuredClone(this._vignetteParams);P.strength*=w,M.overrideStyleParameters||(M.intensity=a.style.rain.state.density,M.timeFactor=a.style.rain.state.intensity,M.color=structuredClone(a.style.rain.state.color),S=structuredClone(a.style.rain.state.direction),M.screenThinning.intensity=a.style.rain.state.centerThinning,M.dropletSizeX=a.style.rain.state.dropletSize[0],M.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],M.distortionStrength=100*a.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(a.style.rain.state.vignetteColor));const O=this.updateOnRender(a,M.timeFactor),V=a.context,U=V.gl,X=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new p.T(V,{width:a.width,height:a.height,data:null},U.RGBA8)),M.distortionStrength>0&&(V.activeTexture.set(U.TEXTURE0),this.screenTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),U.copyTexSubImage2D(U.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const G=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(V,G),V.activeTexture.set(U.TEXTURE0),this.screenTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const Q=[M.color.r,M.color.g,M.color.b,M.color.a],se=(oe,de)=>{const le=cn(this._movement.getPosition(),oe),be=M.dropletSizeX,Me=M.dropletSizeX*M.dropletSizeYScale,De=a.width/2,Le=a.height/2,Ie=An(0,M.screenThinning.start,0,1,M.screenThinning.intensity),Oe=An(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),Te=An(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),Be=(Ve={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:le,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:oe,rainDropletSize:[be,Me],distortionStrength:M.distortionStrength,rainDirection:S,color:Q,screenSize:[X.width,X.height],thinningCenterPos:[De,Le],thinningShape:[Ie,Oe,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:de?0:1},{u_modelview:Float32Array.from(Ve.modelview),u_projection:Float32Array.from(Ve.projection),u_time:Ve.time,u_cam_pos:Ve.camPos,u_texScreen:0,u_velocityConeAperture:Ve.velocityConeAperture,u_velocity:Ve.velocity,u_boxSize:Ve.boxSize,u_rainDropletSize:Ve.rainDropletSize,u_distortionStrength:Ve.distortionStrength,u_rainDirection:Ve.rainDirection,u_color:Ve.color,u_screenSize:Ve.screenSize,u_thinningCenterPos:Ve.thinningCenterPos,u_thinningShape:Ve.thinningShape,u_thinningAffectedRatio:Ve.thinningAffectedRatio,u_thinningParticleOffset:Ve.thinningParticleOffset,u_shapeDirectionalPower:Ve.shapeDirectionalPower,u_shapeNormalPower:Ve.shapeNormalPower,u_mode:Ve.mode});var Ve;const ct=Math.round(M.intensity*this.particlesCount),Ye=p.bd.simpleSegment(0,0,4*ct,2*ct);G.draw(a,U.TRIANGLES,rn.disabled,kn.disabled,Yn.alphaBlended,Ln.disabled,Be,"rain_particles",this.particlesVx,this.particlesIdx,Ye)};M.distortionStrength>0&&se(M.boxSize,!0),se(M.boxSize,!1),this._vignette.draw(a,P)}}const qp=p.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Fr extends Mn{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new M0(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const h=a.context;if(!this.particlesVx){const _=Jr(this.particlesCount),w=new p.es,M=new p.a_;let S=0;const P=p.ea(1323123451230);for(let O=0;O<_.length;++O){const V=_[O],U=P(),X=P(),G=P(),Q=[O/_.length,U,X,G],se=[P(),P()];w.emplaceBack(V[0],V[1],V[2],-1,-1,...Q,...se),w.emplaceBack(V[0],V[1],V[2],1,-1,...Q,...se),w.emplaceBack(V[0],V[1],V[2],1,1,...Q,...se),w.emplaceBack(V[0],V[1],V[2],-1,1,...Q,...se),M.emplaceBack(S+0,S+1,S+2),M.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=h.createVertexBuffer(w,qp.members),this.particlesIdx=h.createIndexBuffer(M)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const h=structuredClone(this._params);let _=[-h.direction.x,h.direction.y,-100];p.au(_,_);const w=structuredClone(this._vignetteParams),M=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=a.transform.zoom;if(M.revealStart>S)return;const P=An(0,1,M.revealStart,M.revealStart+M.revealRange,S);w.strength*=P,h.overrideStyleParameters||(h.intensity=a.style.snow.state.density,h.timeFactor=a.style.snow.state.intensity,h.color=structuredClone(a.style.snow.state.color),_=structuredClone(a.style.snow.state.direction),h.screenThinning.intensity=a.style.snow.state.centerThinning,h.billboardSize=2.79*a.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(a.style.snow.state.vignetteColor));const O=this.updateOnRender(a,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=a.context,U=V.gl,X=a.transform,G=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(V,G),((Q,se,oe)=>{const de=cn(this._movement.getPosition(),Q),le=X.width/2,be=X.height/2,Me=An(0,oe.screenThinning.start,0,1,oe.screenThinning.intensity),De=An(.001,oe.screenThinning.range,0,1,oe.screenThinning.intensity),Le=An(0,oe.screenThinning.particleOffset,0,1,oe.screenThinning.intensity),Ie=(Oe={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:oe.velocityConeAperture,velocity:oe.velocity,horizontalOscillationRadius:oe.horizontalOscillationRadius,horizontalOscillationRate:oe.horizontalOscillationRate,boxSize:Q,billboardSize:1*oe.billboardSize,simpleShapeParameters:[oe.shapeFadeStart,oe.shapeFadePower],screenSize:[X.width,X.height],thinningCenterPos:[le,be],thinningShape:[Me,De,Math.pow(10,oe.screenThinning.fadePower)],thinningAffectedRatio:oe.screenThinning.affectedRatio,thinningParticleOffset:Le,color:[oe.color.r,oe.color.g,oe.color.b,oe.color.a],direction:_},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_horizontalOscillationRadius:Oe.horizontalOscillationRadius,u_horizontalOscillationRate:Oe.horizontalOscillationRate,u_boxSize:Oe.boxSize,u_billboardSize:Oe.billboardSize,u_simpleShapeParameters:Oe.simpleShapeParameters,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_particleColor:Oe.color,u_direction:Oe.direction});var Oe;const Te=Math.round(oe.intensity*this.particlesCount),Be=p.bd.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&G.draw(a,U.TRIANGLES,rn.disabled,kn.disabled,Yn.alphaBlended,Ln.disabled,Ie,"snow_particles",this.particlesVx,this.particlesIdx,Be)})(h.boxSize,0,h),this._vignette.draw(a,w)}}const Ei={symbol:function(g,a,h,_,w){if("translucent"!==g.renderPass)return;const M=kn.disabled,S=g.colorModeForRenderPass(),P=h.layout.get("text-variable-anchor"),O=h.layout.get("text-size-scale-range"),V=p.aD(g.scaleFactor,O[0],O[1]);P&&function(G,Q,se,oe,de,le,be,Me){const De=Q.transform,Le="map"===de,Ie="map"===le;for(const Oe of G){const Te=oe.getTile(Oe),Be=Te.getBucket(se);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Ve=p.bH(Be.textSizeData,De.zoom,Me),ct=Ea(Oe,Be.getProjection(),De),Ye=De.calculatePixelsToTileUnitsMatrix(Te),kt=ih(ct,Te.tileID.canonical,Ie,Le,De,Be.getProjection(),Ye),vt=Be.hasIconTextFit()&&Be.hasIconData();Ve&&Ty(Be,Le,Ie,be,De,kt,Oe,Math.pow(2,De.zoom-Te.tileID.overscaledZ),Ve,vt)}}(_,g,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w,V);const U=0!==h.paint.get("icon-opacity").constantOr(1),X=0!==h.paint.get("text-opacity").constantOr(1);void 0!==h.layout.get("symbol-sort-key").constantOr(1)&&(U||X)?Xf(g,a,h,_,M,S):(U&&Xf(g,a,h,_,M,S,{onlyIcons:!0}),X&&Xf(g,a,h,_,M,S,{onlyText:!0})),a.map.showCollisionBoxes&&(Zf(g,a,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Zf(g,a,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,a,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),P=void 0!==h.layout.get("circle-sort-key").constantOr(1),O=h.paint.get("circle-emissive-strength");if(0===w.constantOr(1)&&(0===M.constantOr(1)||0===S.constantOr(1)))return;const V=g.context,U=V.gl,X=g.transform,G=g.depthModeForSublayer(0,rn.ReadOnly),Q=kn.disabled,se=g.colorModeForDrapableLayerRenderPass(O),oe="globe"===X.projection.name,de=[p.ay(X.center.lng),p.aH(X.center.lat)],le=[];for(let Me=0;Me<_.length;Me++){const De=_[Me],Le=a.getTile(De),Ie=Le.getBucket(h);if(!Ie||Ie.projection.name!==X.projection.name)continue;const Oe=Ie.programConfigurations.get(h.id),Te=p.dK(h),Be=g.isTileAffectedByFog(De);oe&&Te.push("PROJECTION_GLOBE_VIEW"),Te.push("DEPTH_D24"),g.terrain&&X.depthOcclusionForSymbolsAndCircles&&Te.push("DEPTH_OCCLUSION");const Ve=g.getOrCreateProgram("circle",{config:Oe,defines:Te,overrideFog:Be}),ct=Ie.layoutVertexBuffer,Ye=Ie.globeExtVertexBuffer,kt=Ie.indexBuffer,vt=X.projection.createInversionMatrix(X,De.canonical),Pt={programConfiguration:Oe,program:Ve,layoutVertexBuffer:ct,globeExtVertexBuffer:Ye,indexBuffer:kt,uniformValues:p.dL(g,De,Le,vt,de,h),tile:Le};if(P){const Je=Ie.segments.get();for(const ot of Je)le.push({segments:new p.bd([ot]),sortKey:ot.sortKey,state:Pt})}else le.push({segments:Ie.segments,sortKey:0,state:Pt})}P&&le.sort((Me,De)=>Me.sortKey-De.sortKey);const be={useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles};for(const Me of le){const{programConfiguration:De,program:Le,layoutVertexBuffer:Ie,globeExtVertexBuffer:Oe,indexBuffer:Te,uniformValues:Be,tile:Ve}=Me.state,ct=Me.segments;g.terrain&&g.terrain.setupElevationDraw(Ve,Le,be),g.uploadCommonUniforms(V,Le,Ve.tileID.toUnwrapped()),Le.draw(g,U.TRIANGLES,G,Q,se,Ln.disabled,Be,h.id,Ie,Te,ct,h.paint,X.zoom,De,[Oe])}},heatmap:function(g,a,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,M=w.gl,S=kn.disabled,P=new Yn([M.ONE,M.ONE,M.ONE,M.ONE],p.am.transparent,[!0,!0,!0,!0]);(function(Q,se,oe,de){const le=Q.gl,be=se.width*de,Me=se.height*de;Q.activeTexture.set(le.TEXTURE1),Q.viewport.set([0,0,be,Me]);let De=oe.heatmapFbo;if(!De||De&&(De.width!==be||De.height!==Me)){De&&De.destroy();const Le=le.createTexture();le.bindTexture(le.TEXTURE_2D,Le),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),De=oe.heatmapFbo=Q.createFramebuffer(be,Me,!0,null),function(Ie,Oe,Te,Be,Ve,ct){const Ye=Ie.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,Ie.extRenderToTextureHalfFloat?Ye.RGBA16F:Ye.RGBA,Ve,ct,0,Ye.RGBA,Ie.extRenderToTextureHalfFloat?Ye.HALF_FLOAT:Ye.UNSIGNED_BYTE,null),Be.colorAttachment.set(Te)}(Q,0,Le,De,be,Me)}else le.bindTexture(le.TEXTURE_2D,De.colorAttachment.get()),Q.bindFramebuffer.set(De.framebuffer)})(w,g,h,"globe"===g.transform.projection.name?.5:.25),w.clear({color:p.am.transparent});const O=g.transform,V="globe"===O.projection.name,U=V?["PROJECTION_GLOBE_VIEW"]:[],X=V?Ln.frontCCW:Ln.disabled,G=[p.ay(O.center.lng),p.aH(O.center.lat)];for(let Q=0;Q<_.length;Q++){const se=_[Q];if(a.hasRenderableParent(se))continue;const oe=a.getTile(se),de=oe.getBucket(h);if(!de||de.projection.name!==O.projection.name)continue;const le=g.isTileAffectedByFog(se),be=de.programConfigurations.get(h.id),Me=g.getOrCreateProgram("heatmap",{config:be,defines:U,overrideFog:le}),{zoom:De}=g.transform;g.terrain&&g.terrain.setupElevationDraw(oe,Me),g.uploadCommonUniforms(w,Me,se.toUnwrapped());const Le=O.projection.createInversionMatrix(O,se.canonical);Me.draw(g,M.TRIANGLES,rn.disabled,S,P,X,mu(g,se,oe,Le,G,De,h.paint.get("heatmap-intensity")),h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,g.transform.zoom,be,V?[de.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,M){const S=w.context,P=S.gl,O=M.heatmapFbo;if(!O)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let V=M.colorRampTexture;V||(V=M.colorRampTexture=new p.T(S,M.colorRamp,P.RGBA8)),V.bind(P.LINEAR,P.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,P.TRIANGLES,rn.disabled,kn.disabled,w.colorModeForRenderPass(),Ln.disabled,{u_image:0,u_color_ramp:1,u_opacity:M.paint.get("heatmap-opacity")},M.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,M.paint,w.transform.zoom)}(g,h))},line:function(g,a,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(0===w.constantOr(1)||0===M.constantOr(1))return;const S=h.paint.get("line-emissive-strength"),P=h.paint.get("line-occlusion-opacity"),O=h.layout.get("line-elevation-reference"),V="meters"===h.layout.get("line-width-unit"),U="sea"===O,X=!(!g.terrain||!g.terrain.enabled),G=g.context,Q=G.gl;if(h.hasElevatedBuckets&&"globe"===g.transform.projection.name)return;const se=h.layout.get("line-cross-slope"),oe=void 0!==se,de=se<1,le=g.colorModeForDrapableLayerRenderPass(S),be=g.terrain&&g.terrain.renderingToTexture,Me=be?1:p.q.devicePixelRatio,De=h.paint.get("line-dasharray"),Le=De.constantOr(1),Ie=h.layout.get("line-cap"),Oe=De.constantOr(null),Te=Ie.constantOr(null),Be=h.paint.get("line-pattern"),Ve=Be.constantOr(1),ct=h.paint.get("line-pattern-cross-fade"),Ye=Be.constantOr(null),kt=h.paint.get("line-opacity").constantOr(1);let vt=!Ve&&1!==kt||g.depthOcclusion&&P>0&&P<1;const Pt=h.paint.get("line-gradient"),Je=Ve?"linePattern":"line",ot=p.dM(h);let Ke;if(be&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(vt=!1),0!==P&&g.depthOcclusion){const wt=h.paint._values["line-opacity"];wt&&wt.value&&"constant"===wt.value.kind?Ke=wt.value:p.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==M.value.kind&&!1===M.value.isLineProgressConstant&&ot.push("VARIABLE_LINE_WIDTH");const xt=(wt,It,Lt,fn,bn,dn)=>{for(const an of wt){const mn=a.getTile(an);if(Ve&&!mn.patternsLoaded())continue;const Dn=mn.getBucket(h);if(!Dn||"none"!==Dn.elevationType&&!bn||"none"===Dn.elevationType&&bn)continue;g.prepareDrawTile();const qn=[...It],xi=g.shadowRenderer,xr="road"===Dn.elevationType&&!!xi&&xi.enabled;let hr=[0,0,0];if(xr){const ai=g.style.directionalLight,Hr=g.style.ambientLight;ai&&Hr&&(hr=Ha(g.style,ai,Hr)),qn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ci=Dn.programConfigurations.get(h.id);let Lo=!1;if(Ye&&mn.imageAtlas){const ai=p.dN.from(Ye),Hr=ai.getPrimary().scaleSelf(Me).toString(),Vi=mn.imageAtlas.patternPositions.get(Hr),Xr=ai.getSecondary(),ir=Xr?mn.imageAtlas.patternPositions.get(Xr.scaleSelf(Me).toString()):null;Lo=!!Vi&&!!ir,Vi&&Ci.setConstantPatternPositions(Vi,ir)}ct>0&&(Lo||Ci.getPatternTransitionVertexBuffer("line-pattern"))&&qn.push("LINE_PATTERN_TRANSITION");const fo=g.isTileAffectedByFog(an),ni=g.getOrCreateProgram(Je,{config:Ci,defines:qn,overrideFog:fo,overrideRtt:!bn&&void 0});if(!Ve&&Oe&&Te&&mn.lineAtlas){const ai=mn.lineAtlas.getDash(Oe,Te);ai&&Ci.setConstantPatternPositions(ai)}xr&&xi.setupShadows(mn.tileID.toUnwrapped(),ni,"vector-tile",mn.tileID.overscaledZ);let[Li,qi]=h.paint.get("line-trim-offset");("round"===Te||"square"===Te)&&Li!==qi&&(0===Li&&(Li-=1),1===qi&&(qi+=1));const wr=be?an.projMatrix:null,oo=V?1/Dn.tileToMeter/p.aw(mn,1,g.transform.zoom):1,Ho=V?1/Dn.tileToMeter/p.aw(mn,1,Math.floor(g.transform.zoom)):1,vo=Ve?p.dO(g,mn,h,wr,Me,oo,Ho,[Li,qi],hr,ct):p.dP(g,mn,h,wr,Dn.lineClipsArray.length,Me,oo,Ho,[Li,qi],hr);if(Pt){const ai=Dn.gradients[h.id];let Hr=ai.texture;if(h.gradientVersion!==ai.version){let Vi=256;if(h.stepInterpolant){const Xr=a.getSource().maxzoom,ir=an.canonical.z===Xr?Math.ceil(1<<g.transform.maxZoom-an.canonical.z):1;Vi=p.aD(p.dQ(Dn.maxLineLength/p.aj*1024*ir),256,G.maxTextureSize)}ai.gradient=p.dR({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Vi,image:ai.gradient||void 0,clips:Dn.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new p.T(G,ai.gradient,Q.RGBA8),ai.version=h.gradientVersion,Hr=ai.texture}G.activeTexture.set(Q.TEXTURE1),Hr.bind(h.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Le&&(G.activeTexture.set(Q.TEXTURE0),mn.lineAtlasTexture&&mn.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),Ci.updatePaintBuffers()),Ve&&(G.activeTexture.set(Q.TEXTURE0),mn.imageAtlasTexture&&mn.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Ci.updatePaintBuffers()),bn&&!U&&g.terrain.setupElevationDraw(mn,ni),g.uploadCommonUniforms(G,ni,an.toUnwrapped());const so=ai=>{null!=Ke&&(Ke.value=kt*P),ni.draw(g,Q.TRIANGLES,Lt,ai,le,Ln.disabled,vo,h.id,Dn.layoutVertexBuffer,Dn.indexBuffer,Dn.segments,h.paint,g.transform.zoom,Ci,[Dn.layoutVertexBuffer2,Dn.patternVertexBuffer,Dn.zOffsetVertexBuffer]),null!=Ke&&(Ke.value=kt)};if(vt&&!bn){const ai=g.stencilModeForClipping(an).ref;0===ai&&be&&G.clear({stencil:0});const Hr={func:Q.EQUAL,mask:255};vo.u_alpha_discard_threshold=.8,so(new kn(Hr,ai,255,Q.KEEP,Q.KEEP,Q.INVERT)),vo.u_alpha_discard_threshold=0,so(new kn(Hr,ai,255,Q.KEEP,Q.KEEP,Q.KEEP))}else vo.u_alpha_discard_threshold=vt&&bn&&dn?.8:0,so(bn?fn:g.stencilModeForClipping(an))}};let dt=g.depthModeForSublayer(0,rn.ReadOnly);const Ot=new rn(g.depthOcclusion?Q.GREATER:Q.LEQUAL,rn.ReadOnly,g.depthRangeFor3D);if(h.hasNonElevatedBuckets){const wt=!be&&g.terrain;0!==P&&wt?p.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):wt?p.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):xt(_,ot,dt,kn.disabled,!1,!0)}if(h.hasElevatedBuckets){"hd-road-markup"===O?X||(dt=Ot,ot.push("ELEVATED_ROADS")):(ot.push("ELEVATED"),dt=Ot,oe&&ot.push(de?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),U&&ot.push("ELEVATION_REFERENCE_SEA"));const wt=vt?g.stencilModeFor3D():kn.disabled;g.forceTerrainMode=!0,xt(_,ot,dt,wt,!0,!0),vt&&xt(_,ot,dt,wt,!0,!1),g.forceTerrainMode=!1}vt&&(g.resetStencilClippingMasks(),be&&G.clear({stencil:0})),0===P||g.depthOcclusion||be||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,a,h,_){const w=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(0===M.constantOr(1))return;const S=h.paint.get("fill-emissive-strength"),P=g.colorModeForDrapableLayerRenderPass(S),O=h.paint.get("fill-pattern"),V=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&1===w.constantOr(p.am.transparent).a&&1===M.constantOr(0)?"opaque":"translucent";let U="none";"none"!==h.layout.get("fill-elevation-reference")?U="road":0!==h.paint.get("fill-z-offset").constantOr(1)&&(U="offset");const X=!(!g.terrain||!g.terrain.enabled),G={painter:g,sourceCache:a,layer:h,coords:_,colorMode:P,elevationType:U,terrainEnabled:X,pass:V};if("shadow"!==g.renderPass)if("offset"!==U){if(ln(G,!1),"road"===U){const Q=!X&&"translucent"===g.renderPass;Q&&Ju(g,a,h,_,"geometry"),ln(G,!0,kn.disabled),Q&&function(se){const{painter:oe,sourceCache:de,layer:le,coords:be,colorMode:Me}=se,De=oe.context.gl,Le=se.painter.shadowRenderer,Ie=!!Le&&Le.enabled,Oe=new rn(oe.context.gl.LEQUAL,rn.ReadOnly,oe.depthRangeFor3D);let Te=[0,0,0];if(Ie){const Be=oe.style.directionalLight,Ve=oe.style.ambientLight;Be&&Ve&&(Te=Ha(oe.style,Be,Ve))}for(const Be of be){const Ve=de.getTile(Be),ct=Ve.getBucket(le);if(!ct)continue;const Ye=ct.elevatedStructures;if(!Ye||!Ye.renderableSegments||0===Ye.renderableSegments.segments[0].primitiveLength)continue;oe.prepareDrawTile();const kt=ct.bufferData.programConfigurations.get(le.id),vt=oe.isTileAffectedByFog(Be),Pt=[];Ie&&Pt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Je=oe.getOrCreateProgram("elevatedStructures",{config:kt,overrideFog:vt,defines:Pt}),ot=oe.translatePosMatrix(Be.projMatrix,Ve,le.paint.get("fill-translate"),le.paint.get("fill-translate-anchor"));Ie&&Le.setupShadows(Ve.tileID.toUnwrapped(),Je,"vector-tile",Ve.tileID.overscaledZ);const Ke=Cg(ot,Te);oe.uploadCommonUniforms(oe.context,Je,Be.toUnwrapped()),Je.draw(oe,De.TRIANGLES,Oe,kn.disabled,Me,Ln.backCCW,Ke,le.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.renderableSegments,le.paint,oe.transform.zoom,kt,[Ye.vertexBufferNormal])}}(G)}}else ln(G,!1,g.stencilModeFor3D());else g.shadowRenderer&&"road"===U&&!X&&function(Q){const{painter:se,sourceCache:oe,layer:de,coords:le}=Q,be=se.context.gl,Me=Q.painter.shadowRenderer;for(const De of le){const Le=oe.getTile(De),Ie=Le.getBucket(de);if(!Ie)continue;const Oe=Ie.elevatedStructures;if(!Oe||!Oe.shadowCasterSegments||0===Oe.shadowCasterSegments.segments[0].primitiveLength)continue;se.prepareDrawTile();const Te=Ie.bufferData.programConfigurations.get(de.id),Be=se.isTileAffectedByFog(De),Ve=se.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:Be}),ct=Me.calculateShadowPassMatrixFromTile(Le.tileID.toUnwrapped());se.uploadCommonUniforms(se.context,Ve,De.toUnwrapped());const Ye={u_matrix:ct,u_depth_bias:.001};Ve.draw(se,be.TRIANGLES,Me.getShadowPassDepthMode(),kn.disabled,Me.getShadowPassColorMode(),Ln.disabled,Ye,de.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.shadowCasterSegments,de.paint,se.transform.zoom,Te)}}(G)},"fill-extrusion":function(g,a,h,_){const w=h.paint.get("fill-extrusion-opacity"),M=g.context,S=M.gl,P=g.terrain,O=P&&P.renderingToTexture;if(0===w)return;const V=g.conflationActive&&g.style.isLayerClipped(h,a.getSource()),U=g.style.order.indexOf(h.fqid);if(V&&function(X,G,Q,se,oe){for(const de of se){const le=G.getTile(de).getBucket(Q);le&&(le.updateReplacement(de,X.replacementSource,oe),le.uploadCentroid(X.context))}}(g,a,h,_,U),P||V)for(const X of _){const G=a.getTile(X).getBucket(h);G&&Fh(g.context,a,X,G,h,P,V)}if("shadow"===g.renderPass&&g.shadowRenderer){const X=g.shadowRenderer;if(P&&w<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof p.ab)return;const G=X.getShadowPassDepthMode(),Q=X.getShadowPassColorMode();Pg(g,a,h,_,G,kn.disabled,Q,V)}else if("translucent"===g.renderPass){const X=!h.paint.get("fill-extrusion-pattern").constantOr(1),G=h.paint.get("fill-extrusion-color").constantOr(p.am.white);if(!O&&0!==G.a){const Q=new rn(g.context.gl.LEQUAL,rn.ReadWrite,g.depthRangeFor3D);1===w&&X?Pg(g,a,h,_,Q,kn.disabled,Yn.unblended,V):(Pg(g,a,h,_,Q,kn.disabled,Yn.disabled,V),Pg(g,a,h,_,Q,g.stencilModeFor3D(),g.colorModeForRenderPass(),V),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&X&&(!P&&"globe"!==g.transform.projection.name||O)){const Q=h.paint.get("fill-extrusion-opacity"),se=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=h.paint.get("fill-extrusion-flood-light-intensity"),le="none"===h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),be=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(le?null:h.lut).toArray01().slice(0,3),Me=se>0&&oe>0,De=de>0,Le=(Oe,Te,Be)=>(1-Be)*Oe+Be*Te,Ie=Oe=>{const Te=g.depthModeForSublayer(1,rn.ReadOnly,S.LEQUAL,!0),Be=h.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ve=Le(.1,3,Be),ct=g._showOverdrawInspector;if(!ct){const Ye=new kn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),kt=new Yn([S.ONE,S.ONE,S.ONE,S.ONE],p.am.transparent,[!1,!1,!1,!0],S.MIN);ep(g,a,h,_,Te,Ye,kt,Ln.disabled,Oe,"sdf",Q,se,oe,de,be,Ve,V,!1)}{const Ye=ct?kn.disabled:new kn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),kt=ct?g.colorModeForRenderPass():new Yn([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],p.am.transparent,[!0,!0,!0,!0]);ep(g,a,h,_,Te,Ye,kt,Ln.disabled,Oe,"color",Q,se,oe,de,be,Ve,V,!1)}};if(O){const Oe=(Te,Be,Ve)=>{const ct=g.depthModeForSublayer(1,rn.ReadOnly,S.LEQUAL,!1),Ye=h.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),kt=Le(.1,3,Ye);{const vt=new Yn([S.ONE,S.ONE,S.ONE,S.ONE],p.am.transparent,[!1,!1,!1,!0]);ep(g,a,h,_,ct,kn.disabled,vt,Ln.disabled,Te,"clear",Q,se,oe,de,be,kt,V,Be)}{const vt=new kn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Pt=new Yn([S.ONE,S.ONE,S.ONE,S.ONE],p.am.transparent,[!1,!1,!1,!0],S.MIN);ep(g,a,h,_,ct,vt,Pt,Ln.disabled,Te,"sdf",Q,se,oe,de,be,kt,V,Be)}{const vt=Te?S.ZERO:S.ONE_MINUS_DST_ALPHA,Pt=new kn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Je=new Yn([vt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],p.am.transparent,[!0,!0,!0,!0]);ep(g,a,h,_,ct,Pt,Je,Ln.disabled,Te,"color",Q,se,oe,de,be,kt,V,Be)}{const vt=new Yn([S.ONE,S.ONE,S.ONE,Te?S.ZERO:S.ONE],p.am.transparent,[!1,!1,!1,!0],Te?S.FUNC_ADD:S.MAX);ep(g,a,h,_,ct,kn.disabled,vt,Ln.disabled,Te,"clear",Q,se,oe,de,be,kt,V,Be,Ve)}};if(Me||De){let Te;if(g.prepareDrawTile(),P){const Be=P.drapeBufferSize[0],Ve=P.drapeBufferSize[1];Te=P.framebufferCopyTexture,Te&&(!Te||Te.size[0]===Be&&Te.size[1]===Ve)||(Te&&Te.destroy(),Te=P.framebufferCopyTexture=new p.T(M,new p.r({width:Be,height:Ve}),S.RGBA8)),Te.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Be,Ve)}Me&&Oe(!0,!1,Te),De&&Oe(!1,!0,Te)}}else Me&&Ie(!0),De&&Ie(!1),(Me||De)&&g.resetStencilClippingMasks()}}},hillshade:function(g,a,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass||g.style.disableElevatedTerrain)return;const w=g.context,M=g.terrain&&g.terrain.renderingToTexture,[S,P]="translucent"!==g.renderPass||M?[{},_]:g.stencilConfigForOverlap(_);for(const O of P){const V=a.getTile(O);if(V.needsHillshadePrepare&&"offscreen"===g.renderPass)Pa(g,V,h);else if("translucent"===g.renderPass){const U=g.depthModeForSublayer(0,rn.ReadOnly),X=h.paint.get("hillshade-emissive-strength"),G=g.colorModeForDrapableLayerRenderPass(X),Q=M&&g.terrain?g.terrain.stencilModeForRTTOverlap(O):S[O.overscaledZ];aa(g,O,V,h,U,Q,G)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,a,h,_,w,M){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity"))return;const S="globe"===g.transform.projection.name,P=0!==h.paint.get("raster-elevation"),O=P&&S;if(g.renderElevatedRasterBackface&&!O)return;const V=g.context,U=V.gl,X=a.getSource(),G=function(Ie,Oe,Te,Be){const Ve=Oe.paint.get("raster-color"),ct="raster-array"===Ie.type,Ye=[],kt=Oe.paint.get("raster-resampling"),vt=Oe.paint.get("raster-color-mix");let Pt=Oe.paint.get("raster-color-range");const Je=[vt[0],vt[1],vt[2],0],ot=vt[3];let Ke="nearest"===kt?Be.NEAREST:Be.LINEAR;if(ct&&(Ye.push("RASTER_ARRAY"),Ve||Ye.push("RASTER_COLOR"),"linear"===kt&&Ye.push("RASTER_ARRAY_LINEAR"),Ke=Be.NEAREST,!Pt&&Ie.rasterLayers)){const xt=Ie.rasterLayers.find(({id:dt})=>dt===Oe.sourceLayer);xt&&xt.fields&&xt.fields.range&&(Pt=xt.fields.range)}if(Pt=Pt||[0,1],Ve){Ye.push("RASTER_COLOR"),Te.activeTexture.set(Be.TEXTURE2),Oe.updateColorRamp(Pt);let xt=Oe.colorRampTexture;xt||(xt=Oe.colorRampTexture=new p.T(Te,Oe.colorRamp,Be.RGBA8)),xt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}return{mix:Je,range:Pt,offset:ot,defines:Ye,resampling:Ke}}(X,h,V,U);if(X instanceof p.aP&&!_.length&&!S)return;const Q=h.paint.get("raster-emissive-strength"),se=g.colorModeForDrapableLayerRenderPass(Q),oe=g.terrain&&g.terrain.renderingToTexture,de=!g.options.moving,le="nearest"===h.paint.get("raster-resampling")?U.NEAREST:U.LINEAR;if(X instanceof p.aP&&!_.length&&(X.onNorthPole||X.onSouthPole)){const Ie=P?g.stencilModeFor3D():kn.disabled;return void Qf(!!X.onNorthPole,null,g,a,h,Q,G,Ln.disabled,Ie)}if(!_.length)return;const[be,Me]=X instanceof p.aP||oe?[{},_]:g.stencilConfigForOverlap(_),De=Me[Me.length-1].overscaledZ;O&&G.defines.push("PROJECTION_GLOBE_VIEW"),P&&G.defines.push("RENDER_CUTOFF");const Le=(Ie,Oe,Te)=>{for(const Be of Ie){const Ve=Be.toUnwrapped(),ct=a.getTile(Be);if(oe&&(!ct||!ct.hasData()))continue;V.activeTexture.set(U.TEXTURE0);const Ye=Cb(ct,X,h,G);if(!Ye||!Ye.texture)continue;const{texture:kt,mix:vt,offset:Pt,tileSize:Je,buffer:ot}=Ye;let Ke,xt;oe?(Ke=rn.disabled,xt=Be.projMatrix):P?(Ke=new rn(U.LEQUAL,rn.ReadWrite,g.depthRangeFor3D),xt=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Ve,de)):(Ke=g.depthModeForSublayer(Be.overscaledZ-De,1===h.paint.get("raster-opacity")?rn.ReadWrite:rn.ReadOnly,U.LESS),xt=g.transform.calculateProjMatrix(Ve,de));const dt=g.terrain&&oe?g.terrain.stencilModeForRTTOverlap(Be):be[Be.overscaledZ],Ot=M?0:h.paint.get("raster-fade-duration");ct.registerFadeDuration(Ot);const wt=a.findLoadedParent(Be,0),It=nc(ct,wt,a,g.transform,Ot);let Lt,fn;g.terrain&&g.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),kt.bind(le,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),wt?(wt.texture&&wt.texture.bind(le,U.CLAMP_TO_EDGE),Lt=Math.pow(2,wt.tileID.overscaledZ-ct.tileID.overscaledZ),fn=[ct.tileID.canonical.x*Lt%1,ct.tileID.canonical.y*Lt%1]):kt.bind(le,U.CLAMP_TO_EDGE),"useMipmap"in kt&&V.extTextureFilterAnisotropic&&g.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const bn=g.transform;let dn;const an=P?g0(bn):[0,0,0,0];let mn,Dn,qn,xi,xr,hr=0;if(O&&X instanceof p.aP&&X.coordinates.length>3)mn=Float32Array.from(p.bh(p.dr(new p.cp(0,0,0)))),Dn=Float32Array.from(bn.globeMatrix),qn=Float32Array.from(p.dm(bn)),xi=[p.ay(bn.center.lng),p.aH(bn.center.lat)],dn=X.elevatedGlobePerspectiveTransform,xr=X.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const ni=p.dn(Be.canonical);hr=p.dp(ni.getCenter().lat),mn=Float32Array.from(p.bh(p.dr(Be.canonical))),Dn=Float32Array.from(bn.globeMatrix),qn=Float32Array.from(p.dm(bn)),xi=[p.ay(bn.center.lng),p.aH(bn.center.lat)],dn=[0,0],xr=Float32Array.from(p.dq(Be.canonical,ni,hr,bn.worldSize/bn._pixelsPerMercatorPixel))}else dn=X instanceof p.aP?X.perspectiveTransform:[0,0],mn=new Float32Array(16),Dn=new Float32Array(9),qn=new Float32Array(16),xi=[0,0],xr=new Float32Array(9);const Ci=Xu(xt,mn,Dn,qn,xr,fn||[0,0],p.ah(g.transform.zoom),xi,an,Lt||1,It,h,dn,P?h.paint.get("raster-elevation"):0,2,vt,Pt,G.range,Je,ot,Q),Lo=g.isTileAffectedByFog(Be),fo=g.getOrCreateProgram("raster",{defines:G.defines,overrideFog:Lo});if(g.uploadCommonUniforms(V,fo,Ve),X instanceof p.aP){const ni=X.elevatedGlobeVertexBuffer,Li=X.elevatedGlobeIndexBuffer;if(oe||!S)X.boundsBuffer&&X.boundsSegments&&fo.draw(g,U.TRIANGLES,Ke,kn.disabled,se,Ln.disabled,Ci,h.id,X.boundsBuffer,g.quadTriangleIndexBuffer,X.boundsSegments);else if(ni&&Li){const qi=bn.zoom<=p.cL?X.elevatedGlobeSegments:X.getSegmentsForLongitude(bn.center.lng);qi&&fo.draw(g,U.TRIANGLES,Ke,kn.disabled,se,Oe,Ci,h.id,ni,Li,qi)}}else if(O){Ke=new rn(U.LEQUAL,rn.ReadOnly,g.depthRangeFor3D);const ni=g.globeSharedBuffers;if(ni){const[Li,qi,wr]=ni.getGridBuffers(hr,!1);fo.draw(g,U.TRIANGLES,Ke,Te||dt,g.colorModeForRenderPass(),Oe,Ci,h.id,Li,qi,wr)}}else{const{tileBoundsBuffer:ni,tileBoundsIndexBuffer:Li,tileBoundsSegments:qi}=g.getTileBoundsBuffers(ct);fo.draw(g,U.TRIANGLES,Ke,dt,se,Ln.disabled,Ci,h.id,ni,Li,qi)}}if(!(X instanceof p.aP)&&O)for(const Be of Ie){const Ve=Be.canonical.y===(1<<Be.canonical.z)-1;0===Be.canonical.y&&Qf(!0,Be,g,a,h,Q,G,Oe,Te||kn.disabled),Ve&&Qf(!1,Be,g,a,h,Q,G,Oe===Ln.frontCW?Ln.backCW:Ln.frontCW,Te||kn.disabled)}};O?Le(Me,g.renderElevatedRasterBackface?Ln.backCW:Ln.frontCW,g.stencilModeFor3D()):Le(Me,Ln.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,a,h,_,w,M){"offscreen"===g.renderPass&&function(S,P,O,V){if(!V.length)return;const U=S.context,X=U.gl,G=P.getSource();if(!(G instanceof yo))return;const Q=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let se=O.particlePositionRGBAImage;if(!se||se.width!==Q){const Me=function(De){const Le=De*De,Ie=new Uint8Array(4*Le),Oe=function(Be){return Be|=0,Be=Math.imul(2747636419^Be,2654435769),Be=Math.imul(Be^Be>>>16,2654435769),((Be=Math.imul(Be^Be>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Be=0;Be<Le;Be++){const Ve=Te*(Oe(2*Be+0)+ql),ct=Te*(Oe(2*Be+1)+ql),Ye=255*Ve%1,kt=255*ct%1,vt=Ye,Pt=ct-kt/255,Je=kt;Ie[4*Be+0]=255*(Ve-Ye/255),Ie[4*Be+1]=255*vt,Ie[4*Be+2]=255*Pt,Ie[4*Be+3]=255*Je}return Ie}(Q);se=O.particlePositionRGBAImage=new p.r({width:Q,height:Q},Me)}let oe=O.particleFramebuffer;oe?oe.width!==Q&&(oe.destroy(),oe=O.particleFramebuffer=U.createFramebuffer(Q,Q,!0,null)):oe=O.particleFramebuffer=U.createFramebuffer(Q,Q,!0,null);const de=[];for(const Me of V){const De=P.getTile(Me);if(!(De instanceof Tr))continue;const Le=ol(De,G,O);if(!Le)continue;const Ie=[De.tileSize,De.tileSize];let Oe=O.tileFramebuffer;Oe||(Oe=O.tileFramebuffer=U.createFramebuffer(Ie[0],Ie[1],!0,null));let Te=De.rasterParticleState;Te||(Te=De.rasterParticleState=new Eb(U,Me,Ie,se));const Be=Te.update(O.lastInvalidatedAt);Te.particleTextureDimension!==Q&&Te.updateParticleTexture(Me,se);const Ve=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Ve;const ct=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=ct,de.push([Me,Le,Te,Be])}if(0===de.length)return;const le=p.q.now(),be=O.previousDrawTimestamp?.001*(le-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=le,O.hasColorMap()){U.activeTexture.set(X.TEXTURE0+2);let Me=O.colorRampTexture;Me||(Me=O.colorRampTexture=new p.T(U,O.colorRamp,X.RGBA8)),Me.bind(X.LINEAR,X.CLAMP_TO_EDGE)}U.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(Me,De,Le){const Ie=Me.context,Oe=Ie.gl,Te=De.tileFramebuffer;Ie.activeTexture.set(Oe.TEXTURE0);const Be={u_texture:0,u_opacity:1.05*(ct=De.paint.get("raster-particle-fade-opacity-factor"))/(ct+.05)},Ve=Me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ct;for(const Ye of Le){const[,,kt,vt]=Ye;Te.colorAttachment.set(kt.targetColorTexture.texture),Ie.viewport.set([0,0,Te.width,Te.height]),Ie.clear({color:p.am.transparent}),vt&&(kt.backgroundColorTexture.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE),Ve.draw(Me,Oe.TRIANGLES,rn.disabled,kn.disabled,Yn.alphaBlended,Ln.disabled,Be,De.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments))}}(S,O,de),function(Me,De,Le,Ie){const Oe=Me.context,Te=Oe.gl,Be=Le.tileFramebuffer,Ve="globe"===Me.transform.projection.name,ct=Le.paint.get("raster-particle-max-speed");for(const Ye of Ie){const[kt,vt,Pt]=Ye;Oe.activeTexture.set(Te.TEXTURE0+0),vt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Be.colorAttachment.set(Pt.targetColorTexture.texture);const Je=Me.getOrCreateProgram("rasterParticleDraw",{defines:vt.defines,overrideFog:!1});Oe.activeTexture.set(Te.TEXTURE0+1);const ot=vt.scalarData?[]:[0,1,2,3].map(dt=>p.dU[dt](kt));ot.push(kt);const Ke=kt.canonical.x,xt=kt.canonical.y;for(const dt of ot){const Ot=De.getTile(Ve?dt.wrapped():dt);if(!Ot)continue;const wt=Ot.rasterParticleState;if(!wt)continue;const It=dt.canonical.x+(1<<dt.canonical.z)*(dt.wrap-kt.wrap),Lt=dt.canonical.y;wt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const fn=Gf(1,wt.particleTexture0.size[0],[It-Ke,Lt-xt],0,vt.texture.size,2,ct,vt.textureOffset,vt.scale,vt.offset);Je.draw(Me,Te.POINTS,rn.disabled,kn.disabled,Yn.alphaBlended,Ln.disabled,fn,Le.id,wt.particleIndexBuffer,void 0,wt.particleSegment)}}}(S,P,O,de),U.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(Me,De,Le,Ie){const Oe=Me.context,Te=Oe.gl,Be=De.paint.get("raster-particle-max-speed"),Ve=Ie*De.paint.get("raster-particle-speed-factor")*.15,ct=(kt=.01+1*De.paint.get("raster-particle-reset-rate-factor"),Math.pow(kt,6)),Ye=De.particleFramebuffer;var kt;Oe.viewport.set([0,0,Ye.width,Ye.height]);for(const kt of Le){const[,vt,Pt]=kt;Oe.activeTexture.set(Te.TEXTURE0+0),vt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Oe.activeTexture.set(Te.TEXTURE0+1);const Je=Pt.particleTexture0;Je.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const ot=h0(1,Je.size[0],0,vt.texture.size,Be,Ve,ct,vt.textureOffset,vt.scale,vt.offset);Ye.colorAttachment.set(Pt.particleTexture1.texture),Oe.clear({color:p.am.transparent}),Me.getOrCreateProgram("rasterParticleUpdate",{defines:vt.defines}).draw(Me,Te.TRIANGLES,rn.disabled,kn.disabled,Yn.unblended,Ln.disabled,ot,De.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments)}}(S,O,de,be)}(g,a,h,_),"translucent"===g.renderPass&&(function(S,P,O,V,U){const X=S.context,G=X.gl,Q=P.getSource().tileSize,se=5*(1-p.af(p.cx,p.cx+1,S.transform.zoom))*Q+O.paint.get("raster-particle-elevation"),oe=!S.options.moving,de="globe"===S.transform.projection.name;if(!V.length)return;const[le,be]=S.stencilConfigForOverlap(V),Me=[];de&&Me.push("PROJECTION_GLOBE_VIEW");const De=S.stencilModeFor3D();for(const Le of be){const Ie=Le.toUnwrapped(),Oe=P.getTile(Le);if(!Oe.rasterParticleState)continue;const Te=Oe.rasterParticleState,Be=100;Oe.registerFadeDuration(Be);const Ve=P.findLoadedParent(Le,0),ct=nc(Oe,Ve,P,S.transform,Be);let Ye,kt;S.terrain&&S.terrain.prepareDrawTile(),X.activeTexture.set(G.TEXTURE0),Te.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),X.activeTexture.set(G.TEXTURE1),Ve&&Ve.rasterParticleState?(Ve.rasterParticleState.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ye=Math.pow(2,Ve.tileID.overscaledZ-Oe.tileID.overscaledZ),kt=[Oe.tileID.canonical.x*Ye%1,Oe.tileID.canonical.y*Ye%1]):Te.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const vt=de?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ie,oe),Pt=S.transform,Je=Ig(Pt),ot=p.dn(Le.canonical),Ke=p.dp(ot.getCenter().lat);let xt,dt,Ot,wt,It;de?(xt=Float32Array.from(p.bh(p.dr(Le.canonical))),dt=Float32Array.from(Pt.globeMatrix),Ot=Float32Array.from(p.dm(Pt)),wt=[p.ay(Pt.center.lng),p.aH(Pt.center.lat)],It=Float32Array.from(p.dq(Le.canonical,ot,Ke,Pt.worldSize/Pt._pixelsPerMercatorPixel))):(xt=new Float32Array(16),dt=new Float32Array(9),Ot=new Float32Array(16),wt=[0,0],It=new Float32Array(9));const Lt=Mc(vt,xt,dt,Ot,It,kt||[0,0],p.ah(S.transform.zoom),wt,Je,Ye||1,ct,se),fn=S.isTileAffectedByFog(Le),bn=S.getOrCreateProgram("rasterParticle",{defines:Me,overrideFog:fn});if(S.uploadCommonUniforms(X,bn,Ie),de){const dn=new rn(G.LEQUAL,rn.ReadOnly,S.depthRangeFor3D),an=0,mn=S.globeSharedBuffers;if(mn){const[Dn,qn,xi]=mn.getGridBuffers(Ke,0!==an);bn.draw(S,G.TRIANGLES,dn,De,Yn.alphaBlended,S.renderElevatedRasterBackface?Ln.frontCCW:Ln.backCCW,Lt,O.id,Dn,qn,xi)}}else{const dn=S.depthModeForSublayer(0,rn.ReadOnly),an=le[Le.overscaledZ],{tileBoundsBuffer:mn,tileBoundsIndexBuffer:Dn,tileBoundsSegments:qn}=S.getTileBoundsBuffers(Oe);bn.draw(S,G.TRIANGLES,dn,an,Yn.alphaBlended,Ln.disabled,Lt,O.id,mn,Dn,qn)}}S.resetStencilClippingMasks()}(g,a,h,_),g.style.map.triggerRepaint())},background:function(g,a,h,_){const w=h.paint.get("background-color"),M="none"===h.paint.get("background-color-use-theme").constantOr("default"),S=h.paint.get("background-opacity"),P=h.paint.get("background-emissive-strength"),O="viewport"===h.paint.get("background-pitch-alignment");if(0===S)return;const V=g.context,U=V.gl,X=g.transform,G=X.tileSize,Q=h.paint.get("background-pattern");let se;if(void 0!==Q&&(null===Q||(se=g.imageManager.getPattern(p.I.from(Q.toString()),h.scope,g.style.getLut(h.scope)),!se)))return;const oe=!Q&&1===w.a&&1===S&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==oe)return;const de=kn.disabled,le=g.depthModeForSublayer(0,"opaque"===oe?rn.ReadWrite:rn.ReadOnly),be=g.colorModeForDrapableLayerRenderPass(P),Me=Q?"backgroundPattern":"background";let De,Le=_;if(Le||(De=g.getBackgroundTiles(),Le=Object.values(De).map(Ie=>Ie.tileID)),Q&&(V.activeTexture.set(U.TEXTURE0),g.imageManager.bind(g.context,h.scope)),O){const Ie=g.getOrCreateProgram(Me,{overrideFog:!1,overrideRtt:!0}),Oe=new Float32Array(p.bx([])),Te=new p.aM(0,0,0,0,0),Be=Q?u0(Oe,P,S,g,0,h.scope,se,O,{tileID:Te,tileSize:G}):Np(Oe,P,S,w.toRenderColor(M?null:h.lut));Ie.draw(g,U.TRIANGLES,le,de,be,Ln.disabled,Be,h.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Ie of Le){const Oe=g.isTileAffectedByFog(Ie),Te=g.getOrCreateProgram(Me,{overrideFog:Oe}),Be=Ie.toUnwrapped(),Ve=_?Ie.projMatrix:g.transform.calculateProjMatrix(Be);g.prepareDrawTile();const ct=a?a.getTile(Ie):De?De[Ie.key]:new Qa(Ie,G,X.zoom,g),Ye=Q?u0(Ve,P,S,g,0,h.scope,se,O,{tileID:Ie,tileSize:G}):Np(Ve,P,S,w.toRenderColor(M?null:h.lut));g.uploadCommonUniforms(V,Te,Be);const{tileBoundsBuffer:kt,tileBoundsIndexBuffer:vt,tileBoundsSegments:Pt}=g.getTileBoundsBuffers(ct);Te.draw(g,U.TRIANGLES,le,de,be,Ln.disabled,Ye,h.id,kt,vt,Pt)}},sky:function(g,a,h){const _=g._atmosphere?p.ah(g.transform.zoom):1,w=h.paint.get("sky-opacity")*_;if(0===w)return;const M=g.context,S=h.paint.get("sky-type"),P=new rn(M.gl.LEQUAL,rn.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(V,U,X,G){const Q=V.context,se=Q.gl;let oe=U.skyboxFbo;if(!oe){oe=U.skyboxFbo=Q.createFramebuffer(32,32,!0,null),U.skyboxGeometry=new _u(Q),U.skyboxTexture=Q.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,U.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let Me=0;Me<6;++Me)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(oe.framebuffer),Q.viewport.set([0,0,32,32]);const de=U.getCenter(V,!0),le=V.getOrCreateProgram("skyboxCapture"),be=new Float64Array(16);p.bx(be),p.e3(be,be,.5*-Math.PI),la(V,U,le,be,de,0),p.bx(be),p.e3(be,be,.5*Math.PI),la(V,U,le,be,de,1),p.bx(be),p.cG(be,be,.5*-Math.PI),la(V,U,le,be,de,2),p.bx(be),p.cG(be,be,.5*Math.PI),la(V,U,le,be,de,3),p.bx(be),la(V,U,le,be,de,4),p.bx(be),p.e3(be,be,Math.PI),la(V,U,le,be,de,5),Q.viewport.set([0,0,V.width,V.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(V,U,X,G,Q){const se=V.context,oe=se.gl,de=V.transform,le=V.getOrCreateProgram("skybox");se.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,U.skyboxTexture);const be={u_matrix:de.skyboxMatrix,u_sun_direction:U.getCenter(V,!1),u_cubemap:0,u_opacity:G,u_temporal_offset:Q};V.uploadCommonUniforms(se,le),le.draw(V,oe.TRIANGLES,X,kn.disabled,V.colorModeForRenderPass(),Ln.backCW,be,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,h,P,w,O):"gradient"===S&&"sky"===g.renderPass&&function(V,U,X,G,Q){const se=V.context,oe=se.gl,de=V.transform,le=V.getOrCreateProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new _u(se)),se.activeTexture.set(oe.TEXTURE0);let be=U.colorRampTexture;be||(be=U.colorRampTexture=new p.T(se,U.colorRamp,oe.RGBA8)),be.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Me=(De=de.skyboxMatrix,Le=U.getCenter(V,!1),Ie=U.paint.get("sky-gradient-radius"),Oe=G,Te=Q,{u_matrix:De,u_color_ramp:0,u_center_direction:Le,u_radius:p.al(Ie),u_opacity:Oe,u_temporal_offset:Te});var De,Le,Ie,Oe,Te;V.uploadCommonUniforms(se,le),le.draw(V,oe.TRIANGLES,X,kn.disabled,V.colorModeForRenderPass(),Ln.backCW,Me,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,h,P,w,O)},debug:function(g,a,h,_,w,M){for(let S=0;S<h.length;S++)if(w){const V=new p.am(.8*_.r,.8*_.g,.8*_.b,1);Nh(g,a,h[S],_,-1,-1,M),Nh(g,a,h[S],_,-1,1,M),Nh(g,a,h[S],_,1,1,M),Nh(g,a,h[S],_,1,-1,M),Nh(g,a,h[S],V,0,0,M)}else Nh(g,a,h[S],_,0,0,M)},custom:function(g,a,h,_){const w=g.context,M=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isDraped(a)){if("offscreen"===g.renderPass){const S=M.prerender;if(S){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const P=g.transform.pointMerc;S.call(M,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.ah(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else S.call(M,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const P=M.renderToTile;if(P){const O=_[0].canonical,V={x:O.x+_[0].wrap*(M.wrapTileId?0:1<<O.z),y:O.y,z:O.z};w.setDepthMode(rn.disabled),w.setStencilMode(kn.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),P.call(M,w.gl,V),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(kn.disabled);const S="3d"===M.renderingMode?new rn(g.context.gl.LEQUAL,rn.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,rn.ReadOnly);if(w.setDepthMode(S),"globe"===g.transform.projection.name){const P=g.transform.pointMerc;M.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.ah(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else M.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else p.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,a,h,_){if("opaque"===g.renderPass)return;const w=h.paint.get("model-opacity").constantOr(1);if(0===w)return;const M=h.paint.get("model-cast-shadows");if("shadow"===g.renderPass&&(!M||g.terrain&&w<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof p.ab))return;const S=g.shadowRenderer,P=h.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,P||(S.enabled=!1));const O=()=>{S&&(S.useNormalOffset=!0,P||(S.enabled=!0))},V=a.getSource();if("light-beam"===g.renderPass&&"batched-model"!==V.type)return;if("vector"===V.type||"geojson"===V.type)return function(le,be,Me,De,Le){const Ie=le.transform;if("mercator"!==Ie.projection.name)return void p.w(`Drawing 3D models for ${Ie.projection.name} projection is not yet implemented`);const Oe=Ie.getFreeCameraOptions().position;if(!le.modelManager)return;const Te=le.modelManager;Me.modelManager=Te;const Be=le.shadowRenderer;if(!Me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ve=Me._unevaluatedLayout._values["model-id"],ct=Object.assign({},Me.layout.get("model-id").parameters),Ye=le.style.order.indexOf(Me.fqid);for(const kt of De){const vt=be.getTile(kt).getBucket(Me);if(!vt||vt.projection.name!==Ie.projection.name)continue;const Pt=vt.getModelUris();Pt&&!vt.modelsRequested&&(Te.addModelsFromBucket(Pt,Le),vt.modelsRequested=!0);const Je=Jf(kt,Ie);ct.zoom=Je;const ot=Ve.possiblyEvaluate(ct);if(it(le,vt,kt),md.shadowUniformsInitialized=!1,md.useSingleShadowCascade=!!Be&&0===Be.getMaxCascadeForTile(kt.toUnwrapped()),"shadow"===le.renderPass&&Be){if(1===le.currentShadowCascade&&vt.isInsideFirstShadowMapFrustum)continue;const dt=Ie.calculatePosMatrix(kt.toUnwrapped(),Ie.worldSize);if(md.tileMatrix.set(dt),md.shadowTileMatrix=Float32Array.from(Be.calculateShadowPassMatrixFromMatrix(dt)),md.aabb.min.fill(0),md.aabb.max[0]=md.aabb.max[1]=p.aj,md.aabb.max[2]=0,x0(vt,md,le,Me.scope))continue}const Ke=1<<kt.canonical.z,xt=[((Oe.x-kt.wrap)*Ke-kt.canonical.x)*p.aj,(Oe.y*Ke-kt.canonical.y)*p.aj,Oe.z*Ke*p.aj];le.conflationActive&&Object.keys(vt.instancesPerModel).length>0&&le.style.isLayerClipped(Me,be.getSource())&&vt.updateReplacement(kt,le.replacementSource,Ye,Le)&&(vt.uploaded=!1,vt.upload(le.context));for(let dt in vt.instancesPerModel){const Ot=vt.instancesPerModel[dt];Ot.features.length>0&&(dt=ot.evaluate(Ot.features[0].feature,{}));const wt=Te.getModel(dt,Le);if(wt||Te.hasURLBeenRequested(dt)||vt.modelUris.includes(dt)||(vt.modelUris.push(dt),vt.modelsRequested=!1),wt&&wt.uploaded)for(const It of wt.nodes)Lg(le,Me,It,Ot,xt,kt,md)}}}(g,a,h,_,"vector"===V.type?h.scope:""),void O();if(!V.loaded())return;if("batched-model"===V.type)return function(le,be,Me,De){Me.resetLayerRenderingStats(le);const Le=le.context,Ie=le.transform,Oe=le.style.fog,Te=le.shadowRenderer;if("mercator"!==Ie.projection.name)return void p.w(`Drawing 3D landmark models for ${Ie.projection.name} projection is not yet implemented`);const Be=le.transform.getFreeCameraOptions().position,Ve=p.b$([],[Be.x,Be.y,Be.z],le.transform.worldSize),ct=p.eb([],Ve),Ye=p.bx([]),kt=p.ec(Ie.center.lat,Ie.zoom),vt=p.bn([],[1,1,1/kt]);p.bo(Ye,Ye,ct);const Pt=Me.paint.get("model-opacity").constantOr(1),Je=new rn(Le.gl.LEQUAL,rn.ReadWrite,le.depthRangeFor3D),ot=new rn(Le.gl.LEQUAL,rn.ReadOnly,le.depthRangeFor3D),Ke=new p.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xt="shadow"===le.renderPass,dt=xt&&Te?Te.getCurrentCascadeFrustum():Ie.getFrustum(Ie.scaleZoom(Ie.worldSize)),Ot=Me.paint.get("model-front-cutoff"),wt=Ot[2]<1,It=Ys(le,Me.paint.get("model-cutoff-fade-range")),Lt=Me.getLayerRenderingStats();(function(fn,bn,dn,an){const mn=fn.terrain?fn.terrain.exaggeration():0,Dn=fn.transform.zoom;for(const qn of an){const xi=bn.getTile(qn).getBucket(dn);xi&&(xi.setFilter(dn.filter),fn.conflationActive&&xi.updateReplacement(qn,fn.replacementSource),xi.evaluateScale(fn,dn),fn.terrain&&mn>0&&xi.elevationUpdate(fn.terrain,mn,qn,dn.source),xi.needsReEvaluation(fn,Dn,dn)&&xi.evaluate(dn))}})(le,be,Me,De),function(){let fn,bn,dn;wt?(fn=De.length-1,bn=-1,dn=-1):(fn=0,bn=De.length,dn=1);const an=new Float64Array(16),mn=p.eg(),Dn=new p.P(0,0);for(let qn=fn;qn!==bn;qn+=dn){const xi=De[qn],xr=be.getTile(xi).getBucket(Me);if(!xr||!xr.uploaded)continue;let hr=!1;Te&&(hr=0===Te.getMaxCascadeForTile(xi.toUnwrapped()));const Ci=Ie.calculatePosMatrix(xi.toUnwrapped(),Ie.worldSize),Lo=xr.modelTraits;!xt&&wt&&(p.bi(an,Ci),p.ad(mn,Ve,an),Dn.x=mn[0],Dn.y=mn[1]);const fo=[];xr.setFilter(Me.filter);for(const ni of xr.getNodesInfo()){if(ni.hiddenByReplacement||!ni.node.meshes)continue;const Li=ni.node;let qi=0;le.terrain&&Li.elevation&&(qi=Li.elevation*le.terrain.exaggeration());const wr=(()=>{const ao=ni.aabb;return Ke.min=[...ao.min],Ke.max=[...ao.max],Ke.min[2]+=qi,Ke.max[2]+=qi,p.ad(Ke.min,Ke.min,Ci),p.ad(Ke.max,Ke.max,Ci),Ke})(),oo=ni.evaluatedScale;if(oo[0]<=1&&oo[1]<=1&&oo[2]<=1&&0===wr.intersects(dt))continue;if(!xt&&wt){const ao=.16666666666666666;ni.cameraCollisionOpacity=Ve[0]>wr.min[0]&&Ve[0]<wr.max[0]&&Ve[1]>wr.min[1]&&Ve[1]<wr.max[1]&&Ve[2]*kt<wr.max[2]&&Li.footprint&&p.bS(Dn,Li.footprint)?Math.max(ni.cameraCollisionOpacity-ao,0):Math.min(1,ni.cameraCollisionOpacity+ao)}const Ho=[...Ci],vo=Li.anchor?Li.anchor[0]:0,so=Li.anchor?Li.anchor[1]:0;p.bo(Ho,Ho,[vo*(oo[0]-1),so*(oo[1]-1),qi]),p.ci(oo,p.eh)||p.cE(Ho,Ho,oo);const ai=p.az([],Ho,Li.matrix),Hr=p.az([],Ie.expandedFarZProjMatrix,ai),Vi=p.az([],Ie.expandedFarZProjMatrix,Ho),Xr=p.aA([],[vo,so,qi,1],Hr)[2];Li.hidden=!1;let ir=Pt;xt||(wt&&(ir*=ni.cameraCollisionOpacity,ir*=Up(Ho,Ie,ni.aabb,Ot)),ir*=Db(It,Xr)),0!==ir?fo.push({nodeInfo:ni,depth:Xr,opacity:ir,wvpForNode:Hr,wvpForTile:Vi,nodeModelMatrix:ai,tileModelMatrix:Ho}):Li.hidden=!0}xt||fo.sort((ni,Li)=>!wt||1===ni.opacity&&1===Li.opacity?ni.depth<Li.depth?-1:1:1===ni.opacity?-1:1===Li.opacity?1:ni.depth>Li.depth?-1:1);for(const ni of fo){const Li=ni.nodeInfo,qi=Li.node;let wr=p.az([],vt,ni.tileModelMatrix);p.az(wr,Ye,wr);const oo=p.bi([],wr);p.ee(oo,oo),p.cE(oo,oo,Yi),wr=p.az(wr,wr,qi.matrix);const Ho="light-beam"===le.renderPass,vo="none"===Me.paint.get("model-color-use-theme").constantOr("default"),so=Lo&p.em.HasMapboxMeshFeatures,ai=so?0:Li.evaluatedRMEA[0][2];for(let Hr=0;Hr<qi.meshes.length;++Hr){const Vi=qi.meshes[Hr],Xr=Hr===qi.lightMeshIndex;let ir=ni.wvpForNode;if(Xr){if(!Ho&&!le.terrain&&le.shadowRenderer){le.currentLayer<le.firstLightBeamLayer&&(le.firstLightBeamLayer=le.currentLayer);continue}ir=ni.wvpForTile}else if(Ho)continue;const ao={defines:[]},us=[];if(!xt&&Te&&(Te.useNormalOffset=!!Vi.normalBuffer),Ut(ao.defines,us,Vi,le,vo?null:Me.lut),so||ao.defines.push("DIFFUSE_SHADED"),hr&&ao.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(xt?Lt.numRenderedVerticesInShadowPass+=Vi.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=Vi.vertexArray.length),xt){jo(Vi,ni.nodeModelMatrix,le,Me);continue}let kr=null;if(Oe){const Ec=ip(ni.nodeModelMatrix,le.transform);if(kr=new Float32Array(Ec),"globe"!==Ie.projection.name){const vd=Vi.aabb.min,fh=Vi.aabb.max,[Qc,bd]=Oe.getOpacityForBounds(Ec,vd[0],vd[1],fh[0],fh[1]);ao.overrideFog=Qc>=jt||bd>=jt}}const Oa=Vi.material;let ps;Oa.occlusionTexture&&Oa.occlusionTexture.offsetScale&&(ps=Oa.occlusionTexture.offsetScale,ao.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ra=le.getOrCreateProgram("model",ao);!xt&&Te&&Te.setupShadowsFromMatrix(ni.tileModelMatrix,Ra,Te.useNormalOffset),le.uploadCommonUniforms(Le,Ra,null,kr);const Wd=Oa.pbrMetallicRoughness;Wd.metallicFactor=.9,Wd.roughnessFactor=.5;const wu=Rh(new Float32Array(ir),new Float32Array(wr),new Float32Array(oo),new Float32Array(qi.matrix),le,ni.opacity,Wd.baseColorFactor.toRenderColor(null),Oa.emissiveFactor,Wd.metallicFactor,Wd.roughnessFactor,Oa,ai,Me,[0,0,0],ps);!Xr&&(Li.hasTranslucentParts||ni.opacity<1)&&Ra.draw(le,Le.gl.TRIANGLES,Je,kn.disabled,Yn.disabled,Ln.backCCW,wu,Me.id,Vi.vertexBuffer,Vi.indexBuffer,Vi.segments,Me.paint,le.transform.zoom,void 0,us),Ra.draw(le,Le.gl.TRIANGLES,Xr?ot:Je,kn.disabled,Xr||ni.opacity<1||Li.hasTranslucentParts?Yn.alphaBlended:Yn.unblended,Ln.backCCW,wu,Me.id,Vi.vertexBuffer,Vi.indexBuffer,Vi.segments,Me.paint,le.transform.zoom,void 0,us)}}}}()}(g,a,h,_),void O();if("model"!==V.type)return;const U=V.getModels(),X=[],G=g.transform.getFreeCameraOptions().position,Q=p.b$([],[G.x,G.y,G.z],g.transform.worldSize);p.eb(Q,Q);const se=[],oe=[];let de=0;for(const le of U){const be=h.paint.get("model-rotation").constantOr(null),Me=h.paint.get("model-scale").constantOr(null),De=h.paint.get("model-translation").constantOr(null);le.computeModelMatrix(g,be,Me,De,!0,!0,!1);const Le=p.bx([]),Ie=p.ec(le.position.lat,g.transform.zoom),Oe=p.bn([],[1,1,1/Ie]);p.bo(Le,Le,Q),X.push({zScaleMatrix:Oe,negCameraPosMatrix:Le});for(const Te of le.nodes)yu(g.transform,Te,le.matrix,g.transform.expandedFarZProjMatrix,de,se,oe);de++}if(se.sort((le,be)=>be.depth-le.depth),"shadow"!==g.renderPass){if(1===w)for(const le of oe)nn(le,g,h,X[le.modelIndex],kn.disabled,g.colorModeForRenderPass());else{for(const le of oe)nn(le,g,h,X[le.modelIndex],kn.disabled,Yn.disabled);for(const le of oe)nn(le,g,h,X[le.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const le of se)nn(le,g,h,X[le.modelIndex],kn.disabled,g.colorModeForRenderPass());O()}else{for(const le of oe)jo(le.mesh,le.nodeModelMatrix,g,h);for(const le of se)jo(le.mesh,le.nodeModelMatrix,g,h);O()}}},tm={line:function(g,a,h){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,void 0!==g._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==g._unevaluatedLayout.getValue("line-z-offset")){if(a){const _=a.getVisibleCoordinates();for(const w of _){const M=a.getTile(w).getBucket(g);if(M&&("none"!==M.elevationType?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,a,h){const _=a.getSource();if(!_.loaded())return;if("vector"===_.type||"geojson"===_.type)return void(h.modelManager&&h.modelManager.upload(h,"vector"===_.type?g.scope:""));if("batched-model"===_.type||"model"!==_.type)return;const w=_.getModels();for(const M of w)M.upload(h.context)},raster:function(g,a,h){const _=a.getSource();if(!(_ instanceof yo&&_.loaded()))return;const w=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!w)return;const M=g.paint.get("raster-array-band")||_.getInitialBand(w);if(null==M)return;const S=a.getIds().map(P=>a.getTileByID(P));for(const P of S)P.updateNeeded(w,M)&&_.prepareTile(P,w,M)},"raster-particle":function(g,a,h){const _=a.getSource();if(!(_ instanceof yo&&_.loaded()))return;const w=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!w)return;const M=g.paint.get("raster-particle-array-band")||_.getInitialBand(w);if(null==M)return;const S=a.getIds().map(P=>a.getTileByID(P));for(const P of S)P.updateNeeded(w,M)&&_.prepareTile(P,w,M)}},Gd={fill:Ju};class zg{constructor(a,h,_,w,M){this.context=new Qu(a,h),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=M,this._timeStamp=p.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const O of S)this._debugParams.enabledLayers[O]=!0;M.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),M.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),M.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),M.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of S)M.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new w0(M),this.setup(),this.numSublayers=Es.maxUnderzooming+Es.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new p.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Er(this),this._wireframeDebugCache=new Ab,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new p.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new p.T(this.context,P,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w}updateTerrain(a,h){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new a0(this,a));const w=this._terrain;this.transform.elevation=_?w:null,w.update(a,this.transform,h),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(a){const h=a.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const M=_+.78*(w-_);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new a0(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,h){if(this.width=a*p.q.devicePixelRatio,this.height=h*p.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const a=this.context,h=new p.ba;h.emplaceBack(0,0),h.emplaceBack(p.aj,0),h.emplaceBack(0,p.aj),h.emplaceBack(p.aj,p.aj),this.tileExtentBuffer=a.createVertexBuffer(h,p.bc.members),this.tileExtentSegments=p.bd.simpleSegment(0,0,4,2);const _=new p.ba;_.emplaceBack(0,0),_.emplaceBack(p.aj,0),_.emplaceBack(0,p.aj),_.emplaceBack(p.aj,p.aj),this.debugBuffer=a.createVertexBuffer(_,p.bc.members),this.debugSegments=p.bd.simpleSegment(0,0,4,5);const w=new p.ba;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(w,p.bc.members),this.viewportSegments=p.bd.simpleSegment(0,0,4,2);const M=new p.aZ;M.emplaceBack(0,0,0,0),M.emplaceBack(p.aj,0,p.aj,0),M.emplaceBack(0,p.aj,0,p.aj),M.emplaceBack(p.aj,p.aj,p.aj,p.aj),this.mercatorBoundsBuffer=a.createVertexBuffer(M,p.bf.members),this.mercatorBoundsSegments=p.bd.simpleSegment(0,0,4,2);const S=new p.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(S);const P=new p.bb;for(const V of[0,1,3,2,0])P.emplaceBack(V);this.debugIndexBuffer=a.createIndexBuffer(P),this.emptyTexture=new p.T(a,new p.r({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=p.bz();const O=this.context.gl;this.stencilClearMode=new kn({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,rn.disabled,this.stencilClearMode,Yn.disabled,Ln.disabled,il(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,_){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const O of _)if(void 0===this._tileClippingMaskIDs[O.key]){P=!0;break}if(!P)return}this.currentStencilSource=h.id;const w=this.context,M=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(Yn.disabled),w.setDepthMode(rn.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of _){const O=h.getTile(P),V=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:X,tileBoundsSegments:G}=this.getTileBoundsBuffers(O);S.draw(this,M.TRIANGLES,rn.disabled,new kn({func:M.ALWAYS,mask:0},V,255,M.KEEP,M.KEEP,M.REPLACE),Yn.disabled,Ln.disabled,il(P.projMatrix),"$clipping",U,X,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new kn({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new kn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,_=a.sort((S,P)=>P.overscaledZ-S.overscaledZ),w=_[_.length-1].overscaledZ,M=_[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const S={};for(let P=0;P<M;P++)S[P+w]=new kn({func:h.GEQUAL,mask:255},P+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[S,_]}return[{[w]:kn.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Yn([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new p.am(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Yn.unblended:Yn.alphaBlended}colorModeForDrapableLayerRenderPass(a){const h=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Yn([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new p.am(0,0,0,void 0===a?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,h,_,w=!1){if(this.depthOcclusion)return new rn(this.context.gl.GREATER,rn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return rn.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new rn(_||this.context.gl.LEQUAL,h,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,h=Math.ceil(this.width),_=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),M=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==h&&0!==_&&(this.depthFBO=new Lh(this.context,h,_,!1,"texture"),this.depthTexture=new p.T(this.context,{width:h,height:_,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),a.bindTexture(a.TEXTURE_2D,M),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,h,_,0,0,h,_,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,h)=>a+h/this._fpsHistory.length,0))}render(a,h){const _=p.q.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=h;const w=this.style._mergedLayers,M=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(M).filter(Je=>{const ot=w[Je];return!(ot.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ot.type]});let P=S(),O=!1,V=!1;for(const Je of P){const ot=w[Je];"circle"===ot.type&&(O=!0),"symbol"===ot.type&&(ot.hasInitialOcclusionOpacityProperties?V=!0:O=!0)}let U=P.map(Je=>w[Je]);const X=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(p.q.now()),this.imageManager.beginFrame();let G=0,Q=!1;for(const Je in X){const ot=X[Je];ot.used&&(ot.prepare(this.context),ot.getSource().usedInConflation&&++G)}let se=!1;for(const Je of U)Je.isHidden(this.transform.zoom)||("clip"===Je.type&&(se=!0),this.prepareLayer(Je));const oe={},de={},le={},be={},Me={};for(const Je in X){const ot=X[Je];oe[Je]=ot.getVisibleCoordinates(),de[Je]=oe[Je].slice().reverse(),le[Je]=ot.getVisibleCoordinates(!0).reverse(),be[Je]=ot.getShadowCasterCoordinates(),Me[Je]=ot.sortCoordinatesByDistance(oe[Je])}const De=Je=>{const ot=this.style.getLayerSourceCache(Je);return ot&&ot.used?ot.getSource():null};if(G||se||this._clippingActiveLastFrame){const Je=[],ot=[];let Ke=0;for(const xt of U)this.isSourceForClippingOrConflation(xt,De(xt))&&(Je.push(xt),ot.push(Ke)),Ke++;if(Je&&(se||Je.length>1)||this._clippingActiveLastFrame){se=!1;const xt=[];for(let dt=0;dt<Je.length;dt++){const Ot=Je[dt],wt=ot[dt],It=this.style.getLayerSourceCache(Ot);if(!It||!It.used||!It.getSource().usedInConflation&&"clip"!==Ot.type)continue;let Lt=p.ev,fn=p.bQ.None;const bn=[];let dn=!0;if("clip"===Ot.type){Lt=wt;for(const an of Ot.layout.get("clip-layer-types"))fn|="model"===an?p.bQ.Model:"symbol"===an?p.bQ.Symbol:p.bQ.FillExtrusion;for(const an of Ot.layout.get("clip-layer-scope"))bn.push(an);Ot.isHidden(this.transform.zoom)?dn=!1:se=!0}dn&&xt.push({layer:Ot.fqid,cache:It,order:Lt,clipMask:fn,clipScope:bn})}this.replacementSource.setSources(xt),Q=!0}}this._clippingActiveLastFrame=se,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Je=0;Je<U.length;Je++){const ot=U[Je],Ke=ot.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){const xt=De(ot);xt&&(this.minCutoffZoom=Math.max(xt.minzoom,this.minCutoffZoom)),ot.minzoom&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom))}ot.is3D(M)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Je),this._lastOcclusionLayer=Je)}const Le=this.style&&this.style.fog;Le?(this._fogVisible=0!==Le.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=Le.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(le),this.opaquePassCutoff=0,P=S(),U=P.map(Je=>w[Je]));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const Je in X)for(const ot of oe[Je]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(ot)||Ke),Ie.addShadowReceiver(ot.toUnwrapped(),Ke.min,Ke.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Hp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Oe&&!this._snow&&(this._snow=new Fr(this)),!Oe&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new Ml(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!zi.has(this.context.gl))return;this.renderPass="offscreen";for(const Je of U){const ot=a.getLayerSourceCache(Je);if(!Je.hasOffscreenPass()||Je.isHidden(this.transform.zoom))continue;const Ke=ot?de[ot.id]:void 0;("custom"===Je.type||"raster"===Je.type||"raster-particle"===Je.type||Je.isSky()||Ke&&Ke.length)&&this.renderLayer(this,ot,Je,Ke)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,be)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Be="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Ve=(()=>{if(h.showOverdrawInspector)return p.am.black;const Je=this.style.fog;if(Je&&this.transform.projection.supportsFog){const ot=this.style.getLut(Je.scope);if(!Be){const Ke="none"===Je.properties.get("color-use-theme"),xt=Je.properties.get("color").toRenderColor(Ke?null:ot).toArray01();return new p.am(...xt)}if(Be){const Ke="none"===Je.properties.get("space-color-use-theme"),xt=Je.properties.get("space-color").toRenderColor(Ke?null:ot).toArray01();return new p.am(...xt)}}return p.am.transparent})();if(this.context.clear({color:Ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const Je=U[this.currentLayer],ot=a.getLayerSourceCache(Je);if(Je.isSky())continue;const Ke=ot?(Je.is3D(M)?Me:de)[ot.id]:void 0;this._renderTileClippingMasks(Je,ot,Ke),this.renderLayer(this,ot,Je,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||p.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Je=U[this.currentLayer],ot=a.getLayerSourceCache(Je);Je.isSky()&&this.renderLayer(this,ot,Je,ot?de[ot.id]:void 0)}function ct(Je,ot){let Ke;return ot&&(Ke=("symbol"===Je.type?le:Je.is3D(M)?Me:de)[ot.id]),Ke}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const Je=U[this.currentLayer];if("raster"===Je.type||"raster-particle"===Je.type){const ot=a.getLayerSourceCache(Je);this.renderLayer(this,ot,Je,ct(Je,ot))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ye=0;Ie&&(Ye=Ie.getShadowCastingLayerCount());let kt=!1,vt=-1;for(let Je=0;Je<P.length;++Je){const ot=U[Je];ot.isHidden(this.transform.zoom)||ot.is3D(M)&&(vt=Je)}V&&-1===vt&&(O=!0);let Pt=!1;for(;this.currentLayer<P.length;){const Je=U[this.currentLayer],ot=a.getLayerSourceCache(Je);if(Je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Je)){if(Je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&Je.is3D(M)&&!M){const Ke=this.currentLayer,xt=dt=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Ot=U[this.currentLayer];if(Gd[Ot.type]){const wt=this.style.getLayerSourceCache(Ot);Gd[Ot.type](this,wt,Ot,ct(Ot,wt),dt)}}};xt("initialize"),xt("reset"),this.currentLayer=Ke,Pt=!0}if(O&&!kt&&this.terrain&&!this.transform.isOrthographic&&(kt=!0,this.blitDepth()),V&&-1!==vt&&this.currentLayer===vt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Je,ot,ot?oe[ot.id]:void 0),this.renderLayer(this,ot,Je,ct(Je,ot)),!this.terrain&&Ie&&Ye>0&&Je.hasShadowPass()&&0==--Ye&&(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){const xt=U[this.currentLayer];if(!xt.hasLightBeamPass())continue;const dt=a.getLayerSourceCache(xt);this.renderLayer(this,dt,xt,dt?de[dt.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ke=this.currentLayer;this.depthOcclusion=!0;for(const xt of this.layersWithOcclusionOpacity){this.currentLayer=xt;const dt=U[this.currentLayer],Ot=a.getLayerSourceCache(dt),wt=Ot?de[Ot.id]:void 0;this.terrain||this._renderTileClippingMasks(dt,Ot,Ot?oe[Ot.id]:void 0),this.renderLayer(this,Ot,dt,wt)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Je=null;U.forEach(ot=>{const Ke=a.getLayerSourceCache(ot);Ke&&!ot.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!Je||Je.getSource().maxzoom<Ke.getSource().maxzoom)&&(Je=Ke)}),Je&&this.options.showTileBoundaries&&Ei.debug(this,Je,Je.getVisibleCoordinates(),p.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ei.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new p.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Je){const ot=Je.transform.padding;Rg(Je,Je.transform.height-(ot.top||0),3,_0),Rg(Je,ot.bottom||0,3,y0),Zc(Je,ot.left||0,3,Og),Zc(Je,Je.transform.width-(ot.right||0),3,ic);const Ke=Je.transform.centerPoint;var xt,dt,Ot,wt;tp(xt=Je,(dt=Ke.x)-1,(Ot=Je.transform.height-Ke.y)-10,2,20,wt=gu),tp(xt,dt-10,Ot-1,20,2,wt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:h}=this.transform.projection,_=!h||!h.includes(a.type);if(tm[a.type]&&(_||this.terrain&&"custom"===a.type)){const w=this.style.getLayerSourceCache(a);tm[a.type](a,w,this)}this.gpuTimingEnd()}renderLayer(a,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||"model"===_.type||"raster"===_.type||"raster-particle"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)&&(!a.terrain||"custom"!==_.type)||"clip"===_.type||Ei[_.type](a,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,_=this.context.gl;let w=this.gpuTimers[a.id];w||(w=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:_.createQuery()}),w.calls++,_.beginQuery(h.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=this.context.gl,_=h.createQuery();this.deferredRenderGpuTimeQueries.push(_),h.beginQuery(a.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const _ in a){const w=a[_],M=this.context.extTimerQuery,S=M.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(w.query),h[_]=S}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let _=0;for(const w of a)_+=h.getQueryParameter(w,h.QUERY_RESULT)/1e6,h.deleteQuery(w);return _}translatePosMatrix(a,h,_,w,M){if(!_[0]&&!_[1])return a;const S=M?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(S){const V=Math.sin(S),U=Math.cos(S);_=[_[0]*U-_[1]*V,_[0]*V+_[1]*U]}const P=[M?_[0]:p.aw(h,_[0],this.transform.zoom),M?_[1]:p.aw(h,_[1],this.transform.zoom),0],O=new Float32Array(16);return p.bo(O,a,P),O}saveTileTexture(a){const h=a.size[0],_=this._tileTextures[h];_?_.push(a):this._tileTextures[h]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(a,h,_){const w=void 0===_?this.terrain&&this.terrain.renderingToTexture:_,M=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===a||"terrainRaster"===a?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||M.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&M.push("GLOBE"),!this._fogVisible||w||void 0!==h&&!h||M.push("FOG","FOG_DITHERING"),w&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(a,h){this.cache=this.cache||{};const _=h&&h.defines||[],w=h&&h.config,M=this.currentGlobalDefines(a,h&&h.overrideFog,h&&h.overrideRtt).concat(_),S=c0.cacheKey(Ul[a],a,M,w);return this.cache[S]||(this.cache[S]=new c0(this.context,a,Ul[a],w,Dy[a],M)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,h){if(this.style.enable3dLights()){const _=this.style.directionalLight,w=this.style.ambientLight;if(_&&w){const M=((S,P,O)=>{const V=S.properties.get("direction"),U="none"===S.properties.get("color-use-theme"),X=S.properties.get("color").toRenderColor(U?null:O.getLut(S.scope)).toArray01(),G=S.properties.get("intensity"),Q="none"===P.properties.get("color-use-theme"),se=P.properties.get("color").toRenderColor(Q?null:O.getLut(P.scope)).toArray01(),oe=P.properties.get("intensity"),de=[V.x,V.y,V.z],le=p.dw(se,oe),be=p.dw(X,G);return{u_lighting_ambient_color:le,u_lighting_directional_dir:de,u_lighting_directional_color:be,u_ground_radiance:l0(de,be,le)}})(_,w,this.style);h.setLightsUniformValues(a,M)}}}uploadCommonUniforms(a,h,_,w,M){if(this.uploadCommonLightUniforms(a,h),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const P=S.getOpacity(this.transform.pitch),O=((V,U,X,G,Q,se,oe,de,le,be,Me,De)=>{const Le=V.transform,Ie="none"===U.properties.get("color-use-theme"),Oe=U.properties.get("color").toRenderColor(Ie?null:V.style.getLut(U.scope)).toArray01();Oe[3]=G;const Te=V.frameCounter/1e3%1,[Be,Ve]=U.properties.get("vertical-range");return{u_fog_matrix:X?Le.calculateFogTileMatrix(X):De||V.identityMat,u_fog_range:U.getFovAdjustedRange(Le._fov),u_fog_color:Oe,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Be,Ve),Ve],u_fog_temporal_offset:Te,u_frustum_tl:Q,u_frustum_tr:se,u_frustum_br:oe,u_frustum_bl:de,u_globe_pos:le,u_globe_radius:be,u_viewport:Me,u_globe_transition:p.ah(Le.zoom),u_is_globe:+("globe"===Le.projection.name)}})(this,S,_,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.q.devicePixelRatio,this.transform.height*p.q.devicePixelRatio],w);h.setFogUniformValues(a,O)}M&&h.setCutoffUniformValues(a,M.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=a[w.key]||new Qa(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,h){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==a.type&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==a.sourceLayer)&&(!h||"batched-model"!==h.type)))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let h=this._cachedTileFogOpacities[a.key];return h||(this._cachedTileFogOpacities[a.key]=h=this.style.fog.getOpacityForTile(a)),h[0]>=jt||h[1]>=jt}setupDepthForOcclusion(a,h,_){const w=this.context,M=w.gl,S=!!_;var P;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(M.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),w.activeTexture.set(M.TEXTURE0),S||h.setTerrainUniformValues(w,_)}}function $p(g,a){let h=!1,_=null;const w=()=>{_=null,h&&(g(),_=setTimeout(w,a),h=!1)};return()=>(h=!0,_||w(),_)}class rp{constructor(a){this._hashName=a&&encodeURIComponent(a),p.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$p(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=sl(a);if(this._hashName){const _=this._hashName;let w=!1;const M=location.hash.slice(1).split("&").map(S=>{const P=S.split("=")[0];return P===_?(w=!0,`${P}=${h}`):S}).filter(S=>S);return w||M.push(`${_}=${h}`),`#${M.join("&")}`}return`#${h}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(Number(_)))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function sl(g,a){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,w),S=Math.round(h.lng*M)/M,P=Math.round(h.lat*M)/M,O=g.getBearing(),V=g.getPitch();let U=a?`/${S}/${P}/${_}`:`${_}/${P}/${S}`;return(O||V)&&(U+="/"+Math.round(10*O)/10),V&&(U+=`/${Math.round(V)}`),U}const Cc={linearity:.3,easing:p.ew(0,0,.3,1)},Ng=p.l({deceleration:2500,maxSpeed:1400},Cc),vu=p.l({deceleration:20,maxSpeed:1400},Cc),al=p.l({deceleration:1e3,maxSpeed:360},Cc),Vh=p.l({deceleration:1e3,maxSpeed:90},Cc);class nm{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.q.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=p.q.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)h.zoom+=M.zoomDelta||0,h.bearing+=M.bearingDelta||0,h.pitch+=M.pitchDelta||0,M.panDelta&&h.pan._add(M.panDelta),M.around&&(h.around=M.around),M.pinchAround&&(h.pinchAround=M.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const M=Gp(h.pan.mag(),_,p.l({},Ng,a||{}));w.offset=h.pan.mult(M.amount/h.pan.mag()),w.center=this._map.transform.center,op(w,M)}if(h.zoom){const M=Gp(h.zoom,_,vu);w.zoom=this._map.transform.zoom+M.amount,op(w,M)}if(h.bearing){const M=Gp(h.bearing,_,al);w.bearing=this._map.transform.bearing+p.aD(M.amount,-179,179),op(w,M)}if(h.pitch){const M=Gp(h.pitch,_,Vh);w.pitch=this._map.transform.pitch+M.amount,op(w,M)}if(w.zoom||w.bearing){const M=void 0===h.pinchAround?h.around:h.pinchAround;w.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function op(g,a){(!g.duration||g.duration<a.duration)&&(g.duration=a.duration,g.easing=a.easing)}function Gp(g,a,h){const{maxSpeed:_,linearity:w,deceleration:M}=h,S=p.aD(g*w/(a/1e3),-_,_),P=Math.abs(S)/(M*w);return{easing:h.easing,duration:1e3*P,amount:S*(P/2)}}class Cl extends p.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,w={}){const M=Il(h.getCanvasContainer(),_),S=h.unproject(M);super(a,p.l({point:M,lngLat:S,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class gd extends p.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){const w="touchend"===a?_.changedTouches:_.touches,M=Xa(h.getCanvasContainer(),w),S=M.map(O=>h.unproject(O)),P=M.reduce((O,V,U,X)=>O.add(V.div(X.length)),new p.P(0,0));super(a,{points:M,point:P,lngLats:S,lngLat:h.unproject(P),originalEvent:_}),this._defaultPrevented=!1}}class Bg extends p.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class ch{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Bg(this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Cl(a.type,this._map,a))}mouseup(a){this._map.fire(new Cl(a.type,this._map,a))}preclick(a){const h=p.l({},a);h.type="preclick",this._map.fire(new Cl(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Cl(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Cl(a.type,this._map,a))}mouseover(a){this._map.fire(new Cl(a.type,this._map,a))}mouseout(a){this._map.fire(new Cl(a.type,this._map,a))}touchstart(a){return this._firePreventable(new gd(a.type,this._map,a))}touchmove(a){this._map.fire(new gd(a.type,this._map,a))}touchend(a){this._map.fire(new gd(a.type,this._map,a))}touchcancel(a){this._map.fire(new gd(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class C0{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Cl(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Cl(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class im{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&0===a.button&&(Uo(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const _=h,w=this._startPos,M=this._lastPos;if(!w||!M||M.equals(_)||!this._box&&_.dist(w)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Gn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const S=Math.min(w.x,_.x),P=Math.max(w.x,_.x),O=Math.min(w.y,_.y),V=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${O}px)`,this._box.style.width=P-S+"px",this._box.style.height=V-O+"px")})}mouseupWindow(a,h){if(!this._active)return;const _=this._startPos,w=h;if(_&&0===a.button){if(this.reset(),xa(),_.x!==w.x||_.y!==w.y)return this._map.fire(new p.A("boxzoomend",{originalEvent:a})),{cameraAnimation:M=>M.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ya(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new p.A(a,{originalEvent:h}))}}function sp(g,a){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=a[_];return h}class Vg{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const M=new p.P(0,0);for(const S of w)M._add(S);return M.div(w.length)}(h),this.touches=sp(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;const w=sp(_,h);for(const M in this.touches){const S=w[M];(!S||S.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Qs{constructor(a){this.singleTap=new Vg(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){const w=this.singleTap.touchend(a,h,_);if(w){const M=a.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(w)<30;if(M&&S||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class jg{constructor(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){const w=this._zoomIn.touchend(a,h,_),M=this._zoomOut.touchend(a,h,_);return w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(w)},{originalEvent:a})}):M?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(M)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hg={0:1,2:2},dh={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class rm{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const _=zc(a);this._correctButton(a,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(a,h){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(w,M){const S=Hg[M];return void 0===w.buttons||(w.buttons&S)!==S}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(a){this._lastPoint&&zc(a)===this._eventButton&&(this._moved&&xa(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class S0 extends rm{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return 0===h&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class ll extends rm{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?dh[a.pitchRotateKey]:void 0}_correctButton(a,h){return this._pitchRotateKey?0===h&&a[this._pitchRotateKey]:0===h&&a.ctrlKey||2===h}_move(a,h){const _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class Xc extends rm{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?dh[a.pitchRotateKey]:void 0}_correctButton(a,h){return this._pitchRotateKey?0===h&&a[this._pitchRotateKey]:0===h&&a.ctrlKey||2===h}_move(a,h){const _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class bs{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.P(0,0)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.ex())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,_)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);const w=sp(_,h),M=new p.P(0,0),S=new p.P(0,0);let P=0;for(const V in w){const U=w[V],X=this._touches[V];X&&(M._add(U),S._add(U.sub(X)),P++,w[V]=U)}if(this._touches=w,P<this._minTouches||!S.mag())return;const O=S.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(P),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Gn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ao{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,_){return{}}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){const w=this._firstTwoTouches;if(!w)return;a.preventDefault();const[M,S]=w,P=Wp(_,h,M),O=Wp(_,h,S);if(!P||!O)return;const V=this._aroundCenter?null:P.add(O).div(2);return this._move([P,O],V,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;const[w,M]=this._firstTwoTouches,S=Wp(_,h,w),P=Wp(_,h,M);S&&P||(this._active&&xa(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wp(g,a,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return a[_]}function Ns(g,a){return Math.log(g/a)/Math.LN2}class E0 extends Ao{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Ns(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ns(this._distance,_),pinchAround:h}}}function om(g,a){return 180*g.angleWith(a)/Math.PI}class D0 extends Ao{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:om(this._vector,_),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const w=om(a,_);return Math.abs(w)<h}}function ap(g){return Math.abs(g.y)>Math.abs(g.x)}class jh extends Ao{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,ap(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){const w=this._lastPoints;if(!w)return;const M=a[0].sub(w[0]),S=a[1].sub(w[1]);return this._map._cooperativeGestures&&!p.ex()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(M,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(M.y+S.y)/2*-.5})}gestureBeginsVertically(a,h,_){if(void 0!==this._valid)return this._valid;const w=a.mag()>=2,M=h.mag()>=2;if(!w&&!M)return;if(!w||!M)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=a.y>0==h.y>0;return ap(a)&&ap(h)&&S}}const Iy={panStep:100,bearingStep:15,pitchStep:10};class sm{constructor(){const a=Iy;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,w=0,M=0,S=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),M=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),M=1);break;case 38:a.shiftKey?w=1:(a.preventDefault(),S=-1);break;case 40:a.shiftKey?w=-1:(a.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:P=>{const O=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:am,zoom:h?Math.round(O)+h*(a.shiftKey?2:1):O,bearing:P.getBearing()+_*this._bearingStep,pitch:P.getPitch()+w*this._pitchStep,offset:[-M*this._panStep,-S*this._panStep],center:P.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function am(g){return g*(2-g)}const Zp=4.000244140625;class T0{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||p.ex()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=p.q.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Zp==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Il(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const V="wheel"===this._type&&Math.abs(this._delta)>Zp?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&0!==U&&(U=1/U);const X=h(),G=Math.pow(2,X),Q="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Q*U))),"wheel"===this._type&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,M=this._easing;let S,P=!1;if("wheel"===this._type&&w&&M){const V=Math.min((p.q.now()-this._lastWheelEventTime)/200,1),U=M(V);S=p.ai(w,_,U),V<1?this._frameId||(this._frameId=!0):P=!0}else S=_,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=S-h();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=p.ey;if(this._prevEase){const _=this._prevEase,w=(p.q.now()-_.start)/_.duration,M=_.easing(w+.01)-_.easing(w),S=.27/Math.sqrt(M*M+1e-4)*.01,P=Math.sqrt(.0729-S*S);h=p.ew(S,P,.25,1)}return this._prevEase={start:p.q.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Gn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class A0{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Oy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lp{constructor(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,h,_))}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],M=w.y-this._swipePoint.y;return this._swipePoint=w,a.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,h,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yp{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pb{constructor(a,h,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class kM{constructor(a,h,_,w){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ro=g=>g.zoom||g.drag||g.pitch||g.rotate;class Ib extends p.A{}class Ob{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const _=p.at([],h,a);this.radius=p.ae(_[2]<0?p.eA([],_,this.constants):[_[0],_[1],0])}projectRay(a){p.eA(a,a,this.constants),p.au(a,a),p.eB(a,a,this.constants);const h=p.b$([],a,this.radius);if(h[2]>0){const _=p.b$([],[0,0,1],p.bE(h,[0,0,1])),w=p.b$([],p.au([],[h[0],h[1],0]),this.radius),M=p.cU([],h,p.b$([],p.at([],p.cU([],w,_),h),2));h[0]=M[0],h[1]=M[1]}return h}}function Xp(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class MM{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nm(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ob,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.aV(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,M,S]of this._listeners){const P=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(M,P,S)}}destroy(){for(const[a,h,_]of this._listeners){const w=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(h,w,_)}}_addDefaultHandlers(a){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new ch(h,a));const w=h.boxZoom=new im(h,a);this._add("boxZoom",w);const M=new jg,S=new Oy;h.doubleClickZoom=new A0(S,M),this._add("tapZoom",M),this._add("clickZoom",S);const P=new lp;this._add("tapDragZoom",P);const O=h.touchPitch=new jh(h);this._add("touchPitch",O);const V=new ll(a),U=new Xc(a);h.dragRotate=new Pb(a,V,U),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const X=new S0(a),G=new bs(h,a);h.dragPan=new Yp(_,X,G),this._add("mousePan",X),this._add("touchPan",G,["touchZoom","touchRotate"]);const Q=new D0,se=new E0;h.touchZoomRotate=new kM(_,se,Q,P),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new C0(h));const oe=h.scrollZoom=new T0(h,this);this._add("scrollZoom",oe,["mousePan"]);const de=h.keyboard=new sm;this._add("keyboard",de);for(const le of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[le]&&h[le].enable(a[le])}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ro(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,_){for(const w in a)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const _ of a)this._el.contains(_.target)&&h.push(_);return h}handleEvent(a,h){this._updatingCamera=!0;const _="renderFrame"===a.type,w=_?void 0:a,M={needsRenderFrame:!1},S={},P={},O=a.touches?this._getMapTouches(a.touches):void 0,V=O?Xa(this._el,O):_?void 0:Il(this._el,a);for(const{handlerName:G,handler:Q,allowed:se}of this._handlers){if(!Q.isEnabled())continue;let oe;this._blockedByActive(P,se,G)?Q.reset():Q[h||a.type]&&(oe=Q[h||a.type](a,V,O),this.mergeHandlerResult(M,S,oe,G,w),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||Q.isActive())&&(P[G]=Q)}const U={};for(const G in this._previousActiveHandlers)P[G]||(U[G]=w);this._previousActiveHandlers=P,(Object.keys(U).length||Xp(M))&&(this._changes.push([M,S,U]),this._triggerRenderFrame()),(Object.keys(P).length||Xp(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=M;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(a,h,_,w,M){if(!_)return;p.l(a,_);const S={handlerName:w,originalEvent:_.originalEvent||M};void 0!==_.zoomDelta&&(h.zoom=S),void 0!==_.panDelta&&(h.drag=S),void 0!==_.pitchDelta&&(h.pitch=S),void 0!==_.bearingDelta&&(h.rotate=S)}_applyChanges(){const a={},h={},_={};for(const[w,M,S]of this._changes)w.panDelta&&(a.panDelta=(a.panDelta||new p.P(0,0))._add(w.panDelta)),w.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(a.around=w.around),void 0!==w.aroundCoord&&(a.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(a.pinchAround=w.pinchAround),w.noInertia&&(a.noInertia=w.noInertia),p.l(h,M),p.l(_,S);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){const w=this._map,M=w.transform,S=be=>[be.x,be.y,be.z];if((be=>{const Me=this._eventsInProgress.drag;return Me&&!this._handlersById[Me.handlerName].isActive()})()&&!Xp(a)){const be=M.zoom;M.cameraElevationReference="sea",null!=this._originalZoom&&M._orthographicProjectionAtLowPitch&&"globe"!==M.projection.name&&0===M.pitch?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),be!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&w._stop(!0),!Xp(a))return void this._fireEvents(h,_,!0);let{panDelta:P,zoomDelta:O,bearingDelta:V,pitchDelta:U,around:X,aroundCoord:G,pinchAround:Q}=a;M._isCameraConstrained&&(O>0&&(O=0),M._isCameraConstrained=!1),void 0!==Q&&(X=Q),(O||(be=>h.drag&&!this._eventsInProgress.drag)())&&X&&(this._dragOrigin=S(M.pointCoordinate3D(X)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",w._stop(!0),X=X||w.transform.centerPoint,V&&(M.bearing+=V),U&&(M.pitch+=U),M._updateCameraState();const se=[0,0,0];if(P)if("mercator"===M.projection.name){const be=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(X).dir),Me=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(X.sub(P)).dir);se[0]=Me[0]-be[0],se[1]=Me[1]-be[1]}else{const be=M.pointCoordinate(X);if("globe"===M.projection.name){P=P.rotate(-M.angle);const Me=M._pixelsPerMercatorPixel/M.worldSize;se[0]=-P.x*p.ez(p.aY(be.y))*Me,se[1]=-P.y*p.ez(M.center.lat)*Me}else{const Me=M.pointCoordinate(X.sub(P));be&&Me&&(se[0]=Me.x-be.x,se[1]=Me.y-be.y)}}const oe=M.zoom,de=[0,0,0];if(O){const be=S(G||M.pointCoordinate3D(X)),Me={dir:p.au([],p.at([],be,M._camera.position))};if(Me.dir[2]<0){const De=M.zoomDeltaToMovement(be,O);p.b$(de,Me.dir,De)}}const le=p.cU(se,se,de);M._translateCameraConstrained(le),O&&Math.abs(M.zoom-oe)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){const w=ro(this._eventsInProgress),M=ro(a),S={};for(const U in a){const{originalEvent:X}=a[U];this._eventsInProgress[U]||(S[`${U}start`]=X),this._eventsInProgress[U]=a[U]}!w&&M&&this._fireEvent("movestart",M.originalEvent);for(const U in S)this._fireEvent(U,S[U]);M&&this._fireEvent("move",M.originalEvent);for(const U in a){const{originalEvent:X}=a[U];this._fireEvent(U,X)}const P={};let O;for(const U in this._eventsInProgress){const{handlerName:X,originalEvent:G}=this._eventsInProgress[U];this._handlersById[X].isActive()||(delete this._eventsInProgress[U],O=h[X]||G,P[`${U}end`]=O)}for(const U in P)this._fireEvent(U,P[U]);const V=ro(this._eventsInProgress);if(_&&(w||M)&&!V){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=G=>0!==G&&-this._bearingSnap<G&&G<this._bearingSnap;U?(X(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:O})):(this._map.fire(new p.A("moveend",{originalEvent:O})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new p.A(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Ib("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const lm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qg extends p.E{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,p.aV(["_renderFrameCallback"],this)}getCenter(){return new p.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,_){return a=p.P.convert(a).mult(-1),this.panTo(this.transform.center,p.l({offset:a},h),_)}panTo(a,h,_){return this.easeTo(p.l({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(p.l({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(p.l({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,p.l({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(p.l({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=p.aG.convert(a);const _=h&&h.bearing||0,w=h&&h.pitch||0,M=a.getNorthWest(),S=a.getSouthEast();return this._cameraForBounds(this.transform,M,S,_,w,h)}_extendPadding(a){const h={top:0,right:0,bottom:0,left:0};return null==a?p.l({},h,this.transform.padding):"number"==typeof a?{top:a,bottom:a,right:a,left:a}:p.l({},h,a)}_extendCameraOptions(a){return(a=p.l({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,h){const _=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return _/w>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):w/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,_,w,M,S){const P=a.clone(),O=this._extendCameraOptions(S);P.bearing=w,P.pitch=M;const V=p.cd.convert(h),U=p.cd.convert(_),X=.5*(V.lat+U.lat),G=.5*(V.lng+U.lng),Q=p.eC(X,G),se=p.au([],Q),oe=p.au([],p.bG([],se,[0,1,0])),de=p.bG([],oe,se),le=[oe[0],oe[1],oe[2],0,de[0],de[1],de[2],0,se[0],se[1],se[2],0,0,0,0,1],be=[Q,p.eC(V.lat,V.lng),p.eC(U.lat,V.lng),p.eC(U.lat,U.lng),p.eC(V.lat,U.lng),p.eC(X,V.lng),p.eC(X,U.lng),p.eC(V.lat,G),p.eC(U.lat,G)];let Me=p.cV.fromPoints(be.map(dt=>[p.bE(oe,dt),p.bE(de,dt),p.bE(se,dt)]));const De=p.ad([],Me.center,le);0===p.eD(De)&&p.eE(De,0,0,1),p.au(De,De),p.b$(De,De,p.aE),P.center=p.eF(De);const Le=P.getWorldToCameraMatrix(),Ie=p.bi(new Float64Array(16),Le);Me=p.cV.applyTransform(Me,p.az([],Le,le));const Oe=this._extendAABB(Me,P,O,w);if(!Oe)return void p.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Me=Oe,p.ad(De,De,Le);const Te=.5*(Me.max[2]-Me.min[2]),Be=this._minimumAABBFrustumDistance(P,Me),Ve=p.b$([],[0,0,1],Te),ct=p.cU(Ve,De,Ve),Ye=Be+(0===P.pitch?0:p.bD(De,ct)),kt=P.globeCenterInViewSpace,vt=p.at([],De,[kt[0],kt[1],kt[2]]);p.au(vt,vt),p.b$(vt,vt,Ye);const Pt=p.cU([],De,vt);p.ad(Pt,Pt,Ie);const Je=p.eq/p.aE,ot=p.ae(Pt),Ke=p.c6(Math.max(ot*Je-p.eq,Number.EPSILON),0),xt=Math.min(P.zoomFromMercatorZAdjusted(Ke),O.maxZoom);return xt>.5*(p.cL+p.cx)?(P.setProjection({name:"mercator"}),P.zoom=xt,this._cameraForBounds(P,h,_,w,M,S)):{center:P.center,zoom:xt,bearing:w,pitch:M}}_extendAABB(a,h,_,w){const M=.5*((_.padding.left||0)+(_.padding.right||0)),S=.5*((_.padding.top||0)+(_.padding.bottom||0)),P=S,O=M,V=M,U=S,X=h.width-(O+V),G=h.height-(P+U),Q=p.at([],a.max,a.min),se=Math.min(X/Q[0],G/Q[1]),oe=Math.min(h.scaleZoom(h.scale*se),_.maxZoom);if(isNaN(oe))return null;const de=h.scale/h.zoomScale(oe),le=new p.cV([a.min[0]-O*de,a.min[1]-U*de,a.min[2]],[a.max[0]+V*de,a.max[1]+P*de,a.max[2]]),be=("number"==typeof _.offset.x&&"number"==typeof _.offset.y?new p.P(_.offset.x,_.offset.y):p.P.convert(_.offset)).rotate(-p.al(w));return le.center[0]-=be.x*de,le.center[1]+=be.y*de,le}queryTerrainElevation(a,h){const _=this.transform.elevation;return _?(h=p.l({},{exaggerated:!0},h),_.getAtPoint(p.ac.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,_,w,M,S){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,h,_,w,M,S);const P=a.clone(),O=this._extendCameraOptions(S);P.bearing=w,P.pitch=M;const V=p.cd.convert(h),U=p.cd.convert(_),X=new p.cd(V.lng,U.lat),G=new p.cd(U.lng,V.lat),Q=P.project(V),se=P.project(U),oe=this.queryTerrainElevation(V),de=this.queryTerrainElevation(U),le=this.queryTerrainElevation(X),be=this.queryTerrainElevation(G),Me=[[Q.x,Q.y,Math.min(oe||0,de||0,le||0,be||0)],[se.x,se.y,Math.max(oe||0,de||0,le||0,be||0)]];let De=p.cV.fromPoints(Me);const Le=P.getWorldToCameraMatrix(),Ie=p.bi(new Float64Array(16),Le);De=p.cV.applyTransform(De,Le);const Oe=this._extendAABB(De,P,O,w);if(!Oe)return void p.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=Oe;const Te=.5*p.at([],De.max,De.min)[2],Be=this._minimumAABBFrustumDistance(P,De),Ve=[0,0,1,0];p.aA(Ve,Ve,Le),p.eG(Ve,Ve);const ct=p.b$([],Ve,Be+Te),Ye=p.cU([],De.center,ct);p.ad(De.center,De.center,Ie),p.ad(Ye,Ye,Ie);const kt=P.unproject(new p.P(De.center[0],De.center[1])),vt=p.eH(P.projection,kt),Pt=Math.pow(2,vt),Je=Math.min(P._zoomFromMercatorZ(Ye[2]*P.pixelsPerMeter*Pt/P.worldSize),O.maxZoom);return P.mercatorFromTransition&&Je<.5*(p.cL+p.cx)?(P.setProjection({name:"globe"}),P.zoom=Je,this._cameraForBounds(P,h,_,w,M,S)):{center:kt,zoom:Je,bearing:w,pitch:M}}fitBounds(a,h,_){const w=this.cameraForBounds(a,h);return this._fitInternal(w,h,_)}fitScreenCoordinates(a,h,_,w,M){const S=p.P.convert(a),P=p.P.convert(h),O=new p.P(Math.min(S.x,P.x),Math.min(S.y,P.y)),V=new p.P(Math.max(S.x,P.x),Math.max(S.y,P.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(S,P))return this;const U=this.transform.pointLocation3D(O),X=this.transform.pointLocation3D(V),G=this.transform.pointLocation3D(new p.P(O.x,V.y)),Q=this.transform.pointLocation3D(new p.P(V.x,O.y)),se=[Math.min(U.lng,X.lng,G.lng,Q.lng),Math.min(U.lat,X.lat,G.lat,Q.lat)],oe=[Math.max(U.lng,X.lng,G.lng,Q.lng),Math.max(U.lat,X.lat,G.lat,Q.lat)],de=w&&w.pitch?w.pitch:this.getPitch(),le=this._cameraForBounds(this.transform,se,oe,_,de,w);return this._fitInternal(le,w,M)}_fitInternal(a,h,_){return a?(h=p.l(a,h)).linear?this.easeTo(h,_):this.flyTo(h,_):this}jumpTo(a,h){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let w=!1,M=!1,S=!1;"zoom"in a&&_.zoom!==+a.zoom&&(w=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=p.cd.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(M=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(S=!0,_.pitch=+a.pitch);const P="number"==typeof a.padding?this._extendPadding(a.padding):a.padding;if(null!=a.padding&&!_.isPaddingEqual(P))if(!1===a.retainPadding){const O=_.clone();O.padding=P,_.setLocationAtPoint(_.center,O.centerPoint)}else _.padding=P;return a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.A("movestart",h)).fire(new p.A("move",h)),w&&this.fire(new p.A("zoomstart",h)).fire(new p.A("zoom",h)).fire(new p.A("zoomend",h)),M&&this.fire(new p.A("rotatestart",h)).fire(new p.A("rotate",h)).fire(new p.A("rotateend",h)),S&&this.fire(new p.A("pitchstart",h)).fire(new p.A("pitch",h)).fire(new p.A("pitchend",h)),this.fire(new p.A("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.w(lm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.w(lm),this;this.stop();const w=_.zoom,M=_.pitch,S=_.bearing;_.setFreeCameraOptions(a);const P=w!==_.zoom,O=M!==_.pitch,V=S!==_.bearing;return this.fire(new p.A("movestart",h)).fire(new p.A("move",h)),P&&this.fire(new p.A("zoomstart",h)).fire(new p.A("zoom",h)).fire(new p.A("zoomend",h)),V&&this.fire(new p.A("rotatestart",h)).fire(new p.A("rotate",h)).fire(new p.A("rotateend",h)),O&&this.fire(new p.A("pitchstart",h)).fire(new p.A("pitch",h)).fire(new p.A("pitchend",h)),this.fire(new p.A("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),(!1===(a=p.l({offset:[0,0],duration:500,easing:p.ey},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,w=this.getZoom(),M=this.getBearing(),S=this.getPitch(),P=this.getPadding(),O="zoom"in a?+a.zoom:w,V="bearing"in a?this._normalizeBearing(a.bearing,M):M,U="pitch"in a?+a.pitch:S,X=this._extendPadding(a.padding),G=p.P.convert(a.offset);let Q,se,oe;if("globe"===_.projection.name){const Ve=p.ac.fromLngLat(_.center),ct=G.rotate(-_.angle);Ve.x+=ct.x/_.worldSize,Ve.y+=ct.y/_.worldSize;const Ye=Ve.toLngLat(),kt=p.cd.convert(a.center||Ye);this._normalizeCenter(kt),Q=_.centerPoint.add(ct),se=new p.P(Ve.x,Ve.y).mult(_.worldSize),oe=new p.P(p.ay(kt.lng),p.aH(kt.lat)).mult(_.worldSize).sub(se)}else{Q=_.centerPoint.add(G);const Ve=_.pointLocation(Q),ct=p.cd.convert(a.center||Ve);this._normalizeCenter(ct),se=_.project(Ve),oe=_.project(ct).sub(se)}const de=_.zoomScale(O-w);let le,be;a.around&&(le=p.cd.convert(a.around),be=_.locationPoint(le));const Me=this._zooming||O!==w,De=this._rotating||M!==V,Le=this._pitching||U!==S,Ie=!_.isPaddingEqual(X),Oe=!1===a.retainPadding?_.clone():_,Te=Ve=>ct=>{if(Me&&(Ve.zoom=p.ai(w,O,ct)),De&&(Ve.bearing=p.ai(M,V,ct)),Le&&(Ve.pitch=p.ai(S,U,ct)),Ie&&(Oe.interpolatePadding(P,X,ct),Q=Oe.centerPoint.add(G)),le)Ve.setLocationAtPoint(le,be);else{const Ye=Ve.zoomScale(Ve.zoom-w),kt=O>w?Math.min(2,de):Math.max(.5,de),vt=Math.pow(kt,1-ct),Pt=Ve.unproject(se.add(oe.mult(ct*vt)).mult(Ye));Ve.setLocationAtPoint(Ve.renderWorldCopies?Pt.wrap():Pt,Q)}return a.preloadOnly||this._fireMoveEvents(h),Ve};if(a.preloadOnly){const Ve=this._emulate(Te,a.duration,_);return this._preloadTiles(Ve),this}const Be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Me,this._rotating=De,this._pitching=Le,this._padding=Ie,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Be),this._ease(Te(_),Ve=>{"sea"===_.cameraElevationReference&&_.recenterOnTerrain(),this._afterEase(h,Ve)},a),this}_prepareEase(a,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),h||_.moving||this.fire(new p.A("movestart",a)),this._zooming&&!_.zooming&&this.fire(new p.A("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new p.A("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new p.A("pitchstart",a))}_fireMoveEvents(a){this.fire(new p.A("move",a)),this._zooming&&this.fire(new p.A("zoom",a)),this._rotating&&this.fire(new p.A("rotate",a)),this._pitching&&this.fire(new p.A("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.A("zoomend",a)),w&&this.fire(new p.A("rotateend",a)),M&&this.fire(new p.A("pitchend",a)),this.fire(new p.A("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){const dt=p.aF(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(dt,h)}this.stop(),a=p.l({offset:[0,0],speed:1.2,curve:1.42,easing:p.ey},a);const _=this.transform,w=this.getZoom(),M=this.getBearing(),S=this.getPitch(),P=this.getPadding(),O="zoom"in a?p.aD(+a.zoom,_.minZoom,_.maxZoom):w,V="bearing"in a?this._normalizeBearing(a.bearing,M):M,U="pitch"in a?+a.pitch:S,X=this._extendPadding(a.padding),G=_.zoomScale(O-w),Q=p.P.convert(a.offset);let se=_.centerPoint.add(Q);const oe=_.pointLocation(se),de=p.cd.convert(a.center||oe);this._normalizeCenter(de);const le=_.project(oe),be=_.project(de).sub(le);let Me=a.curve;const De=Math.max(_.width,_.height),Le=De/G,Ie=be.mag();if("minZoom"in a){const dt=p.aD(Math.min(a.minZoom,w,O),_.minZoom,_.maxZoom),Ot=De/_.zoomScale(dt-w);Me=Math.sqrt(Ot/Ie*2)}const Oe=Me*Me;function Te(dt){const Ot=(Le*Le-De*De+(dt?-1:1)*Oe*Oe*Ie*Ie)/(2*(dt?Le:De)*Oe*Ie);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Be(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function Ve(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const ct=Te(0);let Ye=function(dt){return Ve(ct)/Ve(ct+Me*dt)},kt=function(dt){return De*((Ve(ct)*(Be(Ot=ct+Me*dt)/Ve(Ot))-Be(ct))/Oe)/Ie;var Ot},vt=(Te(1)-ct)/Me;if(Math.abs(Ie)<1e-6||!isFinite(vt)){if(Math.abs(De-Le)<1e-6)return this.easeTo(a,h);const dt=Le<De?-1:1;vt=Math.abs(Math.log(Le/De))/Me,kt=function(){return 0},Ye=function(Ot){return Math.exp(dt*Me*Ot)}}a.duration="duration"in a?+a.duration:1e3*vt/("screenSpeed"in a?+a.screenSpeed/Me:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Pt=M!==V,Je=U!==S,ot=!_.isPaddingEqual(X),Ke=!1===a.retainPadding?_.clone():_,xt=dt=>Ot=>{const wt=Ot*vt,It=1/Ye(wt);dt.zoom=1===Ot?O:w+dt.scaleZoom(It),Pt&&(dt.bearing=p.ai(M,V,Ot)),Je&&(dt.pitch=p.ai(S,U,Ot)),ot&&(Ke.interpolatePadding(P,X,Ot),se=Ke.centerPoint.add(Q));const Lt=1===Ot?de:dt.unproject(le.add(be.mult(kt(wt))).mult(It));return dt.setLocationAtPoint(dt.renderWorldCopies?Lt.wrap():Lt,se),dt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),dt};if(a.preloadOnly){const dt=this._emulate(xt,a.duration,_);return this._preloadTiles(dt),this}return this._zooming=!0,this._rotating=Pt,this._pitching=Je,this._padding=ot,this._prepareEase(h,!1),this._ease(xt(_),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,h,_){!1===_.animate||0===_.duration?(a(1),h()):(this._easeStart=p.q.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((p.q.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=p.bX(a,-180,180);const _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(h.maxBounds||"globe"!==h.projection.name&&!h.renderWorldCopies)return;const _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&p.q.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,_){const w=Math.ceil(15*h/1e3),M=[],S=a(_.clone());for(let P=0;P<=w;P++){const O=S(P/w);M.push(O.clone())}return M}_preloadTiles(a,h){}}class bu{constructor(a={}){this.options=a,p.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact,_=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=Gn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Gn("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const w=Gn("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",_),this._innerContainer=Gn("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.e.ACCESS_TOKEN}];if(a){const _=h.reduce((w,M,S)=>(M.value&&(w+=`${M.key}=${M.value}${S<h.length-1?"&":""}`),w),"?");a.href=`${p.e.FEEDBACK_URL}/${_}#${sl(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._mergedSourceCaches;for(const w in h){const M=h[w];if(M.used){const S=M.getSource();S.attribution&&a.indexOf(S.attribution)<0&&a.push(S.attribution)}}a.sort((w,M)=>w.length-M.length),a=a.filter((w,M)=>{for(let S=M+1;S<a.length;S++)if(a[S].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cm{constructor(){p.aV(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Gn("div","mapboxgl-ctrl");const h=Gn("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const h in a){const _=a[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===a)return void(w.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Kp{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=p.dk((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,_){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+_}}const Wo={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class hh extends p.A{constructor(a,h,_,w){const{point:M,lngLat:S,originalEvent:P,target:O}=a;super(a.type,{point:M,lngLat:S,originalEvent:P,target:O}),this.preventDefault=()=>{a.preventDefault()},this.id=h,this.interaction=_,this.feature=w}}class Qp{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,h){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const _=h.filter;let w=h.type;_&&this.filters.set(a,p.b3(_)),"mouseover"===w&&(w="mouseenter"),"mouseout"===w&&(w="mouseleave");const M=this.interactionsByType.get(w)||new Map;"mouseenter"===w||"mouseleave"===w?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,h)):0===M.size&&this.map.on(w,this.handleType),0===M.size&&this.interactionsByType.set(w,M),M.set(a,h),this.typeById.set(a,w)}get(a){const h=this.typeById.get(a);if(!h)return;const _=this.interactionsByType.get(h);return _?_.get(a):void 0}remove(a){const h=this.typeById.get(a);if(!h)return;this.typeById.delete(a),this.filters.delete(a);const _=this.interactionsByType.get(h);_&&(_.delete(a),"mouseenter"===h||"mouseleave"===h?(this.delegatedInteractions.delete(a),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===_.size&&this.map.off(h,this.handleType))}queryTargets(a,h){const _=[];for(const[w,M]of h)M.target&&_.push({targetId:w,target:M.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(a,_,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());h.length&&(a.type="mouseenter",this.handleType(a,h));const _=new Map;for(const[w,{feature:M}]of this.prevHoveredFeatures)this.hoveredFeatures.has(w)||_.set(M.id,M);_.size&&(a.type="mouseleave",this.handleType(a,Array.from(_.values())))}handleOut(a){const h=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);h.length&&(a.type="mouseleave",this.handleType(a,h)),this.hoveredFeatures.clear()}handleType(a,h){const _=Array.from(this.interactionsByType.get(a.type)).reverse(),w=!!h;h=h||this.queryTargets(a.point,_);const M="mouseenter"===a.type;let S=!1;const P=new Set;for(const O of h){for(const[V,U]of _){if(!U.target)continue;const X=O.variants?O.variants[V]:null;if(X){for(const G of X){if(sd(G,O,P,V))continue;const Q=new p.df(O,G),se=_c(G,O,V);w&&(Q.state=this.map.getFeatureState(Q));const oe=M?this.prevHoveredFeatures.get(se):null,de=new hh(a,V,U,Q),le=oe?oe.stop:U.handler(de);if(M&&this.hoveredFeatures.set(se,{feature:O,stop:le}),!1!==le){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[O,V]of _){const{handler:U,target:X}=V;if(!X&&!1!==U(new hh(a,O,V,null)))break}}}function dm(g,a){if(Array.isArray(g)&&Array.isArray(a)){const h=new Set(g),_=new Set(a);return h.size===_.size&&g.every(w=>_.has(w))}return p.bv(g,a)}const Ry={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},uh={showCompass:!0,showZoom:!0,visualizePitch:!1};class hm{constructor(a,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ll({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new Xc({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),p.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),Uo()}move(a,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(a,h),M=w&&w.bearingDelta;if(M&&_.setBearing(_.getBearing()+M),this.mousePitch){const S=this.mousePitch.mousemoveWindow(a,h),P=S&&S.pitchDelta;P&&_.setPitch(_.getPitch()+P)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ya(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(p.l({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Il(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Il(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=Xa(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=Xa(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function um(g,a,h){if(g=new p.cd(g.lng,g.lat),a){const _=new p.cd(g.lng-360,g.lat),w=new p.cd(g.lng+360,g.lat),M=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),S=h.locationPoint3D(g).distSqr(a),P=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint3D(_).distSqr(a)<S&&(P||Math.abs(_.lng-h.center.lng)<M)?g=_:h.locationPoint3D(w).distSqr(a)<S&&(P||Math.abs(w.lng-h.center.lng)<M)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint3D(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const pm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Kc={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class xu extends p.E{constructor(a,h){super(),(a instanceof HTMLElement||h)&&(a=p.l({element:a},h)),p.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:w="#3FB1CE",scale:M=1,draggable:S=!1,clickTolerance:P=0,rotation:O=Kc.rotation,rotationAlignment:V=Kc.rotationAlignment,pitchAlignment:U=Kc.pitchAlignment,occludedOpacity:X=Kc.occludedOpacity,altitude:G=Kc.altitude}=a||{};this._anchor=_,this._color=w,this._scale=M,this._draggable=S,this._clickTolerance=P,this._rotation=O,this._rotationAlignment=V,this._pitchAlignment=U,this._occludedOpacity=X,this._altitude=G,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=p.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=p.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",oe=>{oe.preventDefault()}),this._element.addEventListener("mousedown",oe=>{oe.preventDefault()});const Q=this._element.classList;for(const oe in pm)Q.remove(`mapboxgl-marker-anchor-${oe}`);Q.add(`mapboxgl-marker-anchor-${this._anchor}`);const se=a&&a.className?a.className.trim().split(/\s+/):[];Q.add(...se),this._popup=null}_createDefaultMarker(){const a=Gn("div"),h=mr("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(0===this._altitude){const _=mr("radialGradient",{id:"shadowGradient"},mr("defs",{},h));mr("stop",{offset:"10%","stop-opacity":.4},_),mr("stop",{offset:"100%","stop-opacity":.05},_),mr("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return mr("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),mr("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),mr("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=p.cd.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==a||0!==this._altitude&&0===a)&&(this._element=this._createDefaultMarker()),this._altitude=a||Kc.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,_=a.charCode||a.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const _=a.unproject(h,this._altitude),w=a.getFreeCameraOptions();if(!w.position)return!1;const M=w.position.toLngLat();return M.distanceTo(_)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(h,this._altitude);let w;a._showingGlobe()&&p.eK(a.transform,this._lngLat)?w=0:(w=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${pm[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const a=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!a||"map"!==_)return"";if(!h._showingGlobe()){const O=h.getPitch();return O?`rotateX(${O}deg)`:""}const w=p.cJ(p.eL(h.transform,this._lngLat)),M=a.sub(p.eM(h.transform)),S=Math.abs(M.x)+Math.abs(M.y);if(0===S)return"";const P=w/S;return`rotateX(${-M.y*P}deg) rotateY(${M.x*P}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let _=0;const w=this.getRotationAlignment();if("map"===w)if(h._showingGlobe()){const M=h.project(new p.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=h.project(new p.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(M);_=p.cJ(Math.atan2(S.y,S.x))-90}else _=-h.getBearing();else if("horizon"===w){const M=p.af(4,6,h.getZoom()),S=p.eM(h.transform);S.y+=M*h.transform.height;const P=a.sub(S),O=p.cJ(Math.atan2(P.y,P.x));_=(O>90?O-270:O+90)*(1-M)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=um(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),!0===a?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=p.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const h=this._map;if(!h)return;const _=this._pointerdownPos,w=this._positionDelta;if(_&&w){if(!this._isDragging){const M=this._clickTolerance||h._clickTolerance;if(a.point.dist(_)<M)return;this._isDragging=!0}this._pos=a.point.sub(w),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.A("dragstart"))),this.fire(new p.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.A("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,_=this._pos;h&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||Kc.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||Kc.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||Kc.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||Kc.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const cp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jp={maxWidth:100,unit:"metric"},ph={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_d={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},yd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hh(g=new p.P(0,0),a="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(a){case"top":return new p.P(0,g);case"top-left":return new p.P(h,h);case"top-right":return new p.P(-h,h);case"bottom":return new p.P(0,-g);case"bottom-left":return new p.P(h,-h);case"bottom-right":return new p.P(-h,-h);case"left":return new p.P(g,0);case"right":return new p.P(-g,0)}return new p.P(0,0)}return g instanceof p.P||Array.isArray(g)?p.P.convert(g):p.P.convert(g[a]||[0,0])}return{version:En,supported:Fc.supported,setRTLTextPlugin:p.eN,getRTLTextPluginStatus:p.eO,Map:class extends qg{constructor(g){Xl.mark(oi.create);const a=g;if(null!=(g=p.l({},Ry,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.eI(window)&&(g.antialias=!1,p.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bd(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Sc,this._domRenderTaskQueue=new Sc,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.a$(),this._locale=p.l({},Wo,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new Qn(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},"string"==typeof g.container){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,p.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new k0),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new MM(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||p.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this.indoor=new xc(this),g.hash&&(this._hash=new rp("string"==typeof g.hash&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==a.center&&null==a.zoom||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,p.l({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new bu({customAttribution:g.customAttribution})),this._logoControl=new cm,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update("style"===h.dataType),this.fire(new p.A(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new p.A(`${h.dataType}dataloading`,h))}),this._interactions=new Qp(this)}_getMapId(){return this._mapId}addControl(g,a){if(void 0===a&&(a=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(g);return a>-1&&this._controls.splice(a,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new p.A("movestart",g)).fire(new p.A("move",g)),this.fire(new p.A("resize",g)),a&&this.fire(new p.A("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.aG.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.A("zoomstart")).fire(new p.A("zoom")).fire(new p.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.A("zoomstart")).fire(new p.A("zoom")).fire(new p.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.A("pitchstart")).fire(new p.A("pitch")).fire(new p.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.A("pitchstart")).fire(new p.A("pitch")).fire(new p.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>"symbol"===a.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(a=>"auto"===a?navigator.language:a):g}setLanguage(g){const a=this._parseLanguage(g);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,a=g.projection.name;let h;"globe"===a&&g.zoom>=p.cx?(g.setMercatorFromTransition(),h=!0):"mercator"===a&&g.zoom<p.cx&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,a){return this._updateProjection(g||a||{name:"mercator"})}_updateProjection(g){let a;return a="globe"===g.name&&this.transform.zoom>=p.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,a){return this.transform.locationPoint3D(p.cd.convert(g),a)}unproject(g,a){return this.transform.pointLocation3D(p.P.convert(g),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,a,h){const _=w=>{let M=[];if(Array.isArray(a)){const S=a.filter(P=>this.getLayer(P));M=S.length?this.queryRenderedFeatures(w,{layers:S}):[]}else M=this.queryRenderedFeatures(w,{target:a});return M};if("mouseenter"===g||"mouseover"===g){let w=!1;return{listener:h,targets:a,delegates:{mousemove:S=>{const P=_(S.point);P.length?w||(w=!0,h.call(this,new Cl(g,this,S.originalEvent,{features:P}))):w=!1},mouseout:()=>{w=!1}}}}if("mouseleave"===g||"mouseout"===g){let w=!1;return{listener:h,targets:a,delegates:{mousemove:P=>{_(P.point).length?w=!0:w&&(w=!1,h.call(this,new Cl(g,this,P.originalEvent)))},mouseout:P=>{w&&(w=!1,h.call(this,new Cl(g,this,P.originalEvent)))}}}}{const w=M=>{const S=_(M.point);S.length&&(M.features=S,h.call(this,M),delete M.features)};return{listener:h,targets:a,delegates:{[g]:w}}}}on(g,a,h){if("function"==typeof a||void 0===h)return super.on(g,a);if("string"==typeof a&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(g,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(g,a,h){if("function"==typeof a||void 0===h)return super.once(g,a);if("string"==typeof a&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(g,a,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(g,a,h){if("function"==typeof a||void 0===h)return super.off(g,a);if("string"==typeof a&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._delegatedListeners?this._delegatedListeners[g]:void 0;return _&&(w=>{for(let M=0;M<w.length;M++){const S=w[M];if(S.listener===h&&dm(S.targets,a)){for(const P in S.delegates)this.off(P,S.delegates[P]);return w.splice(M,1),this}}})(_),this}queryRenderedFeatures(g,a){if(!this.style)return[];if(void 0===g||g instanceof p.P||Array.isArray(g)||void 0!==a||(a=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!a){const M=this.style.queryRenderedFeatures(g,void 0,this.transform),S=this.style.queryRenderedFeatureset(g,void 0,this.transform);return M.concat(S)}let h=!0;if(a.target&&(h=this._isTargetValid(a.target),h&&!a.layers))return this.style.queryRenderedFeatureset(g,a,this.transform);let _=!0;if(a.layers&&Array.isArray(a.layers)){for(const M of a.layers)if(!this._isValidId(M)){_=!1;break}if(_&&!a.target)return this.style.queryRenderedFeatures(g,a,this.transform)}let w=[];return _&&(w=w.concat(this.style.queryRenderedFeatures(g,a,this.transform))),h&&(w=w.concat(this.style.queryRenderedFeatureset(g,a,this.transform))),w}querySourceFeatures(g,a){return!g||"string"==typeof g&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,a)}isPointOnSurface(g){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&p.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.P.convert(g))}addInteraction(g,a){return this._interactions.add(g,a),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,a){return a=p.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&g&&!1!==a.diff&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(g,(h,_)=>{if(h){const w="string"==typeof h?h:h instanceof Error?h.message:h.error;p.w(`Unable to perform style diff: ${w}. Rebuilding the style from scratch.`),this._updateStyle(g,a)}else _&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(g,a))}_getUIString(g){const a=this._locale[g];if(null==a)throw new Error(`Missing UI string '${g}'`);return a}_updateStyle(g,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=p.l({},a);a&&a.config&&(h.initialConfig=a.config,delete h.config),this.style=new es(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.w("There is no style added to the map."),!1)}_isValidId(g){return null==g?(this.fire(new p.z(new Error("IDs can't be empty."))),!1):!p.d9(g)||(this.fire(new p.z(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const a of g)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(g)}addSource(g,a){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,a),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,a,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,a,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:M,content:S}={}){this._lazyInitEmptyStyle();const P=p.I.from(g);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:O,height:V,data:U}=p.q.getImageData(a);this.style.addImage(P,{data:new p.r({width:O,height:V},U),pixelRatio:h,stretchX:w,stretchY:M,content:S,sdf:_,version:0,usvg:!1})}else if(void 0===a.width||void 0===a.height)this.fire(new p.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:V}=a,U=a;this.style.addImage(P,{data:new p.r({width:O,height:V},new Uint8Array(U.data)),pixelRatio:h,stretchX:w,stretchY:M,content:S,sdf:_,usvg:!1,version:0,userImage:U}),U.onAdd&&U.onAdd(this,g)}}updateImage(g,a){this._lazyInitEmptyStyle();const h=p.I.from(g),_=this.style.getImage(h);if(!_)return void this.fire(new p.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?p.q.getImageData(a):a,{width:M,height:S,data:P}=w;if(void 0===M||void 0===S)return void this.fire(new p.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||S!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new p.z(new Error(`The width and height of the updated image (${M}, ${S})\n                must be that same as the previous version of the image\n                (${_.data.width}, ${_.data.height})`)));const O=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let V=!1;_.usvg?(_.data=new p.r({width:M,height:S},new Uint8Array(P)),_.usvg=!1,_.icon=void 0,V=!0):_.data.replace(P,O),this.style.updateImage(h,_,V)}hasImage(g){return g?!!this.style&&!!this.style.getImage(p.I.from(g)):(this.fire(new p.z(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(p.I.from(g))}loadImage(g,a){p.o(this._requestManager.transformRequest(g,p.R.Image),(h,_)=>{a(h,_ instanceof HTMLImageElement?p.q.getImageData(_):_)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,a){this._lazyInitEmptyStyle(),this.style.addModel(g,a)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new p.z(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,a){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,a),this._update(!0)):this}getSlot(g){const a=this.getLayer(g);return a&&a.slot||null}setSlot(g,a){return this.style.setSlot(g,a),this.style.mergeLayers(),this._update(!0)}addImport(g,a){return this.style.addImport(g,a).catch(h=>this.fire(new p.z(new Error("Failed to add import",h)))),this}updateImport(g,a){return"string"!=typeof a&&a.id!==g?(this.removeImport(g),this.addImport(a)):(this.style.updateImport(g,a),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,a){return this.style.moveImport(g,a),this._update(!0)}moveLayer(g,a){return this._isValidId(g)?(this.style.moveLayer(g,a),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const a=this.style.getOwnLayer(g);return a?"custom"===a.type?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,a,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,a,h),this._update(!0)):this}setFilter(g,a,h={}){return this._isValidId(g)?(this.style.setFilter(g,a,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,a,h,_={}){return this._isValidId(g)?(this.style.setPaintProperty(g,a,h,_),this._update(!0)):this}getPaintProperty(g,a){return this._isValidId(g)?this.style.getPaintProperty(g,a):null}setLayoutProperty(g,a,h,_={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,a,h,_),this._update(!0)):this}getLayoutProperty(g,a){return this._isValidId(g)?this.style.getLayoutProperty(g,a):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,a){return this.style.setSchema(g,a),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,a){return this.style.setConfig(g,a),this._update(!0)}getConfigProperty(g,a){return this.style.getConfigProperty(g,a)}setConfigProperty(g,a,h){return this.style.setConfigProperty(g,a,h),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&1===g.length&&"flat"===g[0].type){const a=g[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return 0===g.length&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,a),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===g["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.cd.convert(g),this.transform):0}setFeatureState(g,a){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,a),this._update())}removeFeatureState(g,a){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,a),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,_,w,M=this._container;for(;M&&(!_||!w);){const S=window.getComputedStyle(M).transform;S&&"none"!==S&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),M=M.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=w?Math.abs(a/w):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Gn("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Gn("div","mapboxgl-canvas-container",g);this._canvas=Gn("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Gn("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{_[w]=Gn("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,a){const h=p.q.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${a}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const a=this._markers.indexOf(g);-1!==a&&this._markers.splice(a,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const a=this._popups.indexOf(g);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const g=p.l({},Fc.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",g);a?(As(a,!0),this.painter=new zg(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),p.m.testSupport(a)):this.fire(new p.z(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.A("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new p.A("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let a;this.fire(new p.A("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,_=p.q.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=w.createQuery(),w.beginQuery(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,U=this.transform.pitch,X=p.q.now(),G=new p.aa(V,{now:X,fadeDuration:M,pitch:U,transition:this.style.transition});this.style.update(G)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Xl.mark(oi.load),this.fire(new p.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const V=p.q.now()-_;w.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const U=w.getQueryParameter(a,w.QUERY_RESULT)/1e6;w.deleteQuery(a),this.fire(new p.A("gpu-timing-frame",{cpuTime:V,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(V);this.fire(new p.A("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(V);this.fire(new p.A("gpu-timing-deferred-render",{gpuTime:U}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(O||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new p.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new p.A("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,Xl.mark(oi.fullLoad),this._performanceMetricsCollection&&Lr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const a of this._markers)g&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!g||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(g,a=!1){const h=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(a||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const w=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=g;const S=Math.abs(w-M);if(S>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(M),h(M);this._averageElevation.easeTo(M,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(M),h(M)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){Nc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===gr||401===g.status)){const a=this.painter.context.gl;As(a,!1),this._logoControl instanceof cm&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Bo(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ei(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(M){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,M,0);const S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(g),a.canvasCopies.map(w),a.timeStamps)}_canvasPixelComparison(g,a,h){let _=h[1]-h[0];const w=g.length/4;for(let M=0;M<a.length;M++){const S=a[M];let P=0;for(let O=0;O<S.length;O+=4)S[O]===g[O]&&S[O+1]===g[O+1]&&S[O+2]===g[O+2]&&S[O+3]===g[O+3]&&(P+=1);_+=(h[M+2]-h[M+1])*(1-P/w)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zi.delete(this.painter.context.gl),ui.remove(),Yo.remove(),this._removed=!0,this.fire(new p.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.q.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(g){const a=this.style?this.style.getSourceCaches():[];return p.bt(a,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,a){p.eJ(g,a)}get version(){return En}},NavigationControl:class{constructor(g={}){this.options=p.l({},uh,g),this._container=Gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(p.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Gn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Gn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=Gn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const a=g.getZoom(),h=a===g.getMaxZoom(),_=a===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hm(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,a){const h=Gn("button",g,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(g,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.E{constructor(g={}){super();const a=navigator.geolocation;this.options=p.l({geolocation:a},cp,g),p.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$p(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(h=>a("denied"!==h.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(g){const a=this._map.getMaxBounds(),h=g.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.A("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new p.A("geolocate",g)),this._finish()}}_updateCamera(g){const a=new p.cd(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),w=p.l({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const a=new p.cd(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,a=p.c6(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new p.A("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Gn("button","mapboxgl-ctrl-geolocate",this._container),Gn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Gn("div","mapboxgl-user-location"),this._dotElement.appendChild(Gn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Gn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Gn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.A("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bu,ScaleControl:class{constructor(g={}){this.options=p.l({},Jp,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,_=a._containerWidth/2-g/2,w=a.unproject([_,h]),M=a.unproject([_+g,h]),S=w.distanceTo(M);if("imperial"===this.options.unit){const P=3.2808*S;P>5280?this._setScale(g,P/5280,"mile"):this._setScale(g,P,"foot")}else"nautical"===this.options.unit?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,a,h){this._map._requestDomTask(()=>{const _=function(M){const S=Math.pow(10,`${Math.floor(M)}`.length-1);let P=M/S;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const V=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*V)/V}(P),S*P}(a),w=_/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${ph[h]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Gn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:p.w("Full screen control 'container' must be a DOM element.")),p.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Gn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Gn("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.E{constructor(g){super(),this.options=p.l(Object.create(_d),g),this._altitude=this.options.altitude,p.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.A("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.cd.convert(g),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const a=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Gn("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(g),this.options.closeButton){const h=this._closeButton=Gn("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let a;return this._classList.delete(g)?a=!1:(this._classList.add(g),a=!0),this._updateClassList(),a}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,_=this._pos;if(!a||!h||!_)return"bottom";const w=h.offsetWidth,M=h.offsetHeight,S=_.x<w/2,P=_.x>a.transform.width-w/2;if(_.y+g<M)return S?"top-left":P?"top-right":"top";if(_.y>a.transform.height-M){if(S)return"bottom-left";if(P)return"bottom-right"}return S?"left":P?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),g.className=a.join(" ")}_update(g){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Gn("div","mapboxgl-popup",a.getContainer()),this._tip=Gn("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=um(this._lngLat,this._pos,a.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g instanceof p.P?g:a.project(this._lngLat,this._altitude),M=Hh(this.options.offset),S=this._anchor=this._getAnchor(M.y),P=Hh(this.options.offset,S),O=w.add(P).round();a._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${pm[S]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&a._showingGlobe()){const w=p.eK(a.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(yd);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:xu,Style:es,LngLat:p.cd,LngLatBounds:p.aG,Point:p.P,MercatorCoordinate:p.ac,FreeCameraOptions:dd,Evented:p.E,config:p.e,prewarm:p.eP,clearPrewarmedResources:p.eQ,get accessToken(){return p.e.ACCESS_TOKEN},set accessToken(g){p.e.ACCESS_TOKEN=g},get baseApiUrl(){return p.e.API_URL},set baseApiUrl(g){p.e.API_URL=g},get workerCount(){return p.eR.workerCount},set workerCount(g){p.eR.workerCount=g},get maxParallelImageRequests(){return p.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.eS(g)},get workerUrl(){return p.eT.workerUrl},set workerUrl(g){p.eT.workerUrl=g},get workerClass(){return p.eT.workerClass},set workerClass(g){p.eT.workerClass=g},get workerParams(){return p.eT.workerParams},set workerParams(g){p.eT.workerParams=g},get dracoUrl(){return p.eU()},set dracoUrl(g){p.eV(g)},get meshoptUrl(){return p.eW()},set meshoptUrl(g){p.eX(g)},setNow:p.q.setNow,restoreNow:p.q.restoreNow}}),Qi}()},32:function(yg){yg.exports=function(){"use strict";function Lc(Y,J,fe){if("function"==typeof Y?Y===J:Y.has(J))return arguments.length<3?J:fe;throw new TypeError("Private element is not present on this object")}function Qi(Y,J){return Y.get(Lc(Y,J))}function co(Y,J,fe){(function wn(Y,J){if(J.has(Y))throw new TypeError("Cannot initialize the same private elements twice on an object")})(Y,J),J.set(Y,fe)}const En={},Xl=Y=>new Promise(J=>{if(!Y)return J();const fe=window.scrollX,Ue=window.scrollY;En.restoreFocusTimeout=setTimeout(()=>{En.previousActiveElement instanceof HTMLElement?(En.previousActiveElement.focus(),En.previousActiveElement=null):document.body&&document.body.focus(),J()},100),window.scrollTo(fe,Ue)}),zt=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((Y,J)=>(Y[J]="swal2-"+J,Y),{}),Gn=["success","warning","info","question","error"].reduce((Y,J)=>(Y[J]="swal2-"+J,Y),{}),mr="SweetAlert2:",Rr=Y=>Y.charAt(0).toUpperCase()+Y.slice(1),ho=Y=>{console.warn(`${mr} ${"object"==typeof Y?Y.join(" "):Y}`)},No=Y=>{console.error(`${mr} ${Y}`)},Uo=[],Pl=(Y,J=null)=>{(Y=>{Uo.includes(Y)||(Uo.push(Y),ho(Y))})(`"${Y}" is deprecated and will be removed in the next major release.${J?` Use "${J}" instead.`:""}`)},xa=Y=>"function"==typeof Y?Y():Y,Il=Y=>Y&&"function"==typeof Y.toPromise,Xa=Y=>Il(Y)?Y.toPromise():Promise.resolve(Y),zc=Y=>Y&&Promise.resolve(Y)===Y,Ji=()=>document.body.querySelector(`.${zt.container}`),Co=Y=>{const J=Ji();return J?J.querySelector(Y):null},gr=Y=>Co(`.${Y}`),Qn=()=>gr(zt.popup),Cr=()=>gr(zt.icon),no=()=>gr(zt.title),wa=()=>gr(zt["html-container"]),Pi=()=>gr(zt.image),Jn=()=>gr(zt["progress-steps"]),yi=()=>gr(zt["validation-message"]),Sr=()=>Co(`.${zt.actions} .${zt.confirm}`),Yo=()=>Co(`.${zt.actions} .${zt.cancel}`),Bo=()=>Co(`.${zt.actions} .${zt.deny}`),ei=()=>Co(`.${zt.loader}`),si=()=>gr(zt.actions),Lr=()=>gr(zt.footer),ui=()=>gr(zt["timer-progress-bar"]),Nc=()=>gr(zt.close),As=()=>{const Y=Qn();if(!Y)return[];const J=Y.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),fe=Array.from(J).sort((xn,Mi)=>{const yr=parseInt(xn.getAttribute("tabindex")||"0"),io=parseInt(Mi.getAttribute("tabindex")||"0");return yr>io?1:yr<io?-1:0}),Ue=Y.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),At=Array.from(Ue).filter(xn=>"-1"!==xn.getAttribute("tabindex"));return[...new Set(fe.concat(At))].filter(xn=>Eo(xn))},Vr=()=>Gs(document.body,zt.shown)&&!Gs(document.body,zt["toast-shown"])&&!Gs(document.body,zt["no-backdrop"]),dc=()=>{const Y=Qn();return!!Y&&Gs(Y,zt.toast)},go=(Y,J)=>{if(Y.textContent="",J){const Ue=(new DOMParser).parseFromString(J,"text/html"),At=Ue.querySelector("head");At&&Array.from(At.childNodes).forEach(Mi=>{Y.appendChild(Mi)});const xn=Ue.querySelector("body");xn&&Array.from(xn.childNodes).forEach(Mi=>{Mi instanceof HTMLVideoElement||Mi instanceof HTMLAudioElement?Y.appendChild(Mi.cloneNode(!0)):Y.appendChild(Mi)})}},Gs=(Y,J)=>{if(!J)return!1;const fe=J.split(/\s+/);for(let Ue=0;Ue<fe.length;Ue++)if(!Y.classList.contains(fe[Ue]))return!1;return!0},_o=(Y,J,fe)=>{if(((Y,J)=>{Array.from(Y.classList).forEach(fe=>{!Object.values(zt).includes(fe)&&!Object.values(Gn).includes(fe)&&!Object.values(J.showClass||{}).includes(fe)&&Y.classList.remove(fe)})})(Y,J),!J.customClass)return;const Ue=J.customClass[fe];if(Ue){if("string"!=typeof Ue&&!Ue.forEach)return void ho(`Invalid type of customClass.${fe}! Expected string or iterable object, got "${typeof Ue}"`);_r(Y,Ue)}},Ka=(Y,J)=>{if(!J)return null;switch(J){case"select":case"textarea":case"file":return Y.querySelector(`.${zt.popup} > .${zt[J]}`);case"checkbox":return Y.querySelector(`.${zt.popup} > .${zt.checkbox} input`);case"radio":return Y.querySelector(`.${zt.popup} > .${zt.radio} input:checked`)||Y.querySelector(`.${zt.popup} > .${zt.radio} input:first-child`);case"range":return Y.querySelector(`.${zt.popup} > .${zt.range} input`);default:return Y.querySelector(`.${zt.popup} > .${zt.input}`)}},uc=Y=>{if(Y.focus(),"file"!==Y.type){const J=Y.value;Y.value="",Y.value=J}},Ol=(Y,J,fe)=>{!Y||!J||("string"==typeof J&&(J=J.split(/\s+/).filter(Boolean)),J.forEach(Ue=>{Array.isArray(Y)?Y.forEach(At=>{fe?At.classList.add(Ue):At.classList.remove(Ue)}):fe?Y.classList.add(Ue):Y.classList.remove(Ue)}))},_r=(Y,J)=>{Ol(Y,J,!0)},Io=(Y,J)=>{Ol(Y,J,!1)},ls=(Y,J)=>{const fe=Array.from(Y.children);for(let Ue=0;Ue<fe.length;Ue++){const At=fe[Ue];if(At instanceof HTMLElement&&Gs(At,J))return At}},Kl=(Y,J,fe)=>{fe===`${parseInt(fe)}`&&(fe=parseInt(fe)),fe||0===parseInt(fe)?Y.style.setProperty(J,"number"==typeof fe?`${fe}px`:fe):Y.style.removeProperty(J)},So=(Y,J="flex")=>{Y&&(Y.style.display=J)},Ko=Y=>{Y&&(Y.style.display="none")},fl=(Y,J="block")=>{Y&&new MutationObserver(()=>{Ss(Y,Y.innerHTML,J)}).observe(Y,{childList:!0,subtree:!0})},pc=(Y,J,fe,Ue)=>{const At=Y.querySelector(J);At&&At.style.setProperty(fe,Ue)},Ss=(Y,J,fe="flex")=>{J?So(Y,fe):Ko(Y)},Eo=Y=>!(!Y||!(Y.offsetWidth||Y.offsetHeight||Y.getClientRects().length)),ml=Y=>Y.scrollHeight>Y.clientHeight,Vc=Y=>{const J=window.getComputedStyle(Y),fe=parseFloat(J.getPropertyValue("animation-duration")||"0"),Ue=parseFloat(J.getPropertyValue("transition-duration")||"0");return fe>0||Ue>0},Od=(Y,J=!1)=>{const fe=ui();fe&&Eo(fe)&&(J&&(fe.style.transition="none",fe.style.width="100%"),setTimeout(()=>{fe.style.transition=`width ${Y/1e3}s linear`,fe.style.width="0%"},10))},nh=`\n <div aria-labelledby="${zt.title}" aria-describedby="${zt["html-container"]}" class="${zt.popup}" tabindex="-1">\n   <button type="button" class="${zt.close}"></button>\n   <ul class="${zt["progress-steps"]}"></ul>\n   <div class="${zt.icon}"></div>\n   <img class="${zt.image}" />\n   <h2 class="${zt.title}" id="${zt.title}"></h2>\n   <div class="${zt["html-container"]}" id="${zt["html-container"]}"></div>\n   <input class="${zt.input}" id="${zt.input}" />\n   <input type="file" class="${zt.file}" />\n   <div class="${zt.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${zt.select}" id="${zt.select}"></select>\n   <div class="${zt.radio}"></div>\n   <label class="${zt.checkbox}">\n     <input type="checkbox" id="${zt.checkbox}" />\n     <span class="${zt.label}"></span>\n   </label>\n   <textarea class="${zt.textarea}" id="${zt.textarea}"></textarea>\n   <div class="${zt["validation-message"]}" id="${zt["validation-message"]}"></div>\n   <div class="${zt.actions}">\n     <div class="${zt.loader}"></div>\n     <button type="button" class="${zt.confirm}"></button>\n     <button type="button" class="${zt.deny}"></button>\n     <button type="button" class="${zt.cancel}"></button>\n   </div>\n   <div class="${zt.footer}"></div>\n   <div class="${zt["timer-progress-bar-container"]}">\n     <div class="${zt["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),Rl=()=>{En.currentInstance.resetValidationMessage()},iu=Y=>{const J=(()=>{const Y=Ji();return!!Y&&(Y.remove(),Io([document.documentElement,document.body],[zt["no-backdrop"],zt["toast-shown"],zt["has-column"]]),!0)})();if(typeof window>"u"||typeof document>"u")return void No("SweetAlert2 requires document to initialize");const fe=document.createElement("div");fe.className=zt.container,J&&_r(fe,zt["no-transition"]),go(fe,nh),fe.dataset.swal2Theme=Y.theme;const Ue=(Y=>"string"==typeof Y?document.querySelector(Y):Y)(Y.target);Ue.appendChild(fe),Y.topLayer&&(fe.setAttribute("popover",""),fe.showPopover()),(Y=>{const J=Qn();J.setAttribute("role",Y.toast?"alert":"dialog"),J.setAttribute("aria-live",Y.toast?"polite":"assertive"),Y.toast||J.setAttribute("aria-modal","true")})(Y),(Y=>{"rtl"===window.getComputedStyle(Y).direction&&_r(Ji(),zt.rtl)})(Ue),(()=>{const Y=Qn(),J=ls(Y,zt.input),fe=ls(Y,zt.file),Ue=Y.querySelector(`.${zt.range} input`),At=Y.querySelector(`.${zt.range} output`),xn=ls(Y,zt.select),Mi=Y.querySelector(`.${zt.checkbox} input`),yr=ls(Y,zt.textarea);J.oninput=Rl,fe.onchange=Rl,xn.onchange=Rl,Mi.onchange=Rl,yr.oninput=Rl,Ue.oninput=()=>{Rl(),At.value=Ue.value},Ue.onchange=()=>{Rl(),At.value=Ue.value}})()},mt=(Y,J)=>{Y instanceof HTMLElement?J.appendChild(Y):"object"==typeof Y?ae(Y,J):Y&&go(J,Y)},ae=(Y,J)=>{Y.jquery?ge(J,Y):go(J,Y.toString())},ge=(Y,J)=>{if(Y.textContent="",0 in J)for(let fe=0;fe in J;fe++)Y.appendChild(J[fe].cloneNode(!0));else Y.appendChild(J.cloneNode(!0))},Ae=(Y,J)=>{const fe=si(),Ue=ei();!fe||!Ue||(J.showConfirmButton||J.showDenyButton||J.showCancelButton?So(fe):Ko(fe),_o(fe,J,"actions"),function je(Y,J,fe){const Ue=Sr(),At=Bo(),xn=Yo();!Ue||!At||!xn||(Ge(Ue,"confirm",fe),Ge(At,"deny",fe),Ge(xn,"cancel",fe),function Fe(Y,J,fe,Ue){Ue.buttonsStyling?(_r([Y,J,fe],zt.styled),Ue.confirmButtonColor&&Y.style.setProperty("--swal2-confirm-button-background-color",Ue.confirmButtonColor),Ue.denyButtonColor&&J.style.setProperty("--swal2-deny-button-background-color",Ue.denyButtonColor),Ue.cancelButtonColor&&fe.style.setProperty("--swal2-cancel-button-background-color",Ue.cancelButtonColor),We(Y),We(J),We(fe)):Io([Y,J,fe],zt.styled)}(Ue,At,xn,fe),fe.reverseButtons&&(fe.toast?(Y.insertBefore(xn,Ue),Y.insertBefore(At,Ue)):(Y.insertBefore(xn,J),Y.insertBefore(At,J),Y.insertBefore(Ue,J))))}(fe,Ue,J),go(Ue,J.loaderHtml||""),_o(Ue,J,"loader"))};function We(Y){const J=window.getComputedStyle(Y);if(J.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const fe=J.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");Y.style.setProperty("--swal2-action-button-focus-box-shadow",J.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${fe}`))}function Ge(Y,J,fe){const Ue=Rr(J);Ss(Y,fe[`show${Ue}Button`],"inline-block"),go(Y,fe[`${J}ButtonText`]||""),Y.setAttribute("aria-label",fe[`${J}ButtonAriaLabel`]||""),Y.className=zt[J],_o(Y,fe,`${J}Button`)}const at=(Y,J)=>{const fe=Ji();fe&&(function bt(Y,J){"string"==typeof J?Y.style.background=J:J||_r([document.documentElement,document.body],zt["no-backdrop"])}(fe,J.backdrop),function tt(Y,J){J&&(J in zt?_r(Y,zt[J]):(ho('The "position" parameter is not valid, defaulting to "center"'),_r(Y,zt.center)))}(fe,J.position),function Zt(Y,J){J&&_r(Y,zt[`grow-${J}`])}(fe,J.grow),_o(fe,J,"container"))};var jt={innerParams:new WeakMap,domCache:new WeakMap};const pn=["input","file","range","select","radio","checkbox","textarea"],Wn=Y=>{if(!Y.input)return;if(!wi[Y.input])return void No(`Unexpected type of input! Expected ${Object.keys(wi).join(" | ")}, got "${Y.input}"`);const J=ki(Y.input);if(!J)return;const fe=wi[Y.input](J,Y);So(J),Y.inputAutoFocus&&setTimeout(()=>{uc(fe)})},pi=(Y,J)=>{const fe=Qn();if(!fe)return;const Ue=Ka(fe,Y);if(Ue){(Y=>{for(let J=0;J<Y.attributes.length;J++){const fe=Y.attributes[J].name;["id","type","value","style"].includes(fe)||Y.removeAttribute(fe)}})(Ue);for(const At in J)Ue.setAttribute(At,J[At])}},cr=Y=>{if(!Y.input)return;const J=ki(Y.input);J&&_o(J,Y,"input")},ci=(Y,J)=>{!Y.placeholder&&J.inputPlaceholder&&(Y.placeholder=J.inputPlaceholder)},fi=(Y,J,fe)=>{if(fe.inputLabel){const Ue=document.createElement("label"),At=zt["input-label"];Ue.setAttribute("for",Y.id),Ue.className=At,"object"==typeof fe.customClass&&_r(Ue,fe.customClass.inputLabel),Ue.innerText=fe.inputLabel,J.insertAdjacentElement("beforebegin",Ue)}},ki=Y=>{const J=Qn();if(J)return ls(J,zt[Y]||zt.input)},Si=(Y,J)=>{["string","number"].includes(typeof J)?Y.value=`${J}`:zc(J)||ho(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof J}"`)},wi={};wi.text=wi.email=wi.password=wi.number=wi.tel=wi.url=wi.search=wi.date=wi["datetime-local"]=wi.time=wi.week=wi.month=(Y,J)=>(Si(Y,J.inputValue),fi(Y,Y,J),ci(Y,J),Y.type=J.input,Y),wi.file=(Y,J)=>(fi(Y,Y,J),ci(Y,J),Y),wi.range=(Y,J)=>{const fe=Y.querySelector("input"),Ue=Y.querySelector("output");return Si(fe,J.inputValue),fe.type=J.input,Si(Ue,J.inputValue),fi(fe,Y,J),Y},wi.select=(Y,J)=>{if(Y.textContent="",J.inputPlaceholder){const fe=document.createElement("option");go(fe,J.inputPlaceholder),fe.value="",fe.disabled=!0,fe.selected=!0,Y.appendChild(fe)}return fi(Y,Y,J),Y},wi.radio=Y=>(Y.textContent="",Y),wi.checkbox=(Y,J)=>{const fe=Ka(Qn(),"checkbox");fe.value="1",fe.checked=!!J.inputValue;const Ue=Y.querySelector("span");return go(Ue,J.inputPlaceholder||J.inputLabel),fe},wi.textarea=(Y,J)=>{Si(Y,J.inputValue),ci(Y,J),fi(Y,Y,J);return setTimeout(()=>{if("MutationObserver"in window){const Ue=parseInt(window.getComputedStyle(Qn()).width);new MutationObserver(()=>{if(!document.body.contains(Y))return;const xn=Y.offsetWidth+(Ue=>parseInt(window.getComputedStyle(Ue).marginLeft)+parseInt(window.getComputedStyle(Ue).marginRight))(Y);xn>Ue?Qn().style.width=`${xn}px`:Kl(Qn(),"width",J.width)}).observe(Y,{attributes:!0,attributeFilter:["style"]})}}),Y};const Do=(Y,J)=>{const fe=wa();fe&&(fl(fe),_o(fe,J,"htmlContainer"),J.html?(mt(J.html,fe),So(fe,"block")):J.text?(fe.textContent=J.text,So(fe,"block")):Ko(fe),((Y,J)=>{const fe=Qn();if(!fe)return;const Ue=jt.innerParams.get(Y),At=!Ue||J.input!==Ue.input;pn.forEach(xn=>{const Mi=ls(fe,zt[xn]);Mi&&(pi(xn,J.inputAttributes),Mi.className=zt[xn],At&&Ko(Mi))}),J.input&&(At&&Wn(J),cr(J))})(Y,J))},_s=(Y,J)=>{for(const[fe,Ue]of Object.entries(Gn))J.icon!==fe&&Io(Y,Ue);_r(Y,J.icon&&Gn[J.icon]),cs(Y,J),ka(),_o(Y,J,"icon")},ka=()=>{const Y=Qn();if(!Y)return;const J=window.getComputedStyle(Y).getPropertyValue("background-color"),fe=Y.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let Ue=0;Ue<fe.length;Ue++)fe[Ue].style.backgroundColor=J},Jo=(Y,J)=>{if(!J.icon&&!J.iconHtml)return;let fe=Y.innerHTML,Ue="";J.iconHtml?Ue=rr(J.iconHtml):"success"===J.icon?(Ue='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',fe=fe.replace(/ style=".*?"/g,"")):"error"===J.icon?Ue='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':J.icon&&(Ue=rr({question:"?",warning:"!",info:"i"}[J.icon])),fe.trim()!==Ue.trim()&&go(Y,Ue)},cs=(Y,J)=>{if(J.iconColor){Y.style.color=J.iconColor,Y.style.borderColor=J.iconColor;for(const fe of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])pc(Y,fe,"background-color",J.iconColor);pc(Y,".swal2-success-ring","border-color",J.iconColor)}},rr=Y=>`<div class="${zt["icon-content"]}">${Y}</div>`;let gc=!1,_l=0,_c=0,sd=0,ti=0;const Un=Y=>{const J=Qn();if(Y.target===J||Cr().contains(Y.target)){gc=!0;const fe=$o(Y);_l=fe.clientX,_c=fe.clientY,sd=parseInt(J.style.insetInlineStart)||0,ti=parseInt(J.style.insetBlockStart)||0,_r(J,"swal2-dragging")}},Os=Y=>{const J=Qn();if(gc){let{clientX:fe,clientY:Ue}=$o(Y);J.style.insetInlineStart=`${sd+(fe-_l)}px`,J.style.insetBlockStart=`${ti+(Ue-_c)}px`}},Rs=()=>{const Y=Qn();gc=!1,Io(Y,"swal2-dragging")},$o=Y=>{let J=0,fe=0;return Y.type.startsWith("mouse")?(J=Y.clientX,fe=Y.clientY):Y.type.startsWith("touch")&&(J=Y.touches[0].clientX,fe=Y.touches[0].clientY),{clientX:J,clientY:fe}},na=(Y,J)=>{const fe=Ji(),Ue=Qn();if(fe&&Ue){if(J.toast){Kl(fe,"width",J.width),Ue.style.width="100%";const At=ei();At&&Ue.insertBefore(At,Cr())}else Kl(Ue,"width",J.width);Kl(Ue,"padding",J.padding),J.color&&(Ue.style.color=J.color),J.background&&(Ue.style.background=J.background),Ko(yi()),uo(Ue,J),J.draggable&&!J.toast?(_r(Ue,zt.draggable),(Y=>{Y.addEventListener("mousedown",Un),document.body.addEventListener("mousemove",Os),Y.addEventListener("mouseup",Rs),Y.addEventListener("touchstart",Un),document.body.addEventListener("touchmove",Os),Y.addEventListener("touchend",Rs)})(Ue)):(Io(Ue,zt.draggable),(Y=>{Y.removeEventListener("mousedown",Un),document.body.removeEventListener("mousemove",Os),Y.removeEventListener("mouseup",Rs),Y.removeEventListener("touchstart",Un),document.body.removeEventListener("touchmove",Os),Y.removeEventListener("touchend",Rs)})(Ue))}},uo=(Y,J)=>{const fe=J.showClass||{};Y.className=`${zt.popup} ${Eo(Y)?fe.popup:""}`,J.toast?(_r([document.documentElement,document.body],zt["toast-shown"]),_r(Y,zt.toast)):_r(Y,zt.modal),_o(Y,J,"popup"),"string"==typeof J.customClass&&_r(Y,J.customClass),J.icon&&_r(Y,zt[`icon-${J.icon}`])},Ls=Y=>{const J=document.createElement("li");return _r(J,zt["progress-step"]),go(J,Y),J},Ro=Y=>{const J=document.createElement("li");return _r(J,zt["progress-step-line"]),Y.progressStepsDistance&&Kl(J,"width",Y.progressStepsDistance),J},Qa=(Y,J)=>{na(0,J),at(0,J),((Y,J)=>{const fe=Jn();if(!fe)return;const{progressSteps:Ue,currentProgressStep:At}=J;Ue&&0!==Ue.length&&void 0!==At?(So(fe),fe.textContent="",At>=Ue.length&&ho("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),Ue.forEach((xn,Mi)=>{const yr=Ls(xn);if(fe.appendChild(yr),Mi===At&&_r(yr,zt["active-progress-step"]),Mi!==Ue.length-1){const io=Ro(J);fe.appendChild(io)}})):Ko(fe)})(0,J),((Y,J)=>{const fe=jt.innerParams.get(Y),Ue=Cr();if(Ue){if(fe&&J.icon===fe.icon)return Jo(Ue,J),void _s(Ue,J);if(J.icon||J.iconHtml)return J.icon&&-1===Object.keys(Gn).indexOf(J.icon)?(No(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${J.icon}"`),void Ko(Ue)):(So(Ue),Jo(Ue,J),_s(Ue,J),_r(Ue,J.showClass&&J.showClass.icon),void window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",ka));Ko(Ue)}})(Y,J),((Y,J)=>{const fe=Pi();if(fe){if(!J.imageUrl)return void Ko(fe);So(fe,""),fe.setAttribute("src",J.imageUrl),fe.setAttribute("alt",J.imageAlt||""),Kl(fe,"width",J.imageWidth),Kl(fe,"height",J.imageHeight),fe.className=zt.image,_o(fe,J,"image")}})(0,J),((Y,J)=>{const fe=no();fe&&(fl(fe),Ss(fe,J.title||J.titleText,"block"),J.title&&mt(J.title,fe),J.titleText&&(fe.innerText=J.titleText),_o(fe,J,"title"))})(0,J),((Y,J)=>{const fe=Nc();fe&&(go(fe,J.closeButtonHtml||""),_o(fe,J,"closeButton"),Ss(fe,J.showCloseButton),fe.setAttribute("aria-label",J.closeButtonAriaLabel||""))})(0,J),Do(Y,J),Ae(0,J),((Y,J)=>{const fe=Lr();fe&&(fl(fe),Ss(fe,J.footer,"block"),J.footer&&mt(J.footer,fe),_o(fe,J,"footer"))})(0,J);const fe=Qn();"function"==typeof J.didRender&&fe&&J.didRender(fe),En.eventEmitter.emit("didRender",fe)},Ri=()=>{var Y;return null===(Y=Sr())||void 0===Y?void 0:Y.click()},vc=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Hc=Y=>{Y.keydownTarget&&Y.keydownHandlerAdded&&(Y.keydownTarget.removeEventListener("keydown",Y.keydownHandler,{capture:Y.keydownListenerCapture}),Y.keydownHandlerAdded=!1)},Uc=(Y,J)=>{var fe;const Ue=As();if(Ue.length)return-2===(Y+=J)&&(Y=Ue.length-1),Y===Ue.length?Y=0:-1===Y&&(Y=Ue.length-1),void Ue[Y].focus();null===(fe=Qn())||void 0===fe||fe.focus()},Ui=["ArrowRight","ArrowDown"],jn=["ArrowLeft","ArrowUp"],vi=(Y,J,fe)=>{Y&&(J.isComposing||229===J.keyCode||(Y.stopKeydownPropagation&&J.stopPropagation(),"Enter"===J.key?po(J,Y):"Tab"===J.key?Ld(J):[...Ui,...jn].includes(J.key)?Ah(J.key):"Escape"===J.key&&Ma(J,Y,fe)))},po=(Y,J)=>{if(!xa(J.allowEnterKey))return;const fe=Ka(Qn(),J.input);if(Y.target&&fe&&Y.target instanceof HTMLElement&&Y.target.outerHTML===fe.outerHTML){if(["textarea","file"].includes(J.input))return;Ri(),Y.preventDefault()}},Ld=Y=>{const J=Y.target,fe=As();let Ue=-1;for(let At=0;At<fe.length;At++)if(J===fe[At]){Ue=At;break}Uc(Ue,Y.shiftKey?-1:1),Y.stopPropagation(),Y.preventDefault()},Ah=Y=>{const J=si(),fe=Sr(),Ue=Bo(),At=Yo();if(!(J&&fe&&Ue&&At))return;if(document.activeElement instanceof HTMLElement&&![fe,Ue,At].includes(document.activeElement))return;const Mi=Ui.includes(Y)?"nextElementSibling":"previousElementSibling";let yr=document.activeElement;if(yr){for(let io=0;io<J.children.length;io++){if(yr=yr[Mi],!yr)return;if(yr instanceof HTMLButtonElement&&Eo(yr))break}yr instanceof HTMLButtonElement&&yr.focus()}},Ma=(Y,J,fe)=>{xa(J.allowEscapeKey)&&(Y.preventDefault(),fe(vc.esc))};var yl={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const ad=()=>{Array.from(document.body.children).forEach(J=>{J.hasAttribute("data-previous-aria-hidden")?(J.setAttribute("aria-hidden",J.getAttribute("data-previous-aria-hidden")||""),J.removeAttribute("data-previous-aria-hidden")):J.removeAttribute("aria-hidden")})},vl=typeof window<"u"&&!!window.GestureEvent,Ll=()=>{const Y=Ji();if(!Y)return;let J;Y.ontouchstart=fe=>{J=Ph(fe)},Y.ontouchmove=fe=>{J&&(fe.preventDefault(),fe.stopPropagation())}},Ph=Y=>{const J=Y.target,fe=Ji(),Ue=wa();return!(!fe||!Ue||ih(Y)||ru(Y)||J!==fe&&(ml(fe)||!(J instanceof HTMLElement)||((Y,J)=>{let fe=Y;for(;fe&&fe!==J;){if(ml(fe))return!0;fe=fe.parentElement}return!1})(J,Ue)||"INPUT"===J.tagName||"TEXTAREA"===J.tagName||ml(Ue)&&Ue.contains(J)))},ih=Y=>Y.touches&&Y.touches.length&&"stylus"===Y.touches[0].touchType,ru=Y=>Y.touches&&Y.touches.length>1;let Fl=null;const Va=Y=>{null===Fl&&(document.body.scrollHeight>window.innerHeight||"scroll"===Y)&&(Fl=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Fl+(()=>{const Y=document.createElement("div");Y.className=zt["scrollbar-measure"],document.body.appendChild(Y);const J=Y.getBoundingClientRect().width-Y.clientWidth;return document.body.removeChild(Y),J})()}px`)};function ou(Y,J,fe,Ue){dc()?qu(Y,Ue):(Xl(fe).then(()=>qu(Y,Ue)),Hc(En)),vl?(J.setAttribute("style","display:none !important"),J.removeAttribute("class"),J.innerHTML=""):J.remove(),Vr()&&(null!==Fl&&(document.body.style.paddingRight=`${Fl}px`,Fl=null),(()=>{if(Gs(document.body,zt.iosfix)){const Y=parseInt(document.body.style.top,10);Io(document.body,zt.iosfix),document.body.style.top="",document.body.scrollTop=-1*Y}})(),ad()),function Sa(){Io([document.documentElement,document.body],[zt.shown,zt["height-auto"],zt["no-backdrop"],zt["toast-shown"]])}()}function Xo(Y){Y=Ni(Y);const J=yl.swalPromiseResolve.get(this),fe=vn(this);this.isAwaitingPromise?Y.isDismissed||(Ii(this),J(Y)):fe&&J(Y)}const vn=Y=>{const J=Qn();if(!J)return!1;const fe=jt.innerParams.get(Y);if(!fe||Gs(J,fe.hideClass.popup))return!1;Io(J,fe.showClass.popup),_r(J,fe.hideClass.popup);const Ue=Ji();return Io(Ue,fe.showClass.backdrop),_r(Ue,fe.hideClass.backdrop),Uu(Y,J,fe),!0};function su(Y){const J=yl.swalPromiseReject.get(this);Ii(this),J&&J(Y)}const Ii=Y=>{Y.isAwaitingPromise&&(delete Y.isAwaitingPromise,jt.innerParams.get(Y)||Y._destroy())},Ni=Y=>typeof Y>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},Y),Uu=(Y,J,fe)=>{var Ue;const At=Ji(),xn=Vc(J);"function"==typeof fe.willClose&&fe.willClose(J),null===(Ue=En.eventEmitter)||void 0===Ue||Ue.emit("willClose",J),xn?Cn(Y,J,At,fe.returnFocus,fe.didClose):ou(Y,At,fe.returnFocus,fe.didClose)},Cn=(Y,J,fe,Ue,At)=>{En.swalCloseEventFinishedCallback=ou.bind(null,Y,fe,Ue,At);const xn=function(Mi){var yr;Mi.target===J&&(null===(yr=En.swalCloseEventFinishedCallback)||void 0===yr||yr.call(En),delete En.swalCloseEventFinishedCallback,J.removeEventListener("animationend",xn),J.removeEventListener("transitionend",xn))};J.addEventListener("animationend",xn),J.addEventListener("transitionend",xn)},qu=(Y,J)=>{setTimeout(()=>{var fe;"function"==typeof J&&J.bind(Y.params)(),null===(fe=En.eventEmitter)||void 0===fe||fe.emit("didClose"),Y._destroy&&Y._destroy()})},el=Y=>{let J=Qn();if(J||new on,J=Qn(),!J)return;const fe=ei();dc()?Ko(Cr()):Fd(J,Y),So(fe),J.setAttribute("data-loading","true"),J.setAttribute("aria-busy","true"),J.focus()},Fd=(Y,J)=>{const fe=si(),Ue=ei();!fe||!Ue||(!J&&Eo(Sr())&&(J=Sr()),So(fe),J&&(Ko(J),Ue.setAttribute("data-button-to-replace",J.className),fe.insertBefore(Ue,J)),_r([Y,fe],zt.loading))},ld=Y=>Y.checked?1:0,Fi=Y=>Y.checked?Y.value:null,yn=Y=>Y.files&&Y.files.length?null!==Y.getAttribute("multiple")?Y.files:Y.files[0]:null,nr=(Y,J)=>{const fe=Qn();if(!fe)return;const Ue=At=>{"select"===J.input?function Da(Y,J,fe){const Ue=ls(Y,zt.select);if(!Ue)return;const At=(xn,Mi,yr)=>{const io=document.createElement("option");io.value=yr,go(io,Mi),io.selected=zd(yr,fe.inputValue),xn.appendChild(io)};J.forEach(xn=>{const Mi=xn[0],yr=xn[1];if(Array.isArray(yr)){const io=document.createElement("optgroup");io.label=Mi,io.disabled=!1,Ue.appendChild(io),yr.forEach(Ua=>At(io,Ua[1],Ua[0]))}else At(Ue,yr,Mi)}),Ue.focus()}(fe,Hn(At),J):"radio"===J.input&&function cd(Y,J,fe){const Ue=ls(Y,zt.radio);if(!Ue)return;J.forEach(xn=>{const Mi=xn[0],yr=xn[1],io=document.createElement("input"),Ua=document.createElement("label");io.type="radio",io.name=zt.radio,io.value=Mi,zd(Mi,fe.inputValue)&&(io.checked=!0);const fd=document.createElement("span");go(fd,yr),fd.className=zt.label,Ua.appendChild(io),Ua.appendChild(fd),Ue.appendChild(Ua)});const At=Ue.querySelectorAll("input");At.length&&At[0].focus()}(fe,Hn(At),J)};Il(J.inputOptions)||zc(J.inputOptions)?(el(Sr()),Xa(J.inputOptions).then(At=>{Y.hideLoading(),Ue(At)})):"object"==typeof J.inputOptions?Ue(J.inputOptions):No("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof J.inputOptions)},bi=(Y,J)=>{const fe=Y.getInput();fe&&(Ko(fe),Xa(J.inputValue).then(Ue=>{fe.value="number"===J.input?`${parseFloat(Ue)||0}`:`${Ue}`,So(fe),fe.focus(),Y.hideLoading()}).catch(Ue=>{No(`Error in inputValue promise: ${Ue}`),fe.value="",So(fe),fe.focus(),Y.hideLoading()}))};const Hn=Y=>{const J=[];return Y instanceof Map?Y.forEach((fe,Ue)=>{let At=fe;"object"==typeof At&&(At=Hn(At)),J.push([Ue,At])}):Object.keys(Y).forEach(fe=>{let Ue=Y[fe];"object"==typeof Ue&&(Ue=Hn(Ue)),J.push([fe,Ue])}),J},zd=(Y,J)=>!!J&&J.toString()===Y.toString(),To=(Y,J)=>{const fe=jt.innerParams.get(Y);if(!fe.input)return void No(`The "input" parameter is needed to be set when using returnInputValueOn${Rr(J)}`);const Ue=Y.getInput(),At=((Y,J)=>{const fe=Y.getInput();if(!fe)return null;switch(J.input){case"checkbox":return ld(fe);case"radio":return Fi(fe);case"file":return yn(fe);default:return J.inputAutoTrim?fe.value.trim():fe.value}})(Y,fe);fe.inputValidator?$u(Y,At,J):Ue&&!Ue.checkValidity()?(Y.enableButtons(),Y.showValidationMessage(fe.validationMessage||Ue.validationMessage)):"deny"===J?zl(Y,At):xl(Y,At)},$u=(Y,J,fe)=>{const Ue=jt.innerParams.get(Y);Y.disableInput(),Promise.resolve().then(()=>Xa(Ue.inputValidator(J,Ue.validationMessage))).then(xn=>{Y.enableButtons(),Y.enableInput(),xn?Y.showValidationMessage(xn):"deny"===fe?zl(Y,J):xl(Y,J)})},zl=(Y,J)=>{const fe=jt.innerParams.get(Y||void 0);fe.showLoaderOnDeny&&el(Bo()),fe.preDeny?(Y.isAwaitingPromise=!0,Promise.resolve().then(()=>Xa(fe.preDeny(J,fe.validationMessage))).then(At=>{!1===At?(Y.hideLoading(),Ii(Y)):Y.close({isDenied:!0,value:typeof At>"u"?J:At})}).catch(At=>qc(Y||void 0,At))):Y.close({isDenied:!0,value:J})},bc=(Y,J)=>{Y.close({isConfirmed:!0,value:J})},qc=(Y,J)=>{Y.rejectPromise(J)},xl=(Y,J)=>{const fe=jt.innerParams.get(Y||void 0);fe.showLoaderOnConfirm&&el(),fe.preConfirm?(Y.resetValidationMessage(),Y.isAwaitingPromise=!0,Promise.resolve().then(()=>Xa(fe.preConfirm(J,fe.validationMessage))).then(At=>{Eo(yi())||!1===At?(Y.hideLoading(),Ii(Y)):bc(Y,typeof At>"u"?J:At)}).catch(At=>qc(Y||void 0,At))):bc(Y,J)};function ia(){const Y=jt.innerParams.get(this);if(!Y)return;const J=jt.domCache.get(this);Ko(J.loader),dc()?Y.icon&&So(Cr()):Ta(J),Io([J.popup,J.actions],zt.loading),J.popup.removeAttribute("aria-busy"),J.popup.removeAttribute("data-loading"),J.confirmButton.disabled=!1,J.denyButton.disabled=!1,J.cancelButton.disabled=!1}const Ta=Y=>{const J=Y.popup.getElementsByClassName(Y.loader.getAttribute("data-button-to-replace"));J.length?So(J[0],"inline-block"):!Eo(Sr())&&!Eo(Bo())&&!Eo(Yo())&&Ko(Y.actions)};function Nl(){const Y=jt.innerParams.get(this),J=jt.domCache.get(this);return J?Ka(J.popup,Y.input):null}function ja(Y,J,fe){const Ue=jt.domCache.get(Y);J.forEach(At=>{Ue[At].disabled=fe})}function $c(Y,J){const fe=Qn();if(fe&&Y)if("radio"===Y.type){const Ue=fe.querySelectorAll(`[name="${zt.radio}"]`);for(let At=0;At<Ue.length;At++)Ue[At].disabled=J}else Y.disabled=J}function Ql(){ja(this,["confirmButton","denyButton","cancelButton"],!1)}function Vo(){ja(this,["confirmButton","denyButton","cancelButton"],!0)}function ra(){$c(this.getInput(),!1)}function Yn(){$c(this.getInput(),!0)}function rn(Y){const J=jt.domCache.get(this),fe=jt.innerParams.get(this);go(J.validationMessage,Y),J.validationMessage.className=zt["validation-message"],fe.customClass&&fe.customClass.validationMessage&&_r(J.validationMessage,fe.customClass.validationMessage),So(J.validationMessage);const Ue=this.getInput();Ue&&(Ue.setAttribute("aria-invalid","true"),Ue.setAttribute("aria-describedby",zt["validation-message"]),uc(Ue),_r(Ue,zt.inputerror))}function oa(){const Y=jt.domCache.get(this);Y.validationMessage&&Ko(Y.validationMessage);const J=this.getInput();J&&(J.removeAttribute("aria-invalid"),J.removeAttribute("aria-describedby"),Io(J,zt.inputerror))}const kn={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Nd=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],vs={allowEnterKey:void 0},Ln=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Dt=Y=>Object.prototype.hasOwnProperty.call(kn,Y),wl=Y=>-1!==Nd.indexOf(Y),Rn=Y=>vs[Y],dd=Y=>{Dt(Y)||ho(`Unknown parameter "${Y}"`)},ds=Y=>{Ln.includes(Y)&&ho(`The parameter "${Y}" is incompatible with toasts`)},Ds=Y=>{const J=Rn(Y);J&&Pl(Y,J)},tl=Y=>{!1===Y.backdrop&&Y.allowOutsideClick&&ho('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),Y.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(Y.theme)&&ho(`Invalid theme "${Y.theme}"`);for(const J in Y)dd(J),Y.toast&&ds(J),Ds(J)};function Bl(Y){const J=Ji(),fe=Qn(),Ue=jt.innerParams.get(this);if(!fe||Gs(fe,Ue.hideClass.popup))return void ho("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const At=Bd(Y),xn=Object.assign({},Ue,At);tl(xn),J.dataset.swal2Theme=xn.theme,Qa(this,xn),jt.innerParams.set(this,xn),Object.defineProperties(this,{params:{value:Object.assign({},this.params,Y),writable:!1,enumerable:!0}})}const Bd=Y=>{const J={};return Object.keys(Y).forEach(fe=>{wl(fe)?J[fe]=Y[fe]:ho(`Invalid parameter to update: ${fe}`)}),J};function Ys(){const Y=jt.domCache.get(this),J=jt.innerParams.get(this);J?(Y.popup&&En.swalCloseEventFinishedCallback&&(En.swalCloseEventFinishedCallback(),delete En.swalCloseEventFinishedCallback),"function"==typeof J.didDestroy&&J.didDestroy(),En.eventEmitter.emit("didDestroy"),Fs(this)):Go(this)}const Fs=Y=>{Go(Y),delete Y.params,delete En.keydownHandler,delete En.keydownTarget,delete En.currentInstance},Go=Y=>{Y.isAwaitingPromise?(Aa(jt,Y),Y.isAwaitingPromise=!0):(Aa(yl,Y),Aa(jt,Y),delete Y.isAwaitingPromise,delete Y.disableButtons,delete Y.enableButtons,delete Y.getInput,delete Y.disableInput,delete Y.enableInput,delete Y.hideLoading,delete Y.disableLoading,delete Y.showValidationMessage,delete Y.resetValidationMessage,delete Y.close,delete Y.closePopup,delete Y.closeModal,delete Y.closeToast,delete Y.rejectPromise,delete Y.update,delete Y._destroy)},Aa=(Y,J)=>{for(const fe in Y)Y[fe].delete(J)};var Er=Object.freeze({__proto__:null,_destroy:Ys,close:Xo,closeModal:Xo,closePopup:Xo,closeToast:Xo,disableButtons:Vo,disableInput:Yn,disableLoading:ia,enableButtons:Ql,enableInput:ra,getInput:Nl,handleAwaitingPromise:Ii,hideLoading:ia,rejectPromise:su,resetValidationMessage:oa,showValidationMessage:rn,update:Bl});const kl=(Y,J,fe)=>{J.popup.onclick=()=>{Y&&(Ha(Y)||Y.timer||Y.input)||fe(vc.close)}},Ha=Y=>!!(Y.showConfirmButton||Y.showDenyButton||Y.showCancelButton||Y.showCloseButton);let hd=!1;const Xs=Y=>{Y.popup.onmousedown=()=>{Y.container.onmouseup=function(J){Y.container.onmouseup=()=>{},J.target===Y.container&&(hd=!0)}}},ud=Y=>{Y.container.onmousedown=J=>{J.target===Y.container&&J.preventDefault(),Y.popup.onmouseup=function(fe){Y.popup.onmouseup=()=>{},(fe.target===Y.popup||fe.target instanceof HTMLElement&&Y.popup.contains(fe.target))&&(hd=!0)}}},lu=(Y,J,fe)=>{J.container.onclick=Ue=>{hd?hd=!1:Ue.target===J.container&&xa(Y.allowOutsideClick)&&fe(vc.backdrop)}},xc=Y=>Y instanceof Element||(Y=>"object"==typeof Y&&Y.jquery)(Y);const Hd=()=>{if(En.timeout)return(()=>{const Y=ui();if(!Y)return;const J=parseInt(window.getComputedStyle(Y).width);Y.style.removeProperty("transition"),Y.style.width="100%";const fe=parseInt(window.getComputedStyle(Y).width);Y.style.width=J/fe*100+"%"})(),En.timeout.stop()},Gu=()=>{if(En.timeout){const Y=En.timeout.start();return Od(Y),Y}};let es=!1;const sa={};const Wu=Y=>{for(let J=Y.target;J&&J!==document;J=J.parentNode)for(const fe in sa){const Ue=J.getAttribute(fe);if(Ue)return void sa[fe].fire({template:Ue})}};En.eventEmitter=new class Ud{constructor(){this.events={}}_getHandlersByEventName(J){return typeof this.events[J]>"u"&&(this.events[J]=[]),this.events[J]}on(J,fe){const Ue=this._getHandlersByEventName(J);Ue.includes(fe)||Ue.push(fe)}once(J,fe){const Ue=(...At)=>{this.removeListener(J,Ue),fe.apply(this,At)};this.on(J,Ue)}emit(J,...fe){this._getHandlersByEventName(J).forEach(Ue=>{try{Ue.apply(this,fe)}catch(At){console.error(At)}})}removeListener(J,fe){const Ue=this._getHandlersByEventName(J),At=Ue.indexOf(fe);At>-1&&Ue.splice(At,1)}removeAllListeners(J){void 0!==this.events[J]&&(this.events[J].length=0)}reset(){this.events={}}};var qd=Object.freeze({__proto__:null,argsToParams:Y=>{const J={};return"object"!=typeof Y[0]||xc(Y[0])?["title","html","icon"].forEach((fe,Ue)=>{const At=Y[Ue];"string"==typeof At||xc(At)?J[fe]=At:void 0!==At&&No(`Unexpected type of ${fe}! Expected "string" or "Element", got ${typeof At}`)}):Object.assign(J,Y[0]),J},bindClickHandler:function wc(Y="data-swal-template"){sa[Y]=this,es||(document.body.addEventListener("click",Wu),es=!0)},clickCancel:()=>{var Y;return null===(Y=Yo())||void 0===Y?void 0:Y.click()},clickConfirm:Ri,clickDeny:()=>{var Y;return null===(Y=Bo())||void 0===Y?void 0:Y.click()},enableLoading:el,fire:function Vd(...Y){return new this(...Y)},getActions:si,getCancelButton:Yo,getCloseButton:Nc,getConfirmButton:Sr,getContainer:Ji,getDenyButton:Bo,getFocusableElements:As,getFooter:Lr,getHtmlContainer:wa,getIcon:Cr,getIconContent:()=>gr(zt["icon-content"]),getImage:Pi,getInputLabel:()=>gr(zt["input-label"]),getLoader:ei,getPopup:Qn,getProgressSteps:Jn,getTimerLeft:()=>En.timeout&&En.timeout.getTimerLeft(),getTimerProgressBar:ui,getTitle:no,getValidationMessage:yi,increaseTimer:Y=>{if(En.timeout){const J=En.timeout.increase(Y);return Od(J,!0),J}},isDeprecatedParameter:Rn,isLoading:()=>{const Y=Qn();return!!Y&&Y.hasAttribute("data-loading")},isTimerRunning:()=>!(!En.timeout||!En.timeout.isRunning()),isUpdatableParameter:wl,isValidParameter:Dt,isVisible:()=>Eo(Qn()),mixin:function jd(Y){return class J extends(this){_main(Ue,At){return super._main(Ue,Object.assign({},Y,At))}}},off:(Y,J)=>{Y?J?En.eventEmitter.removeListener(Y,J):En.eventEmitter.removeAllListeners(Y):En.eventEmitter.reset()},on:(Y,J)=>{En.eventEmitter.on(Y,J)},once:(Y,J)=>{En.eventEmitter.once(Y,J)},resumeTimer:Gu,showLoading:el,stopTimer:Hd,toggleTimer:()=>{const Y=En.timeout;return Y&&(Y.running?Hd():Gu())}});class hu{constructor(J,fe){this.callback=J,this.remaining=fe,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(J){const fe=this.running;return fe&&this.stop(),this.remaining+=J,fe&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const kc=["swal-title","swal-html","swal-footer"],pd=Y=>{const J={};return Array.from(Y.querySelectorAll("swal-param")).forEach(Ue=>{Wi(Ue,["name","value"]);const At=Ue.getAttribute("name"),xn=Ue.getAttribute("value");!At||!xn||(J[At]="boolean"==typeof kn[At]?"false"!==xn:"object"==typeof kn[At]?JSON.parse(xn):xn)}),J},Hl=Y=>{const J={};return Array.from(Y.querySelectorAll("swal-function-param")).forEach(Ue=>{const At=Ue.getAttribute("name"),xn=Ue.getAttribute("value");!At||!xn||(J[At]=new Function(`return ${xn}`)())}),J},nl=Y=>{const J={};return Array.from(Y.querySelectorAll("swal-button")).forEach(Ue=>{Wi(Ue,["type","color","aria-label"]);const At=Ue.getAttribute("type");!At||!["confirm","cancel","deny"].includes(At)||(J[`${At}ButtonText`]=Ue.innerHTML,J[`show${Rr(At)}Button`]=!0,Ue.hasAttribute("color")&&(J[`${At}ButtonColor`]=Ue.getAttribute("color")),Ue.hasAttribute("aria-label")&&(J[`${At}ButtonAriaLabel`]=Ue.getAttribute("aria-label")))}),J},Bi=Y=>{const J={},fe=Y.querySelector("swal-image");return fe&&(Wi(fe,["src","width","height","alt"]),fe.hasAttribute("src")&&(J.imageUrl=fe.getAttribute("src")||void 0),fe.hasAttribute("width")&&(J.imageWidth=fe.getAttribute("width")||void 0),fe.hasAttribute("height")&&(J.imageHeight=fe.getAttribute("height")||void 0),fe.hasAttribute("alt")&&(J.imageAlt=fe.getAttribute("alt")||void 0)),J},oh=Y=>{const J={},fe=Y.querySelector("swal-icon");return fe&&(Wi(fe,["type","color"]),fe.hasAttribute("type")&&(J.icon=fe.getAttribute("type")),fe.hasAttribute("color")&&(J.iconColor=fe.getAttribute("color")),J.iconHtml=fe.innerHTML),J},Ul=Y=>{const J={},fe=Y.querySelector("swal-input");fe&&(Wi(fe,["type","label","placeholder","value"]),J.input=fe.getAttribute("type")||"text",fe.hasAttribute("label")&&(J.inputLabel=fe.getAttribute("label")),fe.hasAttribute("placeholder")&&(J.inputPlaceholder=fe.getAttribute("placeholder")),fe.hasAttribute("value")&&(J.inputValue=fe.getAttribute("value")));const Ue=Array.from(Y.querySelectorAll("swal-input-option"));return Ue.length&&(J.inputOptions={},Ue.forEach(At=>{Wi(At,["value"]);const xn=At.getAttribute("value");xn&&(J.inputOptions[xn]=At.innerHTML)})),J},gi=(Y,J)=>{const fe={};for(const Ue in J){const At=J[Ue],xn=Y.querySelector(At);xn&&(Wi(xn,[]),fe[At.replace(/^swal-/,"")]=xn.innerHTML.trim())}return fe},$n=Y=>{const J=kc.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(Y.children).forEach(fe=>{const Ue=fe.tagName.toLowerCase();J.includes(Ue)||ho(`Unrecognized element <${Ue}>`)})},Wi=(Y,J)=>{Array.from(Y.attributes).forEach(fe=>{-1===J.indexOf(fe.name)&&ho([`Unrecognized attribute "${fe.name}" on <${Y.tagName.toLowerCase()}>.`,J.length?`Allowed attributes are: ${J.join(", ")}`:"To set the value, use HTML within the element."])})},aa=Y=>{const J=Ji(),fe=Qn();"function"==typeof Y.willOpen&&Y.willOpen(fe),En.eventEmitter.emit("willOpen",fe);const At=window.getComputedStyle(document.body).overflowY;Zu(J,fe,Y),setTimeout(()=>{Pa(J,fe)},10),Vr()&&(jr(J,Y.scrollbarPadding,At),(()=>{const Y=Ji();Array.from(document.body.children).forEach(fe=>{fe.contains(Y)||(fe.hasAttribute("aria-hidden")&&fe.setAttribute("data-previous-aria-hidden",fe.getAttribute("aria-hidden")||""),fe.setAttribute("aria-hidden","true"))})})()),!dc()&&!En.previousActiveElement&&(En.previousActiveElement=document.activeElement),"function"==typeof Y.didOpen&&setTimeout(()=>Y.didOpen(fe)),En.eventEmitter.emit("didOpen",fe),Io(J,zt["no-transition"])},ec=Y=>{const J=Qn();if(Y.target!==J)return;const fe=Ji();J.removeEventListener("animationend",ec),J.removeEventListener("transitionend",ec),fe.style.overflowY="auto"},Pa=(Y,J)=>{Vc(J)?(Y.style.overflowY="hidden",J.addEventListener("animationend",ec),J.addEventListener("transitionend",ec)):Y.style.overflowY="auto"},jr=(Y,J,fe)=>{(()=>{if(vl&&!Gs(document.body,zt.iosfix)){const Y=document.body.scrollTop;document.body.style.top=-1*Y+"px",_r(document.body,zt.iosfix),Ll()}})(),J&&"hidden"!==fe&&Va(fe),setTimeout(()=>{Y.scrollTop=0})},Zu=(Y,J,fe)=>{_r(Y,fe.showClass.backdrop),fe.animation?(J.style.setProperty("opacity","0","important"),So(J,"grid"),setTimeout(()=>{_r(J,fe.showClass.popup),J.style.removeProperty("opacity")},10)):So(J,"grid"),_r([document.documentElement,document.body],zt.shown),fe.heightAuto&&fe.backdrop&&!fe.toast&&_r([document.documentElement,document.body],zt["height-auto"])};var sh={email:(Y,J)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(Y)?Promise.resolve():Promise.resolve(J||"Invalid email address"),url:(Y,J)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(Y)?Promise.resolve():Promise.resolve(J||"Invalid URL")};function ts(Y){(function Ip(Y){Y.inputValidator||("email"===Y.input&&(Y.inputValidator=sh.email),"url"===Y.input&&(Y.inputValidator=sh.url))})(Y),Y.showLoaderOnConfirm&&!Y.preConfirm&&ho("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function Op(Y){(!Y.target||"string"==typeof Y.target&&!document.querySelector(Y.target)||"string"!=typeof Y.target&&!Y.target.appendChild)&&(ho('Target parameter is not valid, defaulting to "body"'),Y.target="body")}(Y),"string"==typeof Y.title&&(Y.title=Y.title.split("\n").join("<br />")),iu(Y)}let Tn;var Zi=new WeakMap;class x{constructor(...J){if(co(this,Zi,void 0),typeof window>"u")return;Tn=this;const fe=Object.freeze(this.constructor.argsToParams(J));this.params=fe,this.isAwaitingPromise=!1,function nu(Y,J,fe){return Y.set(Lc(Y,J),fe),fe}(Zi,this,this._main(Tn.params))}_main(J,fe={}){if(tl(Object.assign({},fe,J)),En.currentInstance){const xn=yl.swalPromiseResolve.get(En.currentInstance),{isAwaitingPromise:Mi}=En.currentInstance;En.currentInstance._destroy(),Mi||xn({isDismissed:!0}),Vr()&&ad()}En.currentInstance=Tn;const Ue=H(J,fe);ts(Ue),Object.freeze(Ue),En.timeout&&(En.timeout.stop(),delete En.timeout),clearTimeout(En.restoreFocusTimeout);const At=ee(Tn);return Qa(Tn,Ue),jt.innerParams.set(Tn,Ue),T(Tn,At,Ue)}then(J){return Qi(Zi,this).then(J)}finally(J){return Qi(Zi,this).finally(J)}}const T=(Y,J,fe)=>new Promise((Ue,At)=>{const xn=Mi=>{Y.close({isDismissed:!0,dismiss:Mi})};yl.swalPromiseResolve.set(Y,Ue),yl.swalPromiseReject.set(Y,At),J.confirmButton.onclick=()=>{(Y=>{const J=jt.innerParams.get(Y);Y.disableButtons(),J.input?To(Y,"confirm"):xl(Y,!0)})(Y)},J.denyButton.onclick=()=>{(Y=>{const J=jt.innerParams.get(Y);Y.disableButtons(),J.returnInputValueOnDeny?To(Y,"deny"):zl(Y,!1)})(Y)},J.cancelButton.onclick=()=>{((Y,J)=>{Y.disableButtons(),J(vc.cancel)})(Y,xn)},J.closeButton.onclick=()=>{xn(vc.close)},((Y,J,fe)=>{Y.toast?kl(Y,J,fe):(Xs(J),ud(J),lu(Y,J,fe))})(fe,J,xn),((Y,J,fe)=>{Hc(Y),J.toast||(Y.keydownHandler=Ue=>vi(J,Ue,fe),Y.keydownTarget=J.keydownListenerCapture?window:Qn(),Y.keydownListenerCapture=J.keydownListenerCapture,Y.keydownTarget.addEventListener("keydown",Y.keydownHandler,{capture:Y.keydownListenerCapture}),Y.keydownHandlerAdded=!0)})(En,fe,xn),((Y,J)=>{"select"===J.input||"radio"===J.input?nr(Y,J):["text","email","number","tel","textarea"].some(fe=>fe===J.input)&&(Il(J.inputValue)||zc(J.inputValue))&&(el(Sr()),bi(Y,J))})(Y,fe),aa(fe),pe(En,fe,xn),Ee(J,fe),setTimeout(()=>{J.container.scrollTop=0})}),H=(Y,J)=>{const fe=(Y=>{const J="string"==typeof Y.template?document.querySelector(Y.template):Y.template;if(!J)return{};const fe=J.content;return $n(fe),Object.assign(pd(fe),Hl(fe),nl(fe),Bi(fe),oh(fe),Ul(fe),gi(fe,kc))})(Y),Ue=Object.assign({},kn,J,fe,Y);return Ue.showClass=Object.assign({},kn.showClass,Ue.showClass),Ue.hideClass=Object.assign({},kn.hideClass,Ue.hideClass),!1===Ue.animation&&(Ue.showClass={backdrop:"swal2-noanimation"},Ue.hideClass={}),Ue},ee=Y=>{const J={popup:Qn(),container:Ji(),actions:si(),confirmButton:Sr(),denyButton:Bo(),cancelButton:Yo(),loader:ei(),closeButton:Nc(),validationMessage:yi(),progressSteps:Jn()};return jt.domCache.set(Y,J),J},pe=(Y,J,fe)=>{const Ue=ui();Ko(Ue),J.timer&&(Y.timeout=new hu(()=>{fe("timer"),delete Y.timeout},J.timer),J.timerProgressBar&&(So(Ue),_o(Ue,J,"timerProgressBar"),setTimeout(()=>{Y.timeout&&Y.timeout.running&&Od(J.timer)})))},Ee=(Y,J)=>{if(!J.toast){if(!xa(J.allowEnterKey))return Pl("allowEnterKey"),void yt();nt(Y)||St(Y,J)||Uc(-1,1)}},nt=Y=>{const J=Array.from(Y.popup.querySelectorAll("[autofocus]"));for(const fe of J)if(fe instanceof HTMLElement&&Eo(fe))return fe.focus(),!0;return!1},St=(Y,J)=>J.focusDeny&&Eo(Y.denyButton)?(Y.denyButton.focus(),!0):J.focusCancel&&Eo(Y.cancelButton)?(Y.cancelButton.focus(),!0):!(!J.focusConfirm||!Eo(Y.confirmButton)||(Y.confirmButton.focus(),0)),yt=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const Y=new Date,J=localStorage.getItem("swal-initiation");J?(Y.getTime()-Date.parse(J))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const fe=document.createElement("audio");fe.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",fe.loop=!0,document.body.appendChild(fe),setTimeout(()=>{fe.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${Y}`)}x.prototype.disableButtons=Vo,x.prototype.enableButtons=Ql,x.prototype.getInput=Nl,x.prototype.disableInput=Yn,x.prototype.enableInput=ra,x.prototype.hideLoading=ia,x.prototype.disableLoading=ia,x.prototype.showValidationMessage=rn,x.prototype.resetValidationMessage=oa,x.prototype.close=Xo,x.prototype.closePopup=Xo,x.prototype.closeModal=Xo,x.prototype.closeToast=Xo,x.prototype.rejectPromise=su,x.prototype.update=Bl,x.prototype._destroy=Ys,Object.assign(x,qd),Object.keys(Er).forEach(Y=>{x[Y]=function(...J){return Tn&&Tn[Y]?Tn[Y](...J):null}}),x.DismissReason=vc,x.version="11.22.0";const on=x;return on.default=on,on}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(Lc,wn){var Qi=Lc.createElement("style");if(Lc.getElementsByTagName("head")[0].appendChild(Qi),Qi.styleSheet)Qi.styleSheet.disabled||(Qi.styleSheet.cssText=wn);else try{Qi.innerHTML=wn}catch{Qi.innerText=wn}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}')}},yg=>{yg(yg.s=117)}]);